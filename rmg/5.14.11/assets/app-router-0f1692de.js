import{j as b,a9 as _n,e as Ee,Q as Se,a5 as ye,G as Pe,a8 as Oe,t as lt,aa as At,d as de,ab as Te,a3 as Ke,M as Xe,a4 as Je,x as dt,y as ht,q as Qe,r as et,s as tt,v as nt,X as Kt,ac as bn,ad as yn,ae as vn,af as Nt,ag as Sn,ah as xn,ai as mt,aj as wn,ak as kn,L as Ve,al as Xt,a as Cn,am as jn}from"./chakra-ba5f36b3.js";import{r as X,c as st,g as An,u as En}from"./react-4978cfa7.js";import{_ as ot,u as J,r as ce,E as ve,R as ut,a as Jt,b as le,c as ue,d as On,e as Q,f as Lt,g as Ft,M as Rn,F as yt,h as Ie,i as ze,j as Re,k as vt,o as Et,l as zn,m as Ot,n as qe,S as Ne,p as Pn,q as Ut,s as Tn,t as Wt,v as In,w as Bn,x as St,y as Dn,z as Mn,A as Nn,B as Ln,C as Fn,D as Un,G as ct,H as we,I as Wn,J as Zn,K as Hn,L as Rt,N as zt,O as Pt,P as Gn,Q as Vn,T as $n,U as xt,V as wt,W as Yn,X as Zt,Y as qn,Z as Kn,$ as Qt,a0 as en,a1 as Xn,a2 as Jn,a3 as tn,a4 as nn,a5 as Ht,a6 as Qn,a7 as er,a8 as tr,a9 as nr,aa as rr,ab as ir,ac as sr,ad as ar,ae as or,af as gt,ag as lr,ah as cr,ai as dr,aj as hr,ak as ur,al as fr,am as pr,an as Be,ao as Le,ap as Fe,aq as De,ar as rn,as as mr,at as kt,au as Ct,av as gr,aw as _r,ax as br,ay as yr,az as vr,aA as Sr,aB as sn,aC as xr,aD as wr,aE as kr,aF as Cr,aG as Gt,aH as jr,aI as Ar,aJ as Er,aK as Or,aL as jt,aM as Rr,aN as zr,aO as Pr,aP as Tr,aQ as Ir,aR as Br,aS as Dr,aT as Mr,aU as Nr,aV as $e,aW as an,aX as Lr,aY as Fr,aZ as Ur,a_ as Vt}from"./index-22062bff.js";import{R as _e,n as Me,w as Wr,i as Zr,d as $t,a as on,s as Hr,b as _t,r as Gr,g as bt,P as Vr,c as $r,u as Yr,e as qr,f as Kr}from"./param-manager-utils-48fe8f69.js";var Xr=function(m){var _=m.text,n=m.delimiter;return b.jsx("span",{children:_.split(n||"\\").map(function(l,s){return s?[b.jsx(_n,{children:"⏎"},s),l]:l})})};const Jr={mtr:()=>ot(()=>import("./index-17c7550a.js"),["assets/index-17c7550a.js","assets/chakra-ba5f36b3.js","assets/react-4978cfa7.js","assets/index-22062bff.js","assets/index-46ec5c41.css","assets/share-356a51c7.js","assets/mtr-88d1b8b5.js","assets/param-manager-utils-48fe8f69.js"]),gzmtr:()=>ot(()=>import("./index-98979071.js"),["assets/index-98979071.js","assets/chakra-ba5f36b3.js","assets/react-4978cfa7.js","assets/index-22062bff.js","assets/index-46ec5c41.css","assets/share-356a51c7.js","assets/param-manager-utils-48fe8f69.js"]),shmetro:()=>ot(()=>import("./index-9ea3747f.js"),["assets/index-9ea3747f.js","assets/chakra-ba5f36b3.js","assets/react-4978cfa7.js","assets/index-22062bff.js","assets/index-46ec5c41.css","assets/share-356a51c7.js","assets/mtr-88d1b8b5.js","assets/param-manager-utils-48fe8f69.js"])};function Qr(m){const[_,n]=X.useState({});return X.useEffect(()=>(Jr[m]().then(l=>{n(l.default)}).catch(l=>{console.error("Failed to load canvas for style ".concat(m),l),n({})}),()=>{n({})}),[m]),_}const ei={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function ti(){const{canvasToShow:m,canvasScale:_}=J(r=>r.app),{svg_height:n,style:l}=J(r=>r.param),s=Qr(l);X.useEffect(()=>{document.getElementById("css_share").href="/rmg/"+"styles/share_".concat(l,".css"),ce.event(ve.STYLE_CHANGE,{style:l})},[l]);const t=Object.keys(s).filter(r=>m.includes(r)),e=n*_;return b.jsx(Ee,{minH:e,sx:ei,children:Object.keys(s).length===0?b.jsx(ut,{isIndeterminate:!0}):t.map(r=>b.jsx(Jt,{sx:{minWidth:750,height:e},children:s[r]},r+l))})}function ni(){const{t:m}=le(),_=ue(),n=J(o=>o.app.selectedStation);console.log("InfoSection:: Rendering for",n);const l=J(o=>o.param.style),{num:s,name:t,secondaryName:e}=J(o=>o.param.stn_list[n]),r=[{type:"input",label:m("StationSidePanel.info.num"),value:s,placeholder:"01",onChange:o=>_(On(n,o)),hidden:![Q.GZMTR].includes(l)},{type:"input",label:m("Chinese name"),value:t[0],onChange:o=>_(Lt(n,[o,t[1]]))},{type:"input",label:m("English name"),value:t[1],onChange:o=>_(Lt(n,[t[0],o]))},{type:"input",label:m("StationSidePanel.info.zhSecondary"),value:e?e[0]:"",placeholder:"1号航站楼",onChange:o=>_(Ft(n,[o,e?e[1]:""])),hidden:![Q.GZMTR].includes(l)},{type:"input",label:m("StationSidePanel.info.enSecondary"),value:e?e[1]:"",placeholder:"Terminal 1",onChange:o=>_(Ft(n,[e?e[0]:"",o])),hidden:![Q.GZMTR].includes(l)}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("StationSidePanel.info.title")}),b.jsx(_e,{fields:r,minW:130})]})}class ri{static hexToRgb(_){return[parseInt(_.slice(1,3),16),parseInt(_.slice(3,5),16),parseInt(_.slice(5,7),16)]}static fade(_,n){return"rgba(".concat([...this.hexToRgb(_),n].join(","),")")}static euclideanDistance(_,n){return this.hexToRgb(_).reduce((l,s,t)=>l+Math.pow(s-this.hexToRgb(n)[t],2),0)}}function Tt(m){var s;const{theme:_,onClick:n}=m,{t:l}=le();return b.jsx(Pe,{size:"xs","aria-label":l("Colour"),mt:"0.45px",color:_==null?void 0:_[3],bg:_==null?void 0:_[2],_hover:{bg:ri.fade((s=_==null?void 0:_[2])!=null?s:"#aaaaaa",.7)},icon:b.jsx(Rn,{}),onClick:n})}function ii(m){const{interchangeList:_,onAdd:n,onDelete:l,onUpdate:s}=m,{t}=le(),e=ue(),[r,o]=X.useState(),{paletteAppClipOutput:f}=J(y=>y.app),{style:v,theme:d,stn_list:h}=J(y=>y.param);X.useEffect(()=>{r!==void 0&&f&&(s==null||s(r,{..._[r],theme:f}),o(void 0))},[f==null?void 0:f.toString()]);const a=Object.values(h).reduce((y,g)=>{const[x,j]=y;return[[...new Set(x.concat(g.transfer.groups.map(A=>{var C,I;return(I=(C=A.lines)==null?void 0:C.map(R=>R.name[0]))!=null?I:[]}).flat()))],[...new Set(j.concat(g.transfer.groups.map(A=>{var C,I;return(I=(C=A.lines)==null?void 0:C.map(R=>R.name[1]))!=null?I:[]}).flat()))]]},[[],[]]),p=Object.fromEntries(Object.entries(yt).filter(([y])=>!["railway"].includes(y)).map(([y,g])=>[y,t(g)])),u=_.map((y,g)=>[{type:"input",label:t("Chinese name"),value:y.name[0],onChange:x=>s==null?void 0:s(g,{...y,name:[x,y.name[1]]}),optionList:a[0]},{type:"input",label:t("English name"),value:y.name[1],onChange:x=>s==null?void 0:s(g,{...y,name:[y.name[0],x]}),optionList:a[1]},{type:"select",label:t("Line icon"),value:y.facility,options:p,onChange:x=>s==null?void 0:s(g,{...y,facility:x}),hidden:![Q.MTR].includes(v)}]);return b.jsxs(Ie,{direction:"column",children:[_.length===0&&b.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack",children:[b.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:t("StationSidePanel.interchange.noInterchanges")}),b.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n({theme:[d[0],"","#aaaaaa",ze.white],name:["",""]}),icon:b.jsx(Re,{})})]}),_.map((y,g)=>b.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack-".concat(g),children:[b.jsx(vt,{label:t("Colour"),minW:"40px",noLabel:g!==0,children:b.jsx(Tt,{theme:y.theme,onClick:()=>{var x;o(g),e(Et((x=y.theme)!=null?x:[d[0],"","#aaaaaa",ze.white]))}})}),b.jsx(_e,{fields:u[g],noLabel:g!==0}),n&&g===u.length-1?b.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(_.slice(-1)[0]),icon:b.jsx(zn,{})}):b.jsx(Se,{minW:8}),l&&b.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.remove"),onClick:()=>l==null?void 0:l(g),icon:b.jsx(Ot,{})})]},g))]})}function si(){const{t:m}=le(),_=ue(),n=J(d=>d.app.selectedStation),{theme:l,style:s}=J(d=>d.param),{transfer:t}=J(d=>d.param.stn_list[n]),e=d=>{var h,a,p,u;return[{type:"input",label:m("Station Chinese name"),value:(a=(h=t.groups[d].name)==null?void 0:h[0])!=null?a:"",hidden:![Q.MTR].includes(s),onChange:y=>{var g,x;return _(Ut(n,d,[y,(x=(g=t.groups[d].name)==null?void 0:g[1])!=null?x:""]))}},{type:"input",label:m("Station English name"),value:(u=(p=t.groups[d].name)==null?void 0:p[1])!=null?u:"",hidden:![Q.MTR].includes(s),onChange:y=>{var g,x;return _(Ut(n,d,[(x=(g=t.groups[d].name)==null?void 0:g[0])!=null?x:"",y]))}},{type:"switch",label:m("Paid area"),isChecked:t.paid_area,onChange:y=>_(Tn(n,y)),hidden:![Q.MTR].includes(s)||d===0,oneLine:!0}]},r=d=>h=>{_(Wt(n,d,h))},o=d=>h=>{_(In(n,d,h))},f=d=>(h,a)=>{_(Bn(n,d,h,a))},v=()=>{_(Wt(n,t.groups.length,{theme:[l[0],"","#AAAAAA",ze.white],name:["",""]}))};return b.jsxs(At,{align:"flex-start",p:1,children:[b.jsxs(Ee,{w:"100%",children:[b.jsx(ye,{as:"h5",size:"sm",mr:"auto",children:m("StationSidePanel.interchange.title")}),s===Q.MTR&&b.jsx(qe,{selections:[{label:m("Text on the left"),value:Ne.left},{label:m("Text on the right"),value:Ne.right}],defaultValue:t.tick_direc,onChange:d=>_(Pn(n,d))})]}),t.groups.map((d,h)=>{var a;return b.jsxs(X.Fragment,{children:[b.jsx(ye,{as:"h6",size:"xs",children:m(h===0?"StationSidePanel.interchange.within":h===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),h!==0&&b.jsx(_e,{fields:e(h)}),b.jsx(ii,{interchangeList:(a=d.lines)!=null?a:[],onAdd:r(h),onDelete:o(h),onUpdate:f(h)})]},h)}),t.groups.length<3&&b.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:b.jsx(Re,{}),onClick:v,children:m("StationSidePanel.interchange.addGroup")})]})}function ai(){const{t:m}=le(),_=ue(),n=J(p=>p.app.selectedStation),{style:l,loop:s}=J(p=>p.param),{services:t,facility:e,loop_pivot:r,one_line:o,int_padding:f}=J(p=>p.param.stn_list[n]),v=Object.values(St).map(p=>({label:m("StationSidePanel.more."+p),value:p,disabled:p===St.local&&l!==Q.SHMetro})),d=Object.fromEntries(Object.entries(yt).filter(([p])=>!["railway"].includes(p)).map(([p,u])=>[p,m(u)])),h=Object.fromEntries(Object.entries(yt).filter(([p])=>!["np360"].includes(p)).map(([p,u])=>[p,m(u)])),a=[{type:"custom",label:m("StationSidePanel.more.service"),component:b.jsx(qe,{selections:v,defaultValue:t,onChange:p=>_(Dn(n,p)),multiSelect:!0}),hidden:![Q.GZMTR,Q.SHMetro].includes(l)},{type:"select",label:m("StationSidePanel.more.facility"),value:e||"",options:{"":m("None"),...l===Q.MTR?d:h},onChange:p=>_(Mn(n,p)),hidden:![Q.MTR,Q.SHMetro].includes(l)},{type:"switch",label:m("StationSidePanel.more.pivot"),isChecked:r,onChange:p=>_(Nn(n,p)),hidden:![Q.SHMetro].includes(l)||!s,minW:"full",oneLine:!0},{type:"switch",label:m("StationSidePanel.more.oneLine"),isChecked:o,onChange:p=>_(Ln(n,p)),hidden:![Q.SHMetro].includes(l),minW:"full",oneLine:!0},{type:"input",label:m("StationSidePanel.more.intPadding"),value:f.toString(),validator:p=>Number.isInteger(p),onChange:p=>_(Fn(n,Number(p))),hidden:![Q.SHMetro].includes(l)},{type:"custom",label:m("StationSidePanel.more.intPaddingApplyGlobal"),component:b.jsx(qe,{selections:[{label:m("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:p=>_(Un(n))}),oneLine:!0,hidden:![Q.SHMetro].includes(l)}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("StationSidePanel.more.title")}),b.jsx(_e,{fields:a})]})}function oi(){const{t:m}=le(),_=ue(),n=J(d=>d.app.selectedStation),l=J(d=>d.param.stn_list),{parents:s,children:t,branch:e}=l[n],r={[ct.through]:m("StationSidePanel.branch.through"),[ct.nonThrough]:m("StationSidePanel.branch.nonThrough")},o=d=>(d===we.left?s:t).reduce((h,a)=>({...h,[a]:l[a].name.join(" ")}),{}),f={upper:m("StationSidePanel.branch.upper"),lower:m("StationSidePanel.branch.lower")},v=d=>{const h=e==null?void 0:e[d];return h?[{type:"select",label:m("StationSidePanel.branch.type"),options:r,value:h[0],onChange:a=>_(Wn(n,d,a))},{type:"select",label:m("StationSidePanel.branch.firstStation"),options:o(d),value:h[1],onChange:a=>_(Zn(n,d,a))},{type:"select",label:m("StationSidePanel.branch.position"),options:f,value:(d===we.left?s:t)[0]===h[1]?"upper":"lower",onChange:()=>_(Hn(n,d))}]:[]};return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("Branches")}),b.jsx(ye,{as:"h6",size:"xs",children:m("Branch on the left")}),b.jsx(Ie,{direction:"column",children:s.length===2?b.jsx(_e,{fields:v(we.left)}):b.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:m("No branches found")})}),b.jsx(ye,{as:"h6",size:"xs",children:m("Branch on the right")}),b.jsx(Ie,{direction:"column",children:t.length===2?b.jsx(_e,{fields:v(we.right)}):b.jsx(lt,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:m("No branches found")})})]})}function li(){return b.jsxs(Rt,{children:[b.jsx(ni,{}),b.jsx(Te,{}),b.jsx(si,{}),b.jsx(Te,{}),b.jsx(oi,{}),b.jsx(Te,{}),b.jsx(ai,{})]})}function ci(){const{t:m}=le(),_=zt(),{style:n,svgWidth:l,svg_height:s,y_pc:t,branchSpacingPct:e,padding:r,direction_gz_x:o,direction_gz_y:f,loop:v}=J(h=>h.param),d=[...Pt[n].map(h=>({type:"input",label:m("StyleSidePanel.layout.".concat(h,"Width")),value:l[h].toString(),onChange:a=>_(Gn(Number(a),h))})),{type:"input",label:m("StyleSidePanel.layout.canvasHeight"),value:s.toString(),onChange:h=>_(Vn(Number(h)))},{type:"slider",label:m("StyleSidePanel.layout.verticalPosition"),value:t,min:0,max:100,onChange:h=>_($n(h)),leftIcon:b.jsx(xt,{}),rightIcon:b.jsx(wt,{}),hidden:![Q.MTR,Q.GZMTR].includes(n)},{type:"slider",label:m(v?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:e,min:0,max:v?50:100,onChange:h=>_(Yn(h)),leftIcon:b.jsx(Zt,{}),rightIcon:b.jsx(Re,{})},{type:"slider",label:m("StyleSidePanel.layout.padding"),value:r,min:0,max:50,onChange:h=>_(qn(h)),leftIcon:b.jsx(Zt,{}),rightIcon:b.jsx(Re,{})},{type:"slider",label:m("StyleSidePanel.layout.directionGzX"),value:o,min:0,max:100,onChange:h=>_(Kn(h)),leftIcon:b.jsx(Qt,{}),rightIcon:b.jsx(en,{}),hidden:![Q.GZMTR].includes(n)},{type:"slider",label:m("StyleSidePanel.layout.directionGzY"),value:f,min:0,max:100,onChange:h=>_(Xn(h)),leftIcon:b.jsx(xt,{}),rightIcon:b.jsx(wt,{}),hidden:![Q.GZMTR].includes(n)}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("StyleSidePanel.layout.title")}),b.jsx(_e,{fields:d,minW:130})]})}function di(){const{t:m}=le(),_=ue(),{paletteAppClipOutput:n}=J(C=>C.app),{style:l,theme:s,line_name:t,line_num:e,direction:r,platform_num:o,psd_num:f,namePosMTR:v,customiseMTRDest:d,info_panel_type:h}=J(C=>C.param),[a,p]=X.useState(!1);X.useEffect(()=>{a&&n&&(_(Jn(n)),p(!1))},[n==null?void 0:n.toString()]);const u=[{label:m("StyleSidePanel.design.left"),value:Ne.left},{label:m("StyleSidePanel.design.right"),value:Ne.right}],y=Object.values(tn).reduce((C,I)=>({...C,[I]:m("StyleSidePanel.design."+I)}),{}),g=Object.values(nn).reduce((C,I)=>({...C,[I]:m("StyleSidePanel.design."+I)}),{}),x=[{type:"custom",label:m("Colour"),component:b.jsx(Tt,{theme:s,onClick:()=>{p(!0),_(Et(s))}}),minW:"40px"},{type:"input",label:m("StyleSidePanel.design.zhLineName"),value:t[0],onChange:C=>_(Ht([C,t[1]])),minW:130},{type:"input",label:m("StyleSidePanel.design.enLineName"),value:t[1],onChange:C=>_(Ht([t[0],C])),minW:130},{type:"input",label:m("StyleSidePanel.design.lineNum"),value:e,onChange:C=>_(Qn(C)),hidden:![Q.GZMTR].includes(l)},{type:"input",label:m("StyleSidePanel.design.platformNum"),value:o||"",onChange:C=>_(er(C))},{type:"input",label:m("StyleSidePanel.design.psdNum"),value:f,onChange:C=>_(tr(C)),hidden:![Q.GZMTR].includes(l)},{type:"select",label:m("StyleSidePanel.design.panelType"),value:h,options:l===Q.GZMTR?y:g,onChange:C=>_(nr(C)),hidden:![Q.GZMTR,Q.SHMetro].includes(l)},{type:"custom",label:m("StyleSidePanel.design.direction"),component:b.jsx(qe,{selections:u,defaultValue:r,onChange:C=>_(rr(C))}),minW:"full",oneLine:!0}],j=[{label:m("StyleSidePanel.design.alternatively"),value:!0},{label:m("StyleSidePanel.design.onOneSide"),value:!1}],A=[{type:"custom",label:m("StyleSidePanel.design.nameDisplay"),component:b.jsxs(Oe,{spacing:.5,children:[b.jsx(Pe,{size:"xs",variant:"ghost","aria-label":m("StyleSidePanel.design.flip"),title:m("StyleSidePanel.design.flip"),icon:b.jsx(ir,{}),onClick:()=>_(sr())}),b.jsx(qe,{selections:j,defaultValue:v.isStagger,onChange:C=>_(ar(C))})]}),minW:"full",oneLine:!0,hidden:![Q.MTR].includes(l)},{type:"switch",label:m("StyleSidePanel.design.legacyDestination"),isChecked:d.isLegacy,onChange:C=>_(or(C)),hidden:![Q.MTR].includes(l),minW:"full",oneLine:!0},{type:"switch",label:m("StyleSidePanel.design.overrideTerminal"),isChecked:d.terminal!==!1,onChange:C=>_(gt(C?["",""]:!1)),hidden:![Q.MTR].includes(l),minW:"full",oneLine:!0},{type:"input",label:m("StyleSidePanel.design.terminalZhName"),value:d.terminal?d.terminal[0]:"",placeholder:"機場及博覽館",onChange:C=>_(gt([C,d.terminal?d.terminal[1]:""])),hidden:![Q.MTR].includes(l)||d.terminal===!1},{type:"input",label:m("StyleSidePanel.design.terminalEnName"),value:d.terminal?d.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:C=>_(gt([d.terminal?d.terminal[0]:"",C])),hidden:![Q.MTR].includes(l)||d.terminal===!1}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("StyleSidePanel.design.title")}),b.jsx(_e,{fields:[...x,...A],minW:130})]})}function hi(){const{t:m}=le(),_=ue(),{branches:n}=J(h=>h.helper),{loop:l,loop_info:s}=J(h=>h.param),{bank:t,left_and_right_factor:e,bottom_factor:r}=s,o=n.flat().filter((h=>a=>(h[a]=(h[a]||0)+1)===2)({})).filter(h=>!["linestart","lineend"].includes(h)),f=Math.abs(n[0].indexOf(o[0])-n[0].indexOf(o[1])),v=n.length>=2?(0,Math.min)(n[0].length-2-f,f):Math.floor((n[0].length-2-r*2)/2),d=[{type:"switch",label:m("StyleSidePanel.loop.isLoop"),isChecked:l,onChange:h=>_(lr(h)),minW:"full",oneLine:!0},{type:"switch",label:m("StyleSidePanel.loop.isBank"),isChecked:t,onChange:h=>_(cr(h)),minW:"full",oneLine:!0,hidden:!l},{type:"slider",label:m("StyleSidePanel.loop.leftRightFactor"),value:e,min:0,max:v,onChange:h=>_(dr(Math.floor(h))),hidden:!l},{type:"slider",label:m("StyleSidePanel.loop.bottomFactor"),value:r,min:0,max:Math.floor((n[0].length-2-e*2)/2),onChange:h=>_(hr(Math.floor(h))),hidden:!l||l&&n.length>2}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("StyleSidePanel.loop.title")}),b.jsx(_e,{fields:d})]})}function ui(m){const{note:_,onUpdate:n,onDelete:l}=m,{t:s}=le(),t=[{type:"textarea",label:s("StyleSidePanel.note.zhNote"),value:_[0],onChange:r=>n==null?void 0:n([r,_[1],_[2],_[3],_[4]])},{type:"textarea",label:s("StyleSidePanel.note.enNote"),value:_[1],onChange:r=>n==null?void 0:n([_[0],r,_[2],_[3],_[4]])},{type:"switch",label:s("StyleSidePanel.note.border"),isChecked:_[4],onChange:r=>n==null?void 0:n([_[0],_[1],_[2],_[3],r]),oneLine:!0}],e=[{type:"slider",label:s("StyleSidePanel.note.positionX"),value:_[2],min:0,max:100,onChange:r=>n==null?void 0:n([_[0],_[1],r,_[3],_[4]]),leftIcon:b.jsx(Qt,{}),rightIcon:b.jsx(en,{})},{type:"slider",label:s("StyleSidePanel.note.positionY"),value:_[3],min:0,max:100,onChange:r=>n==null?void 0:n([_[0],_[1],_[2],r,_[4]]),leftIcon:b.jsx(xt,{}),rightIcon:b.jsx(wt,{})}];return b.jsxs(Ie,{direction:"column",children:[b.jsx(_e,{fields:t,minW:"full"}),b.jsxs(Oe,{spacing:.5,sx:{"&>div":{flex:1}},children:[b.jsx(_e,{fields:e}),b.jsx(Pe,{size:"sm",variant:"ghost","aria-label":s("StyleSidePanel.note.remove"),onClick:()=>l==null?void 0:l(),icon:b.jsx(Ot,{})})]})]})}function fi(){const{t:m}=le(),_=ue(),n=J(l=>l.param.notesGZMTR);return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("StyleSidePanel.note.title")}),b.jsxs(At,{spacing:.5,children:[n==null?void 0:n.map((l,s)=>b.jsx(ui,{note:l,onUpdate:t=>_(ur(s,t)),onDelete:()=>_(fr(s))},s)),b.jsx(de,{size:"xs",variant:"ghost",leftIcon:b.jsx(Re,{}),alignSelf:"flex-end",onClick:()=>_(pr()),children:m("StyleSidePanel.note.add")})]})]})}function pi(){const{style:m}=J(_=>_.param);return b.jsxs(Rt,{children:[b.jsx(ci,{}),b.jsx(Te,{}),b.jsx(di,{}),m===Q.GZMTR&&b.jsxs(b.Fragment,{children:[b.jsx(Te,{}),b.jsx(fi,{})]}),m===Q.SHMetro&&b.jsxs(b.Fragment,{children:[b.jsx(Te,{}),b.jsx(hi,{})]})]})}const It=(m,_)=>{if(["linestart","lineend"].includes(m)||_[m].parents.length>1||_[m].children.length>1)return 0;const n=_[m].parents[0];return n?_[n].children.length===1?It(n,_):_[n].children.indexOf(m)===0?1:-1:0},mi=m=>(_,n)=>{const{stn_list:l,current_stn_idx:s}=n().param;if(m===s)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:t,children:e}=l[m];return Object.keys(l).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):t.length===2&&e.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(l).some(o=>![m,"linestart","lineend"].includes(o)&&It(o,l)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},gi=m=>(_,n)=>{var r,o;const l=n().param.stn_list,{parents:s,children:t}=l[m];let e=JSON.parse(JSON.stringify(l));s.length===2||t.length===2?(s.forEach(f=>{e[f].children=t}),t.forEach(f=>{e[f].parents=s}),s.length===1&&(e[s[0]].branch={...e[s[0]].branch,right:(r=e[m].branch)==null?void 0:r.right}),t.length===1&&(e[t[0]].branch={...e[t[0]].branch,left:(o=e[m].branch)==null?void 0:o.left})):l[s[0]].children.length===2&&l[t[0]].parents.length===2?e={...l,[s[0]]:{...l[s[0]],children:l[s[0]].children.filter(f=>f!==m),branch:{...l[s[0]].branch,right:void 0}},[t[0]]:{...l[t[0]],parents:l[t[0]].parents.filter(f=>f!==m),branch:{...l[t[0]].branch,left:void 0}}}:(s.forEach(f=>{var d,h,a,p;const v=e[f].children.indexOf(m);t.length?e[f].children[v]=t[0]:e[f].children.splice(v,1),((h=(d=e[f].branch)==null?void 0:d.right)==null?void 0:h[1])===m&&(e[f].branch={...e[f].branch,right:(p=(a=e[f].branch)==null?void 0:a.right)==null?void 0:p.with(1,t[0])})}),t.forEach(f=>{var d,h,a,p;const v=e[f].parents.indexOf(m);s.length?e[f].parents[v]=s[0]:e[f].parents.splice(v,1),((h=(d=e[f].branch)==null?void 0:d.left)==null?void 0:h[1])===m&&(e[f].branch={...e[f].branch,left:(p=(a=e[f].branch)==null?void 0:a.left)==null?void 0:p.with(1,s[0])})})),delete e[m],_(Be(e))};function _i(...m){return m.reduce((_,n)=>_.map(l=>n.map(s=>l.concat([s]))).reduce((l,s)=>l.concat(s),[]),[[]])}const Ue=(m,_)=>!!_[m[0]].children.indexOf(m[1]),ln=(m,_)=>[m[0][1],m[0][m[0].length-2],...m[0].filter(n=>m.slice(1).filter(l=>Ue(l,_)).map(l=>l.filter(s=>!["linestart","lineend"].includes(s))).map(l=>[l[0],l[l.length-1]]).flat().includes(n))],bi=(m,_)=>m.slice(1).filter(n=>Ue(n,_)).map(n=>n.filter(l=>!["linestart","lineend"].includes(l))).map(n=>[n[0],n[n.length-1]]),yi=m=>(_,n)=>{const l=n().helper.branches;if(m===0){const s=n().param.stn_list,t=ln(l,s);return _i(t,t).filter(e=>e[0]!==e[1])}else{const s=l[m];if(s){const t=s.filter(e=>!["linestart","lineend"].includes(e));return[[t[0],t.slice(-1)[0]]]}else return[]}},ws=(m,_)=>(n,l)=>{const s=l().param.coline,t=l().helper.branches[_];for(const[e,r]of Object.entries(s))if(r.from===m&&t.includes(r.to)){const o=t.indexOf(m),f=t.indexOf(r.to);if(f>o)return[f-o+1,e]}else if(r.to===m&&t.includes(r.to)){const o=t.indexOf(m),f=t.indexOf(r.from);if(f>o)return[f-o+1,e]}return[0,void 0]},cn=(m,_)=>(n,l)=>{const s=l().param.stn_list,t=l().helper.branches;if(m===_)throw new Error("addColine():: failed for same stnId");const e=ln(t,s).filter(o=>[m,_].includes(o)),r=bi(t,s).filter(o=>[m,_].every(f=>o.includes(f)));if(e.length===2&&r.length>0)throw new Error("addColine():: main check failed for ".concat(m,", ").concat(_));if(e.length!==2&&r.length!==1)throw new Error("addColine():: branch check failed for ".concat(m,", ").concat(_))},vi=m=>(_,n)=>{const l=n().param.coline,t=n().helper.branches[m];return t?Object.entries(l).reduce((e,r)=>t.includes(r[1].from)&&t.includes(r[1].to)?{...e,[r[0]]:r[1]}:{...e},{}):{}},Si=m=>(_,n)=>{const l=n().param.coline;if(Object.keys(l).length===0)return;const s=Object.entries(l).reduce((t,e)=>e[1].from!==m&&e[1].to!==m?{...t,[e[0]]:e[1]}:{...t},{});_(Le(s))},xi=(m,_,n,l=!0)=>(s,t)=>{const e=t().param.coline;s(cn(m,_)),s(Le({...e,[Me(4)]:{from:m,to:_,colors:n,display:l}}))},wi=(m,_,n,l=!0)=>(s,t)=>{const e=t().param.coline;if(m in e){s(cn(_,n));const r={...e,[m]:{...e[m],from:_,to:n,display:l}};s(Le(r))}},ki=(m,_)=>(n,l)=>{const s=l().param.coline;if(m in s&&s[m].colors.length>_){const t=s[m].colors.filter((e,r)=>r!==_);if(t.length===0){const{[m]:e,...r}=s;n(Le(r))}else{const e={...s,[m]:{...s[m],colors:t}};n(Le(e))}}},Ci=(m,_,n)=>(l,s)=>{const t=s().param.coline;if(m in t&&t[m].colors.length>_){const e={...t,[m]:{...t[m],colors:t[m].colors.map((r,o)=>o===_?[0,1,2,3,4,5].map(f=>n[f]===void 0?r[f]:n[f]):r)}};l(Le(e))}};function ji(m){const{isOpen:_,onClose:n}=m,{t:l}=le(),s=ue(),t=J(f=>f.app.selectedStation),[e,r]=X.useState(!1);X.useEffect(()=>{_||r(!1)},[_]);const o=()=>{const f=s(mi(t));f?(n(),s(Fe(De.CLOSE)),s(rn("linestart")),s(Si(t)),s(gi(t))):r(!0),ce.event(ve.REMOVE_STATION,{success:f})};return b.jsxs(Ke,{isOpen:_,onClose:n,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[e&&b.jsxs(dt,{status:"error",variant:"solid",size:"xs",children:[b.jsx(ht,{}),l("Unable to remove this station.")]}),b.jsxs(Se,{position:"relative",children:[b.jsx(Qe,{children:l("Remove station")}),b.jsx(et,{})]}),b.jsx(tt,{children:l("Are you sure to remove station? You cannot undo this action.")}),b.jsxs(nt,{children:[b.jsx(de,{onClick:n,children:l("Cancel")}),b.jsx(de,{colorScheme:"primary",onClick:o,ml:3,children:l("Confirm")})]})]})]})}function Ai(){const{t:m}=le(),_=ue(),n=J(t=>t.app.selectedStation),[l,s]=X.useState(!1);return b.jsxs(mr,{children:[b.jsxs(Oe,{children:[b.jsx(de,{size:"sm",variant:"outline",onClick:()=>_(kt(n)),children:m("StationSidePanel.footer.current")}),b.jsx(de,{size:"sm",variant:"outline",onClick:()=>s(!0),children:m("StationSidePanel.footer.remove")})]}),b.jsx(ji,{isOpen:l,onClose:()=>s(!1)})]})}function Ei(m){const{colineInfo:_,routeOptions:n,onUpdateRoute:l,onUpdateColourInfo:s,onDelete:t}=m,{t:e}=le(),r=ue(),{paletteAppClipOutput:o}=J(a=>a.app),[f,v]=X.useState(!1);X.useEffect(()=>{f&&o&&(s==null||s([...o,_.colors[0][4],_.colors[0][5]]),v(!1))},[o==null?void 0:o.toString()]);const d=[{type:"select",label:"Route",value:[_.from,_.to].join(","),options:n,onChange:a=>l==null?void 0:l(a)}],h=[{type:"custom",label:e("Colour"),component:b.jsx(Tt,{theme:[_.colors[0][0],_.colors[0][1],_.colors[0][2],_.colors[0][3]],onClick:()=>{v(!0),r(Et(_.colors[0].slice(0,4)))}})},{type:"input",label:e("Chinese name"),value:_.colors[0][4],minW:120,onChange:a=>s==null?void 0:s([_.colors[0][0],_.colors[0][1],_.colors[0][2],_.colors[0][3],a,_.colors[0][5]])},{type:"input",label:e("English name"),value:_.colors[0][5],minW:120,onChange:a=>s==null?void 0:s([_.colors[0][0],_.colors[0][1],_.colors[0][2],_.colors[0][3],_.colors[0][4],a])}];return b.jsxs(Ie,{direction:"column",children:[b.jsx(_e,{fields:d,minW:"full"}),b.jsxs(Oe,{spacing:.5,children:[b.jsx(_e,{fields:h}),b.jsx(Pe,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>t==null?void 0:t(0),icon:b.jsx(Ot,{})})]})]})}function Oi(){const{t:m}=le(),_=ue(),n=J(h=>h.app.selectedBranch),{theme:l,stn_list:s}=J(h=>h.param),t=_(vi(n)),e=_(yi(n)),r=h=>h.map(a=>s[a].name.join(" - ")).join(" ~ "),o=e.reduce((h,a)=>({...h,[a.join(",")]:r(a)}),{}),f=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(n," with default combination"),e[0]),_(xi(e[0][0],e[0][1],[[l[0],"","#AAAAAA",ze.white,"",""]]))},v=h=>a=>{const[p,u]=a.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(h,", from=").concat(p,", to=").concat(u));try{_(wi(h,p,u))}catch(y){_(Ct({status:"error",message:"Unable to draw this share track."}))}},d=(h,a)=>{_(ki(h,a))};return b.jsxs(At,{align:"flex-start",p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("BranchSidePanel.coline.title")}),Object.entries(t).map(([h,a])=>b.jsx(Ei,{colineInfo:a,routeOptions:o,onUpdateRoute:v(h),onUpdateColourInfo:p=>_(Ci(h,0,p)),onDelete:p=>d(h,p)},h)),(n===0||Object.keys(t).length===0)&&b.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:b.jsx(Re,{}),onClick:f,children:m("BranchSidePanel.coline.add")})]})}function Ri(m){const{isOpen:_,onClose:n}=m,{t:l}=le(),s=ue(),t=J(A=>A.app.selectedBranch),{style:e,stn_list:r}=J(A=>A.param),o=J(A=>A.helper.branches),[f,v]=X.useState(t),[d,h]=X.useState("1"),[a,p]=X.useState("2"),[u,y]=X.useState("asc");X.useEffect(()=>{v(t)},[t]);const g=[{type:"select",label:l("AutoNumModal.where"),value:f,options:{...o.reduce((A,C,I)=>({...A,[I]:I===0?l("AutoNumModal.main"):e!==Q.SHMetro||!Ue(C,r)?l("AutoNumModal.branch")+" "+I:l("AutoNumModal.external")+" "+I}),{})},onChange:A=>v(A)},{type:"input",label:l("AutoNumModal.from"),value:d,validator:A=>!isNaN(Number(A)),onChange:h,debouncedDelay:0},{type:"input",label:l("AutoNumModal.maxLength"),validator:A=>!isNaN(Number(A)),value:a,onChange:p,debouncedDelay:0},{type:"select",label:l("AutoNumModal.sort"),value:u,options:{asc:l("AutoNumModal.asc"),desc:l("AutoNumModal.desc")},onChange:A=>y(A)}],x=()=>{s(gr(f,Number(d),Number(a),u)),n(),ce.event(ve.AUTO_NUMBERING,{})},j=!d||!a||isNaN(Number(d))||isNaN(Number(a));return b.jsxs(Ke,{isOpen:_,onClose:n,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[b.jsx(Qe,{children:l("AutoNumModal.title")}),b.jsx(et,{}),b.jsx(tt,{children:b.jsx(_e,{fields:g})}),b.jsx(nt,{children:b.jsx(de,{colorScheme:"primary",isDisabled:j,onClick:x,children:l("Confirm")})})]})]})}const Bt=m=>(_,n)=>{const s=n().helper.branches[m];return s.includes("linestart")||s.includes("lineend")?1:2},dn=m=>(_,n)=>{const{branches:l}=n().helper,s=l[0],t=l[m];return s.slice(s.indexOf(t[0])+1,s.indexOf(t.slice(-1)[0]))},zi=(m,_)=>n=>n(Bt(_))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(dn(_)).includes(m)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Pi=(m,_)=>(n,l)=>{var o,f;if(!n(zi(m,_)))return!1;const{branches:t}=l().helper,e=l().param.stn_list,r=t[_];if(r[0]==="linestart"){const v={...e,[r[1]]:{...e[r[1]],parents:[m]},[m]:{...e[m],children:e.linestart.children.map(d=>d===r[1]?d:e[m].children[0]),branch:{right:(o=e.linestart.branch)==null?void 0:o.right}},linestart:{...e.linestart,children:e.linestart.children.filter(d=>d!==r[1]),branch:{}}};return n(Be(v)),!0}else{const v=r.slice(-2)[0],d={...e,[v]:{...e[v],children:[m]},[m]:{...e[m],parents:e.lineend.parents.map(h=>h===v?h:e[m].parents[0]),branch:{left:(f=e.lineend.branch)==null?void 0:f.left}},lineend:{...e.lineend,parents:e.lineend.parents.filter(h=>h!==v),branch:{}}};return n(Be(d)),!0}},hn=m=>(_,n)=>{const{branches:l}=n().helper,s=n().param.stn_list,t=l[0],e=l[m];if(_(Bt(m))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const o=t.indexOf(e[0]),f=t.slice(0,o),v=t.indexOf(e.slice(-1)[0]),d=t.slice(v+1),h=f.every(p=>s[p].children.length<=1&&s[p].parents.length<=1),a=d.every(p=>s[p].children.length<=1&&s[p].parents.length<=1);return h?a?[we.left,we.right]:[we.left]:a?[we.right]:[]},Ti=(m,_)=>(n,l)=>{var f,v;if(!n(hn(_)).includes(m))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:t}=l().helper,e=l().param.stn_list,r=t[0],o=t[_];if(m===we.left){const d=o[0],h={...e,[o[1]]:{...e[o[1]],parents:["linestart"]},[d]:{...e[d],children:e[d].children.filter(a=>a!==o[1]),branch:{}},linestart:{...e.linestart,children:e[d].children.map(a=>a===o[1]?a:r[1]),branch:{right:(f=e[d].branch)==null?void 0:f.right}}};return n(Be(h)),!0}else{const d=o.slice(-1)[0],h=o.slice(-2)[0],a={...e,[h]:{...e[h],children:["lineend"]},[d]:{...e[d],parents:e[d].parents.filter(p=>p!==h),branch:{}},lineend:{...e.lineend,parents:e[d].parents.map(p=>p===h?p:r.slice(-2)[0]),branch:{left:(v=e[d].branch)==null?void 0:v.left}}};return n(Be(a)),!0}};function Yt(m){const{direction:_}=m,{t:n}=le(),l=ue(),{branches:s}=J(R=>R.helper),t=J(R=>R.app.selectedBranch),{style:e,stn_list:r}=J(R=>R.param),[o,f]=X.useState(!1),[v,d]=X.useState(""),h=s[t].filter(R=>!["linestart","lineend"].includes(R)),a=_===we.left?h[0]:h.slice(-1)[0],p=r[a],u=l(dn(t)),y=l(Bt(t)),g=l(hn(t)),x=y===1&&!s[0].includes(a),j=g.includes(_),A=u.reduce((R,M)=>{var z;return{...R,[M]:(z=r[M])==null?void 0:z.name.join(" - ")}},{"":n("Please select...")}),C=()=>{const R=l(Pi(v,t));R?f(!1):l(Ct({status:"error",message:n("Unable to connect to main line.")})),ce.event(ve.CONNECT_BRANCH,{style:e,success:R})},I=()=>{const R=l(Ti(_,t));R||l(Ct({status:"error",message:n("Unable to disconnect from main line.")})),ce.event(ve.DISCONNECT_BRANCH,{style:e,success:R})};return b.jsxs(Ie,{direction:"column",children:[b.jsxs(Ee,{alignItems:"center",children:[b.jsx(vt,{label:n("Station name"),flex:1,children:b.jsx(_r,{defaultValue:p.name.join(" "),isDisabled:!0})}),o?b.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>f(!1),children:n("Cancel")}):x?b.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>f(!0),children:n("Connect to main line")}):b.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:I,isDisabled:!j,children:n("Disconnect from main line")})]}),o&&b.jsxs(Ee,{alignItems:"center",children:[b.jsx(vt,{label:n("Target station"),flex:1,children:b.jsx(br,{defaultValue:v,options:A,disabledOptions:[""],onChange:({target:{value:R}})=>d(R)})}),b.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:C,isDisabled:!v,children:n("Confirm")})]})]})}function Ii(){const{t:m}=le(),_=ue(),n=J(r=>r.param.style),l=J(r=>r.app.selectedBranch),[s,t]=X.useState(!1),e=()=>{_(Sr(n===Q.SHMetro)),ce.event(ve.REVERSE_STATIONS,{style:n})};return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:m("BranchSidePanel.action.title")}),b.jsxs(Ee,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[l!==0&&n!==Q.SHMetro&&b.jsxs(b.Fragment,{children:[b.jsx(ye,{as:"h6",size:"xs",children:m("Branch left end")}),b.jsx(Yt,{direction:we.left}),b.jsx(ye,{as:"h6",size:"xs",children:m("Branch right end")}),b.jsx(Yt,{direction:we.right})]}),n===Q.GZMTR&&b.jsx(de,{size:"sm",variant:"outline",leftIcon:b.jsx(yr,{}),alignSelf:"flex-end",onClick:()=>t(!0),children:m("BranchSidePanel.action.autoNum")}),b.jsx(de,{size:"sm",variant:"outline",leftIcon:b.jsx(vr,{}),alignSelf:"flex-end",onClick:e,children:n===Q.SHMetro?m("BranchSidePanel.action.flip"):m("BranchSidePanel.action.reverse")})]}),b.jsx(Ri,{isOpen:s,onClose:()=>t(!1)})]})}function Bi(){const m=J(s=>s.app.selectedBranch),{style:_,stn_list:n}=J(s=>s.param),l=J(s=>s.helper.branches);return b.jsxs(Rt,{children:[_===Q.SHMetro&&(m===0||Ue(l[m],n))&&b.jsxs(b.Fragment,{children:[b.jsx(Oi,{}),b.jsx(Te,{})]}),b.jsx(Ii,{})]})}const Di="rmg-palette-bridge--",Mi={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function Ni(m){const{isOpen:_,onClose:n,defaultTheme:l,onSelect:s}=m,[t]=X.useState(Me()),[e,r]=X.useState(!1),o="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:ce.getAppName(),parentId:t}),f=X.useRef();return X.useEffect(()=>{const v=new BroadcastChannel(Di+t);return f.current=v,v.onmessage=d=>{const{event:h,data:a}=d.data;console.log("[rmg] Received event from Palette app clip:",h),h==="CLOSE"?n():h==="SELECT"?s(a):h==="LOADED"&&r(!0)},()=>{v.close()}},[]),X.useEffect(()=>{var v;l&&((v=f.current)==null||v.postMessage({event:"OPEN",data:l}))},[e,l==null?void 0:l.toString()]),b.jsxs(sn,{size:"md",isOpen:_,onClose:n,sx:Mi,children:[b.jsx(Kt,{onClick:n}),b.jsx("iframe",{src:o,loading:"eager"})]})}const Li=410;function Fi(){var o,f;const{t:m}=le(),_=zt(),{sidePanelMode:n,selectedStation:l,paletteAppClipInput:s}=J(v=>v.app),t=J(v=>{var d;return(d=v.param.stn_list[l])==null?void 0:d.name}),e={STATION:{header:b.jsx(Xr,{text:(t==null?void 0:t.join(" - "))||""}),body:b.jsx(li,{}),footer:b.jsx(Ai,{})},STYLE:{header:m("StyleSidePanel.header"),body:b.jsx(pi,{})},BRANCH:{header:m("BranchSidePanel.header"),body:b.jsx(Bi,{})},CLOSE:{header:"Close"}},r=()=>{_(Fe(De.CLOSE))};return b.jsxs(xr,{isOpen:n!==De.CLOSE,width:Li,header:"Dummy header",children:[b.jsx(wr,{onClose:r,children:e[n].header}),(o=e[n])==null?void 0:o.body,(f=e[n])==null?void 0:f.footer,b.jsx(Ni,{isOpen:!!s,onClose:()=>_(kr()),defaultTheme:s,onSelect:v=>_(Cr(v))})]})}function at(m){throw new Error('Could not dynamically require "'+m+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var un={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(m,_){(function(n){m.exports=n()})(function(){return function n(l,s,t){function e(f,v){if(!s[f]){if(!l[f]){var d=typeof at=="function"&&at;if(!v&&d)return d(f,!0);if(r)return r(f,!0);var h=new Error("Cannot find module '"+f+"'");throw h.code="MODULE_NOT_FOUND",h}var a=s[f]={exports:{}};l[f][0].call(a.exports,function(p){var u=l[f][1][p];return e(u||p)},a,a.exports,n,l,s,t)}return s[f].exports}for(var r=typeof at=="function"&&at,o=0;o<t.length;o++)e(t[o]);return e}({1:[function(n,l,s){var t=n("./utils"),e=n("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(o){for(var f,v,d,h,a,p,u,y=[],g=0,x=o.length,j=x,A=t.getTypeOf(o)!=="string";g<o.length;)j=x-g,d=A?(f=o[g++],v=g<x?o[g++]:0,g<x?o[g++]:0):(f=o.charCodeAt(g++),v=g<x?o.charCodeAt(g++):0,g<x?o.charCodeAt(g++):0),h=f>>2,a=(3&f)<<4|v>>4,p=1<j?(15&v)<<2|d>>6:64,u=2<j?63&d:64,y.push(r.charAt(h)+r.charAt(a)+r.charAt(p)+r.charAt(u));return y.join("")},s.decode=function(o){var f,v,d,h,a,p,u=0,y=0,g="data:";if(o.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,j=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===r.charAt(64)&&j--,o.charAt(o.length-2)===r.charAt(64)&&j--,j%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=e.uint8array?new Uint8Array(0|j):new Array(0|j);u<o.length;)f=r.indexOf(o.charAt(u++))<<2|(h=r.indexOf(o.charAt(u++)))>>4,v=(15&h)<<4|(a=r.indexOf(o.charAt(u++)))>>2,d=(3&a)<<6|(p=r.indexOf(o.charAt(u++))),x[y++]=f,a!==64&&(x[y++]=v),p!==64&&(x[y++]=d);return x}},{"./support":30,"./utils":32}],2:[function(n,l,s){var t=n("./external"),e=n("./stream/DataWorker"),r=n("./stream/Crc32Probe"),o=n("./stream/DataLengthProbe");function f(v,d,h,a,p){this.compressedSize=v,this.uncompressedSize=d,this.crc32=h,this.compression=a,this.compressedContent=p}f.prototype={getContentWorker:function(){var v=new e(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),d=this;return v.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new e(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(v,d,h){return v.pipe(new r).pipe(new o("uncompressedSize")).pipe(d.compressWorker(h)).pipe(new o("compressedSize")).withStreamInfo("compression",d)},l.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,l,s){var t=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,l,s){var t=n("./utils"),e=function(){for(var r,o=[],f=0;f<256;f++){r=f;for(var v=0;v<8;v++)r=1&r?3988292384^r>>>1:r>>>1;o[f]=r}return o}();l.exports=function(r,o){return r!==void 0&&r.length?t.getTypeOf(r)!=="string"?function(f,v,d,h){var a=e,p=h+d;f^=-1;for(var u=h;u<p;u++)f=f>>>8^a[255&(f^v[u])];return-1^f}(0|o,r,r.length,0):function(f,v,d,h){var a=e,p=h+d;f^=-1;for(var u=h;u<p;u++)f=f>>>8^a[255&(f^v.charCodeAt(u))];return-1^f}(0|o,r,r.length,0):0}},{"./utils":32}],5:[function(n,l,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,l,s){var t=null;t=typeof Promise<"u"?Promise:n("lie"),l.exports={Promise:t}},{lie:37}],7:[function(n,l,s){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",e=n("pako"),r=n("./utils"),o=n("./stream/GenericWorker"),f=t?"uint8array":"array";function v(d,h){o.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=h,this.meta={}}s.magic="\b\0",r.inherits(v,o),v.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(f,d.data),!1)},v.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new e[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(h){d.push({data:h,meta:d.meta})}},s.compressWorker=function(d){return new v("Deflate",d)},s.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,l,s){function t(a,p){var u,y="";for(u=0;u<p;u++)y+=String.fromCharCode(255&a),a>>>=8;return y}function e(a,p,u,y,g,x){var j,A,C=a.file,I=a.compression,R=x!==f.utf8encode,M=r.transformTo("string",x(C.name)),z=r.transformTo("string",f.utf8encode(C.name)),F=C.comment,$=r.transformTo("string",x(F)),k=r.transformTo("string",f.utf8encode(F)),D=z.length!==C.name.length,c=k.length!==F.length,N="",ne="",Z="",ie=C.dir,H=C.date,re={crc32:0,compressedSize:0,uncompressedSize:0};p&&!u||(re.crc32=a.crc32,re.compressedSize=a.compressedSize,re.uncompressedSize=a.uncompressedSize);var T=0;p&&(T|=8),R||!D&&!c||(T|=2048);var P=0,te=0;ie&&(P|=16),g==="UNIX"?(te=798,P|=function(Y,fe){var be=Y;return Y||(be=fe?16893:33204),(65535&be)<<16}(C.unixPermissions,ie)):(te=20,P|=function(Y){return 63&(Y||0)}(C.dosPermissions)),j=H.getUTCHours(),j<<=6,j|=H.getUTCMinutes(),j<<=5,j|=H.getUTCSeconds()/2,A=H.getUTCFullYear()-1980,A<<=4,A|=H.getUTCMonth()+1,A<<=5,A|=H.getUTCDate(),D&&(ne=t(1,1)+t(v(M),4)+z,N+="up"+t(ne.length,2)+ne),c&&(Z=t(1,1)+t(v($),4)+k,N+="uc"+t(Z.length,2)+Z);var q="";return q+="\n\0",q+=t(T,2),q+=I.magic,q+=t(j,2),q+=t(A,2),q+=t(re.crc32,4),q+=t(re.compressedSize,4),q+=t(re.uncompressedSize,4),q+=t(M.length,2),q+=t(N.length,2),{fileRecord:d.LOCAL_FILE_HEADER+q+M+N,dirRecord:d.CENTRAL_FILE_HEADER+t(te,2)+q+t($.length,2)+"\0\0\0\0"+t(P,4)+t(y,4)+M+N+$}}var r=n("../utils"),o=n("../stream/GenericWorker"),f=n("../utf8"),v=n("../crc32"),d=n("../signature");function h(a,p,u,y){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=u,this.encodeFileName=y,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(h,o),h.prototype.push=function(a){var p=a.meta.percent||0,u=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,o.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:u?(p+100*(u-y-1))/u:100}}))},h.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var p=this.streamFiles&&!a.file.dir;if(p){var u=e(a,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:u.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(a){this.accumulate=!1;var p=this.streamFiles&&!a.file.dir,u=e(a,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(u.dirRecord),p)this.push({data:function(y){return d.DATA_DESCRIPTOR+t(y.crc32,4)+t(y.compressedSize,4)+t(y.uncompressedSize,4)}(a),meta:{percent:100}});else for(this.push({data:u.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var a=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var u=this.bytesWritten-a,y=function(g,x,j,A,C){var I=r.transformTo("string",C(A));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(g,2)+t(g,2)+t(x,4)+t(j,4)+t(I.length,2)+I}(this.dirRecords.length,u,a,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(a){this._sources.push(a);var p=this;return a.on("data",function(u){p.processChunk(u)}),a.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),a.on("error",function(u){p.error(u)}),this},h.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(a){var p=this._sources;if(!o.prototype.error.call(this,a))return!1;for(var u=0;u<p.length;u++)try{p[u].error(a)}catch(y){}return!0},h.prototype.lock=function(){o.prototype.lock.call(this);for(var a=this._sources,p=0;p<a.length;p++)a[p].lock()},l.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,l,s){var t=n("../compressions"),e=n("./ZipFileWorker");s.generateWorker=function(r,o,f){var v=new e(o.streamFiles,f,o.platform,o.encodeFileName),d=0;try{r.forEach(function(h,a){d++;var p=function(x,j){var A=x||j,C=t[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(a.options.compression,o.compression),u=a.options.compressionOptions||o.compressionOptions||{},y=a.dir,g=a.date;a._compressWorker(p,u).withStreamInfo("file",{name:h,dir:y,date:g,comment:a.comment||"",unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions}).pipe(v)}),v.entriesCount=d}catch(h){v.error(h)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,l,s){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new t;for(var r in this)typeof this[r]!="function"&&(e[r]=this[r]);return e}}(t.prototype=n("./object")).loadAsync=n("./load"),t.support=n("./support"),t.defaults=n("./defaults"),t.version="3.10.1",t.loadAsync=function(e,r){return new t().loadAsync(e,r)},t.external=n("./external"),l.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,l,s){var t=n("./utils"),e=n("./external"),r=n("./utf8"),o=n("./zipEntries"),f=n("./stream/Crc32Probe"),v=n("./nodejsUtils");function d(h){return new e.Promise(function(a,p){var u=h.decompressed.getContentWorker().pipe(new f);u.on("error",function(y){p(y)}).on("end",function(){u.streamInfo.crc32!==h.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):a()}).resume()})}l.exports=function(h,a){var p=this;return a=t.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),v.isNode&&v.isStream(h)?e.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",h,!0,a.optimizedBinaryString,a.base64).then(function(u){var y=new o(a);return y.load(u),y}).then(function(u){var y=[e.Promise.resolve(u)],g=u.files;if(a.checkCRC32)for(var x=0;x<g.length;x++)y.push(d(g[x]));return e.Promise.all(y)}).then(function(u){for(var y=u.shift(),g=y.files,x=0;x<g.length;x++){var j=g[x],A=j.fileNameStr,C=t.resolve(j.fileNameStr);p.file(C,j.decompressed,{binary:!0,optimizedBinaryString:!0,date:j.date,dir:j.dir,comment:j.fileCommentStr.length?j.fileCommentStr:null,unixPermissions:j.unixPermissions,dosPermissions:j.dosPermissions,createFolders:a.createFolders}),j.dir||(p.file(C).unsafeOriginalName=A)}return y.zipComment.length&&(p.comment=y.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,l,s){var t=n("../utils"),e=n("../stream/GenericWorker");function r(o,f){e.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(f)}t.inherits(r,e),r.prototype._bindStream=function(o){var f=this;(this._stream=o).pause(),o.on("data",function(v){f.push({data:v,meta:{percent:0}})}).on("error",function(v){f.isPaused?this.generatedError=v:f.error(v)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},r.prototype.pause=function(){return!!e.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,l,s){var t=n("readable-stream").Readable;function e(r,o,f){t.call(this,o),this._helper=r;var v=this;r.on("data",function(d,h){v.push(d)||v._helper.pause(),f&&f(h)}).on("error",function(d){v.emit("error",d)}).on("end",function(){v.push(null)})}n("../utils").inherits(e,t),e.prototype._read=function(){this._helper.resume()},l.exports=e},{"../utils":32,"readable-stream":16}],14:[function(n,l,s){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(n,l,s){function t(C,I,R){var M,z=r.getTypeOf(I),F=r.extend(R||{},v);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(C=g(C)),F.createFolders&&(M=y(C))&&x.call(this,M,!0);var $=z==="string"&&F.binary===!1&&F.base64===!1;R&&R.binary!==void 0||(F.binary=!$),(I instanceof d&&I.uncompressedSize===0||F.dir||!I||I.length===0)&&(F.base64=!1,F.binary=!0,I="",F.compression="STORE",z="string");var k=null;k=I instanceof d||I instanceof o?I:p.isNode&&p.isStream(I)?new u(C,I):r.prepareContent(C,I,F.binary,F.optimizedBinaryString,F.base64);var D=new h(C,k,F);this.files[C]=D}var e=n("./utf8"),r=n("./utils"),o=n("./stream/GenericWorker"),f=n("./stream/StreamHelper"),v=n("./defaults"),d=n("./compressedObject"),h=n("./zipObject"),a=n("./generate"),p=n("./nodejsUtils"),u=n("./nodejs/NodejsStreamInputAdapter"),y=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var I=C.lastIndexOf("/");return 0<I?C.substring(0,I):""},g=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},x=function(C,I){return I=I!==void 0?I:v.createFolders,C=g(C),this.files[C]||t.call(this,C,null,{dir:!0,createFolders:I}),this.files[C]};function j(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var I,R,M;for(I in this.files)M=this.files[I],(R=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&C(R,M)},filter:function(C){var I=[];return this.forEach(function(R,M){C(R,M)&&I.push(M)}),I},file:function(C,I,R){if(arguments.length!==1)return C=this.root+C,t.call(this,C,I,R),this;if(j(C)){var M=C;return this.filter(function(F,$){return!$.dir&&M.test(F)})}var z=this.files[this.root+C];return z&&!z.dir?z:null},folder:function(C){if(!C)return this;if(j(C))return this.filter(function(z,F){return F.dir&&C.test(z)});var I=this.root+C,R=x.call(this,I),M=this.clone();return M.root=R.name,M},remove:function(C){C=this.root+C;var I=this.files[C];if(I||(C.slice(-1)!=="/"&&(C+="/"),I=this.files[C]),I&&!I.dir)delete this.files[C];else for(var R=this.filter(function(z,F){return F.name.slice(0,C.length)===C}),M=0;M<R.length;M++)delete this.files[R[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var I,R={};try{if((R=r.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");r.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var M=R.comment||this.comment||"";I=a.generateWorker(this,R,M)}catch(z){(I=new o("error")).error(z)}return new f(I,R.type||"string",R.mimeType)},generateAsync:function(C,I){return this.generateInternalStream(C).accumulate(I)},generateNodeStream:function(C,I){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(I)}};l.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,l,s){l.exports=n("stream")},{stream:void 0}],17:[function(n,l,s){var t=n("./DataReader");function e(r){t.call(this,r);for(var o=0;o<this.data.length;o++)r[o]=255&r[o]}n("../utils").inherits(e,t),e.prototype.byteAt=function(r){return this.data[this.zero+r]},e.prototype.lastIndexOfSignature=function(r){for(var o=r.charCodeAt(0),f=r.charCodeAt(1),v=r.charCodeAt(2),d=r.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===o&&this.data[h+1]===f&&this.data[h+2]===v&&this.data[h+3]===d)return h-this.zero;return-1},e.prototype.readAndCheckSignature=function(r){var o=r.charCodeAt(0),f=r.charCodeAt(1),v=r.charCodeAt(2),d=r.charCodeAt(3),h=this.readData(4);return o===h[0]&&f===h[1]&&v===h[2]&&d===h[3]},e.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,o},l.exports=e},{"../utils":32,"./DataReader":18}],18:[function(n,l,s){var t=n("../utils");function e(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}e.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var o,f=0;for(this.checkOffset(r),o=this.index+r-1;o>=this.index;o--)f=(f<<8)+this.byteAt(o);return this.index+=r,f},readString:function(r){return t.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},l.exports=e},{"../utils":32}],19:[function(n,l,s){var t=n("./Uint8ArrayReader");function e(r){t.call(this,r)}n("../utils").inherits(e,t),e.prototype.readData=function(r){this.checkOffset(r);var o=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,o},l.exports=e},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,l,s){var t=n("./DataReader");function e(r){t.call(this,r)}n("../utils").inherits(e,t),e.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},e.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},e.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},e.prototype.readData=function(r){this.checkOffset(r);var o=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,o},l.exports=e},{"../utils":32,"./DataReader":18}],21:[function(n,l,s){var t=n("./ArrayReader");function e(r){t.call(this,r)}n("../utils").inherits(e,t),e.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,o},l.exports=e},{"../utils":32,"./ArrayReader":17}],22:[function(n,l,s){var t=n("../utils"),e=n("../support"),r=n("./ArrayReader"),o=n("./StringReader"),f=n("./NodeBufferReader"),v=n("./Uint8ArrayReader");l.exports=function(d){var h=t.getTypeOf(d);return t.checkSupport(h),h!=="string"||e.uint8array?h==="nodebuffer"?new f(d):e.uint8array?new v(t.transformTo("uint8array",d)):new r(t.transformTo("array",d)):new o(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,l,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,l,s){var t=n("./GenericWorker"),e=n("../utils");function r(o){t.call(this,"ConvertWorker to "+o),this.destType=o}e.inherits(r,t),r.prototype.processChunk=function(o){this.push({data:e.transformTo(this.destType,o.data),meta:o.meta})},l.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(n,l,s){var t=n("./GenericWorker"),e=n("../crc32");function r(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(r,t),r.prototype.processChunk=function(o){this.streamInfo.crc32=e(o.data,this.streamInfo.crc32||0),this.push(o)},l.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,l,s){var t=n("../utils"),e=n("./GenericWorker");function r(o){e.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}t.inherits(r,e),r.prototype.processChunk=function(o){if(o){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+o.data.length}e.prototype.processChunk.call(this,o)},l.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(n,l,s){var t=n("../utils"),e=n("./GenericWorker");function r(o){e.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(v){f.dataIsReady=!0,f.data=v,f.max=v&&v.length||0,f.type=t.getTypeOf(v),f.isPaused||f._tickAndRepeat()},function(v){f.error(v)})}t.inherits(r,e),r.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,f);break;case"uint8array":o=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":o=this.data.slice(this.index,f)}return this.index=f,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(n,l,s){function t(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,r){return this._listeners[e].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,r){if(this._listeners[e])for(var o=0;o<this._listeners[e].length;o++)this._listeners[e][o].call(this,r)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var r=this;return e.on("data",function(o){r.processChunk(o)}),e.on("end",function(){r.end()}),e.on("error",function(o){r.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,r){return this.extraStreamInfo[e]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},l.exports=t},{}],29:[function(n,l,s){var t=n("../utils"),e=n("./ConvertWorker"),r=n("./GenericWorker"),o=n("../base64"),f=n("../support"),v=n("../external"),d=null;if(f.nodestream)try{d=n("../nodejs/NodejsStreamOutputAdapter")}catch(p){}function h(p,u){return new v.Promise(function(y,g){var x=[],j=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(I,R){x.push(I),u&&u(R)}).on("error",function(I){x=[],g(I)}).on("end",function(){try{var I=function(R,M,z){switch(R){case"blob":return t.newBlob(t.transformTo("arraybuffer",M),z);case"base64":return o.encode(M);default:return t.transformTo(R,M)}}(A,function(R,M){var z,F=0,$=null,k=0;for(z=0;z<M.length;z++)k+=M[z].length;switch(R){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for($=new Uint8Array(k),z=0;z<M.length;z++)$.set(M[z],F),F+=M[z].length;return $;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+R+"'")}}(j,x),C);y(I)}catch(R){g(R)}x=[]}).resume()})}function a(p,u,y){var g=u;switch(u){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=u,this._mimeType=y,t.checkSupport(g),this._worker=p.pipe(new e(g)),p.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}a.prototype={accumulate:function(p){return h(this,p)},on:function(p,u){var y=this;return p==="data"?this._worker.on(p,function(g){u.call(y,g.data,g.meta)}):this._worker.on(p,function(){t.delay(u,arguments,y)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},p)}},l.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,l,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var t=new ArrayBuffer(0);try{s.blob=new Blob([t],{type:"application/zip"}).size===0}catch(r){try{var e=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);e.append(t),s.blob=e.getBlob("application/zip").size===0}catch(o){s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch(r){s.nodestream=!1}},{"readable-stream":16}],31:[function(n,l,s){for(var t=n("./utils"),e=n("./support"),r=n("./nodejsUtils"),o=n("./stream/GenericWorker"),f=new Array(256),v=0;v<256;v++)f[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;f[254]=f[254]=1;function d(){o.call(this,"utf-8 decode"),this.leftOver=null}function h(){o.call(this,"utf-8 encode")}s.utf8encode=function(a){return e.nodebuffer?r.newBufferFrom(a,"utf-8"):function(p){var u,y,g,x,j,A=p.length,C=0;for(x=0;x<A;x++)(64512&(y=p.charCodeAt(x)))==55296&&x+1<A&&(64512&(g=p.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(g-56320),x++),C+=y<128?1:y<2048?2:y<65536?3:4;for(u=e.uint8array?new Uint8Array(C):new Array(C),x=j=0;j<C;x++)(64512&(y=p.charCodeAt(x)))==55296&&x+1<A&&(64512&(g=p.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(g-56320),x++),y<128?u[j++]=y:(y<2048?u[j++]=192|y>>>6:(y<65536?u[j++]=224|y>>>12:(u[j++]=240|y>>>18,u[j++]=128|y>>>12&63),u[j++]=128|y>>>6&63),u[j++]=128|63&y);return u}(a)},s.utf8decode=function(a){return e.nodebuffer?t.transformTo("nodebuffer",a).toString("utf-8"):function(p){var u,y,g,x,j=p.length,A=new Array(2*j);for(u=y=0;u<j;)if((g=p[u++])<128)A[y++]=g;else if(4<(x=f[g]))A[y++]=65533,u+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&u<j;)g=g<<6|63&p[u++],x--;1<x?A[y++]=65533:g<65536?A[y++]=g:(g-=65536,A[y++]=55296|g>>10&1023,A[y++]=56320|1023&g)}return A.length!==y&&(A.subarray?A=A.subarray(0,y):A.length=y),t.applyFromCharCode(A)}(a=t.transformTo(e.uint8array?"uint8array":"array",a))},t.inherits(d,o),d.prototype.processChunk=function(a){var p=t.transformTo(e.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(e.uint8array){var u=p;(p=new Uint8Array(u.length+this.leftOver.length)).set(this.leftOver,0),p.set(u,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var y=function(x,j){var A;for((j=j||x.length)>x.length&&(j=x.length),A=j-1;0<=A&&(192&x[A])==128;)A--;return A<0||A===0?j:A+f[x[A]]>j?A:j}(p),g=p;y!==p.length&&(e.uint8array?(g=p.subarray(0,y),this.leftOver=p.subarray(y,p.length)):(g=p.slice(0,y),this.leftOver=p.slice(y,p.length))),this.push({data:s.utf8decode(g),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=d,t.inherits(h,o),h.prototype.processChunk=function(a){this.push({data:s.utf8encode(a.data),meta:a.meta})},s.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,l,s){var t=n("./support"),e=n("./base64"),r=n("./nodejsUtils"),o=n("./external");function f(u){return u}function v(u,y){for(var g=0;g<u.length;++g)y[g]=255&u.charCodeAt(g);return y}n("setimmediate"),s.newBlob=function(u,y){s.checkSupport("blob");try{return new Blob([u],{type:y})}catch(x){try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(u),g.getBlob(y)}catch(j){throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(u,y,g){var x=[],j=0,A=u.length;if(A<=g)return String.fromCharCode.apply(null,u);for(;j<A;)y==="array"||y==="nodebuffer"?x.push(String.fromCharCode.apply(null,u.slice(j,Math.min(j+g,A)))):x.push(String.fromCharCode.apply(null,u.subarray(j,Math.min(j+g,A)))),j+=g;return x.join("")},stringifyByChar:function(u){for(var y="",g=0;g<u.length;g++)y+=String.fromCharCode(u[g]);return y},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(u){return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch(u){return!1}}()}};function h(u){var y=65536,g=s.getTypeOf(u),x=!0;if(g==="uint8array"?x=d.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=d.applyCanBeUsed.nodebuffer),x)for(;1<y;)try{return d.stringifyByChunk(u,g,y)}catch(j){y=Math.floor(y/2)}return d.stringifyByChar(u)}function a(u,y){for(var g=0;g<u.length;g++)y[g]=u[g];return y}s.applyFromCharCode=h;var p={};p.string={string:f,array:function(u){return v(u,new Array(u.length))},arraybuffer:function(u){return p.string.uint8array(u).buffer},uint8array:function(u){return v(u,new Uint8Array(u.length))},nodebuffer:function(u){return v(u,r.allocBuffer(u.length))}},p.array={string:h,array:f,arraybuffer:function(u){return new Uint8Array(u).buffer},uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return r.newBufferFrom(u)}},p.arraybuffer={string:function(u){return h(new Uint8Array(u))},array:function(u){return a(new Uint8Array(u),new Array(u.byteLength))},arraybuffer:f,uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return r.newBufferFrom(new Uint8Array(u))}},p.uint8array={string:h,array:function(u){return a(u,new Array(u.length))},arraybuffer:function(u){return u.buffer},uint8array:f,nodebuffer:function(u){return r.newBufferFrom(u)}},p.nodebuffer={string:h,array:function(u){return a(u,new Array(u.length))},arraybuffer:function(u){return p.nodebuffer.uint8array(u).buffer},uint8array:function(u){return a(u,new Uint8Array(u.length))},nodebuffer:f},s.transformTo=function(u,y){if(y=y||"",!u)return y;s.checkSupport(u);var g=s.getTypeOf(y);return p[g][u](y)},s.resolve=function(u){for(var y=u.split("/"),g=[],x=0;x<y.length;x++){var j=y[x];j==="."||j===""&&x!==0&&x!==y.length-1||(j===".."?g.pop():g.push(j))}return g.join("/")},s.getTypeOf=function(u){return typeof u=="string"?"string":Object.prototype.toString.call(u)==="[object Array]"?"array":t.nodebuffer&&r.isBuffer(u)?"nodebuffer":t.uint8array&&u instanceof Uint8Array?"uint8array":t.arraybuffer&&u instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(u){if(!t[u.toLowerCase()])throw new Error(u+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(u){var y,g,x="";for(g=0;g<(u||"").length;g++)x+="\\x"+((y=u.charCodeAt(g))<16?"0":"")+y.toString(16).toUpperCase();return x},s.delay=function(u,y,g){setImmediate(function(){u.apply(g||null,y||[])})},s.inherits=function(u,y){function g(){}g.prototype=y.prototype,u.prototype=new g},s.extend=function(){var u,y,g={};for(u=0;u<arguments.length;u++)for(y in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],y)&&g[y]===void 0&&(g[y]=arguments[u][y]);return g},s.prepareContent=function(u,y,g,x,j){return o.Promise.resolve(y).then(function(A){return t.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new o.Promise(function(C,I){var R=new FileReader;R.onload=function(M){C(M.target.result)},R.onerror=function(M){I(M.target.error)},R.readAsArrayBuffer(A)}):A}).then(function(A){var C=s.getTypeOf(A);return C?(C==="arraybuffer"?A=s.transformTo("uint8array",A):C==="string"&&(j?A=e.decode(A):g&&x!==!0&&(A=function(I){return v(I,t.uint8array?new Uint8Array(I.length):new Array(I.length))}(A))),A):o.Promise.reject(new Error("Can't read the data of '"+u+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,l,s){var t=n("./reader/readerFor"),e=n("./utils"),r=n("./signature"),o=n("./zipEntry"),f=n("./support");function v(d){this.files=[],this.loadOptions=d}v.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+e.pretty(h)+", expected "+e.pretty(d)+")")}},isSignature:function(d,h){var a=this.reader.index;this.reader.setIndex(d);var p=this.reader.readString(4)===h;return this.reader.setIndex(a),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),h=f.uint8array?"uint8array":"array",a=e.transformTo(h,d);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,h,a,p=this.zip64EndOfCentralSize-44;0<p;)d=this.reader.readInt(2),h=this.reader.readInt(4),a=this.reader.readData(h),this.zip64ExtensibleData[d]={id:d,length:h,value:a}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,h;for(d=0;d<this.files.length;d++)h=this.files[d],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(d=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var h=d;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===e.MAX_VALUE_16BITS||this.diskWithCentralDirStart===e.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===e.MAX_VALUE_16BITS||this.centralDirRecords===e.MAX_VALUE_16BITS||this.centralDirSize===e.MAX_VALUE_32BITS||this.centralDirOffset===e.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a+=20,a+=12+this.zip64EndOfCentralSize);var p=h-a;if(0<p)this.isSignature(h,r.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(d){this.reader=t(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,l,s){var t=n("./reader/readerFor"),e=n("./utils"),r=n("./compressedObject"),o=n("./crc32"),f=n("./utf8"),v=n("./compressions"),d=n("./support");function h(a,p){this.options=a,this.loadOptions=p}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(a){var p,u;if(a.skip(22),this.fileNameLength=a.readInt(2),u=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(y){for(var g in v)if(Object.prototype.hasOwnProperty.call(v,g)&&v[g].magic===y)return v[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+e.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,p,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var p=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(p),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a==0&&(this.dosPermissions=63&this.externalFileAttributes),a==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=t(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var p,u,y,g=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index+4<g;)p=a.readInt(2),u=a.readInt(2),y=a.readData(u),this.extraFields[p]={id:p,length:u,value:y};a.setIndex(g)},handleUTF8:function(){var a=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var u=e.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var g=e.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var p=t(a.value);return p.readInt(1)!==1||o(this.fileName)!==p.readInt(4)?null:f.utf8decode(p.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var p=t(a.value);return p.readInt(1)!==1||o(this.fileComment)!==p.readInt(4)?null:f.utf8decode(p.readData(a.length-5))}return null}},l.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,l,s){function t(p,u,y){this.name=p,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=u,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var e=n("./stream/StreamHelper"),r=n("./stream/DataWorker"),o=n("./utf8"),f=n("./compressedObject"),v=n("./stream/GenericWorker");t.prototype={internalStream:function(p){var u=null,y="string";try{if(!p)throw new Error("No output type specified.");var g=(y=p.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),u=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(u=u.pipe(new o.Utf8EncodeWorker)),!x&&g&&(u=u.pipe(new o.Utf8DecodeWorker))}catch(j){(u=new v("error")).error(j)}return new e(u,y,"")},async:function(p,u){return this.internalStream(p).accumulate(u)},nodeStream:function(p,u){return this.internalStream(p||"nodebuffer").toNodejsStream(u)},_compressWorker:function(p,u){if(this._data instanceof f&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new o.Utf8EncodeWorker)),f.createWorkerFrom(y,p,u)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof v?this._data:new r(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},a=0;a<d.length;a++)t.prototype[d[a]]=h;l.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,l,s){(function(t){var e,r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var f=0,v=new o(p),d=t.document.createTextNode("");v.observe(d,{characterData:!0}),e=function(){d.data=f=++f%2}}else if(t.setImmediate||t.MessageChannel===void 0)e="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var u=t.document.createElement("script");u.onreadystatechange=function(){p(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},t.document.documentElement.appendChild(u)}:function(){setTimeout(p,0)};else{var h=new t.MessageChannel;h.port1.onmessage=p,e=function(){h.port2.postMessage(0)}}var a=[];function p(){var u,y;r=!0;for(var g=a.length;g;){for(y=a,a=[],u=-1;++u<g;)y[u]();g=a.length}r=!1}l.exports=function(u){a.push(u)!==1||r||e()}}).call(this,typeof st<"u"?st:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,l,s){var t=n("immediate");function e(){}var r={},o=["REJECTED"],f=["FULFILLED"],v=["PENDING"];function d(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,g!==e&&u(this,g)}function h(g,x,j){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof j=="function"&&(this.onRejected=j,this.callRejected=this.otherCallRejected)}function a(g,x,j){t(function(){var A;try{A=x(j)}catch(C){return r.reject(g,C)}A===g?r.reject(g,new TypeError("Cannot resolve promise with itself")):r.resolve(g,A)})}function p(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function u(g,x){var j=!1;function A(R){j||(j=!0,r.reject(g,R))}function C(R){j||(j=!0,r.resolve(g,R))}var I=y(function(){x(C,A)});I.status==="error"&&A(I.value)}function y(g,x){var j={};try{j.value=g(x),j.status="success"}catch(A){j.status="error",j.value=A}return j}(l.exports=d).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(j){return x.resolve(g()).then(function(){return j})},function(j){return x.resolve(g()).then(function(){throw j})})},d.prototype.catch=function(g){return this.then(null,g)},d.prototype.then=function(g,x){if(typeof g!="function"&&this.state===f||typeof x!="function"&&this.state===o)return this;var j=new this.constructor(e);return this.state!==v?a(j,this.state===f?g:x,this.outcome):this.queue.push(new h(j,g,x)),j},h.prototype.callFulfilled=function(g){r.resolve(this.promise,g)},h.prototype.otherCallFulfilled=function(g){a(this.promise,this.onFulfilled,g)},h.prototype.callRejected=function(g){r.reject(this.promise,g)},h.prototype.otherCallRejected=function(g){a(this.promise,this.onRejected,g)},r.resolve=function(g,x){var j=y(p,x);if(j.status==="error")return r.reject(g,j.value);var A=j.value;if(A)u(g,A);else{g.state=f,g.outcome=x;for(var C=-1,I=g.queue.length;++C<I;)g.queue[C].callFulfilled(x)}return g},r.reject=function(g,x){g.state=o,g.outcome=x;for(var j=-1,A=g.queue.length;++j<A;)g.queue[j].callRejected(x);return g},d.resolve=function(g){return g instanceof this?g:r.resolve(new this(e),g)},d.reject=function(g){var x=new this(e);return r.reject(x,g)},d.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=g.length,A=!1;if(!j)return this.resolve([]);for(var C=new Array(j),I=0,R=-1,M=new this(e);++R<j;)z(g[R],R);return M;function z(F,$){x.resolve(F).then(function(k){C[$]=k,++I!==j||A||(A=!0,r.resolve(M,C))},function(k){A||(A=!0,r.reject(M,k))})}},d.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=g.length,A=!1;if(!j)return this.resolve([]);for(var C=-1,I=new this(e);++C<j;)R=g[C],x.resolve(R).then(function(M){A||(A=!0,r.resolve(I,M))},function(M){A||(A=!0,r.reject(I,M))});var R;return I}},{immediate:36}],38:[function(n,l,s){var t={};(0,n("./lib/utils/common").assign)(t,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),l.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,l,s){var t=n("./zlib/deflate"),e=n("./utils/common"),r=n("./utils/strings"),o=n("./zlib/messages"),f=n("./zlib/zstream"),v=Object.prototype.toString,d=0,h=-1,a=0,p=8;function u(g){if(!(this instanceof u))return new u(g);this.options=e.assign({level:h,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:a,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var j=t.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(j!==d)throw new Error(o[j]);if(x.header&&t.deflateSetHeader(this.strm,x.header),x.dictionary){var A;if(A=typeof x.dictionary=="string"?r.string2buf(x.dictionary):v.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(j=t.deflateSetDictionary(this.strm,A))!==d)throw new Error(o[j]);this._dict_set=!0}}function y(g,x){var j=new u(x);if(j.push(g,!0),j.err)throw j.msg||o[j.err];return j.result}u.prototype.push=function(g,x){var j,A,C=this.strm,I=this.options.chunkSize;if(this.ended)return!1;A=x===~~x?x:x===!0?4:0,typeof g=="string"?C.input=r.string2buf(g):v.call(g)==="[object ArrayBuffer]"?C.input=new Uint8Array(g):C.input=g,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new e.Buf8(I),C.next_out=0,C.avail_out=I),(j=t.deflate(C,A))!==1&&j!==d)return this.onEnd(j),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(e.shrinkBuf(C.output,C.next_out))):this.onData(e.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&j!==1);return A===4?(j=t.deflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===d):A!==2||(this.onEnd(d),!(C.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Deflate=u,s.deflate=y,s.deflateRaw=function(g,x){return(x=x||{}).raw=!0,y(g,x)},s.gzip=function(g,x){return(x=x||{}).gzip=!0,y(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,l,s){var t=n("./zlib/inflate"),e=n("./utils/common"),r=n("./utils/strings"),o=n("./zlib/constants"),f=n("./zlib/messages"),v=n("./zlib/zstream"),d=n("./zlib/gzheader"),h=Object.prototype.toString;function a(u){if(!(this instanceof a))return new a(u);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},u||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||u&&u.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var g=t.inflateInit2(this.strm,y.windowBits);if(g!==o.Z_OK)throw new Error(f[g]);this.header=new d,t.inflateGetHeader(this.strm,this.header)}function p(u,y){var g=new a(y);if(g.push(u,!0),g.err)throw g.msg||f[g.err];return g.result}a.prototype.push=function(u,y){var g,x,j,A,C,I,R=this.strm,M=this.options.chunkSize,z=this.options.dictionary,F=!1;if(this.ended)return!1;x=y===~~y?y:y===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof u=="string"?R.input=r.binstring2buf(u):h.call(u)==="[object ArrayBuffer]"?R.input=new Uint8Array(u):R.input=u,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new e.Buf8(M),R.next_out=0,R.avail_out=M),(g=t.inflate(R,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&z&&(I=typeof z=="string"?r.string2buf(z):h.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,g=t.inflateSetDictionary(this.strm,I)),g===o.Z_BUF_ERROR&&F===!0&&(g=o.Z_OK,F=!1),g!==o.Z_STREAM_END&&g!==o.Z_OK)return this.onEnd(g),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&g!==o.Z_STREAM_END&&(R.avail_in!==0||x!==o.Z_FINISH&&x!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(j=r.utf8border(R.output,R.next_out),A=R.next_out-j,C=r.buf2string(R.output,j),R.next_out=A,R.avail_out=M-A,A&&e.arraySet(R.output,R.output,j,A,0),this.onData(C)):this.onData(e.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(F=!0)}while((0<R.avail_in||R.avail_out===0)&&g!==o.Z_STREAM_END);return g===o.Z_STREAM_END&&(x=o.Z_FINISH),x===o.Z_FINISH?(g=t.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===o.Z_OK):x!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(R.avail_out=0))},a.prototype.onData=function(u){this.chunks.push(u)},a.prototype.onEnd=function(u){u===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},s.Inflate=a,s.inflate=p,s.inflateRaw=function(u,y){return(y=y||{}).raw=!0,p(u,y)},s.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,l,s){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(o){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var v=f.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var d in v)v.hasOwnProperty(d)&&(o[d]=v[d])}}return o},s.shrinkBuf=function(o,f){return o.length===f?o:o.subarray?o.subarray(0,f):(o.length=f,o)};var e={arraySet:function(o,f,v,d,h){if(f.subarray&&o.subarray)o.set(f.subarray(v,v+d),h);else for(var a=0;a<d;a++)o[h+a]=f[v+a]},flattenChunks:function(o){var f,v,d,h,a,p;for(f=d=0,v=o.length;f<v;f++)d+=o[f].length;for(p=new Uint8Array(d),f=h=0,v=o.length;f<v;f++)a=o[f],p.set(a,h),h+=a.length;return p}},r={arraySet:function(o,f,v,d,h){for(var a=0;a<d;a++)o[h+a]=f[v+a]},flattenChunks:function(o){return[].concat.apply([],o)}};s.setTyped=function(o){o?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,e)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,r))},s.setTyped(t)},{}],42:[function(n,l,s){var t=n("./common"),e=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(d){e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(d){r=!1}for(var o=new t.Buf8(256),f=0;f<256;f++)o[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function v(d,h){if(h<65537&&(d.subarray&&r||!d.subarray&&e))return String.fromCharCode.apply(null,t.shrinkBuf(d,h));for(var a="",p=0;p<h;p++)a+=String.fromCharCode(d[p]);return a}o[254]=o[254]=1,s.string2buf=function(d){var h,a,p,u,y,g=d.length,x=0;for(u=0;u<g;u++)(64512&(a=d.charCodeAt(u)))==55296&&u+1<g&&(64512&(p=d.charCodeAt(u+1)))==56320&&(a=65536+(a-55296<<10)+(p-56320),u++),x+=a<128?1:a<2048?2:a<65536?3:4;for(h=new t.Buf8(x),u=y=0;y<x;u++)(64512&(a=d.charCodeAt(u)))==55296&&u+1<g&&(64512&(p=d.charCodeAt(u+1)))==56320&&(a=65536+(a-55296<<10)+(p-56320),u++),a<128?h[y++]=a:(a<2048?h[y++]=192|a>>>6:(a<65536?h[y++]=224|a>>>12:(h[y++]=240|a>>>18,h[y++]=128|a>>>12&63),h[y++]=128|a>>>6&63),h[y++]=128|63&a);return h},s.buf2binstring=function(d){return v(d,d.length)},s.binstring2buf=function(d){for(var h=new t.Buf8(d.length),a=0,p=h.length;a<p;a++)h[a]=d.charCodeAt(a);return h},s.buf2string=function(d,h){var a,p,u,y,g=h||d.length,x=new Array(2*g);for(a=p=0;a<g;)if((u=d[a++])<128)x[p++]=u;else if(4<(y=o[u]))x[p++]=65533,a+=y-1;else{for(u&=y===2?31:y===3?15:7;1<y&&a<g;)u=u<<6|63&d[a++],y--;1<y?x[p++]=65533:u<65536?x[p++]=u:(u-=65536,x[p++]=55296|u>>10&1023,x[p++]=56320|1023&u)}return v(x,p)},s.utf8border=function(d,h){var a;for((h=h||d.length)>d.length&&(h=d.length),a=h-1;0<=a&&(192&d[a])==128;)a--;return a<0||a===0?h:a+o[d[a]]>h?a:h}},{"./common":41}],43:[function(n,l,s){l.exports=function(t,e,r,o){for(var f=65535&t|0,v=t>>>16&65535|0,d=0;r!==0;){for(r-=d=2e3<r?2e3:r;v=v+(f=f+e[o++]|0)|0,--d;);f%=65521,v%=65521}return f|v<<16|0}},{}],44:[function(n,l,s){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,l,s){var t=function(){for(var e,r=[],o=0;o<256;o++){e=o;for(var f=0;f<8;f++)e=1&e?3988292384^e>>>1:e>>>1;r[o]=e}return r}();l.exports=function(e,r,o,f){var v=t,d=f+o;e^=-1;for(var h=f;h<d;h++)e=e>>>8^v[255&(e^r[h])];return-1^e}},{}],46:[function(n,l,s){var t,e=n("../utils/common"),r=n("./trees"),o=n("./adler32"),f=n("./crc32"),v=n("./messages"),d=0,h=4,a=0,p=-2,u=-1,y=4,g=2,x=8,j=9,A=286,C=30,I=19,R=2*A+1,M=15,z=3,F=258,$=F+z+1,k=42,D=113,c=1,N=2,ne=3,Z=4;function ie(i,L){return i.msg=v[L],L}function H(i){return(i<<1)-(4<i?9:0)}function re(i){for(var L=i.length;0<=--L;)i[L]=0}function T(i){var L=i.state,B=L.pending;B>i.avail_out&&(B=i.avail_out),B!==0&&(e.arraySet(i.output,L.pending_buf,L.pending_out,B,i.next_out),i.next_out+=B,L.pending_out+=B,i.total_out+=B,i.avail_out-=B,L.pending-=B,L.pending===0&&(L.pending_out=0))}function P(i,L){r._tr_flush_block(i,0<=i.block_start?i.block_start:-1,i.strstart-i.block_start,L),i.block_start=i.strstart,T(i.strm)}function te(i,L){i.pending_buf[i.pending++]=L}function q(i,L){i.pending_buf[i.pending++]=L>>>8&255,i.pending_buf[i.pending++]=255&L}function Y(i,L){var B,w,S=i.max_chain_length,E=i.strstart,U=i.prev_length,W=i.nice_match,O=i.strstart>i.w_size-$?i.strstart-(i.w_size-$):0,G=i.window,K=i.w_mask,V=i.prev,ee=i.strstart+F,he=G[E+U-1],ae=G[E+U];i.prev_length>=i.good_match&&(S>>=2),W>i.lookahead&&(W=i.lookahead);do if(G[(B=L)+U]===ae&&G[B+U-1]===he&&G[B]===G[E]&&G[++B]===G[E+1]){E+=2,B++;do;while(G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&E<ee);if(w=F-(ee-E),E=ee-F,U<w){if(i.match_start=L,W<=(U=w))break;he=G[E+U-1],ae=G[E+U]}}while((L=V[L&K])>O&&--S!=0);return U<=i.lookahead?U:i.lookahead}function fe(i){var L,B,w,S,E,U,W,O,G,K,V=i.w_size;do{if(S=i.window_size-i.lookahead-i.strstart,i.strstart>=V+(V-$)){for(e.arraySet(i.window,i.window,V,V,0),i.match_start-=V,i.strstart-=V,i.block_start-=V,L=B=i.hash_size;w=i.head[--L],i.head[L]=V<=w?w-V:0,--B;);for(L=B=V;w=i.prev[--L],i.prev[L]=V<=w?w-V:0,--B;);S+=V}if(i.strm.avail_in===0)break;if(U=i.strm,W=i.window,O=i.strstart+i.lookahead,G=S,K=void 0,K=U.avail_in,G<K&&(K=G),B=K===0?0:(U.avail_in-=K,e.arraySet(W,U.input,U.next_in,K,O),U.state.wrap===1?U.adler=o(U.adler,W,K,O):U.state.wrap===2&&(U.adler=f(U.adler,W,K,O)),U.next_in+=K,U.total_in+=K,K),i.lookahead+=B,i.lookahead+i.insert>=z)for(E=i.strstart-i.insert,i.ins_h=i.window[E],i.ins_h=(i.ins_h<<i.hash_shift^i.window[E+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[E+z-1])&i.hash_mask,i.prev[E&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=E,E++,i.insert--,!(i.lookahead+i.insert<z)););}while(i.lookahead<$&&i.strm.avail_in!==0)}function be(i,L){for(var B,w;;){if(i.lookahead<$){if(fe(i),i.lookahead<$&&L===d)return c;if(i.lookahead===0)break}if(B=0,i.lookahead>=z&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),B!==0&&i.strstart-B<=i.w_size-$&&(i.match_length=Y(i,B)),i.match_length>=z)if(w=r._tr_tally(i,i.strstart-i.match_start,i.match_length-z),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=z){for(i.match_length--;i.strstart++,i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart,--i.match_length!=0;);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+1])&i.hash_mask;else w=r._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(w&&(P(i,!1),i.strm.avail_out===0))return c}return i.insert=i.strstart<z-1?i.strstart:z-1,L===h?(P(i,!0),i.strm.avail_out===0?ne:Z):i.last_lit&&(P(i,!1),i.strm.avail_out===0)?c:N}function se(i,L){for(var B,w,S;;){if(i.lookahead<$){if(fe(i),i.lookahead<$&&L===d)return c;if(i.lookahead===0)break}if(B=0,i.lookahead>=z&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=z-1,B!==0&&i.prev_length<i.max_lazy_match&&i.strstart-B<=i.w_size-$&&(i.match_length=Y(i,B),i.match_length<=5&&(i.strategy===1||i.match_length===z&&4096<i.strstart-i.match_start)&&(i.match_length=z-1)),i.prev_length>=z&&i.match_length<=i.prev_length){for(S=i.strstart+i.lookahead-z,w=r._tr_tally(i,i.strstart-1-i.prev_match,i.prev_length-z),i.lookahead-=i.prev_length-1,i.prev_length-=2;++i.strstart<=S&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),--i.prev_length!=0;);if(i.match_available=0,i.match_length=z-1,i.strstart++,w&&(P(i,!1),i.strm.avail_out===0))return c}else if(i.match_available){if((w=r._tr_tally(i,0,i.window[i.strstart-1]))&&P(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return c}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(w=r._tr_tally(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<z-1?i.strstart:z-1,L===h?(P(i,!0),i.strm.avail_out===0?ne:Z):i.last_lit&&(P(i,!1),i.strm.avail_out===0)?c:N}function oe(i,L,B,w,S){this.good_length=i,this.max_lazy=L,this.nice_length=B,this.max_chain=w,this.func=S}function ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new e.Buf16(2*R),this.dyn_dtree=new e.Buf16(2*(2*C+1)),this.bl_tree=new e.Buf16(2*(2*I+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new e.Buf16(M+1),this.heap=new e.Buf16(2*A+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new e.Buf16(2*A+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(i){var L;return i&&i.state?(i.total_in=i.total_out=0,i.data_type=g,(L=i.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?k:D,i.adler=L.wrap===2?0:1,L.last_flush=d,r._tr_init(L),a):ie(i,p)}function Ce(i){var L=pe(i);return L===a&&function(B){B.window_size=2*B.w_size,re(B.head),B.max_lazy_match=t[B.level].max_lazy,B.good_match=t[B.level].good_length,B.nice_match=t[B.level].nice_length,B.max_chain_length=t[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=z-1,B.match_available=0,B.ins_h=0}(i.state),L}function ke(i,L,B,w,S,E){if(!i)return p;var U=1;if(L===u&&(L=6),w<0?(U=0,w=-w):15<w&&(U=2,w-=16),S<1||j<S||B!==x||w<8||15<w||L<0||9<L||E<0||y<E)return ie(i,p);w===8&&(w=9);var W=new ge;return(i.state=W).strm=i,W.wrap=U,W.gzhead=null,W.w_bits=w,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+z-1)/z),W.window=new e.Buf8(2*W.w_size),W.head=new e.Buf16(W.hash_size),W.prev=new e.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new e.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=L,W.strategy=E,W.method=B,Ce(i)}t=[new oe(0,0,0,0,function(i,L){var B=65535;for(B>i.pending_buf_size-5&&(B=i.pending_buf_size-5);;){if(i.lookahead<=1){if(fe(i),i.lookahead===0&&L===d)return c;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;var w=i.block_start+B;if((i.strstart===0||i.strstart>=w)&&(i.lookahead=i.strstart-w,i.strstart=w,P(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-$&&(P(i,!1),i.strm.avail_out===0))return c}return i.insert=0,L===h?(P(i,!0),i.strm.avail_out===0?ne:Z):(i.strstart>i.block_start&&(P(i,!1),i.strm.avail_out),c)}),new oe(4,4,8,4,be),new oe(4,5,16,8,be),new oe(4,6,32,32,be),new oe(4,4,16,16,se),new oe(8,16,32,32,se),new oe(8,16,128,128,se),new oe(8,32,128,256,se),new oe(32,128,258,1024,se),new oe(32,258,258,4096,se)],s.deflateInit=function(i,L){return ke(i,L,x,15,8,0)},s.deflateInit2=ke,s.deflateReset=Ce,s.deflateResetKeep=pe,s.deflateSetHeader=function(i,L){return i&&i.state?i.state.wrap!==2?p:(i.state.gzhead=L,a):p},s.deflate=function(i,L){var B,w,S,E;if(!i||!i.state||5<L||L<0)return i?ie(i,p):p;if(w=i.state,!i.output||!i.input&&i.avail_in!==0||w.status===666&&L!==h)return ie(i,i.avail_out===0?-5:p);if(w.strm=i,B=w.last_flush,w.last_flush=L,w.status===k)if(w.wrap===2)i.adler=0,te(w,31),te(w,139),te(w,8),w.gzhead?(te(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),te(w,255&w.gzhead.time),te(w,w.gzhead.time>>8&255),te(w,w.gzhead.time>>16&255),te(w,w.gzhead.time>>24&255),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(te(w,255&w.gzhead.extra.length),te(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(i.adler=f(i.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(te(w,0),te(w,0),te(w,0),te(w,0),te(w,0),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,3),w.status=D);else{var U=x+(w.w_bits-8<<4)<<8;U|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(U|=32),U+=31-U%31,w.status=D,q(w,U),w.strstart!==0&&(q(w,i.adler>>>16),q(w,65535&i.adler)),i.adler=1}if(w.status===69)if(w.gzhead.extra){for(S=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>S&&(i.adler=f(i.adler,w.pending_buf,w.pending-S,S)),T(i),S=w.pending,w.pending!==w.pending_buf_size));)te(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>S&&(i.adler=f(i.adler,w.pending_buf,w.pending-S,S)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(i.adler=f(i.adler,w.pending_buf,w.pending-S,S)),T(i),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(i.adler=f(i.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(i.adler=f(i.adler,w.pending_buf,w.pending-S,S)),T(i),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(i.adler=f(i.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&T(i),w.pending+2<=w.pending_buf_size&&(te(w,255&i.adler),te(w,i.adler>>8&255),i.adler=0,w.status=D)):w.status=D),w.pending!==0){if(T(i),i.avail_out===0)return w.last_flush=-1,a}else if(i.avail_in===0&&H(L)<=H(B)&&L!==h)return ie(i,-5);if(w.status===666&&i.avail_in!==0)return ie(i,-5);if(i.avail_in!==0||w.lookahead!==0||L!==d&&w.status!==666){var W=w.strategy===2?function(O,G){for(var K;;){if(O.lookahead===0&&(fe(O),O.lookahead===0)){if(G===d)return c;break}if(O.match_length=0,K=r._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,K&&(P(O,!1),O.strm.avail_out===0))return c}return O.insert=0,G===h?(P(O,!0),O.strm.avail_out===0?ne:Z):O.last_lit&&(P(O,!1),O.strm.avail_out===0)?c:N}(w,L):w.strategy===3?function(O,G){for(var K,V,ee,he,ae=O.window;;){if(O.lookahead<=F){if(fe(O),O.lookahead<=F&&G===d)return c;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=z&&0<O.strstart&&(V=ae[ee=O.strstart-1])===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]){he=O.strstart+F;do;while(V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&ee<he);O.match_length=F-(he-ee),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=z?(K=r._tr_tally(O,1,O.match_length-z),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(K=r._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),K&&(P(O,!1),O.strm.avail_out===0))return c}return O.insert=0,G===h?(P(O,!0),O.strm.avail_out===0?ne:Z):O.last_lit&&(P(O,!1),O.strm.avail_out===0)?c:N}(w,L):t[w.level].func(w,L);if(W!==ne&&W!==Z||(w.status=666),W===c||W===ne)return i.avail_out===0&&(w.last_flush=-1),a;if(W===N&&(L===1?r._tr_align(w):L!==5&&(r._tr_stored_block(w,0,0,!1),L===3&&(re(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),T(i),i.avail_out===0))return w.last_flush=-1,a}return L!==h?a:w.wrap<=0?1:(w.wrap===2?(te(w,255&i.adler),te(w,i.adler>>8&255),te(w,i.adler>>16&255),te(w,i.adler>>24&255),te(w,255&i.total_in),te(w,i.total_in>>8&255),te(w,i.total_in>>16&255),te(w,i.total_in>>24&255)):(q(w,i.adler>>>16),q(w,65535&i.adler)),T(i),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?a:1)},s.deflateEnd=function(i){var L;return i&&i.state?(L=i.state.status)!==k&&L!==69&&L!==73&&L!==91&&L!==103&&L!==D&&L!==666?ie(i,p):(i.state=null,L===D?ie(i,-3):a):p},s.deflateSetDictionary=function(i,L){var B,w,S,E,U,W,O,G,K=L.length;if(!i||!i.state||(E=(B=i.state).wrap)===2||E===1&&B.status!==k||B.lookahead)return p;for(E===1&&(i.adler=o(i.adler,L,K,0)),B.wrap=0,K>=B.w_size&&(E===0&&(re(B.head),B.strstart=0,B.block_start=0,B.insert=0),G=new e.Buf8(B.w_size),e.arraySet(G,L,K-B.w_size,B.w_size,0),L=G,K=B.w_size),U=i.avail_in,W=i.next_in,O=i.input,i.avail_in=K,i.next_in=0,i.input=L,fe(B);B.lookahead>=z;){for(w=B.strstart,S=B.lookahead-(z-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[w+z-1])&B.hash_mask,B.prev[w&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=w,w++,--S;);B.strstart=w,B.lookahead=z-1,fe(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=z-1,B.match_available=0,i.next_in=W,i.input=O,i.avail_in=U,B.wrap=E,a},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,l,s){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,l,s){l.exports=function(t,e){var r,o,f,v,d,h,a,p,u,y,g,x,j,A,C,I,R,M,z,F,$,k,D,c,N;r=t.state,o=t.next_in,c=t.input,f=o+(t.avail_in-5),v=t.next_out,N=t.output,d=v-(e-t.avail_out),h=v+(t.avail_out-257),a=r.dmax,p=r.wsize,u=r.whave,y=r.wnext,g=r.window,x=r.hold,j=r.bits,A=r.lencode,C=r.distcode,I=(1<<r.lenbits)-1,R=(1<<r.distbits)-1;e:do{j<15&&(x+=c[o++]<<j,j+=8,x+=c[o++]<<j,j+=8),M=A[x&I];t:for(;;){if(x>>>=z=M>>>24,j-=z,(z=M>>>16&255)===0)N[v++]=65535&M;else{if(!(16&z)){if(!(64&z)){M=A[(65535&M)+(x&(1<<z)-1)];continue t}if(32&z){r.mode=12;break e}t.msg="invalid literal/length code",r.mode=30;break e}F=65535&M,(z&=15)&&(j<z&&(x+=c[o++]<<j,j+=8),F+=x&(1<<z)-1,x>>>=z,j-=z),j<15&&(x+=c[o++]<<j,j+=8,x+=c[o++]<<j,j+=8),M=C[x&R];n:for(;;){if(x>>>=z=M>>>24,j-=z,!(16&(z=M>>>16&255))){if(!(64&z)){M=C[(65535&M)+(x&(1<<z)-1)];continue n}t.msg="invalid distance code",r.mode=30;break e}if($=65535&M,j<(z&=15)&&(x+=c[o++]<<j,(j+=8)<z&&(x+=c[o++]<<j,j+=8)),a<($+=x&(1<<z)-1)){t.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=z,j-=z,(z=v-d)<$){if(u<(z=$-z)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break e}if(D=g,(k=0)===y){if(k+=p-z,z<F){for(F-=z;N[v++]=g[k++],--z;);k=v-$,D=N}}else if(y<z){if(k+=p+y-z,(z-=y)<F){for(F-=z;N[v++]=g[k++],--z;);if(k=0,y<F){for(F-=z=y;N[v++]=g[k++],--z;);k=v-$,D=N}}}else if(k+=y-z,z<F){for(F-=z;N[v++]=g[k++],--z;);k=v-$,D=N}for(;2<F;)N[v++]=D[k++],N[v++]=D[k++],N[v++]=D[k++],F-=3;F&&(N[v++]=D[k++],1<F&&(N[v++]=D[k++]))}else{for(k=v-$;N[v++]=N[k++],N[v++]=N[k++],N[v++]=N[k++],2<(F-=3););F&&(N[v++]=N[k++],1<F&&(N[v++]=N[k++]))}break}}break}}while(o<f&&v<h);o-=F=j>>3,x&=(1<<(j-=F<<3))-1,t.next_in=o,t.next_out=v,t.avail_in=o<f?f-o+5:5-(o-f),t.avail_out=v<h?h-v+257:257-(v-h),r.hold=x,r.bits=j}},{}],49:[function(n,l,s){var t=n("../utils/common"),e=n("./adler32"),r=n("./crc32"),o=n("./inffast"),f=n("./inftrees"),v=1,d=2,h=0,a=-2,p=1,u=852,y=592;function g(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function j(k){var D;return k&&k.state?(D=k.state,k.total_in=k.total_out=D.total=0,k.msg="",D.wrap&&(k.adler=1&D.wrap),D.mode=p,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new t.Buf32(u),D.distcode=D.distdyn=new t.Buf32(y),D.sane=1,D.back=-1,h):a}function A(k){var D;return k&&k.state?((D=k.state).wsize=0,D.whave=0,D.wnext=0,j(k)):a}function C(k,D){var c,N;return k&&k.state?(N=k.state,D<0?(c=0,D=-D):(c=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?a:(N.window!==null&&N.wbits!==D&&(N.window=null),N.wrap=c,N.wbits=D,A(k))):a}function I(k,D){var c,N;return k?(N=new x,(k.state=N).window=null,(c=C(k,D))!==h&&(k.state=null),c):a}var R,M,z=!0;function F(k){if(z){var D;for(R=new t.Buf32(512),M=new t.Buf32(32),D=0;D<144;)k.lens[D++]=8;for(;D<256;)k.lens[D++]=9;for(;D<280;)k.lens[D++]=7;for(;D<288;)k.lens[D++]=8;for(f(v,k.lens,0,288,R,0,k.work,{bits:9}),D=0;D<32;)k.lens[D++]=5;f(d,k.lens,0,32,M,0,k.work,{bits:5}),z=!1}k.lencode=R,k.lenbits=9,k.distcode=M,k.distbits=5}function $(k,D,c,N){var ne,Z=k.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new t.Buf8(Z.wsize)),N>=Z.wsize?(t.arraySet(Z.window,D,c-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(N<(ne=Z.wsize-Z.wnext)&&(ne=N),t.arraySet(Z.window,D,c-N,ne,Z.wnext),(N-=ne)?(t.arraySet(Z.window,D,c-N,N,0),Z.wnext=N,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}s.inflateReset=A,s.inflateReset2=C,s.inflateResetKeep=j,s.inflateInit=function(k){return I(k,15)},s.inflateInit2=I,s.inflate=function(k,D){var c,N,ne,Z,ie,H,re,T,P,te,q,Y,fe,be,se,oe,ge,pe,Ce,ke,i,L,B,w,S=0,E=new t.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return a;(c=k.state).mode===12&&(c.mode=13),ie=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,N=k.input,H=k.avail_in,T=c.hold,P=c.bits,te=H,q=re,L=h;e:for(;;)switch(c.mode){case p:if(c.wrap===0){c.mode=13;break}for(;P<16;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(2&c.wrap&&T===35615){E[c.check=0]=255&T,E[1]=T>>>8&255,c.check=r(c.check,E,2,0),P=T=0,c.mode=2;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&T)<<8)+(T>>8))%31){k.msg="incorrect header check",c.mode=30;break}if((15&T)!=8){k.msg="unknown compression method",c.mode=30;break}if(P-=4,i=8+(15&(T>>>=4)),c.wbits===0)c.wbits=i;else if(i>c.wbits){k.msg="invalid window size",c.mode=30;break}c.dmax=1<<i,k.adler=c.check=1,c.mode=512&T?10:12,P=T=0;break;case 2:for(;P<16;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(c.flags=T,(255&c.flags)!=8){k.msg="unknown compression method",c.mode=30;break}if(57344&c.flags){k.msg="unknown header flags set",c.mode=30;break}c.head&&(c.head.text=T>>8&1),512&c.flags&&(E[0]=255&T,E[1]=T>>>8&255,c.check=r(c.check,E,2,0)),P=T=0,c.mode=3;case 3:for(;P<32;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}c.head&&(c.head.time=T),512&c.flags&&(E[0]=255&T,E[1]=T>>>8&255,E[2]=T>>>16&255,E[3]=T>>>24&255,c.check=r(c.check,E,4,0)),P=T=0,c.mode=4;case 4:for(;P<16;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}c.head&&(c.head.xflags=255&T,c.head.os=T>>8),512&c.flags&&(E[0]=255&T,E[1]=T>>>8&255,c.check=r(c.check,E,2,0)),P=T=0,c.mode=5;case 5:if(1024&c.flags){for(;P<16;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}c.length=T,c.head&&(c.head.extra_len=T),512&c.flags&&(E[0]=255&T,E[1]=T>>>8&255,c.check=r(c.check,E,2,0)),P=T=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(1024&c.flags&&(H<(Y=c.length)&&(Y=H),Y&&(c.head&&(i=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),t.arraySet(c.head.extra,N,Z,Y,i)),512&c.flags&&(c.check=r(c.check,N,Y,Z)),H-=Y,Z+=Y,c.length-=Y),c.length))break e;c.length=0,c.mode=7;case 7:if(2048&c.flags){if(H===0)break e;for(Y=0;i=N[Z+Y++],c.head&&i&&c.length<65536&&(c.head.name+=String.fromCharCode(i)),i&&Y<H;);if(512&c.flags&&(c.check=r(c.check,N,Y,Z)),H-=Y,Z+=Y,i)break e}else c.head&&(c.head.name=null);c.length=0,c.mode=8;case 8:if(4096&c.flags){if(H===0)break e;for(Y=0;i=N[Z+Y++],c.head&&i&&c.length<65536&&(c.head.comment+=String.fromCharCode(i)),i&&Y<H;);if(512&c.flags&&(c.check=r(c.check,N,Y,Z)),H-=Y,Z+=Y,i)break e}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(512&c.flags){for(;P<16;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(T!==(65535&c.check)){k.msg="header crc mismatch",c.mode=30;break}P=T=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),k.adler=c.check=0,c.mode=12;break;case 10:for(;P<32;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}k.adler=c.check=g(T),P=T=0,c.mode=11;case 11:if(c.havedict===0)return k.next_out=ie,k.avail_out=re,k.next_in=Z,k.avail_in=H,c.hold=T,c.bits=P,2;k.adler=c.check=1,c.mode=12;case 12:if(D===5||D===6)break e;case 13:if(c.last){T>>>=7&P,P-=7&P,c.mode=27;break}for(;P<3;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}switch(c.last=1&T,P-=1,3&(T>>>=1)){case 0:c.mode=14;break;case 1:if(F(c),c.mode=20,D!==6)break;T>>>=2,P-=2;break e;case 2:c.mode=17;break;case 3:k.msg="invalid block type",c.mode=30}T>>>=2,P-=2;break;case 14:for(T>>>=7&P,P-=7&P;P<32;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if((65535&T)!=(T>>>16^65535)){k.msg="invalid stored block lengths",c.mode=30;break}if(c.length=65535&T,P=T=0,c.mode=15,D===6)break e;case 15:c.mode=16;case 16:if(Y=c.length){if(H<Y&&(Y=H),re<Y&&(Y=re),Y===0)break e;t.arraySet(ne,N,Z,Y,ie),H-=Y,Z+=Y,re-=Y,ie+=Y,c.length-=Y;break}c.mode=12;break;case 17:for(;P<14;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(c.nlen=257+(31&T),T>>>=5,P-=5,c.ndist=1+(31&T),T>>>=5,P-=5,c.ncode=4+(15&T),T>>>=4,P-=4,286<c.nlen||30<c.ndist){k.msg="too many length or distance symbols",c.mode=30;break}c.have=0,c.mode=18;case 18:for(;c.have<c.ncode;){for(;P<3;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}c.lens[U[c.have++]]=7&T,T>>>=3,P-=3}for(;c.have<19;)c.lens[U[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,B={bits:c.lenbits},L=f(0,c.lens,0,19,c.lencode,0,c.work,B),c.lenbits=B.bits,L){k.msg="invalid code lengths set",c.mode=30;break}c.have=0,c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;oe=(S=c.lencode[T&(1<<c.lenbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=P);){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(ge<16)T>>>=se,P-=se,c.lens[c.have++]=ge;else{if(ge===16){for(w=se+2;P<w;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(T>>>=se,P-=se,c.have===0){k.msg="invalid bit length repeat",c.mode=30;break}i=c.lens[c.have-1],Y=3+(3&T),T>>>=2,P-=2}else if(ge===17){for(w=se+3;P<w;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}P-=se,i=0,Y=3+(7&(T>>>=se)),T>>>=3,P-=3}else{for(w=se+7;P<w;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}P-=se,i=0,Y=11+(127&(T>>>=se)),T>>>=7,P-=7}if(c.have+Y>c.nlen+c.ndist){k.msg="invalid bit length repeat",c.mode=30;break}for(;Y--;)c.lens[c.have++]=i}}if(c.mode===30)break;if(c.lens[256]===0){k.msg="invalid code -- missing end-of-block",c.mode=30;break}if(c.lenbits=9,B={bits:c.lenbits},L=f(v,c.lens,0,c.nlen,c.lencode,0,c.work,B),c.lenbits=B.bits,L){k.msg="invalid literal/lengths set",c.mode=30;break}if(c.distbits=6,c.distcode=c.distdyn,B={bits:c.distbits},L=f(d,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,B),c.distbits=B.bits,L){k.msg="invalid distances set",c.mode=30;break}if(c.mode=20,D===6)break e;case 20:c.mode=21;case 21:if(6<=H&&258<=re){k.next_out=ie,k.avail_out=re,k.next_in=Z,k.avail_in=H,c.hold=T,c.bits=P,o(k,q),ie=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,N=k.input,H=k.avail_in,T=c.hold,P=c.bits,c.mode===12&&(c.back=-1);break}for(c.back=0;oe=(S=c.lencode[T&(1<<c.lenbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=P);){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(oe&&!(240&oe)){for(pe=se,Ce=oe,ke=ge;oe=(S=c.lencode[ke+((T&(1<<pe+Ce)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(se=S>>>24)<=P);){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}T>>>=pe,P-=pe,c.back+=pe}if(T>>>=se,P-=se,c.back+=se,c.length=ge,oe===0){c.mode=26;break}if(32&oe){c.back=-1,c.mode=12;break}if(64&oe){k.msg="invalid literal/length code",c.mode=30;break}c.extra=15&oe,c.mode=22;case 22:if(c.extra){for(w=c.extra;P<w;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}c.length+=T&(1<<c.extra)-1,T>>>=c.extra,P-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=23;case 23:for(;oe=(S=c.distcode[T&(1<<c.distbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=P);){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(!(240&oe)){for(pe=se,Ce=oe,ke=ge;oe=(S=c.distcode[ke+((T&(1<<pe+Ce)-1)>>pe)])>>>16&255,ge=65535&S,!(pe+(se=S>>>24)<=P);){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}T>>>=pe,P-=pe,c.back+=pe}if(T>>>=se,P-=se,c.back+=se,64&oe){k.msg="invalid distance code",c.mode=30;break}c.offset=ge,c.extra=15&oe,c.mode=24;case 24:if(c.extra){for(w=c.extra;P<w;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}c.offset+=T&(1<<c.extra)-1,T>>>=c.extra,P-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){k.msg="invalid distance too far back",c.mode=30;break}c.mode=25;case 25:if(re===0)break e;if(Y=q-re,c.offset>Y){if((Y=c.offset-Y)>c.whave&&c.sane){k.msg="invalid distance too far back",c.mode=30;break}fe=Y>c.wnext?(Y-=c.wnext,c.wsize-Y):c.wnext-Y,Y>c.length&&(Y=c.length),be=c.window}else be=ne,fe=ie-c.offset,Y=c.length;for(re<Y&&(Y=re),re-=Y,c.length-=Y;ne[ie++]=be[fe++],--Y;);c.length===0&&(c.mode=21);break;case 26:if(re===0)break e;ne[ie++]=c.length,re--,c.mode=21;break;case 27:if(c.wrap){for(;P<32;){if(H===0)break e;H--,T|=N[Z++]<<P,P+=8}if(q-=re,k.total_out+=q,c.total+=q,q&&(k.adler=c.check=c.flags?r(c.check,ne,q,ie-q):e(c.check,ne,q,ie-q)),q=re,(c.flags?T:g(T))!==c.check){k.msg="incorrect data check",c.mode=30;break}P=T=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;P<32;){if(H===0)break e;H--,T+=N[Z++]<<P,P+=8}if(T!==(4294967295&c.total)){k.msg="incorrect length check",c.mode=30;break}P=T=0}c.mode=29;case 29:L=1;break e;case 30:L=-3;break e;case 31:return-4;case 32:default:return a}return k.next_out=ie,k.avail_out=re,k.next_in=Z,k.avail_in=H,c.hold=T,c.bits=P,(c.wsize||q!==k.avail_out&&c.mode<30&&(c.mode<27||D!==4))&&$(k,k.output,k.next_out,q-k.avail_out)?(c.mode=31,-4):(te-=k.avail_in,q-=k.avail_out,k.total_in+=te,k.total_out+=q,c.total+=q,c.wrap&&q&&(k.adler=c.check=c.flags?r(c.check,ne,q,k.next_out-q):e(c.check,ne,q,k.next_out-q)),k.data_type=c.bits+(c.last?64:0)+(c.mode===12?128:0)+(c.mode===20||c.mode===15?256:0),(te==0&&q===0||D===4)&&L===h&&(L=-5),L)},s.inflateEnd=function(k){if(!k||!k.state)return a;var D=k.state;return D.window&&(D.window=null),k.state=null,h},s.inflateGetHeader=function(k,D){var c;return k&&k.state&&2&(c=k.state).wrap?((c.head=D).done=!1,h):a},s.inflateSetDictionary=function(k,D){var c,N=D.length;return k&&k.state?(c=k.state).wrap!==0&&c.mode!==11?a:c.mode===11&&e(1,D,N,0)!==c.check?-3:$(k,D,N,N)?(c.mode=31,-4):(c.havedict=1,h):a},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,l,s){var t=n("../utils/common"),e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(v,d,h,a,p,u,y,g){var x,j,A,C,I,R,M,z,F,$=g.bits,k=0,D=0,c=0,N=0,ne=0,Z=0,ie=0,H=0,re=0,T=0,P=null,te=0,q=new t.Buf16(16),Y=new t.Buf16(16),fe=null,be=0;for(k=0;k<=15;k++)q[k]=0;for(D=0;D<a;D++)q[d[h+D]]++;for(ne=$,N=15;1<=N&&q[N]===0;N--);if(N<ne&&(ne=N),N===0)return p[u++]=20971520,p[u++]=20971520,g.bits=1,0;for(c=1;c<N&&q[c]===0;c++);for(ne<c&&(ne=c),k=H=1;k<=15;k++)if(H<<=1,(H-=q[k])<0)return-1;if(0<H&&(v===0||N!==1))return-1;for(Y[1]=0,k=1;k<15;k++)Y[k+1]=Y[k]+q[k];for(D=0;D<a;D++)d[h+D]!==0&&(y[Y[d[h+D]]++]=D);if(R=v===0?(P=fe=y,19):v===1?(P=e,te-=257,fe=r,be-=257,256):(P=o,fe=f,-1),k=c,I=u,ie=D=T=0,A=-1,C=(re=1<<(Z=ne))-1,v===1&&852<re||v===2&&592<re)return 1;for(;;){for(M=k-ie,F=y[D]<R?(z=0,y[D]):y[D]>R?(z=fe[be+y[D]],P[te+y[D]]):(z=96,0),x=1<<k-ie,c=j=1<<Z;p[I+(T>>ie)+(j-=x)]=M<<24|z<<16|F|0,j!==0;);for(x=1<<k-1;T&x;)x>>=1;if(x!==0?(T&=x-1,T+=x):T=0,D++,--q[k]==0){if(k===N)break;k=d[h+y[D]]}if(ne<k&&(T&C)!==A){for(ie===0&&(ie=ne),I+=c,H=1<<(Z=k-ie);Z+ie<N&&!((H-=q[Z+ie])<=0);)Z++,H<<=1;if(re+=1<<Z,v===1&&852<re||v===2&&592<re)return 1;p[A=T&C]=ne<<24|Z<<16|I-u|0}}return T!==0&&(p[I+T]=k-ie<<24|64<<16|0),g.bits=ne,0}},{"../utils/common":41}],51:[function(n,l,s){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,l,s){var t=n("../utils/common"),e=0,r=1;function o(S){for(var E=S.length;0<=--E;)S[E]=0}var f=0,v=29,d=256,h=d+1+v,a=30,p=19,u=2*h+1,y=15,g=16,x=7,j=256,A=16,C=17,I=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(h+2));o($);var k=new Array(2*a);o(k);var D=new Array(512);o(D);var c=new Array(256);o(c);var N=new Array(v);o(N);var ne,Z,ie,H=new Array(a);function re(S,E,U,W,O){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=O,this.has_stree=S&&S.length}function T(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function P(S){return S<256?D[S]:D[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function q(S,E,U){S.bi_valid>g-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>g-S.bi_valid,S.bi_valid+=U-g):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function Y(S,E,U){q(S,U[2*E],U[2*E+1])}function fe(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function be(S,E,U){var W,O,G=new Array(y+1),K=0;for(W=1;W<=y;W++)G[W]=K=K+U[W-1]<<1;for(O=0;O<=E;O++){var V=S[2*O+1];V!==0&&(S[2*O]=fe(G[V]++,V))}}function se(S){var E;for(E=0;E<h;E++)S.dyn_ltree[2*E]=0;for(E=0;E<a;E++)S.dyn_dtree[2*E]=0;for(E=0;E<p;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*j]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function oe(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ge(S,E,U,W){var O=2*E,G=2*U;return S[O]<S[G]||S[O]===S[G]&&W[E]<=W[U]}function pe(S,E,U){for(var W=S.heap[U],O=U<<1;O<=S.heap_len&&(O<S.heap_len&&ge(E,S.heap[O+1],S.heap[O],S.depth)&&O++,!ge(E,W,S.heap[O],S.depth));)S.heap[U]=S.heap[O],U=O,O<<=1;S.heap[U]=W}function Ce(S,E,U){var W,O,G,K,V=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*V]<<8|S.pending_buf[S.d_buf+2*V+1],O=S.pending_buf[S.l_buf+V],V++,W===0?Y(S,O,E):(Y(S,(G=c[O])+d+1,E),(K=R[G])!==0&&q(S,O-=N[G],K),Y(S,G=P(--W),U),(K=M[G])!==0&&q(S,W-=H[G],K)),V<S.last_lit;);Y(S,j,E)}function ke(S,E){var U,W,O,G=E.dyn_tree,K=E.stat_desc.static_tree,V=E.stat_desc.has_stree,ee=E.stat_desc.elems,he=-1;for(S.heap_len=0,S.heap_max=u,U=0;U<ee;U++)G[2*U]!==0?(S.heap[++S.heap_len]=he=U,S.depth[U]=0):G[2*U+1]=0;for(;S.heap_len<2;)G[2*(O=S.heap[++S.heap_len]=he<2?++he:0)]=1,S.depth[O]=0,S.opt_len--,V&&(S.static_len-=K[2*O+1]);for(E.max_code=he,U=S.heap_len>>1;1<=U;U--)pe(S,G,U);for(O=ee;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],pe(S,G,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,G[2*O]=G[2*U]+G[2*W],S.depth[O]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,G[2*U+1]=G[2*W+1]=O,S.heap[1]=O++,pe(S,G,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,xe){var We,je,Ze,me,rt,pt,Ae=xe.dyn_tree,Dt=xe.max_code,pn=xe.stat_desc.static_tree,mn=xe.stat_desc.has_stree,gn=xe.stat_desc.extra_bits,Mt=xe.stat_desc.extra_base,He=xe.stat_desc.max_length,it=0;for(me=0;me<=y;me++)ae.bl_count[me]=0;for(Ae[2*ae.heap[ae.heap_max]+1]=0,We=ae.heap_max+1;We<u;We++)He<(me=Ae[2*Ae[2*(je=ae.heap[We])+1]+1]+1)&&(me=He,it++),Ae[2*je+1]=me,Dt<je||(ae.bl_count[me]++,rt=0,Mt<=je&&(rt=gn[je-Mt]),pt=Ae[2*je],ae.opt_len+=pt*(me+rt),mn&&(ae.static_len+=pt*(pn[2*je+1]+rt)));if(it!==0){do{for(me=He-1;ae.bl_count[me]===0;)me--;ae.bl_count[me]--,ae.bl_count[me+1]+=2,ae.bl_count[He]--,it-=2}while(0<it);for(me=He;me!==0;me--)for(je=ae.bl_count[me];je!==0;)Dt<(Ze=ae.heap[--We])||(Ae[2*Ze+1]!==me&&(ae.opt_len+=(me-Ae[2*Ze+1])*Ae[2*Ze],Ae[2*Ze+1]=me),je--)}}(S,E),be(G,he,S.bl_count)}function i(S,E,U){var W,O,G=-1,K=E[1],V=0,ee=7,he=4;for(K===0&&(ee=138,he=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)O=K,K=E[2*(W+1)+1],++V<ee&&O===K||(V<he?S.bl_tree[2*O]+=V:O!==0?(O!==G&&S.bl_tree[2*O]++,S.bl_tree[2*A]++):V<=10?S.bl_tree[2*C]++:S.bl_tree[2*I]++,G=O,he=(V=0)===K?(ee=138,3):O===K?(ee=6,3):(ee=7,4))}function L(S,E,U){var W,O,G=-1,K=E[1],V=0,ee=7,he=4;for(K===0&&(ee=138,he=3),W=0;W<=U;W++)if(O=K,K=E[2*(W+1)+1],!(++V<ee&&O===K)){if(V<he)for(;Y(S,O,S.bl_tree),--V!=0;);else O!==0?(O!==G&&(Y(S,O,S.bl_tree),V--),Y(S,A,S.bl_tree),q(S,V-3,2)):V<=10?(Y(S,C,S.bl_tree),q(S,V-3,3)):(Y(S,I,S.bl_tree),q(S,V-11,7));G=O,he=(V=0)===K?(ee=138,3):O===K?(ee=6,3):(ee=7,4)}}o(H);var B=!1;function w(S,E,U,W){q(S,(f<<1)+(W?1:0),3),function(O,G,K,V){oe(O),V&&(te(O,K),te(O,~K)),t.arraySet(O.pending_buf,O.window,G,K,O.pending),O.pending+=K}(S,E,U,!0)}s._tr_init=function(S){B||(function(){var E,U,W,O,G,K=new Array(y+1);for(O=W=0;O<v-1;O++)for(N[O]=W,E=0;E<1<<R[O];E++)c[W++]=O;for(c[W-1]=O,O=G=0;O<16;O++)for(H[O]=G,E=0;E<1<<M[O];E++)D[G++]=O;for(G>>=7;O<a;O++)for(H[O]=G<<7,E=0;E<1<<M[O]-7;E++)D[256+G++]=O;for(U=0;U<=y;U++)K[U]=0;for(E=0;E<=143;)$[2*E+1]=8,E++,K[8]++;for(;E<=255;)$[2*E+1]=9,E++,K[9]++;for(;E<=279;)$[2*E+1]=7,E++,K[7]++;for(;E<=287;)$[2*E+1]=8,E++,K[8]++;for(be($,h+1,K),E=0;E<a;E++)k[2*E+1]=5,k[2*E]=fe(E,5);ne=new re($,R,d+1,h,y),Z=new re(k,M,0,a,y),ie=new re(new Array(0),z,0,p,x)}(),B=!0),S.l_desc=new T(S.dyn_ltree,ne),S.d_desc=new T(S.dyn_dtree,Z),S.bl_desc=new T(S.bl_tree,ie),S.bi_buf=0,S.bi_valid=0,se(S)},s._tr_stored_block=w,s._tr_flush_block=function(S,E,U,W){var O,G,K=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(V){var ee,he=4093624447;for(ee=0;ee<=31;ee++,he>>>=1)if(1&he&&V.dyn_ltree[2*ee]!==0)return e;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return r;for(ee=32;ee<d;ee++)if(V.dyn_ltree[2*ee]!==0)return r;return e}(S)),ke(S,S.l_desc),ke(S,S.d_desc),K=function(V){var ee;for(i(V,V.dyn_ltree,V.l_desc.max_code),i(V,V.dyn_dtree,V.d_desc.max_code),ke(V,V.bl_desc),ee=p-1;3<=ee&&V.bl_tree[2*F[ee]+1]===0;ee--);return V.opt_len+=3*(ee+1)+5+5+4,ee}(S),O=S.opt_len+3+7>>>3,(G=S.static_len+3+7>>>3)<=O&&(O=G)):O=G=U+5,U+4<=O&&E!==-1?w(S,E,U,W):S.strategy===4||G===O?(q(S,2+(W?1:0),3),Ce(S,$,k)):(q(S,4+(W?1:0),3),function(V,ee,he,ae){var xe;for(q(V,ee-257,5),q(V,he-1,5),q(V,ae-4,4),xe=0;xe<ae;xe++)q(V,V.bl_tree[2*F[xe]+1],3);L(V,V.dyn_ltree,ee-1),L(V,V.dyn_dtree,he-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,K+1),Ce(S,S.dyn_ltree,S.dyn_dtree)),se(S),W&&oe(S)},s._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(c[U]+d+1)]++,S.dyn_dtree[2*P(E)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){q(S,2,3),Y(S,j,$),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,l,s){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,l,s){(function(t){(function(e,r){if(!e.setImmediate){var o,f,v,d,h=1,a={},p=!1,u=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e);y=y&&y.setTimeout?y:e,o={}.toString.call(e.process)==="[object process]"?function(A){process.nextTick(function(){x(A)})}:function(){if(e.postMessage&&!e.importScripts){var A=!0,C=e.onmessage;return e.onmessage=function(){A=!1},e.postMessage("","*"),e.onmessage=C,A}}()?(d="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",j,!1):e.attachEvent("onmessage",j),function(A){e.postMessage(d+A,"*")}):e.MessageChannel?((v=new MessageChannel).port1.onmessage=function(A){x(A.data)},function(A){v.port2.postMessage(A)}):u&&"onreadystatechange"in u.createElement("script")?(f=u.documentElement,function(A){var C=u.createElement("script");C.onreadystatechange=function(){x(A),C.onreadystatechange=null,f.removeChild(C),C=null},f.appendChild(C)}):function(A){setTimeout(x,0,A)},y.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),I=0;I<C.length;I++)C[I]=arguments[I+1];var R={callback:A,args:C};return a[h]=R,o(h),h++},y.clearImmediate=g}function g(A){delete a[A]}function x(A){if(p)setTimeout(x,0,A);else{var C=a[A];if(C){p=!0;try{(function(I){var R=I.callback,M=I.args;switch(M.length){case 0:R();break;case 1:R(M[0]);break;case 2:R(M[0],M[1]);break;case 3:R(M[0],M[1],M[2]);break;default:R.apply(r,M)}})(C)}finally{g(A),p=!1}}}}function j(A){A.source===e&&typeof A.data=="string"&&A.data.indexOf(d)===0&&x(+A.data.slice(d.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof st<"u"?st:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(un);var Ui=un.exports;const Wi=An(Ui),fn=/url\("([\S*]+)"\)/,Zi=async(m,_,n,l,s)=>{var o,f,v;const t=document.querySelector("svg#".concat(m));if(!t)throw new Error("Requested canvas SVG element not found");const e=Number((o=t.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:o[0]),r=t.cloneNode(!0);if(r.setAttribute("height",(e*(s||100)/100).toString()),r.style.setProperty("all","initial"),["share"].map(d=>{var h;return[...((h=[...document.querySelectorAll("link")].filter(a=>a.id==="css_"+d)[0])==null?void 0:h.sheet).cssRules].map(a=>a.cssText).join(" ")}).forEach(d=>{const h=document.createElement("style");h.textContent=d,r.prepend(h)}),(f=r.querySelector("rect#canvas-border"))==null||f.setAttribute("stroke",l?"black":"none"),(v=r.querySelector("rect#canvas-bg"))==null||v.setAttribute("fill",n?"none":"white"),_===Q.MTR)try{const d=await Vi(r),h=document.createElement("style");h.textContent=d.join("\n"),r.prepend(h)}catch(d){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(d)}return r},Hi=m=>new Promise(_=>{const n=new FileReader;n.onloadend=()=>_(n.result),n.readAsDataURL(m)}),Gi=(m,_)=>m.find(n=>{const l=n.style;return l.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===_.family&&l.getPropertyValue("unicode-range")===_.unicodeRange}),Vi=async m=>{var t,e,r,o;const _=Array.from(new Set([...m.querySelectorAll(".rmg-name__zh"),...m.querySelectorAll(".rmg-name__en")].map(f=>f.innerHTML).join("").replace(/\s/g,""))).join(""),n=await document.fonts.load("80px GenYoMin TW, Vegur",_),l=Array.from(((o=((r=(e=(t=document.querySelector("link#css_share"))==null?void 0:t.sheet)==null?void 0:e.cssRules)==null?void 0:r[0]).styleSheet)==null?void 0:o.cssRules)||[]),s=n.reduce((f,v)=>{const d=Gi(l,v);return d?f.find(a=>{const p=a.style,u=d.style;return p.getPropertyValue("font-family")===u.getPropertyValue("font-family")&&p.getPropertyValue("unicode-range")===u.getPropertyValue("unicode-range")})?f:f.concat(d):f},[]);return await Promise.all(s.map(async f=>{try{const v=await fetch($i(f)),d=await Hi(await v.blob());return f.cssText.replace(fn,"url('".concat(d,"')"))}catch(v){return console.error(v),""}}))},$i=m=>{var n;return"/styles/"+((n=m.style.src.match(fn))==null?void 0:n[1])},Yi=async(m,_,n)=>{const l=m.viewBox.baseVal.width,s=m.viewBox.baseVal.height,t=document.querySelectorAll("canvas")[0];t.width=Number(l)*window.devicePixelRatio*_,t.height=Number(s)*window.devicePixelRatio*_,m.setAttribute("width",t.width.toString()),m.setAttribute("height",t.height.toString());const e=t.getContext("2d");return e.clearRect(0,0,t.width,t.height),m.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(r=>r.setAttribute("font-size","8.5px")),m.querySelectorAll("text, tspan").forEach(r=>{const o=window.getComputedStyle(r);r.setAttribute("font-family",o.fontFamily),r.setAttribute("fill",o.fill),r.setAttribute("dominant-baseline",o.dominantBaseline),r.setAttribute("text-anchor",o.textAnchor||"")}),new Promise((r,o)=>{const f=new Image;f.onload=()=>{setTimeout(()=>{e.drawImage(f,0,0,t.width,t.height),t.toBlob(v=>{v?r(v):o("Canvas blob is null")},"image/png")},n?2e3:0)},f.onerror=o,f.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(m.outerHTML)))})};function qi(m){const{isOpen:_,onClose:n}=m,{t:l}=le(),s=ue(),[t,e]=X.useState(""),[r,o]=X.useState(!1),[f,v]=X.useState(!1),[d,h]=X.useState(100),[a,p]=X.useState("png"),u=J(z=>z.app.canvasToShow),{style:y,stn_list:g,current_stn_idx:x,line_name:j}=J(z=>z.param);X.useEffect(()=>{t!==""&&!u.includes(t)&&e("")},[u]);const A=Pt[y].reduce((z,F)=>u.includes(F)?{...z,[F]:l("CanvasType."+F)}:{...z},{"":l("DownloadModal.pleaseSelect")}),C=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((z,F)=>({...z,[F]:"".concat(F,"%")}),{}),I={png:l("DownloadModal.png"),svg:l("DownloadModal.svg")},R=[{type:"select",label:l("DownloadModal.canvas"),value:t,options:A,disabledOptions:[""],onChange:z=>e(z),minW:"full"},{type:"switch",label:l("DownloadModal.transparent"),isChecked:r,onChange:o,oneLine:!0,minW:"full"},{type:"switch",label:l("DownloadModal.showBorder"),isChecked:f,onChange:v,oneLine:!0,minW:"full"},{type:"select",label:l("DownloadModal.scale"),value:d,options:C,onChange:z=>h(z)},{type:"select",label:l("DownloadModal.format"),value:a,options:I,onChange:z=>p(z)}],M=async z=>{s(Gt(0));const F=z==="current"?[x]:Object.keys(g).filter(k=>!["linestart","lineend"].includes(k)),$=new Wi;for(const k in F){s(Gt((Number(k)+1)/F.length*100));const D=F[k];s(kt(D)),await Wr(500);const c=await Zi(t,y,r,f,d);document.body.appendChild(c);const N="rmg.".concat(D,".").concat(g[D].name[0],".").concat(g[D].name[1]).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(a==="png"){const ne=Zr()&&k==="0",Z=await Yi(c,d/100,ne);F.length>1?$.file("".concat(N,".png"),Z):$t("".concat(N,".png"),Z)}else if(a==="svg"){c.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(c.outerHTML)));F.length>1?$.file("".concat(N,".svg"),ne.split("base64,")[1],{base64:!0}):on(N+".svg","image/svg+xml",c.outerHTML)}document.body.removeChild(c)}if(F.length>1){const k=await $.generateAsync({type:"blob"}),D="rmg.".concat(j[0],".").concat(j[1],".zip").replaceAll(" ","_");$t(D,k)}ce.event(ve.DOWNLOAD_IMAGES,{canvasToDownload:t,style:y,option:z,format:a}),s(kt(x)),s(jr()),n()};return b.jsxs(Ke,{isOpen:_,onClose:n,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[b.jsx(Qe,{children:l("DownloadModal.title")}),b.jsx(et,{}),b.jsx(tt,{children:b.jsx(_e,{fields:R})}),b.jsx(nt,{children:b.jsxs(Oe,{children:[b.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("current"),isDisabled:!t,children:l("DownloadModal.downloadOne")}),y!==Q.GZMTR&&b.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>M("all"),isDisabled:!t,children:l("DownloadModal.downloadAll")})]})})]})]})}function Ki(){const{t:m}=le(),[_,n]=X.useState(!1),{paramConfig:l}=J(e=>e.app),s=J(e=>e.param),t=()=>{const e=Hr(s);on("RMG_".concat(l==null?void 0:l.id,".json"),"application/json",JSON.stringify(e)),ce.event(ve.DOWNLOAD_PARAM,{style:s.style})};return b.jsxs(bn,{children:[b.jsx(yn,{as:de,variant:"ghost",size:"sm",rightIcon:b.jsx(Ar,{}),children:m("DownloadActions.downloads")}),b.jsxs(vn,{children:[b.jsx(Nt,{onClick:t,children:m("DownloadActions.configFile")}),b.jsx(Nt,{onClick:()=>n(!0),children:m("DownloadActions.images")})]}),b.jsx(qi,{isOpen:_,onClose:()=>n(!1)})]})}function ft(){const[m,_]=En();return[m,l=>{if(_(l),Object.keys(l)){const s=new URLSearchParams(l);ce.updateUrl("/rmg/#/?"+s)}else ce.updateUrl("/rmg/#/")}]}function Xi(){const{t:m}=le(),_=zt(),[,n]=ft(),l=()=>{_(Fe(De.CLOSE)),_(jt(void 0)),n({})};return b.jsxs(Oe,{ml:"auto",w:"fit-content",children:[b.jsx(de,{variant:"ghost",size:"sm",leftIcon:b.jsx(Er,{}),onClick:l,children:m("All projects")}),b.jsx(Ki,{}),b.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:b.jsx(Or,{}),onClick:()=>_(Fe(De.STYLE)),children:m("HeaderActions.editStyle")})]})}function Ji(){const{t:m}=le(),_=ue(),{canvasToShow:n,canvasScale:l}=J(f=>f.app),s=J(f=>f.param.style),t=Object.values(Q).reduce((f,v)=>({...f,[v]:m("RmgStyle."+v)}),{}),e=Pt[s].map(f=>({label:m("CanvasType."+f),value:f})),r=f=>{_(Dr(f))},o=[{type:"select",label:m("Style"),value:s,options:t,onChange:f=>r(f)},{type:"custom",label:m("View"),component:b.jsx(Rr,{displayValue:m("Select canvas"),selections:e,defaultValue:n,onChange:f=>_(zr(f))})},{type:"slider",label:m("Canvas scale"),value:l,min:.1,max:2,step:.01,onChange:f=>_(Pr(f)),leftIcon:b.jsx(Tr,{}),rightIcon:b.jsx(Ir,{})}];return b.jsxs(Br,{children:[b.jsx(_e,{fields:o,minW:160}),b.jsx(Xi,{})]})}const Qi=m=>{switch(m){case Q.MTR:return["hongkong","twl","#E2231A",ze.white];case Q.GZMTR:return["guangzhou","gz1","#F3D03E",ze.black];case Q.SHMetro:return["shanghai","sh1","#E4002B",ze.white];default:return["other","other","#AAAAAA",ze.white]}},es=m=>{switch(m){case"zh-Hans":return["1号线","Line 1"];case"zh-Hant":return["荃灣綫","Tsuen Wan Line"];default:return["地鐵線","Metro Line"]}},Ge=m=>({name:["未命名 "+m,"Unnamed "+m],num:"00",services:[St.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ne.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355}),ts=(m,_)=>{const n=Ge("linestart");n.name=["LEFT END","LEFT END"];const l=Ge("lineend");l.name=["RIGHT END","RIGHT END"];const s=Me(6),t=Ge(s);t.num="01";const e=Me(6),r=Ge(e);return r.num="02",n.children=[s],t.parents=["linestart"],t.children=[e],r.parents=[s],r.children=["lineend"],l.parents=[e],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:m,y_pc:50,padding:10,branchSpacingPct:33,direction:Ne.left,platform_num:"1",theme:Qi(m),line_name:es(_),current_stn_idx:e,stn_list:{linestart:n,[s]:t,[e]:r,lineend:l},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:m===Q.SHMetro?nn.sh:tn.gz1,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}},Ye=(m,_,n,l)=>(s,t)=>{var f,v,d,h,a,p,u,y,g,x,j,A,C,I;const e=t().param.stn_list;let r=Me(6);for(;r in e;)r=Me(6);const o=Ge(r);if(m!=="new"){const R={...e,[_]:{...e[_],children:e[_].children.map(M=>M===n?r:M),branch:{left:(f=e[_].branch)==null?void 0:f.left,right:((d=(v=e[_].branch)==null?void 0:v.right)==null?void 0:d[1])===n?(a=(h=e[_].branch)==null?void 0:h.right)==null?void 0:a.with(1,r):(p=e[_].branch)==null?void 0:p.right}},[n]:{...e[n],parents:e[n].parents.map(M=>M===_?r:M),branch:{left:((y=(u=e[n].branch)==null?void 0:u.left)==null?void 0:y[1])===_?(x=(g=e[n].branch)==null?void 0:g.left)==null?void 0:x.with(1,r):(j=e[n].branch)==null?void 0:j.left,right:(A=e[n].branch)==null?void 0:A.right}},[r]:{...o,parents:[_],children:[n]}};return s(Be(R)),r}else{if(!l)return!1;const R={...e,[_]:{...e[_],children:l==="upper"?[r,e[_].children[0]]:[e[_].children[0],r],branch:{left:(C=e[_].branch)==null?void 0:C.left,right:[ct.through,r]}},[n]:{...e[n],parents:l==="upper"?[r,e[n].parents[0]]:[e[n].parents[0],r],branch:{left:[ct.through,r],right:(I=e[n].branch)==null?void 0:I.right}},[r]:{...o,parents:[_],children:[n]}};return s(Be(R)),r}},ns=(m,_,n)=>(l,s)=>{const e=s().helper.branches[m];if(e!=null&&e.length)if(_==="before"){const r=e[e.indexOf(n)-1];return l(Ye(m.toString(),r,n))}else{const r=e[e.indexOf(n)+1];return l(Ye(m.toString(),n,r))}else return!1},rs=()=>(m,_)=>{const n=_().param.stn_list;return _().helper.branches[0].filter(s=>{const t=n[s].parents.length+n[s].children.length===4,e=It(s,n)===0;return!t&&e})},qt=(m,_)=>(n,l)=>{const s=l().param.stn_list,t=l().helper.branches;return!t[0].includes(m)||!t[0].includes(_)?"Branch should end at main line":t[0].indexOf(m)>=t[0].indexOf(_)?"Not in correct ordering":m==="linestart"&&_==="lineend"?"Should not be parallel to main line":m==="linestart"&&t[0].indexOf(_)===1?"Branch should not be open jaw from the first station":_==="lineend"&&t[0].indexOf(m)===t[0].length-2?"Branch should not be open jaw from the last station":s[m].children.length>1||s[_].parents.length>1?"Branch already exist":t.slice(1).some(o=>o.slice(1,-1).includes(m)||o.slice(1,-1).includes(_))?"Cannot branch out from existing branch":t[0].slice(t[0].indexOf(m)+1,t[0].indexOf(_)).every(o=>s[o].parents.length===1&&s[o].children.length===1)?"":"One or more stations between both ends are branching out"};function is(m){var I,R;const{isOpen:_,onClose:n}=m,{t:l}=le(),s=ue(),t=J(M=>M.app.selectedBranch),{style:e,stn_list:r}=J(M=>M.param),o=J(M=>M.helper.branches),[f,v]=X.useState(t),[d,h]=X.useState("before"),[a,p]=X.useState(""),[u,y]=X.useState(!1);X.useEffect(()=>{v(t)},[t]),X.useEffect(()=>{_||y(!1)},[_]);const g=(R=(I=o[Number(f)])==null?void 0:I.slice(1,-1))!=null?R:[],x=M=>M.reduce((z,F)=>{var $;return{...z,[F]:($=r[F])==null?void 0:$.name.join(" - ")}},{"":l("AddStationModal.pleaseSelect")}),j=[{type:"select",label:l("AddStationModal.where"),value:f,options:{...o.reduce((M,z,F)=>({...M,[F]:F===0?l("AddStationModal.main"):e!==Q.SHMetro||!Ue(z,r)?l("AddStationModal.branch")+" "+F:l("AddStationModal.external")+" "+F}),{})},onChange:M=>A(M),minW:"full"},{type:"select",label:l("AddStationModal.preposition"),value:d,options:{before:l("AddStationModal.before"),after:l("AddStationModal.after")},onChange:M=>h(M)},{type:"select",label:l("AddStationModal.pivot"),value:a,options:x(g),disabledOptions:[""],onChange:M=>p(M)}],A=M=>{v(M),p("")},C=()=>{const M=s(ns(f,d,a));M?(n(),s(rn(M)),s(Fe(De.STATION))):(console.log("false here"),y(!0)),ce.event(ve.ADD_STATION,{style:e,branchIndex:f,success:M})};return b.jsxs(Ke,{isOpen:_,onClose:n,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[u&&b.jsxs(dt,{status:"error",variant:"solid",size:"xs",children:[b.jsx(ht,{}),l("AddStationModal.error")]}),b.jsxs(Se,{position:"relative",children:[b.jsx(Qe,{children:l("AddStationModal.title")}),b.jsx(et,{})]}),b.jsx(tt,{children:b.jsx(_e,{fields:j})}),b.jsx(nt,{children:b.jsx(de,{colorScheme:"primary",onClick:C,isDisabled:!a,children:l("Confirm")})})]})]})}function ss(m){const{isOpen:_,onClose:n}=m,{t:l}=le(),s=ue(),[t,e]=X.useState("new"),[r,o]=X.useState(""),[f,v]=X.useState(""),[d,h]=X.useState("upper"),[a,p]=X.useState(""),[u,y]=X.useState(""),{style:g,stn_list:x}=J($=>$.param);X.useEffect(()=>{_||(e("new"),o(""),v(""))},[_]);const A=($=>$.reduce((k,D)=>{var c;return{...k,[D]:D==="linestart"?"(".concat(l("LEFT END"),")"):D==="lineend"?"(".concat(l("RIGHT END"),")"):(c=x[D])==null?void 0:c.name.join(" - ")}},{"":l("Please select...")}))(s(rs())),C=[{type:"select",label:l("NewBranchModal.where"),value:t,options:{new:l("NewBranchModal.new"),ext:l("NewBranchModal.ext")},disabledOptions:g===Q.SHMetro?[]:["ext"],onChange:$=>I($),minW:"full"},{type:"select",label:l("NewBranchModal.from"),value:r,options:A,disabledOptions:[""],onChange:$=>R($),isInvalid:!!a},{type:"select",label:l("NewBranchModal.to"),value:f,options:A,disabledOptions:[""],onChange:$=>M($),isInvalid:!!u},{type:"select",label:l("NewBranchModal.position"),value:d,options:{upper:l("NewBranchModal.upper"),lower:l("NewBranchModal.lower")},onChange:$=>h($),minW:"full",hidden:t!=="new"||g===Q.SHMetro}],I=$=>{e($),o(""),v(""),p(""),y("")},R=$=>{o($),p(""),$&&f&&y(s(qt($,f)))},M=$=>{v($),y(""),r&&$&&p(s(qt(r,$)))},z=()=>{let $;t==="ext"?$=s(Ye("new",r,f,"lower")):g===Q.SHMetro?$=s(Ye("new",r,f,"upper")):$=s(Ye("new",r,f,d)),$&&(n(),ce.event(ve.ADD_BRANCH,{style:g,where:t}))},F=!!(!r||!f||a||u);return b.jsxs(Ke,{isOpen:_,onClose:n,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[b.jsx(Qe,{children:l("NewBranchModal.title")}),b.jsx(et,{}),b.jsx(tt,{children:b.jsx(_e,{fields:C})}),b.jsx(nt,{children:b.jsx(de,{colorScheme:"primary",title:F?a||u:l("Confirm"),onClick:z,isDisabled:F,children:l("Confirm")})})]})]})}const as=X.lazy(()=>ot(()=>import("./station-ag-grid-5b6e8e21.js"),["assets/station-ag-grid-5b6e8e21.js","assets/chakra-ba5f36b3.js","assets/react-4978cfa7.js","assets/index-22062bff.js","assets/index-46ec5c41.css","assets/ag-grid-63a0287c.js","assets/param-manager-utils-48fe8f69.js"]));function os(){const{t:m}=le(),_=ue(),[n,l]=X.useState(!1),[s,t]=X.useState(!1),e=J(d=>d.app.selectedBranch),{style:r,stn_list:o}=J(d=>d.param),f=J(d=>d.helper.branches),v=()=>{_(Fe(De.BRANCH))};return b.jsxs(Se,{flex:1,overflow:"hidden",children:[b.jsxs(Sn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:e,onChange:d=>_(Mr(d)),children:[b.jsxs(xn,{children:[f.map((d,h)=>h===0?b.jsx(mt,{children:m("GridTabs.main")},h):r!==Q.SHMetro||!Ue(d,o)?b.jsx(mt,{children:m("GridTabs.branch")+" "+h},h):b.jsx(mt,{children:m("GridTabs.external")+" "+h},h)),b.jsx(Pe,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>t(!0),icon:b.jsx(Re,{})}),b.jsxs(Oe,{marginLeft:"auto",marginRight:1,children:[b.jsx(de,{variant:"outline",size:"xs",leftIcon:b.jsx(Re,{}),onClick:()=>l(!0),children:m("GridTabs.addStation")}),b.jsx(de,{size:"xs",colorScheme:"primary",onClick:v,children:m("GridTabs.editLine")})]})]}),b.jsx(wn,{flex:1,overflowY:"auto",children:f.map((d,h)=>b.jsx(kn,{padding:0,h:"100%",position:"relative",children:b.jsx(Jt,{suspenseFallback:b.jsx(ut,{isIndeterminate:!0}),children:b.jsx(as,{branchIndex:h})})},h))})]}),b.jsx(is,{isOpen:n,onClose:()=>l(!1)}),b.jsx(ss,{isOpen:s,onClose:()=>t(!1)})]})}function ls(){const m=ue(),_=J(l=>l.app.globalAlerts),n=l=>{ce.isStandaloneWindow()?window.open("/".concat(l),"_blank"):ce.openApp(l)};return b.jsx(b.Fragment,{children:Object.entries(_).map(([l,{message:s,url:t,linkedApp:e}])=>b.jsxs(dt,{status:l,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[b.jsx(ht,{}),e?b.jsx(Ve,{onClick:()=>n(e),children:s}):t?b.jsx(Ve,{href:t,target:"_blank",children:s}):s,b.jsx(Kt,{ml:"auto",onClick:()=>m(Nr(l))})]},l))})}function cs(){const{t:m}=le(),_=J(s=>s.app.isLoading),[n,l]=X.useState(!1);return X.useEffect(()=>{ce.isStandaloneWindow()&&!ce.storage.get($e.DO_NOT_SHOW_RMT_MSG)&&l(!0)},[]),b.jsxs(an,{children:[_&&b.jsx(ut,{isIndeterminate:_<0,value:_>=0?_:void 0}),b.jsx(Ji,{}),n&&b.jsxs(dt,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[b.jsx(ht,{}),b.jsxs(lt,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[m("Try out")," ",b.jsx(Ve,{href:"/?app=rmg",isExternal:!0,children:m("Rail Map Toolkit")})," ",m("now and enjoy an even better rail map design experience!")," ",b.jsx(Ve,{as:"button",ml:"auto",onClick:()=>l(!1),children:m("Close")})," | ",b.jsx(Ve,{as:"button",onClick:()=>{l(!1),ce.storage.set($e.DO_NOT_SHOW_RMT_MSG,"true")},children:m("Don't show me again")})]})]}),b.jsx(ls,{}),b.jsxs(Ee,{flex:1,overflow:"hidden",position:"relative",children:[b.jsxs(Ee,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[b.jsx(Se,{children:b.jsx(ti,{})}),b.jsx(os,{})]}),b.jsx(Fi,{})]}),b.jsx("canvas",{style:{display:"none"}})]})}const ds="rmg-templates-bridge--",hs={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function us(m){const{isOpen:_,onClose:n,onImport:l}=m,[s]=X.useState(Me()),t="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:ce.getAppName(),parentId:s});return X.useEffect(()=>{const e=new BroadcastChannel(ds+s);return e.onmessage=r=>{const{event:o,meta:f,data:v}=r.data;console.log("[rmg] Received event from RMG Templates app clip:",o),o==="CLOSE"?n():o==="IMPORT"&&l(v,f.name)},()=>{e.close()}},[]),b.jsx(sn,{size:"xl",isOpen:_,onClose:n,sx:hs,children:b.jsx("iframe",{src:t,loading:"eager"})})}const fs={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function ps(m){const{selectedParam:_,disableNew:n,onError:l}=m,{t:s}=le(),[,t]=ft(),[e,r]=X.useState(!1),o=X.useRef(null),f=X.useRef(null);X.useEffect(()=>{var p;_&&((p=f.current)==null||p.focus())},[_]);const v=()=>{const p=ts(Q.MTR,ce.getLanguage()),u=_t(JSON.stringify(p));t({project:u}),ce.event(ve.NEW_PARAM,{})},d=(p,u)=>{const y=_t(JSON.stringify(p),u);t({project:y})},h=async p=>{var y;const u=(y=p.target.files)==null?void 0:y[0];console.log("handleImportProject():: received file",u);try{if(!u)l(s("OpenActions.unknownError"));else if(u.type!=="application/json")l(s("OpenActions.invalidType"));else{const g=await Gr(u),x=_t(g);t({project:x}),ce.event(ve.UPLOAD_PARAM,{})}}catch(g){l(s("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",g)}p.target.value=""},a=()=>{_&&(t({project:_}),ce.event(ve.OPEN_PARAM,{}))};return b.jsxs(Ee,{sx:fs,children:[b.jsx(de,{leftIcon:b.jsx(Re,{}),onClick:v,isDisabled:n,children:s("Blank project")}),b.jsx(de,{leftIcon:b.jsx(Lr,{}),onClick:()=>r(!0),isDisabled:n,children:s("Open template")}),b.jsx(de,{leftIcon:b.jsx(Fr,{}),onClick:()=>{var p;return(p=o.current)==null?void 0:p.click()},isDisabled:n,children:s("Import project")}),b.jsx(de,{ref:f,colorScheme:"primary",leftIcon:b.jsx(Ur,{}),onClick:a,isDisabled:_===void 0,children:s("Open selected")}),b.jsx("input",{ref:o,type:"file",accept:".json",hidden:!0,onChange:h,"data-testid":"file-upload"}),b.jsx(us,{isOpen:e,onClose:()=>r(!1),onImport:d})]})}const ms={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function gs(m){const{downloading:_}=m,{t:n}=le(),[l]=ft(),s=l.get("project"),[t,e]=X.useState([]),[r,o]=X.useState(),f=X.useRef(null),v=Xt();X.useEffect(()=>{e(bt())},[_]),Cn({ref:f,handler:()=>o(void 0)});const d=p=>{const{id:u,name:y,lastModified:g}=p;u&&(ce.storage.set($e.PARAM_CONFIG_BY_ID+u,JSON.stringify({name:y,lastModified:g})),o(void 0),e(bt()),ce.event(ve.UPDATE_PARAM_CONFIG,{}))},h=p=>{ce.storage.remove($e.PARAM_BY_ID+p),ce.storage.remove($e.PARAM_CONFIG_BY_ID+p),o(void 0),e(bt()),ce.event(ve.REMOVE_PARAM,{})},a=p=>{v({description:p,status:"error",duration:1e4,isClosable:!0})};return b.jsxs(an,{justifyContent:"center",children:[s&&b.jsx(ut,{isIndeterminate:!0}),b.jsx(jn,{children:b.jsxs(Ie,{sx:ms,children:[b.jsx(ye,{as:"h3",size:"lg",children:n("Saved projects")}),b.jsxs(Ee,{ref:f,children:[b.jsx(Vr,{paramRegistry:t,downloading:_,selectedParam:r,onParamSelect:o,onParamRemove:h,onParamUpdate:d}),b.jsx(ps,{selectedParam:r,disableNew:t.length>=10,onError:a})]})]})})]})}const _s=m=>async _=>{try{const{config:n,param:l}=$r(m);if(!l)return!1;const s={id:m,...n!=null?n:{}},t=Yr(l);try{const e=await qr(t);_(jt(s)),_(Vt(e))}catch(e){_(jt(s)),_(Vt(t))}return!0}catch(n){return console.warn("Failed to parse param.",n),!1}};function bs(){const{t:m}=le(),_=ue(),{paramConfig:n}=J(h=>h.app),[l,s]=ft(),t=l.get("project"),e=l.get("external"),[r,o]=X.useState(!1),[f,v]=X.useState(),d=Xt();return X.useEffect(()=>{if(console.log("searchParam: project=".concat(t,", external=").concat(e)),t&&e)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),s({project:t});else if(t)d.closeAll(),t===(n==null?void 0:n.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),o(!0)):(console.log("AppRouter:: Loading app view for param (ID=".concat(t,")...")),_(_s(t)).then(h=>{h?o(!0):(console.log("AppRouter:: Failed to read param (ID=".concat(t,"). Rendering param selector view...")),d({description:m("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),s({}))}));else if(e){console.log("AppRouter:: External project URl is provided. Downloading project...");const h=decodeURIComponent(e);v(h),Kr(h).then(a=>{a?s({project:a}):(console.log("AppRouter:: Failed to download param from ".concat(h,". Rendering param selector view...")),d({description:m("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),s({})),v(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),o(!1)},[t,e]),r?b.jsx(cs,{}):b.jsx(gs,{downloading:f})}const ks=Object.freeze(Object.defineProperty({__proto__:null,default:bs},Symbol.toStringTag,{value:"Module"}));export{Xr as R,ks as a,ws as g,Ue as i};
