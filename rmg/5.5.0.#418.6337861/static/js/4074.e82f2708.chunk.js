"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[4074,8306,2554],{74074:function(n,t,e){e.r(t),e.d(t,{default:function(){return d}});var r=e(29439),i=e(93433),o=e(72791),a=e(37732),c=e(36705),s=e(20713),l=e(68306),u=e(62554),f=e(80184),h=s.Ht.Destination;function d(){var n=(0,a.Qy)((function(n){return n.app})).canvasScale,t=(0,a.Qy)((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,o=e[h];return(0,f.jsxs)(u.default,{type:h,svgWidth:o,svgHeight:r,canvasScale:n,theme:i,children:[(0,f.jsx)(m,{}),(0,f.jsx)(g,{})]})}var m=(0,o.memo)((function(){return(0,f.jsx)("defs",{children:(0,f.jsx)("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,f.jsx)("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})})})})),g=function(){var n=(0,a.Qy)((function(n){return n.helper})),t=n.routes,e=n.branches,o=(0,a.Qy)((function(n){return n.param})),s=o.line_name,u=o.theme,h=o.current_stn_idx,d=o.direction,m=o.stn_list,g=o.info_panel_type,_=o.loop,v=o.coline,p=function(n,t,e){return(0,i.Z)(new Set(n.filter((function(n){return n.includes(e)})).map((function(n){var e=n.filter((function(n){return!["linestart","lineend"].includes(n)}));return"l"===t?e[0]:e.reverse()[0]}))))},j=function(n,t){return t?[[n.map((function(n){return m[n].name[0]})).join("\uff0c"),n.map((function(n){return m[n].name[1]})).join(", ")].map((function(n){return n.replace("\\","")}))]:n.map((function(n){return m[n].name.map((function(n){return n.replace("\\","")}))}))},w=_?(0,l.get_pivot_stations)(e,d,m,h):p(t,d,h),Z=(_?p(t,d,h):w).filter((function(n){return e.slice(1).filter((function(n){return(0,c.Qo)(n,m)})).some((function(t){return t.includes(n)}))})),y=j(w.filter((function(n){return!Z.includes(n)})),!_&&!("sh2020"===g));console.log(y);var S=j(Z,!0),b=Object.fromEntries(Z.map((function(n){return[n,Object.values(v).filter((function(t){return t.from===n||t.to===n})).at(0)]})).filter((function(n){var t=(0,r.Z)(n,2);t[0];return t[1]})));return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(x,{dest_names:y,line_name:s,line_color:[u[2],u[3]],coline:!!Z.length,upper:!!Z.length}),Z.length&&Z.map((function(n){var t,e,r;return(0,f.jsx)("g",{transform:"translate(0,".concat(-250,")"),children:(0,f.jsx)(x,{dest_names:[S.at(0)],line_name:null===(t=b[n])||void 0===t?void 0:t.colors.at(0).slice(4),line_color:[null===(e=b[n])||void 0===e?void 0:e.colors.at(0)[2],null===(r=b[n])||void 0===r?void 0:r.colors.at(0)[3]],coline:!0,upper:!1})},"coline_".concat(n))}))]})},x=function(n){var t=n.dest_names,e=n.line_name,i=n.line_color,c=n.coline,s=n.upper,l=(0,a.Qy)((function(n){return n.param})),u=l.current_stn_idx,h=l.direction,d=l.platform_num,m=l.svgWidth,g=l.svg_height,x=(0,o.useRef)(null),w=(0,o.useState)({width:0}),Z=(0,r.Z)(w,2),y=Z[0],S=Z[1];(0,o.useEffect)((function(){return S(x.current.getBBox())}),[JSON.stringify(t),JSON.stringify(u)]);var b=m.destination/2,z=b-10-36-y.width>=162.5&&b-10-36-264>=162.5?b:"l"===h?(m.destination+y.width-264)/2:(m.destination-y.width+264)/2;return(0,f.jsxs)("g",{transform:"translate(0,".concat(g-300,")"),children:[(0,f.jsx)("path",{stroke:i[0],strokeWidth:12,d:"l"===h?"M".concat(m.destination-24,",16 H 36"):"M24,16 H ".concat(m.destination-36),transform:"translate(0,".concat(s?-20:220,")"),markerEnd:c?void 0:"url(#slope)"}),(0,f.jsx)(_,{ref:x,dest_names:t}),""!==d&&(0,f.jsx)("g",{transform:"translate(".concat(z,",0)"),children:(0,f.jsx)(v,{})}),e[0].match(/^[\w\d]+/)?(0,f.jsx)(j,{line_name:e,line_color:i}):(0,f.jsx)(p,{line_name:e,line_color:i})]})},_=(0,o.forwardRef)((function(n,t){var e=n.dest_names,r=(0,a.Qy)((function(n){return n.param})),i=r.direction,c=r.svgWidth;return(0,f.jsxs)("g",{ref:t,transform:"translate(".concat("l"===i?36:c.destination-36,",145)"),children:[(0,f.jsx)("g",{transform:"translate(0,".concat(2===e.length?-20:20,")"),children:(0,f.jsx)("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",fill:"black",transform:"rotate(".concat("l"===i?0:180,")scale(0.8)")})}),(0,f.jsx)("g",{textAnchor:"l"===i?"start":"end",transform:"translate(".concat("l"===i?148:-148,",25)"),children:e.map((function(n,t){return(0,f.jsxs)(o.Fragment,{children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:70,dy:-100*t+7,children:"\u5f80"+n[0]},"zh".concat(t)),(0,f.jsx)("text",{className:"rmg-name__en",fontSize:25,dy:-100*t+40,children:"To "+n[1]},"en".concat(t))]},t)}))})]})})),v=function(){var n=(0,a.Qy)((function(n){return n.param})).platform_num;return(0,o.useMemo)((function(){return(0,f.jsxs)("g",{transform:"translate(".concat(-102.5,",150)"),children:[(0,f.jsx)("circle",{r:60,fill:"none",stroke:"black",strokeWidth:2}),(0,f.jsx)("text",{className:"rmg-name__en",dominantBaseline:"central",fontSize:120,textAnchor:"middle",children:n}),(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:100,dominantBaseline:"central",x:65,children:"\u7ad9\u53f0"})]})}),[n])},p=function(n){var t=n.line_name,e=n.line_color,c=(0,a.Qy)((function(n){return n.param})),s=c.direction,l=c.svgWidth,u="l"===s?l.destination-42:42,h=(0,o.useRef)(null),d=o.useState({width:0}),m=(0,r.Z)(d,2),g=m[0],x=m[1];o.useEffect((function(){return x(h.current.getBBox())}),(0,i.Z)(t));var _=("l"===s?-g.width:0)-6,v=("l"===s?-1:1)*g.width/2;return(0,o.useMemo)((function(){return(0,f.jsxs)("g",{transform:"translate(".concat(u,",92)"),children:[(0,f.jsx)("rect",{fill:e[0],x:_,width:g.width+10,height:120}),(0,f.jsxs)("g",{textAnchor:"r"===s?"start":"end",transform:"translate(0,68)",fill:e[1],children:[(0,f.jsx)("g",{ref:h,children:(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:68,children:t[0]})}),(0,f.jsx)("text",{className:"rmg-name__en",fontSize:30,textAnchor:"middle",x:v,dy:42,children:t[1]})]})]})}),[g].concat((0,i.Z)(t),(0,i.Z)(e),[s,l.destination]))},j=function(n){var t=n.line_name,e=n.line_color,c=(0,a.Qy)((function(n){return n.param})),s=c.direction,l=c.svgWidth,u=t[0].match(/^[\w\d]+|.+/g),h=(0,r.Z)(u,2),d=h[0],m=h[1],g="l"===s?l.destination-36-210:90;return(0,o.useMemo)((function(){return(0,f.jsxs)("g",{transform:"translate(".concat(g,",92)"),children:[(0,f.jsx)("rect",{fill:e[0],x:-54,width:108,height:120}),(0,f.jsx)("text",{className:"rmg-name__zh",fill:e[1],fontSize:96,textAnchor:"middle",dominantBaseline:"central",transform:"translate(0,60)",letterSpacing:-5,children:d}),(0,f.jsxs)("g",{textAnchor:"start",transform:"translate(74,68)",children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:68,children:m}),(0,f.jsx)("text",{className:"rmg-name__en",fontSize:30,dy:42,children:t[1]})]})]})}),[g].concat((0,i.Z)(t),(0,i.Z)(e),[s,l.destination]))}},68306:function(n,t,e){e.r(t),e.d(t,{split_loop_stns:function(){return o},split_loop_stns_with_branch:function(){return a},split_loop_stns_with_branches:function(){return c},get_xshares_yshares_of_loop:function(){return s},get_pivot_stations:function(){return l}});var r=e(29439),i=e(93433),o=function(n,t,e,r){var o=n.length-2*r-e,a=n.findIndex((function(n){return n===t})),c=[].concat((0,i.Z)(n),(0,i.Z)(n),(0,i.Z)(n)),s=n.length+a-Math.floor(o/2)+(o%2===0?1:0),l=n.length+a+Math.floor(o/2);return{top:c.slice(s,l+1),left:c.slice(s-r,s),right:c.slice(l+1,l+1+r),bottom:c.slice(l+1+r,l+1+r+e)}},a=function(n,t,e,r){var o=n.length-2*r-e,a=[].concat((0,i.Z)(n),(0,i.Z)(n),(0,i.Z)(n)),c=n.length+n.findIndex((function(n){return n===t})),s=a[c+o-1],l=n.length+n.findIndex((function(n){return n===s}))+(c+o>2*n.length?n.length:0);return{top:a.slice(c,l+1),left:a.slice(c-r,c),right:a.slice(l+1,l+1+r),bottom:a.slice(l+1+r,l+1+r+e)}},c=function(n,t,e,i){var o=n.findIndex((function(n){return n===t[0]})),c=n.findIndex((function(n){return n===t[1]})),s=o>c?[c,o,t[1],t[0]]:[o,c,t[0],t[1]],l=(0,r.Z)(s,4);o=l[0],c=l[1],t[0]=l[2],t[1]=l[3];var u=n.slice(o,c+1),f=n.filter((function(n){return!u.filter((function(n){return!t.includes(n)})).includes(n)})),h=n.length-("major"===i?Math.max:Math.min)(u.length,f.length)-2*e,d="major"===i?u.length>f.length?t[0]:t[1]:u.length>f.length?t[1]:t[0];return a(n,d,h,e)},s=function(n,t){var e=Object.fromEntries(n.map((function(n){return[n,-1]}))),r=Object.fromEntries(n.map((function(n){return[n,-1]})));return t.top.forEach((function(n,i){e[n]=0+1/(t.top.length+1)*(i+1),r[n]=0})),t.right.forEach((function(n,i){e[n]=1,r[n]=0+1/(t.right.length+1)*(i+1)})),t.bottom.forEach((function(n,i){e[n]=1-1/(t.bottom.length+1)*(i+1),r[n]=1})),t.left.forEach((function(n,i){e[n]=0,r[n]=1-1/(t.left.length+1)*(i+1)})),{x_shares:e,y_shares:r}},l=function(n,t,e,r){var o=n[0].filter((function(n){return!["linestart","lineend"].includes(n)})),a=[].concat((0,i.Z)(o),(0,i.Z)(o),(0,i.Z)(o)),c="r"===t?a:a.reverse(),s=c.findIndex((function(n){return r===n}))+o.length;return c.slice(s+1).filter((function(n){return e[n].loop_pivot})).slice(void 0,2)}},62554:function(n,t,e){e.r(t),e.d(t,{default:function(){return o}});var r=e(4942),i=(e(72791),e(80184));function o(n){var t,e=n.type,o=n.svgWidth,a=n.svgHeight,c=n.canvasScale,s=n.theme,l=n.children;return(0,i.jsxs)("svg",{id:e,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",height:a*c,viewBox:"0 0 ".concat(o," ").concat(a),colorInterpolationFilters:"sRGB",style:(t={},(0,r.Z)(t,"--rmg-svg-width",o+"px"),(0,r.Z)(t,"--rmg-svg-height",a+"px"),(0,r.Z)(t,"--rmg-theme-colour",s[2]),(0,r.Z)(t,"--rmg-theme-fg",s[3]),t),children:[(0,i.jsx)("rect",{id:"canvas-bg",fill:"white",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}}),l,(0,i.jsx)("rect",{id:"canvas-border",fill:"none",strokeWidth:3,stroke:"none",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}})]})}}}]);
//# sourceMappingURL=4074.e82f2708.chunk.js.map