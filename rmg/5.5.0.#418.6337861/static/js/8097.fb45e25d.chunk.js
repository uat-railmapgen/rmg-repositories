"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[8097],{49699:function(n,t,r){r.r(t),r.d(t,{ColineSHMetro:function(){return g}});var e=r(93433),c=r(29439),a=r(4942),o=r(1413),i=r(72791),s=r(51401),l=r(20713),u=r(37732),f=r(61504),d=r(17250),h=r(80184),m=["shanghai","sh4","#5F259F","#fff","4\u53f7\u7ebf","Line 4"],g=function(n){var t=n.xs,r=n.servicesPresent,l=n.stnStates,d=(0,u.Qy)((function(n){return n.param})),m=d.svg_height,g=d.direction,j=d.stn_list,Z=d.current_stn_idx,_=d.branchSpacingPct,y=d.info_panel_type,k=d.coline,S=(0,u.Qy)((function(n){return n.helper})),b=S.branches,M=S.depsStr,O=i.useMemo((function(){return console.log("computing y shares"),Object.keys(j).reduce((function(n,t){if(b[0].includes(t))return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},t,0));var r=b.slice(1).filter((function(n){return n.includes(t)}))[0];return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},t,j[r[0]].children.indexOf(r[1])?-3:3))}),{})}),[M]),H=Object.entries(O).filter((function(n){var t=(0,c.Z)(n,2);t[0];return t[1]<=0})).reduce((function(n,t){var r=(0,c.Z)(t,2),e=r[0],i=r[1];return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},e,i))}),{}),L=Object.keys(H).reduce((function(n,t){return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},t,-H[t]*_*m/300))}),{}),P=i.useMemo((function(){return(0,s.calculateColine)((0,s.calculateColineStations)(Object.values(k).filter((function(n){return n.display})),b),l)}),[JSON.stringify(k),Z,g,M]),w=r.reduce((function(n,e){return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},e,Object.keys(P).reduce((function(n,c){return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},c,P[c].map((function(n){return{path:(0,f._linePath)(n.linePath,c,t,L,g,e,r.length,j,"diagonal"),colors:n.colors}})).filter((function(n){return""!==n.path}))))}),{})))}),{}),W=(0,s.calculateColineStations)(Object.values(k).filter((function(n){return n.display})),b).map((function(n){return n.linePath})).flat(),C="sh2020"===y?3:0;return(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("g",{id:"coline",transform:"translate(0,".concat(12+C,")"),children:[(0,h.jsx)(p,{paths:w,direction:g}),(0,h.jsx)(v,{colineStns:P,branches:b,xs:t,ys:L,stnStates:l,lineWidth:12,colineGap:C}),(0,h.jsx)(x,{stnIds:Object.entries(O).filter((function(n){var t=(0,c.Z)(n,2);t[0];return t[1]<0})).reduce((function(n,t){var r=(0,c.Z)(t,2),a=r[0];r[1];return[].concat((0,e.Z)(n),[a])}),[]).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==j[n].services.length})).filter((function(n){return W.includes(n)})),xs:t,ys:L,stnStates:l})]})})};t.default=g;var p=function(n){var t=n.paths,r=n.direction;return(0,h.jsx)(h.Fragment,{children:Object.keys(t).map((function(n,e){var c,a;return(0,h.jsx)("g",{transform:"translate(0,".concat(25*e,")"),children:(0,h.jsxs)("g",{children:[null===(c=t[n])||void 0===c?void 0:c.pass.map((function(t,r){return(0,h.jsx)(i.Fragment,{children:(0,h.jsx)("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:t.path,strokeLinejoin:"round",filter:n===l.K9.local?void 0:"url(#contrast-".concat(n,")")},r)},r)})),null===(a=t[n])||void 0===a?void 0:a.main.map((function(t,e){var c;return(0,h.jsxs)(i.Fragment,{children:[t.colors.length>1&&(0,h.jsx)("linearGradient",{id:"grad".concat(e),y1:"-100%",y2:"100%",x1:"0",x2:"0",gradientUnits:"userSpaceOnUse",children:t.colors.map((function(n,r){return(0,h.jsxs)(i.Fragment,{children:[(0,h.jsx)("stop",{offset:"".concat(100/t.colors.length*(r+0),"%"),stopColor:n[2]}),(0,h.jsx)("stop",{offset:"".concat(100/t.colors.length*(r+1),"%"),stopColor:n[2]})]},r)}))}),"l"===r&&(0,h.jsx)("marker",{id:"arrow_left_".concat(e,"_").concat(t.colors.map((function(n){return n[2]})).join("_")),refY:.5,refX:1,children:(0,h.jsx)("path",{d:"M1,0L0,1H1z",fill:t.colors.length>1?"url(#grad".concat(e,")"):t.colors[0][2]})}),"r"===r&&(0,h.jsx)("marker",{id:"arrow_right_".concat(e,"_").concat(t.colors.map((function(n){return n[2]})).join("_")),refY:.5,children:(0,h.jsx)("path",{d:"M0,0L1,1H-1z",fill:t.colors.length>1?"url(#grad".concat(e,")"):t.colors[0][2]})}),(0,h.jsx)("path",{stroke:(null!==(c=t.colors.at(-1))&&void 0!==c?c:m)[2],strokeWidth:12,fill:"none",d:t.path,markerStart:"l"===r?"url(#arrow_left_".concat(e,"_").concat(t.colors.map((function(n){return n[2]})).join("_"),")"):void 0,markerEnd:"r"===r?"url(#arrow_right_".concat(e,"_").concat(t.colors.map((function(n){return n[2]})).join("_"),")"):void 0,strokeLinejoin:"round",filter:n===l.K9.local?void 0:"url(#contrast-".concat(n,")")},e)]},e)}))]})},"servicePath".concat(e))}))})},v=function(n){var t=n.colineStns,r=n.branches,c=n.xs,a=n.ys,o=n.stnStates,i=n.lineWidth,s=n.colineGap,l=(0,u.Qy)((function(n){return n.param})),f=l.line_name,d=l.theme,m=l.info_panel_type,g=[].concat((0,e.Z)(t.main),(0,e.Z)(t.pass)).map((function(n){return n.linePath.map((function(t){var r;return{curStn:t,x:c[t],y:a[t],color:null!==(r=n.colors.at(-1))&&void 0!==r?r:[].concat((0,e.Z)(d),(0,e.Z)(f))}}))})).flat().reduce((function(n,t){return n.find((function(n){return n.curStn===t.curStn}))?n:n.concat(t)}),[]).filter((function(n){return r[0].includes(n.curStn)}));return console.log(g),(0,h.jsx)("g",{id:"stations_in_mainline",children:g.map((function(n){var t=n.curStn,r=n.x,e=n.y,c=n.color,a=(-1===o[t]?0:i)+s+i,l=(-1===o[t]?0:-i)-s-i/2;return(0,h.jsx)("g",{transform:"translate(".concat(r,",").concat(e,")"),children:"sh2020"===m?(0,h.jsx)("rect",{stroke:"none",height:a,width:12,x:-6,y:l,fill:-1===o[t]?"var(--rmg-grey)":c[2]}):(0,h.jsx)("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:"translate(0,".concat(-i,")")})},t)}))})},x=function(n){var t=n.xs,r=n.ys,c=n.stnStates,l=n.stnIds,f=(0,u.Qy)((function(n){return n.helper})),m=f.branches,g=f.depsStr,p=(0,u.Qy)((function(n){return n.param})),v=p.line_name,x=p.theme,j=p.coline,Z=i.useMemo((function(){return(0,s.calculateColineStations)(Object.values(j),m)}),[JSON.stringify(j),g]),_=l.reduce((function(n,t){var r;return(0,o.Z)((0,o.Z)({},n),{},(0,a.Z)({},t,null!==(r=Z.filter((function(n){return n.linePath.includes(t)})).map((function(n){return n.colors})).flat().at(0))&&void 0!==r?r:[].concat((0,e.Z)(x),(0,e.Z)(v))))}),{});return(0,h.jsx)("g",{id:"stations_in_coline",children:l.map((function(n){return(0,h.jsx)("g",{transform:"translate(".concat(t[n],",").concat(r[n],")"),children:(0,h.jsx)(d.default,{stnId:n,stnState:c[n],color:_[n][2]})},n)}))})}},61504:function(n,t,r){r.r(t),r.d(t,{_linePath:function(){return m},DirectionElements:function(){return v}});var e=r(29439),c=r(4942),a=r(1413),o=r(72791),i=r(23824),s=r(17250),l=r(49699),u=r(20713),f=r(37732),d=r(80184);t.default=function(){var n=(0,f.Qy)((function(n){return n.helper})),t=n.routes,r=n.branches,s=n.depsStr,v=(0,f.Qy)((function(n){return n.param})),x=(0,f.Qy)((function(n){return n.param})),j=x.svg_height,Z=x.stn_list,_=x.branchSpacingPct,y=x.coline,k=x.direction,S=(0,i.adjacencyList)(v.stn_list,(function(){return 0}),(function(){return 0})),b=(0,i.criticalPathMethod)("linestart","lineend",S),M=(0,i.criticalPathMethod)(b.nodes[1],b.nodes.slice(-2)[0],S),O=o.useMemo((function(){return console.log("computing x shares"),Object.keys(v.stn_list).reduce((function(n,t){return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},t,(0,i.getXShareMTR)(t,S,r)))}),{})}),[r.toString(),JSON.stringify(S)]),H=[v.svgWidth.railmap*v.padding/100,v.svgWidth.railmap*(1-v.padding/100)],L=Object.keys(O).reduce((function(n,t){return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},t,H[0]+O[t]/M.len*(H[1]-H[0])))}),{}),P=o.useMemo((function(){return console.log("computing y shares"),Object.keys(Z).reduce((function(n,t){if(r[0].includes(t))return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},t,0));var e=r.slice(1).filter((function(n){return n.includes(t)}))[0];return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},t,Z[e[0]].children.indexOf(e[1])?-3:3))}),{})}),[s]),w=Object.entries(P).filter((function(n){var t=(0,e.Z)(n,2);t[0];return t[1]>=0})).reduce((function(n,t){var r=(0,e.Z)(t,2),o=r[0],i=r[1];return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},o,i))}),{}),W=Object.keys(w).reduce((function(n,t){return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},t,-w[t]*_*j/300))}),{}),C=o.useMemo((function(){return(0,i.getStnState)(v.current_stn_idx,t,v.direction)}),[v.current_stn_idx,v.direction,t.toString()]),Q=Object.values(u.K9),z=Object.values(v.stn_list).map((function(n){return n.services})).flat().reduce((function(n,t){return n[Q.indexOf(t)]=!0,n}),[!1,!1,!1]).map((function(n,t){return[Q[t],n]})).filter((function(n){return n[1]})).map((function(n){return n[0]})),F=r.map((function(n){return(0,i.drawLine)(n,C)})).reduce((function(n,t){return n.main.push(t.main),n.pass.push(t.pass),n}),{main:[],pass:[]}),N=z.reduce((function(n,t){return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},t,Object.keys(F).reduce((function(n,r){return(0,a.Z)((0,a.Z)({},n),{},(0,c.Z)({},r,F[r].map((function(n){return m(n,r,L,W,k,t,z.length,Z)})).filter((function(n){return""!==n}))))}),{})))}),{});return(0,d.jsxs)("g",{id:"main",transform:"translate(0,".concat(v.svg_height*(Object.keys(y).length>0?.5:.7+.1),")"),children:[(0,d.jsx)(h,{paths:N,direction:v.direction}),(0,d.jsx)(g,{stnIds:Object.keys(w).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==Z[n].services.length})),xs:L,ys:W,stnStates:C}),Object.keys(y).length>0&&(0,d.jsx)(l.default,{xs:L,servicesPresent:z,stnStates:C}),z.length>1&&(0,d.jsx)(p,{servicesLevel:z,lineXs:H})]})};var h=function(n){var t=(0,f.Qy)((function(n){return n.param})).theme,r=n.paths,e=n.direction;return(0,d.jsx)(d.Fragment,{children:Object.keys(r).map((function(c,a){var o,i;return(0,d.jsxs)("g",{transform:"translate(0,".concat(25*a,")"),filter:"#999999"===t[2]?"url(#pujiang_outline_railmap)":void 0,children:[(0,d.jsx)("g",{children:null===(o=r[c])||void 0===o?void 0:o.pass.map((function(t,r){return(0,d.jsx)("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:t,markerStart:"l"===n.direction?"url(#arrow_gray)":void 0,markerEnd:"r"===n.direction?"url(#arrow_gray)":void 0,strokeLinejoin:"round"},r)}))}),(0,d.jsx)("g",{children:null===(i=r[c])||void 0===i?void 0:i.main.map((function(n,t){return(0,d.jsx)("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:n,markerStart:"l"===e?"url(#arrow_theme_left)":void 0,markerEnd:"r"===e?"url(#arrow_theme_right)":void 0,strokeLinejoin:"round",filter:c===u.K9.local?void 0:"url(#contrast-".concat(c,")")},t)}))})]},"servicePath".concat(a))}))})},m=function(n,t,r,c,a,o,i,s){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"rightangle",u=[],f=(0,e.Z)(u,2),d=f[0],h=f[1],m={},g={local:0,express:20,direct:40}[o],p=i>1?50:0,v=30;if(n.length>0){var x=!1,j=!1;s[n.at(-1)||0].children.some((function(n){return["linestart","lineend"].includes(n)}))?j=!0:s[n.at(0)||0].parents.some((function(n){return["linestart","lineend"].includes(n)}))&&(x=!0),v=x||j?v:0}var Z=30;if(n.forEach((function(n){var t=r[n],e=c[n];if(!d&&0!==d)return h=t,d=e,void(m.start=[t,e]);0===e?e!==d&&(m.bifurcate=[h,d]):e!==d&&(m.bifurcate=[t,e]),m.end=[t,e],h=t,d=e})),m.hasOwnProperty("start")){if(m.hasOwnProperty("end")){if(m.hasOwnProperty("bifurcate")){var _=(0,e.Z)(m.start,2),y=_[0],k=_[1],S=m.bifurcate[0],b=(0,e.Z)(m.end,2),M=b[0],O=b[1];return"main"===t?"l"===a?O>k?(console.log(m),"rightangle"===l?"M ".concat(y-v,",").concat(k," H ").concat(M," V ").concat(O):"M ".concat(y,",").concat(k," H ").concat(y+Z," L ").concat(S-Z,",").concat(O," H ").concat(M)):"rightangle"===l?"M ".concat(y,",").concat(k," V ").concat(O," H ").concat(M):"M ".concat(y-v,",").concat(k," H ").concat(S+Z," L ").concat(M-Z,",").concat(O," H ").concat(M):O>k?"rightangle"===l?"M ".concat(y,",").concat(k," H ").concat(M," V ").concat(O):"M ".concat(y,",").concat(k," H ").concat(y+Z," L ").concat(S-Z,",").concat(O," H ").concat(M+v):"rightangle"===l?"M ".concat(y,",").concat(k," V ").concat(O," H ").concat(M+v):"M ".concat(y,",").concat(k," H ").concat(S+Z," L ").concat(M-Z,",").concat(O," H ").concat(M):O>k?"rightangle"===l?"M ".concat(y-v,",").concat(k," H ").concat(M," V ").concat(O):"M ".concat(y,",").concat(k," H ").concat(y+Z," L ").concat(S-Z,",").concat(O," H ").concat(M+v):"rightangle"===l?"M ".concat(y,",").concat(k," V ").concat(O," H ").concat(M+v):"M ".concat(y-v,",").concat(k," H ").concat(S+Z," L ").concat(M-Z,",").concat(O," H ").concat(M)}var H=(0,e.Z)(m.start,2),L=H[0],P=H[1],w=m.end[0];return"main"===t?"l"===a?"M ".concat(L-v-g,",").concat(P," H ").concat(w):"M ".concat(L,",").concat(P," H ").concat(w+v+g):"l"===a?"M ".concat(L-v,",").concat(P," H ").concat(w+v+p):"M ".concat(L-v-p,",").concat(P," H ").concat(w+v)}var W=(0,e.Z)(m.start,2),C=W[0],Q=W[1];return"main"===t?"l"===a?"M ".concat(C-v-g,",").concat(Q," H ").concat(C):"M ".concat(C,",").concat(Q," H ").concat(C+v+g):"l"===a?"M ".concat(C,",").concat(Q," L ").concat(C+v+p,",").concat(Q):"M ".concat(C-v-p,",").concat(Q," L ").concat(C,",").concat(Q)}return""},g=function(n){var t=n.xs,r=n.ys,e=n.stnStates,c=n.stnIds;return(0,d.jsx)("g",{children:c.map((function(n){return(0,d.jsx)("g",{transform:"translate(".concat(t[n],",").concat(r[n],")"),children:(0,d.jsx)(s.default,{stnId:n,stnState:e[n]})},n)}))})},p=function(n){var t=(0,f.Qy)((function(n){return n.param})),r=t.svg_height,e=t.direction,c=t.svgWidth,a=130-r,i=n.servicesLevel.map((function(n){return{local:"\u666e\u901a\u8f66",express:"\u5927\u7ad9\u8f66",direct:"\u76f4\u8fbe\u8f66"}[n]})),s="r"===e?n.lineXs[0]-42:n.lineXs[1]+42,l=2===n.servicesLevel.length?350:500;return o.useMemo((function(){return(0,d.jsxs)("g",{children:[i.map((function(n,t){return(0,d.jsxs)("g",{transform:"translate(".concat(s,",").concat(25*t,")"),children:[(0,d.jsx)("rect",{x:-27.5,height:10,width:55,fill:"white",stroke:"black",y:-5}),(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:9,y:3,textAnchor:"middle",children:"".concat(n,"\u8fd0\u884c\u7ebf")})]},n)})),(0,d.jsxs)("g",{transform:"translate(".concat("r"===e?30:c.railmap-l,",").concat(a,")"),children:[(0,d.jsx)("text",{className:"rmg-name__zh",children:"\u56fe\u4f8b\uff1a"}),i.map((function(n,t){return(0,d.jsxs)("g",{transform:"translate(".concat(150*t+50,",0)"),children:[(0,d.jsx)("line",{x1:"0",x2:"35",y1:"-5",y2:"-5",stroke:"var(--rmg-theme-colour)",strokeWidth:"12",filter:2===t?"url(#contrast-direct)":1===t?"url(#contrast-express)":""}),(0,d.jsx)("use",{x:"17.5",y:"-5",xlinkHref:"#stn_sh",fill:"var(--rmg-theme-colour)"}),(0,d.jsx)("text",{x:"40",className:"rmg-name__zh",children:"".concat(n,"\u505c\u9760\u7ad9")})]},"serviceLevel".concat(t))}))]})]})}),[r,e,c,n.servicesLevel,n.lineXs])},v=function(){var n=(0,f.Qy)((function(n){return n.param})),t=n.direction,r=n.svgWidth,e=n.coline,c=!!Object.keys(e).length;return o.useMemo((function(){return(0,d.jsxs)("g",{transform:"translate(".concat("l"===t?50:r.railmap-150,",50)"),children:[(0,d.jsx)("text",{className:"rmg-name__zh",children:"\u5217\u8f66\u524d\u8fdb\u65b9\u5411"}),(0,d.jsx)("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",stroke:c?"var(--rmg-black)":void 0,strokeWidth:c?5:void 0,fill:c?"var(--rmg-white)":"var(--rmg-theme-colour)",transform:"translate(".concat("l"===t?-30:125,",-5)rotate(").concat("l"===t?0:180,")scale(0.15)")})]})}),[t,e,r.railmap])}},51401:function(n,t,r){r.r(t),r.d(t,{calculateColineStations:function(){return a},calculateColine:function(){return o}});var e=r(93433),c=r(23824),a=function(n,t){return n.map((function(n){var r=t.filter((function(t){return t.includes(n.from)&&t.includes(n.to)}));if(1!==r.length)return{linePath:[],colors:n.colors};var e=r.flat(),c=e.indexOf(n.from),a=e.indexOf(n.to);return{linePath:c<a?e.slice(c,a+1):e.slice(a,c+1),colors:n.colors}})).filter((function(n){return 0!==n.linePath.length}))},o=function(n,t){return n.map((function(n){var r=(0,c.drawLine)(n.linePath,t);return{main:[{linePath:r.main,colors:n.colors}],pass:[{linePath:r.pass,colors:n.colors}]}})).reduce((function(n,t){return n.main=[].concat((0,e.Z)(n.main),(0,e.Z)(t.main)),n.pass=[].concat((0,e.Z)(n.pass),(0,e.Z)(t.pass)),n}),{main:[],pass:[]})}}}]);
//# sourceMappingURL=8097.fb45e25d.chunk.js.map