"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[3331,7250,3824],{17250:function(n,t,e){e.r(t);var r=e(45987),i=e(29439),a=e(1413),o=e(93433),s=e(72791),c=e(20713),l=e(37732),u=e(80184),f=["stnName","oneLine","directionPolarity"],h=["intInfos","direction"];t.default=function(n){var t=n.stnId,e=n.stnState,r=n.color,i=n.bank,s=n.direction,c=(0,l.Qy)((function(n){return n.param})),f=c.direction,h=c.info_panel_type,m=c.stn_list,x=c.loop,v=m[t],y=null!==s&&void 0!==s?s:f,p=x?0:([].concat((0,o.Z)(v.branch.left),(0,o.Z)(v.branch.right)).length?8+12*v.name[1].split("\\").length:0)*("r"===y?-1:1),j="",_={};"sh2020"===h?(j=3===v.services.length?"stn_sh_2020_direct":2===v.services.length?"stn_sh_2020_express":"stn_sh_2020",_.fill=-1===e?"gray":r||"var(--rmg-theme-colour)"):(j=3===v.services.length?"direct_sh":2===v.services.length?"express_sh":[].concat((0,o.Z)(v.transfer.info[0]),(0,o.Z)(v.transfer.info[1]||[])).length>0?"int2_sh":"stn_sh",_.stroke=-1===e?"gray":r||"var(--rmg-theme-colour)");var S=null!==i&&void 0!==i?i:0,Z=("l"===y?6:-6)+p+30*S,b=("sh2020"===h?-20:-6)+Math.abs(S)*("sh2020"===h?25:11),k=S?0:"l"===y?-45:45;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("use",(0,a.Z)((0,a.Z)({xlinkHref:"#".concat(j)},_),{},{transform:"translate(".concat(S*("sh2020"===h?5:0),",0)")+"rotate(".concat(90*S*("sh2020"===h?1:-1),")")})),(0,u.jsx)("g",{transform:"translate(".concat(Z,",").concat(b,")rotate(").concat(k,")"),children:(0,u.jsx)(d,{name:v.name,infos:v.transfer.info,stnState:e,direction:y,facility:v.facility,bank:S,oneLine:v.one_line,intPadding:v.int_padding})}),0===e?(0,u.jsx)(g,{}):void 0]})};var d=function(n){var t,e=n.name,r=n.infos,a=n.stnState,l=n.direction,f=n.facility,h=n.bank,d=n.oneLine,g=n.intPadding,v=s.useRef(null),y="l"===l?1:-1,p=f!==c.mV.none?30:0,S=h?-12:0,Z=s.useRef(null),b=s.useState(0),k=(0,i.Z)(b,2),w=k[0],L=k[1];s.useEffect((function(){var n,t;return L(null!==(n=null===(t=Z.current)||void 0===t?void 0:t.getBBox().width)&&void 0!==n?n:0)}),(0,o.Z)(JSON.stringify(r)));var N=g-w;return(0,u.jsxs)(u.Fragment,{children:[r.flat().length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("line",{x1:(S+p)*y,x2:N*y,stroke:-1===a?"gray":"black",strokeWidth:.5}),(0,u.jsx)(x,{ref:Z,intInfos:r,direction:l,transform:"translate(".concat(N*y,",-10.75)")})]}),f!==c.mV.none&&(0,u.jsx)("use",{xlinkHref:"#"+f,x:10*y,y:-30}),(0,u.jsxs)("g",{textAnchor:"l"===l?"start":"end",transform:"translate(".concat(p*y,",-14)"),children:[(0,u.jsx)(m,{ref:v,stnName:e,oneLine:d,directionPolarity:y,fill:-1===a?"gray":0===a?"red":"black"}),(null===(t=r[1])||void 0===t?void 0:t.length)>0&&(0,u.jsx)("g",{transform:"translate(".concat((N+w/2)*y,",-30)"),children:(0,u.jsx)(j,{osiInfos:r[1]})}),(0,o.Z)(r[2]||[]).length>0&&(0,u.jsx)("g",{transform:"translate(".concat((g+5)*y,",0)"),children:(0,u.jsx)(_,{osysiInfos:r[2],direction:n.direction})})]})]})},m=s.forwardRef((function(n,t){var e=n.stnName,c=n.oneLine,l=n.directionPolarity,h=(0,r.Z)(n,f),d=s.useRef(null),m=s.useState(0),g=(0,i.Z)(m,2),x=g[0],v=g[1];s.useEffect((function(){v(c?d.current.getBBox().width+5:0)}),[].concat((0,o.Z)(e),[c]));return(0,u.jsx)("g",(0,a.Z)((0,a.Z)({ref:t},h),{},{children:s.useMemo((function(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("g",{ref:d,children:e[0].split("\\").map((function(n,t,r){return(0,u.jsx)("text",{className:"rmg-name__zh",dy:-20*(r.length-1-t)+(c?8:-8*(e[1].split("\\").length-1)),children:n},t)}))}),(0,u.jsx)("g",{fontSize:8,transform:"translate(".concat(x*l,",0)"),children:e[1].split("\\").map((function(n,t,e){return(0,u.jsx)("text",{className:"rmg-name__en",dy:-8*(e.length-2-t)+2,children:n},t)}))})]})}),[].concat((0,o.Z)(e),[c,x,l]))}))})),g=function(){var n=(0,l.Qy)((function(n){return n.param})).stn_list,t=[-1,35,50,75][new Set(Object.values(n).map((function(n){return n.services})).flat()).size];return(0,u.jsx)("g",{transform:"translate(0, ".concat(t,")"),children:(0,u.jsx)("text",{className:"rmg-name__zh",fill:"red",textAnchor:"middle",children:"\u672c\u7ad9"})})},x=s.forwardRef((function(n,t){var e,i=n.intInfos,s=(n.direction,(0,r.Z)(n,h)),c=[].concat((0,o.Z)(i[0]),(0,o.Z)(i[1]||[]),(0,o.Z)((null===(e=i[2])||void 0===e?void 0:e.filter((function(n){return Boolean(n[4].match(/^\u78c1(\u60ac)*\u6d6e/))})))||[])),l=0;return(0,u.jsx)("g",(0,a.Z)((0,a.Z)({ref:t,fontSize:14,textAnchor:"middle"},s),{},{children:c.map((function(t,e){var r=Boolean(t[4].match(/^\d.*$/)),i=Boolean(t[4].match(/^\u78c1(\u60ac)*\u6d6e/));"r"===n.direction&&(l-=(r||i?20:14*t[4].length+12)+(0===e?0:5));var a=(0,u.jsx)("g",{});return a=i?(0,u.jsx)("g",{transform:"translate(".concat(l,",-16)scale(0.1428571429)"),children:(0,u.jsx)(v,{info:t})},e):r?(0,u.jsx)("g",{transform:"translate(".concat(l,",0)"),children:(0,u.jsx)(y,{info:t})},e):(0,u.jsx)("g",{transform:"translate(".concat(l,",0)"),children:(0,u.jsx)(p,{info:t})},e),"l"===n.direction&&(l+=r||i?25:14*t[4].length+12+5),a}))}))})),v=s.memo((function(n){return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)("use",{xlinkHref:"#intbox_maglev",fill:n.info[2],stroke:n.info[2]})})}),(function(n,t){return n.info.toString()===t.info.toString()})),y=s.memo((function(n){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("use",{xlinkHref:"#intbox_number",fill:n.info[2]}),(0,u.jsx)("text",{x:10,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].match(/(\d*)\w+/)[0]})]})}),(function(n,t){return n.info.toString()===t.info.toString()})),p=s.memo((function(n){var t=n.info[4].split("\\")[0].length;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("rect",{height:22,width:14*t+12,y:-11,fill:n.info[2]}),(0,u.jsx)("text",{x:7*t+6,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].split("\\")[0]})]})}),(function(n,t){return n.info.toString()===t.info.toString()})),j=function(n){var t=n.osiInfos.map((function(n){return n[4]})).join("\uff0c");return s.useMemo((function(){return(0,u.jsxs)("g",{textAnchor:"middle",fontSize:"50%",children:[(0,u.jsx)("text",{className:"rmg-name__zh",dy:-5,children:"\u6362\u4e58".concat(t)}),(0,u.jsx)("text",{className:"rmg-name__zh",dy:5,children:"\u4ec5\u9650\u516c\u5171\u4ea4\u901a\u5361"}),(0,u.jsx)("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]})}),[t.toString()])},_=function(n){var t=n.osysiInfos.map((function(n){return n[4]})).join("\uff0c"),e=n.osysiInfos.map((function(n){return n[5]})).join(", ");return s.useMemo((function(){return(0,u.jsxs)("g",{textAnchor:"l"===n.direction?"start":"end",fontSize:"50%",children:[(0,u.jsxs)("text",{className:"rmg-name__zh",dy:3,children:["\u8f6c\u4e58",t]}),(0,u.jsxs)("text",{className:"rmg-name__en",dy:10,fontSize:"75%",children:["To ",e]})]})}),[n.osysiInfos.toString(),n.direction])}},23824:function(n,t,e){e.r(t),e.d(t,{adjacencyList:function(){return f},criticalPathMethod:function(){return h},getXShareMTR:function(){return d},getStnState:function(){return m},Stations:function(){return g},drawLine:function(){return x}});var r=e(29439),i=e(15671),a=e(43144),o=e(93433),s=e(37762),c=e(4942),l=e(1413),u=e(20713),f=function(n,t,e){return Object.keys(n).reduce((function(r,i){return(0,l.Z)((0,l.Z)({},r),{},(0,c.Z)({},i,n[i].children.reduce((function(r,a){return(0,l.Z)((0,l.Z)({},r),{},(0,c.Z)({},a,1+t(n,a)+e(n,i)))}),{})))}),{})},h=function n(t,e,r){if(t===e)return{len:0,nodes:[t]};var i=[],a=[];Object.keys(r[t]).forEach((function(o){var s=n(o,e,r);s.len<0||(i.push(r[t][o]+s.len),s.nodes.unshift(t),a.push(s.nodes))}));var o=Math.max.apply(Math,i);return{len:o,nodes:a[i.indexOf(o)]}},d=function(n,t,e){var r=h("linestart","lineend",t);if(r.nodes.includes(n))return h(r.nodes[1],n,t).len;for(var i=e.filter((function(t){return t.includes(n)}))[0],a=n;!r.nodes.includes(a);)a=i[i.indexOf(a)-1];for(var o=n;!r.nodes.includes(o);)o=i[i.indexOf(o)+1];var s="linestart"===a,c=[];return s||"lineend"===o?s?(c[0]=0,c[1]=h(r.nodes[1],o,t).len,c[2]=h(i[1],n,t).len,c[3]=h(n,o,t).len):(c[0]=h(r.nodes[1],a,t).len,c[1]=h(a,r.nodes.slice(-2)[0],t).len,c[2]=h(a,n,t).len,c[3]=h(n,i.slice(-2)[0],t).len):(c[0]=h(r.nodes[1],a,t).len,c[1]=h(a,o,t).len,c[2]=h(a,n,t).len,c[3]=h(n,o,t).len),c[0]+c[2]*c[1]/(c[2]+c[3])},m=function(n,t,e){var r;return console.log("computing stations' states"),(0,o.Z)(new Set((r=[]).concat.apply(r,(0,o.Z)(t)))).reduce((function(r,i){return(0,l.Z)((0,l.Z)({},r),{},(0,c.Z)({},i,i===n?0:(e===u.wA.right?function(n,t,e){var r,i=(0,s.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.indexOf(n),c=a.indexOf(t);if(-1!==o&&o<c)return!0}}catch(l){i.e(l)}finally{i.f()}return!1}(n,i,t):function(n,t,e){var r,i=(0,s.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.indexOf(n),c=a.indexOf(t);if(-1!==c&&c<o)return!0}}catch(l){i.e(l)}finally{i.f()}return!1}(n,i,t))?1:-1))}),{})},g=function(){function n(t){var e=this;(0,i.Z)(this,n),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(n){return 0},this.rightWideFactor=function(n){return 0},this.pathTurnParams=function(n){var t=35-17.5*Math.sqrt(3),e=n-2*t;return{tr:35,dx_a:17.5,dy_a:t,dx_l:e*Math.sqrt(3),dy_l:e}},this.pathTurnSE=function(n){var t=e.pathTurnParams(n),r=t.tr,i=t.dx_a,a=t.dy_a,o=t.dx_l,s=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,1 ").concat(i,",").concat(a," l ").concat(o,",").concat(s," a ").concat(r,",").concat(r," 0 0,0 ").concat(i,",").concat(a)},this.pathTurnNE=function(n){var t=e.pathTurnParams(n),r=t.tr,i=t.dx_a,a=t.dy_a,o=t.dx_l,s=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,0 ").concat(i,",").concat(-a," l ").concat(o,",").concat(-s," a ").concat(r,",").concat(r," 0 0,1 ").concat(i,",").concat(-a)},this.stnList=t.stnList,this.criticalPath=t.criticalPath}return(0,a.Z)(n,[{key:"getYShare",value:function(n,t){if(n in this.yShares)return this.yShares[n];if(["linestart","lineend"].includes(n)||this.stnList[n].parents.length>1||this.stnList[n].children.length>1)return this.yShares[n]=0,0;var e=this.stnList[n].parents[0];if(e){if(1===this.stnList[e].children.length){var r=this.getYShare(e);return this.yShares[n]=r,r}var i=0===this.stnList[e].children.indexOf(n)?1:-1;return this.yShares[n]=i,i}return this.yShares[n]=0,0}},{key:"_linePath",value:function(n,t,e,i,a,o,s,c){var l=this,u=(0,r.Z)([],3),f=u[0],h=u[1],d=u[2],m=[],g=this.pathTurnParams(o),x=g.dx_a+g.dx_l/2,v=(t[1]-t[0])/s.len*2,y=((t[1]-t[0])/s.len-2*x)/2;return y+v<0&&console.warn("SVG width too small! ".concat(y+v)),n.forEach((function(t){var r=i[t],s=a[t];if(!h&&0!==h)return f=t,d=r,h=s,void(1===n.length?m.push("M ".concat(r,",").concat(s)):e[0].includes(t)?e[0].includes(n[1])?m.push("M ".concat(r,",").concat(s)):(i[n[1]]>0&&m.push("M ".concat(r,",").concat(s+c)),a[n[1]]<0&&m.push("M ".concat(r,",").concat(s-c))):m.push("M ".concat(r,",").concat(s)));s>h?(m.push("h ".concat(0===s?r-d-v*l.leftWideFactor(t)-y-2*x:v*l.rightWideFactor(f)+y)),m.push(l.pathTurnSE(o))):s<h&&(m.push("h ".concat(0===s?r-d-v*l.leftWideFactor(t)-y-2*x:v*l.rightWideFactor(f)+y)),m.push(l.pathTurnNE(o))),m.push("H ".concat(r)),f=t,d=r,h=s})),m.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(n,t){console.log("computing y shares");var e=new this({stnList:n});return Object.keys(n).forEach((function(n){["linestart","lineend"].includes(n)||n in e.yShares||e.getYShare(n,t)})),e.yShares}}]),n}(),x=function(n,t){var e=(n=n.filter((function(n){return!["linestart","lineend"].includes(n)}))).filter((function(n){return t[n]>=0})),r=n.filter((function(n){return t[n]<=0}));return 1===e.length&&(r=n),0===e.filter((function(n){return-1!==r.indexOf(n)})).length&&e.length&&(r[0]===n[0]?r.push(e[0]):e[0]===n[0]&&e[e.length-1]===n[n.length-1]&&r.length?(r=n,e=[]):r.unshift(e[e.length-1])),{main:e,pass:r}}},37762:function(n,t,e){e.d(t,{Z:function(){return i}});var r=e(40181);function i(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=(0,r.Z)(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var i=0,a=function(){};return{s:a,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return s=n.done,n},e:function(n){c=!0,o=n},f:function(){try{s||null==e.return||e.return()}finally{if(c)throw o}}}}}}]);
//# sourceMappingURL=3331.6d1c8af2.chunk.js.map