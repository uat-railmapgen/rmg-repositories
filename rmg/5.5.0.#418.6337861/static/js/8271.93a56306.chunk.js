"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[8271,1136,8306],{51136:function(t,n,r){r.r(n),r.d(n,{LoopColine:function(){return s}});var e=r(29439),o=r(37732),i=r(36705),a=r(20713),c=r(80184),s=function(t){var n,r=t.edges,s=t.loop_stns,l=t.xs,u=t.ys,f=t.canvas,h=(0,e.Z)(r,4),p=h[0],d=h[1],g=h[2],_=(h[3],(0,o.Qy)((function(t){return t.param}))),m=_.info_panel_type,v=_.stn_list,x=_.coline,b=(0,o.Qy)((function(t){return t.helper})).branches,j=Object.values(x).filter((function(t){return[t.from,t.to].every((function(t){return b.slice(1,3).filter((function(t){return(0,i.Qo)(t,v)})).flat().includes(t)}))})).map((function(t){return t.colors})).at(0),Z=f===a.Ht.RailMap&&"sh2020"===m?3:0;return(0,c.jsxs)("g",{id:"coline_main",children:[(0,c.jsx)("path",{d:"M ".concat(p,",").concat(g," H").concat(d),strokeWidth:12,stroke:null===j||void 0===j||null===(n=j.at(0))||void 0===n?void 0:n.at(2)}),f===a.Ht.RailMap&&Object.keys(x).length>0&&s.top.map((function(t){var n;return(0,c.jsx)("g",{transform:"translate(".concat(l[t],",").concat(u[t],")"),children:"sh2020"===m?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("rect",{stroke:"none",height:24,width:12,x:-6,y:-Z-1,fill:null===j||void 0===j||null===(n=j.at(0))||void 0===n?void 0:n.at(2)}),(0,c.jsx)("rect",{stroke:"none",height:Z+12,width:12,x:-6,y:10,fill:"var(--rmg-theme-colour)"})]}):(0,c.jsx)("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:"translate(0,".concat(13,")")})},t)}))]})}},28271:function(t,n,r){r.r(n),r.d(n,{_linePath:function(){return _}});var e=r(29439),o=r(93433),i=r(4942),a=r(1413),c=(r(72791),r(17250)),s=r(25481),l=r(20713),u=r(37732),f=r(36705),h=r(68306),p=r(3628),d=r(51136),g=r(80184);n.default=function(t){var n,r,e=t.bank_angle,c=t.canvas,s=(0,u.Qy)((function(t){return t.helper})).branches,v=(0,u.Qy)((function(t){return t.param})),x=v.current_stn_idx,b=v.svgWidth,j=v.svg_height,Z=v.padding,y=v.branchSpacingPct,k=v.direction,M=v.info_panel_type,w=v.stn_list,E=v.loop_info,H=E.left_and_right_factor,O=E.bottom_factor,I=v.coline,R=s[0].filter((function(t){return!["linestart","lineend"].includes(t)})),Q=s.slice(0,3).flat().filter((r={},function(t){return 2===(r[t]=(r[t]||0)+1)})).filter((function(t){return!["linestart","lineend"].includes(t)})),L=null!==(n=Object.values(I).filter((function(t){return[t.from,t.to].every((function(t){return s.slice(1,3).filter((function(t){return(0,f.Qo)(t,w)})).flat().includes(t)}))})).map((function(t){var n=R.findIndex((function(n){return n===t.from})),r=R.findIndex((function(n){return n===t.to}));return Math.abs(r-n)>R.length-2-Math.abs(r-n)?"major":"minor"})).at(0))&&void 0!==n?n:"minor",C=Q.at(1)?(0,h.split_loop_stns_with_branches)(R,Q,H,L):Q.at(0)?(0,h.split_loop_stns_with_branch)(R,Q[0],O,H):(0,h.split_loop_stns)(R,x,O,H),S=(0,h.get_xshares_yshares_of_loop)(R,C),W=S.x_shares,P=S.y_shares,B=(0,p.get_loop_branches)(s,Q,b[c],Z,H,C.bottom.length),D=B.loop_branches,F=B.line_xs_branches,K=B.xs_branches,q=(0,a.Z)((0,a.Z)({},P),Object.fromEntries(D.flat().map((function(t){return[t,0]})))),z=y*j/300,A=[225+z,j-75-(c===l.Ht.RailMap?0:125)-z],G=Object.keys(q).reduce((function(t,n){return(0,a.Z)((0,a.Z)({},t),{},(0,i.Z)({},n,A[0]+q[n]*(A[1]-A[0])))}),{}),J=[Math.max(b[c]*Z/100+(e&&c===l.Ht.RailMap?100:0),F[0]),Math.min(b[c]*(1-Z/100)-(e&&c===l.Ht.RailMap?100:0),F[1])],N=Object.keys(W).reduce((function(t,n){return(0,a.Z)((0,a.Z)({},t),{},(0,i.Z)({},n,J[0]+W[n]*(J[1]-J[0])))}),{}),T=e?{l:1,r:-1}[k]:0;[].concat((0,o.Z)(C.right),(0,o.Z)(C.left)).forEach((function(t){N[t]-=(G[t]-A[0])*T})),C.bottom.forEach((function(t){N[t]-=(A[1]-A[0])*T}));var U=(0,a.Z)((0,a.Z)({},K),N),V=_(C,U,G,T,[].concat(J,A),k),X=c===l.Ht.RailMap&&"sh2020"===M?3:0;Object.keys(I).length>0&&C.top.forEach((function(t){G[t]-=X+12}));var Y=D.length?0:(A[1]-A[0])*T/2;return(0,g.jsxs)("g",{id:"loop",transform:"translate(".concat(Y,",0)"),children:[(0,g.jsx)("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:V,strokeLinejoin:"round"}),c===l.Ht.RailMap&&(0,g.jsx)(m,{canvas:c,loop_stns:C,xs:U,ys:G}),(0,g.jsxs)("g",{transform:"translate(0,".concat(Object.keys(I).length>0?-12-X:0,")"),children:[(0,g.jsx)(p.LoopBranches,{loop_branches:D,edges:[].concat(J,A),xs:U,ys:G,canvas:c}),Object.keys(I).length>0&&(0,g.jsx)(d.LoopColine,{edges:[].concat(J,A),loop_stns:C,xs:U,ys:G,canvas:c})]}),c===l.Ht.Indoor&&(0,g.jsx)(m,{canvas:c,loop_stns:C,xs:U,ys:G})]})};var _=function(t,n,r,o,i,a){var c=(0,e.Z)(i,4),s=c[0],l=c[1],u=c[2],f=c[3],h=function(t,n,r,e,i){return{right:[r+(e-u)*o,n],bottom:[t-(f-n)*o,e],left:[r-(f-e)*o,n],top:[t+(n-u)*o,e]}[i]},p=[];t.top.forEach((function(t){p.push([n[t],r[t]])})),["right","bottom","left"].forEach((function(e){if(t[e].length>0)p.push(h(p.at(-1)[0],p.at(-1)[1],n[t[e][0]],r[t[e][0]],e)),t[e].forEach((function(t){p.push([n[t],r[t]])}));else{var i={right:[l,p.at(-1)[1]],bottom:[p.at(-1)[0]+(f-p.at(-1)[1])*-o,p.at(-1)[1]+(f-p.at(-1)[1])],left:[s+(0===o?0:(f-u)*("l"===a?-1:1)),p.at(-1)[1]]};p.push(i[e])}})),p.push(h(p.at(-1)[0],p.at(-1)[1],n[t.top[0]],r[t.top[0]],"top"));var d=p.slice(1).map((function(t){var n=(0,e.Z)(t,2),r=n[0],o=n[1];return"L".concat(r,",").concat(o," ")})).join(" ");return"M".concat(p[0][0],",").concat(p[0][1]," ").concat(d," Z")},m=function(t){var n=t.canvas,r=t.loop_stns,o=t.xs,i=t.ys,a=(0,u.Qy)((function(t){return t.param})).current_stn_idx,f={top:0,bottom:0,left:-1,right:1},h={left:"r",right:"l",top:void 0,bottom:void 0},p=function(t,n){return{top:n%2===0?"upward":"downward",bottom:n%2===0?"upward":"downward",left:"left",right:"right"}[t]};return(0,g.jsxs)("g",{id:"loop_stations",children:[n===l.Ht.RailMap&&Object.entries(r).map((function(t){var n=(0,e.Z)(t,2),r=n[0];return n[1].map((function(t){return(0,g.jsx)("g",{transform:"translate(".concat(o[t],",").concat(i[t],")"),children:(0,g.jsx)(c.default,{stnId:t,stnState:a===t?0:1,bank:f[r],direction:h[r]})},t)}))})),n===l.Ht.Indoor&&Object.entries(r).map((function(t){var n=(0,e.Z)(t,2),r=n[0];return n[1].map((function(t,n){return(0,g.jsx)("g",{transform:"translate(".concat(o[t],",").concat(i[t],")"),children:(0,g.jsx)(s.StationSHMetro,{stnId:t,nameDirection:p(r,n),services:[l.K9.local]})},t)}))}))]})}},68306:function(t,n,r){r.r(n),r.d(n,{split_loop_stns:function(){return i},split_loop_stns_with_branch:function(){return a},split_loop_stns_with_branches:function(){return c},get_xshares_yshares_of_loop:function(){return s},get_pivot_stations:function(){return l}});var e=r(29439),o=r(93433),i=function(t,n,r,e){var i=t.length-2*e-r,a=t.findIndex((function(t){return t===n})),c=[].concat((0,o.Z)(t),(0,o.Z)(t),(0,o.Z)(t)),s=t.length+a-Math.floor(i/2)+(i%2===0?1:0),l=t.length+a+Math.floor(i/2);return{top:c.slice(s,l+1),left:c.slice(s-e,s),right:c.slice(l+1,l+1+e),bottom:c.slice(l+1+e,l+1+e+r)}},a=function(t,n,r,e){var i=t.length-2*e-r,a=[].concat((0,o.Z)(t),(0,o.Z)(t),(0,o.Z)(t)),c=t.length+t.findIndex((function(t){return t===n})),s=a[c+i-1],l=t.length+t.findIndex((function(t){return t===s}))+(c+i>2*t.length?t.length:0);return{top:a.slice(c,l+1),left:a.slice(c-e,c),right:a.slice(l+1,l+1+e),bottom:a.slice(l+1+e,l+1+e+r)}},c=function(t,n,r,o){var i=t.findIndex((function(t){return t===n[0]})),c=t.findIndex((function(t){return t===n[1]})),s=i>c?[c,i,n[1],n[0]]:[i,c,n[0],n[1]],l=(0,e.Z)(s,4);i=l[0],c=l[1],n[0]=l[2],n[1]=l[3];var u=t.slice(i,c+1),f=t.filter((function(t){return!u.filter((function(t){return!n.includes(t)})).includes(t)})),h=t.length-("major"===o?Math.max:Math.min)(u.length,f.length)-2*r,p="major"===o?u.length>f.length?n[0]:n[1]:u.length>f.length?n[1]:n[0];return a(t,p,h,r)},s=function(t,n){var r=Object.fromEntries(t.map((function(t){return[t,-1]}))),e=Object.fromEntries(t.map((function(t){return[t,-1]})));return n.top.forEach((function(t,o){r[t]=0+1/(n.top.length+1)*(o+1),e[t]=0})),n.right.forEach((function(t,o){r[t]=1,e[t]=0+1/(n.right.length+1)*(o+1)})),n.bottom.forEach((function(t,o){r[t]=1-1/(n.bottom.length+1)*(o+1),e[t]=1})),n.left.forEach((function(t,o){r[t]=0,e[t]=1-1/(n.left.length+1)*(o+1)})),{x_shares:r,y_shares:e}},l=function(t,n,r,e){var i=t[0].filter((function(t){return!["linestart","lineend"].includes(t)})),a=[].concat((0,o.Z)(i),(0,o.Z)(i),(0,o.Z)(i)),c="r"===n?a:a.reverse(),s=c.findIndex((function(t){return e===t}))+i.length;return c.slice(s+1).filter((function(t){return r[t].loop_pivot})).slice(void 0,2)}}}]);
//# sourceMappingURL=8271.93a56306.chunk.js.map