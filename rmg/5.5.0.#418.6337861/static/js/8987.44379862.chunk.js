"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[8987,3824],{8987:function(n,t,e){e.r(t);var r=e(4942),i=e(1413),a=e(72791),c=e(23824),o=e(37732),u=e(80184);t.default=function(){var n,t=(0,o.Qy)((function(n){return n.helper})).branches,e=(0,o.Qy)((function(n){return n.param})),f=(0,c.adjacencyList)(e.stn_list,s,l),d=(0,a.useMemo)((function(){return(0,c.criticalPathMethod)("linestart","lineend",f)}),[JSON.stringify(f)]),y=(0,a.useMemo)((function(){return(0,c.criticalPathMethod)(d.nodes[1],d.nodes.slice(-2)[0],f)}),[JSON.stringify(f)]),p=(0,a.useMemo)((function(){return console.log("computing x shares"),Object.keys(e.stn_list).reduce((function(n,e){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},e,h(e,f,t)))}),{})}),[t.toString(),JSON.stringify(f)]),g=[e.svgWidth.railmap*e.padding/100,e.svgWidth.railmap*(1-e.padding/100)];Object.keys(p).reduce((function(n,t){return(0,i.Z)((0,i.Z)({},n),{},(0,r.Z)({},t,g[0]+p[t]/y.len*(g[1]-g[0])))}),{});return(0,u.jsx)("g",{id:"main",style:(n={},(0,r.Z)(n,"--y-percentage",e.y_pc),(0,r.Z)(n,"transform","translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"),n)})};var s=function(n,t){return 1},l=function(n,t){return 1},h=c.getXShareMTR},23824:function(n,t,e){e.r(t),e.d(t,{adjacencyList:function(){return h},criticalPathMethod:function(){return f},getXShareMTR:function(){return d},getStnState:function(){return y},Stations:function(){return p},drawLine:function(){return g}});var r=e(29439),i=e(15671),a=e(43144),c=e(93433),o=e(37762),u=e(4942),s=e(1413),l=e(20713),h=function(n,t,e){return Object.keys(n).reduce((function(r,i){return(0,s.Z)((0,s.Z)({},r),{},(0,u.Z)({},i,n[i].children.reduce((function(r,a){return(0,s.Z)((0,s.Z)({},r),{},(0,u.Z)({},a,1+t(n,a)+e(n,i)))}),{})))}),{})},f=function n(t,e,r){if(t===e)return{len:0,nodes:[t]};var i=[],a=[];Object.keys(r[t]).forEach((function(c){var o=n(c,e,r);o.len<0||(i.push(r[t][c]+o.len),o.nodes.unshift(t),a.push(o.nodes))}));var c=Math.max.apply(Math,i);return{len:c,nodes:a[i.indexOf(c)]}},d=function(n,t,e){var r=f("linestart","lineend",t);if(r.nodes.includes(n))return f(r.nodes[1],n,t).len;for(var i=e.filter((function(t){return t.includes(n)}))[0],a=n;!r.nodes.includes(a);)a=i[i.indexOf(a)-1];for(var c=n;!r.nodes.includes(c);)c=i[i.indexOf(c)+1];var o="linestart"===a,u=[];return o||"lineend"===c?o?(u[0]=0,u[1]=f(r.nodes[1],c,t).len,u[2]=f(i[1],n,t).len,u[3]=f(n,c,t).len):(u[0]=f(r.nodes[1],a,t).len,u[1]=f(a,r.nodes.slice(-2)[0],t).len,u[2]=f(a,n,t).len,u[3]=f(n,i.slice(-2)[0],t).len):(u[0]=f(r.nodes[1],a,t).len,u[1]=f(a,c,t).len,u[2]=f(a,n,t).len,u[3]=f(n,c,t).len),u[0]+u[2]*u[1]/(u[2]+u[3])},y=function(n,t,e){var r;return console.log("computing stations' states"),(0,c.Z)(new Set((r=[]).concat.apply(r,(0,c.Z)(t)))).reduce((function(r,i){return(0,s.Z)((0,s.Z)({},r),{},(0,u.Z)({},i,i===n?0:(e===l.wA.right?function(n,t,e){var r,i=(0,o.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,c=a.indexOf(n),u=a.indexOf(t);if(-1!==c&&c<u)return!0}}catch(s){i.e(s)}finally{i.f()}return!1}(n,i,t):function(n,t,e){var r,i=(0,o.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,c=a.indexOf(n),u=a.indexOf(t);if(-1!==u&&u<c)return!0}}catch(s){i.e(s)}finally{i.f()}return!1}(n,i,t))?1:-1))}),{})},p=function(){function n(t){var e=this;(0,i.Z)(this,n),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(n){return 0},this.rightWideFactor=function(n){return 0},this.pathTurnParams=function(n){var t=35-17.5*Math.sqrt(3),e=n-2*t;return{tr:35,dx_a:17.5,dy_a:t,dx_l:e*Math.sqrt(3),dy_l:e}},this.pathTurnSE=function(n){var t=e.pathTurnParams(n),r=t.tr,i=t.dx_a,a=t.dy_a,c=t.dx_l,o=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,1 ").concat(i,",").concat(a," l ").concat(c,",").concat(o," a ").concat(r,",").concat(r," 0 0,0 ").concat(i,",").concat(a)},this.pathTurnNE=function(n){var t=e.pathTurnParams(n),r=t.tr,i=t.dx_a,a=t.dy_a,c=t.dx_l,o=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,0 ").concat(i,",").concat(-a," l ").concat(c,",").concat(-o," a ").concat(r,",").concat(r," 0 0,1 ").concat(i,",").concat(-a)},this.stnList=t.stnList,this.criticalPath=t.criticalPath}return(0,a.Z)(n,[{key:"getYShare",value:function(n,t){if(n in this.yShares)return this.yShares[n];if(["linestart","lineend"].includes(n)||this.stnList[n].parents.length>1||this.stnList[n].children.length>1)return this.yShares[n]=0,0;var e=this.stnList[n].parents[0];if(e){if(1===this.stnList[e].children.length){var r=this.getYShare(e);return this.yShares[n]=r,r}var i=0===this.stnList[e].children.indexOf(n)?1:-1;return this.yShares[n]=i,i}return this.yShares[n]=0,0}},{key:"_linePath",value:function(n,t,e,i,a,c,o,u){var s=this,l=(0,r.Z)([],3),h=l[0],f=l[1],d=l[2],y=[],p=this.pathTurnParams(c),g=p.dx_a+p.dx_l/2,v=(t[1]-t[0])/o.len*2,S=((t[1]-t[0])/o.len-2*g)/2;return S+v<0&&console.warn("SVG width too small! ".concat(S+v)),n.forEach((function(t){var r=i[t],o=a[t];if(!f&&0!==f)return h=t,d=r,f=o,void(1===n.length?y.push("M ".concat(r,",").concat(o)):e[0].includes(t)?e[0].includes(n[1])?y.push("M ".concat(r,",").concat(o)):(i[n[1]]>0&&y.push("M ".concat(r,",").concat(o+u)),a[n[1]]<0&&y.push("M ".concat(r,",").concat(o-u))):y.push("M ".concat(r,",").concat(o)));o>f?(y.push("h ".concat(0===o?r-d-v*s.leftWideFactor(t)-S-2*g:v*s.rightWideFactor(h)+S)),y.push(s.pathTurnSE(c))):o<f&&(y.push("h ".concat(0===o?r-d-v*s.leftWideFactor(t)-S-2*g:v*s.rightWideFactor(h)+S)),y.push(s.pathTurnNE(c))),y.push("H ".concat(r)),h=t,d=r,f=o})),y.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(n,t){console.log("computing y shares");var e=new this({stnList:n});return Object.keys(n).forEach((function(n){["linestart","lineend"].includes(n)||n in e.yShares||e.getYShare(n,t)})),e.yShares}}]),n}(),g=function(n,t){var e=(n=n.filter((function(n){return!["linestart","lineend"].includes(n)}))).filter((function(n){return t[n]>=0})),r=n.filter((function(n){return t[n]<=0}));return 1===e.length&&(r=n),0===e.filter((function(n){return-1!==r.indexOf(n)})).length&&e.length&&(r[0]===n[0]?r.push(e[0]):e[0]===n[0]&&e[e.length-1]===n[n.length-1]&&r.length?(r=n,e=[]):r.unshift(e[e.length-1])),{main:e,pass:r}}},37762:function(n,t,e){e.d(t,{Z:function(){return i}});var r=e(40181);function i(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=(0,r.Z)(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var i=0,a=function(){};return{s:a,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,u=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return o=n.done,n},e:function(n){u=!0,c=n},f:function(){try{o||null==e.return||e.return()}finally{if(u)throw c}}}}}}]);
//# sourceMappingURL=8987.44379862.chunk.js.map