!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}var e=["num","inStrip"],n=["stnName","onUpdate","passed"],r=["passed"],a=["intInfos","stnState","tickRotation"],s=["intInfos","tickRotation","stnState"],i=["destIds","textAnchor"],c=["destIds"],o=["secName"],l=["num"];function u(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,s,i,c=[],o=!0,l=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=s.call(n)).done)&&(c.push(r.value),c.length!==e);o=!0);}catch(u){l=!0,a=u}finally{try{if(!o&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return c}}(t,e)||f(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(e,n,r){return(n=function(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!==t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===t(n)?n:String(n)}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function p(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n,r,a={},s=Object.keys(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}System.register(["./chakra-legacy-eeb88485.js","./react-legacy-125cc24e.js","./index-legacy-0c16d8df.js","./share-legacy-fe879160.js","./param-updater-utils-legacy-36a34844.js"],(function(t,f){"use strict";var d,h,j,y,v,_,S,z,b,N,w,O,k,A,R;return{setters:[function(t){d=t.j},function(t){h=t.r},function(t){j=t.i,y=t.be,v=t.u,_=t.x,S=t.S,z=t.bc,b=t.a3},function(t){N=t.a,w=t.c,O=t.b,k=t.d,A=t.S},function(t){R=t.i}],execute:function(){function f(t){var n=t.num,r=t.inStrip,a=p(t,e);return d.jsxs("g",x(x({textAnchor:"middle",fill:r?j.black:"var(--rmg-theme-fg)"},a),{},{children:[d.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:r?"#fff":"var(--rmg-theme-colour)"}),d.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:n}),d.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),d.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]}))}var B=function(t){var e=function(t){switch(t){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":return 20;default:return 0}}(t.variant),n=h.useMemo((function(){switch(t.variant){case"gz1":return d.jsx("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return d.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return d.jsx("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return d.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return d.jsx("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return d.jsx("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return d.jsx("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return d.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});default:return d.jsx(d.Fragment,{})}}),[t.variant]);return d.jsxs("g",{transform:"translate(0,".concat("gz4"===t.variant?-20:0,")"),children:[d.jsx("rect",{id:"strip_gz",style:g({},"--height","".concat(e,"px"))}),d.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:t.isShowLight&&n}),!1!==t.isShowPSD&&d.jsx(I,x({},t))]})},I=h.memo((function(t){var e,n=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),r=function(t){switch(t){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";default:return"58px"}}(t.variant);return d.jsx(f,{num:t.isShowPSD,inStrip:n,style:(e={},g(e,"--psd-dy",r),g(e,"transform","translate(var(--translate-x), var(--translate-y))"),g(e,"--translate-x","calc(var(--rmg-svg-width) / 2 + 80px)"),g(e,"--translate-y","calc(var(--rmg-svg-height) - var(--psd-dy, 58px))"),e)})}),(function(t,e){return t.variant===e.variant&&t.isShowPSD===e.isShowPSD})),M=globalThis&&globalThis.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,s=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},E=h.memo((function(t){var e=t.lineName,n=t.commonPart,r=h.useRef(null),a=M(h.useState({x:0,height:0,width:0}),2),s=a[0],i=a[1];h.useEffect((function(){r.current&&i(r.current.getBBox())}),[e.toString()]);var c=C/Math.max(C,s.width),o=(-s.x-s.width/2)*c,l=s.height*(1-c)*1.2/2;return d.jsx("g",{ref:r,transform:"translate(".concat(o,",").concat(l,")scale(").concat(c,")"),children:d.jsxs("text",{className:"rmg-name__zh",fontSize:14,y:12,textAnchor:"end",children:[n,d.jsx("tspan",{className:"rmg-name__zh",fontSize:8,x:0,dy:-2,textAnchor:"start",children:e[0].slice(n.length).trim()}),d.jsx("tspan",{className:"rmg-name__en",fontSize:4,x:0,dy:6,textAnchor:"start",children:e[1].slice(n.length).trim()})]})})}),(function(t,e){return t.lineName.toString()===e.lineName.toString()})),P=globalThis&&globalThis.__assign||function(){return P=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},P.apply(this,arguments)};function T(t){return d.jsx("rect",P({x:-22.5,height:24,width:45,rx:4.5},t))}var H=globalThis&&globalThis.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,s=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},C=42,D=h.memo((function(t){var e=t.lineName,n=t.foregroundColour,r=t.backgroundColour,a=t.passed,s=H(W(e),2),i=s[0],c=s[1],o=h.useRef(null),l=h.useRef(null),u=H(h.useState({width:0}),2),m=u[0],f=u[1],x=H(h.useState({width:0}),2),g=x[0],p=x[1];h.useEffect((function(){o.current&&f(o.current.getBBox()),l.current&&p(l.current.getBBox())}),[e.toString()]);var y=C/Math.max(C,m.width),v=C/Math.max(C,g.width),_={nameZh:{y:7.3+13.5*(1-y)*y/2},nameEn:{y:19.5-9*(1-v)*v/2}};return d.jsxs("g",{textAnchor:"middle",fill:a?j.white:n,children:[d.jsx(T,{fill:a?"#aaa":r}),2===i?d.jsx(E,{lineName:e,commonPart:c}):d.jsxs(d.Fragment,{children:[d.jsx("text",{ref:o,className:"rmg-name__zh",fontSize:12,transform:"translate(0,".concat(_.nameZh.y,")scale(").concat(y,")"),children:1===i?d.jsxs(d.Fragment,{children:[d.jsx("tspan",{fontSize:16,dy:.7,className:"rmg-name__zh",children:c}),d.jsx("tspan",{dy:-.7,className:"rmg-name__zh",children:e[0].slice(c.length)})]}):e[0]}),d.jsx("text",{ref:l,className:"rmg-name__en",fontSize:8,transform:"translate(0,".concat(_.nameEn.y,")scale(").concat(v,")"),children:e[1]})]})]})}),(function(t,e){return t.lineName.toString()===e.lineName.toString()&&t.foregroundColour===e.foregroundColour&&t.backgroundColour===e.backgroundColour&&t.passed===e.passed})),W=function(t){var e=t[0].match(/^(\d+)\D+$/);if(e)return[1,e[1]];var n=t.map((function(t){return t.match(/^(\w+).+$/)}));return n[0]&&n[1]&&n[0][1]===n[1][1]?[2,n[0][1]]:[3,""]},F=h.memo((function(t){var e=t.stroke,n=t.large?"M0,12.95 V-12.95 H-12.95 a12.95,12.95 0 0,0 0,25.9 h25.9 a12.95,12.95 0 0,0 0,-25.9 H0":"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0";return d.jsx("path",{d:n,fill:"#fff",strokeWidth:2,stroke:e})}),(function(t,e){return t.stroke===e.stroke&&t.large===e.large})),U=globalThis&&globalThis.__assign||function(){return U=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},U.apply(this,arguments)},L=globalThis&&globalThis.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n},V=globalThis&&globalThis.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,s=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},G=15;function $(t){var e=t.lineNum,n=t.stnNum,r=t.strokeColour,a=t.passed,s=t.large,i=L(t,["lineNum","stnNum","strokeColour","passed","large"]),c=h.useRef(null),o=h.useRef(null),l=V(h.useState({width:0}),2),u=l[0],m=l[1],f=V(h.useState({width:0}),2),x=f[0],g=f[1];h.useEffect((function(){c.current&&m(c.current.getBBox()),o.current&&g(o.current.getBBox())}),[e,n]);var p=G/Math.max(G,u.width),j=2===e.length&&2===n.length?p:G/Math.max(G,x.width);return d.jsxs("g",U({},i,{children:[d.jsx(F,{stroke:a?"#aaa":r,large:s}),d.jsxs("g",{textAnchor:"middle",fontSize:13.5,transform:s?"scale(1.4)":"",fill:a?"#aaa":"#000",children:[d.jsx("g",{transform:"translate(-9.25,0)scale(".concat(p,")"),children:d.jsx("text",{ref:c,className:"rmg-name__zh",children:e})}),d.jsx("g",{transform:"translate(9.25,0)scale(".concat(j,")"),children:d.jsx("text",{ref:o,className:"rmg-name__zh",children:n})})]})]}))}var J=h.memo((function(t){var e=t.stnName,n=t.onUpdate,r=h.useRef(null);return h.useEffect((function(){r.current&&n&&n(r.current.getBBox())}),[e.toString()]),d.jsxs("g",{ref:r,children:[d.jsx("text",{className:"rmg-name__zh",fontSize:18,children:e[0]}),d.jsx("g",{fontSize:10.5,children:e[1].split("\\").map((function(t,e){return d.jsx("text",{className:"rmg-name__en",dy:16+11*e,children:t},e)}))})]})}),(function(t,e){return t.stnName.toString()===e.stnName.toString()}));function Y(t){var e=t.stnName,r=t.onUpdate,a=t.passed,s=p(t,n),i=h.useRef(null),c=m(h.useState({x:0,width:0}),2),o=c[0],l=c[1];return h.useEffect((function(){if(i.current){var t=i.current.getBBox();l(t),r&&r(t)}}),[e.toString()]),e[0]||e[1]?d.jsxs("g",x(x({fill:a?"#aaa":"#000"},s),{},{children:[d.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[d.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),d.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),d.jsxs("g",{ref:i,textAnchor:"middle",children:[d.jsx("text",{className:"rmg-name__zh",fontSize:13,children:e[0]}),d.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:e[1]})]})]})):d.jsx(d.Fragment,{})}function Z(t){var e=t.passed,n=p(t,r);return d.jsxs("g",x(x({textAnchor:"middle",fill:e?"#aaa":"var(--rmg-theme-colour)"},n),{},{children:[d.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),d.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]}))}function q(t){var e=t.primaryName,n=t.secondaryName,r=t.stationState,a=t.flipped,s=t.express,i=m(h.useState({width:0}),2),c=i[0],o=i[1],l=m(h.useState({x:0,width:-20}),2),u=l[0],f=l[1],x=e[1].split("\\").length,g={g:{x:0,y:a?17.5:-20-14*x*Math.cos(-45)},StationSecondaryName:{x:(c.width+u.width/2+10)*(a?-1:1),y:2+5*(x-1)},ExpressTag:{x:(c.width+u.width+20+35)*(a?-1:1),y:2+5*(x-1)}};return d.jsxs("g",{textAnchor:a?"end":"start",fill:function(t){switch(t){case y.PASSED:return"#aaa";case y.CURRENT:return"#f00";case y.FUTURE:return"#000"}}(r),transform:"translate(".concat(g.g.x,",").concat(g.g.y,")rotate(-45)"),children:[d.jsx(J,{stnName:e,onUpdate:o}),n&&d.jsx(Y,{stnName:n,onUpdate:f,passed:r===y.PASSED,transform:"translate(".concat(g.StationSecondaryName.x,",").concat(g.StationSecondaryName.y,")")}),s&&d.jsx(Z,{passed:r===y.PASSED,transform:"translate(".concat(g.ExpressTag.x,",").concat(g.ExpressTag.y,")")})]})}function K(t){var e=t.stnId,n=t.stnState,r=t.stnY,a=v((function(t){return t.param.theme})),s=v((function(t){return t.param.line_name})),i=v((function(t){return t.param.line_num})),c=v((function(t){return t.param.stn_list[e]})),o=2===c.parents.length||2===c.children.length,l=r>0||1===c.parents.indexOf(c.branch.left[1]||"")||1===c.children.indexOf(c.branch.right[1]||"")?180:0,m=c.name[1].split("\\").length,f=o?180===l?16+12*(m-1)*Math.cos(-45):-9:180===l?-6:(25+15*(m-1))*Math.cos(-45);return d.jsxs(d.Fragment,{children:[d.jsx(Q,{intInfos:o?[{theme:[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:s}].concat(u(c.transfer.groups[0].lines)):c.transfer.groups[0].lines,stnState:n,tickRotation:l}),d.jsx($,{lineNum:i,stnNum:c.num,strokeColour:a[2],passed:-1===n}),d.jsx("g",{transform:"translate(".concat(-f,",0)"),children:d.jsx(q,{primaryName:c.name,secondaryName:c.secondaryName||void 0,stationState:n,flipped:180===l,express:c.services.includes(_.express)})})]})}var Q=function(t){return d.jsxs(d.Fragment,{children:[d.jsx(X,x({strokeWidth:4},t)),d.jsx(tt,x({transform:"translate(0,".concat(180===t.tickRotation?-47:23,")")},t))]})},X=function(t){var e=t.intInfos,n=t.stnState,r=t.tickRotation,s=p(t,a);return d.jsx("g",x(x({},s),{},{children:e.map((function(t,a){var s;return d.jsx("use",{xlinkHref:"#inttick",stroke:-1===n?"#aaa":null===(s=t.theme)||void 0===s?void 0:s[2],transform:"translate(".concat(-2*(e.length-1)+4*a,",0)rotate(").concat(180===r?180:0,")")},a)}))}))},tt=function(t){var e=t.intInfos,n=t.tickRotation,r=t.stnState,a=p(t,s);return d.jsx("g",x(x({},a),{},{children:e.map((function(t,e){var a,s,i,c;return d.jsx("g",{transform:"translate(0,".concat(28*e*(180===n?-1:1),")"),children:d.jsx(D,{lineName:t.name,foregroundColour:null!==(a=null===(s=t.theme)||void 0===s?void 0:s[3])&&void 0!==a?a:j.white,backgroundColour:null!==(i=null===(c=t.theme)||void 0===c?void 0:c[2])&&void 0!==i?i:"#aaaaaa",passed:-1===r})},e)}))}))},et=function(t,e){return 2===t[e].parents.length||2===t[e].children.length?.25:0},nt=function(){var t,e=v((function(t){return t.helper})),n=e.branches,r=e.routes,a=e.depsStr,s=v((function(t){return t.param})),i=s.svgWidth,c=s.svg_height,o=s.y_pc,l=s.padding,u=s.branchSpacingPct,m=s.direction,f=s.line_name,p=s.current_stn_idx,j=s.stn_list,y=N(j,et,et),_=h.useMemo((function(){return console.log("computing x shares"),Object.keys(j).reduce((function(t,e){return x(x({},t),{},g({},e,function(t,e,n){var r=w("linestart","lineend",e);if(r.nodes.includes(t))return w(r.nodes[1],t,e).len;for(var a=n.filter((function(e){return e.includes(t)}))[0],s=t;!r.nodes.includes(s);)s=a[a.indexOf(s)-1];for(var i=t;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var c="linestart"===s,o="lineend"===i;if(a.toString()===n[0].toString()){var l=[];return c||o?c?(l[0]=0,l[1]=w(r.nodes[1],i,e).len,l[2]=w(a[1],t,e).len,l[3]=w(t,i,e).len):(l[0]=w(r.nodes[1],s,e).len,l[1]=w(s,r.nodes.slice(-2)[0],e).len,l[2]=w(s,t,e).len,l[3]=w(t,a.slice(-2)[0],e).len):(l[0]=w(r.nodes[1],s,e).len,l[1]=w(s,i,e).len,l[2]=w(s,t,e).len,l[3]=w(t,i,e).len),l[0]+l[2]*l[1]/(l[2]+l[3])}if(c||o)return c?w(r.nodes[1],i,e).len-w(t,i,e).len:w(r.nodes[1],s,e).len+w(s,t,e).len;var u=[];return u[0]=w(r.nodes[1],s,e).len,u[1]=w(s,i,e).len,u[2]=w(s,t,e).len,u[3]=w(t,i,e).len,u[0]+u[2]*u[1]/(u[2]+u[3])}(e,y,n)))}),{})}),[n.toString(),JSON.stringify(y)]),b=w("linestart","lineend",y),A=w(b.nodes[1],b.nodes.slice(-2)[0],y),R=m===S.right?[i[z.RailMap]*l/100+65,i[z.RailMap]*(1-l/100)-20]:[i[z.RailMap]*l/100,i[z.RailMap]*(1-l/100)-65],B=Object.keys(_).reduce((function(t,e){return x(x({},t),{},g({},e,R[0]+_[e]/A.len*(R[1]-R[0])))}),{}),I=h.useMemo((function(){return console.log("computing y shares"),Object.keys(j).reduce((function(t,e){if(n[0].includes(e))return x(x({},t),{},g({},e,0));var r=n.slice(1).filter((function(t){return t.includes(e)}))[0];return x(x({},t),{},g({},e,j[r[0]].children.indexOf(r[1])?-2:2))}),{})}),[a]),M=Object.keys(I).reduce((function(t,e){return x(x({},t),{},g({},e,-I[e]*u*c/200))}),{}),E=h.useMemo((function(){return O(p,r,m)}),[p,m,r.toString()]),P=n.map((function(t){return k(t,E)})).reduce((function(t,e){return t.main.push(e.main),t.pass.push(e.pass),t}),{main:[],pass:[]}),T=Object.keys(P).reduce((function(t,e){return x(x({},t),{},g({},e,P[e].map((function(t){return at(t,B,M)}))))}),{});return d.jsxs("g",{id:"main",style:(t={},g(t,"--y-percentage",o),g(t,"transform","translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"),t),children:[d.jsx(rt,{paths:T}),d.jsx(st,{xs:B,ys:M,stnStates:E}),d.jsx("g",{id:"line_name",style:g({},"--translate-x",m===S.right?"".concat(R[0]-65,"px"):"".concat(R[1]+65,"px")),children:d.jsx(D,{lineName:f,foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)"})})]})},rt=h.memo((function(t){return d.jsxs("g",{fill:"none",strokeWidth:4,children:[d.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((function(t,e){return d.jsx("path",{d:t},e)}))}),d.jsx("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((function(t,e){return d.jsx("path",{d:t},e)}))})]})}),(function(t,e){return JSON.stringify(t.paths)===JSON.stringify(e.paths)})),at=function(t,e,n){var r,a=[];return t.forEach((function(t){var s=e[t],i=n[t];if(!r&&0!==r)return r=i,void a.push("M ".concat(s,",").concat(i));0===i?(i<r&&a.push("H ".concat(s-40),"a 40,40 0 0,0 40,-40","V ".concat(i)),i>r&&a.push("H ".concat(s-40),"a 40,40 0 0,1 40,40","V ".concat(i))):(i<r&&a.push("V ".concat(i+40),"a 40,40 0 0,1 40,-40","H ".concat(s)),i>r&&a.push("V ".concat(i-40),"a 40,40 0 0,0 40,40","H ".concat(s))),a.push("H ".concat(s)),r=i})),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},st=function(t){var e=t.xs,n=t.ys,r=t.stnStates,a=v((function(t){return t.param.stn_list}));return d.jsx("g",{id:"stn_icons",children:Object.keys(a).filter((function(t){return!["linestart","lineend"].includes(t)})).map((function(t){return d.jsx("g",{style:{transform:"translate(".concat(e[t],"px,").concat(n[t],"px)")},children:d.jsx(K,{stnId:t,stnState:r[t],stnY:n[t]})},t)}))})};function it(t){return d.jsx("path",x({d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black"},t))}function ct(t){var e=t.destIds,n=t.textAnchor,r=p(t,i),a=v((function(t){return t.param.direction})),s=v((function(t){return t.param.stn_list})),c=e.map((function(t){return s[t].name[0].length})),o=Math.min.apply(Math,u(c)),l=o>1&&c[0]!==c[1]?Math.abs(c[0]-c[1])/(o-1):0;return d.jsxs("g",x(x({textAnchor:n},r),{},{children:[e.map((function(t,e){var r=c[e]>c[1-e],i=!R()&&"end"===n&&!r;return d.jsxs(h.Fragment,{children:[d.jsx("text",{className:"rmg-name__zh",fontSize:25,x:a===S.left?0:-75,y:42*e-21,letterSpacing:r?"0em":"".concat(l,"em"),dx:i?"".concat(l,"em"):"0em",children:s[t].name[0]}),d.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:a===S.left?0:-75,y:42*e-1,children:"Towards "+s[t].name[1].replace("\\"," ")})]},t)})),d.jsx("text",{className:"rmg-name__zh",fontSize:28,x:a===S.left?25*(Math.max.apply(Math,u(c))+1):0,y:5,children:"方向"})]}))}var ot=z.RailMap,lt=function(){var t=v((function(t){return t.app})).canvasScale,e=v((function(t){return t.param})),n=e.svgWidth,r=e.svg_height,a=e.direction,s=e.psd_num,i=e.info_panel_type,c=e.notesGZMTR,o=e.current_stn_idx,l=e.stn_list,u=e.theme,m=n[ot],f=l[o];return d.jsxs(A,{type:ot,svgWidth:m,svgHeight:r,canvasScale:t,theme:u,children:[d.jsx(ut,{}),d.jsx(B,{variant:i,isShowLight:i===b.gz2otis,isShowPSD:i===b.gz2otis&&s}),a===S.left&&f.parents.includes("linestart")||a===S.right&&f.children.includes("lineend")?d.jsx(dt,{}):d.jsxs(d.Fragment,{children:[d.jsx(nt,{}),d.jsx(mt,{}),c.map((function(t,e){return d.jsx(ht,{note:t},e)}))]}),i===b.gz2otis&&d.jsx("line",{x2:m,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},ut=h.memo((function(){return d.jsx("defs",{children:d.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"})})})),mt=function(){var t,e=v((function(t){return t.helper})).routes,n=v((function(t){return t.param})),r=n.direction,a=n.direction_gz_x,s=n.direction_gz_y,i=n.current_stn_idx,c=h.useMemo((function(){return u(new Set(e.reduce((function(t,e){return e.includes(i)?t.concat(e.filter((function(t){return!["linestart","lineend"].includes(t)})).slice(r===S.left?0:-1)[0]):t}),[]).filter((function(t){return t!==i}))))}),[i,r,e.toString()]),o={textAnchor:r===S.left?"start":"end",transform:"translate(".concat(r===S.left?65:-65,",-5)"),destIds:c};return d.jsxs("g",{id:"direction_gz",style:(t={},g(t,"--x-percentage",a),g(t,"--y-percentage",s),t),children:[d.jsx(it,{transform:"scale(0.35)rotate(".concat(r===S.left?0:180,")")}),2!==c.length?d.jsx(ft,x({},o)):d.jsx(ct,x({},o))]})},ft=function(t){var e=t.destIds,n=p(t,c),r=v((function(t){return t.param.stn_list}));return d.jsxs("g",x(x({},n),{},{children:[d.jsx("text",{className:"rmg-name__zh",fontSize:28,children:e.map((function(t){return r[t].name[0]})).join("/")+"方向"}),d.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+e.map((function(t){return r[t].name[1].replace("\\"," ")})).join("/")})]}))},dt=h.memo((function(){return d.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[d.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),d.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),d.jsxs("g",{strokeWidth:8,stroke:"#000",children:[d.jsx("path",{d:"M -160,68 h -160"}),d.jsx("path",{d:"M 160,68 h 160"})]})]})})),ht=h.memo((function(t){var e,n=h.useRef(null),r=m(h.useState({width:0,height:0,y:0}),2),a=r[0],s=r[1];return h.useEffect((function(){n.current&&s(n.current.getBBox())}),[t.note[0],t.note[1]]),d.jsxs("g",{className:"note-box",style:(e={},g(e,"--x-percentage",t.note[2]),g(e,"--y-percentage",t.note[3]),e),children:[t.note[4]&&d.jsx("rect",{height:a.height+4,width:a.width+4,x:-2,y:a.y-2,fill:"none",stroke:"black",strokeWidth:.5}),d.jsxs("g",{ref:n,children:[d.jsx("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((function(t,e){return d.jsx("text",{className:"rmg-name__zh",y:18*e,children:t},e)}))}),d.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((function(e,n){var r;return d.jsx("text",{className:"rmg-name__en",y:11*n,textLength:n<((null===(r=t.note[1].match(/\n/g))||void 0===r?void 0:r.length)||0)?a.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:e},n)}))})]})]})}),(function(t,e){return t.note.toString()===e.note.toString()})),xt=h.memo((function(t){var e=t.stnName,n=t.onUpdate,r=h.useRef(null);return h.useEffect((function(){r.current&&n&&n(r.current.getBBox())}),[e.toString()]),d.jsxs("g",{ref:r,children:[d.jsx("text",{className:"rmg-name__zh",fontSize:90,children:e[0]}),d.jsx("g",{fontSize:36,children:e[1].split("\\").map((function(t,e){return d.jsx("text",{className:"rmg-name__en",dy:70+36*e,children:t},e)}))})]})}),(function(t,e){return t.stnName.toString()===e.stnName.toString()})),gt=function(t){var e=t.secondaryName,n=t.transform,r=h.useRef(null),a=m(h.useState({x:0,width:0}),2),s=a[0],i=a[1];return h.useEffect((function(){r.current&&i(r.current.getBBox())}),[e.toString()]),d.jsxs("g",{transform:n,children:[d.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[d.jsx("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),d.jsx("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),d.jsxs("g",{ref:r,textAnchor:"middle",children:[d.jsx("text",{className:"rmg-name__zh",fontSize:26,children:e[0]}),d.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:e[1]})]})]})},pt=function(){var t,e=v((function(t){return t.param})),n=e.svg_height,r=e.svgWidth,a=e.theme,s=e.direction,i=e.info_panel_type,c=e.line_num,o=e.current_stn_idx,l=e.stn_list[o],u=m(h.useState({width:0}),2),f=u[0],x=u[1],p=l[s===S.left?"parents":"children"],j={name:"translate(".concat((s===S.left?1:-1)*r[z.RunIn]/4,",45)"),next:"translate(".concat((s===S.left?1:-1)*r[z.RunIn]/10,",45)")},y={nameGroup:{x:r.runin/2,y:.5*n-50-18*(l.name[1].split("\\").length-1)-(l.secondaryName?29:0)},secondaryName:{x:0,y:70+36*l.name[1].split("\\").length}};return d.jsxs("g",{children:[d.jsxs("g",{transform:i===b.gz2otis?j.name:"",children:[d.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(y.nameGroup.x,",").concat(y.nameGroup.y,")"),children:[d.jsx(xt,{stnName:l.name,onUpdate:x}),l.secondaryName&&d.jsx(gt,{secondaryName:l.secondaryName,transform:"translate(".concat(y.secondaryName.x,",").concat(y.secondaryName.y,")")})]}),d.jsx($,{lineNum:c,stnNum:l.num,strokeColour:a[2],style:(t={},g(t,"--translate-x","".concat((r[z.RunIn]+f.width)/2+55,"px")),g(t,"--translate-y","".concat(.5*n-30-18*(l.name[1].split("\\").length-1)-(l.secondaryName?29:0),"px")),g(t,"transform","translate(var(--translate-x, 800px), var(--translate-y, 145px))"),t),large:!0})]}),d.jsx("g",{transform:i===b.gz2otis?j.next:"",children:!p||p.includes("linestart")||p.includes("lineend")?d.jsx(d.Fragment,{}):1===p.length?d.jsx(jt,{nextId:p[0],nameBBox:f}):d.jsx(vt,{nextIds:p,nameBBox:f})})]})},jt=function(t){var e,n=t.nextId,r=t.nameBBox,a=v((function(t){return t.param.svgWidth})),s=v((function(t){return t.param.direction})),i=v((function(t){return t.param.stn_list[n]})),c=i.name,o=i.secondaryName,l=m(h.useState({width:0}),2),u=l[0],f=l[1],x=h.useRef(null);h.useEffect((function(){x.current&&f(x.current.getBBox())}),[c.toString()]);var p=c[0].length,j=(a[z.RunIn]-r.width)/2;return d.jsxs(d.Fragment,{children:[d.jsxs("g",{id:"big_next",children:[d.jsxs("g",{textAnchor:"middle",style:g({},"--translate-x",s===S.left?"80px":"".concat(p<=2?a[z.RunIn]-45-u.width-70:a[z.RunIn]-45-u.width-52.5,"px")),children:[d.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),d.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),d.jsxs("g",{textAnchor:"start",ref:x,style:g({},"--translate-x",s===S.left?"".concat(p<=2?150:132.5,"px"):"".concat(a[z.RunIn]-45-u.width,"px")),children:[d.jsx("text",{className:"rmg-name__zh",fontSize:35,children:c[0]}),d.jsx("g",{fontSize:17,children:c[1].split("\\").map((function(t,e){return d.jsx("text",{className:"rmg-name__en",dy:30+17*e,children:t},e)}))})]}),o&&d.jsx("g",{textAnchor:"middle",style:g({},"--translate-x",s===S.left?"".concat(p<=2?150:132.5,"px"):"".concat(a[z.RunIn]-45-u.width,"px")),children:d.jsx(yt,{secName:o,transform:"translate(".concat(u.width/2,",").concat(30+17*c[1].split("\\").length+5,")")})})]}),d.jsx(it,{id:"arrow",style:(e={},g(e,"--translate-x",s===S.left?"".concat((115+35*((p<=2?1:.5)+p)+j)/2-20,"px"):"".concat((a[z.RunIn]-45-u.width-(p<=2?105:87.5)+j+t.nameBBox.width+55+25.9)/2+20,"px")),g(e,"--rotate",s===S.left?"0deg":"180deg"),e)})]})},yt=function(t){var e=t.secName,n=p(t,o),r=h.useRef(null),a=m(h.useState({x:0,width:0}),2),s=a[0],i=a[1];return h.useEffect((function(){r.current&&i(r.current.getBBox())}),[t.secName.toString()]),d.jsxs("g",x(x({},n),{},{children:[d.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[d.jsx("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),d.jsx("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),d.jsxs("g",{ref:r,children:[d.jsx("text",{className:"rmg-name__zh",fontSize:18,children:e[0]}),d.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:e[1]})]})]}))},vt=function(t){var e,n=t.nextIds,r=t.nameBBox,a=v((function(t){return t.helper})).routes,s=v((function(t){return t.param.svgWidth})),i=v((function(t){return t.param.direction})),c=v((function(t){return t.param.stn_list})),o=n.map((function(t){return c[t].name})),l=m(h.useState({width:0}),2),f=l[0],p=l[1],j=h.useRef([]);h.useEffect((function(){p((function(t){return x(x({},t),{},{width:0})})),j.current.forEach((function(t){var e=null==t?void 0:t.getBBox();p((function(t){return e?t.width>e.width?t:e:t}))}))}),[o.toString()]);var y=t.nextIds.map((function(t){return a.reduce((function(e,n){return n.includes(t)?e.concat(n.filter((function(t){return!["linestart","lineend"].includes(t)})).slice(i===S.left?0:-1)[0]):e}),[])})),_=Math.max.apply(Math,u(o.map((function(t){return t[0].length})))),b=(s[z.RunIn]-r.width)/2;return d.jsxs(d.Fragment,{children:[d.jsx("g",{id:"big_next_2",children:o.map((function(t,e){return d.jsxs(h.Fragment,{children:[d.jsxs("g",{textAnchor:"middle",style:g({},"--translate-x",i===S.left?"72px":"".concat(s[z.RunIn]-45-f.width-41,"px")),children:[d.jsx("text",{className:"rmg-name__zh",children:"下站"}),d.jsx("text",{className:"rmg-name__en",y:22,children:"Next"})]}),d.jsxs("g",{ref:function(t){return j.current[e]=t},textAnchor:"start",style:g({},"--translate-x",i===S.left?"113px":"".concat(s[z.RunIn]-45-f.width,"px")),children:[d.jsx("text",{className:"rmg-name__zh",children:t[0]}),t[1].split("\\").map((function(t,e){return d.jsx("text",{className:"rmg-name__en",y:22+13*e,children:t},e)})),d.jsx("text",{className:"rmg-name__zh",y:-35,children:y[e].map((function(t){return c[t].name[0]})).join("/")+"方向"}),d.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+y[e].map((function(t){return c[t].name[1]})).join("/").replace("\\"," ")})]})]},e)}))}),d.jsx(it,{id:"arrow",style:(e={},g(e,"--translate-x",i===S.left?"".concat((99+27*(1+_)+b)/2-20,"px"):"".concat((s[z.RunIn]-45-f.width-41-27+b+t.nameBBox.width+55+25.9)/2+20,"px")),g(e,"--rotate",i===S.left?"0deg":"180deg"),e)})]})};function _t(t){var e=t.num,n=p(t,l);return d.jsxs("g",x(x({textAnchor:"middle",fill:"var(--rmg-theme-fg)"},n),{},{children:[d.jsx("circle",{cx:0,cy:0,r:30,fill:"var(--rmg-theme-colour)"}),d.jsx("text",{className:"rmg-name__en",fontSize:38,dy:-9.5,children:e}),d.jsx("text",{className:"rmg-name__zh",fontSize:13,dy:10,children:"站台"}),d.jsx("text",{className:"rmg-name__en",fontSize:9,dy:21,children:"Platform"})]}))}function St(t){var e=t.canvasType,n=v((function(t){return t.param})),r=n.svgWidth,a=n.svg_height;return d.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[d.jsx("line",{y2:a,transform:"translate(".concat(r[e]/2,",0)")}),d.jsx("line",{x2:r[e],transform:"translate(0,90)"})]})}var zt=z.RunIn;function bt(){var t,e=v((function(t){return t.app})).canvasScale,n=v((function(t){return t.param})),r=n.svgWidth,a=n.svg_height,s=n.direction,i=n.info_panel_type,c=n.platform_num,o=n.psd_num,l=n.theme,u=r[zt],m={platform:"translate(".concat(s===S.left?50:-50,",45)")};return d.jsxs(A,{type:zt,svgWidth:u,svgHeight:a,canvasScale:e,theme:l,children:[d.jsx(B,{variant:i,isShowLight:i!==b.gz2otis,isShowPSD:i!==b.gz2otis&&o}),d.jsx("g",{transform:i===b.gz2otis?m.platform:"",children:d.jsx(_t,{num:c,style:(t={},g(t,"--translate-x","".concat(s===S.left?u-100:100,"px")),g(t,"--translate-y","calc(var(--rmg-svg-height) / 2 - 30px)"),g(t,"transform","translate(var(--translate-x, 100px), var(--translate-y))"),t)})}),d.jsx(pt,{}),i===b.gz2otis&&d.jsx(St,{canvasType:zt})]})}t("default",{runin:d.jsx(bt,{}),railmap:d.jsx(lt,{})})}}}))}();
