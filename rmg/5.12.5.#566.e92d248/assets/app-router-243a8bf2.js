import{j as b,a8 as _n,F as Ee,B as Se,a4 as ye,G as ze,a7 as Oe,t as ct,a9 as Et,f as ce,aa as Te,a2 as Ke,M as Xe,a3 as Je,x as ht,y as ut,q as Qe,r as et,s as tt,v as nt,X as qt,ab as bn,ac as yn,ad as vn,ae as Nt,af as Sn,ag as xn,ah as _t,ai as wn,aj as kn,L as Ve,ak as Kt,b as Cn,al as jn}from"./chakra-b5edfc98.js";import{r as q,c as st,g as An,u as En}from"./react-f83802c2.js";import{_ as lt,u as Q,r as he,E as ve,R as ft,a as Xt,b as le,c as me,d as On,e as J,f as Lt,g as Ft,h as _e,M as Rn,F as St,i as Be,j as Pe,k as Re,l as xt,m as zn,n as Ot,o as Ye,S as Ne,p as Pn,q as Ut,s as Tn,t as Wt,v as In,w as Bn,x as wt,y as Mn,z as Dn,A as Nn,B as Ln,C as Fn,D as Un,G as dt,H as we,I as Wn,J as Zn,K as Hn,L as Rt,N as zt,O as Pt,P as Gn,Q as Vn,T as $n,U as kt,V as Ct,W as Yn,X as Zt,Y as qn,Z as Kn,$ as Jt,a0 as Qt,a1 as Xn,a2 as Jn,a3 as en,a4 as tn,a5 as Ht,a6 as Qn,a7 as er,a8 as tr,a9 as nr,aa as rr,ab as ir,ac as sr,ad as ar,ae as or,af as bt,ag as lr,ah as cr,ai as dr,aj as hr,ak as ur,al as fr,am as pr,an as Me,ao as Le,ap as qe,aq as Fe,ar as De,as as nn,at as mr,au as jt,av as At,aw as gr,ax as _r,ay as br,az as yr,aA as vr,aB as Sr,aC as rn,aD as xr,aE as wr,aF as Gt,aG as kr,aH as Cr,aI as jr,aJ as Ar,aK as sn,aL as Er,aM as Or,aN as Rr,aO as zr,aP as Pr,aQ as Tr,aR as Ir,aS as at,aT as Br,aU as Mr,aV as Ie,aW as an,aX as Dr,aY as Nr,aZ as Lr,a_ as yt,a$ as vt,b0 as Fr,b1 as Ur}from"./index-e1564128.js";import{i as on,w as Wr,d as Vt,a as ln,r as Zr,P as Hr,u as Gr}from"./param-updater-utils-a57fb0d0.js";var Vr=function(f){var p=f.text,r=f.delimiter;return b.jsx("span",{children:p.split(r||"\\").map(function(o,s){return s?[b.jsx(_n,{children:"⏎"},s),o]:o})})};const $r={mtr:()=>lt(()=>import("./index-f5c4be7f.js"),["assets/index-f5c4be7f.js","assets/chakra-b5edfc98.js","assets/react-f83802c2.js","assets/index-e1564128.js","assets/index-d22c1e14.css","assets/share-1b390f8d.js","assets/mtr-eb9359cb.js","assets/param-updater-utils-a57fb0d0.js"]),gzmtr:()=>lt(()=>import("./index-8bd67956.js"),["assets/index-8bd67956.js","assets/chakra-b5edfc98.js","assets/react-f83802c2.js","assets/index-e1564128.js","assets/index-d22c1e14.css","assets/share-1b390f8d.js"]),shmetro:()=>lt(()=>import("./index-af7533aa.js"),["assets/index-af7533aa.js","assets/chakra-b5edfc98.js","assets/react-f83802c2.js","assets/index-e1564128.js","assets/index-d22c1e14.css","assets/share-1b390f8d.js","assets/mtr-eb9359cb.js","assets/param-updater-utils-a57fb0d0.js"])};function Yr(f){const[p,r]=q.useState({});return q.useEffect(()=>($r[f]().then(o=>{r(o.default)}).catch(o=>{console.error("Failed to load canvas for style ".concat(f),o),r({})}),()=>{r({})}),[f]),p}const qr={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function Kr(){const{canvasToShow:f,canvasScale:p}=Q(e=>e.app),{svg_height:r,style:o}=Q(e=>e.param),s=Yr(o);q.useEffect(()=>{document.getElementById("css_share").href="/rmg/"+"styles/share_".concat(o,".css"),he.event(ve.STYLE_CHANGE,{style:o})},[o]);const n=Object.keys(s).filter(e=>f.includes(e)),t=r*p;return b.jsx(Ee,{minH:t,sx:qr,children:Object.keys(s).length===0?b.jsx(ft,{isIndeterminate:!0}):n.map(e=>b.jsx(Xt,{sx:{minWidth:750,height:t},children:s[e]},e+o))})}function Xr(){const{t:f}=le(),p=me(),r=Q(a=>a.app.selectedStation);console.log("InfoSection:: Rendering for",r);const o=Q(a=>a.param.style),{num:s,name:n,secondaryName:t}=Q(a=>a.param.stn_list[r]),e=[{type:"input",label:f("StationSidePanel.info.num"),value:s,placeholder:"01",onChange:a=>p(On(r,a)),hidden:![J.GZMTR].includes(o)},{type:"input",label:f("Chinese name"),value:n[0],onChange:a=>p(Lt(r,[a,n[1]]))},{type:"input",label:f("English name"),value:n[1],onChange:a=>p(Lt(r,[n[0],a]))},{type:"input",label:f("StationSidePanel.info.zhSecondary"),value:t?t[0]:"",placeholder:"1号航站楼",onChange:a=>p(Ft(r,[a,t?t[1]:""])),hidden:![J.GZMTR].includes(o)},{type:"input",label:f("StationSidePanel.info.enSecondary"),value:t?t[1]:"",placeholder:"Terminal 1",onChange:a=>p(Ft(r,[t?t[0]:"",a])),hidden:![J.GZMTR].includes(o)}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("StationSidePanel.info.title")}),b.jsx(_e,{fields:e,minW:130})]})}class Jr{static hexToRgb(p){return[parseInt(p.slice(1,3),16),parseInt(p.slice(3,5),16),parseInt(p.slice(5,7),16)]}static fade(p,r){return"rgba(".concat([...this.hexToRgb(p),r].join(","),")")}static euclideanDistance(p,r){return this.hexToRgb(p).reduce((o,s,n)=>o+Math.pow(s-this.hexToRgb(r)[n],2),0)}}function Tt(f){var s;const{theme:p,onClick:r}=f,{t:o}=le();return b.jsx(ze,{size:"xs","aria-label":o("Colour"),mt:"0.45px",color:p==null?void 0:p[3],bg:p==null?void 0:p[2],_hover:{bg:Jr.fade((s=p==null?void 0:p[2])!=null?s:"#aaaaaa",.7)},icon:b.jsx(Rn,{}),onClick:r})}const Qr=q.createContext({}),pt=Qr;function ei(f){const{interchangeList:p,onAdd:r,onDelete:o,onUpdate:s}=f,{t:n}=le(),{nextTheme:t,setPrevTheme:e}=q.useContext(pt),[a,u]=q.useState(),{style:v,theme:g,stn_list:h}=Q(y=>y.param);q.useEffect(()=>{a!==void 0&&t&&(s==null||s(a,{...p[a],theme:t}),u(void 0))},[t==null?void 0:t.toString()]);const c=Object.values(h).reduce((y,m)=>{const[x,C]=y;return[[...new Set(x.concat(m.transfer.groups.map(j=>j.lines.map(A=>A.name[0])).flat()))],[...new Set(C.concat(m.transfer.groups.map(j=>j.lines.map(A=>A.name[1])).flat()))]]},[[],[]]),_=Object.fromEntries(Object.entries(St).filter(([y])=>!["railway"].includes(y)).map(([y,m])=>[y,n(m)])),d=p.map((y,m)=>[{type:"input",label:n("Chinese name"),value:y.name[0],onChange:x=>s==null?void 0:s(m,{...y,name:[x,y.name[1]]}),optionList:c[0]},{type:"input",label:n("English name"),value:y.name[1],onChange:x=>s==null?void 0:s(m,{...y,name:[y.name[0],x]}),optionList:c[1]},{type:"select",label:n("Line icon"),value:y.facility,options:_,onChange:x=>s==null?void 0:s(m,{...y,facility:x}),hidden:![J.MTR].includes(v)}]);return b.jsxs(Be,{direction:"column",children:[p.length===0&&b.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack",children:[b.jsx(ct,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:n("StationSidePanel.interchange.noInterchanges")}),b.jsx(ze,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.add"),onClick:()=>r==null?void 0:r({theme:[g[0],"","#aaaaaa",Pe.white],name:["",""]}),icon:b.jsx(Re,{})})]}),p.map((y,m)=>b.jsxs(Oe,{spacing:.5,"data-testid":"interchange-card-stack-".concat(m),children:[b.jsx(xt,{label:n("Colour"),minW:"40px",noLabel:m!==0,children:b.jsx(Tt,{theme:y.theme,onClick:()=>{u(m),e==null||e(y.theme)}})}),b.jsx(_e,{fields:d[m],noLabel:m!==0}),r&&m===d.length-1?b.jsx(ze,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.copy"),onClick:()=>r==null?void 0:r(p.slice(-1)[0]),icon:b.jsx(zn,{})}):b.jsx(Se,{minW:8}),o&&b.jsx(ze,{size:"sm",variant:"ghost","aria-label":n("StationSidePanel.interchange.remove"),onClick:()=>o==null?void 0:o(m),icon:b.jsx(Ot,{})})]},m))]})}function ti(){const{t:f}=le(),p=me(),r=Q(g=>g.app.selectedStation),{theme:o,style:s}=Q(g=>g.param),{transfer:n}=Q(g=>g.param.stn_list[r]),t=g=>{var h,c,_,d;return[{type:"input",label:f("Station Chinese name"),value:(c=(h=n.groups[g].name)==null?void 0:h[0])!=null?c:"",hidden:![J.MTR].includes(s),onChange:y=>{var m,x;return p(Ut(r,g,[y,(x=(m=n.groups[g].name)==null?void 0:m[1])!=null?x:""]))}},{type:"input",label:f("Station English name"),value:(d=(_=n.groups[g].name)==null?void 0:_[1])!=null?d:"",hidden:![J.MTR].includes(s),onChange:y=>{var m,x;return p(Ut(r,g,[(x=(m=n.groups[g].name)==null?void 0:m[0])!=null?x:"",y]))}},{type:"switch",label:f("Paid area"),isChecked:n.paid_area,onChange:y=>p(Tn(r,y)),hidden:![J.MTR].includes(s)||g===0,oneLine:!0}]},e=g=>h=>{p(Wt(r,g,h))},a=g=>h=>{p(In(r,g,h))},u=g=>(h,c)=>{p(Bn(r,g,h,c))},v=()=>{p(Wt(r,n.groups.length,{theme:[o[0],"","#AAAAAA",Pe.white],name:["",""]}))};return b.jsxs(Et,{align:"flex-start",p:1,children:[b.jsxs(Ee,{w:"100%",children:[b.jsx(ye,{as:"h5",size:"sm",mr:"auto",children:f("StationSidePanel.interchange.title")}),s===J.MTR&&b.jsx(Ye,{selections:[{label:f("Text on the left"),value:Ne.left},{label:f("Text on the right"),value:Ne.right}],defaultValue:n.tick_direc,onChange:g=>p(Pn(r,g))})]}),n.groups.map((g,h)=>b.jsxs(q.Fragment,{children:[b.jsx(ye,{as:"h6",size:"xs",children:f(h===0?"StationSidePanel.interchange.within":h===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),h!==0&&b.jsx(_e,{fields:t(h)}),b.jsx(ei,{interchangeList:g.lines,onAdd:e(h),onDelete:a(h),onUpdate:u(h)})]},h)),n.groups.length<3&&b.jsx(ce,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:b.jsx(Re,{}),onClick:v,children:f("StationSidePanel.interchange.addGroup")})]})}function ni(){const{t:f}=le(),p=me(),r=Q(_=>_.app.selectedStation),{style:o,loop:s}=Q(_=>_.param),{services:n,facility:t,loop_pivot:e,one_line:a,int_padding:u}=Q(_=>_.param.stn_list[r]),v=Object.values(wt).map(_=>({label:f("StationSidePanel.more."+_),value:_,disabled:_===wt.local&&o!==J.SHMetro})),g=Object.fromEntries(Object.entries(St).filter(([_])=>!["railway"].includes(_)).map(([_,d])=>[_,f(d)])),h=Object.fromEntries(Object.entries(St).filter(([_])=>!["np360"].includes(_)).map(([_,d])=>[_,f(d)])),c=[{type:"custom",label:f("StationSidePanel.more.service"),component:b.jsx(Ye,{selections:v,defaultValue:n,onChange:_=>p(Mn(r,_)),multiSelect:!0}),hidden:![J.GZMTR,J.SHMetro].includes(o)},{type:"select",label:f("StationSidePanel.more.facility"),value:t,options:o===J.MTR?g:h,onChange:_=>p(Dn(r,_)),hidden:![J.MTR,J.SHMetro].includes(o)},{type:"switch",label:f("StationSidePanel.more.pivot"),isChecked:e,onChange:_=>p(Nn(r,_)),hidden:![J.SHMetro].includes(o)||!s,minW:"full",oneLine:!0},{type:"switch",label:f("StationSidePanel.more.oneLine"),isChecked:a,onChange:_=>p(Ln(r,_)),hidden:![J.SHMetro].includes(o),minW:"full",oneLine:!0},{type:"input",label:f("StationSidePanel.more.intPadding"),value:u.toString(),validator:_=>Number.isInteger(_),onChange:_=>p(Fn(r,Number(_))),hidden:![J.SHMetro].includes(o)},{type:"custom",label:f("StationSidePanel.more.intPaddingApplyGlobal"),component:b.jsx(Ye,{selections:[{label:f("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:_=>p(Un(r))}),oneLine:!0,hidden:![J.SHMetro].includes(o)}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("StationSidePanel.more.title")}),b.jsx(_e,{fields:c})]})}function ri(){const{t:f}=le(),p=me(),r=Q(g=>g.app.selectedStation),o=Q(g=>g.param.stn_list),{parents:s,children:n,branch:t}=o[r],e={[dt.through]:f("StationSidePanel.branch.through"),[dt.nonThrough]:f("StationSidePanel.branch.nonThrough")},a=g=>(g===we.left?s:n).reduce((h,c)=>({...h,[c]:o[c].name.join(" ")}),{}),u={upper:f("StationSidePanel.branch.upper"),lower:f("StationSidePanel.branch.lower")},v=g=>t[g].length?[{type:"select",label:f("StationSidePanel.branch.type"),options:e,value:t[g][0],onChange:h=>p(Wn(r,g,h))},{type:"select",label:f("StationSidePanel.branch.firstStation"),options:a(g),value:t[g][1],onChange:h=>p(Zn(r,g,h))},{type:"select",label:f("StationSidePanel.branch.position"),options:u,value:(g===we.left?s:n)[0]===t[g][1]?"upper":"lower",onChange:()=>p(Hn(r,g))}]:[];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("Branches")}),b.jsx(ye,{as:"h6",size:"xs",children:f("Branch on the left")}),b.jsx(Be,{direction:"column",children:s.length===2?b.jsx(_e,{fields:v(we.left)}):b.jsx(ct,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:f("No branches found")})}),b.jsx(ye,{as:"h6",size:"xs",children:f("Branch on the right")}),b.jsx(Be,{direction:"column",children:n.length===2?b.jsx(_e,{fields:v(we.right)}):b.jsx(ct,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:f("No branches found")})})]})}function ii(){return b.jsxs(Rt,{children:[b.jsx(Xr,{}),b.jsx(Te,{}),b.jsx(ti,{}),b.jsx(Te,{}),b.jsx(ri,{}),b.jsx(Te,{}),b.jsx(ni,{})]})}function si(){const{t:f}=le(),p=zt(),{style:r,svgWidth:o,svg_height:s,y_pc:n,branchSpacingPct:t,padding:e,direction_gz_x:a,direction_gz_y:u,loop:v}=Q(h=>h.param),g=[...Pt[r].map(h=>({type:"input",label:f("StyleSidePanel.layout.".concat(h,"Width")),value:o[h].toString(),onChange:c=>p(Gn(Number(c),h))})),{type:"input",label:f("StyleSidePanel.layout.canvasHeight"),value:s.toString(),onChange:h=>p(Vn(Number(h)))},{type:"slider",label:f("StyleSidePanel.layout.verticalPosition"),value:n,min:0,max:100,onChange:h=>p($n(h)),leftIcon:b.jsx(kt,{}),rightIcon:b.jsx(Ct,{}),hidden:![J.MTR,J.GZMTR].includes(r)},{type:"slider",label:f(v?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:t,min:0,max:v?50:100,onChange:h=>p(Yn(h)),leftIcon:b.jsx(Zt,{}),rightIcon:b.jsx(Re,{})},{type:"slider",label:f("StyleSidePanel.layout.padding"),value:e,min:0,max:50,onChange:h=>p(qn(h)),leftIcon:b.jsx(Zt,{}),rightIcon:b.jsx(Re,{})},{type:"slider",label:f("StyleSidePanel.layout.directionGzX"),value:a,min:0,max:100,onChange:h=>p(Kn(h)),leftIcon:b.jsx(Jt,{}),rightIcon:b.jsx(Qt,{}),hidden:![J.GZMTR].includes(r)},{type:"slider",label:f("StyleSidePanel.layout.directionGzY"),value:u,min:0,max:100,onChange:h=>p(Xn(h)),leftIcon:b.jsx(kt,{}),rightIcon:b.jsx(Ct,{}),hidden:![J.GZMTR].includes(r)}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("StyleSidePanel.layout.title")}),b.jsx(_e,{fields:g,minW:130})]})}function ai(){const{t:f}=le(),p=me(),{style:r,theme:o,line_name:s,line_num:n,direction:t,platform_num:e,psd_num:a,namePosMTR:u,customiseMTRDest:v,info_panel_type:g}=Q(R=>R.param),{setPrevTheme:h,nextTheme:c}=q.useContext(pt),[_,d]=q.useState(!1);q.useEffect(()=>{_&&c&&(p(Jn(c)),d(!1))},[c==null?void 0:c.toString()]);const y=[{label:f("StyleSidePanel.design.left"),value:Ne.left},{label:f("StyleSidePanel.design.right"),value:Ne.right}],m=Object.values(en).reduce((R,P)=>({...R,[P]:f("StyleSidePanel.design."+P)}),{}),x=Object.values(tn).reduce((R,P)=>({...R,[P]:f("StyleSidePanel.design."+P)}),{}),C=[{type:"custom",label:f("Colour"),component:b.jsx(Tt,{theme:o,onClick:()=>{d(!0),h==null||h(o)}}),minW:"40px"},{type:"input",label:f("StyleSidePanel.design.zhLineName"),value:s[0],onChange:R=>p(Ht([R,s[1]])),minW:130},{type:"input",label:f("StyleSidePanel.design.enLineName"),value:s[1],onChange:R=>p(Ht([s[0],R])),minW:130},{type:"input",label:f("StyleSidePanel.design.lineNum"),value:n,onChange:R=>p(Qn(R)),hidden:![J.GZMTR].includes(r)},{type:"input",label:f("StyleSidePanel.design.platformNum"),value:e||"",onChange:R=>p(er(R))},{type:"input",label:f("StyleSidePanel.design.psdNum"),value:a,onChange:R=>p(tr(R)),hidden:![J.GZMTR].includes(r)},{type:"select",label:f("StyleSidePanel.design.panelType"),value:g,options:r===J.GZMTR?m:x,onChange:R=>p(nr(R)),hidden:![J.GZMTR,J.SHMetro].includes(r)},{type:"custom",label:f("StyleSidePanel.design.direction"),component:b.jsx(Ye,{selections:y,defaultValue:t,onChange:R=>p(rr(R))}),minW:"full",oneLine:!0}],j=[{label:f("StyleSidePanel.design.alternatively"),value:!0},{label:f("StyleSidePanel.design.onOneSide"),value:!1}],A=[{type:"custom",label:f("StyleSidePanel.design.nameDisplay"),component:b.jsxs(Oe,{spacing:.5,children:[b.jsx(ze,{size:"xs",variant:"ghost","aria-label":f("StyleSidePanel.design.flip"),title:f("StyleSidePanel.design.flip"),icon:b.jsx(ir,{}),onClick:()=>p(sr())}),b.jsx(Ye,{selections:j,defaultValue:u.isStagger,onChange:R=>p(ar(R))})]}),minW:"full",oneLine:!0,hidden:![J.MTR].includes(r)},{type:"switch",label:f("StyleSidePanel.design.legacyDestination"),isChecked:v.isLegacy,onChange:R=>p(or(R)),hidden:![J.MTR].includes(r),minW:"full",oneLine:!0},{type:"switch",label:f("StyleSidePanel.design.overrideTerminal"),isChecked:v.terminal!==!1,onChange:R=>p(bt(R?["",""]:!1)),hidden:![J.MTR].includes(r),minW:"full",oneLine:!0},{type:"input",label:f("StyleSidePanel.design.terminalZhName"),value:v.terminal?v.terminal[0]:"",placeholder:"機場及博覽館",onChange:R=>p(bt([R,v.terminal?v.terminal[1]:""])),hidden:![J.MTR].includes(r)||v.terminal===!1},{type:"input",label:f("StyleSidePanel.design.terminalEnName"),value:v.terminal?v.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:R=>p(bt([v.terminal?v.terminal[0]:"",R])),hidden:![J.MTR].includes(r)||v.terminal===!1}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("StyleSidePanel.design.title")}),b.jsx(_e,{fields:[...C,...A],minW:130})]})}function oi(){const{t:f}=le(),p=me(),{branches:r}=Q(h=>h.helper),{loop:o,loop_info:s}=Q(h=>h.param),{bank:n,left_and_right_factor:t,bottom_factor:e}=s,a=r.flat().filter((h=>c=>(h[c]=(h[c]||0)+1)===2)({})).filter(h=>!["linestart","lineend"].includes(h)),u=Math.abs(r[0].indexOf(a[0])-r[0].indexOf(a[1])),v=r.length>=2?(0,Math.min)(r[0].length-2-u,u):Math.floor((r[0].length-2-e*2)/2),g=[{type:"switch",label:f("StyleSidePanel.loop.isLoop"),isChecked:o,onChange:h=>p(lr(h)),minW:"full",oneLine:!0},{type:"switch",label:f("StyleSidePanel.loop.isBank"),isChecked:n,onChange:h=>p(cr(h)),minW:"full",oneLine:!0,hidden:!o},{type:"slider",label:f("StyleSidePanel.loop.leftRightFactor"),value:t,min:0,max:v,onChange:h=>p(dr(Math.floor(h))),hidden:!o},{type:"slider",label:f("StyleSidePanel.loop.bottomFactor"),value:e,min:0,max:Math.floor((r[0].length-2-t*2)/2),onChange:h=>p(hr(Math.floor(h))),hidden:!o||o&&r.length>2}];return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("StyleSidePanel.loop.title")}),b.jsx(_e,{fields:g})]})}function li(f){const{note:p,onUpdate:r,onDelete:o}=f,{t:s}=le(),n=[{type:"textarea",label:s("StyleSidePanel.note.zhNote"),value:p[0],onChange:e=>r==null?void 0:r([e,p[1],p[2],p[3],p[4]])},{type:"textarea",label:s("StyleSidePanel.note.enNote"),value:p[1],onChange:e=>r==null?void 0:r([p[0],e,p[2],p[3],p[4]])},{type:"switch",label:s("StyleSidePanel.note.border"),isChecked:p[4],onChange:e=>r==null?void 0:r([p[0],p[1],p[2],p[3],e]),oneLine:!0}],t=[{type:"slider",label:s("StyleSidePanel.note.positionX"),value:p[2],min:0,max:100,onChange:e=>r==null?void 0:r([p[0],p[1],e,p[3],p[4]]),leftIcon:b.jsx(Jt,{}),rightIcon:b.jsx(Qt,{})},{type:"slider",label:s("StyleSidePanel.note.positionY"),value:p[3],min:0,max:100,onChange:e=>r==null?void 0:r([p[0],p[1],p[2],e,p[4]]),leftIcon:b.jsx(kt,{}),rightIcon:b.jsx(Ct,{})}];return b.jsxs(Be,{direction:"column",children:[b.jsx(_e,{fields:n,minW:"full"}),b.jsxs(Oe,{spacing:.5,sx:{"&>div":{flex:1}},children:[b.jsx(_e,{fields:t}),b.jsx(ze,{size:"sm",variant:"ghost","aria-label":s("StyleSidePanel.note.remove"),onClick:()=>o==null?void 0:o(),icon:b.jsx(Ot,{})})]})]})}function ci(){const{t:f}=le(),p=me(),r=Q(o=>o.param.notesGZMTR);return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("StyleSidePanel.note.title")}),b.jsxs(Et,{spacing:.5,children:[r.map((o,s)=>b.jsx(li,{note:o,onUpdate:n=>p(ur(s,n)),onDelete:()=>p(fr(s))},s)),b.jsx(ce,{size:"xs",variant:"ghost",leftIcon:b.jsx(Re,{}),alignSelf:"flex-end",onClick:()=>p(pr()),children:f("StyleSidePanel.note.add")})]})]})}function di(){const{style:f}=Q(p=>p.param);return b.jsxs(Rt,{children:[b.jsx(si,{}),b.jsx(Te,{}),b.jsx(ai,{}),f===J.GZMTR&&b.jsxs(b.Fragment,{children:[b.jsx(Te,{}),b.jsx(ci,{})]}),f===J.SHMetro&&b.jsxs(b.Fragment,{children:[b.jsx(Te,{}),b.jsx(oi,{})]})]})}const It=(f,p)=>{if(["linestart","lineend"].includes(f)||p[f].parents.length>1||p[f].children.length>1)return 0;const r=p[f].parents[0];return r?p[r].children.length===1?It(r,p):p[r].children.indexOf(f)===0?1:-1:0},hi=f=>(p,r)=>{const{stn_list:o,current_stn_idx:s}=r().param;if(f===s)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:n,children:t}=o[f];return Object.keys(o).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):n.length===2&&t.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(o).some(a=>![f,"linestart","lineend"].includes(a)&&It(a,o)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},ui=f=>(p,r)=>{const o=r().param.stn_list,{parents:s,children:n}=o[f];let t=JSON.parse(JSON.stringify(o));s.length===2||n.length===2?(s.forEach(e=>{t[e].children=n}),n.forEach(e=>{t[e].parents=s}),s.length===1&&(t[s[0]].branch.right=t[f].branch.right),n.length===1&&(t[n[0]].branch.left=t[f].branch.left)):o[s[0]].children.length===2&&o[n[0]].parents.length===2?t={...o,[s[0]]:{...o[s[0]],children:o[s[0]].children.filter(e=>e!==f),branch:{...o[s[0]].branch,right:[]}},[n[0]]:{...o[n[0]],parents:o[n[0]].parents.filter(e=>e!==f),branch:{...o[n[0]].branch,left:[]}}}:(s.forEach(e=>{const a=t[e].children.indexOf(f);n.length?t[e].children[a]=n[0]:t[e].children.splice(a,1),t[e].branch.right[1]===f&&(t[e].branch.right[1]=n[0])}),n.forEach(e=>{const a=t[e].parents.indexOf(f);s.length?t[e].parents[a]=s[0]:t[e].parents.splice(a,1),t[e].branch.left[1]===f&&(t[e].branch.left[1]=s[0])})),delete t[f],p(Me(t))};function fi(...f){return f.reduce((p,r)=>p.map(o=>r.map(s=>o.concat([s]))).reduce((o,s)=>o.concat(s),[]),[[]])}const Ue=(f,p)=>!!p[f[0]].children.indexOf(f[1]),cn=(f,p)=>[f[0][1],f[0][f[0].length-2],...f[0].filter(r=>f.slice(1).filter(o=>Ue(o,p)).map(o=>o.filter(s=>!["linestart","lineend"].includes(s))).map(o=>[o[0],o[o.length-1]]).flat().includes(r))],pi=(f,p)=>f.slice(1).filter(r=>Ue(r,p)).map(r=>r.filter(o=>!["linestart","lineend"].includes(o))).map(r=>[r[0],r[r.length-1]]),mi=f=>(p,r)=>{const o=r().helper.branches;if(f===0){const s=r().param.stn_list,n=cn(o,s);return fi(n,n).filter(t=>t[0]!==t[1])}else{const s=o[f];if(s){const n=s.filter(t=>!["linestart","lineend"].includes(t));return[[n[0],n.slice(-1)[0]]]}else return[]}},ys=(f,p)=>(r,o)=>{const s=o().param.coline,n=o().helper.branches[p];for(const[t,e]of Object.entries(s))if(e.from===f&&n.includes(e.to)){const a=n.indexOf(f),u=n.indexOf(e.to);if(u>a)return[u-a+1,t]}else if(e.to===f&&n.includes(e.to)){const a=n.indexOf(f),u=n.indexOf(e.from);if(u>a)return[u-a+1,t]}return[0,void 0]},dn=(f,p)=>(r,o)=>{const s=o().param.stn_list,n=o().helper.branches;if(f===p)throw new Error("addColine():: failed for same stnId");const t=cn(n,s).filter(a=>[f,p].includes(a)),e=pi(n,s).filter(a=>[f,p].every(u=>a.includes(u)));if(t.length===2&&e.length>0)throw new Error("addColine():: main check failed for ".concat(f,", ").concat(p));if(t.length!==2&&e.length!==1)throw new Error("addColine():: branch check failed for ".concat(f,", ").concat(p))},gi=f=>(p,r)=>{const o=r().param.coline,n=r().helper.branches[f];return n?Object.entries(o).reduce((t,e)=>n.includes(e[1].from)&&n.includes(e[1].to)?{...t,[e[0]]:e[1]}:{...t},{}):{}},_i=f=>(p,r)=>{const o=r().param.coline;if(Object.keys(o).length===0)return;const s=Object.entries(o).reduce((n,t)=>t[1].from!==f&&t[1].to!==f?{...n,[t[0]]:t[1]}:{...n},{});p(Le(s))},bi=(f,p,r,o=!0)=>(s,n)=>{const t=n().param.coline;s(dn(f,p)),s(Le({...t,[qe(4)]:{from:f,to:p,colors:r,display:o}}))},yi=(f,p,r,o=!0)=>(s,n)=>{const t=n().param.coline;if(f in t){s(dn(p,r));const e={...t,[f]:{...t[f],from:p,to:r,display:o}};s(Le(e))}},vi=(f,p)=>(r,o)=>{const s=o().param.coline;if(f in s&&s[f].colors.length>p){const n=s[f].colors.filter((t,e)=>e!==p);if(n.length===0){const{[f]:t,...e}=s;r(Le(e))}else{const t={...s,[f]:{...s[f],colors:n}};r(Le(t))}}},Si=(f,p,r)=>(o,s)=>{const n=s().param.coline;if(f in n&&n[f].colors.length>p){const t={...n,[f]:{...n[f],colors:n[f].colors.map((e,a)=>a===p?[0,1,2,3,4,5].map(u=>r[u]===void 0?e[u]:r[u]):e)}};o(Le(t))}};function xi(f){const{isOpen:p,onClose:r}=f,{t:o}=le(),s=me(),n=Q(u=>u.app.selectedStation),[t,e]=q.useState(!1);q.useEffect(()=>{p||e(!1)},[p]);const a=()=>{const u=s(hi(n));u?(r(),s(Fe(De.CLOSE)),s(nn("linestart")),s(_i(n)),s(ui(n))):e(!0),he.event(ve.REMOVE_STATION,{success:u})};return b.jsxs(Ke,{isOpen:p,onClose:r,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[t&&b.jsxs(ht,{status:"error",variant:"solid",size:"xs",children:[b.jsx(ut,{}),o("Unable to remove this station.")]}),b.jsxs(Se,{position:"relative",children:[b.jsx(Qe,{children:o("Remove station")}),b.jsx(et,{})]}),b.jsx(tt,{children:o("Are you sure to remove station? You cannot undo this action.")}),b.jsxs(nt,{children:[b.jsx(ce,{onClick:r,children:o("Cancel")}),b.jsx(ce,{colorScheme:"primary",onClick:a,ml:3,children:o("Confirm")})]})]})]})}function wi(){const{t:f}=le(),p=me(),r=Q(n=>n.app.selectedStation),[o,s]=q.useState(!1);return b.jsxs(mr,{children:[b.jsxs(Oe,{children:[b.jsx(ce,{size:"sm",variant:"outline",onClick:()=>p(jt(r)),children:f("StationSidePanel.footer.current")}),b.jsx(ce,{size:"sm",variant:"outline",onClick:()=>s(!0),children:f("StationSidePanel.footer.remove")})]}),b.jsx(xi,{isOpen:o,onClose:()=>s(!1)})]})}function ki(f){const{colineInfo:p,routeOptions:r,onUpdateRoute:o,onUpdateColourInfo:s,onDelete:n}=f,{t}=le(),{nextTheme:e,setPrevTheme:a}=q.useContext(pt),[u,v]=q.useState(!1);q.useEffect(()=>{u&&e&&(s==null||s([...e,p.colors[0][4],p.colors[0][5]]),v(!1))},[e==null?void 0:e.toString()]);const g=[{type:"select",label:"Route",value:[p.from,p.to].join(","),options:r,onChange:c=>o==null?void 0:o(c)}],h=[{type:"custom",label:t("Colour"),component:b.jsx(Tt,{theme:[p.colors[0][0],p.colors[0][1],p.colors[0][2],p.colors[0][3]],onClick:()=>{v(!0),a==null||a(p.colors[0].slice(0,4))}})},{type:"input",label:t("Chinese name"),value:p.colors[0][4],minW:120,onChange:c=>s==null?void 0:s([p.colors[0][0],p.colors[0][1],p.colors[0][2],p.colors[0][3],c,p.colors[0][5]])},{type:"input",label:t("English name"),value:p.colors[0][5],minW:120,onChange:c=>s==null?void 0:s([p.colors[0][0],p.colors[0][1],p.colors[0][2],p.colors[0][3],p.colors[0][4],c])}];return b.jsxs(Be,{direction:"column",children:[b.jsx(_e,{fields:g,minW:"full"}),b.jsxs(Oe,{spacing:.5,children:[b.jsx(_e,{fields:h}),b.jsx(ze,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>n==null?void 0:n(0),icon:b.jsx(Ot,{})})]})]})}function Ci(){const{t:f}=le(),p=me(),r=Q(h=>h.app.selectedBranch),{theme:o,stn_list:s}=Q(h=>h.param),n=p(gi(r)),t=p(mi(r)),e=h=>h.map(c=>s[c].name.join(" - ")).join(" ~ "),a=t.reduce((h,c)=>({...h,[c.join(",")]:e(c)}),{}),u=()=>{console.log("ColineSection.handleAddTrackSharing():: Adding track sharing to branch ".concat(r," with default combination"),t[0]),p(bi(t[0][0],t[0][1],[[o[0],"","#AAAAAA",Pe.white,"",""]]))},v=h=>c=>{const[_,d]=c.split(",");console.log("ColineSection.handleUpdateRoute():: Updating route, colineId=".concat(h,", from=").concat(_,", to=").concat(d));try{p(yi(h,_,d))}catch(y){p(At({status:"error",message:"Unable to draw this share track."}))}},g=(h,c)=>{p(vi(h,c))};return b.jsxs(Et,{align:"flex-start",p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("BranchSidePanel.coline.title")}),Object.entries(n).map(([h,c])=>b.jsx(ki,{colineInfo:c,routeOptions:a,onUpdateRoute:v(h),onUpdateColourInfo:_=>p(Si(h,0,_)),onDelete:_=>g(h,_)},h)),(r===0||Object.keys(n).length===0)&&b.jsx(ce,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:b.jsx(Re,{}),onClick:u,children:f("BranchSidePanel.coline.add")})]})}function ji(f){const{isOpen:p,onClose:r}=f,{t:o}=le(),s=me(),n=Q(j=>j.app.selectedBranch),{style:t,stn_list:e}=Q(j=>j.param),a=Q(j=>j.helper.branches),[u,v]=q.useState(n),[g,h]=q.useState("1"),[c,_]=q.useState("2"),[d,y]=q.useState("asc");q.useEffect(()=>{v(n)},[n]);const m=[{type:"select",label:o("AutoNumModal.where"),value:u,options:{...a.reduce((j,A,R)=>({...j,[R]:R===0?o("AutoNumModal.main"):t!==J.SHMetro||!Ue(A,e)?o("AutoNumModal.branch")+" "+R:o("AutoNumModal.external")+" "+R}),{})},onChange:j=>v(j)},{type:"input",label:o("AutoNumModal.from"),value:g,validator:j=>!isNaN(Number(j)),onChange:h,debouncedDelay:0},{type:"input",label:o("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:c,onChange:_,debouncedDelay:0},{type:"select",label:o("AutoNumModal.sort"),value:d,options:{asc:o("AutoNumModal.asc"),desc:o("AutoNumModal.desc")},onChange:j=>y(j)}],x=()=>{s(gr(u,Number(g),Number(c),d)),r(),he.event(ve.AUTO_NUMBERING,{})},C=!g||!c||isNaN(Number(g))||isNaN(Number(c));return b.jsxs(Ke,{isOpen:p,onClose:r,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[b.jsx(Qe,{children:o("AutoNumModal.title")}),b.jsx(et,{}),b.jsx(tt,{children:b.jsx(_e,{fields:m})}),b.jsx(nt,{children:b.jsx(ce,{colorScheme:"primary",isDisabled:C,onClick:x,children:o("Confirm")})})]})]})}const Bt=f=>(p,r)=>{const s=r().helper.branches[f];return s.includes("linestart")||s.includes("lineend")?1:2},hn=f=>(p,r)=>{const{branches:o}=r().helper,s=o[0],n=o[f];return s.slice(s.indexOf(n[0])+1,s.indexOf(n.slice(-1)[0]))},Ai=(f,p)=>r=>r(Bt(p))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):r(hn(p)).includes(f)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Ei=(f,p)=>(r,o)=>{if(!r(Ai(f,p)))return!1;const{branches:n}=o().helper,t=o().param.stn_list,e=n[p];if(e[0]==="linestart"){const a={...t,[e[1]]:{...t[e[1]],parents:[f]},[f]:{...t[f],children:t.linestart.children.map(u=>u===e[1]?u:t[f].children[0]),branch:{left:[],right:t.linestart.branch.right}},linestart:{...t.linestart,children:t.linestart.children.filter(u=>u!==e[1]),branch:{left:[],right:[]}}};return r(Me(a)),!0}else{const a=e.slice(-2)[0],u={...t,[a]:{...t[a],children:[f]},[f]:{...t[f],parents:t.lineend.parents.map(v=>v===a?v:t[f].parents[0]),branch:{right:[],left:t.lineend.branch.left}},lineend:{...t.lineend,parents:t.lineend.parents.filter(v=>v!==a),branch:{left:[],right:[]}}};return r(Me(u)),!0}},un=f=>(p,r)=>{const{branches:o}=r().helper,s=r().param.stn_list,n=o[0],t=o[f];if(p(Bt(f))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const a=n.indexOf(t[0]),u=n.slice(0,a),v=n.indexOf(t.slice(-1)[0]),g=n.slice(v+1),h=u.every(_=>s[_].children.length<=1&&s[_].parents.length<=1),c=g.every(_=>s[_].children.length<=1&&s[_].parents.length<=1);return h?c?[we.left,we.right]:[we.left]:c?[we.right]:[]},Oi=(f,p)=>(r,o)=>{if(!r(un(p)).includes(f))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:n}=o().helper,t=o().param.stn_list,e=n[0],a=n[p];if(f===we.left){const u=a[0],v={...t,[a[1]]:{...t[a[1]],parents:["linestart"]},[u]:{...t[u],children:t[u].children.filter(g=>g!==a[1]),branch:{right:[],left:[]}},linestart:{...t.linestart,children:t[u].children.map(g=>g===a[1]?g:e[1]),branch:{left:[],right:t[u].branch.right}}};return r(Me(v)),!0}else{const u=a.slice(-1)[0],v=a.slice(-2)[0],g={...t,[v]:{...t[v],children:["lineend"]},[u]:{...t[u],parents:t[u].parents.filter(h=>h!==v),branch:{right:[],left:[]}},lineend:{...t.lineend,parents:t[u].parents.map(h=>h===v?h:e.slice(-2)[0]),branch:{right:[],left:t[u].branch.left}}};return r(Me(g)),!0}};function $t(f){const{direction:p}=f,{t:r}=le(),o=me(),{branches:s}=Q(P=>P.helper),n=Q(P=>P.app.selectedBranch),{style:t,stn_list:e}=Q(P=>P.param),[a,u]=q.useState(!1),[v,g]=q.useState(""),h=s[n].filter(P=>!["linestart","lineend"].includes(P)),c=p===we.left?h[0]:h.slice(-1)[0],_=e[c],d=o(hn(n)),y=o(Bt(n)),m=o(un(n)),x=y===1&&!s[0].includes(c),C=m.includes(p),j=d.reduce((P,D)=>{var z;return{...P,[D]:(z=e[D])==null?void 0:z.name.join(" - ")}},{"":r("Please select...")}),A=()=>{const P=o(Ei(v,n));P?u(!1):o(At({status:"error",message:r("Unable to connect to main line.")})),he.event(ve.CONNECT_BRANCH,{style:t,success:P})},R=()=>{const P=o(Oi(p,n));P||o(At({status:"error",message:r("Unable to disconnect from main line.")})),he.event(ve.DISCONNECT_BRANCH,{style:t,success:P})};return b.jsxs(Be,{direction:"column",children:[b.jsxs(Ee,{alignItems:"center",children:[b.jsx(xt,{label:r("Station name"),flex:1,children:b.jsx(_r,{defaultValue:_.name.join(" "),isDisabled:!0})}),a?b.jsx(ce,{mx:1,size:"sm",variant:"outline",onClick:()=>u(!1),children:r("Cancel")}):x?b.jsx(ce,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>u(!0),children:r("Connect to main line")}):b.jsx(ce,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:R,isDisabled:!C,children:r("Disconnect from main line")})]}),a&&b.jsxs(Ee,{alignItems:"center",children:[b.jsx(xt,{label:r("Target station"),flex:1,children:b.jsx(br,{defaultValue:v,options:j,disabledOptions:[""],onChange:({target:{value:P}})=>g(P)})}),b.jsx(ce,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:A,isDisabled:!v,children:r("Confirm")})]})]})}function Ri(){const{t:f}=le(),p=me(),r=Q(e=>e.param.style),o=Q(e=>e.app.selectedBranch),[s,n]=q.useState(!1),t=()=>{p(Sr(r===J.SHMetro)),he.event(ve.REVERSE_STATIONS,{style:r})};return b.jsxs(Se,{p:1,children:[b.jsx(ye,{as:"h5",size:"sm",children:f("BranchSidePanel.action.title")}),b.jsxs(Ee,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[o!==0&&r!==J.SHMetro&&b.jsxs(b.Fragment,{children:[b.jsx(ye,{as:"h6",size:"xs",children:f("Branch left end")}),b.jsx($t,{direction:we.left}),b.jsx(ye,{as:"h6",size:"xs",children:f("Branch right end")}),b.jsx($t,{direction:we.right})]}),r===J.GZMTR&&b.jsx(ce,{size:"sm",variant:"outline",leftIcon:b.jsx(yr,{}),alignSelf:"flex-end",onClick:()=>n(!0),children:f("BranchSidePanel.action.autoNum")}),b.jsx(ce,{size:"sm",variant:"outline",leftIcon:b.jsx(vr,{}),alignSelf:"flex-end",onClick:t,children:r===J.SHMetro?f("BranchSidePanel.action.flip"):f("BranchSidePanel.action.reverse")})]}),b.jsx(ji,{isOpen:s,onClose:()=>n(!1)})]})}function zi(){const f=Q(s=>s.app.selectedBranch),{style:p,stn_list:r}=Q(s=>s.param),o=Q(s=>s.helper.branches);return b.jsxs(Rt,{children:[p===J.SHMetro&&(f===0||Ue(o[f],r))&&b.jsxs(b.Fragment,{children:[b.jsx(Ci,{}),b.jsx(Te,{})]}),b.jsx(Ri,{})]})}const Pi="rmg-palette-bridge--",Ti={position:"relative",h:460,maxH:"70%","& > button":{position:"absolute",right:1,top:1},"& iframe":{h:"100%",w:"100%"}};function Ii(f){const{isOpen:p,onClose:r,defaultTheme:o,onSelect:s}=f,[n]=q.useState(crypto.randomUUID()),t="/rmg-palette/#/picker?"+new URLSearchParams({parentComponent:he.getAppName(),parentId:n}),e=q.useRef();return q.useEffect(()=>{const a=new BroadcastChannel(Pi+n);return e.current=a,a.onmessage=u=>{const{event:v,data:g}=u.data;console.log("[rmg] Received event from Palette app clip:",v),v==="CLOSE"?r():v==="SELECT"?s(g):v==="LOADED"&&o&&a.postMessage({event:"OPEN",data:o})},()=>{a.close()}},[]),q.useEffect(()=>{var a;o&&((a=e.current)==null||a.postMessage({event:"OPEN",data:o}))},[o==null?void 0:o.toString()]),b.jsxs(rn,{size:"md",isOpen:p,onClose:r,sx:Ti,children:[b.jsx(qt,{onClick:r}),b.jsx("iframe",{src:t,loading:"lazy"})]})}const Bi=410;function Mi(){var g,h;const{t:f}=le(),p=zt(),{sidePanelMode:r,selectedStation:o}=Q(c=>c.app),s=Q(c=>{var _;return(_=c.param.stn_list[o])==null?void 0:_.name}),[n,t]=q.useState(),[e,a]=q.useState(),u={STATION:{header:b.jsx(Vr,{text:(s==null?void 0:s.join(" - "))||""}),body:b.jsx(ii,{}),footer:b.jsx(wi,{})},STYLE:{header:f("StyleSidePanel.header"),body:b.jsx(di,{})},BRANCH:{header:f("BranchSidePanel.header"),body:b.jsx(zi,{})},CLOSE:{header:"Close"}},v=()=>{p(Fe(De.CLOSE))};return b.jsxs(xr,{isOpen:r!==De.CLOSE,width:Bi,header:"Dummy header",children:[b.jsx(wr,{onClose:v,children:u[r].header}),b.jsx(pt.Provider,{value:{prevTheme:n,setPrevTheme:t,nextTheme:e,setNextTheme:a},children:(g=u[r])==null?void 0:g.body}),(h=u[r])==null?void 0:h.footer,b.jsx(Ii,{isOpen:!!n,onClose:()=>t(void 0),defaultTheme:n,onSelect:c=>{a(c),t(void 0)}})]})}function ot(f){throw new Error('Could not dynamically require "'+f+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(f,p){(function(r){f.exports=r()})(function(){return function r(o,s,n){function t(u,v){if(!s[u]){if(!o[u]){var g=typeof ot=="function"&&ot;if(!v&&g)return g(u,!0);if(e)return e(u,!0);var h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h}var c=s[u]={exports:{}};o[u][0].call(c.exports,function(_){var d=o[u][1][_];return t(d||_)},c,c.exports,r,o,s,n)}return s[u].exports}for(var e=typeof ot=="function"&&ot,a=0;a<n.length;a++)t(n[a]);return t}({1:[function(r,o,s){var n=r("./utils"),t=r("./support"),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(a){for(var u,v,g,h,c,_,d,y=[],m=0,x=a.length,C=x,j=n.getTypeOf(a)!=="string";m<a.length;)C=x-m,g=j?(u=a[m++],v=m<x?a[m++]:0,m<x?a[m++]:0):(u=a.charCodeAt(m++),v=m<x?a.charCodeAt(m++):0,m<x?a.charCodeAt(m++):0),h=u>>2,c=(3&u)<<4|v>>4,_=1<C?(15&v)<<2|g>>6:64,d=2<C?63&g:64,y.push(e.charAt(h)+e.charAt(c)+e.charAt(_)+e.charAt(d));return y.join("")},s.decode=function(a){var u,v,g,h,c,_,d=0,y=0,m="data:";if(a.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var x,C=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===e.charAt(64)&&C--,a.charAt(a.length-2)===e.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=t.uint8array?new Uint8Array(0|C):new Array(0|C);d<a.length;)u=e.indexOf(a.charAt(d++))<<2|(h=e.indexOf(a.charAt(d++)))>>4,v=(15&h)<<4|(c=e.indexOf(a.charAt(d++)))>>2,g=(3&c)<<6|(_=e.indexOf(a.charAt(d++))),x[y++]=u,c!==64&&(x[y++]=v),_!==64&&(x[y++]=g);return x}},{"./support":30,"./utils":32}],2:[function(r,o,s){var n=r("./external"),t=r("./stream/DataWorker"),e=r("./stream/Crc32Probe"),a=r("./stream/DataLengthProbe");function u(v,g,h,c,_){this.compressedSize=v,this.uncompressedSize=g,this.crc32=h,this.compression=c,this.compressedContent=_}u.prototype={getContentWorker:function(){var v=new t(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),g=this;return v.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new t(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(v,g,h){return v.pipe(new e).pipe(new a("uncompressedSize")).pipe(g.compressWorker(h)).pipe(new a("compressedSize")).withStreamInfo("compression",g)},o.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,o,s){var n=r("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},s.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,o,s){var n=r("./utils"),t=function(){for(var e,a=[],u=0;u<256;u++){e=u;for(var v=0;v<8;v++)e=1&e?3988292384^e>>>1:e>>>1;a[u]=e}return a}();o.exports=function(e,a){return e!==void 0&&e.length?n.getTypeOf(e)!=="string"?function(u,v,g,h){var c=t,_=h+g;u^=-1;for(var d=h;d<_;d++)u=u>>>8^c[255&(u^v[d])];return-1^u}(0|a,e,e.length,0):function(u,v,g,h){var c=t,_=h+g;u^=-1;for(var d=h;d<_;d++)u=u>>>8^c[255&(u^v.charCodeAt(d))];return-1^u}(0|a,e,e.length,0):0}},{"./utils":32}],5:[function(r,o,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(r,o,s){var n=null;n=typeof Promise<"u"?Promise:r("lie"),o.exports={Promise:n}},{lie:37}],7:[function(r,o,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",t=r("pako"),e=r("./utils"),a=r("./stream/GenericWorker"),u=n?"uint8array":"array";function v(g,h){a.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=h,this.meta={}}s.magic="\b\0",e.inherits(v,a),v.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(e.transformTo(u,g.data),!1)},v.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new t[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(h){g.push({data:h,meta:g.meta})}},s.compressWorker=function(g){return new v("Deflate",g)},s.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,o,s){function n(c,_){var d,y="";for(d=0;d<_;d++)y+=String.fromCharCode(255&c),c>>>=8;return y}function t(c,_,d,y,m,x){var C,j,A=c.file,R=c.compression,P=x!==u.utf8encode,D=e.transformTo("string",x(A.name)),z=e.transformTo("string",u.utf8encode(A.name)),F=A.comment,$=e.transformTo("string",x(F)),k=e.transformTo("string",u.utf8encode(F)),M=z.length!==A.name.length,l=k.length!==F.length,N="",ne="",Z="",ie=A.dir,H=A.date,re={crc32:0,compressedSize:0,uncompressedSize:0};_&&!d||(re.crc32=c.crc32,re.compressedSize=c.compressedSize,re.uncompressedSize=c.uncompressedSize);var I=0;_&&(I|=8),P||!M&&!l||(I|=2048);var T=0,te=0;ie&&(T|=16),m==="UNIX"?(te=798,T|=function(Y,ue){var be=Y;return Y||(be=ue?16893:33204),(65535&be)<<16}(A.unixPermissions,ie)):(te=20,T|=function(Y){return 63&(Y||0)}(A.dosPermissions)),C=H.getUTCHours(),C<<=6,C|=H.getUTCMinutes(),C<<=5,C|=H.getUTCSeconds()/2,j=H.getUTCFullYear()-1980,j<<=4,j|=H.getUTCMonth()+1,j<<=5,j|=H.getUTCDate(),M&&(ne=n(1,1)+n(v(D),4)+z,N+="up"+n(ne.length,2)+ne),l&&(Z=n(1,1)+n(v($),4)+k,N+="uc"+n(Z.length,2)+Z);var K="";return K+="\n\0",K+=n(I,2),K+=R.magic,K+=n(C,2),K+=n(j,2),K+=n(re.crc32,4),K+=n(re.compressedSize,4),K+=n(re.uncompressedSize,4),K+=n(D.length,2),K+=n(N.length,2),{fileRecord:g.LOCAL_FILE_HEADER+K+D+N,dirRecord:g.CENTRAL_FILE_HEADER+n(te,2)+K+n($.length,2)+"\0\0\0\0"+n(T,4)+n(y,4)+D+N+$}}var e=r("../utils"),a=r("../stream/GenericWorker"),u=r("../utf8"),v=r("../crc32"),g=r("../signature");function h(c,_,d,y){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=d,this.encodeFileName=y,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}e.inherits(h,a),h.prototype.push=function(c){var _=c.meta.percent||0,d=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,a.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:d?(_+100*(d-y-1))/d:100}}))},h.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var _=this.streamFiles&&!c.file.dir;if(_){var d=t(c,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(c){this.accumulate=!1;var _=this.streamFiles&&!c.file.dir,d=t(c,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),_)this.push({data:function(y){return g.DATA_DESCRIPTOR+n(y.crc32,4)+n(y.compressedSize,4)+n(y.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var c=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var d=this.bytesWritten-c,y=function(m,x,C,j,A){var R=e.transformTo("string",A(j));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(m,2)+n(m,2)+n(x,4)+n(C,4)+n(R.length,2)+R}(this.dirRecords.length,d,c,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(c){this._sources.push(c);var _=this;return c.on("data",function(d){_.processChunk(d)}),c.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),c.on("error",function(d){_.error(d)}),this},h.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(c){var _=this._sources;if(!a.prototype.error.call(this,c))return!1;for(var d=0;d<_.length;d++)try{_[d].error(c)}catch(y){}return!0},h.prototype.lock=function(){a.prototype.lock.call(this);for(var c=this._sources,_=0;_<c.length;_++)c[_].lock()},o.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,o,s){var n=r("../compressions"),t=r("./ZipFileWorker");s.generateWorker=function(e,a,u){var v=new t(a.streamFiles,u,a.platform,a.encodeFileName),g=0;try{e.forEach(function(h,c){g++;var _=function(x,C){var j=x||C,A=n[j];if(!A)throw new Error(j+" is not a valid compression method !");return A}(c.options.compression,a.compression),d=c.options.compressionOptions||a.compressionOptions||{},y=c.dir,m=c.date;c._compressWorker(_,d).withStreamInfo("file",{name:h,dir:y,date:m,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(v)}),v.entriesCount=g}catch(h){v.error(h)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,o,s){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)typeof this[e]!="function"&&(t[e]=this[e]);return t}}(n.prototype=r("./object")).loadAsync=r("./load"),n.support=r("./support"),n.defaults=r("./defaults"),n.version="3.10.1",n.loadAsync=function(t,e){return new n().loadAsync(t,e)},n.external=r("./external"),o.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,o,s){var n=r("./utils"),t=r("./external"),e=r("./utf8"),a=r("./zipEntries"),u=r("./stream/Crc32Probe"),v=r("./nodejsUtils");function g(h){return new t.Promise(function(c,_){var d=h.decompressed.getContentWorker().pipe(new u);d.on("error",function(y){_(y)}).on("end",function(){d.streamInfo.crc32!==h.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}o.exports=function(h,c){var _=this;return c=n.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:e.utf8decode}),v.isNode&&v.isStream(h)?t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",h,!0,c.optimizedBinaryString,c.base64).then(function(d){var y=new a(c);return y.load(d),y}).then(function(d){var y=[t.Promise.resolve(d)],m=d.files;if(c.checkCRC32)for(var x=0;x<m.length;x++)y.push(g(m[x]));return t.Promise.all(y)}).then(function(d){for(var y=d.shift(),m=y.files,x=0;x<m.length;x++){var C=m[x],j=C.fileNameStr,A=n.resolve(C.fileNameStr);_.file(A,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:c.createFolders}),C.dir||(_.file(A).unsafeOriginalName=j)}return y.zipComment.length&&(_.comment=y.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,o,s){var n=r("../utils"),t=r("../stream/GenericWorker");function e(a,u){t.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(u)}n.inherits(e,t),e.prototype._bindStream=function(a){var u=this;(this._stream=a).pause(),a.on("data",function(v){u.push({data:v,meta:{percent:0}})}).on("error",function(v){u.isPaused?this.generatedError=v:u.error(v)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},e.prototype.pause=function(){return!!t.prototype.pause.call(this)&&(this._stream.pause(),!0)},e.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},o.exports=e},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,o,s){var n=r("readable-stream").Readable;function t(e,a,u){n.call(this,a),this._helper=e;var v=this;e.on("data",function(g,h){v.push(g)||v._helper.pause(),u&&u(h)}).on("error",function(g){v.emit("error",g)}).on("end",function(){v.push(null)})}r("../utils").inherits(t,n),t.prototype._read=function(){this._helper.resume()},o.exports=t},{"../utils":32,"readable-stream":16}],14:[function(r,o,s){o.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,t);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,t)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var t=new Buffer(n);return t.fill(0),t},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(r,o,s){function n(A,R,P){var D,z=e.getTypeOf(R),F=e.extend(P||{},v);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&16384&F.unixPermissions&&(F.dir=!0),F.dosPermissions&&16&F.dosPermissions&&(F.dir=!0),F.dir&&(A=m(A)),F.createFolders&&(D=y(A))&&x.call(this,D,!0);var $=z==="string"&&F.binary===!1&&F.base64===!1;P&&P.binary!==void 0||(F.binary=!$),(R instanceof g&&R.uncompressedSize===0||F.dir||!R||R.length===0)&&(F.base64=!1,F.binary=!0,R="",F.compression="STORE",z="string");var k=null;k=R instanceof g||R instanceof a?R:_.isNode&&_.isStream(R)?new d(A,R):e.prepareContent(A,R,F.binary,F.optimizedBinaryString,F.base64);var M=new h(A,k,F);this.files[A]=M}var t=r("./utf8"),e=r("./utils"),a=r("./stream/GenericWorker"),u=r("./stream/StreamHelper"),v=r("./defaults"),g=r("./compressedObject"),h=r("./zipObject"),c=r("./generate"),_=r("./nodejsUtils"),d=r("./nodejs/NodejsStreamInputAdapter"),y=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var R=A.lastIndexOf("/");return 0<R?A.substring(0,R):""},m=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},x=function(A,R){return R=R!==void 0?R:v.createFolders,A=m(A),this.files[A]||n.call(this,A,null,{dir:!0,createFolders:R}),this.files[A]};function C(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var R,P,D;for(R in this.files)D=this.files[R],(P=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&A(P,D)},filter:function(A){var R=[];return this.forEach(function(P,D){A(P,D)&&R.push(D)}),R},file:function(A,R,P){if(arguments.length!==1)return A=this.root+A,n.call(this,A,R,P),this;if(C(A)){var D=A;return this.filter(function(F,$){return!$.dir&&D.test(F)})}var z=this.files[this.root+A];return z&&!z.dir?z:null},folder:function(A){if(!A)return this;if(C(A))return this.filter(function(z,F){return F.dir&&A.test(z)});var R=this.root+A,P=x.call(this,R),D=this.clone();return D.root=P.name,D},remove:function(A){A=this.root+A;var R=this.files[A];if(R||(A.slice(-1)!=="/"&&(A+="/"),R=this.files[A]),R&&!R.dir)delete this.files[A];else for(var P=this.filter(function(z,F){return F.name.slice(0,A.length)===A}),D=0;D<P.length;D++)delete this.files[P[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var R,P={};try{if((P=e.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:t.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");e.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var D=P.comment||this.comment||"";R=c.generateWorker(this,P,D)}catch(z){(R=new a("error")).error(z)}return new u(R,P.type||"string",P.mimeType)},generateAsync:function(A,R){return this.generateInternalStream(A).accumulate(R)},generateNodeStream:function(A,R){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(R)}};o.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,o,s){o.exports=r("stream")},{stream:void 0}],17:[function(r,o,s){var n=r("./DataReader");function t(e){n.call(this,e);for(var a=0;a<this.data.length;a++)e[a]=255&e[a]}r("../utils").inherits(t,n),t.prototype.byteAt=function(e){return this.data[this.zero+e]},t.prototype.lastIndexOfSignature=function(e){for(var a=e.charCodeAt(0),u=e.charCodeAt(1),v=e.charCodeAt(2),g=e.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===a&&this.data[h+1]===u&&this.data[h+2]===v&&this.data[h+3]===g)return h-this.zero;return-1},t.prototype.readAndCheckSignature=function(e){var a=e.charCodeAt(0),u=e.charCodeAt(1),v=e.charCodeAt(2),g=e.charCodeAt(3),h=this.readData(4);return a===h[0]&&u===h[1]&&v===h[2]&&g===h[3]},t.prototype.readData=function(e){if(this.checkOffset(e),e===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},o.exports=t},{"../utils":32,"./DataReader":18}],18:[function(r,o,s){var n=r("../utils");function t(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}t.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var a,u=0;for(this.checkOffset(e),a=this.index+e-1;a>=this.index;a--)u=(u<<8)+this.byteAt(a);return this.index+=e,u},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},o.exports=t},{"../utils":32}],19:[function(r,o,s){var n=r("./Uint8ArrayReader");function t(e){n.call(this,e)}r("../utils").inherits(t,n),t.prototype.readData=function(e){this.checkOffset(e);var a=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},o.exports=t},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,o,s){var n=r("./DataReader");function t(e){n.call(this,e)}r("../utils").inherits(t,n),t.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},t.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},t.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},t.prototype.readData=function(e){this.checkOffset(e);var a=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},o.exports=t},{"../utils":32,"./DataReader":18}],21:[function(r,o,s){var n=r("./ArrayReader");function t(e){n.call(this,e)}r("../utils").inherits(t,n),t.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},o.exports=t},{"../utils":32,"./ArrayReader":17}],22:[function(r,o,s){var n=r("../utils"),t=r("../support"),e=r("./ArrayReader"),a=r("./StringReader"),u=r("./NodeBufferReader"),v=r("./Uint8ArrayReader");o.exports=function(g){var h=n.getTypeOf(g);return n.checkSupport(h),h!=="string"||t.uint8array?h==="nodebuffer"?new u(g):t.uint8array?new v(n.transformTo("uint8array",g)):new e(n.transformTo("array",g)):new a(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,o,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,o,s){var n=r("./GenericWorker"),t=r("../utils");function e(a){n.call(this,"ConvertWorker to "+a),this.destType=a}t.inherits(e,n),e.prototype.processChunk=function(a){this.push({data:t.transformTo(this.destType,a.data),meta:a.meta})},o.exports=e},{"../utils":32,"./GenericWorker":28}],25:[function(r,o,s){var n=r("./GenericWorker"),t=r("../crc32");function e(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(e,n),e.prototype.processChunk=function(a){this.streamInfo.crc32=t(a.data,this.streamInfo.crc32||0),this.push(a)},o.exports=e},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,o,s){var n=r("../utils"),t=r("./GenericWorker");function e(a){t.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(e,t),e.prototype.processChunk=function(a){if(a){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+a.data.length}t.prototype.processChunk.call(this,a)},o.exports=e},{"../utils":32,"./GenericWorker":28}],27:[function(r,o,s){var n=r("../utils"),t=r("./GenericWorker");function e(a){t.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(v){u.dataIsReady=!0,u.data=v,u.max=v&&v.length||0,u.type=n.getTypeOf(v),u.isPaused||u._tickAndRepeat()},function(v){u.error(v)})}n.inherits(e,t),e.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this.data=null},e.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},e.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},e.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,u);break;case"uint8array":a=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":a=this.data.slice(this.index,u)}return this.index=u,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},o.exports=e},{"../utils":32,"./GenericWorker":28}],28:[function(r,o,s){function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var a=0;a<this._listeners[t].length;a++)this._listeners[t][a].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(a){e.processChunk(a)}),t.on("end",function(){e.end()}),t.on("error",function(a){e.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},o.exports=n},{}],29:[function(r,o,s){var n=r("../utils"),t=r("./ConvertWorker"),e=r("./GenericWorker"),a=r("../base64"),u=r("../support"),v=r("../external"),g=null;if(u.nodestream)try{g=r("../nodejs/NodejsStreamOutputAdapter")}catch(_){}function h(_,d){return new v.Promise(function(y,m){var x=[],C=_._internalType,j=_._outputType,A=_._mimeType;_.on("data",function(R,P){x.push(R),d&&d(P)}).on("error",function(R){x=[],m(R)}).on("end",function(){try{var R=function(P,D,z){switch(P){case"blob":return n.newBlob(n.transformTo("arraybuffer",D),z);case"base64":return a.encode(D);default:return n.transformTo(P,D)}}(j,function(P,D){var z,F=0,$=null,k=0;for(z=0;z<D.length;z++)k+=D[z].length;switch(P){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for($=new Uint8Array(k),z=0;z<D.length;z++)$.set(D[z],F),F+=D[z].length;return $;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+P+"'")}}(C,x),A);y(R)}catch(P){m(P)}x=[]}).resume()})}function c(_,d,y){var m=d;switch(d){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=d,this._mimeType=y,n.checkSupport(m),this._worker=_.pipe(new t(m)),_.lock()}catch(x){this._worker=new e("error"),this._worker.error(x)}}c.prototype={accumulate:function(_){return h(this,_)},on:function(_,d){var y=this;return _==="data"?this._worker.on(_,function(m){d.call(y,m.data,m.meta)}):this._worker.on(_,function(){n.delay(d,arguments,y)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},_)}},o.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,o,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var n=new ArrayBuffer(0);try{s.blob=new Blob([n],{type:"application/zip"}).size===0}catch(e){try{var t=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);t.append(n),s.blob=t.getBlob("application/zip").size===0}catch(a){s.blob=!1}}}try{s.nodestream=!!r("readable-stream").Readable}catch(e){s.nodestream=!1}},{"readable-stream":16}],31:[function(r,o,s){for(var n=r("./utils"),t=r("./support"),e=r("./nodejsUtils"),a=r("./stream/GenericWorker"),u=new Array(256),v=0;v<256;v++)u[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;u[254]=u[254]=1;function g(){a.call(this,"utf-8 decode"),this.leftOver=null}function h(){a.call(this,"utf-8 encode")}s.utf8encode=function(c){return t.nodebuffer?e.newBufferFrom(c,"utf-8"):function(_){var d,y,m,x,C,j=_.length,A=0;for(x=0;x<j;x++)(64512&(y=_.charCodeAt(x)))==55296&&x+1<j&&(64512&(m=_.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(m-56320),x++),A+=y<128?1:y<2048?2:y<65536?3:4;for(d=t.uint8array?new Uint8Array(A):new Array(A),x=C=0;C<A;x++)(64512&(y=_.charCodeAt(x)))==55296&&x+1<j&&(64512&(m=_.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(m-56320),x++),y<128?d[C++]=y:(y<2048?d[C++]=192|y>>>6:(y<65536?d[C++]=224|y>>>12:(d[C++]=240|y>>>18,d[C++]=128|y>>>12&63),d[C++]=128|y>>>6&63),d[C++]=128|63&y);return d}(c)},s.utf8decode=function(c){return t.nodebuffer?n.transformTo("nodebuffer",c).toString("utf-8"):function(_){var d,y,m,x,C=_.length,j=new Array(2*C);for(d=y=0;d<C;)if((m=_[d++])<128)j[y++]=m;else if(4<(x=u[m]))j[y++]=65533,d+=x-1;else{for(m&=x===2?31:x===3?15:7;1<x&&d<C;)m=m<<6|63&_[d++],x--;1<x?j[y++]=65533:m<65536?j[y++]=m:(m-=65536,j[y++]=55296|m>>10&1023,j[y++]=56320|1023&m)}return j.length!==y&&(j.subarray?j=j.subarray(0,y):j.length=y),n.applyFromCharCode(j)}(c=n.transformTo(t.uint8array?"uint8array":"array",c))},n.inherits(g,a),g.prototype.processChunk=function(c){var _=n.transformTo(t.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(t.uint8array){var d=_;(_=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),_.set(d,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var y=function(x,C){var j;for((C=C||x.length)>x.length&&(C=x.length),j=C-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?C:j+u[x[j]]>C?j:C}(_),m=_;y!==_.length&&(t.uint8array?(m=_.subarray(0,y),this.leftOver=_.subarray(y,_.length)):(m=_.slice(0,y),this.leftOver=_.slice(y,_.length))),this.push({data:s.utf8decode(m),meta:c.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=g,n.inherits(h,a),h.prototype.processChunk=function(c){this.push({data:s.utf8encode(c.data),meta:c.meta})},s.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,o,s){var n=r("./support"),t=r("./base64"),e=r("./nodejsUtils"),a=r("./external");function u(d){return d}function v(d,y){for(var m=0;m<d.length;++m)y[m]=255&d.charCodeAt(m);return y}r("setimmediate"),s.newBlob=function(d,y){s.checkSupport("blob");try{return new Blob([d],{type:y})}catch(x){try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(d),m.getBlob(y)}catch(C){throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(d,y,m){var x=[],C=0,j=d.length;if(j<=m)return String.fromCharCode.apply(null,d);for(;C<j;)y==="array"||y==="nodebuffer"?x.push(String.fromCharCode.apply(null,d.slice(C,Math.min(C+m,j)))):x.push(String.fromCharCode.apply(null,d.subarray(C,Math.min(C+m,j)))),C+=m;return x.join("")},stringifyByChar:function(d){for(var y="",m=0;m<d.length;m++)y+=String.fromCharCode(d[m]);return y},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(d){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,e.allocBuffer(1)).length===1}catch(d){return!1}}()}};function h(d){var y=65536,m=s.getTypeOf(d),x=!0;if(m==="uint8array"?x=g.applyCanBeUsed.uint8array:m==="nodebuffer"&&(x=g.applyCanBeUsed.nodebuffer),x)for(;1<y;)try{return g.stringifyByChunk(d,m,y)}catch(C){y=Math.floor(y/2)}return g.stringifyByChar(d)}function c(d,y){for(var m=0;m<d.length;m++)y[m]=d[m];return y}s.applyFromCharCode=h;var _={};_.string={string:u,array:function(d){return v(d,new Array(d.length))},arraybuffer:function(d){return _.string.uint8array(d).buffer},uint8array:function(d){return v(d,new Uint8Array(d.length))},nodebuffer:function(d){return v(d,e.allocBuffer(d.length))}},_.array={string:h,array:u,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return e.newBufferFrom(d)}},_.arraybuffer={string:function(d){return h(new Uint8Array(d))},array:function(d){return c(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:u,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return e.newBufferFrom(new Uint8Array(d))}},_.uint8array={string:h,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:u,nodebuffer:function(d){return e.newBufferFrom(d)}},_.nodebuffer={string:h,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return _.nodebuffer.uint8array(d).buffer},uint8array:function(d){return c(d,new Uint8Array(d.length))},nodebuffer:u},s.transformTo=function(d,y){if(y=y||"",!d)return y;s.checkSupport(d);var m=s.getTypeOf(y);return _[m][d](y)},s.resolve=function(d){for(var y=d.split("/"),m=[],x=0;x<y.length;x++){var C=y[x];C==="."||C===""&&x!==0&&x!==y.length-1||(C===".."?m.pop():m.push(C))}return m.join("/")},s.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":n.nodebuffer&&e.isBuffer(d)?"nodebuffer":n.uint8array&&d instanceof Uint8Array?"uint8array":n.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(d){if(!n[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(d){var y,m,x="";for(m=0;m<(d||"").length;m++)x+="\\x"+((y=d.charCodeAt(m))<16?"0":"")+y.toString(16).toUpperCase();return x},s.delay=function(d,y,m){setImmediate(function(){d.apply(m||null,y||[])})},s.inherits=function(d,y){function m(){}m.prototype=y.prototype,d.prototype=new m},s.extend=function(){var d,y,m={};for(d=0;d<arguments.length;d++)for(y in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],y)&&m[y]===void 0&&(m[y]=arguments[d][y]);return m},s.prepareContent=function(d,y,m,x,C){return a.Promise.resolve(y).then(function(j){return n.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new a.Promise(function(A,R){var P=new FileReader;P.onload=function(D){A(D.target.result)},P.onerror=function(D){R(D.target.error)},P.readAsArrayBuffer(j)}):j}).then(function(j){var A=s.getTypeOf(j);return A?(A==="arraybuffer"?j=s.transformTo("uint8array",j):A==="string"&&(C?j=t.decode(j):m&&x!==!0&&(j=function(R){return v(R,n.uint8array?new Uint8Array(R.length):new Array(R.length))}(j))),j):a.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,o,s){var n=r("./reader/readerFor"),t=r("./utils"),e=r("./signature"),a=r("./zipEntry"),u=r("./support");function v(g){this.files=[],this.loadOptions=g}v.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+t.pretty(h)+", expected "+t.pretty(g)+")")}},isSignature:function(g,h){var c=this.reader.index;this.reader.setIndex(g);var _=this.reader.readString(4)===h;return this.reader.setIndex(c),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),h=u.uint8array?"uint8array":"array",c=t.transformTo(h,g);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,h,c,_=this.zip64EndOfCentralSize-44;0<_;)g=this.reader.readInt(2),h=this.reader.readInt(4),c=this.reader.readData(h),this.zip64ExtensibleData[g]={id:g,length:h,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,h;for(g=0;g<this.files.length;g++)h=this.files[g],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(e.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(e.CENTRAL_FILE_HEADER);)(g=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(e.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,e.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var h=g;if(this.checkSignature(e.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,e.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var _=h-c;if(0<_)this.isSignature(h,e.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(g){this.reader=n(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},o.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,o,s){var n=r("./reader/readerFor"),t=r("./utils"),e=r("./compressedObject"),a=r("./crc32"),u=r("./utf8"),v=r("./compressions"),g=r("./support");function h(c,_){this.options=c,this.loadOptions=_}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var _,d;if(c.skip(22),this.fileNameLength=c.readInt(2),d=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=function(y){for(var m in v)if(Object.prototype.hasOwnProperty.call(v,m)&&v[m].magic===y)return v[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+t.pretty(this.compressionMethod)+" unknown (inner file : "+t.transformTo("string",this.fileName)+")");this.decompressed=new e(this.compressedSize,this.uncompressedSize,this.crc32,_,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var _=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(_),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=n(this.extraFields[1].value);this.uncompressedSize===t.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===t.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===t.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===t.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var _,d,y,m=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<m;)_=c.readInt(2),d=c.readInt(2),y=c.readData(d),this.extraFields[_]={id:_,length:d,value:y};c.setIndex(m)},handleUTF8:function(){var c=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var d=t.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var m=t.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var _=n(c.value);return _.readInt(1)!==1||a(this.fileName)!==_.readInt(4)?null:u.utf8decode(_.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var _=n(c.value);return _.readInt(1)!==1||a(this.fileComment)!==_.readInt(4)?null:u.utf8decode(_.readData(c.length-5))}return null}},o.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,o,s){function n(_,d,y){this.name=_,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=d,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var t=r("./stream/StreamHelper"),e=r("./stream/DataWorker"),a=r("./utf8"),u=r("./compressedObject"),v=r("./stream/GenericWorker");n.prototype={internalStream:function(_){var d=null,y="string";try{if(!_)throw new Error("No output type specified.");var m=(y=_.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),d=this._decompressWorker();var x=!this._dataBinary;x&&!m&&(d=d.pipe(new a.Utf8EncodeWorker)),!x&&m&&(d=d.pipe(new a.Utf8DecodeWorker))}catch(C){(d=new v("error")).error(C)}return new t(d,y,"")},async:function(_,d){return this.internalStream(_).accumulate(d)},nodeStream:function(_,d){return this.internalStream(_||"nodebuffer").toNodejsStream(d)},_compressWorker:function(_,d){if(this._data instanceof u&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new a.Utf8EncodeWorker)),u.createWorkerFrom(y,_,d)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof v?this._data:new e(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<g.length;c++)n.prototype[g[c]]=h;o.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,o,s){(function(n){var t,e,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var u=0,v=new a(_),g=n.document.createTextNode("");v.observe(g,{characterData:!0}),t=function(){g.data=u=++u%2}}else if(n.setImmediate||n.MessageChannel===void 0)t="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var d=n.document.createElement("script");d.onreadystatechange=function(){_(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},n.document.documentElement.appendChild(d)}:function(){setTimeout(_,0)};else{var h=new n.MessageChannel;h.port1.onmessage=_,t=function(){h.port2.postMessage(0)}}var c=[];function _(){var d,y;e=!0;for(var m=c.length;m;){for(y=c,c=[],d=-1;++d<m;)y[d]();m=c.length}e=!1}o.exports=function(d){c.push(d)!==1||e||t()}}).call(this,typeof st<"u"?st:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,o,s){var n=r("immediate");function t(){}var e={},a=["REJECTED"],u=["FULFILLED"],v=["PENDING"];function g(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,m!==t&&d(this,m)}function h(m,x,C){this.promise=m,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function c(m,x,C){n(function(){var j;try{j=x(C)}catch(A){return e.reject(m,A)}j===m?e.reject(m,new TypeError("Cannot resolve promise with itself")):e.resolve(m,j)})}function _(m){var x=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof x=="function")return function(){x.apply(m,arguments)}}function d(m,x){var C=!1;function j(P){C||(C=!0,e.reject(m,P))}function A(P){C||(C=!0,e.resolve(m,P))}var R=y(function(){x(A,j)});R.status==="error"&&j(R.value)}function y(m,x){var C={};try{C.value=m(x),C.status="success"}catch(j){C.status="error",C.value=j}return C}(o.exports=g).prototype.finally=function(m){if(typeof m!="function")return this;var x=this.constructor;return this.then(function(C){return x.resolve(m()).then(function(){return C})},function(C){return x.resolve(m()).then(function(){throw C})})},g.prototype.catch=function(m){return this.then(null,m)},g.prototype.then=function(m,x){if(typeof m!="function"&&this.state===u||typeof x!="function"&&this.state===a)return this;var C=new this.constructor(t);return this.state!==v?c(C,this.state===u?m:x,this.outcome):this.queue.push(new h(C,m,x)),C},h.prototype.callFulfilled=function(m){e.resolve(this.promise,m)},h.prototype.otherCallFulfilled=function(m){c(this.promise,this.onFulfilled,m)},h.prototype.callRejected=function(m){e.reject(this.promise,m)},h.prototype.otherCallRejected=function(m){c(this.promise,this.onRejected,m)},e.resolve=function(m,x){var C=y(_,x);if(C.status==="error")return e.reject(m,C.value);var j=C.value;if(j)d(m,j);else{m.state=u,m.outcome=x;for(var A=-1,R=m.queue.length;++A<R;)m.queue[A].callFulfilled(x)}return m},e.reject=function(m,x){m.state=a,m.outcome=x;for(var C=-1,j=m.queue.length;++C<j;)m.queue[C].callRejected(x);return m},g.resolve=function(m){return m instanceof this?m:e.resolve(new this(t),m)},g.reject=function(m){var x=new this(t);return e.reject(x,m)},g.all=function(m){var x=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=m.length,j=!1;if(!C)return this.resolve([]);for(var A=new Array(C),R=0,P=-1,D=new this(t);++P<C;)z(m[P],P);return D;function z(F,$){x.resolve(F).then(function(k){A[$]=k,++R!==C||j||(j=!0,e.resolve(D,A))},function(k){j||(j=!0,e.reject(D,k))})}},g.race=function(m){var x=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=m.length,j=!1;if(!C)return this.resolve([]);for(var A=-1,R=new this(t);++A<C;)P=m[A],x.resolve(P).then(function(D){j||(j=!0,e.resolve(R,D))},function(D){j||(j=!0,e.reject(R,D))});var P;return R}},{immediate:36}],38:[function(r,o,s){var n={};(0,r("./lib/utils/common").assign)(n,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),o.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,o,s){var n=r("./zlib/deflate"),t=r("./utils/common"),e=r("./utils/strings"),a=r("./zlib/messages"),u=r("./zlib/zstream"),v=Object.prototype.toString,g=0,h=-1,c=0,_=8;function d(m){if(!(this instanceof d))return new d(m);this.options=t.assign({level:h,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},m||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=n.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(C!==g)throw new Error(a[C]);if(x.header&&n.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?e.string2buf(x.dictionary):v.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(C=n.deflateSetDictionary(this.strm,j))!==g)throw new Error(a[C]);this._dict_set=!0}}function y(m,x){var C=new d(x);if(C.push(m,!0),C.err)throw C.msg||a[C.err];return C.result}d.prototype.push=function(m,x){var C,j,A=this.strm,R=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof m=="string"?A.input=e.string2buf(m):v.call(m)==="[object ArrayBuffer]"?A.input=new Uint8Array(m):A.input=m,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new t.Buf8(R),A.next_out=0,A.avail_out=R),(C=n.deflate(A,j))!==1&&C!==g)return this.onEnd(C),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(e.buf2binstring(t.shrinkBuf(A.output,A.next_out))):this.onData(t.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&C!==1);return j===4?(C=n.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===g):j!==2||(this.onEnd(g),!(A.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},s.Deflate=d,s.deflate=y,s.deflateRaw=function(m,x){return(x=x||{}).raw=!0,y(m,x)},s.gzip=function(m,x){return(x=x||{}).gzip=!0,y(m,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,o,s){var n=r("./zlib/inflate"),t=r("./utils/common"),e=r("./utils/strings"),a=r("./zlib/constants"),u=r("./zlib/messages"),v=r("./zlib/zstream"),g=r("./zlib/gzheader"),h=Object.prototype.toString;function c(d){if(!(this instanceof c))return new c(d);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},d||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||d&&d.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var m=n.inflateInit2(this.strm,y.windowBits);if(m!==a.Z_OK)throw new Error(u[m]);this.header=new g,n.inflateGetHeader(this.strm,this.header)}function _(d,y){var m=new c(y);if(m.push(d,!0),m.err)throw m.msg||u[m.err];return m.result}c.prototype.push=function(d,y){var m,x,C,j,A,R,P=this.strm,D=this.options.chunkSize,z=this.options.dictionary,F=!1;if(this.ended)return!1;x=y===~~y?y:y===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof d=="string"?P.input=e.binstring2buf(d):h.call(d)==="[object ArrayBuffer]"?P.input=new Uint8Array(d):P.input=d,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new t.Buf8(D),P.next_out=0,P.avail_out=D),(m=n.inflate(P,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&z&&(R=typeof z=="string"?e.string2buf(z):h.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,m=n.inflateSetDictionary(this.strm,R)),m===a.Z_BUF_ERROR&&F===!0&&(m=a.Z_OK,F=!1),m!==a.Z_STREAM_END&&m!==a.Z_OK)return this.onEnd(m),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&m!==a.Z_STREAM_END&&(P.avail_in!==0||x!==a.Z_FINISH&&x!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=e.utf8border(P.output,P.next_out),j=P.next_out-C,A=e.buf2string(P.output,C),P.next_out=j,P.avail_out=D-j,j&&t.arraySet(P.output,P.output,C,j,0),this.onData(A)):this.onData(t.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(F=!0)}while((0<P.avail_in||P.avail_out===0)&&m!==a.Z_STREAM_END);return m===a.Z_STREAM_END&&(x=a.Z_FINISH),x===a.Z_FINISH?(m=n.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===a.Z_OK):x!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(P.avail_out=0))},c.prototype.onData=function(d){this.chunks.push(d)},c.prototype.onEnd=function(d){d===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},s.Inflate=c,s.inflate=_,s.inflateRaw=function(d,y){return(y=y||{}).raw=!0,_(d,y)},s.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,o,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(a){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var v=u.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var g in v)v.hasOwnProperty(g)&&(a[g]=v[g])}}return a},s.shrinkBuf=function(a,u){return a.length===u?a:a.subarray?a.subarray(0,u):(a.length=u,a)};var t={arraySet:function(a,u,v,g,h){if(u.subarray&&a.subarray)a.set(u.subarray(v,v+g),h);else for(var c=0;c<g;c++)a[h+c]=u[v+c]},flattenChunks:function(a){var u,v,g,h,c,_;for(u=g=0,v=a.length;u<v;u++)g+=a[u].length;for(_=new Uint8Array(g),u=h=0,v=a.length;u<v;u++)c=a[u],_.set(c,h),h+=c.length;return _}},e={arraySet:function(a,u,v,g,h){for(var c=0;c<g;c++)a[h+c]=u[v+c]},flattenChunks:function(a){return[].concat.apply([],a)}};s.setTyped=function(a){a?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,t)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,e))},s.setTyped(n)},{}],42:[function(r,o,s){var n=r("./common"),t=!0,e=!0;try{String.fromCharCode.apply(null,[0])}catch(g){t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(g){e=!1}for(var a=new n.Buf8(256),u=0;u<256;u++)a[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function v(g,h){if(h<65537&&(g.subarray&&e||!g.subarray&&t))return String.fromCharCode.apply(null,n.shrinkBuf(g,h));for(var c="",_=0;_<h;_++)c+=String.fromCharCode(g[_]);return c}a[254]=a[254]=1,s.string2buf=function(g){var h,c,_,d,y,m=g.length,x=0;for(d=0;d<m;d++)(64512&(c=g.charCodeAt(d)))==55296&&d+1<m&&(64512&(_=g.charCodeAt(d+1)))==56320&&(c=65536+(c-55296<<10)+(_-56320),d++),x+=c<128?1:c<2048?2:c<65536?3:4;for(h=new n.Buf8(x),d=y=0;y<x;d++)(64512&(c=g.charCodeAt(d)))==55296&&d+1<m&&(64512&(_=g.charCodeAt(d+1)))==56320&&(c=65536+(c-55296<<10)+(_-56320),d++),c<128?h[y++]=c:(c<2048?h[y++]=192|c>>>6:(c<65536?h[y++]=224|c>>>12:(h[y++]=240|c>>>18,h[y++]=128|c>>>12&63),h[y++]=128|c>>>6&63),h[y++]=128|63&c);return h},s.buf2binstring=function(g){return v(g,g.length)},s.binstring2buf=function(g){for(var h=new n.Buf8(g.length),c=0,_=h.length;c<_;c++)h[c]=g.charCodeAt(c);return h},s.buf2string=function(g,h){var c,_,d,y,m=h||g.length,x=new Array(2*m);for(c=_=0;c<m;)if((d=g[c++])<128)x[_++]=d;else if(4<(y=a[d]))x[_++]=65533,c+=y-1;else{for(d&=y===2?31:y===3?15:7;1<y&&c<m;)d=d<<6|63&g[c++],y--;1<y?x[_++]=65533:d<65536?x[_++]=d:(d-=65536,x[_++]=55296|d>>10&1023,x[_++]=56320|1023&d)}return v(x,_)},s.utf8border=function(g,h){var c;for((h=h||g.length)>g.length&&(h=g.length),c=h-1;0<=c&&(192&g[c])==128;)c--;return c<0||c===0?h:c+a[g[c]]>h?c:h}},{"./common":41}],43:[function(r,o,s){o.exports=function(n,t,e,a){for(var u=65535&n|0,v=n>>>16&65535|0,g=0;e!==0;){for(e-=g=2e3<e?2e3:e;v=v+(u=u+t[a++]|0)|0,--g;);u%=65521,v%=65521}return u|v<<16|0}},{}],44:[function(r,o,s){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,o,s){var n=function(){for(var t,e=[],a=0;a<256;a++){t=a;for(var u=0;u<8;u++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}();o.exports=function(t,e,a,u){var v=n,g=u+a;t^=-1;for(var h=u;h<g;h++)t=t>>>8^v[255&(t^e[h])];return-1^t}},{}],46:[function(r,o,s){var n,t=r("../utils/common"),e=r("./trees"),a=r("./adler32"),u=r("./crc32"),v=r("./messages"),g=0,h=4,c=0,_=-2,d=-1,y=4,m=2,x=8,C=9,j=286,A=30,R=19,P=2*j+1,D=15,z=3,F=258,$=F+z+1,k=42,M=113,l=1,N=2,ne=3,Z=4;function ie(i,L){return i.msg=v[L],L}function H(i){return(i<<1)-(4<i?9:0)}function re(i){for(var L=i.length;0<=--L;)i[L]=0}function I(i){var L=i.state,B=L.pending;B>i.avail_out&&(B=i.avail_out),B!==0&&(t.arraySet(i.output,L.pending_buf,L.pending_out,B,i.next_out),i.next_out+=B,L.pending_out+=B,i.total_out+=B,i.avail_out-=B,L.pending-=B,L.pending===0&&(L.pending_out=0))}function T(i,L){e._tr_flush_block(i,0<=i.block_start?i.block_start:-1,i.strstart-i.block_start,L),i.block_start=i.strstart,I(i.strm)}function te(i,L){i.pending_buf[i.pending++]=L}function K(i,L){i.pending_buf[i.pending++]=L>>>8&255,i.pending_buf[i.pending++]=255&L}function Y(i,L){var B,w,S=i.max_chain_length,E=i.strstart,U=i.prev_length,W=i.nice_match,O=i.strstart>i.w_size-$?i.strstart-(i.w_size-$):0,G=i.window,X=i.w_mask,V=i.prev,ee=i.strstart+F,de=G[E+U-1],ae=G[E+U];i.prev_length>=i.good_match&&(S>>=2),W>i.lookahead&&(W=i.lookahead);do if(G[(B=L)+U]===ae&&G[B+U-1]===de&&G[B]===G[E]&&G[++B]===G[E+1]){E+=2,B++;do;while(G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&G[++E]===G[++B]&&E<ee);if(w=F-(ee-E),E=ee-F,U<w){if(i.match_start=L,W<=(U=w))break;de=G[E+U-1],ae=G[E+U]}}while((L=V[L&X])>O&&--S!=0);return U<=i.lookahead?U:i.lookahead}function ue(i){var L,B,w,S,E,U,W,O,G,X,V=i.w_size;do{if(S=i.window_size-i.lookahead-i.strstart,i.strstart>=V+(V-$)){for(t.arraySet(i.window,i.window,V,V,0),i.match_start-=V,i.strstart-=V,i.block_start-=V,L=B=i.hash_size;w=i.head[--L],i.head[L]=V<=w?w-V:0,--B;);for(L=B=V;w=i.prev[--L],i.prev[L]=V<=w?w-V:0,--B;);S+=V}if(i.strm.avail_in===0)break;if(U=i.strm,W=i.window,O=i.strstart+i.lookahead,G=S,X=void 0,X=U.avail_in,G<X&&(X=G),B=X===0?0:(U.avail_in-=X,t.arraySet(W,U.input,U.next_in,X,O),U.state.wrap===1?U.adler=a(U.adler,W,X,O):U.state.wrap===2&&(U.adler=u(U.adler,W,X,O)),U.next_in+=X,U.total_in+=X,X),i.lookahead+=B,i.lookahead+i.insert>=z)for(E=i.strstart-i.insert,i.ins_h=i.window[E],i.ins_h=(i.ins_h<<i.hash_shift^i.window[E+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[E+z-1])&i.hash_mask,i.prev[E&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=E,E++,i.insert--,!(i.lookahead+i.insert<z)););}while(i.lookahead<$&&i.strm.avail_in!==0)}function be(i,L){for(var B,w;;){if(i.lookahead<$){if(ue(i),i.lookahead<$&&L===g)return l;if(i.lookahead===0)break}if(B=0,i.lookahead>=z&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),B!==0&&i.strstart-B<=i.w_size-$&&(i.match_length=Y(i,B)),i.match_length>=z)if(w=e._tr_tally(i,i.strstart-i.match_start,i.match_length-z),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=z){for(i.match_length--;i.strstart++,i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart,--i.match_length!=0;);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+1])&i.hash_mask;else w=e._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(w&&(T(i,!1),i.strm.avail_out===0))return l}return i.insert=i.strstart<z-1?i.strstart:z-1,L===h?(T(i,!0),i.strm.avail_out===0?ne:Z):i.last_lit&&(T(i,!1),i.strm.avail_out===0)?l:N}function se(i,L){for(var B,w,S;;){if(i.lookahead<$){if(ue(i),i.lookahead<$&&L===g)return l;if(i.lookahead===0)break}if(B=0,i.lookahead>=z&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=z-1,B!==0&&i.prev_length<i.max_lazy_match&&i.strstart-B<=i.w_size-$&&(i.match_length=Y(i,B),i.match_length<=5&&(i.strategy===1||i.match_length===z&&4096<i.strstart-i.match_start)&&(i.match_length=z-1)),i.prev_length>=z&&i.match_length<=i.prev_length){for(S=i.strstart+i.lookahead-z,w=e._tr_tally(i,i.strstart-1-i.prev_match,i.prev_length-z),i.lookahead-=i.prev_length-1,i.prev_length-=2;++i.strstart<=S&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+z-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),--i.prev_length!=0;);if(i.match_available=0,i.match_length=z-1,i.strstart++,w&&(T(i,!1),i.strm.avail_out===0))return l}else if(i.match_available){if((w=e._tr_tally(i,0,i.window[i.strstart-1]))&&T(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return l}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(w=e._tr_tally(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<z-1?i.strstart:z-1,L===h?(T(i,!0),i.strm.avail_out===0?ne:Z):i.last_lit&&(T(i,!1),i.strm.avail_out===0)?l:N}function oe(i,L,B,w,S){this.good_length=i,this.max_lazy=L,this.nice_length=B,this.max_chain=w,this.func=S}function ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*P),this.dyn_dtree=new t.Buf16(2*(2*A+1)),this.bl_tree=new t.Buf16(2*(2*R+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(D+1),this.heap=new t.Buf16(2*j+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*j+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fe(i){var L;return i&&i.state?(i.total_in=i.total_out=0,i.data_type=m,(L=i.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?k:M,i.adler=L.wrap===2?0:1,L.last_flush=g,e._tr_init(L),c):ie(i,_)}function Ce(i){var L=fe(i);return L===c&&function(B){B.window_size=2*B.w_size,re(B.head),B.max_lazy_match=n[B.level].max_lazy,B.good_match=n[B.level].good_length,B.nice_match=n[B.level].nice_length,B.max_chain_length=n[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=z-1,B.match_available=0,B.ins_h=0}(i.state),L}function ke(i,L,B,w,S,E){if(!i)return _;var U=1;if(L===d&&(L=6),w<0?(U=0,w=-w):15<w&&(U=2,w-=16),S<1||C<S||B!==x||w<8||15<w||L<0||9<L||E<0||y<E)return ie(i,_);w===8&&(w=9);var W=new ge;return(i.state=W).strm=i,W.wrap=U,W.gzhead=null,W.w_bits=w,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+z-1)/z),W.window=new t.Buf8(2*W.w_size),W.head=new t.Buf16(W.hash_size),W.prev=new t.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new t.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=L,W.strategy=E,W.method=B,Ce(i)}n=[new oe(0,0,0,0,function(i,L){var B=65535;for(B>i.pending_buf_size-5&&(B=i.pending_buf_size-5);;){if(i.lookahead<=1){if(ue(i),i.lookahead===0&&L===g)return l;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;var w=i.block_start+B;if((i.strstart===0||i.strstart>=w)&&(i.lookahead=i.strstart-w,i.strstart=w,T(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-$&&(T(i,!1),i.strm.avail_out===0))return l}return i.insert=0,L===h?(T(i,!0),i.strm.avail_out===0?ne:Z):(i.strstart>i.block_start&&(T(i,!1),i.strm.avail_out),l)}),new oe(4,4,8,4,be),new oe(4,5,16,8,be),new oe(4,6,32,32,be),new oe(4,4,16,16,se),new oe(8,16,32,32,se),new oe(8,16,128,128,se),new oe(8,32,128,256,se),new oe(32,128,258,1024,se),new oe(32,258,258,4096,se)],s.deflateInit=function(i,L){return ke(i,L,x,15,8,0)},s.deflateInit2=ke,s.deflateReset=Ce,s.deflateResetKeep=fe,s.deflateSetHeader=function(i,L){return i&&i.state?i.state.wrap!==2?_:(i.state.gzhead=L,c):_},s.deflate=function(i,L){var B,w,S,E;if(!i||!i.state||5<L||L<0)return i?ie(i,_):_;if(w=i.state,!i.output||!i.input&&i.avail_in!==0||w.status===666&&L!==h)return ie(i,i.avail_out===0?-5:_);if(w.strm=i,B=w.last_flush,w.last_flush=L,w.status===k)if(w.wrap===2)i.adler=0,te(w,31),te(w,139),te(w,8),w.gzhead?(te(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),te(w,255&w.gzhead.time),te(w,w.gzhead.time>>8&255),te(w,w.gzhead.time>>16&255),te(w,w.gzhead.time>>24&255),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(te(w,255&w.gzhead.extra.length),te(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(i.adler=u(i.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(te(w,0),te(w,0),te(w,0),te(w,0),te(w,0),te(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),te(w,3),w.status=M);else{var U=x+(w.w_bits-8<<4)<<8;U|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(U|=32),U+=31-U%31,w.status=M,K(w,U),w.strstart!==0&&(K(w,i.adler>>>16),K(w,65535&i.adler)),i.adler=1}if(w.status===69)if(w.gzhead.extra){for(S=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>S&&(i.adler=u(i.adler,w.pending_buf,w.pending-S,S)),I(i),S=w.pending,w.pending!==w.pending_buf_size));)te(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>S&&(i.adler=u(i.adler,w.pending_buf,w.pending-S,S)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(i.adler=u(i.adler,w.pending_buf,w.pending-S,S)),I(i),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(i.adler=u(i.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){S=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>S&&(i.adler=u(i.adler,w.pending_buf,w.pending-S,S)),I(i),S=w.pending,w.pending===w.pending_buf_size)){E=1;break}E=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,te(w,E)}while(E!==0);w.gzhead.hcrc&&w.pending>S&&(i.adler=u(i.adler,w.pending_buf,w.pending-S,S)),E===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&I(i),w.pending+2<=w.pending_buf_size&&(te(w,255&i.adler),te(w,i.adler>>8&255),i.adler=0,w.status=M)):w.status=M),w.pending!==0){if(I(i),i.avail_out===0)return w.last_flush=-1,c}else if(i.avail_in===0&&H(L)<=H(B)&&L!==h)return ie(i,-5);if(w.status===666&&i.avail_in!==0)return ie(i,-5);if(i.avail_in!==0||w.lookahead!==0||L!==g&&w.status!==666){var W=w.strategy===2?function(O,G){for(var X;;){if(O.lookahead===0&&(ue(O),O.lookahead===0)){if(G===g)return l;break}if(O.match_length=0,X=e._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,X&&(T(O,!1),O.strm.avail_out===0))return l}return O.insert=0,G===h?(T(O,!0),O.strm.avail_out===0?ne:Z):O.last_lit&&(T(O,!1),O.strm.avail_out===0)?l:N}(w,L):w.strategy===3?function(O,G){for(var X,V,ee,de,ae=O.window;;){if(O.lookahead<=F){if(ue(O),O.lookahead<=F&&G===g)return l;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=z&&0<O.strstart&&(V=ae[ee=O.strstart-1])===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]){de=O.strstart+F;do;while(V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&V===ae[++ee]&&ee<de);O.match_length=F-(de-ee),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=z?(X=e._tr_tally(O,1,O.match_length-z),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(X=e._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),X&&(T(O,!1),O.strm.avail_out===0))return l}return O.insert=0,G===h?(T(O,!0),O.strm.avail_out===0?ne:Z):O.last_lit&&(T(O,!1),O.strm.avail_out===0)?l:N}(w,L):n[w.level].func(w,L);if(W!==ne&&W!==Z||(w.status=666),W===l||W===ne)return i.avail_out===0&&(w.last_flush=-1),c;if(W===N&&(L===1?e._tr_align(w):L!==5&&(e._tr_stored_block(w,0,0,!1),L===3&&(re(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),I(i),i.avail_out===0))return w.last_flush=-1,c}return L!==h?c:w.wrap<=0?1:(w.wrap===2?(te(w,255&i.adler),te(w,i.adler>>8&255),te(w,i.adler>>16&255),te(w,i.adler>>24&255),te(w,255&i.total_in),te(w,i.total_in>>8&255),te(w,i.total_in>>16&255),te(w,i.total_in>>24&255)):(K(w,i.adler>>>16),K(w,65535&i.adler)),I(i),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?c:1)},s.deflateEnd=function(i){var L;return i&&i.state?(L=i.state.status)!==k&&L!==69&&L!==73&&L!==91&&L!==103&&L!==M&&L!==666?ie(i,_):(i.state=null,L===M?ie(i,-3):c):_},s.deflateSetDictionary=function(i,L){var B,w,S,E,U,W,O,G,X=L.length;if(!i||!i.state||(E=(B=i.state).wrap)===2||E===1&&B.status!==k||B.lookahead)return _;for(E===1&&(i.adler=a(i.adler,L,X,0)),B.wrap=0,X>=B.w_size&&(E===0&&(re(B.head),B.strstart=0,B.block_start=0,B.insert=0),G=new t.Buf8(B.w_size),t.arraySet(G,L,X-B.w_size,B.w_size,0),L=G,X=B.w_size),U=i.avail_in,W=i.next_in,O=i.input,i.avail_in=X,i.next_in=0,i.input=L,ue(B);B.lookahead>=z;){for(w=B.strstart,S=B.lookahead-(z-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[w+z-1])&B.hash_mask,B.prev[w&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=w,w++,--S;);B.strstart=w,B.lookahead=z-1,ue(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=z-1,B.match_available=0,i.next_in=W,i.input=O,i.avail_in=U,B.wrap=E,c},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,o,s){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,o,s){o.exports=function(n,t){var e,a,u,v,g,h,c,_,d,y,m,x,C,j,A,R,P,D,z,F,$,k,M,l,N;e=n.state,a=n.next_in,l=n.input,u=a+(n.avail_in-5),v=n.next_out,N=n.output,g=v-(t-n.avail_out),h=v+(n.avail_out-257),c=e.dmax,_=e.wsize,d=e.whave,y=e.wnext,m=e.window,x=e.hold,C=e.bits,j=e.lencode,A=e.distcode,R=(1<<e.lenbits)-1,P=(1<<e.distbits)-1;e:do{C<15&&(x+=l[a++]<<C,C+=8,x+=l[a++]<<C,C+=8),D=j[x&R];t:for(;;){if(x>>>=z=D>>>24,C-=z,(z=D>>>16&255)===0)N[v++]=65535&D;else{if(!(16&z)){if(!(64&z)){D=j[(65535&D)+(x&(1<<z)-1)];continue t}if(32&z){e.mode=12;break e}n.msg="invalid literal/length code",e.mode=30;break e}F=65535&D,(z&=15)&&(C<z&&(x+=l[a++]<<C,C+=8),F+=x&(1<<z)-1,x>>>=z,C-=z),C<15&&(x+=l[a++]<<C,C+=8,x+=l[a++]<<C,C+=8),D=A[x&P];n:for(;;){if(x>>>=z=D>>>24,C-=z,!(16&(z=D>>>16&255))){if(!(64&z)){D=A[(65535&D)+(x&(1<<z)-1)];continue n}n.msg="invalid distance code",e.mode=30;break e}if($=65535&D,C<(z&=15)&&(x+=l[a++]<<C,(C+=8)<z&&(x+=l[a++]<<C,C+=8)),c<($+=x&(1<<z)-1)){n.msg="invalid distance too far back",e.mode=30;break e}if(x>>>=z,C-=z,(z=v-g)<$){if(d<(z=$-z)&&e.sane){n.msg="invalid distance too far back",e.mode=30;break e}if(M=m,(k=0)===y){if(k+=_-z,z<F){for(F-=z;N[v++]=m[k++],--z;);k=v-$,M=N}}else if(y<z){if(k+=_+y-z,(z-=y)<F){for(F-=z;N[v++]=m[k++],--z;);if(k=0,y<F){for(F-=z=y;N[v++]=m[k++],--z;);k=v-$,M=N}}}else if(k+=y-z,z<F){for(F-=z;N[v++]=m[k++],--z;);k=v-$,M=N}for(;2<F;)N[v++]=M[k++],N[v++]=M[k++],N[v++]=M[k++],F-=3;F&&(N[v++]=M[k++],1<F&&(N[v++]=M[k++]))}else{for(k=v-$;N[v++]=N[k++],N[v++]=N[k++],N[v++]=N[k++],2<(F-=3););F&&(N[v++]=N[k++],1<F&&(N[v++]=N[k++]))}break}}break}}while(a<u&&v<h);a-=F=C>>3,x&=(1<<(C-=F<<3))-1,n.next_in=a,n.next_out=v,n.avail_in=a<u?u-a+5:5-(a-u),n.avail_out=v<h?h-v+257:257-(v-h),e.hold=x,e.bits=C}},{}],49:[function(r,o,s){var n=r("../utils/common"),t=r("./adler32"),e=r("./crc32"),a=r("./inffast"),u=r("./inftrees"),v=1,g=2,h=0,c=-2,_=1,d=852,y=592;function m(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(k){var M;return k&&k.state?(M=k.state,k.total_in=k.total_out=M.total=0,k.msg="",M.wrap&&(k.adler=1&M.wrap),M.mode=_,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new n.Buf32(d),M.distcode=M.distdyn=new n.Buf32(y),M.sane=1,M.back=-1,h):c}function j(k){var M;return k&&k.state?((M=k.state).wsize=0,M.whave=0,M.wnext=0,C(k)):c}function A(k,M){var l,N;return k&&k.state?(N=k.state,M<0?(l=0,M=-M):(l=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?c:(N.window!==null&&N.wbits!==M&&(N.window=null),N.wrap=l,N.wbits=M,j(k))):c}function R(k,M){var l,N;return k?(N=new x,(k.state=N).window=null,(l=A(k,M))!==h&&(k.state=null),l):c}var P,D,z=!0;function F(k){if(z){var M;for(P=new n.Buf32(512),D=new n.Buf32(32),M=0;M<144;)k.lens[M++]=8;for(;M<256;)k.lens[M++]=9;for(;M<280;)k.lens[M++]=7;for(;M<288;)k.lens[M++]=8;for(u(v,k.lens,0,288,P,0,k.work,{bits:9}),M=0;M<32;)k.lens[M++]=5;u(g,k.lens,0,32,D,0,k.work,{bits:5}),z=!1}k.lencode=P,k.lenbits=9,k.distcode=D,k.distbits=5}function $(k,M,l,N){var ne,Z=k.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new n.Buf8(Z.wsize)),N>=Z.wsize?(n.arraySet(Z.window,M,l-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(N<(ne=Z.wsize-Z.wnext)&&(ne=N),n.arraySet(Z.window,M,l-N,ne,Z.wnext),(N-=ne)?(n.arraySet(Z.window,M,l-N,N,0),Z.wnext=N,Z.whave=Z.wsize):(Z.wnext+=ne,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=ne))),0}s.inflateReset=j,s.inflateReset2=A,s.inflateResetKeep=C,s.inflateInit=function(k){return R(k,15)},s.inflateInit2=R,s.inflate=function(k,M){var l,N,ne,Z,ie,H,re,I,T,te,K,Y,ue,be,se,oe,ge,fe,Ce,ke,i,L,B,w,S=0,E=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return c;(l=k.state).mode===12&&(l.mode=13),ie=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,N=k.input,H=k.avail_in,I=l.hold,T=l.bits,te=H,K=re,L=h;e:for(;;)switch(l.mode){case _:if(l.wrap===0){l.mode=13;break}for(;T<16;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(2&l.wrap&&I===35615){E[l.check=0]=255&I,E[1]=I>>>8&255,l.check=e(l.check,E,2,0),T=I=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&I)<<8)+(I>>8))%31){k.msg="incorrect header check",l.mode=30;break}if((15&I)!=8){k.msg="unknown compression method",l.mode=30;break}if(T-=4,i=8+(15&(I>>>=4)),l.wbits===0)l.wbits=i;else if(i>l.wbits){k.msg="invalid window size",l.mode=30;break}l.dmax=1<<i,k.adler=l.check=1,l.mode=512&I?10:12,T=I=0;break;case 2:for(;T<16;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(l.flags=I,(255&l.flags)!=8){k.msg="unknown compression method",l.mode=30;break}if(57344&l.flags){k.msg="unknown header flags set",l.mode=30;break}l.head&&(l.head.text=I>>8&1),512&l.flags&&(E[0]=255&I,E[1]=I>>>8&255,l.check=e(l.check,E,2,0)),T=I=0,l.mode=3;case 3:for(;T<32;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}l.head&&(l.head.time=I),512&l.flags&&(E[0]=255&I,E[1]=I>>>8&255,E[2]=I>>>16&255,E[3]=I>>>24&255,l.check=e(l.check,E,4,0)),T=I=0,l.mode=4;case 4:for(;T<16;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}l.head&&(l.head.xflags=255&I,l.head.os=I>>8),512&l.flags&&(E[0]=255&I,E[1]=I>>>8&255,l.check=e(l.check,E,2,0)),T=I=0,l.mode=5;case 5:if(1024&l.flags){for(;T<16;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}l.length=I,l.head&&(l.head.extra_len=I),512&l.flags&&(E[0]=255&I,E[1]=I>>>8&255,l.check=e(l.check,E,2,0)),T=I=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(H<(Y=l.length)&&(Y=H),Y&&(l.head&&(i=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Array(l.head.extra_len)),n.arraySet(l.head.extra,N,Z,Y,i)),512&l.flags&&(l.check=e(l.check,N,Y,Z)),H-=Y,Z+=Y,l.length-=Y),l.length))break e;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(H===0)break e;for(Y=0;i=N[Z+Y++],l.head&&i&&l.length<65536&&(l.head.name+=String.fromCharCode(i)),i&&Y<H;);if(512&l.flags&&(l.check=e(l.check,N,Y,Z)),H-=Y,Z+=Y,i)break e}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(H===0)break e;for(Y=0;i=N[Z+Y++],l.head&&i&&l.length<65536&&(l.head.comment+=String.fromCharCode(i)),i&&Y<H;);if(512&l.flags&&(l.check=e(l.check,N,Y,Z)),H-=Y,Z+=Y,i)break e}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;T<16;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(I!==(65535&l.check)){k.msg="header crc mismatch",l.mode=30;break}T=I=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),k.adler=l.check=0,l.mode=12;break;case 10:for(;T<32;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}k.adler=l.check=m(I),T=I=0,l.mode=11;case 11:if(l.havedict===0)return k.next_out=ie,k.avail_out=re,k.next_in=Z,k.avail_in=H,l.hold=I,l.bits=T,2;k.adler=l.check=1,l.mode=12;case 12:if(M===5||M===6)break e;case 13:if(l.last){I>>>=7&T,T-=7&T,l.mode=27;break}for(;T<3;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}switch(l.last=1&I,T-=1,3&(I>>>=1)){case 0:l.mode=14;break;case 1:if(F(l),l.mode=20,M!==6)break;I>>>=2,T-=2;break e;case 2:l.mode=17;break;case 3:k.msg="invalid block type",l.mode=30}I>>>=2,T-=2;break;case 14:for(I>>>=7&T,T-=7&T;T<32;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if((65535&I)!=(I>>>16^65535)){k.msg="invalid stored block lengths",l.mode=30;break}if(l.length=65535&I,T=I=0,l.mode=15,M===6)break e;case 15:l.mode=16;case 16:if(Y=l.length){if(H<Y&&(Y=H),re<Y&&(Y=re),Y===0)break e;n.arraySet(ne,N,Z,Y,ie),H-=Y,Z+=Y,re-=Y,ie+=Y,l.length-=Y;break}l.mode=12;break;case 17:for(;T<14;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(l.nlen=257+(31&I),I>>>=5,T-=5,l.ndist=1+(31&I),I>>>=5,T-=5,l.ncode=4+(15&I),I>>>=4,T-=4,286<l.nlen||30<l.ndist){k.msg="too many length or distance symbols",l.mode=30;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;T<3;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}l.lens[U[l.have++]]=7&I,I>>>=3,T-=3}for(;l.have<19;)l.lens[U[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,B={bits:l.lenbits},L=u(0,l.lens,0,19,l.lencode,0,l.work,B),l.lenbits=B.bits,L){k.msg="invalid code lengths set",l.mode=30;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;oe=(S=l.lencode[I&(1<<l.lenbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=T);){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(ge<16)I>>>=se,T-=se,l.lens[l.have++]=ge;else{if(ge===16){for(w=se+2;T<w;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(I>>>=se,T-=se,l.have===0){k.msg="invalid bit length repeat",l.mode=30;break}i=l.lens[l.have-1],Y=3+(3&I),I>>>=2,T-=2}else if(ge===17){for(w=se+3;T<w;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}T-=se,i=0,Y=3+(7&(I>>>=se)),I>>>=3,T-=3}else{for(w=se+7;T<w;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}T-=se,i=0,Y=11+(127&(I>>>=se)),I>>>=7,T-=7}if(l.have+Y>l.nlen+l.ndist){k.msg="invalid bit length repeat",l.mode=30;break}for(;Y--;)l.lens[l.have++]=i}}if(l.mode===30)break;if(l.lens[256]===0){k.msg="invalid code -- missing end-of-block",l.mode=30;break}if(l.lenbits=9,B={bits:l.lenbits},L=u(v,l.lens,0,l.nlen,l.lencode,0,l.work,B),l.lenbits=B.bits,L){k.msg="invalid literal/lengths set",l.mode=30;break}if(l.distbits=6,l.distcode=l.distdyn,B={bits:l.distbits},L=u(g,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,B),l.distbits=B.bits,L){k.msg="invalid distances set",l.mode=30;break}if(l.mode=20,M===6)break e;case 20:l.mode=21;case 21:if(6<=H&&258<=re){k.next_out=ie,k.avail_out=re,k.next_in=Z,k.avail_in=H,l.hold=I,l.bits=T,a(k,K),ie=k.next_out,ne=k.output,re=k.avail_out,Z=k.next_in,N=k.input,H=k.avail_in,I=l.hold,T=l.bits,l.mode===12&&(l.back=-1);break}for(l.back=0;oe=(S=l.lencode[I&(1<<l.lenbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=T);){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(oe&&!(240&oe)){for(fe=se,Ce=oe,ke=ge;oe=(S=l.lencode[ke+((I&(1<<fe+Ce)-1)>>fe)])>>>16&255,ge=65535&S,!(fe+(se=S>>>24)<=T);){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}I>>>=fe,T-=fe,l.back+=fe}if(I>>>=se,T-=se,l.back+=se,l.length=ge,oe===0){l.mode=26;break}if(32&oe){l.back=-1,l.mode=12;break}if(64&oe){k.msg="invalid literal/length code",l.mode=30;break}l.extra=15&oe,l.mode=22;case 22:if(l.extra){for(w=l.extra;T<w;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}l.length+=I&(1<<l.extra)-1,I>>>=l.extra,T-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;oe=(S=l.distcode[I&(1<<l.distbits)-1])>>>16&255,ge=65535&S,!((se=S>>>24)<=T);){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(!(240&oe)){for(fe=se,Ce=oe,ke=ge;oe=(S=l.distcode[ke+((I&(1<<fe+Ce)-1)>>fe)])>>>16&255,ge=65535&S,!(fe+(se=S>>>24)<=T);){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}I>>>=fe,T-=fe,l.back+=fe}if(I>>>=se,T-=se,l.back+=se,64&oe){k.msg="invalid distance code",l.mode=30;break}l.offset=ge,l.extra=15&oe,l.mode=24;case 24:if(l.extra){for(w=l.extra;T<w;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}l.offset+=I&(1<<l.extra)-1,I>>>=l.extra,T-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){k.msg="invalid distance too far back",l.mode=30;break}l.mode=25;case 25:if(re===0)break e;if(Y=K-re,l.offset>Y){if((Y=l.offset-Y)>l.whave&&l.sane){k.msg="invalid distance too far back",l.mode=30;break}ue=Y>l.wnext?(Y-=l.wnext,l.wsize-Y):l.wnext-Y,Y>l.length&&(Y=l.length),be=l.window}else be=ne,ue=ie-l.offset,Y=l.length;for(re<Y&&(Y=re),re-=Y,l.length-=Y;ne[ie++]=be[ue++],--Y;);l.length===0&&(l.mode=21);break;case 26:if(re===0)break e;ne[ie++]=l.length,re--,l.mode=21;break;case 27:if(l.wrap){for(;T<32;){if(H===0)break e;H--,I|=N[Z++]<<T,T+=8}if(K-=re,k.total_out+=K,l.total+=K,K&&(k.adler=l.check=l.flags?e(l.check,ne,K,ie-K):t(l.check,ne,K,ie-K)),K=re,(l.flags?I:m(I))!==l.check){k.msg="incorrect data check",l.mode=30;break}T=I=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;T<32;){if(H===0)break e;H--,I+=N[Z++]<<T,T+=8}if(I!==(4294967295&l.total)){k.msg="incorrect length check",l.mode=30;break}T=I=0}l.mode=29;case 29:L=1;break e;case 30:L=-3;break e;case 31:return-4;case 32:default:return c}return k.next_out=ie,k.avail_out=re,k.next_in=Z,k.avail_in=H,l.hold=I,l.bits=T,(l.wsize||K!==k.avail_out&&l.mode<30&&(l.mode<27||M!==4))&&$(k,k.output,k.next_out,K-k.avail_out)?(l.mode=31,-4):(te-=k.avail_in,K-=k.avail_out,k.total_in+=te,k.total_out+=K,l.total+=K,l.wrap&&K&&(k.adler=l.check=l.flags?e(l.check,ne,K,k.next_out-K):t(l.check,ne,K,k.next_out-K)),k.data_type=l.bits+(l.last?64:0)+(l.mode===12?128:0)+(l.mode===20||l.mode===15?256:0),(te==0&&K===0||M===4)&&L===h&&(L=-5),L)},s.inflateEnd=function(k){if(!k||!k.state)return c;var M=k.state;return M.window&&(M.window=null),k.state=null,h},s.inflateGetHeader=function(k,M){var l;return k&&k.state&&2&(l=k.state).wrap?((l.head=M).done=!1,h):c},s.inflateSetDictionary=function(k,M){var l,N=M.length;return k&&k.state?(l=k.state).wrap!==0&&l.mode!==11?c:l.mode===11&&t(1,M,N,0)!==l.check?-3:$(k,M,N,N)?(l.mode=31,-4):(l.havedict=1,h):c},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,o,s){var n=r("../utils/common"),t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],e=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(v,g,h,c,_,d,y,m){var x,C,j,A,R,P,D,z,F,$=m.bits,k=0,M=0,l=0,N=0,ne=0,Z=0,ie=0,H=0,re=0,I=0,T=null,te=0,K=new n.Buf16(16),Y=new n.Buf16(16),ue=null,be=0;for(k=0;k<=15;k++)K[k]=0;for(M=0;M<c;M++)K[g[h+M]]++;for(ne=$,N=15;1<=N&&K[N]===0;N--);if(N<ne&&(ne=N),N===0)return _[d++]=20971520,_[d++]=20971520,m.bits=1,0;for(l=1;l<N&&K[l]===0;l++);for(ne<l&&(ne=l),k=H=1;k<=15;k++)if(H<<=1,(H-=K[k])<0)return-1;if(0<H&&(v===0||N!==1))return-1;for(Y[1]=0,k=1;k<15;k++)Y[k+1]=Y[k]+K[k];for(M=0;M<c;M++)g[h+M]!==0&&(y[Y[g[h+M]]++]=M);if(P=v===0?(T=ue=y,19):v===1?(T=t,te-=257,ue=e,be-=257,256):(T=a,ue=u,-1),k=l,R=d,ie=M=I=0,j=-1,A=(re=1<<(Z=ne))-1,v===1&&852<re||v===2&&592<re)return 1;for(;;){for(D=k-ie,F=y[M]<P?(z=0,y[M]):y[M]>P?(z=ue[be+y[M]],T[te+y[M]]):(z=96,0),x=1<<k-ie,l=C=1<<Z;_[R+(I>>ie)+(C-=x)]=D<<24|z<<16|F|0,C!==0;);for(x=1<<k-1;I&x;)x>>=1;if(x!==0?(I&=x-1,I+=x):I=0,M++,--K[k]==0){if(k===N)break;k=g[h+y[M]]}if(ne<k&&(I&A)!==j){for(ie===0&&(ie=ne),R+=l,H=1<<(Z=k-ie);Z+ie<N&&!((H-=K[Z+ie])<=0);)Z++,H<<=1;if(re+=1<<Z,v===1&&852<re||v===2&&592<re)return 1;_[j=I&A]=ne<<24|Z<<16|R-d|0}}return I!==0&&(_[R+I]=k-ie<<24|64<<16|0),m.bits=ne,0}},{"../utils/common":41}],51:[function(r,o,s){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,o,s){var n=r("../utils/common"),t=0,e=1;function a(S){for(var E=S.length;0<=--E;)S[E]=0}var u=0,v=29,g=256,h=g+1+v,c=30,_=19,d=2*h+1,y=15,m=16,x=7,C=256,j=16,A=17,R=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(h+2));a($);var k=new Array(2*c);a(k);var M=new Array(512);a(M);var l=new Array(256);a(l);var N=new Array(v);a(N);var ne,Z,ie,H=new Array(c);function re(S,E,U,W,O){this.static_tree=S,this.extra_bits=E,this.extra_base=U,this.elems=W,this.max_length=O,this.has_stree=S&&S.length}function I(S,E){this.dyn_tree=S,this.max_code=0,this.stat_desc=E}function T(S){return S<256?M[S]:M[256+(S>>>7)]}function te(S,E){S.pending_buf[S.pending++]=255&E,S.pending_buf[S.pending++]=E>>>8&255}function K(S,E,U){S.bi_valid>m-U?(S.bi_buf|=E<<S.bi_valid&65535,te(S,S.bi_buf),S.bi_buf=E>>m-S.bi_valid,S.bi_valid+=U-m):(S.bi_buf|=E<<S.bi_valid&65535,S.bi_valid+=U)}function Y(S,E,U){K(S,U[2*E],U[2*E+1])}function ue(S,E){for(var U=0;U|=1&S,S>>>=1,U<<=1,0<--E;);return U>>>1}function be(S,E,U){var W,O,G=new Array(y+1),X=0;for(W=1;W<=y;W++)G[W]=X=X+U[W-1]<<1;for(O=0;O<=E;O++){var V=S[2*O+1];V!==0&&(S[2*O]=ue(G[V]++,V))}}function se(S){var E;for(E=0;E<h;E++)S.dyn_ltree[2*E]=0;for(E=0;E<c;E++)S.dyn_dtree[2*E]=0;for(E=0;E<_;E++)S.bl_tree[2*E]=0;S.dyn_ltree[2*C]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function oe(S){8<S.bi_valid?te(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ge(S,E,U,W){var O=2*E,G=2*U;return S[O]<S[G]||S[O]===S[G]&&W[E]<=W[U]}function fe(S,E,U){for(var W=S.heap[U],O=U<<1;O<=S.heap_len&&(O<S.heap_len&&ge(E,S.heap[O+1],S.heap[O],S.depth)&&O++,!ge(E,W,S.heap[O],S.depth));)S.heap[U]=S.heap[O],U=O,O<<=1;S.heap[U]=W}function Ce(S,E,U){var W,O,G,X,V=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*V]<<8|S.pending_buf[S.d_buf+2*V+1],O=S.pending_buf[S.l_buf+V],V++,W===0?Y(S,O,E):(Y(S,(G=l[O])+g+1,E),(X=P[G])!==0&&K(S,O-=N[G],X),Y(S,G=T(--W),U),(X=D[G])!==0&&K(S,W-=H[G],X)),V<S.last_lit;);Y(S,C,E)}function ke(S,E){var U,W,O,G=E.dyn_tree,X=E.stat_desc.static_tree,V=E.stat_desc.has_stree,ee=E.stat_desc.elems,de=-1;for(S.heap_len=0,S.heap_max=d,U=0;U<ee;U++)G[2*U]!==0?(S.heap[++S.heap_len]=de=U,S.depth[U]=0):G[2*U+1]=0;for(;S.heap_len<2;)G[2*(O=S.heap[++S.heap_len]=de<2?++de:0)]=1,S.depth[O]=0,S.opt_len--,V&&(S.static_len-=X[2*O+1]);for(E.max_code=de,U=S.heap_len>>1;1<=U;U--)fe(S,G,U);for(O=ee;U=S.heap[1],S.heap[1]=S.heap[S.heap_len--],fe(S,G,1),W=S.heap[1],S.heap[--S.heap_max]=U,S.heap[--S.heap_max]=W,G[2*O]=G[2*U]+G[2*W],S.depth[O]=(S.depth[U]>=S.depth[W]?S.depth[U]:S.depth[W])+1,G[2*U+1]=G[2*W+1]=O,S.heap[1]=O++,fe(S,G,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ae,xe){var We,je,Ze,pe,rt,gt,Ae=xe.dyn_tree,Mt=xe.max_code,pn=xe.stat_desc.static_tree,mn=xe.stat_desc.has_stree,gn=xe.stat_desc.extra_bits,Dt=xe.stat_desc.extra_base,He=xe.stat_desc.max_length,it=0;for(pe=0;pe<=y;pe++)ae.bl_count[pe]=0;for(Ae[2*ae.heap[ae.heap_max]+1]=0,We=ae.heap_max+1;We<d;We++)He<(pe=Ae[2*Ae[2*(je=ae.heap[We])+1]+1]+1)&&(pe=He,it++),Ae[2*je+1]=pe,Mt<je||(ae.bl_count[pe]++,rt=0,Dt<=je&&(rt=gn[je-Dt]),gt=Ae[2*je],ae.opt_len+=gt*(pe+rt),mn&&(ae.static_len+=gt*(pn[2*je+1]+rt)));if(it!==0){do{for(pe=He-1;ae.bl_count[pe]===0;)pe--;ae.bl_count[pe]--,ae.bl_count[pe+1]+=2,ae.bl_count[He]--,it-=2}while(0<it);for(pe=He;pe!==0;pe--)for(je=ae.bl_count[pe];je!==0;)Mt<(Ze=ae.heap[--We])||(Ae[2*Ze+1]!==pe&&(ae.opt_len+=(pe-Ae[2*Ze+1])*Ae[2*Ze],Ae[2*Ze+1]=pe),je--)}}(S,E),be(G,de,S.bl_count)}function i(S,E,U){var W,O,G=-1,X=E[1],V=0,ee=7,de=4;for(X===0&&(ee=138,de=3),E[2*(U+1)+1]=65535,W=0;W<=U;W++)O=X,X=E[2*(W+1)+1],++V<ee&&O===X||(V<de?S.bl_tree[2*O]+=V:O!==0?(O!==G&&S.bl_tree[2*O]++,S.bl_tree[2*j]++):V<=10?S.bl_tree[2*A]++:S.bl_tree[2*R]++,G=O,de=(V=0)===X?(ee=138,3):O===X?(ee=6,3):(ee=7,4))}function L(S,E,U){var W,O,G=-1,X=E[1],V=0,ee=7,de=4;for(X===0&&(ee=138,de=3),W=0;W<=U;W++)if(O=X,X=E[2*(W+1)+1],!(++V<ee&&O===X)){if(V<de)for(;Y(S,O,S.bl_tree),--V!=0;);else O!==0?(O!==G&&(Y(S,O,S.bl_tree),V--),Y(S,j,S.bl_tree),K(S,V-3,2)):V<=10?(Y(S,A,S.bl_tree),K(S,V-3,3)):(Y(S,R,S.bl_tree),K(S,V-11,7));G=O,de=(V=0)===X?(ee=138,3):O===X?(ee=6,3):(ee=7,4)}}a(H);var B=!1;function w(S,E,U,W){K(S,(u<<1)+(W?1:0),3),function(O,G,X,V){oe(O),V&&(te(O,X),te(O,~X)),n.arraySet(O.pending_buf,O.window,G,X,O.pending),O.pending+=X}(S,E,U,!0)}s._tr_init=function(S){B||(function(){var E,U,W,O,G,X=new Array(y+1);for(O=W=0;O<v-1;O++)for(N[O]=W,E=0;E<1<<P[O];E++)l[W++]=O;for(l[W-1]=O,O=G=0;O<16;O++)for(H[O]=G,E=0;E<1<<D[O];E++)M[G++]=O;for(G>>=7;O<c;O++)for(H[O]=G<<7,E=0;E<1<<D[O]-7;E++)M[256+G++]=O;for(U=0;U<=y;U++)X[U]=0;for(E=0;E<=143;)$[2*E+1]=8,E++,X[8]++;for(;E<=255;)$[2*E+1]=9,E++,X[9]++;for(;E<=279;)$[2*E+1]=7,E++,X[7]++;for(;E<=287;)$[2*E+1]=8,E++,X[8]++;for(be($,h+1,X),E=0;E<c;E++)k[2*E+1]=5,k[2*E]=ue(E,5);ne=new re($,P,g+1,h,y),Z=new re(k,D,0,c,y),ie=new re(new Array(0),z,0,_,x)}(),B=!0),S.l_desc=new I(S.dyn_ltree,ne),S.d_desc=new I(S.dyn_dtree,Z),S.bl_desc=new I(S.bl_tree,ie),S.bi_buf=0,S.bi_valid=0,se(S)},s._tr_stored_block=w,s._tr_flush_block=function(S,E,U,W){var O,G,X=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(V){var ee,de=4093624447;for(ee=0;ee<=31;ee++,de>>>=1)if(1&de&&V.dyn_ltree[2*ee]!==0)return t;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return e;for(ee=32;ee<g;ee++)if(V.dyn_ltree[2*ee]!==0)return e;return t}(S)),ke(S,S.l_desc),ke(S,S.d_desc),X=function(V){var ee;for(i(V,V.dyn_ltree,V.l_desc.max_code),i(V,V.dyn_dtree,V.d_desc.max_code),ke(V,V.bl_desc),ee=_-1;3<=ee&&V.bl_tree[2*F[ee]+1]===0;ee--);return V.opt_len+=3*(ee+1)+5+5+4,ee}(S),O=S.opt_len+3+7>>>3,(G=S.static_len+3+7>>>3)<=O&&(O=G)):O=G=U+5,U+4<=O&&E!==-1?w(S,E,U,W):S.strategy===4||G===O?(K(S,2+(W?1:0),3),Ce(S,$,k)):(K(S,4+(W?1:0),3),function(V,ee,de,ae){var xe;for(K(V,ee-257,5),K(V,de-1,5),K(V,ae-4,4),xe=0;xe<ae;xe++)K(V,V.bl_tree[2*F[xe]+1],3);L(V,V.dyn_ltree,ee-1),L(V,V.dyn_dtree,de-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,X+1),Ce(S,S.dyn_ltree,S.dyn_dtree)),se(S),W&&oe(S)},s._tr_tally=function(S,E,U){return S.pending_buf[S.d_buf+2*S.last_lit]=E>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&E,S.pending_buf[S.l_buf+S.last_lit]=255&U,S.last_lit++,E===0?S.dyn_ltree[2*U]++:(S.matches++,E--,S.dyn_ltree[2*(l[U]+g+1)]++,S.dyn_dtree[2*T(E)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){K(S,2,3),Y(S,C,$),function(E){E.bi_valid===16?(te(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(r,o,s){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,o,s){(function(n){(function(t,e){if(!t.setImmediate){var a,u,v,g,h=1,c={},_=!1,d=t.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(t);y=y&&y.setTimeout?y:t,a={}.toString.call(t.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(t.postMessage&&!t.importScripts){var j=!0,A=t.onmessage;return t.onmessage=function(){j=!1},t.postMessage("","*"),t.onmessage=A,j}}()?(g="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",C,!1):t.attachEvent("onmessage",C),function(j){t.postMessage(g+j,"*")}):t.MessageChannel?((v=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){v.port2.postMessage(j)}):d&&"onreadystatechange"in d.createElement("script")?(u=d.documentElement,function(j){var A=d.createElement("script");A.onreadystatechange=function(){x(j),A.onreadystatechange=null,u.removeChild(A),A=null},u.appendChild(A)}):function(j){setTimeout(x,0,j)},y.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var A=new Array(arguments.length-1),R=0;R<A.length;R++)A[R]=arguments[R+1];var P={callback:j,args:A};return c[h]=P,a(h),h++},y.clearImmediate=m}function m(j){delete c[j]}function x(j){if(_)setTimeout(x,0,j);else{var A=c[j];if(A){_=!0;try{(function(R){var P=R.callback,D=R.args;switch(D.length){case 0:P();break;case 1:P(D[0]);break;case 2:P(D[0],D[1]);break;case 3:P(D[0],D[1],D[2]);break;default:P.apply(e,D)}})(A)}finally{m(j),_=!1}}}}function C(j){j.source===t&&typeof j.data=="string"&&j.data.indexOf(g)===0&&x(+j.data.slice(g.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof st<"u"?st:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(fn);var Di=fn.exports;const Ni=An(Di),Li=async(f,p,r,o,s)=>{var a,u,v;const n=document.querySelector("svg#".concat(f));if(!n)throw new Error("Requested canvas SVG element not found");const t=Number((a=n.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:a[0]),e=n.cloneNode(!0);if(e.setAttribute("height",(t*(s||100)/100).toString()),e.style.setProperty("all","initial"),["share"].map(g=>{var h;return[...((h=[...document.querySelectorAll("link")].filter(c=>c.id==="css_"+g)[0])==null?void 0:h.sheet).cssRules].map(c=>c.cssText).join(" ")}).forEach(g=>{const h=document.createElement("style");h.textContent=g,e.prepend(h)}),(u=e.querySelector("rect#canvas-border"))==null||u.setAttribute("stroke",o?"black":"none"),(v=e.querySelector("rect#canvas-bg"))==null||v.setAttribute("fill",r?"none":"white"),p===J.MTR)try{const g=await Wi(e),h=document.createElement("style");h.textContent=g.join("\n"),e.prepend(h)}catch(g){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(g)}return e},Fi=f=>new Promise(p=>{const r=new FileReader;r.onloadend=()=>p(r.result),r.readAsDataURL(f)}),Ui=(f,p)=>f.find(r=>{const o=r.style;return o.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===p.family&&o.getPropertyValue("unicode-range")===p.unicodeRange}),Wi=async f=>{var n,t,e;const p=Array.from(new Set([...f.querySelectorAll(".rmg-name__zh"),...f.querySelectorAll(".rmg-name__en")].map(a=>a.innerHTML).join("").replace(/\s/g,""))).join(""),r=await document.fonts.load("80px GenYoMin TW, Vegur",p),o=Array.from(((e=(t=(n=document.querySelector("link#css_share"))==null?void 0:n.sheet)==null?void 0:t.cssRules)==null?void 0:e[0]).styleSheet.cssRules),s=r.reduce((a,u)=>{const v=Ui(o,u);return v?a.find(h=>{const c=h.style,_=v.style;return c.getPropertyValue("font-family")===_.getPropertyValue("font-family")&&c.getPropertyValue("unicode-range")===_.getPropertyValue("unicode-range")})?a:a.concat(v):a},[]);return await Promise.all(s.map(async a=>{try{const u=await fetch(Zi(a)),v=await Fi(await u.blob());return a.cssText.replace(/src:[ \w('",\-:/.)]+;/g,"src: url('".concat(v,"'); "))}catch(u){return console.error(u),""}}))},Zi=f=>{var r;const p=f.style.src;return on()?p.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmg/styles/"+((r=p.match(/^url\("([\S*]+)"\)/))==null?void 0:r[1])},Hi=async(f,p,r)=>{const o=f.viewBox.baseVal.width,s=f.viewBox.baseVal.height,n=document.querySelectorAll("canvas")[0];n.width=Number(o)*window.devicePixelRatio*p,n.height=Number(s)*window.devicePixelRatio*p,f.setAttribute("width",n.width.toString()),f.setAttribute("height",n.height.toString());const t=n.getContext("2d");return t.clearRect(0,0,n.width,n.height),f.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(e=>e.setAttribute("font-size","8.5px")),f.querySelectorAll("text, tspan").forEach(e=>{const a=window.getComputedStyle(e);e.setAttribute("font-family",a.fontFamily),e.setAttribute("fill",a.fill),e.setAttribute("dominant-baseline",a.dominantBaseline),e.setAttribute("text-anchor",a.textAnchor||"")}),new Promise((e,a)=>{const u=new Image;u.onload=()=>{setTimeout(()=>{t.drawImage(u,0,0,n.width,n.height),n.toBlob(v=>{v?e(v):a("Canvas blob is null")},"image/png")},r?2e3:0)},u.onerror=a,u.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(f.outerHTML)))})};function Gi(f){const{isOpen:p,onClose:r}=f,{t:o}=le(),s=me(),[n,t]=q.useState(""),[e,a]=q.useState(!1),[u,v]=q.useState(!1),[g,h]=q.useState(100),[c,_]=q.useState("png"),d=Q(z=>z.app.canvasToShow),{style:y,stn_list:m,current_stn_idx:x,line_name:C}=Q(z=>z.param);q.useEffect(()=>{n!==""&&!d.includes(n)&&t("")},[d]);const j=Pt[y].reduce((z,F)=>d.includes(F)?{...z,[F]:o("CanvasType."+F)}:{...z},{"":o("DownloadModal.pleaseSelect")}),A=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((z,F)=>({...z,[F]:"".concat(F,"%")}),{}),R={png:o("DownloadModal.png"),svg:o("DownloadModal.svg")},P=[{type:"select",label:o("DownloadModal.canvas"),value:n,options:j,disabledOptions:[""],onChange:z=>t(z),minW:"full"},{type:"switch",label:o("DownloadModal.transparent"),isChecked:e,onChange:a,oneLine:!0,minW:"full"},{type:"switch",label:o("DownloadModal.showBorder"),isChecked:u,onChange:v,oneLine:!0,minW:"full"},{type:"select",label:o("DownloadModal.scale"),value:g,options:A,onChange:z=>h(z)},{type:"select",label:o("DownloadModal.format"),value:c,options:R,onChange:z=>_(z)}],D=async z=>{s(Gt(0));const F=z==="current"?[x]:Object.keys(m).filter(k=>!["linestart","lineend"].includes(k)),$=new Ni;for(const k in F){s(Gt((Number(k)+1)/F.length*100));const M=F[k];s(jt(M)),await Wr(500);const l=await Li(n,y,e,u,g);document.body.appendChild(l);const N="rmg.".concat(M,".").concat(m[M].name[0],".").concat(m[M].name[1]).replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(c==="png"){const ne=on()&&k==="0",Z=await Hi(l,g/100,ne);F.length>1?$.file("".concat(N,".png"),Z):Vt("".concat(N,".png"),Z)}else if(c==="svg"){l.removeAttribute("height");const ne="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l.outerHTML)));F.length>1?$.file("".concat(N,".svg"),ne.split("base64,")[1],{base64:!0}):ln(N+".svg","image/svg+xml",l.outerHTML)}document.body.removeChild(l)}if(F.length>1){const k=await $.generateAsync({type:"blob"}),M="rmg.".concat(C[0],".").concat(C[1],".zip").replaceAll(" ","_");Vt(M,k)}he.event(ve.DOWNLOAD_IMAGES,{canvasToDownload:n,style:y,option:z,format:c}),s(jt(x)),s(kr()),r()};return b.jsxs(Ke,{isOpen:p,onClose:r,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[b.jsx(Qe,{children:o("DownloadModal.title")}),b.jsx(et,{}),b.jsx(tt,{children:b.jsx(_e,{fields:P})}),b.jsx(nt,{children:b.jsxs(Oe,{children:[b.jsx(ce,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>D("current"),isDisabled:!n,children:o("DownloadModal.downloadOne")}),y!==J.GZMTR&&b.jsx(ce,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>D("all"),isDisabled:!n,children:o("DownloadModal.downloadAll")})]})})]})]})}function Vi(){const{t:f}=le(),[p,r]=q.useState(!1),{paramConfig:o}=Q(t=>t.app),s=Q(t=>t.param),n=()=>{ln("RMG_".concat(o==null?void 0:o.id,".json"),"application/json",JSON.stringify(s)),he.event(ve.DOWNLOAD_PARAM,{style:s.style})};return b.jsxs(bn,{children:[b.jsx(yn,{as:ce,variant:"ghost",size:"sm",rightIcon:b.jsx(Cr,{}),children:f("DownloadActions.downloads")}),b.jsxs(vn,{children:[b.jsx(Nt,{onClick:n,children:f("DownloadActions.configFile")}),b.jsx(Nt,{onClick:()=>r(!0),children:f("DownloadActions.images")})]}),b.jsx(Gi,{isOpen:p,onClose:()=>r(!1)})]})}function mt(){const[f,p]=En();return[f,o=>{if(p(o),Object.keys(o)){const s=new URLSearchParams(o);he.updateUrl("/rmg/#/?"+s)}else he.updateUrl("/rmg/#/")}]}function $i(){const{t:f}=le(),p=zt(),[,r]=mt(),o=()=>{p(Fe(De.CLOSE)),p(sn(void 0)),r({})};return b.jsxs(Oe,{ml:"auto",w:"fit-content",children:[b.jsx(ce,{variant:"ghost",size:"sm",leftIcon:b.jsx(jr,{}),onClick:o,children:f("All projects")}),b.jsx(Vi,{}),b.jsx(ce,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:b.jsx(Ar,{}),onClick:()=>p(Fe(De.STYLE)),children:f("HeaderActions.editStyle")})]})}function Yi(){const{t:f}=le(),p=me(),{canvasToShow:r,canvasScale:o}=Q(u=>u.app),s=Q(u=>u.param.style),n=Object.values(J).reduce((u,v)=>({...u,[v]:f("RmgStyle."+v)}),{}),t=Pt[s].map(u=>({label:f("CanvasType."+u),value:u})),e=u=>{p(Ir(u))},a=[{type:"select",label:f("Style"),value:s,options:n,onChange:u=>e(u)},{type:"custom",label:f("View"),component:b.jsx(Er,{displayValue:f("Select canvas"),selections:t,defaultValue:r,onChange:u=>p(Or(u))})},{type:"slider",label:f("Canvas scale"),value:o,min:.1,max:2,step:.01,onChange:u=>p(Rr(u)),leftIcon:b.jsx(zr,{}),rightIcon:b.jsx(Pr,{})}];return b.jsxs(Tr,{children:[b.jsx(_e,{fields:a,minW:160}),b.jsx($i,{})]})}const qi=f=>{switch(f){case J.MTR:return[at.Hongkong,"twl","#E2231A",Pe.white];case J.GZMTR:return[at.Guangzhou,"gz1","#F3D03E",Pe.black];case J.SHMetro:return[at.Shanghai,"sh1","#E4002B",Pe.white];default:return[at.Other,"other","#AAAAAA",Pe.white]}},Ki=f=>{switch(f){case"zh-Hans":return["1号线","Line 1"];case"zh-Hant":return["荃灣綫","Tsuen Wan Line"];default:return["地鐵線","Metro Line"]}},Ge=f=>({name:["未命名 "+f,"Unnamed "+f],secondaryName:!1,num:"00",services:[wt.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:Ne.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355}),Xi=(f,p)=>{const r=Ge("linestart");r.name=["LEFT END","LEFT END"];const o=Ge("lineend");o.name=["RIGHT END","RIGHT END"];const s=qe(6),n=Ge(s);n.num="01";const t=qe(6),e=Ge(t);return e.num="02",r.children=[s],n.parents=["linestart"],n.children=[t],e.parents=[s],e.children=["lineend"],o.parents=[t],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:f,y_pc:50,padding:10,branchSpacingPct:33,direction:Ne.left,platform_num:"1",theme:qi(f),line_name:Ki(p),current_stn_idx:t,stn_list:{linestart:r,[s]:n,[t]:e,lineend:o},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:f===J.SHMetro?tn.sh:en.gz1,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}},$e=(f,p,r,o)=>(s,n)=>{const t=n().param.stn_list;let e=qe(6);for(;e in t;)e=qe(6);const a=Ge(e);if(f!=="new"){const u={...t,[p]:{...t[p],children:t[p].children.map(v=>v===r?e:v),branch:{left:t[p].branch.left,right:t[p].branch.right.length&&t[p].branch.right[1]===r?[t[p].branch.right[0],e]:t[p].branch.right}},[r]:{...t[r],parents:t[r].parents.map(v=>v===p?e:v),branch:{left:t[r].branch.left.length&&t[r].branch.left[1]===p?[t[r].branch.left[0],e]:t[r].branch.left,right:t[r].branch.right}},[e]:{...a,parents:[p],children:[r]}};return s(Me(u)),e}else{if(!o)return!1;const u={...t,[p]:{...t[p],children:o==="upper"?[e,t[p].children[0]]:[t[p].children[0],e],branch:{left:t[p].branch.left,right:[dt.through,e]}},[r]:{...t[r],parents:o==="upper"?[e,t[r].parents[0]]:[t[r].parents[0],e],branch:{left:[dt.through,e],right:t[r].branch.right}},[e]:{...a,parents:[p],children:[r]}};return s(Me(u)),e}},Ji=(f,p,r)=>(o,s)=>{const t=s().helper.branches[f];if(t!=null&&t.length)if(p==="before"){const e=t[t.indexOf(r)-1];return o($e(f.toString(),e,r))}else{const e=t[t.indexOf(r)+1];return o($e(f.toString(),r,e))}else return!1},Qi=()=>(f,p)=>{const r=p().param.stn_list;return p().helper.branches[0].filter(s=>{const n=r[s].parents.length+r[s].children.length===4,t=It(s,r)===0;return!n&&t})},Yt=(f,p)=>(r,o)=>{const s=o().param.stn_list,n=o().helper.branches;return!n[0].includes(f)||!n[0].includes(p)?"Branch should end at main line":n[0].indexOf(f)>=n[0].indexOf(p)?"Not in correct ordering":f==="linestart"&&p==="lineend"?"Should not be parallel to main line":f==="linestart"&&n[0].indexOf(p)===1?"Branch should not be open jaw from the first station":p==="lineend"&&n[0].indexOf(f)===n[0].length-2?"Branch should not be open jaw from the last station":s[f].children.length>1||s[p].parents.length>1?"Branch already exist":n.slice(1).some(a=>a.slice(1,-1).includes(f)||a.slice(1,-1).includes(p))?"Cannot branch out from existing branch":n[0].slice(n[0].indexOf(f)+1,n[0].indexOf(p)).every(a=>s[a].parents.length===1&&s[a].children.length===1)?"":"One or more stations between both ends are branching out"};function es(f){var R,P;const{isOpen:p,onClose:r}=f,{t:o}=le(),s=me(),n=Q(D=>D.app.selectedBranch),{style:t,stn_list:e}=Q(D=>D.param),a=Q(D=>D.helper.branches),[u,v]=q.useState(n),[g,h]=q.useState("before"),[c,_]=q.useState(""),[d,y]=q.useState(!1);q.useEffect(()=>{v(n)},[n]),q.useEffect(()=>{p||y(!1)},[p]);const m=(P=(R=a[Number(u)])==null?void 0:R.slice(1,-1))!=null?P:[],x=D=>D.reduce((z,F)=>{var $;return{...z,[F]:($=e[F])==null?void 0:$.name.join(" - ")}},{"":o("AddStationModal.pleaseSelect")}),C=[{type:"select",label:o("AddStationModal.where"),value:u,options:{...a.reduce((D,z,F)=>({...D,[F]:F===0?o("AddStationModal.main"):t!==J.SHMetro||!Ue(z,e)?o("AddStationModal.branch")+" "+F:o("AddStationModal.external")+" "+F}),{})},onChange:D=>j(D),minW:"full"},{type:"select",label:o("AddStationModal.preposition"),value:g,options:{before:o("AddStationModal.before"),after:o("AddStationModal.after")},onChange:D=>h(D)},{type:"select",label:o("AddStationModal.pivot"),value:c,options:x(m),disabledOptions:[""],onChange:D=>_(D)}],j=D=>{v(D),_("")},A=()=>{const D=s(Ji(u,g,c));D?(r(),s(nn(D)),s(Fe(De.STATION))):(console.log("false here"),y(!0)),he.event(ve.ADD_STATION,{style:t,branchIndex:u,success:D})};return b.jsxs(Ke,{isOpen:p,onClose:r,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[d&&b.jsxs(ht,{status:"error",variant:"solid",size:"xs",children:[b.jsx(ut,{}),o("AddStationModal.error")]}),b.jsxs(Se,{position:"relative",children:[b.jsx(Qe,{children:o("AddStationModal.title")}),b.jsx(et,{})]}),b.jsx(tt,{children:b.jsx(_e,{fields:C})}),b.jsx(nt,{children:b.jsx(ce,{colorScheme:"primary",onClick:A,isDisabled:!c,children:o("Confirm")})})]})]})}function ts(f){const{isOpen:p,onClose:r}=f,{t:o}=le(),s=me(),[n,t]=q.useState("new"),[e,a]=q.useState(""),[u,v]=q.useState(""),[g,h]=q.useState("upper"),[c,_]=q.useState(""),[d,y]=q.useState(""),{style:m,stn_list:x}=Q($=>$.param);q.useEffect(()=>{p||(t("new"),a(""),v(""))},[p]);const j=($=>$.reduce((k,M)=>{var l;return{...k,[M]:(l=x[M])==null?void 0:l.name.join(" - ")}},{"":o("NewBranchModal.pleaseSelect")}))(s(Qi())),A=[{type:"select",label:o("NewBranchModal.where"),value:n,options:{new:o("NewBranchModal.new"),ext:o("NewBranchModal.ext")},disabledOptions:m===J.SHMetro?[]:["ext"],onChange:$=>R($),minW:"full"},{type:"select",label:o("NewBranchModal.from"),value:e,options:j,disabledOptions:[""],onChange:$=>P($),isInvalid:!!c},{type:"select",label:o("NewBranchModal.to"),value:u,options:j,disabledOptions:[""],onChange:$=>D($),isInvalid:!!d},{type:"select",label:o("NewBranchModal.position"),value:g,options:{upper:o("NewBranchModal.upper"),lower:o("NewBranchModal.lower")},onChange:$=>h($),minW:"full",hidden:n!=="new"||m===J.SHMetro}],R=$=>{t($),a(""),v(""),_(""),y("")},P=$=>{a($),_(""),$&&u&&y(s(Yt($,u)))},D=$=>{v($),y(""),e&&$&&_(s(Yt(e,$)))},z=()=>{let $;n==="ext"?$=s($e("new",e,u,"lower")):m===J.SHMetro?$=s($e("new",e,u,"upper")):$=s($e("new",e,u,g)),$&&(r(),he.event(ve.ADD_BRANCH,{style:m,where:n}))},F=!!(!e||!u||c||d);return b.jsxs(Ke,{isOpen:p,onClose:r,children:[b.jsx(Xe,{}),b.jsxs(Je,{children:[b.jsx(Qe,{children:o("NewBranchModal.title")}),b.jsx(et,{}),b.jsx(tt,{children:b.jsx(_e,{fields:A})}),b.jsx(nt,{children:b.jsx(ce,{colorScheme:"primary",title:F?c||d:o("Confirm"),onClick:z,isDisabled:F,children:o("Confirm")})})]})]})}const ns=q.lazy(()=>lt(()=>import("./station-ag-grid-7dd8176b.js"),["assets/station-ag-grid-7dd8176b.js","assets/chakra-b5edfc98.js","assets/react-f83802c2.js","assets/index-e1564128.js","assets/index-d22c1e14.css","assets/ag-grid-eec7c2ef.js","assets/param-updater-utils-a57fb0d0.js"]));function rs(){const{t:f}=le(),p=me(),[r,o]=q.useState(!1),[s,n]=q.useState(!1),t=Q(g=>g.app.selectedBranch),{style:e,stn_list:a}=Q(g=>g.param),u=Q(g=>g.helper.branches),v=()=>{p(Fe(De.BRANCH))};return b.jsxs(Se,{flex:1,overflow:"hidden",children:[b.jsxs(Sn,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:t,onChange:g=>p(Br(g)),children:[b.jsxs(xn,{children:[u.map((g,h)=>h===0?b.jsx(_t,{children:f("GridTabs.main")},h):e!==J.SHMetro||!Ue(g,a)?b.jsx(_t,{children:f("GridTabs.branch")+" "+h},h):b.jsx(_t,{children:f("GridTabs.external")+" "+h},h)),b.jsx(ze,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>n(!0),icon:b.jsx(Re,{})}),b.jsxs(Oe,{marginLeft:"auto",marginRight:1,children:[b.jsx(ce,{variant:"outline",size:"xs",leftIcon:b.jsx(Re,{}),onClick:()=>o(!0),children:f("GridTabs.addStation")}),b.jsx(ce,{size:"xs",colorScheme:"primary",onClick:v,children:f("GridTabs.editLine")})]})]}),b.jsx(wn,{flex:1,overflowY:"auto",children:u.map((g,h)=>b.jsx(kn,{padding:0,h:"100%",position:"relative",children:b.jsx(Xt,{suspenseFallback:b.jsx(ft,{isIndeterminate:!0}),children:b.jsx(ns,{branchIndex:h})})},h))})]}),b.jsx(es,{isOpen:r,onClose:()=>o(!1)}),b.jsx(ts,{isOpen:s,onClose:()=>n(!1)})]})}function is(){const f=me(),p=Q(o=>o.app.globalAlerts),r=o=>{he.isStandaloneWindow()?window.open("/".concat(o),"_blank"):he.openApp(o)};return b.jsx(b.Fragment,{children:Object.entries(p).map(([o,{message:s,url:n,linkedApp:t}])=>b.jsxs(ht,{status:o,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[b.jsx(ut,{}),t?b.jsx(Ve,{onClick:()=>r(t),children:s}):n?b.jsx(Ve,{href:n,target:"_blank",children:s}):s,b.jsx(qt,{ml:"auto",onClick:()=>f(Mr(o))})]},o))})}function ss(){const{t:f}=le(),p=Q(s=>s.app.isLoading),[r,o]=q.useState(!1);return q.useEffect(()=>{he.isStandaloneWindow()&&!window.localStorage.getItem(Ie.DO_NOT_SHOW_RMT_MSG)&&o(!0)},[]),b.jsxs(an,{children:[p&&b.jsx(ft,{isIndeterminate:p<0,value:p>=0?p:void 0}),b.jsx(Yi,{}),r&&b.jsxs(ht,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[b.jsx(ut,{}),b.jsxs(ct,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[f("Try out")," ",b.jsx(Ve,{href:"/?app=rmg",isExternal:!0,children:f("Rail Map Toolkit")})," ",f("now and enjoy an even better rail map design experience!")," ",b.jsx(Ve,{as:"button",ml:"auto",onClick:()=>o(!1),children:f("Close")})," | ",b.jsx(Ve,{as:"button",onClick:()=>{o(!1),window.localStorage.setItem(Ie.DO_NOT_SHOW_RMT_MSG,"true")},children:f("Don't show me again")})]})]}),b.jsx(is,{}),b.jsxs(Ee,{flex:1,overflow:"hidden",position:"relative",children:[b.jsxs(Ee,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[b.jsx(Se,{children:b.jsx(Kr,{})}),b.jsx(rs,{})]}),b.jsx(Mi,{})]}),b.jsx("canvas",{style:{display:"none"}})]})}const as="rmg-templates-bridge--",os={h:800,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function ls(f){const{isOpen:p,onClose:r,onImport:o}=f,[s]=q.useState(crypto.randomUUID()),n="/rmg-templates/#/import?"+new URLSearchParams({parentComponent:he.getAppName(),parentId:s});return q.useEffect(()=>{const t=new BroadcastChannel(as+s);return t.onmessage=e=>{const{event:a,meta:u,data:v}=e.data;console.log("[rmg] Received event from RMG Templates app clip:",a),a==="CLOSE"?r():a==="IMPORT"&&o(v,u.name)},()=>{t.close()}},[]),b.jsx(rn,{size:"xl",isOpen:p,onClose:r,sx:os,children:b.jsx("iframe",{src:n,loading:"lazy"})})}const cs={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function ds(f){const{selectedParam:p,disableNew:r,onError:o}=f,{t:s}=le(),[,n]=mt(),[t,e]=q.useState(!1),a=q.useRef(null),u=q.useRef(null);q.useEffect(()=>{var _;p&&((_=u.current)==null||_.focus())},[p]);const v=()=>{const _=Xi(J.MTR,he.getLanguage()),d=yt(JSON.stringify(_));n({project:d}),he.event(ve.NEW_PARAM,{})},g=(_,d)=>{const y=yt(JSON.stringify(_),d);n({project:y})},h=async _=>{var y;const d=(y=_.target.files)==null?void 0:y[0];console.log("handleImportProject():: received file",d);try{if(!d)o(s("OpenActions.unknownError"));else if(d.type!=="application/json")o(s("OpenActions.invalidType"));else{const m=await Zr(d),x=yt(m);n({project:x}),he.event(ve.UPLOAD_PARAM,{})}}catch(m){o(s("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",m)}_.target.value=""},c=()=>{p&&(n({project:p}),he.event(ve.OPEN_PARAM,{}))};return b.jsxs(Ee,{sx:cs,children:[b.jsx(ce,{leftIcon:b.jsx(Re,{}),onClick:v,isDisabled:r,children:s("Blank project")}),b.jsx(ce,{leftIcon:b.jsx(Dr,{}),onClick:()=>e(!0),isDisabled:r,children:s("Open template")}),b.jsx(ce,{leftIcon:b.jsx(Nr,{}),onClick:()=>{var _;return(_=a.current)==null?void 0:_.click()},isDisabled:r,children:s("Import project")}),b.jsx(ce,{ref:u,colorScheme:"primary",leftIcon:b.jsx(Lr,{}),onClick:c,isDisabled:p===void 0,children:s("Open selected")}),b.jsx("input",{ref:a,type:"file",accept:".json",hidden:!0,onChange:h,"data-testid":"file-upload"}),b.jsx(ls,{isOpen:t,onClose:()=>e(!1),onImport:g})]})}const hs={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function us(f){const{downloading:p}=f,{t:r}=le(),[o]=mt(),s=o.get("project"),[n,t]=q.useState([]),[e,a]=q.useState(),u=q.useRef(null),v=Kt();q.useEffect(()=>{t(vt())},[p]),Cn({ref:u,handler:()=>a(void 0)});const g=_=>{const{id:d,name:y,lastModified:m}=_;d&&(window.localStorage.setItem(Ie.PARAM_CONFIG_BY_ID+d,JSON.stringify({name:y,lastModified:m})),a(void 0),t(vt()),he.event(ve.UPDATE_PARAM_CONFIG,{}))},h=_=>{window.localStorage.removeItem(Ie.PARAM_BY_ID+_),window.localStorage.removeItem(Ie.PARAM_CONFIG_BY_ID+_),a(void 0),t(vt()),he.event(ve.REMOVE_PARAM,{})},c=_=>{v({description:_,status:"error",duration:1e4,isClosable:!0})};return b.jsxs(an,{justifyContent:"center",children:[s&&b.jsx(ft,{isIndeterminate:!0}),b.jsx(jn,{children:b.jsxs(Be,{sx:hs,children:[b.jsx(ye,{as:"h3",size:"lg",children:r("Saved projects")}),b.jsxs(Ee,{ref:u,children:[b.jsx(Hr,{paramRegistry:n,downloading:p,selectedParam:e,onParamSelect:a,onParamRemove:h,onParamUpdate:g}),b.jsx(ds,{selectedParam:e,disableNew:n.length>=10,onError:c})]})]})})]})}const fs=f=>p=>{let r={id:f};const o=window.localStorage.getItem(Ie.PARAM_CONFIG_BY_ID+f);o===null?console.warn("Config for paramID=".concat(f," does not exist in localStorage")):r={...r,...JSON.parse(o)};try{const s=window.localStorage.getItem(Ie.PARAM_BY_ID+f);if(s===null)return console.warn("Param ID=".concat(f," does not exist in localStorage")),!1;{const n=Gr(JSON.parse(s));return p(sn(r)),p(Fr(n)),!0}}catch(s){return console.warn("Failed to parse param.",s),!1}};function ps(){const{t:f}=le(),p=me(),{paramConfig:r}=Q(h=>h.app),[o,s]=mt(),n=o.get("project"),t=o.get("external"),[e,a]=q.useState(!1),[u,v]=q.useState(),g=Kt();return q.useEffect(()=>{if(console.log("searchParam: project=".concat(n,", external=").concat(t)),n&&t)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),s({project:n});else if(n)g.closeAll(),n===(r==null?void 0:r.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),a(!0)):(console.log("AppRouter:: Loading app view for param (ID=".concat(n,")...")),p(fs(n))?a(!0):(console.log("AppRouter:: Failed to read param (ID=".concat(n,"). Rendering param selector view...")),g({description:f("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),s({})));else if(t){console.log("AppRouter:: External project URl is provided. Downloading project...");const h=decodeURIComponent(t);v(h),Ur(h).then(c=>{c?s({project:c}):(console.log("AppRouter:: Failed to download param from ".concat(h,". Rendering param selector view...")),g({description:f("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),s({})),v(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),a(!1)},[n,t]),e?b.jsx(ss,{}):b.jsx(us,{downloading:u})}const vs=Object.freeze(Object.defineProperty({__proto__:null,default:ps},Symbol.toStringTag,{value:"Module"}));export{Vr as R,vs as a,ys as g,Ue as i};
