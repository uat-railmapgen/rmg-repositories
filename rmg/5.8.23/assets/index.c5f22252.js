import{z as M,l as e,j as y,ab as O,b6 as te}from"./vendor.f5f9489b.js";import{ar as L,u as N,F as ne,j as P}from"./index.ed03c37b.js";import{i as X}from"./app-router.bc11f443.js";import{S as U,e as de,a as me,c as Y,g as ue,b as fe}from"./share.49a91d45.js";import{a as re}from"./mtr.d036e49e.js";const ve=(s,n,t,r)=>{const a=s.length-r*2-t,i=s.findIndex(d=>d===n),l=[...s,...s,...s],o=s.length+i-Math.floor(a/2)+(a%2===0?1:0),h=s.length+i+Math.floor(a/2);return{top:l.slice(o,h+1),left:l.slice(o-r,o),right:l.slice(h+1,h+1+r),bottom:l.slice(h+1+r,h+1+r+t)}},ge=(s,n,t,r)=>{const a=s.length-r*2-t,i=[...s,...s,...s],l=s.length+s.findIndex(d=>d===n),o=i[l+a-1],h=s.length+s.findIndex(d=>d===o)+(l+a>s.length*2?s.length:0);return{top:i.slice(l,h+1),left:i.slice(l-r,l),right:i.slice(h+1,h+1+r),bottom:i.slice(h+1+r,h+1+r+t)}},ye=(s,n,t,r)=>{let a=s.findIndex(f=>f===n[0]),i=s.findIndex(f=>f===n[1]);[a,i,n[0],n[1]]=a>i?[i,a,n[1],n[0]]:[a,i,n[0],n[1]];const l=s.slice(a,i+1),o=s.filter(f=>!l.filter(u=>!n.includes(u)).includes(f)),h=s.length-(r==="major"?Math.max:Math.min)(l.length,o.length)-t*2,d=r==="major"?l.length>o.length?n[0]:n[1]:l.length>o.length?n[1]:n[0];return ge(s,d,h,t)},Se=(s,n)=>{const t=Object.fromEntries(s.map(d=>[d,-1])),r=Object.fromEntries(s.map(d=>[d,-1])),[a,i,l,o]=[0,1,0,1],h=0;return n.top.forEach((d,f)=>{t[d]=h/2+(1-h)/(n.top.length+1)*(f+1),r[d]=a}),n.right.forEach((d,f)=>{t[d]=o,r[d]=h/2+(1-h)/(n.right.length+1)*(f+1)}),n.bottom.forEach((d,f)=>{t[d]=1-h/2-(1-h)/(n.bottom.length+1)*(f+1),r[d]=i}),n.left.forEach((d,f)=>{t[d]=l,r[d]=1-h/2-(1-h)/(n.left.length+1)*(f+1)}),{x_shares:t,y_shares:r}},ke=(s,n,t,r)=>{const a=s[0].filter(h=>!["linestart","lineend"].includes(h)),i=[...a,...a,...a],l=n==="r"?i:i.reverse(),o=l.findIndex(h=>r===h)+a.length;return l.slice(o+1).filter(h=>t[h].loop_pivot).slice(void 0,2)},se=L.Destination;function we(){const{canvasScale:s}=N(i=>i.app),{svgWidth:n,svg_height:t,theme:r}=N(i=>i.param),a=n[se];return y(U,{type:se,svgWidth:a,svgHeight:t,canvasScale:s,theme:r,children:[e(Me,{}),e(be,{})]})}const Me=M.exports.memo(function(){return e("defs",{children:e("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})})})}),be=()=>{const{routes:s,branches:n}=N(v=>v.helper),{line_name:t,theme:r,current_stn_idx:a,direction:i,stn_list:l,info_panel_type:o,loop:h,coline:d}=N(v=>v.param),f=(v,w,S)=>[...new Set(v.filter(b=>b.includes(S)).map(b=>{const k=b.filter(H=>!["linestart","lineend"].includes(H));return w==="l"?k[0]:k.reverse()[0]}))],u=(v,w)=>w?[[v.map(S=>l[S].name[0]).join("\uFF0C"),v.map(S=>l[S].name[1]).join(", ")].map(S=>S.replace("\\",""))]:v.map(S=>l[S].name.map(b=>b.replace("\\",""))),x=h?ke(n,i,l,a):f(s,i,a),p=(h?f(s,i,a):x).filter(v=>n.slice(1).filter(w=>X(w,l)).some(w=>w.includes(v))),c=x.filter(v=>!p.includes(v)),g=u(c,!h&&o!=="sh2020");console.log(g);const m=u(p,!0),_=250,$=Object.fromEntries(p.map(v=>[v,Object.values(d).filter(w=>w.from===v||w.to===v).at(0)]).filter(([,v])=>v));return y(O,{children:[e(ie,{dest_names:g,line_name:t,line_color:[r[2],r[3]],coline:!!p.length,upper:!!p.length}),p.length&&p.map(v=>{var w,S,b;return e("g",{transform:`translate(0,${-_})`,children:e(ie,{dest_names:[m.at(0)],line_name:(w=$[v])==null?void 0:w.colors.at(0).slice(4),line_color:[(S=$[v])==null?void 0:S.colors.at(0)[2],(b=$[v])==null?void 0:b.colors.at(0)[3]],coline:!0,upper:!1})},`coline_${v}`)})]})},ie=s=>{const{dest_names:n,line_name:t,line_color:r,coline:a,upper:i}=s,{current_stn_idx:l,direction:o,platform_num:h,svgWidth:d,svg_height:f}=N(w=>w.param),u=M.exports.useRef(null),[x,p]=M.exports.useState({width:0});M.exports.useEffect(()=>{u.current&&p(u.current.getBBox())},[JSON.stringify(n),JSON.stringify(l)]);const[c,g,m,_,$]=[d.destination/2,10,36,264,325],v=c-g-m-x.width>=$/2&&c-g-m-_>=$/2?c:o==="l"?(d.destination+x.width-_)/2:(d.destination-x.width+_)/2;return y("g",{transform:`translate(0,${f-300})`,children:[e("path",{stroke:r[0],strokeWidth:12,d:o==="l"?`M${d.destination-24},16 H 36`:`M24,16 H ${d.destination-36}`,transform:`translate(0,${i?-20:220})`,markerEnd:a?void 0:"url(#slope)"}),e(Ne,{ref:u,dest_names:n}),h!==""&&e("g",{transform:`translate(${v},0)`,children:e(He,{})}),t[0].match(/^[\w\d]+(号)?线/)?e(Fe,{line_name:t,line_color:r}):e(Ee,{line_name:t,line_color:r})]})},Ne=M.exports.forwardRef(function(n,t){const{dest_names:r}=n,{direction:a,svgWidth:i}=N(l=>l.param);return y("g",{ref:t,transform:`translate(${a==="l"?36:i.destination-36},145)`,children:[e("g",{transform:`translate(0,${r.length===2?-20:20})`,children:e("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",fill:"black",transform:`rotate(${a==="l"?0:180})scale(0.8)`})}),e("g",{textAnchor:a==="l"?"start":"end",transform:`translate(${a==="l"?128+20:-128-20},25)`,children:r.map((l,o)=>y(M.exports.Fragment,{children:[e("text",{className:"rmg-name__zh",fontSize:70,dy:o*-100+7,children:"\u5F80"+l[0]},`zh${o}`),e("text",{className:"rmg-name__en",fontSize:25,dy:o*-100+40,children:"To "+l[1]},`en${o}`)]},o))})]})}),He=()=>{const{platform_num:s}=N(n=>n.param);return M.exports.useMemo(()=>y("g",{transform:`translate(${-325/2+60},150)`,children:[e("circle",{r:60,fill:"none",stroke:"black",strokeWidth:2}),e("text",{className:"rmg-name__en",dominantBaseline:"central",fontSize:120,textAnchor:"middle",children:s}),e("text",{className:"rmg-name__zh",fontSize:100,dominantBaseline:"central",x:65,children:"\u7AD9\u53F0"})]}),[s])},Ee=s=>{const{line_name:n,line_color:t}=s,{direction:r,svgWidth:a}=N(u=>u.param),i=r==="l"?a.destination-42:42,l=M.exports.useRef(null),[o,h]=M.exports.useState({width:0});M.exports.useEffect(()=>{l.current&&h(l.current.getBBox())},[...n]);const d=(r==="l"?-o.width:0)-6,f=(r==="l"?-1:1)*o.width/2;return M.exports.useMemo(()=>y("g",{transform:`translate(${i},92)`,children:[e("rect",{fill:t[0],x:d,width:o.width+10,height:120}),y("g",{textAnchor:r==="r"?"start":"end",transform:"translate(0,68)",fill:t[1],children:[e("g",{ref:l,children:e("text",{className:"rmg-name__zh",fontSize:68,children:n[0]})}),e("text",{className:"rmg-name__en",fontSize:30,textAnchor:"middle",x:f,dy:42,children:n[1]})]})]}),[o,...n,...t,r,a.destination])},Fe=s=>{const{line_name:n,line_color:t}=s,{direction:r,svgWidth:a}=N(h=>h.param),[i,l]=n[0].match(/^[\w\d]+|.+/g),o=r==="l"?a.destination-36-210:36+54;return M.exports.useMemo(()=>y("g",{transform:`translate(${o},92)`,children:[e("rect",{fill:t[0],x:-54,width:108,height:120}),e("text",{className:"rmg-name__zh",fill:t[1],fontSize:96,textAnchor:"middle",dominantBaseline:"central",transform:"translate(0,60)",letterSpacing:-5,children:i}),y("g",{textAnchor:"start",transform:"translate(74,68)",children:[e("text",{className:"rmg-name__zh",fontSize:68,children:l}),e("text",{className:"rmg-name__en",fontSize:30,dy:42,children:n[1]})]})]}),[o,...n,...t,r,a.destination])},R=(s,n)=>s.map(t=>{const r=n.filter(h=>h.includes(t.from)&&h.includes(t.to));if(r.length!==1)return{linePath:[],colors:t.colors};const a=r.flat(),i=a.indexOf(t.from),l=a.indexOf(t.to);return{linePath:i<l?a.slice(i,l+1):a.slice(l,i+1),colors:t.colors}}).filter(t=>t.linePath.length!==0),Oe=(s,n)=>s.map(t=>{const r=de(t.linePath,n);return{main:[{linePath:r.main,colors:t.colors}],pass:[{linePath:r.pass,colors:t.colors}]}}).reduce((t,r)=>(t.main=[...t.main,...r.main],t.pass=[...t.pass,...r.pass],t),{main:[],pass:[]}),T=12,le=L.RunIn,Ie=()=>{const{canvasScale:s}=N(c=>c.app),{branches:n,routes:t,depsStr:r}=N(c=>c.helper),{svgWidth:a,svg_height:i,current_stn_idx:l,direction:o,loop:h,theme:d}=N(c=>c.param),f=a[le],u=i-300,x=M.exports.useMemo(()=>{let c=t.filter(g=>g.includes(l)).map(g=>g[g.indexOf(l)+(o==="l"?1:-1)]).reduce((g,m)=>g.includes(m)?g:g.concat(m),[]);return h&&n[0].includes(l)&&c.length===1&&["linestart","lineend"].includes(c[0])&&(c=o==="l"?[n[0][1]]:[n[0][n[0].length-2]]),c},[r,l,o,h]),p=M.exports.useMemo(()=>{let c=t.filter(g=>g.includes(l)).map(g=>g[g.indexOf(l)+(o==="l"?-1:1)]).reduce((g,m)=>g.includes(m)?g:g.concat(m),[]);return h&&n[0].includes(l)&&c.length===1&&["linestart","lineend"].includes(c[0])&&(c=o==="l"?[n[0][n[0].length-2]]:[n[0][1]]),c},[r,l,o,h]);return y(U,{type:le,svgWidth:f,svgHeight:i,canvasScale:s,theme:d,children:[e(ze,{}),e("g",{transform:`translate(0,${u})`,children:e(Le,{prevStnIds:x,nextStnIds:p})})]})},ze=M.exports.memo(function(){return y("defs",{children:[e("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),y("filter",{id:"pujiang_outline_runin",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[e("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"0",result:"e1"}),e("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"1",result:"e2"}),e("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"outline"}),e("feComposite",{in:"outline",in2:"SourceGraphic",operator:"over",result:"output"})]})]})}),Le=s=>{const{prevStnIds:n,nextStnIds:t}=s,{info_panel_type:r,svgWidth:a,stn_list:i}=N(p=>p.param),l=a.runin/2,o=t.length===1&&["linestart","lineend"].includes(t[0]),h=n.length===1&&["linestart","lineend"].includes(n[0]),d=t.map(p=>i[p].name),f=n.map(p=>i[p].name),u=(t.length>1?(d[0][0].split("\\").length-1)*-50+(d[0][1].split("\\").length-1)*-30:0)+10,x=(n.length>1?(f[0][0].split("\\").length-1)*-50+(f[0][1].split("\\").length-1)*-30:0)+10;return y(O,{children:[e(Ce,{prevStnIds:n,nextStnIds:t,nextBranchLineDy:u,prevBranchLineDy:x}),o&&r!=="sh2020"?e(ae,{mode:"terminal",prevStnIds:n,nextStnIds:t}):h&&r!=="sh2020"?e(ae,{mode:"original",prevStnIds:n,nextStnIds:t}):y(O,{children:[e(je,{prevStnIds:n,nextStnIds:t}),e("g",{transform:`translate(${l},160)`,textAnchor:"middle",children:e(pe,{})})]}),(h||!o)&&e(De,{stnIds:s.nextStnIds}),(o||!h)&&e(Be,{stnIds:s.prevStnIds})]})},ae=s=>{var c;const{mode:n,prevStnIds:t,nextStnIds:r}=s,{current_stn_idx:a,theme:i,svgWidth:l,direction:o,coline:h}=N(g=>g.param),{branches:d}=N(g=>g.helper),f={l:{original:{x:l.runin-36,anchor:"end"},terminal:{x:36,anchor:"start"}},r:{original:{x:36,anchor:"start"},terminal:{x:l.runin-36,anchor:"end"}}},u=R(Object.values(h),d),x=n==="terminal"?t:r,p=r.length>1?"var(--rmg-theme-colour)":(c=u.filter(g=>g.linePath.includes(a)&&g.linePath.includes(x[0])).map(g=>g.colors[0][2])[0])!=null?c:"var(--rmg-theme-colour)";return y(O,{children:[n==="original"&&e("path",{transform:`translate(0,${h.length?"198":"220"})${h.length?"scale(1,2)":""}`,stroke:p,strokeWidth:12,d:o==="l"?`M ${l.runin-24},16 H 36`:`M24,16 H ${l.runin-36}`,markerEnd:"url(#slope)"}),n==="terminal"&&e("g",{filter:i[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,children:e("path",{transform:`translate(0,${h.length?"198":"220"})${h.length?"scale(1,2)":""}`,stroke:"var(--rmg-grey)",strokeWidth:12,d:`M24,16 H ${l.runin-24}`})}),e("g",{transform:`translate(${f[o][n].x},160)`,textAnchor:f[o][n].anchor,children:e(pe,{})})]})},je=s=>{var w;const{prevStnIds:n,nextStnIds:t}=s,{direction:r,svgWidth:a,theme:i,coline:l,current_stn_idx:o,stn_list:h}=N(S=>S.param),{branches:d}=N(S=>S.helper),f=a.runin/2,u=S=>S.includes("linestart")||S.includes("lineend"),x=R(Object.values(l),d),p=t.length>1?"single":u(t)?x.filter(S=>[o,n[0]].every(b=>S.linePath.includes(b))).length>0?"multiple":"single":[o,t[0]].every(S=>d[0].includes(S))&&x.filter(S=>[o,t[0]].every(b=>S.linePath.includes(b))).length>0?"multiple":"single",c=u(t)?n:t,g=t.length>1?"var(--rmg-theme-colour)":(w=x.filter(S=>S.linePath.includes(o)&&S.linePath.includes(c[0])).map(S=>S.colors[0][2])[0])!=null?w:"var(--rmg-theme-colour)",m=(S,b,k,H)=>S.slice(1).filter(z=>[b,k[0]].every(I=>z.includes(I))).filter(z=>X(z,H)).length>0,_=Object.keys(l).length>0&&m(d,o,t,h)?g:"var(--rmg-theme-colour)",$=Object.keys(l).length>0&&t.length===1&&(u(n)||u(t)?!0:!([o,t[0]].every(S=>d[0].includes(S))&&x.filter(S=>S.linePath.includes(o)&&S.linePath.includes(t[0])).length!==0)),v=Object.keys(l).length>0&&n.length===1;return y("g",{transform:"translate(0,220)",strokeWidth:12,children:[y(O,{children:[_!=="var(--rmg-theme-colour)"&&e("marker",{id:`slope_${_}`,viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:_})}),e("path",{stroke:_,d:`M ${f},16 H ${r==="l"?36:a.runin-36}`,markerEnd:_==="var(--rmg-theme-colour)"?"url(#slope)":`url(#slope_${_})`,transform:$?"translate(0,-22)scale(1,2)":void 0})]}),p==="multiple"&&y(O,{children:[e("marker",{id:`slope_${g}`,viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:g})}),e("path",{stroke:g,d:`M ${f},16 H ${r==="l"?36+T:a.runin-(36+T)}`,markerEnd:`url(#slope_${g})`,transform:"translate(0,-12)"})]}),e("g",{filter:i[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,transform:`translate(0,${v?-22:0})scale(1,${v?2:1})`,children:e("path",{stroke:"var(--rmg-grey)",d:`M ${f},16 H ${r==="l"?a.runin-24:24} `})})]})},Ce=s=>{const{prevStnIds:n,nextStnIds:t,nextBranchLineDy:r,prevBranchLineDy:a}=s,{direction:i,svgWidth:l,current_stn_idx:o,coline:h,theme:d}=N($=>$.param),{branches:f}=N($=>$.helper),u=l.runin/2,x=125,p=$=>`${$[0]},${$[1]}`,c=$=>`M${p($.at(0))} `+$.slice(1).map(v=>`L${p(v)}`).join(" "),g=i==="l"?[[l.runin/3,x],[l.runin/6,r],[36,r]]:[[l.runin/3*2,x],[l.runin/6*5,r],[l.runin-36,r]],m=i==="l"?[[l.runin/3*2,x],[l.runin/6*5,a],[l.runin-24,a]]:[[l.runin/3,x],[l.runin/6,a],[24,a]];let _="var(--rmg-theme-colour)";if(Object.keys(h).length>0){const $=R(Object.values(h),f);t.length>1&&$.filter(v=>v.linePath.includes(o)&&t.some(w=>v.linePath.includes(w)))&&(g[0][1]-=T-1,g.unshift([u,x-T+1]),_=$.filter(v=>v.linePath.includes(o)&&t.some(w=>v.linePath.includes(w))).at(0).colors.at(0)[2]),n.length>1&&$.filter(v=>v.linePath.includes(o)&&n.some(w=>v.linePath.includes(w)))&&(m[0][1]-=T-1,m.unshift([u,x-T+1]))}return y("g",{transform:"translate(0,110)",strokeWidth:12,fill:"none",filter:d[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,children:[e("marker",{id:"slope_branch",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:_})}),t.length>1&&e("path",{stroke:_,d:c(g),markerEnd:"url(#slope_branch)"}),n.length>1&&e("path",{stroke:"var(--rmg-grey)",d:c(m)})]})},pe=()=>{const s=N(t=>t.param),{name:n}=s.stn_list[s.current_stn_idx];return M.exports.useMemo(()=>y(O,{children:[e("text",{className:"rmg-name__zh",fontSize:112,children:n[0].replace("\\","")}),e("text",{className:"rmg-name__en",fontSize:36,dy:50,children:n[1].replace("\\","")})]}),[...n])},V=s=>{const{nextName:n,...t}=s;return e("g",{...t,children:M.exports.useMemo(()=>y(O,{children:[n[0].split("\\").map((r,a,i)=>e("text",{className:"rmg-name__zh",fontSize:48,dy:(i.length-1-a)*-50-(n[1].split("\\").length-1)*30,children:r},r)),n[1].split("\\").map((r,a,i)=>e("text",{className:"rmg-name__en",fontSize:24,dy:28+(i.length-1-a)*-30,children:r},r))]}),[...n])})},Be=s=>{const n=N(i=>i.param),t=s.stnIds.map(i=>n.stn_list[i].name),r=(s.stnIds.length>1?15:125)+t.map(i=>i[0].split("\\").length).reduce((i,l)=>i+l,-t.length)*-50+t.map(i=>i[1].split("\\").length).reduce((i,l)=>i+l,-t.length)*-30,a=(s.stnIds.length>1?(t[0][0].split("\\").length-1)*-50+(t[0][1].split("\\").length-1)*-30:0)+70;return y("g",{fill:"gray",textAnchor:n.direction==="l"?"end":"start",transform:`translate(${n.direction==="l"?n.svgWidth.runin-36:36},0)`,children:[e(V,{nextName:t[0],transform:"translate(0,183)"}),s.stnIds.length>1&&e(V,{nextName:t[1],transform:`translate(0,${a})`}),y("g",{transform:`translate(0, ${r})`,children:[e("text",{className:"rmg-name__zh",fontSize:22,children:"\u4E0A\u4E00\u7AD9"}),e("text",{className:"rmg-name__en",fontSize:12,dx:n.direction==="l"?-70:70,children:"Past Stop"})]})]})},De=s=>{const n=N(i=>i.param),t=s.stnIds.map(i=>n.stn_list[i].name),r=(s.stnIds.length>1?15:125)+t.map(i=>i[0].split("\\").length).reduce((i,l)=>i+l,-t.length)*-50+t.map(i=>i[1].split("\\").length).reduce((i,l)=>i+l,-t.length)*-30,a=(s.stnIds.length>1?(t[0][0].split("\\").length-1)*-50+(t[0][1].split("\\").length-1)*-30:0)+70;return y("g",{textAnchor:n.direction==="l"?"start":"end",transform:`translate(${n.direction==="l"?36:n.svgWidth.runin-36},0)`,children:[e(V,{nextName:n.stn_list[s.stnIds[0]].name,transform:"translate(0,183)"}),s.stnIds.length>1&&e(V,{nextName:n.stn_list[s.stnIds[1]].name,transform:`translate(0,${a})`}),y("g",{transform:`translate(0, ${r})`,children:[e("text",{className:"rmg-name__zh",fontSize:22,children:"\u4E0B\u4E00\u7AD9"}),e("text",{className:"rmg-name__en",fontSize:12,dx:n.direction==="l"?70:-70,children:"Next Stop"})]})]})},Z=s=>{const{stnId:n,stnState:t,color:r,bank:a,direction:i}=s,{direction:l,info_panel_type:o,stn_list:h,loop:d}=N(v=>v.param),f=h[n],u=i!=null?i:l,x=d?0:([...f.branch.left,...f.branch.right].length?8+12*f.name[1].split("\\").length:0)*(u==="r"?-1:1);let p;const c={};o==="sh2020"?(f.services.length===3?p="stn_sh_2020_direct":f.services.length===2?p="stn_sh_2020_express":p="stn_sh_2020",c.fill=t===-1?"gray":r||"var(--rmg-theme-colour)"):(f.services.length===3?p="direct_sh":f.services.length===2?p="express_sh":[...f.transfer.info[0],...f.transfer.info[1]||[]].length>0?p="int2_sh":p="stn_sh",c.stroke=t===-1?"gray":r||"var(--rmg-theme-colour)");const g=a!=null?a:0,m=(u==="l"?6:-6)+x+g*30,_=(o==="sh2020"?-20:-6)+Math.abs(g)*(o==="sh2020"?25:11),$=g?0:u==="l"?-45:45;return y(O,{children:[e("use",{xlinkHref:`#${p}`,...c,transform:`translate(${g*(o==="sh2020"?5:0)},0)rotate(${g*90*(o==="sh2020"?1:-1)})`}),e("g",{transform:`translate(${m},${_})rotate(${$})`,children:e(We,{name:f.name,infos:f.transfer.info,stnState:t,direction:u,facility:f.facility,bank:g,oneLine:f.one_line,intPadding:f.int_padding})}),t===0?e(Pe,{}):void 0]})},We=s=>{var _;const{name:n,infos:t,stnState:r,direction:a,facility:i,bank:l,oneLine:o,intPadding:h}=s,d=M.exports.useRef(null),f=a==="l"?1:-1,u=i!==ne.none?30:0,x=l?-12:0,p=M.exports.useRef(null),[c,g]=M.exports.useState(0);M.exports.useEffect(()=>{var $,v;return g((v=($=p.current)==null?void 0:$.getBBox().width)!=null?v:0)},[...JSON.stringify(t)]);const m=h-c;return y(O,{children:[t.flat().length>0&&y(O,{children:[e("line",{x1:(x+u)*f,x2:m*f,stroke:r===-1?"gray":"black",strokeWidth:.5}),e(Te,{ref:p,intInfos:t,direction:a,transform:`translate(${m*f},-10.75)`})]}),i!==ne.none&&e("use",{xlinkHref:"#"+i,x:10*f,y:-30}),y("g",{textAnchor:a==="l"?"start":"end",transform:`translate(${u*f},-14)`,children:[e(Ae,{ref:d,stnName:n,oneLine:o,directionPolarity:f,fill:r===-1?"gray":r===0?"red":"black"}),((_=t[1])==null?void 0:_.length)>0&&e("g",{transform:`translate(${(m+c/2)*f},-30)`,children:e(Ve,{osiInfos:t[1]})}),[...t[2]||[]].length>0&&e("g",{transform:`translate(${(h+5)*f},0)`,children:e(Xe,{osysiInfos:t[2],direction:s.direction})})]})]})},Ae=M.exports.forwardRef(function(n,t){const{stnName:r,oneLine:a,directionPolarity:i,...l}=n,o=M.exports.useRef(null),[h,d]=M.exports.useState(0);M.exports.useEffect(()=>{a&&o.current?d(o.current.getBBox().width+5):d(0)},[...r,a]);const[f,u]=[20,8];return e("g",{ref:t,...l,children:M.exports.useMemo(()=>y(O,{children:[e("g",{ref:o,children:r[0].split("\\").map((x,p,c)=>e("text",{className:"rmg-name__zh rmg-outline",dy:(c.length-1-p)*-f+(a?u:(r[1].split("\\").length-1)*-u),children:x},p))}),e("g",{fontSize:8,transform:`translate(${h*i},0)`,children:r[1].split("\\").map((x,p,c)=>e("text",{className:"rmg-name__en rmg-outline",dy:(c.length-2-p)*-u+2,children:x},p))})]}),[...r,a,h,i])})}),Pe=()=>{const{stn_list:s}=N(r=>r.param),n=new Set(Object.values(s).map(r=>r.services).flat()),t=[-1,35,50,75][n.size];return e("g",{transform:`translate(0, ${t})`,children:e("text",{className:"rmg-name__zh",fill:"red",textAnchor:"middle",children:"\u672C\u7AD9"})})},Te=M.exports.forwardRef(function(n,t){var h;const{intInfos:r,direction:a,...i}=n,l=[...r[0],...r[1]||[],...((h=r[2])==null?void 0:h.filter(d=>Boolean(d[4].match(/^磁(悬)*浮/))))||[]];let o=0;return e("g",{ref:t,fontSize:14,textAnchor:"middle",...i,children:l.map((d,f)=>{const u=Boolean(d[4].match(/^\w+(号)?线/)),x=Boolean(d[4].match(/^磁(悬)*浮/));n.direction==="r"&&(o-=(u||x?20:d[4].length*14+12)+(f===0?0:5));let p;return x?p=e("g",{transform:`translate(${o},-16)scale(0.1428571429)`,children:e(Re,{info:d})},f):u?p=e("g",{transform:`translate(${o},0)`,children:e(Ge,{info:d})},f):p=e("g",{transform:`translate(${o},0)`,children:e(Ye,{info:d})},f),n.direction==="l"&&(o+=u||x?20+5:d[4].length*14+12+5),p})})}),Re=M.exports.memo(function(n){return e(O,{children:e("use",{xlinkHref:"#intbox_maglev",fill:n.info[2],stroke:n.info[2]})})},(s,n)=>s.info.toString()===n.info.toString()),Ge=M.exports.memo(function(n){var t;return y(O,{children:[e("use",{xlinkHref:"#intbox_number",fill:n.info[2]}),e("text",{x:10,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:(t=n.info[4].match(/(\d*)\w+/))==null?void 0:t[0]})]})},(s,n)=>s.info.toString()===n.info.toString()),Ye=M.exports.memo(function(n){const t=n.info[4].split("\\")[0].length;return y(O,{children:[e("rect",{height:22,width:t*14+12,y:-11,fill:n.info[2]}),e("text",{x:t*7+6,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].split("\\")[0]})]})},(s,n)=>s.info.toString()===n.info.toString()),Ve=s=>{const n=s.osiInfos.map(t=>t[4]).join("\uFF0C");return M.exports.useMemo(()=>y("g",{textAnchor:"middle",fontSize:"50%",children:[e("text",{className:"rmg-name__zh",dy:-5,children:`\u6362\u4E58${n}`}),e("text",{className:"rmg-name__zh",dy:5,children:"\u4EC5\u9650\u516C\u5171\u4EA4\u901A\u5361"}),e("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]}),[n.toString()])},Xe=s=>{const n=s.osysiInfos.map(r=>r[4]).join("\uFF0C"),t=s.osysiInfos.map(r=>r[5]).join(", ");return M.exports.useMemo(()=>y("g",{textAnchor:s.direction==="l"?"start":"end",fontSize:"50%",children:[y("text",{className:"rmg-name__zh",dy:3,children:["\u8F6C\u4E58",n]}),y("text",{className:"rmg-name__en",dy:10,fontSize:"75%",children:["To ",t]})]}),[s.osysiInfos.toString(),s.direction])},Ue=["shanghai","sh4","#5F259F","#fff","4\u53F7\u7EBF","Line 4"],Ze=s=>{const{xs:n,servicesPresent:t,stnStates:r}=s,{svg_height:a,direction:i,stn_list:l,current_stn_idx:o,branchSpacingPct:h,info_panel_type:d,coline:f}=N(S=>S.param),{branches:u,depsStr:x}=N(S=>S.helper),p=M.exports.useMemo(()=>(console.log("computing y shares"),Object.keys(l).reduce((S,b)=>{if(u[0].includes(b))return{...S,[b]:0};{const k=u.slice(1).filter(H=>H.includes(b))[0];return{...S,[b]:l[k[0]].children.indexOf(k[1])?-3:3}}},{})),[x]),c=Object.entries(p).filter(([S,b])=>b<=0).reduce((S,[b,k])=>({...S,[b]:k}),{}),g=Object.keys(c).reduce((S,b)=>({...S,[b]:-c[b]*h*a/300}),{}),m=M.exports.useMemo(()=>Oe(R(Object.values(f).filter(S=>S.display),u),r),[JSON.stringify(f),o,i,x]),_=t.reduce((S,b)=>({...S,[b]:Object.keys(m).reduce((k,H)=>({...k,[H]:m[H].map(z=>({path:xe(z.linePath,H,n,g,i,b,t.length,l,"diagonal"),colors:z.colors})).filter(z=>z.path!=="")}),{})}),{}),$=R(Object.values(f).filter(S=>S.display),u).map(S=>S.linePath).flat(),v=12,w=d==="sh2020"?3:0;return e(O,{children:y("g",{id:"coline",transform:`translate(0,${v+w})`,children:[e(Je,{paths:_,direction:i}),e(qe,{colineStns:m,branches:u,xs:n,ys:g,stnStates:r,lineWidth:v,colineGap:w}),e(Ke,{stnIds:Object.entries(p).filter(([S,b])=>b<0).reduce((S,[b,k])=>[...S,b],[]).filter(S=>!["linestart","lineend"].includes(S)).filter(S=>l[S].services.length!==0).filter(S=>$.includes(S)),xs:n,ys:g,stnStates:r})]})})},Je=s=>{const{paths:n,direction:t}=s;return e(O,{children:Object.keys(n).map((r,a)=>{var i,l;return e("g",{transform:`translate(0,${a*25})`,children:y("g",{children:[(i=n[r])==null?void 0:i.pass.map((o,h)=>e(M.exports.Fragment,{children:e("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:o.path,strokeLinejoin:"round",filter:r===P.local?void 0:`url(#contrast-${r})`},h)},h)),(l=n[r])==null?void 0:l.main.map((o,h)=>{var d;return y(M.exports.Fragment,{children:[o.colors.length>1&&e("linearGradient",{id:`grad${h}`,y1:"-100%",y2:"100%",x1:"0",x2:"0",gradientUnits:"userSpaceOnUse",children:o.colors.map((f,u)=>y(M.exports.Fragment,{children:[e("stop",{offset:`${100/o.colors.length*(u+0)}%`,stopColor:f[2]}),e("stop",{offset:`${100/o.colors.length*(u+1)}%`,stopColor:f[2]})]},u))}),t==="l"&&e("marker",{id:`arrow_left_${h}_${o.colors.map(f=>f[2]).join("_")}`,refY:.5,refX:1,children:e("path",{d:"M1,0L0,1H1z",fill:o.colors.length>1?`url(#grad${h})`:o.colors[0][2]})}),t==="r"&&e("marker",{id:`arrow_right_${h}_${o.colors.map(f=>f[2]).join("_")}`,refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:o.colors.length>1?`url(#grad${h})`:o.colors[0][2]})}),e("path",{stroke:((d=o.colors.at(-1))!=null?d:Ue)[2],strokeWidth:12,fill:"none",d:o.path,markerStart:t==="l"?`url(#arrow_left_${h}_${o.colors.map(f=>f[2]).join("_")})`:void 0,markerEnd:t==="r"?`url(#arrow_right_${h}_${o.colors.map(f=>f[2]).join("_")})`:void 0,strokeLinejoin:"round",filter:r===P.local?void 0:`url(#contrast-${r})`},h)]},h)})]})},`servicePath${a}`)})})},qe=s=>{const{colineStns:n,branches:t,xs:r,ys:a,stnStates:i,lineWidth:l,colineGap:o}=s,{line_name:h,theme:d,info_panel_type:f}=N(x=>x.param),u=[...n.main,...n.pass].map(x=>x.linePath.map(p=>{var c;return{curStn:p,x:r[p],y:a[p],color:(c=x.colors.at(-1))!=null?c:[...d,...h]}})).flat().reduce((x,p)=>x.find(c=>c.curStn===p.curStn)?x:x.concat(p),[]).filter(x=>t[0].includes(x.curStn));return console.log(u),e("g",{id:"stations_in_mainline",children:u.map(x=>{const{curStn:p,x:c,y:g,color:m}=x,_=(i[p]===-1?0:l)+o+l,$=(i[p]===-1?0:-l)-o-l/2;return e("g",{transform:`translate(${c},${g})`,children:f==="sh2020"?e("rect",{stroke:"none",height:_,width:12,x:-6,y:$,fill:i[p]===-1?"var(--rmg-grey)":m[2]}):e("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:`translate(0,${-l})`})},p)})})},Ke=s=>{const{xs:n,ys:t,stnStates:r,stnIds:a}=s,{branches:i,depsStr:l}=N(x=>x.helper),{line_name:o,theme:h,coline:d}=N(x=>x.param),f=M.exports.useMemo(()=>R(Object.values(d),i),[JSON.stringify(d),l]),u=a.reduce((x,p)=>{var c;return{...x,[p]:(c=f.filter(g=>g.linePath.includes(p)).map(g=>g.colors).flat().at(0))!=null?c:[...h,...o]}},{});return e("g",{id:"stations_in_coline",children:a.map(x=>e("g",{transform:`translate(${n[x]},${t[x]})`,children:e(Z,{stnId:x,stnState:r[x],color:u[x][2]})},x))})},Qe=()=>{const{routes:s,branches:n,depsStr:t}=N(k=>k.helper),r=N(k=>k.param),{svg_height:a,stn_list:i,branchSpacingPct:l,coline:o,direction:h}=N(k=>k.param),d=me(r.stn_list,()=>0,()=>0),f=Y("linestart","lineend",d),u=Y(f.nodes[1],f.nodes.slice(-2)[0],d),x=M.exports.useMemo(()=>(console.log("computing x shares"),Object.keys(r.stn_list).reduce((k,H)=>({...k,[H]:ue(H,d,n)}),{})),[n.toString(),JSON.stringify(d)]),p=[r.svgWidth.railmap*r.padding/100,r.svgWidth.railmap*(1-r.padding/100)],c=Object.keys(x).reduce((k,H)=>({...k,[H]:p[0]+x[H]/u.len*(p[1]-p[0])}),{}),g=M.exports.useMemo(()=>(console.log("computing y shares"),Object.keys(i).reduce((k,H)=>{if(n[0].includes(H))return{...k,[H]:0};{const z=n.slice(1).filter(I=>I.includes(H))[0];return{...k,[H]:i[z[0]].children.indexOf(z[1])?-3:3}}},{})),[t]),m=Object.entries(g).filter(([,k])=>k>=0).reduce((k,[H,z])=>({...k,[H]:z}),{}),_=Object.keys(m).reduce((k,H)=>({...k,[H]:-m[H]*l*a/300}),{}),$=M.exports.useMemo(()=>fe(r.current_stn_idx,s,r.direction),[r.current_stn_idx,r.direction,s.toString()]),v=Object.values(P),w=Object.values(r.stn_list).map(k=>k.services).flat().reduce((k,H)=>(k[v.indexOf(H)]=!0,k),[!1,!1,!1]).map((k,H)=>[v[H],k]).filter(k=>k[1]).map(k=>k[0]),S=n.map(k=>de(k,$)).reduce((k,H)=>(k.main.push(H.main),k.pass.push(H.pass),k),{main:[],pass:[]}),b=w.reduce((k,H)=>({...k,[H]:Object.keys(S).reduce((z,I)=>({...z,[I]:S[I].map(E=>xe(E,I,c,_,h,H,w.length,i)).filter(E=>E!=="")}),{})}),{});return y("g",{id:"main",transform:`translate(0,${r.svg_height*(Object.keys(o).length>0?.5:.7+.1)})`,children:[e(et,{paths:b,direction:r.direction}),e(tt,{stnIds:Object.keys(m).filter(k=>!["linestart","lineend"].includes(k)).filter(k=>i[k].services.length!==0),xs:c,ys:_,stnStates:$}),Object.keys(o).length>0&&e(Ze,{xs:c,servicesPresent:w,stnStates:$}),w.length>1&&e(nt,{servicesLevel:w,lineXs:p})]})},et=s=>{const{theme:n}=N(a=>a.param),{paths:t,direction:r}=s;return e(O,{children:Object.keys(t).map((a,i)=>{var l,o;return y("g",{transform:`translate(0,${i*25})`,filter:n[2]==="#999999"?"url(#pujiang_outline_railmap)":void 0,children:[e("g",{children:(l=t[a])==null?void 0:l.pass.map((h,d)=>e("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:h,markerStart:s.direction==="l"?"url(#arrow_gray)":void 0,markerEnd:s.direction==="r"?"url(#arrow_gray)":void 0,strokeLinejoin:"round"},d))}),e("g",{children:(o=t[a])==null?void 0:o.main.map((h,d)=>e("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:h,markerStart:r==="l"?"url(#arrow_theme_left)":void 0,markerEnd:r==="r"?"url(#arrow_theme_right)":void 0,strokeLinejoin:"round",filter:a===P.local?void 0:`url(#contrast-${a})`},d))})]},`servicePath${i}`)})})},xe=(s,n,t,r,a,i,l,o,h="rightangle")=>{let[d,f]=[];const u={},x={local:0,express:20,direct:40}[i],p=l>1?50:0;let c=30;if(s.length>0){let m=!1,_=!1;o[s.at(-1)||0].children.some($=>["linestart","lineend"].includes($))?_=!0:o[s.at(0)||0].parents.some($=>["linestart","lineend"].includes($))&&(m=!0),c=m||_?c:0}const g=30;if(s.forEach(m=>{const _=t[m],$=r[m];if(!d&&d!==0){[f,d]=[_,$],u.start=[_,$];return}$===0?$!==d&&(u.bifurcate=[f,d]):$!==d&&(u.bifurcate=[_,$]),u.end=[_,$],[f,d]=[_,$]}),"start"in u)if("end"in u)if("bifurcate"in u){const[m,_]=u.start,$=u.bifurcate[0],[v,w]=u.end;return n==="main"?a==="l"?w>_?(console.log(u),h==="rightangle"?`M ${m-c},${_} H ${v} V ${w}`:`M ${m},${_} H ${m+g} L ${$-g},${w} H ${v}`):h==="rightangle"?`M ${m},${_} V ${w} H ${v}`:`M ${m-c},${_} H ${$+g} L ${v-g},${w} H ${v}`:w>_?h==="rightangle"?`M ${m},${_} H ${v} V ${w}`:`M ${m},${_} H ${m+g} L ${$-g},${w} H ${v+c}`:h==="rightangle"?`M ${m},${_} V ${w} H ${v+c}`:`M ${m},${_} H ${$+g} L ${v-g},${w} H ${v}`:a==="l"?w>_?h==="rightangle"?`M ${m-c},${_} H ${v} V ${w}`:`M ${m},${_} H ${m+g} L ${$-g},${w} H ${v+c}`:h==="rightangle"?`M ${m},${_} V ${w} H ${v+c}`:`M ${m-c},${_} H ${$+g} L ${v-g},${w} H ${v}`:w>_?h==="rightangle"?`M ${m-c},${_} H ${v} V ${w}`:`M ${m},${_} H ${m+g} L ${$-g},${w} H ${v+c}`:h==="rightangle"?`M ${m},${_} V ${w} H ${v+c}`:`M ${m-c},${_} H ${$+g} L ${v-g},${w} H ${v}`}else{const[m,_]=u.start,$=u.end[0];return n==="main"?a==="l"?`M ${m-c-x},${_} H ${$}`:`M ${m},${_} H ${$+c+x}`:a==="l"?`M ${m-c},${_} H ${$+c+p}`:`M ${m-c-p},${_} H ${$+c}`}else{const[m,_]=u.start;return n==="main"?a==="l"?`M ${m-c-x},${_} H ${m}`:`M ${m},${_} H ${m+c+x}`:a==="l"?`M ${m},${_} L ${m+c+p},${_}`:`M ${m-c-p},${_} L ${m},${_}`}else return""},tt=s=>{const{xs:n,ys:t,stnStates:r,stnIds:a}=s;return e("g",{children:a.map(i=>e("g",{transform:`translate(${n[i]},${t[i]})`,children:e(Z,{stnId:i,stnState:r[i]})},i))})},nt=s=>{const{svg_height:n,direction:t,svgWidth:r}=N(h=>h.param),a=-n+130,i=s.servicesLevel.map(h=>({local:"\u666E\u901A\u8F66",express:"\u5927\u7AD9\u8F66",direct:"\u76F4\u8FBE\u8F66"})[h]),l=t==="r"?s.lineXs[0]-42:s.lineXs[1]+42,o=s.servicesLevel.length===2?350:500;return M.exports.useMemo(()=>y("g",{children:[i.map((h,d)=>y("g",{transform:`translate(${l},${d*25})`,children:[e("rect",{x:-27.5,height:10,width:55,fill:"white",stroke:"black",y:-5}),e("text",{className:"rmg-name__zh",fontSize:9,y:3,textAnchor:"middle",children:`${h}\u8FD0\u884C\u7EBF`})]},h)),y("g",{transform:`translate(${t==="r"?30:r.railmap-o},${a})`,children:[e("text",{className:"rmg-name__zh",children:"\u56FE\u4F8B\uFF1A"}),i.map((h,d)=>y("g",{transform:`translate(${d*150+50},0)`,children:[e("line",{x1:"0",x2:"35",y1:"-5",y2:"-5",stroke:"var(--rmg-theme-colour)",strokeWidth:"12",filter:d===2?"url(#contrast-direct)":d===1?"url(#contrast-express)":""}),e("use",{x:"17.5",y:"-5",xlinkHref:"#stn_sh",fill:"var(--rmg-theme-colour)"}),e("text",{x:"40",className:"rmg-name__zh",children:`${h}\u505C\u9760\u7AD9`})]},`serviceLevel${d}`))]})]}),[n,t,r,s.servicesLevel,s.lineXs])},rt=()=>{const{direction:s,svgWidth:n,coline:t}=N(a=>a.param),r=!!Object.keys(t).length;return M.exports.useMemo(()=>y("g",{transform:`translate(${s==="l"?50:n.railmap-150},50)`,children:[e("text",{className:"rmg-name__zh",children:"\u5217\u8F66\u524D\u8FDB\u65B9\u5411"}),e("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",stroke:r?"var(--rmg-black)":void 0,strokeWidth:r?5:void 0,fill:r?"var(--rmg-white)":"var(--rmg-theme-colour)",transform:`translate(${s==="l"?-30:125},-5)rotate(${s==="l"?0:180})scale(0.15)`})]}),[s,t,n.railmap])},q=s=>{const{stnId:n,nameDirection:t,services:r,color:a}=s,i=N(d=>d.param.stn_list[n]),l=[...i.transfer.info[0],...i.transfer.info[1]||[]];let o;i.services.length===3?o="direct_indoor_sh":i.services.length===2?o="express_indoor_sh":l.length>0?o="int2_indoor_sh":o="stn_indoor_sh";const h=t==="left"||t==="right"?90:0;return y(O,{children:[e(st,{name:i.name,infos:i.transfer.info,nameDirection:t,services:r}),e("use",{xlinkHref:`#${o}`,stroke:l.length>0?"var(--rmg-black)":a!=null?a:"var(--rmg-theme-colour)",transform:`rotate(${h})`}),i.services.length>1&&e("text",{className:"rmg-name__zh",writingMode:"tb",fontSize:"60%",dy:"-12",children:`\u5927\u7AD9\u8F66${i.services.length>2?" \u76F4\u8FBE\u8F66":""}\u505C\u9760`})]})},st=s=>{var f,u,x,p,c,g,m,_;const{name:n,infos:t,nameDirection:r,services:a}=s,i={upward:60,downward:-30,left:0,right:0}[r],l={upward:0,downward:0,left:85,right:-85}[r],o={upward:-185,downward:150+(a.length===3?40:0),left:-30,right:-30}[r],h=((f=t[2])==null?void 0:f.length)>0?{upward:0,downward:0,left:t[0].length+t[1].length!==0?85:25,right:t[0].length+t[1].length!==0?-85:-25}[r]:0,d=((u=t[2])==null?void 0:u.length)>0?{upward:(x=t[1])!=null&&x.length?-210:t[0].length?-180:-100,downward:((p=t[1])!=null&&p.length?190:t[0].length?160:100)+(a.length===3?40:0),left:(c=t[1])!=null&&c.length?-60:t[0].length?-30:0,right:(g=t[1])!=null&&g.length?-60:t[0].length?-30:0}[r]:0;return y("g",{transform:`translate(0,${i})`,children:[r==="upward"||r==="downward"?y(O,{children:[e("line",{x1:-30,x2:30,y1:r==="upward"?-23:-10,y2:r==="upward"?-23:-10,stroke:"black"}),e("line",{y1:r==="upward"?-23:-10,y2:r==="upward"?-23-25:20,stroke:"black"})]}):y(O,{children:[e("line",{x1:r==="left"?-50:15,x2:r==="left"?-15:50,y1:0,y2:0,stroke:"black"}),e("line",{x1:r==="left"?-50:50,x2:r==="left"?-50:50,y1:-30,y2:30,stroke:"black"})]}),[...t[0],...t[1]||[]].length>0&&e(lt,{intInfos:[...t[0],...t[1]||[]],arrowDirection:r,services:a}),e(it,{stnName:n,nameDirection:r,fill:"black"}),((m=t[1])==null?void 0:m.length)>0&&e("g",{transform:`translate(${l},${o})`,children:e(at,{osiInfos:t[1],nameDirection:r})}),((_=t[2])==null?void 0:_.length)>0&&e("g",{transform:`translate(${h},${d})`,children:e(ot,{osysiInfos:t[2],nameDirection:r})})]})},it=M.exports.forwardRef(function(n,t){const{stnName:r,nameDirection:a,...i}=n,l=r[0].split("\\"),o=r[1].split("\\").length,h={upward:0,downward:0,left:-60,right:60}[a],d={upward:-2,downward:-30-12*(o-1),left:-10*(o-1),right:-10*(o-1)}[a],f={upward:"middle",downward:"middle",left:"end",right:"start"}[a];return e("g",{ref:t,...i,textAnchor:f,transform:`translate(${h},${d})`,children:M.exports.useMemo(()=>y(O,{children:[l.map((u,x,p)=>e("text",{className:"rmg-name__zh",dy:a==="upward"?16*x:(p.length-1-x)*-16,children:u},x)),e("g",{fontSize:9.6,children:r[1].split("\\").map((u,x)=>e("text",{className:"rmg-name__en",dy:12*(x+1)+(a==="upward"&&l.length>1?l.length*7.5:0),children:u},x))})]}),[...r])})}),lt=s=>{const{intInfos:n,arrowDirection:t,services:r}=s,a=n.map(c=>c[2]).reduce((c,g)=>c+g,""),i=[n.filter(c=>c[4].match(/^\d+.*$/)).map(c=>c[4].replace(/^(\d+)(.*)$/,"$1")).join("\uFF0C").concat("\u53F7\u7EBF"),n.filter(c=>!c[4].match(/^\d+.*$/)).map(c=>c[4]).join("\uFF0C")].filter(c=>c&&c!=="\u53F7\u7EBF").join("\uFF0C"),l=["Line ".concat(n.filter(c=>c[5].match(/^(L|l)ine$/)).map(c=>c[5].replace("Line","").replace("line","").trim()).join(",")),n.filter(c=>!c[5].match(/^(L|l)ine$/)).map(c=>c[5]).join("\uFF0C")].filter(c=>c&&c!=="Line ").join(","),o=r.length===3?80:45,h={upward:-145,downward:125+(r.length===3?40:0),left:7,right:7}[t],d={upward:0,downward:0,left:20,right:-20}[t],f={upward:-74,downward:44,left:0,right:0}[t],u={upward:0,downward:180,left:90,right:-90}[t],x={upward:0,downward:0,left:85,right:-85}[t],p={upward:"middle",downward:"middle",left:"start",right:"end"}[t];return y("g",{children:[e("path",{id:"int_indoor_arrow_sh",stroke:"var(--rmg-black)",strokeWidth:1,transform:`translate(${d},${f})rotate(${u})`,fill:n.length===1?n[0][2]:`url(#grad${a})`,d:`M -7.5,0 v -${o} h -7.5 l 15,-15 l 15,15 h -7.5 v ${o} Z`}),n.length>1&&e(O,{children:e("linearGradient",{id:`grad${a}`,y1:"0",y2:"0",x1:t==="upward"?"25%":"75%",x2:t==="upward"?"75%":"25%",children:n.map((c,g)=>y(M.exports.Fragment,{children:[e("stop",{offset:`${100/n.length*g}%`,stopColor:c[2]}),e("stop",{offset:`${100/n.length*(g+1)}%`,stopColor:c[2]})]},g))})}),y("g",{transform:`translate(${x},${h})`,textAnchor:`${p}`,children:[e("text",{className:"rmg-name__zh",dy:-7,children:`\u6362\u4E58${i}`}),e("text",{className:"rmg-name__en",dy:5,fontSize:9.6,children:`Interchange ${l}`})]})]})},at=s=>{const n={upward:"middle",downward:"middle",left:"start",right:"end"}[s.nameDirection];return M.exports.useMemo(()=>y("g",{textAnchor:`${n}`,fontSize:"50%",children:[e("text",{className:"rmg-name__zh",dy:-5,children:`\u6362\u4E58${s.osiInfos.map(t=>t[4]).join("\uFF0C")}`}),e("text",{className:"rmg-name__zh",dy:5,children:"\u4EC5\u9650\u516C\u5171\u4EA4\u901A\u5361"}),e("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]}),[s.osiInfos.toString(),s.nameDirection])},ot=s=>{const n={upward:"middle",downward:"middle",left:"start",right:"end"}[s.nameDirection];return M.exports.useMemo(()=>y("g",{textAnchor:`${n}`,children:[e("text",{className:"rmg-name__zh",dy:-5,children:`\u8F6C\u4E58${s.osysiInfos.map(t=>t[4]).join("\uFF0C")}`}),e("text",{className:"rmg-name__en",dy:7.5,fontSize:9.6,children:`To ${s.osysiInfos.map(t=>t[5]).join(", ")}`})]}),[s.osysiInfos.toString(),s.nameDirection])},ct=(s,n,t,r,a,i)=>{var x,p,c,g;const l=s[0].filter(m=>!["linestart","lineend"].includes(m)),o=s.slice(1,3).map(m=>m.slice(1,m.length-1)),h=o.reduce((m,_)=>m+_.filter($=>!["linestart","lineend",...n].includes($)).length,0)+l.length-i-a*2,d=(t-t*r/100*2)/(1+h),f=[t*r/100+((x=o.at(0))!=null?x:[]).length*d,t*(1-r/100)-((p=o.at(1))!=null?p:[]).length*d],u={...Object.fromEntries(((c=o.at(0))!=null?c:[]).map((m,_)=>[m,t*r/100+_*d])),...Object.fromEntries(((g=o.at(1))!=null?g:[]).map((m,_)=>[m,f[1]+(1+_)*d]))};return{loop_branches:o,line_xs_branches:f,xs_branches:u}},ht=s=>{var $,v,w,S;const{loop_branches:n,edges:t,xs:r,ys:a,canvas:i}=s,[l,o,h,d]=t,{branches:f}=N(b=>b.helper),{current_stn_idx:u,direction:x,coline:p}=N(b=>b.param),c=i===L.RailMap?30:0,g=[`M ${l},${h} H ${Number(r[(v=($=n.at(0))==null?void 0:$.at(0))!=null?v:""])-c}`,`M ${o},${h} H ${Number(r[(S=(w=n.at(1))==null?void 0:w.at(-1))!=null?S:""])+c}`],m=f[0].filter(b=>!["linestart","lineend"].includes(b)),_=Object.values(p).filter(b=>![b.from,b.to].every(k=>m.includes(k))).map(b=>b.colors);return e(O,{children:n.map((b,k)=>{var H,z,I;return y(te.Fragment,{children:[_.filter((E,C,W)=>C===W.findIndex(D=>{var B,A;return((B=D.at(0))==null?void 0:B.at(2))===((A=E.at(0))==null?void 0:A.at(2))})).map(E=>e("marker",{id:`arrow_theme_${E[0][2]}`,refX:1,refY:.5,children:e("path",{d:"M0,1H2L1,0z",fill:E[0][2]})},E[0][2])),e("path",{stroke:(I=(z=(H=_.at(k))==null?void 0:H.at(0))==null?void 0:z.at(2))!=null?I:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:g[k],markerEnd:i===L.RailMap&&(x==="l"&&k===0||x==="r"&&k===1)?_.at(k)?`url(#arrow_theme_${_[k][0][2]})`:"url(#arrow_theme)":void 0}),b.filter(E=>!["linestart","lineend"].includes(E)).map(E=>{var C,W,D,B;return y(te.Fragment,{children:[i===L.RailMap&&e("g",{transform:`translate(${r[E]},${a[E]})`,children:e(Z,{stnId:E,stnState:u===E?0:1,bank:0,direction:x,color:(W=(C=_.at(k))==null?void 0:C.at(0))==null?void 0:W.at(2)})},E),i===L.Indoor&&e("g",{transform:`translate(${r[E]},${a[E]})`,children:e(q,{stnId:E,nameDirection:n.filter(A=>A.includes(E)).map(A=>A.indexOf(E)%2===0?"downward":"upward")[0],services:[P.local],color:(B=(D=_.at(k))==null?void 0:D.at(0))==null?void 0:B.at(2)})},E)]},E)})]},b.at(0))})})},dt=s=>{var _;const{edges:n,loop_stns:t,xs:r,ys:a,canvas:i}=s,[l,o,h,d]=n,{info_panel_type:f,stn_list:u,coline:x}=N($=>$.param),{branches:p}=N($=>$.helper),c=Object.values(x).filter($=>[$.from,$.to].every(v=>p.slice(1,3).filter(w=>X(w,u)).flat().includes(v))).map($=>$.colors).at(0),g=12,m=i===L.RailMap&&f==="sh2020"?3:0;return y("g",{id:"coline_main",children:[e("path",{d:`M ${l},${h} H${o}`,strokeWidth:12,stroke:(_=c==null?void 0:c.at(0))==null?void 0:_.at(2)}),i===L.RailMap&&Object.keys(x).length>0&&t.top.map($=>{var v;return e("g",{transform:`translate(${r[$]},${a[$]})`,children:f==="sh2020"?y(O,{children:[e("rect",{stroke:"none",height:24,width:12,x:-6,y:-m-1,fill:(v=c==null?void 0:c.at(0))==null?void 0:v.at(2)}),e("rect",{stroke:"none",height:m+g,width:12,x:-6,y:g-2,fill:"var(--rmg-theme-colour)"})]}):e("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:`translate(0,${1+g})`})},$)})]})},_e=s=>{var ee;const{bank_angle:n,canvas:t}=s,{branches:r}=N(F=>F.helper),{current_stn_idx:a,svgWidth:i,svg_height:l,padding:o,branchSpacingPct:h,direction:d,info_panel_type:f,stn_list:u,loop_info:{left_and_right_factor:x,bottom_factor:p},coline:c}=N(F=>F.param),g=r[0].filter(F=>!["linestart","lineend"].includes(F)),m=r.slice(0,3).flat().filter((F=>j=>(F[j]=(F[j]||0)+1)===2)({})).filter(F=>!["linestart","lineend"].includes(F)),_=(ee=Object.values(c).filter(F=>[F.from,F.to].every(j=>r.slice(1,3).filter(G=>X(G,u)).flat().includes(j))).map(F=>{const j=g.findIndex(J=>J===F.from),G=g.findIndex(J=>J===F.to);return Math.abs(G-j)>g.length-2-Math.abs(G-j)?"major":"minor"}).at(0))!=null?ee:"minor",$=m.at(1)?ye(g,m,x,_):m.at(0)?ge(g,m[0],p,x):ve(g,a,p,x),{x_shares:v,y_shares:w}=Se(g,$),{loop_branches:S,line_xs_branches:b,xs_branches:k}=ct(r,m,i[t],o,x,$.bottom.length),H={...w,...Object.fromEntries(S.flat().map(F=>[F,0]))},z=h*l/300,I=[225+z,l-75-(t===L.RailMap?0:125)-z],E=Object.keys(H).reduce((F,j)=>({...F,[j]:I[0]+H[j]*(I[1]-I[0])}),{}),C=[Math.max(i[t]*o/100+(n&&t===L.RailMap?100:0),b[0]),Math.min(i[t]*(1-o/100)-(n&&t===L.RailMap?100:0),b[1])],W=Object.keys(v).reduce((F,j)=>({...F,[j]:C[0]+v[j]*(C[1]-C[0])}),{}),D=n?{l:1,r:-1}[d]:0;[...$.right,...$.left].forEach(F=>{W[F]-=(E[F]-I[0])*D}),$.bottom.forEach(F=>{W[F]-=(I[1]-I[0])*D});const B={...k,...W},A=mt($,B,E,D,[...C,...I],d),K=12,Q=t===L.RailMap&&f==="sh2020"?3:0;Object.keys(c).length>0&&$.top.forEach(F=>{E[F]-=Q+K});const $e=S.length?0:(I[1]-I[0])*D/2;return y("g",{id:"loop",transform:`translate(${$e},0)`,children:[e("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:A,strokeLinejoin:"round"}),t===L.RailMap&&e(oe,{canvas:t,loop_stns:$,xs:B,ys:E}),y("g",{transform:`translate(0,${Object.keys(c).length>0?-K-Q:0})`,children:[e(ht,{loop_branches:S,edges:[...C,...I],xs:B,ys:E,canvas:t}),Object.keys(c).length>0&&e(dt,{edges:[...C,...I],loop_stns:$,xs:B,ys:E,canvas:t})]}),t===L.Indoor&&e(oe,{canvas:t,loop_stns:$,xs:B,ys:E})]})},mt=(s,n,t,r,a,i)=>{const[l,o,h,d]=a,f=(p,c,g,m,_)=>({right:[g+(m-h)*r,c],bottom:[p-(d-c)*r,m],left:[g-(d-m)*r,c],top:[p+(c-h)*r,m]})[_],u=[];s.top.forEach(p=>{u.push([n[p],t[p]])}),["right","bottom","left"].forEach(p=>{if(s[p].length>0)u.push(f(u.at(-1)[0],u.at(-1)[1],n[s[p][0]],t[s[p][0]],p)),s[p].forEach(c=>{u.push([n[c],t[c]])});else{const c={right:[o,u.at(-1)[1]],bottom:[u.at(-1)[0]+(d-u.at(-1)[1])*-r,u.at(-1)[1]+(d-u.at(-1)[1])],left:[l+(r===0?0:(d-h)*(i==="l"?-1:1)),u.at(-1)[1]]};u.push(c[p])}}),u.push(f(u.at(-1)[0],u.at(-1)[1],n[s.top[0]],t[s.top[0]],"top"));const x=u.slice(1).map(([p,c])=>`L${p},${c} `).join(" ");return`M${u[0][0]},${u[0][1]} ${x} Z`},oe=s=>{const{canvas:n,loop_stns:t,xs:r,ys:a}=s,{current_stn_idx:i}=N(d=>d.param),l={top:0,bottom:0,left:-1,right:1},o={left:"r",right:"l",top:void 0,bottom:void 0},h=(d,f)=>({top:f%2===0?"upward":"downward",bottom:f%2===0?"upward":"downward",left:"left",right:"right"})[d];return y("g",{id:"loop_stations",children:[n===L.RailMap&&Object.entries(t).map(([d,f])=>f.map(u=>e("g",{transform:`translate(${r[u]},${a[u]})`,children:e(Z,{stnId:u,stnState:i===u?0:1,bank:l[d],direction:o[d]})},u))),n===L.Indoor&&Object.entries(t).map(([d,f])=>f.map((u,x)=>e("g",{transform:`translate(${r[u]},${a[u]})`,children:e(q,{stnId:u,nameDirection:h(d,x),services:[P.local]})},u)))]})},ce=L.RailMap;function ut(){const{canvasScale:s}=N(o=>o.app),{svgWidth:n,svg_height:t,theme:r,loop:a,loop_info:{bank:i}}=N(o=>o.param),l=n[ce];return y(U,{type:ce,svgWidth:l,svgHeight:t,canvasScale:s,theme:r,children:[e(ft,{}),a?e(_e,{bank_angle:i,canvas:L.RailMap}):e(Qe,{}),e(rt,{})]})}const ft=M.exports.memo(function(){return y("defs",{children:[e("circle",{id:"stn_sh",fill:"var(--rmg-white)",strokeWidth:2,r:5}),e("path",{id:"int2_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"express_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"direct_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V50 a 5,5 0 1 1 -10,0Z"}),e("rect",{id:"stn_sh_2020",stroke:"none",height:24,width:12,x:-6,y:-18}),e("rect",{id:"stn_sh_2020_express",stroke:"none",height:49,width:12,x:-6,y:-18}),e("rect",{id:"stn_sh_2020_direct",stroke:"none",height:74,width:12,x:-6,y:-18}),e("rect",{id:"intbox_number",height:22,width:20,y:-11}),y("g",{id:"intbox_maglev",transform:"translate(-25,0)",children:[e("rect",{id:"maglev_5",height:144,width:130,y:"40",x:"30",strokeWidth:10}),e("path",{id:"maglev_3",fill:"var(--rmg-white)",d:"m90,55a40,5 0 0 0 -40,3a5,5 0 0 0 -5,5a5,60 0 0 0 -3,60a5,5 0 0 0 5,5l96,0a5,5 0 0 0 5,-5a5,60 0 0 0 -3,-60a5,5 0 0 0 -5,-5a40,5 0 0 0 -40,-3l-5,-10l-5,10"}),e("path",{id:"maglev_4",fill:"var(--rmg-white)",d:"m90,140l-40,0a10,5 0 0 1 -10,-5l0,25a10,15 0 0 0 10,15l15,0l0,-10l-15,0l0,-15l90,0l0,15l-15,0l0,10l15,0a10,15 0 0 0 10,-15l0,-25a10,5 0 0 1 -10,5l-50,0"}),e("rect",{id:"maglev_1",height:"25",width:"40",y:"80",x:"50"}),e("rect",{id:"maglev_2",height:"25",width:"40",y:"80",x:"100"})]}),y("g",{id:"airport",transform:"scale(0.5)",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),e("path",{id:"airport",d:"M28.9769,6.60134c1.711.013,3.111,2.53205,3.111,4.241v10.337s17.106,15.435,17.358,15.666a1.145,1.145,0,0,1,.488,1.152v2.833c0,.651-.451.61-.695.467-.334-.119-17.151-8.863-17.151-8.863-.004,1.458-.797,9.006-1.326,13.304,0,0,4.61,2.457,4.699,2.521.334.268.352.359.352.852v2.001c0,.477-.352.428-.51.324-.183-.062-5.693-1.921-5.693-1.921a2.56018,2.56018,0,0,0-.633-.127,2.31654,2.31654,0,0,0-.666.127s-5.477,1.859-5.672,1.921c-.185.104-.523.153-.523-.324v-2.001c0-.493.029-.584.367-.852.086-.064,4.678-2.521,4.678-2.521-.524-4.298-1.307-11.846-1.325-13.304,0,0-16.822,8.744-17.148,8.863-.217.143-.69.184-.69-.467v-2.833a1.16206,1.16206,0,0,1,.473-1.152c.276-.231,17.365-15.666,17.365-15.666v-10.337c0-1.709,1.403-4.228,3.14105-4.241",transform:"translate(-28.9697,0.14347)",fill:"var(--rmg-white)"})]}),y("g",{id:"disney",transform:"scale(0.5)",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),e("path",{fill:"var(--rmg-white)",d:"M45.6152,7.85015a9.80248,9.80248,0,0,0-9.79907,9.801,9.70059,9.70059,0,0,0,.342,2.582c.002.026.002.055.002.093a.31815.31815,0,0,1-.31494.318.67741.67741,0,0,1-.12806-.02,15.71521,15.71521,0,0,0-13.498,0,.61.61,0,0,1-.122.02.31841.31841,0,0,1-.322-.318v-.067a9.62553,9.62553,0,0,0,.35608-2.608,9.803,9.803,0,1,0-9.797,9.8,10.10364,10.10364,0,0,0,2.308-.271h.05493a.31113.31113,0,0,1,.31409.318.32433.32433,0,0,1-.019.12,15.72588,15.72588,0,1,0,29.703,7.216,15.83676,15.83676,0,0,0-1.746-7.23.18417.18417,0,0,1-.0271-.106.31612.31612,0,0,1,.32007-.318h.057a10.15953,10.15953,0,0,0,2.316.271,9.80051,9.80051,0,0,0,0-19.601",transform:"translate(-28.9697 0.13398)"})]}),y("g",{id:"railway",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)",transform:"translate(0,-2)scale(0.5)"}),e("path",{fill:"var(--rmg-white)",d:"M169,273.5c0-19,14.7-34.8,33.7-36.3c18.9-1.5,38.1-2.2,57.4-2.2c19.3,0,38.4,0.8,57.3,2.2  c19,1.5,33.7,17.3,33.7,36.3v47.3l-51.3,14.7c-11.2,3.2-18.9,13.4-18.9,25v147.8c0,17.4,12.2,32.3,29.3,35.7l110.6,22.1  c4.9,1,8.4,5.2,8.4,10.2V599H91v-22.7c0-5,3.5-9.2,8.4-10.2L209.9,544c17-3.4,29.3-18.3,29.3-35.7V360.5c0-11.6-7.7-21.8-18.9-25  L169,320.8V273.5z M309.4,31.7c0.2-1.2,0.3-2.4,0.3-3.6c0-14-11.1-25.4-24.9-26C276.6,1.4,268.3,1,260,1c-8.3,0-16.6,0.4-24.7,1.1  c-13.9,0.6-24.9,12-24.9,26c0,1.2,0.1,2.5,0.3,3.6C90.6,54.8,0,160.3,0,287c0,97.2,53.4,182,132.4,226.6l36.8-48.1  C104.3,432.4,59.8,364.9,59.8,287c0-110.6,89.6-200.2,200.2-200.2S460.2,176.4,460.2,287c0,77.9-44.5,145.4-109.4,178.5  c15,19.6,25.6,33.5,36.8,48.1C466.6,469,520,384.2,520,287C520,160.3,429.4,54.8,309.4,31.7z",transform:"translate(-10,0)scale(0.04)"})]}),e("marker",{id:"arrow_gray",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-grey)"})}),e("marker",{id:"arrow_theme_left",refX:1,refY:.5,children:e("path",{d:"M1,0L0,1H1z",fill:"var(--rmg-theme-colour)"})}),e("marker",{id:"arrow_theme_right",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),e("marker",{id:"arrow_theme",refX:1,refY:.5,children:e("path",{d:"M0,1H2L1,0z",fill:"var(--rmg-theme-colour)"})}),e("filter",{id:"contrast-direct",filterUnits:"userSpaceOnUse",children:y("feComponentTransfer",{children:[e("feFuncR",{type:"linear",slope:.5,intercept:.25}),e("feFuncG",{type:"linear",slope:.5,intercept:.25}),e("feFuncB",{type:"linear",slope:.5,intercept:.25})]})}),e("filter",{id:"contrast-express",filterUnits:"userSpaceOnUse",children:y("feComponentTransfer",{children:[e("feFuncR",{type:"linear",slope:.75,intercept:.125}),e("feFuncG",{type:"linear",slope:.75,intercept:.125}),e("feFuncB",{type:"linear",slope:.75,intercept:.125})]})}),y("filter",{id:"pujiang_outline_railmap",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[y("feComponentTransfer",{in:"SourceGraphic",children:[e("feFuncR",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),e("feFuncG",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),e("feFuncB",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"})]}),e("feColorMatrix",{type:"matrix",values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 1 1 1 1 -3",result:"selectedColor1"}),e("feMorphology",{operator:"erode",in:"selectedColor1",radius:"0",result:"e1"}),e("feMorphology",{operator:"erode",in:"selectedColor1",radius:"1",result:"e2"}),e("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"uncoloredOutline"}),e("feFlood",{floodColor:"rgb(0,0,0)"}),e("feComposite",{operator:"in",in2:"uncoloredOutline",result:"outline"}),e("feComposite",{in:"outline",in2:"selectedColor1",operator:"over",result:"result"}),e("feComposite",{in:"result",in2:"SourceGraphic",operator:"over"})]})]})}),he=L.Indoor;function gt(){const{canvasScale:s}=N(l=>l.app),{svgWidth:n,svg_height:t,theme:r,loop:a}=N(l=>l.param),i=n[he];return y(U,{type:he,svgWidth:i,svgHeight:t,canvasScale:s,theme:r,children:[e(pt,{}),a?e(_e,{bank_angle:!1,canvas:L.Indoor}):e($t,{}),e(St,{})]})}const pt=M.exports.memo(function(){return y("defs",{children:[e("circle",{id:"stn_indoor_sh",fill:"var(--rmg-white)",strokeWidth:5,r:8,transform:"scale(1.5)"}),e("path",{id:"int2_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"express_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"direct_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V40 a 5,5 0 1 1 -10,0Z"})]})}),xt=(s,n)=>{let t=0;return s[n].parents.length===2&&(t+=1),s[s[n].parents[0]].children.length===2&&(t+=1),t},_t=(s,n)=>{let t=0;return s[n].children.length===2&&(t+=1),s[s[n].children[0]].parents.length===2&&(t+=1),t},$t=()=>{const{routes:s,branches:n,depsStr:t}=N(m=>m.helper),r=N(m=>m.param),a=me(r.stn_list,xt,_t),i=Y("linestart","lineend",a),l=Y(i.nodes[1],i.nodes.slice(-2)[0],a),o=M.exports.useMemo(()=>(console.log("computing x shares"),Object.keys(r.stn_list).reduce((m,_)=>({...m,[_]:ue(_,a,n)}),{})),[n.toString(),JSON.stringify(a)]),h=[r.svgWidth.indoor*r.padding/100,r.svgWidth.indoor*(1-r.padding/100)],d=Object.keys(o).reduce((m,_)=>({...m,[_]:h[0]+o[_]/l.len*(h[1]-h[0])}),{}),f=M.exports.useMemo(()=>re.getYShares(r.stn_list,n),[t]),u=Object.keys(f).reduce((m,_)=>({...m,[_]:f[_]*r.branchSpacingPct*r.svg_height/200}),{}),x=M.exports.useMemo(()=>fe(r.current_stn_idx,s,r.direction),[r.current_stn_idx,r.direction,s.toString()]),p=Object.values(P),c=Object.values(r.stn_list).map(m=>m.services).flat().reduce((m,_)=>(m[p.indexOf(_)]=!0,m),[!1,!1,!1]).map((m,_)=>[p[_],m]).filter(m=>m[1]).map(m=>m[0]),g=re.drawLine(n,x,r.stn_list,h,d,u,r.branchSpacingPct*r.svg_height/200,i,0);return y("g",{id:"main",transform:`translate(0,${r.svg_height/2})`,children:[e(vt,{paths:g,services:c}),e(yt,{xs:d,ys:u,services:c})]})},vt=s=>e("g",{fill:"none",strokeWidth:12,stroke:"var(--rmg-theme-colour)",children:s.services.map((n,t)=>y("g",{transform:`translate(0, ${t*30})`,children:[s.paths.main.map((r,a)=>e("path",{d:r},a)),s.paths.pass.map((r,a)=>e("path",{d:r},a))]},`indoor_line_${t}`))}),yt=s=>{const{branches:n}=N(l=>l.helper),t=N(l=>l.param),{xs:r,ys:a,services:i}=s;return e("g",{children:Object.keys(t.stn_list).filter(l=>!["linestart","lineend"].includes(l)).filter(l=>t.stn_list[l].services.length!==0).map(l=>e("g",{transform:`translate(${r[l]},${a[l]})`,children:e(q,{stnId:l,nameDirection:n.filter(o=>o.includes(l)).map(o=>o.indexOf(l)%2===0||i.length>1?"downward":"upward")[0],services:i})},l))})},St=()=>{const s=N(n=>n.param);return M.exports.useMemo(()=>y(O,{children:[e("g",{transform:`translate(${s.svgWidth.indoor/2},50)`,children:y("text",{textAnchor:"middle",fontSize:"30",className:"rmg-name__zh",children:["\u8F68\u9053\u4EA4\u901A",s.line_name[0],"\u8FD0\u8425\u7EBF\u8DEF\u793A\u610F\u56FE"]})}),y("g",{transform:`translate(${s.svgWidth.indoor/2},${s.svg_height-270})`,children:[e("text",{textAnchor:"middle",fontSize:"18",className:"rmg-name__zh",dx:"-30",dy:"230",children:"\u53CB\u60C5\u63D0\u793A\uFF1A\u8BF7\u7559\u610F\u60A8\u9700\u8981\u6362\u4E58\u7EBF\u8DEF\u7684\u9996\u672B\u73ED\u65F6\u95F4\uFF0C\u4EE5\u514D\u803D\u8BEF\u60A8\u7684\u51FA\u884C\uFF0C\u672B\u73ED\u8F66\u8FDB\u7AD9\u524D\u4E09\u5206\u949F\u505C\u552E\u8BE5\u672B\u73ED\u8F66\u8F66\u7968\u3002"}),e("text",{textAnchor:"middle",fontSize:"12",className:"rmg-name__en",dx:"10",dy:"250",children:"Please pay attention to the interchange schedule if you want to transfer to other lines. Stop selling tickets 3 minutes before the last train services."}),y("g",{transform:"translate(-600,215)",children:[e("rect",{x:"-5",y:"-25",width:"100",height:"70",fill:"none",stroke:"black",rx:"5"}),e("line",{x1:"28",x2:"28",y1:"-20",y2:"40",stroke:"black"}),e("text",{className:"rmg-name__zh",dx:"3",fontSize:"18",children:"\u56FE"}),e("text",{className:"rmg-name__zh",dx:"3",dy:"18",fontSize:"18",children:"\u4F8B"}),e("text",{className:"rmg-name__en",dy:"35",fontSize:"8",children:"legend"}),e("use",{transform:"translate(45,10)",xlinkHref:"#int2_indoor_sh",stroke:"var(--rmg-black)"}),e("text",{className:"rmg-name__zh",dx:"60",dy:"10",fontSize:"10",children:"\u6362\u4E58\u7AD9"}),e("text",{className:"rmg-name__en",dx:"60",dy:"20",fontSize:"6",children:"Interchange"}),e("text",{className:"rmg-name__en",dx:"60",dy:"30",fontSize:"6",children:"Station"})]})]})]}),[s.svgWidth.indoor,s.svg_height,s.line_name])},Ht={destination:e(we,{}),runin:e(Ie,{}),railmap:e(ut,{}),indoor:e(gt,{})};export{Ht as default};
