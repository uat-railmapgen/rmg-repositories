!function(){function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n(t)}var t=["nextName"],e=["stnName","oneLine","directionPolarity"],r=["intInfos","direction"],i=["stnName","nameDirection"];function o(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function c(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?o(Object(e),!0).forEach((function(t){a(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):o(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function a(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===n(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(n,t){if(null==n)return{};var e,r,i=function(n,t){if(null==n)return{};var e,r,i={},o=Object.keys(n);for(r=0;r<o.length;r++)e=o[r],t.indexOf(e)>=0||(i[e]=n[e]);return i}(n,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)e=o[r],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}function s(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){var e=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=e){var r,i,o,c,a=[],l=!0,s=!1;try{if(o=(e=e.call(n)).next,0===t){if(Object(e)!==e)return;l=!1}else for(;!(l=(r=o.call(e)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(u){s=!0,i=u}finally{try{if(!l&&null!=e.return&&(c=e.return(),Object(c)!==c))return}finally{if(s)throw i}}return a}}(n,t)||d(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(n){return function(n){if(Array.isArray(n))return f(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(n,t){if(n){if("string"==typeof n)return f(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?f(n,t):void 0}}function f(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}System.register(["./vendor-legacy.c084f2e9.js","./index-legacy.ae3d65fd.js","./app-router-legacy.d74fca69.js","./share-legacy.41c2dc8e.js","./mtr-legacy.43f54163.js"],(function(n,o){"use strict";var d,f,h,m,g,p,v,_,x,y,b,w,S,k,j,M,O;return{setters:[function(n){d=n.z,f=n.l,h=n.j,m=n.ab,g=n.b6},function(n){p=n.ar,v=n.u,_=n.F,x=n.j},function(n){y=n.i},function(n){b=n.S,w=n.e,S=n.a,k=n.c,j=n.g,M=n.b},function(n){O=n.a}],execute:function(){var o=function(n,t,e,r){var i=n.length-2*r-e,o=[].concat(u(n),u(n),u(n)),c=n.length+n.findIndex((function(n){return n===t})),a=o[c+i-1],l=n.length+n.findIndex((function(n){return n===a}))+(c+i>2*n.length?n.length:0);return{top:o.slice(c,l+1),left:o.slice(c-r,c),right:o.slice(l+1,l+1+r),bottom:o.slice(l+1+r,l+1+r+e)}},z=p.Destination;function I(){var n=v((function(n){return n.app})).canvasScale,t=v((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,o=e[z];return h(b,{type:z,svgWidth:o,svgHeight:r,canvasScale:n,theme:i,children:[f(N,{}),f(H,{})]})}var N=d.exports.memo((function(){return f("defs",{children:f("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})})})})),H=function(){var n=v((function(n){return n.helper})),t=n.routes,e=n.branches,r=v((function(n){return n.param})),i=r.line_name,o=r.theme,c=r.current_stn_idx,a=r.direction,l=r.stn_list,d=r.info_panel_type,g=r.loop,p=r.coline,_=function(n,t,e){return u(new Set(n.filter((function(n){return n.includes(e)})).map((function(n){var e=n.filter((function(n){return!["linestart","lineend"].includes(n)}));return"l"===t?e[0]:e.reverse()[0]}))))},x=function(n,t){return t?[[n.map((function(n){return l[n].name[0]})).join("，"),n.map((function(n){return l[n].name[1]})).join(", ")].map((function(n){return n.replace("\\","")}))]:n.map((function(n){return l[n].name.map((function(n){return n.replace("\\","")}))}))},b=g?function(n,t,e,r){var i=n[0].filter((function(n){return!["linestart","lineend"].includes(n)})),o=[].concat(u(i),u(i),u(i)),c="r"===t?o:o.reverse(),a=c.findIndex((function(n){return r===n}))+i.length;return c.slice(a+1).filter((function(n){return e[n].loop_pivot})).slice(void 0,2)}(e,a,l,c):_(t,a,c),w=(g?_(t,a,c):b).filter((function(n){return e.slice(1).filter((function(n){return y(n,l)})).some((function(t){return t.includes(n)}))})),S=x(b.filter((function(n){return!w.includes(n)})),!(g||"sh2020"===d));console.log(S);var k=x(w,!0),j=Object.fromEntries(w.map((function(n){return[n,Object.values(p).filter((function(t){return t.from===n||t.to===n})).at(0)]})).filter((function(n){return s(n,2)[1]})));return h(m,{children:[f(L,{dest_names:S,line_name:i,line_color:[o[2],o[3]],coline:!!w.length,upper:!!w.length}),w.length&&w.map((function(n){var t,e,r;return f("g",{transform:"translate(0,".concat(-250,")"),children:f(L,{dest_names:[k.at(0)],line_name:null===(t=j[n])||void 0===t?void 0:t.colors.at(0).slice(4),line_color:[null===(e=j[n])||void 0===e?void 0:e.colors.at(0)[2],null===(r=j[n])||void 0===r?void 0:r.colors.at(0)[3]],coline:!0,upper:!1})},"coline_".concat(n))}))]})},L=function(n){var t=n.dest_names,e=n.line_name,r=n.line_color,i=n.coline,o=n.upper,c=v((function(n){return n.param})),a=c.current_stn_idx,l=c.direction,u=c.platform_num,m=c.svgWidth,g=c.svg_height,p=d.exports.useRef(null),_=s(d.exports.useState({width:0}),2),x=_[0],y=_[1];d.exports.useEffect((function(){p.current&&y(p.current.getBBox())}),[JSON.stringify(t),JSON.stringify(a)]);var b=m.destination/2,w=b-10-36-x.width>=162.5&&b-10-36-264>=162.5?b:"l"===l?(m.destination+x.width-264)/2:(m.destination-x.width+264)/2;return h("g",{transform:"translate(0,".concat(g-300,")"),children:[f("path",{stroke:r[0],strokeWidth:12,d:"l"===l?"M".concat(m.destination-24,",16 H 36"):"M24,16 H ".concat(m.destination-36),transform:"translate(0,".concat(o?-20:220,")"),markerEnd:i?void 0:"url(#slope)"}),f(W,{ref:p,dest_names:t}),""!==u&&f("g",{transform:"translate(".concat(w,",0)"),children:f(P,{})}),e[0].match(/^[\w\d]+(号)?线/)?f(A,{line_name:e,line_color:r}):f(E,{line_name:e,line_color:r})]})},W=d.exports.forwardRef((function(n,t){var e=n.dest_names,r=v((function(n){return n.param})),i=r.direction,o=r.svgWidth;return h("g",{ref:t,transform:"translate(".concat("l"===i?36:o.destination-36,",145)"),children:[f("g",{transform:"translate(0,".concat(2===e.length?-20:20,")"),children:f("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",fill:"black",transform:"rotate(".concat("l"===i?0:180,")scale(0.8)")})}),f("g",{textAnchor:"l"===i?"start":"end",transform:"translate(".concat("l"===i?148:-148,",25)"),children:e.map((function(n,t){return h(d.exports.Fragment,{children:[f("text",{className:"rmg-name__zh",fontSize:70,dy:-100*t+7,children:"往"+n[0]},"zh".concat(t)),f("text",{className:"rmg-name__en",fontSize:25,dy:-100*t+40,children:"To "+n[1]},"en".concat(t))]},t)}))})]})})),P=function(){var n=v((function(n){return n.param})).platform_num;return d.exports.useMemo((function(){return h("g",{transform:"translate(".concat(-102.5,",150)"),children:[f("circle",{r:60,fill:"none",stroke:"black",strokeWidth:2}),f("text",{className:"rmg-name__en",dominantBaseline:"central",fontSize:120,textAnchor:"middle",children:n}),f("text",{className:"rmg-name__zh",fontSize:100,dominantBaseline:"central",x:65,children:"站台"})]})}),[n])},E=function(n){var t=n.line_name,e=n.line_color,r=v((function(n){return n.param})),i=r.direction,o=r.svgWidth,c="l"===i?o.destination-42:42,a=d.exports.useRef(null),l=s(d.exports.useState({width:0}),2),m=l[0],g=l[1];d.exports.useEffect((function(){a.current&&g(a.current.getBBox())}),u(t));var p=("l"===i?-m.width:0)-6,_=("l"===i?-1:1)*m.width/2;return d.exports.useMemo((function(){return h("g",{transform:"translate(".concat(c,",92)"),children:[f("rect",{fill:e[0],x:p,width:m.width+10,height:120}),h("g",{textAnchor:"r"===i?"start":"end",transform:"translate(0,68)",fill:e[1],children:[f("g",{ref:a,children:f("text",{className:"rmg-name__zh",fontSize:68,children:t[0]})}),f("text",{className:"rmg-name__en",fontSize:30,textAnchor:"middle",x:_,dy:42,children:t[1]})]})]})}),[m].concat(u(t),u(e),[i,o.destination]))},A=function(n){var t=n.line_name,e=n.line_color,r=v((function(n){return n.param})),i=r.direction,o=r.svgWidth,c=s(t[0].match(/^[\w\d]+|.+/g),2),a=c[0],l=c[1],m="l"===i?o.destination-36-210:90;return d.exports.useMemo((function(){return h("g",{transform:"translate(".concat(m,",92)"),children:[f("rect",{fill:e[0],x:-54,width:108,height:120}),f("text",{className:"rmg-name__zh",fill:e[1],fontSize:96,textAnchor:"middle",dominantBaseline:"central",transform:"translate(0,60)",letterSpacing:-5,children:a}),h("g",{textAnchor:"start",transform:"translate(74,68)",children:[f("text",{className:"rmg-name__zh",fontSize:68,children:l}),f("text",{className:"rmg-name__en",fontSize:30,dy:42,children:t[1]})]})]})}),[m].concat(u(t),u(e),[i,o.destination]))},B=function(n,t){return n.map((function(n){var e=t.filter((function(t){return t.includes(n.from)&&t.includes(n.to)}));if(1!==e.length)return{linePath:[],colors:n.colors};var r=e.flat(),i=r.indexOf(n.from),o=r.indexOf(n.to);return{linePath:i<o?r.slice(i,o+1):r.slice(o,i+1),colors:n.colors}})).filter((function(n){return 0!==n.linePath.length}))},R=p.RunIn,C=function(){var n=v((function(n){return n.app})).canvasScale,t=v((function(n){return n.helper})),e=t.branches,r=t.routes,i=t.depsStr,o=v((function(n){return n.param})),c=o.svgWidth,a=o.svg_height,l=o.current_stn_idx,s=o.direction,u=o.loop,m=o.theme,g=c[R],p=a-300,_=d.exports.useMemo((function(){var n=r.filter((function(n){return n.includes(l)})).map((function(n){return n[n.indexOf(l)+("l"===s?1:-1)]})).reduce((function(n,t){return n.includes(t)?n:n.concat(t)}),[]);return u&&e[0].includes(l)&&1===n.length&&["linestart","lineend"].includes(n[0])&&(n="l"===s?[e[0][1]]:[e[0][e[0].length-2]]),n}),[i,l,s,u]),x=d.exports.useMemo((function(){var n=r.filter((function(n){return n.includes(l)})).map((function(n){return n[n.indexOf(l)+("l"===s?-1:1)]})).reduce((function(n,t){return n.includes(t)?n:n.concat(t)}),[]);return u&&e[0].includes(l)&&1===n.length&&["linestart","lineend"].includes(n[0])&&(n="l"===s?[e[0][e[0].length-2]]:[e[0][1]]),n}),[i,l,s,u]);return h(b,{type:R,svgWidth:g,svgHeight:a,canvasScale:n,theme:m,children:[f(D,{}),f("g",{transform:"translate(0,".concat(p,")"),children:f(F,{prevStnIds:_,nextStnIds:x})})]})},D=d.exports.memo((function(){return h("defs",{children:[f("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),h("filter",{id:"pujiang_outline_runin",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[f("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"0",result:"e1"}),f("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"1",result:"e2"}),f("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"outline"}),f("feComposite",{in:"outline",in2:"SourceGraphic",operator:"over",result:"output"})]})]})})),F=function(n){var t=n.prevStnIds,e=n.nextStnIds,r=v((function(n){return n.param})),i=r.info_panel_type,o=r.svgWidth,c=r.stn_list,a=o.runin/2,l=1===e.length&&["linestart","lineend"].includes(e[0]),s=1===t.length&&["linestart","lineend"].includes(t[0]),u=e.map((function(n){return c[n].name})),d=t.map((function(n){return c[n].name})),g=10+(e.length>1?-50*(u[0][0].split("\\").length-1)+-30*(u[0][1].split("\\").length-1):0),p=10+(t.length>1?-50*(d[0][0].split("\\").length-1)+-30*(d[0][1].split("\\").length-1):0);return h(m,{children:[f(G,{prevStnIds:t,nextStnIds:e,nextBranchLineDy:g,prevBranchLineDy:p}),l&&"sh2020"!==i?f(V,{mode:"terminal",prevStnIds:t,nextStnIds:e}):s&&"sh2020"!==i?f(V,{mode:"original",prevStnIds:t,nextStnIds:e}):h(m,{children:[f(Y,{prevStnIds:t,nextStnIds:e}),f("g",{transform:"translate(".concat(a,",160)"),textAnchor:"middle",children:f(T,{})})]}),(s||!l)&&f(Z,{stnIds:n.nextStnIds}),(l||!s)&&f(X,{stnIds:n.prevStnIds})]})},V=function(n){var t,e=n.mode,r=n.prevStnIds,i=n.nextStnIds,o=v((function(n){return n.param})),c=o.current_stn_idx,a=o.theme,l=o.svgWidth,s=o.direction,u=o.coline,d=v((function(n){return n.helper})).branches,g={l:{original:{x:l.runin-36,anchor:"end"},terminal:{x:36,anchor:"start"}},r:{original:{x:36,anchor:"start"},terminal:{x:l.runin-36,anchor:"end"}}},p=B(Object.values(u),d),_="terminal"===e?r:i,x=i.length>1?"var(--rmg-theme-colour)":null!==(t=p.filter((function(n){return n.linePath.includes(c)&&n.linePath.includes(_[0])})).map((function(n){return n.colors[0][2]}))[0])&&void 0!==t?t:"var(--rmg-theme-colour)";return h(m,{children:["original"===e&&f("path",{transform:"translate(0,".concat(u.length?"198":"220",")").concat(u.length?"scale(1,2)":""),stroke:x,strokeWidth:12,d:"l"===s?"M ".concat(l.runin-24,",16 H 36"):"M24,16 H ".concat(l.runin-36),markerEnd:"url(#slope)"}),"terminal"===e&&f("g",{filter:"#999999"===a[2]?"url(#pujiang_outline_runin)":void 0,children:f("path",{transform:"translate(0,".concat(u.length?"198":"220",")").concat(u.length?"scale(1,2)":""),stroke:"var(--rmg-grey)",strokeWidth:12,d:"M24,16 H ".concat(l.runin-24)})}),f("g",{transform:"translate(".concat(g[s][e].x,",160)"),textAnchor:g[s][e].anchor,children:f(T,{})})]})},Y=function(n){var t,e,r,i,o=n.prevStnIds,c=n.nextStnIds,a=v((function(n){return n.param})),l=a.direction,s=a.svgWidth,u=a.theme,d=a.coline,g=a.current_stn_idx,p=a.stn_list,_=v((function(n){return n.helper})).branches,x=s.runin/2,b=function(n){return n.includes("linestart")||n.includes("lineend")},w=B(Object.values(d),_),S=c.length>1?"single":b(c)?w.filter((function(n){return[g,o[0]].every((function(t){return n.linePath.includes(t)}))})).length>0?"multiple":"single":[g,c[0]].every((function(n){return _[0].includes(n)}))&&w.filter((function(n){return[g,c[0]].every((function(t){return n.linePath.includes(t)}))})).length>0?"multiple":"single",k=b(c)?o:c,j=c.length>1?"var(--rmg-theme-colour)":null!==(t=w.filter((function(n){return n.linePath.includes(g)&&n.linePath.includes(k[0])})).map((function(n){return n.colors[0][2]}))[0])&&void 0!==t?t:"var(--rmg-theme-colour)",M=Object.keys(d).length>0&&(e=g,r=c,i=p,_.slice(1).filter((function(n){return[e,r[0]].every((function(t){return n.includes(t)}))})).filter((function(n){return y(n,i)})).length>0)?j:"var(--rmg-theme-colour)",O=Object.keys(d).length>0&&1===c.length&&(!(!b(o)&&!b(c))||!([g,c[0]].every((function(n){return _[0].includes(n)}))&&0!==w.filter((function(n){return n.linePath.includes(g)&&n.linePath.includes(c[0])})).length)),z=Object.keys(d).length>0&&1===o.length;return h("g",{transform:"translate(0,220)",strokeWidth:12,children:[h(m,{children:["var(--rmg-theme-colour)"!==M&&f("marker",{id:"slope_".concat(M),viewBox:"-1.5 0 3 1.5",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:M})}),f("path",{stroke:M,d:"M ".concat(x,",16 H ").concat("l"===l?36:s.runin-36),markerEnd:"var(--rmg-theme-colour)"===M?"url(#slope)":"url(#slope_".concat(M,")"),transform:O?"translate(0,-22)scale(1,2)":void 0})]}),"multiple"===S&&h(m,{children:[f("marker",{id:"slope_".concat(j),viewBox:"-1.5 0 3 1.5",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:j})}),f("path",{stroke:j,d:"M ".concat(x,",16 H ").concat("l"===l?48:s.runin-48),markerEnd:"url(#slope_".concat(j,")"),transform:"translate(0,-12)"})]}),f("g",{filter:"#999999"===u[2]?"url(#pujiang_outline_runin)":void 0,transform:"translate(0,".concat(z?-22:0,")scale(1,").concat(z?2:1,")"),children:f("path",{stroke:"var(--rmg-grey)",d:"M ".concat(x,",16 H ").concat("l"===l?s.runin-24:24," ")})})]})},G=function(n){var t=n.prevStnIds,e=n.nextStnIds,r=n.nextBranchLineDy,i=n.prevBranchLineDy,o=v((function(n){return n.param})),c=o.direction,a=o.svgWidth,l=o.current_stn_idx,s=o.coline,u=o.theme,d=v((function(n){return n.helper})).branches,m=a.runin/2,g=125,p=function(n){return"".concat(n[0],",").concat(n[1])},_=function(n){return"M".concat(p(n.at(0))," ")+n.slice(1).map((function(n){return"L".concat(p(n))})).join(" ")},x="l"===c?[[a.runin/3,g],[a.runin/6,r],[36,r]]:[[a.runin/3*2,g],[a.runin/6*5,r],[a.runin-36,r]],y="l"===c?[[a.runin/3*2,g],[a.runin/6*5,i],[a.runin-24,i]]:[[a.runin/3,g],[a.runin/6,i],[24,i]],b="var(--rmg-theme-colour)";if(Object.keys(s).length>0){var w=B(Object.values(s),d);e.length>1&&w.filter((function(n){return n.linePath.includes(l)&&e.some((function(t){return n.linePath.includes(t)}))}))&&(x[0][1]-=11,x.unshift([m,114]),b=w.filter((function(n){return n.linePath.includes(l)&&e.some((function(t){return n.linePath.includes(t)}))})).at(0).colors.at(0)[2]),t.length>1&&w.filter((function(n){return n.linePath.includes(l)&&t.some((function(t){return n.linePath.includes(t)}))}))&&(y[0][1]-=11,y.unshift([m,114]))}return h("g",{transform:"translate(0,110)",strokeWidth:12,fill:"none",filter:"#999999"===u[2]?"url(#pujiang_outline_runin)":void 0,children:[f("marker",{id:"slope_branch",viewBox:"-1.5 0 3 1.5",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:b})}),e.length>1&&f("path",{stroke:b,d:_(x),markerEnd:"url(#slope_branch)"}),t.length>1&&f("path",{stroke:"var(--rmg-grey)",d:_(y)})]})},T=function(){var n=v((function(n){return n.param})),t=n.stn_list[n.current_stn_idx].name;return d.exports.useMemo((function(){return h(m,{children:[f("text",{className:"rmg-name__zh",fontSize:112,children:t[0].replace("\\","")}),f("text",{className:"rmg-name__en",fontSize:36,dy:50,children:t[1].replace("\\","")})]})}),u(t))},U=function(n){var e=n.nextName,r=l(n,t);return f("g",c(c({},r),{},{children:d.exports.useMemo((function(){return h(m,{children:[e[0].split("\\").map((function(n,t,r){return f("text",{className:"rmg-name__zh",fontSize:48,dy:-50*(r.length-1-t)-30*(e[1].split("\\").length-1),children:n},n)})),e[1].split("\\").map((function(n,t,e){return f("text",{className:"rmg-name__en",fontSize:24,dy:28+-30*(e.length-1-t),children:n},n)}))]})}),u(e))}))},X=function(n){var t=v((function(n){return n.param})),e=n.stnIds.map((function(n){return t.stn_list[n].name})),r=(n.stnIds.length>1?15:125)+-50*e.map((function(n){return n[0].split("\\").length})).reduce((function(n,t){return n+t}),-e.length)+-30*e.map((function(n){return n[1].split("\\").length})).reduce((function(n,t){return n+t}),-e.length),i=70+(n.stnIds.length>1?-50*(e[0][0].split("\\").length-1)+-30*(e[0][1].split("\\").length-1):0);return h("g",{fill:"gray",textAnchor:"l"===t.direction?"end":"start",transform:"translate(".concat("l"===t.direction?t.svgWidth.runin-36:36,",0)"),children:[f(U,{nextName:e[0],transform:"translate(0,183)"}),n.stnIds.length>1&&f(U,{nextName:e[1],transform:"translate(0,".concat(i,")")}),h("g",{transform:"translate(0, ".concat(r,")"),children:[f("text",{className:"rmg-name__zh",fontSize:22,children:"上一站"}),f("text",{className:"rmg-name__en",fontSize:12,dx:"l"===t.direction?-70:70,children:"Past Stop"})]})]})},Z=function(n){var t=v((function(n){return n.param})),e=n.stnIds.map((function(n){return t.stn_list[n].name})),r=(n.stnIds.length>1?15:125)+-50*e.map((function(n){return n[0].split("\\").length})).reduce((function(n,t){return n+t}),-e.length)+-30*e.map((function(n){return n[1].split("\\").length})).reduce((function(n,t){return n+t}),-e.length),i=70+(n.stnIds.length>1?-50*(e[0][0].split("\\").length-1)+-30*(e[0][1].split("\\").length-1):0);return h("g",{textAnchor:"l"===t.direction?"start":"end",transform:"translate(".concat("l"===t.direction?36:t.svgWidth.runin-36,",0)"),children:[f(U,{nextName:t.stn_list[n.stnIds[0]].name,transform:"translate(0,183)"}),n.stnIds.length>1&&f(U,{nextName:t.stn_list[n.stnIds[1]].name,transform:"translate(0,".concat(i,")")}),h("g",{transform:"translate(0, ".concat(r,")"),children:[f("text",{className:"rmg-name__zh",fontSize:22,children:"下一站"}),f("text",{className:"rmg-name__en",fontSize:12,dx:"l"===t.direction?70:-70,children:"Next Stop"})]})]})},J=function(n){var t,e=n.stnId,r=n.stnState,i=n.color,o=n.bank,a=n.direction,l=v((function(n){return n.param})),s=l.direction,d=l.info_panel_type,g=l.stn_list,p=l.loop,_=g[e],x=null!=a?a:s,y=p?0:([].concat(u(_.branch.left),u(_.branch.right)).length?8+12*_.name[1].split("\\").length:0)*("r"===x?-1:1),b={};"sh2020"===d?(t=3===_.services.length?"stn_sh_2020_direct":2===_.services.length?"stn_sh_2020_express":"stn_sh_2020",b.fill=-1===r?"gray":i||"var(--rmg-theme-colour)"):(t=3===_.services.length?"direct_sh":2===_.services.length?"express_sh":[].concat(u(_.transfer.info[0]),u(_.transfer.info[1]||[])).length>0?"int2_sh":"stn_sh",b.stroke=-1===r?"gray":i||"var(--rmg-theme-colour)");var w=null!=o?o:0,S=("l"===x?6:-6)+y+30*w,k=("sh2020"===d?-20:-6)+Math.abs(w)*("sh2020"===d?25:11),j=w?0:"l"===x?-45:45;return h(m,{children:[f("use",c(c({xlinkHref:"#".concat(t)},b),{},{transform:"translate(".concat(w*("sh2020"===d?5:0),",0)rotate(").concat(90*w*("sh2020"===d?1:-1),")")})),f("g",{transform:"translate(".concat(S,",").concat(k,")rotate(").concat(j,")"),children:f($,{name:_.name,infos:_.transfer.info,stnState:r,direction:x,facility:_.facility,bank:w,oneLine:_.one_line,intPadding:_.int_padding})}),0===r?f(K,{}):void 0]})},$=function(n){var t,e=n.name,r=n.infos,i=n.stnState,o=n.direction,c=n.facility,a=n.bank,l=n.oneLine,g=n.intPadding,p=d.exports.useRef(null),v="l"===o?1:-1,x=c!==_.none?30:0,y=a?-12:0,b=d.exports.useRef(null),w=s(d.exports.useState(0),2),S=w[0],k=w[1];d.exports.useEffect((function(){var n,t;return k(null!==(n=null===(t=b.current)||void 0===t?void 0:t.getBBox().width)&&void 0!==n?n:0)}),u(JSON.stringify(r)));var j=g-S;return h(m,{children:[r.flat().length>0&&h(m,{children:[f("line",{x1:(y+x)*v,x2:j*v,stroke:-1===i?"gray":"black",strokeWidth:.5}),f(Q,{ref:b,intInfos:r,direction:o,transform:"translate(".concat(j*v,",-10.75)")})]}),c!==_.none&&f("use",{xlinkHref:"#"+c,x:10*v,y:-30}),h("g",{textAnchor:"l"===o?"start":"end",transform:"translate(".concat(x*v,",-14)"),children:[f(q,{ref:p,stnName:e,oneLine:l,directionPolarity:v,fill:-1===i?"gray":0===i?"red":"black"}),(null===(t=r[1])||void 0===t?void 0:t.length)>0&&f("g",{transform:"translate(".concat((j+S/2)*v,",-30)"),children:f(rn,{osiInfos:r[1]})}),u(r[2]||[]).length>0&&f("g",{transform:"translate(".concat((g+5)*v,",0)"),children:f(on,{osysiInfos:r[2],direction:n.direction})})]})]})},q=d.exports.forwardRef((function(n,t){var r=n.stnName,i=n.oneLine,o=n.directionPolarity,a=l(n,e),g=d.exports.useRef(null),p=s(d.exports.useState(0),2),v=p[0],_=p[1];d.exports.useEffect((function(){i&&g.current?_(g.current.getBBox().width+5):_(0)}),[].concat(u(r),[i]));return f("g",c(c({ref:t},a),{},{children:d.exports.useMemo((function(){return h(m,{children:[f("g",{ref:g,children:r[0].split("\\").map((function(n,t,e){return f("text",{className:"rmg-name__zh rmg-outline",dy:-20*(e.length-1-t)+(i?8:-8*(r[1].split("\\").length-1)),children:n},t)}))}),f("g",{fontSize:8,transform:"translate(".concat(v*o,",0)"),children:r[1].split("\\").map((function(n,t,e){return f("text",{className:"rmg-name__en rmg-outline",dy:-8*(e.length-2-t)+2,children:n},t)}))})]})}),[].concat(u(r),[i,v,o]))}))})),K=function(){var n=v((function(n){return n.param})).stn_list,t=[-1,35,50,75][new Set(Object.values(n).map((function(n){return n.services})).flat()).size];return f("g",{transform:"translate(0, ".concat(t,")"),children:f("text",{className:"rmg-name__zh",fill:"red",textAnchor:"middle",children:"本站"})})},Q=d.exports.forwardRef((function(n,t){var e,i=n.intInfos,o=(n.direction,l(n,r)),a=[].concat(u(i[0]),u(i[1]||[]),u((null===(e=i[2])||void 0===e?void 0:e.filter((function(n){return Boolean(n[4].match(/^磁(悬)*浮/))})))||[])),s=0;return f("g",c(c({ref:t,fontSize:14,textAnchor:"middle"},o),{},{children:a.map((function(t,e){var r,i=Boolean(t[4].match(/^\w+(号)?线/)),o=Boolean(t[4].match(/^磁(悬)*浮/));return"r"===n.direction&&(s-=(i||o?20:14*t[4].length+12)+(0===e?0:5)),r=f("g",o?{transform:"translate(".concat(s,",-16)scale(0.1428571429)"),children:f(nn,{info:t})}:i?{transform:"translate(".concat(s,",0)"),children:f(tn,{info:t})}:{transform:"translate(".concat(s,",0)"),children:f(en,{info:t})},e),"l"===n.direction&&(s+=i||o?25:14*t[4].length+12+5),r}))}))})),nn=d.exports.memo((function(n){return f(m,{children:f("use",{xlinkHref:"#intbox_maglev",fill:n.info[2],stroke:n.info[2]})})}),(function(n,t){return n.info.toString()===t.info.toString()})),tn=d.exports.memo((function(n){var t;return h(m,{children:[f("use",{xlinkHref:"#intbox_number",fill:n.info[2]}),f("text",{x:10,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:null===(t=n.info[4].match(/(\d*)\w+/))||void 0===t?void 0:t[0]})]})}),(function(n,t){return n.info.toString()===t.info.toString()})),en=d.exports.memo((function(n){var t=n.info[4].split("\\")[0].length;return h(m,{children:[f("rect",{height:22,width:14*t+12,y:-11,fill:n.info[2]}),f("text",{x:7*t+6,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].split("\\")[0]})]})}),(function(n,t){return n.info.toString()===t.info.toString()})),rn=function(n){var t=n.osiInfos.map((function(n){return n[4]})).join("，");return d.exports.useMemo((function(){return h("g",{textAnchor:"middle",fontSize:"50%",children:[f("text",{className:"rmg-name__zh",dy:-5,children:"换乘".concat(t)}),f("text",{className:"rmg-name__zh",dy:5,children:"仅限公共交通卡"}),f("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]})}),[t.toString()])},on=function(n){var t=n.osysiInfos.map((function(n){return n[4]})).join("，"),e=n.osysiInfos.map((function(n){return n[5]})).join(", ");return d.exports.useMemo((function(){return h("g",{textAnchor:"l"===n.direction?"start":"end",fontSize:"50%",children:[h("text",{className:"rmg-name__zh",dy:3,children:["转乘",t]}),h("text",{className:"rmg-name__en",dy:10,fontSize:"75%",children:["To ",e]})]})}),[n.osysiInfos.toString(),n.direction])},cn=["shanghai","sh4","#5F259F","#fff","4号线","Line 4"],an=function(n){var t=n.xs,e=n.servicesPresent,r=n.stnStates,i=v((function(n){return n.param})),o=i.svg_height,l=i.direction,g=i.stn_list,p=i.current_stn_idx,_=i.branchSpacingPct,x=i.info_panel_type,y=i.coline,b=v((function(n){return n.helper})),S=b.branches,k=b.depsStr,j=d.exports.useMemo((function(){return console.log("computing y shares"),Object.keys(g).reduce((function(n,t){if(S[0].includes(t))return c(c({},n),{},a({},t,0));var e=S.slice(1).filter((function(n){return n.includes(t)}))[0];return c(c({},n),{},a({},t,g[e[0]].children.indexOf(e[1])?-3:3))}),{})}),[k]),M=Object.entries(j).filter((function(n){var t=s(n,2);t[0];return t[1]<=0})).reduce((function(n,t){var e=s(t,2),r=e[0],i=e[1];return c(c({},n),{},a({},r,i))}),{}),O=Object.keys(M).reduce((function(n,t){return c(c({},n),{},a({},t,-M[t]*_*o/300))}),{}),z=d.exports.useMemo((function(){return function(n,t){return n.map((function(n){var e=w(n.linePath,t);return{main:[{linePath:e.main,colors:n.colors}],pass:[{linePath:e.pass,colors:n.colors}]}})).reduce((function(n,t){return n.main=[].concat(u(n.main),u(t.main)),n.pass=[].concat(u(n.pass),u(t.pass)),n}),{main:[],pass:[]})}(B(Object.values(y).filter((function(n){return n.display})),S),r)}),[JSON.stringify(y),p,l,k]),I=e.reduce((function(n,r){return c(c({},n),{},a({},r,Object.keys(z).reduce((function(n,i){return c(c({},n),{},a({},i,z[i].map((function(n){return{path:hn(n.linePath,i,t,O,l,r,e.length,g,"diagonal"),colors:n.colors}})).filter((function(n){return""!==n.path}))))}),{})))}),{}),N=B(Object.values(y).filter((function(n){return n.display})),S).map((function(n){return n.linePath})).flat(),H="sh2020"===x?3:0;return f(m,{children:h("g",{id:"coline",transform:"translate(0,".concat(12+H,")"),children:[f(ln,{paths:I,direction:l}),f(sn,{colineStns:z,branches:S,xs:t,ys:O,stnStates:r,lineWidth:12,colineGap:H}),f(un,{stnIds:Object.entries(j).filter((function(n){var t=s(n,2);t[0];return t[1]<0})).reduce((function(n,t){var e=s(t,2),r=e[0];e[1];return[].concat(u(n),[r])}),[]).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==g[n].services.length})).filter((function(n){return N.includes(n)})),xs:t,ys:O,stnStates:r})]})})},ln=function(n){var t=n.paths,e=n.direction;return f(m,{children:Object.keys(t).map((function(n,r){var i,o;return f("g",{transform:"translate(0,".concat(25*r,")"),children:h("g",{children:[null===(i=t[n])||void 0===i?void 0:i.pass.map((function(t,e){return f(d.exports.Fragment,{children:f("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:t.path,strokeLinejoin:"round",filter:n===x.local?void 0:"url(#contrast-".concat(n,")")},e)},e)})),null===(o=t[n])||void 0===o?void 0:o.main.map((function(t,r){var i;return h(d.exports.Fragment,{children:[t.colors.length>1&&f("linearGradient",{id:"grad".concat(r),y1:"-100%",y2:"100%",x1:"0",x2:"0",gradientUnits:"userSpaceOnUse",children:t.colors.map((function(n,e){return h(d.exports.Fragment,{children:[f("stop",{offset:"".concat(100/t.colors.length*(e+0),"%"),stopColor:n[2]}),f("stop",{offset:"".concat(100/t.colors.length*(e+1),"%"),stopColor:n[2]})]},e)}))}),"l"===e&&f("marker",{id:"arrow_left_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_")),refY:.5,refX:1,children:f("path",{d:"M1,0L0,1H1z",fill:t.colors.length>1?"url(#grad".concat(r,")"):t.colors[0][2]})}),"r"===e&&f("marker",{id:"arrow_right_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_")),refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:t.colors.length>1?"url(#grad".concat(r,")"):t.colors[0][2]})}),f("path",{stroke:(null!==(i=t.colors.at(-1))&&void 0!==i?i:cn)[2],strokeWidth:12,fill:"none",d:t.path,markerStart:"l"===e?"url(#arrow_left_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_"),")"):void 0,markerEnd:"r"===e?"url(#arrow_right_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_"),")"):void 0,strokeLinejoin:"round",filter:n===x.local?void 0:"url(#contrast-".concat(n,")")},r)]},r)}))]})},"servicePath".concat(r))}))})},sn=function(n){var t=n.colineStns,e=n.branches,r=n.xs,i=n.ys,o=n.stnStates,c=n.lineWidth,a=n.colineGap,l=v((function(n){return n.param})),s=l.line_name,d=l.theme,h=l.info_panel_type,m=[].concat(u(t.main),u(t.pass)).map((function(n){return n.linePath.map((function(t){var e;return{curStn:t,x:r[t],y:i[t],color:null!==(e=n.colors.at(-1))&&void 0!==e?e:[].concat(u(d),u(s))}}))})).flat().reduce((function(n,t){return n.find((function(n){return n.curStn===t.curStn}))?n:n.concat(t)}),[]).filter((function(n){return e[0].includes(n.curStn)}));return console.log(m),f("g",{id:"stations_in_mainline",children:m.map((function(n){var t=n.curStn,e=n.x,r=n.y,i=n.color,l=(-1===o[t]?0:c)+a+c,s=(-1===o[t]?0:-c)-a-c/2;return f("g",{transform:"translate(".concat(e,",").concat(r,")"),children:"sh2020"===h?f("rect",{stroke:"none",height:l,width:12,x:-6,y:s,fill:-1===o[t]?"var(--rmg-grey)":i[2]}):f("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:"translate(0,".concat(-c,")")})},t)}))})},un=function(n){var t=n.xs,e=n.ys,r=n.stnStates,i=n.stnIds,o=v((function(n){return n.helper})),l=o.branches,s=o.depsStr,h=v((function(n){return n.param})),m=h.line_name,g=h.theme,p=h.coline,_=d.exports.useMemo((function(){return B(Object.values(p),l)}),[JSON.stringify(p),s]),x=i.reduce((function(n,t){var e;return c(c({},n),{},a({},t,null!==(e=_.filter((function(n){return n.linePath.includes(t)})).map((function(n){return n.colors})).flat().at(0))&&void 0!==e?e:[].concat(u(g),u(m))))}),{});return f("g",{id:"stations_in_coline",children:i.map((function(n){return f("g",{transform:"translate(".concat(t[n],",").concat(e[n],")"),children:f(J,{stnId:n,stnState:r[n],color:x[n][2]})},n)}))})},dn=function(){var n=v((function(n){return n.helper})),t=n.routes,e=n.branches,r=n.depsStr,i=v((function(n){return n.param})),o=v((function(n){return n.param})),l=o.svg_height,u=o.stn_list,m=o.branchSpacingPct,g=o.coline,p=o.direction,_=S(i.stn_list,(function(){return 0}),(function(){return 0})),y=k("linestart","lineend",_),b=k(y.nodes[1],y.nodes.slice(-2)[0],_),O=d.exports.useMemo((function(){return console.log("computing x shares"),Object.keys(i.stn_list).reduce((function(n,t){return c(c({},n),{},a({},t,j(t,_,e)))}),{})}),[e.toString(),JSON.stringify(_)]),z=[i.svgWidth.railmap*i.padding/100,i.svgWidth.railmap*(1-i.padding/100)],I=Object.keys(O).reduce((function(n,t){return c(c({},n),{},a({},t,z[0]+O[t]/b.len*(z[1]-z[0])))}),{}),N=d.exports.useMemo((function(){return console.log("computing y shares"),Object.keys(u).reduce((function(n,t){if(e[0].includes(t))return c(c({},n),{},a({},t,0));var r=e.slice(1).filter((function(n){return n.includes(t)}))[0];return c(c({},n),{},a({},t,u[r[0]].children.indexOf(r[1])?-3:3))}),{})}),[r]),H=Object.entries(N).filter((function(n){return s(n,2)[1]>=0})).reduce((function(n,t){var e=s(t,2),r=e[0],i=e[1];return c(c({},n),{},a({},r,i))}),{}),L=Object.keys(H).reduce((function(n,t){return c(c({},n),{},a({},t,-H[t]*m*l/300))}),{}),W=d.exports.useMemo((function(){return M(i.current_stn_idx,t,i.direction)}),[i.current_stn_idx,i.direction,t.toString()]),P=Object.values(x),E=Object.values(i.stn_list).map((function(n){return n.services})).flat().reduce((function(n,t){return n[P.indexOf(t)]=!0,n}),[!1,!1,!1]).map((function(n,t){return[P[t],n]})).filter((function(n){return n[1]})).map((function(n){return n[0]})),A=e.map((function(n){return w(n,W)})).reduce((function(n,t){return n.main.push(t.main),n.pass.push(t.pass),n}),{main:[],pass:[]}),B=E.reduce((function(n,t){return c(c({},n),{},a({},t,Object.keys(A).reduce((function(n,e){return c(c({},n),{},a({},e,A[e].map((function(n){return hn(n,e,I,L,p,t,E.length,u)})).filter((function(n){return""!==n}))))}),{})))}),{});return h("g",{id:"main",transform:"translate(0,".concat(i.svg_height*(Object.keys(g).length>0?.5:.7+.1),")"),children:[f(fn,{paths:B,direction:i.direction}),f(mn,{stnIds:Object.keys(H).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==u[n].services.length})),xs:I,ys:L,stnStates:W}),Object.keys(g).length>0&&f(an,{xs:I,servicesPresent:E,stnStates:W}),E.length>1&&f(gn,{servicesLevel:E,lineXs:z})]})},fn=function(n){var t=v((function(n){return n.param})).theme,e=n.paths,r=n.direction;return f(m,{children:Object.keys(e).map((function(i,o){var c,a;return h("g",{transform:"translate(0,".concat(25*o,")"),filter:"#999999"===t[2]?"url(#pujiang_outline_railmap)":void 0,children:[f("g",{children:null===(c=e[i])||void 0===c?void 0:c.pass.map((function(t,e){return f("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:t,markerStart:"l"===n.direction?"url(#arrow_gray)":void 0,markerEnd:"r"===n.direction?"url(#arrow_gray)":void 0,strokeLinejoin:"round"},e)}))}),f("g",{children:null===(a=e[i])||void 0===a?void 0:a.main.map((function(n,t){return f("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:n,markerStart:"l"===r?"url(#arrow_theme_left)":void 0,markerEnd:"r"===r?"url(#arrow_theme_right)":void 0,strokeLinejoin:"round",filter:i===x.local?void 0:"url(#contrast-".concat(i,")")},t)}))})]},"servicePath".concat(o))}))})},hn=function(n,t,e,r,i,o,c,a){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"rightangle",u=[],d=u[0],f=u[1],h={},m={local:0,express:20,direct:40}[o],g=c>1?50:0,p=30;if(n.length>0){var v=!1,_=!1;a[n.at(-1)||0].children.some((function(n){return["linestart","lineend"].includes(n)}))?_=!0:a[n.at(0)||0].parents.some((function(n){return["linestart","lineend"].includes(n)}))&&(v=!0),p=v||_?p:0}var x=30;if(n.forEach((function(n){var t=e[n],i=r[n];if(!d&&0!==d)return f=t,d=i,void(h.start=[t,i]);0===i?i!==d&&(h.bifurcate=[f,d]):i!==d&&(h.bifurcate=[t,i]),h.end=[t,i],f=t,d=i})),"start"in h){if("end"in h){if("bifurcate"in h){var y=s(h.start,2),b=y[0],w=y[1],S=h.bifurcate[0],k=s(h.end,2),j=k[0],M=k[1];return"main"===t?"l"===i?M>w?(console.log(h),"rightangle"===l?"M ".concat(b-p,",").concat(w," H ").concat(j," V ").concat(M):"M ".concat(b,",").concat(w," H ").concat(b+x," L ").concat(S-x,",").concat(M," H ").concat(j)):"rightangle"===l?"M ".concat(b,",").concat(w," V ").concat(M," H ").concat(j):"M ".concat(b-p,",").concat(w," H ").concat(S+x," L ").concat(j-x,",").concat(M," H ").concat(j):M>w?"rightangle"===l?"M ".concat(b,",").concat(w," H ").concat(j," V ").concat(M):"M ".concat(b,",").concat(w," H ").concat(b+x," L ").concat(S-x,",").concat(M," H ").concat(j+p):"rightangle"===l?"M ".concat(b,",").concat(w," V ").concat(M," H ").concat(j+p):"M ".concat(b,",").concat(w," H ").concat(S+x," L ").concat(j-x,",").concat(M," H ").concat(j):M>w?"rightangle"===l?"M ".concat(b-p,",").concat(w," H ").concat(j," V ").concat(M):"M ".concat(b,",").concat(w," H ").concat(b+x," L ").concat(S-x,",").concat(M," H ").concat(j+p):"rightangle"===l?"M ".concat(b,",").concat(w," V ").concat(M," H ").concat(j+p):"M ".concat(b-p,",").concat(w," H ").concat(S+x," L ").concat(j-x,",").concat(M," H ").concat(j)}var O=s(h.start,2),z=O[0],I=O[1],N=h.end[0];return"main"===t?"l"===i?"M ".concat(z-p-m,",").concat(I," H ").concat(N):"M ".concat(z,",").concat(I," H ").concat(N+p+m):"l"===i?"M ".concat(z-p,",").concat(I," H ").concat(N+p+g):"M ".concat(z-p-g,",").concat(I," H ").concat(N+p)}var H=s(h.start,2),L=H[0],W=H[1];return"main"===t?"l"===i?"M ".concat(L-p-m,",").concat(W," H ").concat(L):"M ".concat(L,",").concat(W," H ").concat(L+p+m):"l"===i?"M ".concat(L,",").concat(W," L ").concat(L+p+g,",").concat(W):"M ".concat(L-p-g,",").concat(W," L ").concat(L,",").concat(W)}return""},mn=function(n){var t=n.xs,e=n.ys,r=n.stnStates,i=n.stnIds;return f("g",{children:i.map((function(n){return f("g",{transform:"translate(".concat(t[n],",").concat(e[n],")"),children:f(J,{stnId:n,stnState:r[n]})},n)}))})},gn=function(n){var t=v((function(n){return n.param})),e=t.svg_height,r=t.direction,i=t.svgWidth,o=130-e,c=n.servicesLevel.map((function(n){return{local:"普通车",express:"大站车",direct:"直达车"}[n]})),a="r"===r?n.lineXs[0]-42:n.lineXs[1]+42,l=2===n.servicesLevel.length?350:500;return d.exports.useMemo((function(){return h("g",{children:[c.map((function(n,t){return h("g",{transform:"translate(".concat(a,",").concat(25*t,")"),children:[f("rect",{x:-27.5,height:10,width:55,fill:"white",stroke:"black",y:-5}),f("text",{className:"rmg-name__zh",fontSize:9,y:3,textAnchor:"middle",children:"".concat(n,"运行线")})]},n)})),h("g",{transform:"translate(".concat("r"===r?30:i.railmap-l,",").concat(o,")"),children:[f("text",{className:"rmg-name__zh",children:"图例："}),c.map((function(n,t){return h("g",{transform:"translate(".concat(150*t+50,",0)"),children:[f("line",{x1:"0",x2:"35",y1:"-5",y2:"-5",stroke:"var(--rmg-theme-colour)",strokeWidth:"12",filter:2===t?"url(#contrast-direct)":1===t?"url(#contrast-express)":""}),f("use",{x:"17.5",y:"-5",xlinkHref:"#stn_sh",fill:"var(--rmg-theme-colour)"}),f("text",{x:"40",className:"rmg-name__zh",children:"".concat(n,"停靠站")})]},"serviceLevel".concat(t))}))]})]})}),[e,r,i,n.servicesLevel,n.lineXs])},pn=function(){var n=v((function(n){return n.param})),t=n.direction,e=n.svgWidth,r=n.coline,i=!!Object.keys(r).length;return d.exports.useMemo((function(){return h("g",{transform:"translate(".concat("l"===t?50:e.railmap-150,",50)"),children:[f("text",{className:"rmg-name__zh",children:"列车前进方向"}),f("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",stroke:i?"var(--rmg-black)":void 0,strokeWidth:i?5:void 0,fill:i?"var(--rmg-white)":"var(--rmg-theme-colour)",transform:"translate(".concat("l"===t?-30:125,",-5)rotate(").concat("l"===t?0:180,")scale(0.15)")})]})}),[t,r,e.railmap])},vn=function(n){var t,e=n.stnId,r=n.nameDirection,i=n.services,o=n.color,c=v((function(n){return n.param.stn_list[e]})),a=[].concat(u(c.transfer.info[0]),u(c.transfer.info[1]||[]));t=3===c.services.length?"direct_indoor_sh":2===c.services.length?"express_indoor_sh":a.length>0?"int2_indoor_sh":"stn_indoor_sh";var l="left"===r||"right"===r?90:0;return h(m,{children:[f(_n,{name:c.name,infos:c.transfer.info,nameDirection:r,services:i}),f("use",{xlinkHref:"#".concat(t),stroke:a.length>0?"var(--rmg-black)":null!=o?o:"var(--rmg-theme-colour)",transform:"rotate(".concat(l,")")}),c.services.length>1&&f("text",{className:"rmg-name__zh",writingMode:"tb",fontSize:"60%",dy:"-12",children:"大站车".concat(c.services.length>2?" 直达车":"","停靠")})]})},_n=function(n){var t,e,r,i,o,c,a,l,s=n.name,d=n.infos,g=n.nameDirection,p=n.services,v={upward:60,downward:-30,left:0,right:0}[g],_={upward:0,downward:0,left:85,right:-85}[g],x={upward:-185,downward:150+(3===p.length?40:0),left:-30,right:-30}[g],y=(null===(t=d[2])||void 0===t?void 0:t.length)>0?{upward:0,downward:0,left:d[0].length+d[1].length!==0?85:25,right:d[0].length+d[1].length!==0?-85:-25}[g]:0,b=(null===(e=d[2])||void 0===e?void 0:e.length)>0?{upward:null!==(r=d[1])&&void 0!==r&&r.length?-210:d[0].length?-180:-100,downward:(null!==(i=d[1])&&void 0!==i&&i.length?190:d[0].length?160:100)+(3===p.length?40:0),left:null!==(o=d[1])&&void 0!==o&&o.length?-60:d[0].length?-30:0,right:null!==(c=d[1])&&void 0!==c&&c.length?-60:d[0].length?-30:0}[g]:0;return h("g",{transform:"translate(0,".concat(v,")"),children:[h(m,"upward"===g||"downward"===g?{children:[f("line",{x1:-30,x2:30,y1:"upward"===g?-23:-10,y2:"upward"===g?-23:-10,stroke:"black"}),f("line",{y1:"upward"===g?-23:-10,y2:"upward"===g?-48:20,stroke:"black"})]}:{children:[f("line",{x1:"left"===g?-50:15,x2:"left"===g?-15:50,y1:0,y2:0,stroke:"black"}),f("line",{x1:"left"===g?-50:50,x2:"left"===g?-50:50,y1:-30,y2:30,stroke:"black"})]}),[].concat(u(d[0]),u(d[1]||[])).length>0&&f(yn,{intInfos:[].concat(u(d[0]),u(d[1]||[])),arrowDirection:g,services:p}),f(xn,{stnName:s,nameDirection:g,fill:"black"}),(null===(a=d[1])||void 0===a?void 0:a.length)>0&&f("g",{transform:"translate(".concat(_,",").concat(x,")"),children:f(bn,{osiInfos:d[1],nameDirection:g})}),(null===(l=d[2])||void 0===l?void 0:l.length)>0&&f("g",{transform:"translate(".concat(y,",").concat(b,")"),children:f(wn,{osysiInfos:d[2],nameDirection:g})})]})},xn=d.exports.forwardRef((function(n,t){var e=n.stnName,r=n.nameDirection,o=l(n,i),a=e[0].split("\\"),s=e[1].split("\\").length,g={upward:0,downward:0,left:-60,right:60}[r],p={upward:-2,downward:-30-12*(s-1),left:-10*(s-1),right:-10*(s-1)}[r],v={upward:"middle",downward:"middle",left:"end",right:"start"}[r];return f("g",c(c({ref:t},o),{},{textAnchor:v,transform:"translate(".concat(g,",").concat(p,")"),children:d.exports.useMemo((function(){return h(m,{children:[a.map((function(n,t,e){return f("text",{className:"rmg-name__zh",dy:"upward"===r?16*t:-16*(e.length-1-t),children:n},t)})),f("g",{fontSize:9.6,children:e[1].split("\\").map((function(n,t){return f("text",{className:"rmg-name__en",dy:12*(t+1)+("upward"===r&&a.length>1?7.5*a.length:0),children:n},t)}))})]})}),u(e))}))})),yn=function(n){var t=n.intInfos,e=n.arrowDirection,r=n.services,i=t.map((function(n){return n[2]})).reduce((function(n,t){return n+t}),""),o=[t.filter((function(n){return n[4].match(/^\d+.*$/)})).map((function(n){return n[4].replace(/^(\d+)(.*)$/,"$1")})).join("，").concat("号线"),t.filter((function(n){return!n[4].match(/^\d+.*$/)})).map((function(n){return n[4]})).join("，")].filter((function(n){return n&&"号线"!==n})).join("，"),c=["Line ".concat(t.filter((function(n){return n[5].match(/^(L|l)ine$/)})).map((function(n){return n[5].replace("Line","").replace("line","").trim()})).join(",")),t.filter((function(n){return!n[5].match(/^(L|l)ine$/)})).map((function(n){return n[5]})).join("，")].filter((function(n){return n&&"Line "!==n})).join(","),a=3===r.length?80:45,l={upward:-145,downward:125+(3===r.length?40:0),left:7,right:7}[e],s={upward:-74,downward:44,left:0,right:0}[e],u={upward:0,downward:180,left:90,right:-90}[e],g={upward:0,downward:0,left:85,right:-85}[e],p={upward:"middle",downward:"middle",left:"start",right:"end"}[e];return h("g",{children:[f("path",{id:"int_indoor_arrow_sh",stroke:"var(--rmg-black)",strokeWidth:1,transform:"translate(".concat({upward:0,downward:0,left:20,right:-20}[e],",").concat(s,")rotate(").concat(u,")"),fill:1===t.length?t[0][2]:"url(#grad".concat(i,")"),d:"M -7.5,0 v -".concat(a," h -7.5 l 15,-15 l 15,15 h -7.5 v ").concat(a," Z")}),t.length>1&&f(m,{children:f("linearGradient",{id:"grad".concat(i),y1:"0",y2:"0",x1:"upward"===e?"25%":"75%",x2:"upward"===e?"75%":"25%",children:t.map((function(n,e){return h(d.exports.Fragment,{children:[f("stop",{offset:"".concat(100/t.length*e,"%"),stopColor:n[2]}),f("stop",{offset:"".concat(100/t.length*(e+1),"%"),stopColor:n[2]})]},e)}))})}),h("g",{transform:"translate(".concat(g,",").concat(l,")"),textAnchor:"".concat(p),children:[f("text",{className:"rmg-name__zh",dy:-7,children:"换乘".concat(o)}),f("text",{className:"rmg-name__en",dy:5,fontSize:9.6,children:"Interchange ".concat(c)})]})]})},bn=function(n){var t={upward:"middle",downward:"middle",left:"start",right:"end"}[n.nameDirection];return d.exports.useMemo((function(){return h("g",{textAnchor:"".concat(t),fontSize:"50%",children:[f("text",{className:"rmg-name__zh",dy:-5,children:"换乘".concat(n.osiInfos.map((function(n){return n[4]})).join("，"))}),f("text",{className:"rmg-name__zh",dy:5,children:"仅限公共交通卡"}),f("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]})}),[n.osiInfos.toString(),n.nameDirection])},wn=function(n){var t={upward:"middle",downward:"middle",left:"start",right:"end"}[n.nameDirection];return d.exports.useMemo((function(){return h("g",{textAnchor:"".concat(t),children:[f("text",{className:"rmg-name__zh",dy:-5,children:"转乘".concat(n.osysiInfos.map((function(n){return n[4]})).join("，"))}),f("text",{className:"rmg-name__en",dy:7.5,fontSize:9.6,children:"To ".concat(n.osysiInfos.map((function(n){return n[5]})).join(", "))})]})}),[n.osysiInfos.toString(),n.nameDirection])},Sn=function(n){var t,e,r,i,o=n.loop_branches,c=n.edges,a=n.xs,l=n.ys,u=n.canvas,d=s(c,4),_=d[0],y=d[1],b=d[2],w=(d[3],v((function(n){return n.helper})).branches),S=v((function(n){return n.param})),k=S.current_stn_idx,j=S.direction,M=S.coline,O=u===p.RailMap?30:0,z=["M ".concat(_,",").concat(b," H ").concat(Number(a[null!==(t=null===(e=o.at(0))||void 0===e?void 0:e.at(0))&&void 0!==t?t:""])-O),"M ".concat(y,",").concat(b," H ").concat(Number(a[null!==(r=null===(i=o.at(1))||void 0===i?void 0:i.at(-1))&&void 0!==r?r:""])+O)],I=w[0].filter((function(n){return!["linestart","lineend"].includes(n)})),N=Object.values(M).filter((function(n){return![n.from,n.to].every((function(n){return I.includes(n)}))})).map((function(n){return n.colors}));return f(m,{children:o.map((function(n,t){var e,r,i;return h(g.Fragment,{children:[N.filter((function(n,t,e){return t===e.findIndex((function(t){var e,r;return(null===(e=t.at(0))||void 0===e?void 0:e.at(2))===(null===(r=n.at(0))||void 0===r?void 0:r.at(2))}))})).map((function(n){return f("marker",{id:"arrow_theme_".concat(n[0][2]),refX:1,refY:.5,children:f("path",{d:"M0,1H2L1,0z",fill:n[0][2]})},n[0][2])})),f("path",{stroke:null!==(e=null===(r=N.at(t))||void 0===r||null===(i=r.at(0))||void 0===i?void 0:i.at(2))&&void 0!==e?e:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:z[t],markerEnd:u===p.RailMap&&("l"===j&&0===t||"r"===j&&1===t)?N.at(t)?"url(#arrow_theme_".concat(N[t][0][2],")"):"url(#arrow_theme)":void 0}),n.filter((function(n){return!["linestart","lineend"].includes(n)})).map((function(n){var e,r,i,c;return h(g.Fragment,{children:[u===p.RailMap&&f("g",{transform:"translate(".concat(a[n],",").concat(l[n],")"),children:f(J,{stnId:n,stnState:k===n?0:1,bank:0,direction:j,color:null===(e=N.at(t))||void 0===e||null===(r=e.at(0))||void 0===r?void 0:r.at(2)})},n),u===p.Indoor&&f("g",{transform:"translate(".concat(a[n],",").concat(l[n],")"),children:f(vn,{stnId:n,nameDirection:o.filter((function(t){return t.includes(n)})).map((function(t){return t.indexOf(n)%2==0?"downward":"upward"}))[0],services:[x.local],color:null===(i=N.at(t))||void 0===i||null===(c=i.at(0))||void 0===c?void 0:c.at(2)})},n)]},n)}))]},n.at(0))}))})},kn=function(n){var t,e=n.edges,r=n.loop_stns,i=n.xs,o=n.ys,c=n.canvas,a=s(e,4),l=a[0],u=a[1],d=a[2],g=(a[3],v((function(n){return n.param}))),_=g.info_panel_type,x=g.stn_list,b=g.coline,w=v((function(n){return n.helper})).branches,S=Object.values(b).filter((function(n){return[n.from,n.to].every((function(n){return w.slice(1,3).filter((function(n){return y(n,x)})).flat().includes(n)}))})).map((function(n){return n.colors})).at(0),k=c===p.RailMap&&"sh2020"===_?3:0;return h("g",{id:"coline_main",children:[f("path",{d:"M ".concat(l,",").concat(d," H").concat(u),strokeWidth:12,stroke:null==S||null===(t=S.at(0))||void 0===t?void 0:t.at(2)}),c===p.RailMap&&Object.keys(b).length>0&&r.top.map((function(n){var t;return f("g",{transform:"translate(".concat(i[n],",").concat(o[n],")"),children:"sh2020"===_?h(m,{children:[f("rect",{stroke:"none",height:24,width:12,x:-6,y:-k-1,fill:null==S||null===(t=S.at(0))||void 0===t?void 0:t.at(2)}),f("rect",{stroke:"none",height:k+12,width:12,x:-6,y:10,fill:"var(--rmg-theme-colour)"})]}):f("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:"translate(0,".concat(13,")")})},n)}))]})},jn=function(n){var t,e,r=n.bank_angle,i=n.canvas,l=v((function(n){return n.helper})).branches,d=v((function(n){return n.param})),m=d.current_stn_idx,g=d.svgWidth,_=d.svg_height,x=d.padding,b=d.branchSpacingPct,w=d.direction,S=d.info_panel_type,k=d.stn_list,j=d.loop_info,M=j.left_and_right_factor,O=j.bottom_factor,z=d.coline,I=l[0].filter((function(n){return!["linestart","lineend"].includes(n)})),N=l.slice(0,3).flat().filter((e={},function(n){return 2===(e[n]=(e[n]||0)+1)})).filter((function(n){return!["linestart","lineend"].includes(n)})),H=null!==(t=Object.values(z).filter((function(n){return[n.from,n.to].every((function(n){return l.slice(1,3).filter((function(n){return y(n,k)})).flat().includes(n)}))})).map((function(n){var t=I.findIndex((function(t){return t===n.from})),e=I.findIndex((function(t){return t===n.to}));return Math.abs(e-t)>I.length-2-Math.abs(e-t)?"major":"minor"})).at(0))&&void 0!==t?t:"minor",L=N.at(1)?function(n,t,e,r){var i=n.findIndex((function(n){return n===t[0]})),c=n.findIndex((function(n){return n===t[1]})),a=s(i>c?[c,i,t[1],t[0]]:[i,c,t[0],t[1]],4);i=a[0],c=a[1],t[0]=a[2],t[1]=a[3];var l=n.slice(i,c+1),u=n.filter((function(n){return!l.filter((function(n){return!t.includes(n)})).includes(n)})),d=n.length-("major"===r?Math.max:Math.min)(l.length,u.length)-2*e,f="major"===r?l.length>u.length?t[0]:t[1]:l.length>u.length?t[1]:t[0];return o(n,f,d,e)}(I,N,M,H):N.at(0)?o(I,N[0],O,M):function(n,t,e,r){var i=n.length-2*r-e,o=n.findIndex((function(n){return n===t})),c=[].concat(u(n),u(n),u(n)),a=n.length+o-Math.floor(i/2)+(i%2==0?1:0),l=n.length+o+Math.floor(i/2);return{top:c.slice(a,l+1),left:c.slice(a-r,a),right:c.slice(l+1,l+1+r),bottom:c.slice(l+1+r,l+1+r+e)}}(I,m,O,M),W=function(n,t){var e=Object.fromEntries(n.map((function(n){return[n,-1]}))),r=Object.fromEntries(n.map((function(n){return[n,-1]})));return t.top.forEach((function(n,i){e[n]=0+1/(t.top.length+1)*(i+1),r[n]=0})),t.right.forEach((function(n,i){e[n]=1,r[n]=0+1/(t.right.length+1)*(i+1)})),t.bottom.forEach((function(n,i){e[n]=1-1/(t.bottom.length+1)*(i+1),r[n]=1})),t.left.forEach((function(n,i){e[n]=0,r[n]=1-1/(t.left.length+1)*(i+1)})),{x_shares:e,y_shares:r}}(I,L),P=W.x_shares,E=W.y_shares,A=function(n,t,e,r,i,o){var a,l,s,d,f=n[0].filter((function(n){return!["linestart","lineend"].includes(n)})),h=n.slice(1,3).map((function(n){return n.slice(1,n.length-1)})),m=h.reduce((function(n,e){return n+e.filter((function(n){return!["linestart","lineend"].concat(u(t)).includes(n)})).length}),0)+f.length-o-2*i,g=(e-e*r/100*2)/(1+m),p=[e*r/100+(null!==(a=h.at(0))&&void 0!==a?a:[]).length*g,e*(1-r/100)-(null!==(l=h.at(1))&&void 0!==l?l:[]).length*g],v=c(c({},Object.fromEntries((null!==(s=h.at(0))&&void 0!==s?s:[]).map((function(n,t){return[n,e*r/100+t*g]})))),Object.fromEntries((null!==(d=h.at(1))&&void 0!==d?d:[]).map((function(n,t){return[n,p[1]+(1+t)*g]}))));return{loop_branches:h,line_xs_branches:p,xs_branches:v}}(l,N,g[i],x,M,L.bottom.length),B=A.loop_branches,R=A.line_xs_branches,C=A.xs_branches,D=c(c({},E),Object.fromEntries(B.flat().map((function(n){return[n,0]})))),F=b*_/300,V=[225+F,_-75-(i===p.RailMap?0:125)-F],Y=Object.keys(D).reduce((function(n,t){return c(c({},n),{},a({},t,V[0]+D[t]*(V[1]-V[0])))}),{}),G=[Math.max(g[i]*x/100+(r&&i===p.RailMap?100:0),R[0]),Math.min(g[i]*(1-x/100)-(r&&i===p.RailMap?100:0),R[1])],T=Object.keys(P).reduce((function(n,t){return c(c({},n),{},a({},t,G[0]+P[t]*(G[1]-G[0])))}),{}),U=r?{l:1,r:-1}[w]:0;[].concat(u(L.right),u(L.left)).forEach((function(n){T[n]-=(Y[n]-V[0])*U})),L.bottom.forEach((function(n){T[n]-=(V[1]-V[0])*U}));var X=c(c({},C),T),Z=Mn(L,X,Y,U,[].concat(G,V),w),J=i===p.RailMap&&"sh2020"===S?3:0;Object.keys(z).length>0&&L.top.forEach((function(n){Y[n]-=J+12}));var $=B.length?0:(V[1]-V[0])*U/2;return h("g",{id:"loop",transform:"translate(".concat($,",0)"),children:[f("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:Z,strokeLinejoin:"round"}),i===p.RailMap&&f(On,{canvas:i,loop_stns:L,xs:X,ys:Y}),h("g",{transform:"translate(0,".concat(Object.keys(z).length>0?-12-J:0,")"),children:[f(Sn,{loop_branches:B,edges:[].concat(G,V),xs:X,ys:Y,canvas:i}),Object.keys(z).length>0&&f(kn,{edges:[].concat(G,V),loop_stns:L,xs:X,ys:Y,canvas:i})]}),i===p.Indoor&&f(On,{canvas:i,loop_stns:L,xs:X,ys:Y})]})},Mn=function(n,t,e,r,i,o){var c=s(i,4),a=c[0],l=c[1],u=c[2],d=c[3],f=function(n,t,e,i,o){return{right:[e+(i-u)*r,t],bottom:[n-(d-t)*r,i],left:[e-(d-i)*r,t],top:[n+(t-u)*r,i]}[o]},h=[];n.top.forEach((function(n){h.push([t[n],e[n]])})),["right","bottom","left"].forEach((function(i){if(n[i].length>0)h.push(f(h.at(-1)[0],h.at(-1)[1],t[n[i][0]],e[n[i][0]],i)),n[i].forEach((function(n){h.push([t[n],e[n]])}));else{var c={right:[l,h.at(-1)[1]],bottom:[h.at(-1)[0]+(d-h.at(-1)[1])*-r,h.at(-1)[1]+(d-h.at(-1)[1])],left:[a+(0===r?0:(d-u)*("l"===o?-1:1)),h.at(-1)[1]]};h.push(c[i])}})),h.push(f(h.at(-1)[0],h.at(-1)[1],t[n.top[0]],e[n.top[0]],"top"));var m=h.slice(1).map((function(n){var t=s(n,2),e=t[0],r=t[1];return"L".concat(e,",").concat(r," ")})).join(" ");return"M".concat(h[0][0],",").concat(h[0][1]," ").concat(m," Z")},On=function(n){var t=n.canvas,e=n.loop_stns,r=n.xs,i=n.ys,o=v((function(n){return n.param})).current_stn_idx,c={top:0,bottom:0,left:-1,right:1},a={left:"r",right:"l",top:void 0,bottom:void 0},l=function(n,t){return{top:t%2==0?"upward":"downward",bottom:t%2==0?"upward":"downward",left:"left",right:"right"}[n]};return h("g",{id:"loop_stations",children:[t===p.RailMap&&Object.entries(e).map((function(n){var t=s(n,2),e=t[0];return t[1].map((function(n){return f("g",{transform:"translate(".concat(r[n],",").concat(i[n],")"),children:f(J,{stnId:n,stnState:o===n?0:1,bank:c[e],direction:a[e]})},n)}))})),t===p.Indoor&&Object.entries(e).map((function(n){var t=s(n,2),e=t[0];return t[1].map((function(n,t){return f("g",{transform:"translate(".concat(r[n],",").concat(i[n],")"),children:f(vn,{stnId:n,nameDirection:l(e,t),services:[x.local]})},n)}))}))]})},zn=p.RailMap;function In(){var n=v((function(n){return n.app})).canvasScale,t=v((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,o=t.loop,c=t.loop_info.bank,a=e[zn];return h(b,{type:zn,svgWidth:a,svgHeight:r,canvasScale:n,theme:i,children:[f(Nn,{}),o?f(jn,{bank_angle:c,canvas:p.RailMap}):f(dn,{}),f(pn,{})]})}var Nn=d.exports.memo((function(){return h("defs",{children:[f("circle",{id:"stn_sh",fill:"var(--rmg-white)",strokeWidth:2,r:5}),f("path",{id:"int2_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),f("path",{id:"express_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),f("path",{id:"direct_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V50 a 5,5 0 1 1 -10,0Z"}),f("rect",{id:"stn_sh_2020",stroke:"none",height:24,width:12,x:-6,y:-18}),f("rect",{id:"stn_sh_2020_express",stroke:"none",height:49,width:12,x:-6,y:-18}),f("rect",{id:"stn_sh_2020_direct",stroke:"none",height:74,width:12,x:-6,y:-18}),f("rect",{id:"intbox_number",height:22,width:20,y:-11}),h("g",{id:"intbox_maglev",transform:"translate(-25,0)",children:[f("rect",{id:"maglev_5",height:144,width:130,y:"40",x:"30",strokeWidth:10}),f("path",{id:"maglev_3",fill:"var(--rmg-white)",d:"m90,55a40,5 0 0 0 -40,3a5,5 0 0 0 -5,5a5,60 0 0 0 -3,60a5,5 0 0 0 5,5l96,0a5,5 0 0 0 5,-5a5,60 0 0 0 -3,-60a5,5 0 0 0 -5,-5a40,5 0 0 0 -40,-3l-5,-10l-5,10"}),f("path",{id:"maglev_4",fill:"var(--rmg-white)",d:"m90,140l-40,0a10,5 0 0 1 -10,-5l0,25a10,15 0 0 0 10,15l15,0l0,-10l-15,0l0,-15l90,0l0,15l-15,0l0,10l15,0a10,15 0 0 0 10,-15l0,-25a10,5 0 0 1 -10,5l-50,0"}),f("rect",{id:"maglev_1",height:"25",width:"40",y:"80",x:"50"}),f("rect",{id:"maglev_2",height:"25",width:"40",y:"80",x:"100"})]}),h("g",{id:"airport",transform:"scale(0.5)",children:[f("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),f("path",{id:"airport",d:"M28.9769,6.60134c1.711.013,3.111,2.53205,3.111,4.241v10.337s17.106,15.435,17.358,15.666a1.145,1.145,0,0,1,.488,1.152v2.833c0,.651-.451.61-.695.467-.334-.119-17.151-8.863-17.151-8.863-.004,1.458-.797,9.006-1.326,13.304,0,0,4.61,2.457,4.699,2.521.334.268.352.359.352.852v2.001c0,.477-.352.428-.51.324-.183-.062-5.693-1.921-5.693-1.921a2.56018,2.56018,0,0,0-.633-.127,2.31654,2.31654,0,0,0-.666.127s-5.477,1.859-5.672,1.921c-.185.104-.523.153-.523-.324v-2.001c0-.493.029-.584.367-.852.086-.064,4.678-2.521,4.678-2.521-.524-4.298-1.307-11.846-1.325-13.304,0,0-16.822,8.744-17.148,8.863-.217.143-.69.184-.69-.467v-2.833a1.16206,1.16206,0,0,1,.473-1.152c.276-.231,17.365-15.666,17.365-15.666v-10.337c0-1.709,1.403-4.228,3.14105-4.241",transform:"translate(-28.9697,0.14347)",fill:"var(--rmg-white)"})]}),h("g",{id:"disney",transform:"scale(0.5)",children:[f("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),f("path",{fill:"var(--rmg-white)",d:"M45.6152,7.85015a9.80248,9.80248,0,0,0-9.79907,9.801,9.70059,9.70059,0,0,0,.342,2.582c.002.026.002.055.002.093a.31815.31815,0,0,1-.31494.318.67741.67741,0,0,1-.12806-.02,15.71521,15.71521,0,0,0-13.498,0,.61.61,0,0,1-.122.02.31841.31841,0,0,1-.322-.318v-.067a9.62553,9.62553,0,0,0,.35608-2.608,9.803,9.803,0,1,0-9.797,9.8,10.10364,10.10364,0,0,0,2.308-.271h.05493a.31113.31113,0,0,1,.31409.318.32433.32433,0,0,1-.019.12,15.72588,15.72588,0,1,0,29.703,7.216,15.83676,15.83676,0,0,0-1.746-7.23.18417.18417,0,0,1-.0271-.106.31612.31612,0,0,1,.32007-.318h.057a10.15953,10.15953,0,0,0,2.316.271,9.80051,9.80051,0,0,0,0-19.601",transform:"translate(-28.9697 0.13398)"})]}),h("g",{id:"railway",children:[f("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)",transform:"translate(0,-2)scale(0.5)"}),f("path",{fill:"var(--rmg-white)",d:"M169,273.5c0-19,14.7-34.8,33.7-36.3c18.9-1.5,38.1-2.2,57.4-2.2c19.3,0,38.4,0.8,57.3,2.2  c19,1.5,33.7,17.3,33.7,36.3v47.3l-51.3,14.7c-11.2,3.2-18.9,13.4-18.9,25v147.8c0,17.4,12.2,32.3,29.3,35.7l110.6,22.1  c4.9,1,8.4,5.2,8.4,10.2V599H91v-22.7c0-5,3.5-9.2,8.4-10.2L209.9,544c17-3.4,29.3-18.3,29.3-35.7V360.5c0-11.6-7.7-21.8-18.9-25  L169,320.8V273.5z M309.4,31.7c0.2-1.2,0.3-2.4,0.3-3.6c0-14-11.1-25.4-24.9-26C276.6,1.4,268.3,1,260,1c-8.3,0-16.6,0.4-24.7,1.1  c-13.9,0.6-24.9,12-24.9,26c0,1.2,0.1,2.5,0.3,3.6C90.6,54.8,0,160.3,0,287c0,97.2,53.4,182,132.4,226.6l36.8-48.1  C104.3,432.4,59.8,364.9,59.8,287c0-110.6,89.6-200.2,200.2-200.2S460.2,176.4,460.2,287c0,77.9-44.5,145.4-109.4,178.5  c15,19.6,25.6,33.5,36.8,48.1C466.6,469,520,384.2,520,287C520,160.3,429.4,54.8,309.4,31.7z",transform:"translate(-10,0)scale(0.04)"})]}),f("marker",{id:"arrow_gray",viewBox:"-1.5 0 3 1.5",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-grey)"})}),f("marker",{id:"arrow_theme_left",refX:1,refY:.5,children:f("path",{d:"M1,0L0,1H1z",fill:"var(--rmg-theme-colour)"})}),f("marker",{id:"arrow_theme_right",refY:.5,children:f("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),f("marker",{id:"arrow_theme",refX:1,refY:.5,children:f("path",{d:"M0,1H2L1,0z",fill:"var(--rmg-theme-colour)"})}),f("filter",{id:"contrast-direct",filterUnits:"userSpaceOnUse",children:h("feComponentTransfer",{children:[f("feFuncR",{type:"linear",slope:.5,intercept:.25}),f("feFuncG",{type:"linear",slope:.5,intercept:.25}),f("feFuncB",{type:"linear",slope:.5,intercept:.25})]})}),f("filter",{id:"contrast-express",filterUnits:"userSpaceOnUse",children:h("feComponentTransfer",{children:[f("feFuncR",{type:"linear",slope:.75,intercept:.125}),f("feFuncG",{type:"linear",slope:.75,intercept:.125}),f("feFuncB",{type:"linear",slope:.75,intercept:.125})]})}),h("filter",{id:"pujiang_outline_railmap",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[h("feComponentTransfer",{in:"SourceGraphic",children:[f("feFuncR",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),f("feFuncG",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),f("feFuncB",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"})]}),f("feColorMatrix",{type:"matrix",values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 1 1 1 1 -3",result:"selectedColor1"}),f("feMorphology",{operator:"erode",in:"selectedColor1",radius:"0",result:"e1"}),f("feMorphology",{operator:"erode",in:"selectedColor1",radius:"1",result:"e2"}),f("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"uncoloredOutline"}),f("feFlood",{floodColor:"rgb(0,0,0)"}),f("feComposite",{operator:"in",in2:"uncoloredOutline",result:"outline"}),f("feComposite",{in:"outline",in2:"selectedColor1",operator:"over",result:"result"}),f("feComposite",{in:"result",in2:"SourceGraphic",operator:"over"})]})]})})),Hn=p.Indoor;function Ln(){var n=v((function(n){return n.app})).canvasScale,t=v((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,o=t.loop,c=e[Hn];return h(b,{type:Hn,svgWidth:c,svgHeight:r,canvasScale:n,theme:i,children:[f(Wn,{}),o?f(jn,{bank_angle:!1,canvas:p.Indoor}):f(An,{}),f(Cn,{})]})}var Wn=d.exports.memo((function(){return h("defs",{children:[f("circle",{id:"stn_indoor_sh",fill:"var(--rmg-white)",strokeWidth:5,r:8,transform:"scale(1.5)"}),f("path",{id:"int2_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),f("path",{id:"express_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),f("path",{id:"direct_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V40 a 5,5 0 1 1 -10,0Z"})]})})),Pn=function(n,t){var e=0;return 2===n[t].parents.length&&(e+=1),2===n[n[t].parents[0]].children.length&&(e+=1),e},En=function(n,t){var e=0;return 2===n[t].children.length&&(e+=1),2===n[n[t].children[0]].parents.length&&(e+=1),e},An=function(){var n=v((function(n){return n.helper})),t=n.routes,e=n.branches,r=n.depsStr,i=v((function(n){return n.param})),o=S(i.stn_list,Pn,En),l=k("linestart","lineend",o),s=k(l.nodes[1],l.nodes.slice(-2)[0],o),u=d.exports.useMemo((function(){return console.log("computing x shares"),Object.keys(i.stn_list).reduce((function(n,t){return c(c({},n),{},a({},t,j(t,o,e)))}),{})}),[e.toString(),JSON.stringify(o)]),m=[i.svgWidth.indoor*i.padding/100,i.svgWidth.indoor*(1-i.padding/100)],g=Object.keys(u).reduce((function(n,t){return c(c({},n),{},a({},t,m[0]+u[t]/s.len*(m[1]-m[0])))}),{}),p=d.exports.useMemo((function(){return O.getYShares(i.stn_list,e)}),[r]),_=Object.keys(p).reduce((function(n,t){return c(c({},n),{},a({},t,p[t]*i.branchSpacingPct*i.svg_height/200))}),{}),y=d.exports.useMemo((function(){return M(i.current_stn_idx,t,i.direction)}),[i.current_stn_idx,i.direction,t.toString()]),b=Object.values(x),w=Object.values(i.stn_list).map((function(n){return n.services})).flat().reduce((function(n,t){return n[b.indexOf(t)]=!0,n}),[!1,!1,!1]).map((function(n,t){return[b[t],n]})).filter((function(n){return n[1]})).map((function(n){return n[0]})),z=O.drawLine(e,y,i.stn_list,m,g,_,i.branchSpacingPct*i.svg_height/200,l,0);return h("g",{id:"main",transform:"translate(0,".concat(i.svg_height/2,")"),children:[f(Bn,{paths:z,services:w}),f(Rn,{xs:g,ys:_,services:w})]})},Bn=function(n){return f("g",{fill:"none",strokeWidth:12,stroke:"var(--rmg-theme-colour)",children:n.services.map((function(t,e){return h("g",{transform:"translate(0, ".concat(30*e,")"),children:[n.paths.main.map((function(n,t){return f("path",{d:n},t)})),n.paths.pass.map((function(n,t){return f("path",{d:n},t)}))]},"indoor_line_".concat(e))}))})},Rn=function(n){var t=v((function(n){return n.helper})).branches,e=v((function(n){return n.param})),r=n.xs,i=n.ys,o=n.services;return f("g",{children:Object.keys(e.stn_list).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==e.stn_list[n].services.length})).map((function(n){return f("g",{transform:"translate(".concat(r[n],",").concat(i[n],")"),children:f(vn,{stnId:n,nameDirection:t.filter((function(t){return t.includes(n)})).map((function(t){return t.indexOf(n)%2==0||o.length>1?"downward":"upward"}))[0],services:o})},n)}))})},Cn=function(){var n=v((function(n){return n.param}));return d.exports.useMemo((function(){return h(m,{children:[f("g",{transform:"translate(".concat(n.svgWidth.indoor/2,",50)"),children:h("text",{textAnchor:"middle",fontSize:"30",className:"rmg-name__zh",children:["轨道交通",n.line_name[0],"运营线路示意图"]})}),h("g",{transform:"translate(".concat(n.svgWidth.indoor/2,",").concat(n.svg_height-270,")"),children:[f("text",{textAnchor:"middle",fontSize:"18",className:"rmg-name__zh",dx:"-30",dy:"230",children:"友情提示：请留意您需要换乘线路的首末班时间，以免耽误您的出行，末班车进站前三分钟停售该末班车车票。"}),f("text",{textAnchor:"middle",fontSize:"12",className:"rmg-name__en",dx:"10",dy:"250",children:"Please pay attention to the interchange schedule if you want to transfer to other lines. Stop selling tickets 3 minutes before the last train services."}),h("g",{transform:"translate(-600,215)",children:[f("rect",{x:"-5",y:"-25",width:"100",height:"70",fill:"none",stroke:"black",rx:"5"}),f("line",{x1:"28",x2:"28",y1:"-20",y2:"40",stroke:"black"}),f("text",{className:"rmg-name__zh",dx:"3",fontSize:"18",children:"图"}),f("text",{className:"rmg-name__zh",dx:"3",dy:"18",fontSize:"18",children:"例"}),f("text",{className:"rmg-name__en",dy:"35",fontSize:"8",children:"legend"}),f("use",{transform:"translate(45,10)",xlinkHref:"#int2_indoor_sh",stroke:"var(--rmg-black)"}),f("text",{className:"rmg-name__zh",dx:"60",dy:"10",fontSize:"10",children:"换乘站"}),f("text",{className:"rmg-name__en",dx:"60",dy:"20",fontSize:"6",children:"Interchange"}),f("text",{className:"rmg-name__en",dx:"60",dy:"30",fontSize:"6",children:"Station"})]})]})]})}),[n.svgWidth.indoor,n.svg_height,n.line_name])};n("default",{destination:f(I,{}),runin:f(C,{}),railmap:f(In,{}),indoor:f(Ln,{})})}}}))}();
