!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t=["num","inStrip"],n=["stnName","onUpdate","passed"],r=["passed"],a=["intInfos","stnState","tickRotation"],s=["intInfos","tickRotation","stnState"],i=["destIds","textAnchor"],c=["destIds"],o=["secName"],l=["num"];function u(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,s,i,c=[],o=!0,l=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=s.call(n)).done)&&(c.push(r.value),c.length!==t);o=!0);}catch(u){l=!0,a=u}finally{try{if(!o&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return c}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(t,n,r){return(n=function(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,n||"default");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"===e(n)?n:String(n)}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}System.register(["./chakra-legacy-eeb88485.js","./react-legacy-125cc24e.js","./index-legacy-d7f72788.js","./share-legacy-ce19fd18.js","./param-updater-utils-legacy-0358cd50.js"],(function(e,d){"use strict";var f,h,j,y,v,S,_,N,z,b,w,O,k,B,A;return{setters:[function(e){f=e.j},function(e){h=e.r},function(e){j=e.i,y=e.ba,v=e.u,S=e.x,_=e.S,N=e.b8,z=e.a3},function(e){b=e.a,w=e.c,O=e.b,k=e.d,B=e.S},function(e){A=e.i}],execute:function(){function d(e){var n=e.num,r=e.inStrip,a=p(e,t);return f.jsxs("g",x(x({textAnchor:"middle",fill:r?j.black:"var(--rmg-theme-fg)"},a),{},{children:[f.jsx("rect",{height:40,width:40,rx:4,x:-20,fill:r?"#fff":"var(--rmg-theme-colour)"}),f.jsx("text",{className:"rmg-name__en",fontSize:20,dy:12,children:n}),f.jsx("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"屏蔽门"}),f.jsx("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]}))}var R=function(e){var t=function(e){switch(e){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":return 20;default:return 0}}(e.variant),n=h.useMemo((function(){switch(e.variant){case"gz1":return f.jsx("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return f.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return f.jsx("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return f.jsx("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return f.jsx("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return f.jsx("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return f.jsx("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return f.jsx("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});default:return f.jsx(f.Fragment,{})}}),[e.variant]);return f.jsxs("g",{transform:"translate(0,".concat("gz4"===e.variant?-20:0,")"),children:[f.jsx("rect",{id:"strip_gz",style:g({},"--height","".concat(t,"px"))}),f.jsx("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:e.isShowLight&&n}),!1!==e.isShowPSD&&f.jsx(C,x({},e))]})},C=h.memo((function(e){var t,n=["gz28","gz2otis","gz6","gzgf"].includes(e.variant),r=function(e){switch(e){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";default:return"58px"}}(e.variant);return f.jsx(d,{num:e.isShowPSD,inStrip:n,style:(t={},g(t,"--psd-dy",r),g(t,"transform","translate(var(--translate-x), var(--translate-y))"),g(t,"--translate-x","calc(var(--rmg-svg-width) / 2 + 80px)"),g(t,"--translate-y","calc(var(--rmg-svg-height) - var(--psd-dy, 58px))"),t)})}),(function(e,t){return e.variant===t.variant&&e.isShowPSD===t.isShowPSD})),I=globalThis&&globalThis.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},M=h.memo((function(e){var t=e.lineName,n=e.commonPart,r=e.zhClassName,a=e.enClassName,s=h.useRef(null),i=I(h.useState({x:0,height:0,width:0}),2),c=i[0],o=i[1];h.useEffect((function(){s.current&&o(s.current.getBBox())}),[t.toString()]);var l=H/Math.max(H,c.width),u=(-c.x-c.width/2)*l,m=c.height*(1-l)*1.2/2;return f.jsx("g",{ref:s,transform:"translate(".concat(u,",").concat(m,")scale(").concat(l,")"),children:f.jsxs("text",{className:r,fontSize:14,y:12,textAnchor:"end",dominantBaseline:"central",children:[n,f.jsx("tspan",{className:r,fontSize:8,x:0,dy:-2,textAnchor:"start",dominantBaseline:"central",children:t[0].slice(n.length).trim()}),f.jsx("tspan",{className:a,fontSize:4,x:0,dy:6,textAnchor:"start",dominantBaseline:"middle",children:t[1].slice(n.length).trim()})]})})}),(function(e,t){return e.lineName.toString()===t.lineName.toString()&&e.zhClassName===t.zhClassName&&e.enClassName===t.enClassName})),E=globalThis&&globalThis.__assign||function(){return E=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},E.apply(this,arguments)};function P(e){return f.jsx("rect",E({x:-22.5,height:24,width:45,rx:4.5},e))}var T=globalThis&&globalThis.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},H=42,D=h.memo((function(e){var t=e.lineName,n=e.foregroundColour,r=e.backgroundColour,a=e.zhClassName,s=e.enClassName,i=e.passed,c=T(W(t),2),o=c[0],l=c[1],u=h.useRef(null),m=h.useRef(null),d=T(h.useState({width:0}),2),x=d[0],g=d[1],p=T(h.useState({width:0}),2),y=p[0],v=p[1];h.useEffect((function(){u.current&&g(u.current.getBBox()),m.current&&v(m.current.getBBox())}),[t.toString()]);var S=H/Math.max(H,x.width),_=H/Math.max(H,y.width),N={nameZh:{y:7.3+13.5*(1-S)*S/2},nameEn:{y:19.5-9*(1-_)*_/2}};return f.jsxs("g",{textAnchor:"middle",fill:i?j.white:n,children:[f.jsx(P,{fill:i?"#aaa":r}),2===o?f.jsx(M,{lineName:t,commonPart:l,zhClassName:a,enClassName:s}):f.jsxs(f.Fragment,{children:[f.jsx("text",{ref:u,className:a,fontSize:12,transform:"translate(0,".concat(N.nameZh.y,")scale(").concat(S,")"),dominantBaseline:"central",children:1===o?f.jsxs(f.Fragment,{children:[f.jsx("tspan",{fontSize:16,dy:.7,dominantBaseline:"central",children:l}),f.jsx("tspan",{dy:-.7,dominantBaseline:"central",children:t[0].slice(l.length)})]}):t[0]}),f.jsx("text",{ref:m,className:s,fontSize:8,transform:"translate(0,".concat(N.nameEn.y,")scale(").concat(_,")"),dominantBaseline:"middle",children:t[1]})]})]})}),(function(e,t){return e.lineName.toString()===t.lineName.toString()&&e.foregroundColour===t.foregroundColour&&e.backgroundColour===t.backgroundColour&&e.zhClassName===t.zhClassName&&e.enClassName===t.enClassName&&e.passed===t.passed})),W=function(e){var t=e[0].match(/^(\d+)\D+$/);if(t)return[1,t[1]];var n=e.map((function(e){return e.match(/^(\w+).+$/)}));return n[0]&&n[1]&&n[0][1]===n[1][1]?[2,n[0][1]]:[3,""]},F=h.memo((function(e){var t=e.stroke,n=e.large?"M0,12.95 V-12.95 H-12.95 a12.95,12.95 0 0,0 0,25.9 h25.9 a12.95,12.95 0 0,0 0,-25.9 H0":"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0";return f.jsx("path",{d:n,fill:"#fff",strokeWidth:2,stroke:t})}),(function(e,t){return e.stroke===t.stroke&&e.large===t.large})),U=globalThis&&globalThis.__assign||function(){return U=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},U.apply(this,arguments)},L=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},V=globalThis&&globalThis.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,s=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(c){a={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return i},G=15;function $(e){var t=e.lineNum,n=e.stnNum,r=e.strokeColour,a=e.passed,s=e.large,i=e.textClassName,c=L(e,["lineNum","stnNum","strokeColour","passed","large","textClassName"]),o=h.useRef(null),l=h.useRef(null),u=V(h.useState({width:0}),2),m=u[0],d=u[1],x=V(h.useState({width:0}),2),g=x[0],p=x[1];h.useEffect((function(){o.current&&d(o.current.getBBox()),l.current&&p(l.current.getBBox())}),[t,n]);var j=G/Math.max(G,m.width),y=2===t.length&&2===n.length?j:G/Math.max(G,g.width);return f.jsxs("g",U({},c,{children:[f.jsx(F,{stroke:a?"#aaa":r,large:s}),f.jsxs("g",{textAnchor:"middle",fontSize:13.5,transform:s?"scale(1.4)":"",fill:a?"#aaa":"#000",children:[f.jsx("g",{transform:"translate(-9.25,0)scale(".concat(j,")"),children:f.jsx("text",{ref:o,className:i,dominantBaseline:"central",children:t})}),f.jsx("g",{transform:"translate(9.25,0)scale(".concat(y,")"),children:f.jsx("text",{ref:l,className:i,dominantBaseline:"central",children:n})})]})]}))}var J=h.memo((function(e){var t=e.stnName,n=e.onUpdate,r=h.useRef(null);return h.useEffect((function(){r.current&&n&&n(r.current.getBBox())}),[t.toString()]),f.jsxs("g",{ref:r,children:[f.jsx("text",{className:"rmg-name__zh",fontSize:18,children:t[0]}),f.jsx("g",{fontSize:10.5,children:t[1].split("\\").map((function(e,t){return f.jsx("text",{className:"rmg-name__en",dy:16+11*t,children:e},t)}))})]})}),(function(e,t){return e.stnName.toString()===t.stnName.toString()}));function Y(e){var t=e.stnName,r=e.onUpdate,a=e.passed,s=p(e,n),i=h.useRef(null),c=m(h.useState({x:0,width:0}),2),o=c[0],l=c[1];return h.useEffect((function(){if(i.current){var e=i.current.getBBox();l(e),r&&r(e)}}),[t.toString()]),t[0]||t[1]?f.jsxs("g",x(x({fill:a?"#aaa":"#000"},s),{},{children:[f.jsxs("g",{transform:"translate(0,3)",fontSize:18,children:[f.jsx("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),f.jsx("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),f.jsxs("g",{ref:i,textAnchor:"middle",children:[f.jsx("text",{className:"rmg-name__zh",fontSize:13,children:t[0]}),f.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:t[1]})]})]})):f.jsx(f.Fragment,{})}function Z(e){var t=e.passed,n=p(e,r);return f.jsxs("g",x(x({textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)"},n),{},{children:[f.jsx("text",{className:"rmg-name__zh",fontSize:13,children:"快车停靠站"}),f.jsx("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]}))}function q(e){var t=e.primaryName,n=e.secondaryName,r=e.stationState,a=e.flipped,s=e.express,i=m(h.useState({width:0}),2),c=i[0],o=i[1],l=m(h.useState({x:0,width:-20}),2),u=l[0],d=l[1],x=t[1].split("\\").length,g={g:{x:0,y:a?17.5:-20-14*x*Math.cos(-45)},StationSecondaryName:{x:(c.width+u.width/2+10)*(a?-1:1),y:2+5*(x-1)},ExpressTag:{x:(c.width+u.width+20+35)*(a?-1:1),y:2+5*(x-1)}};return f.jsxs("g",{textAnchor:a?"end":"start",fill:function(e){switch(e){case y.PASSED:return"#aaa";case y.CURRENT:return"#f00";case y.FUTURE:return"#000"}}(r),transform:"translate(".concat(g.g.x,",").concat(g.g.y,")rotate(-45)"),children:[f.jsx(J,{stnName:t,onUpdate:o}),n&&f.jsx(Y,{stnName:n,onUpdate:d,passed:r===y.PASSED,transform:"translate(".concat(g.StationSecondaryName.x,",").concat(g.StationSecondaryName.y,")")}),s&&f.jsx(Z,{passed:r===y.PASSED,transform:"translate(".concat(g.ExpressTag.x,",").concat(g.ExpressTag.y,")")})]})}function K(e){var t=e.stnId,n=e.stnState,r=e.stnY,a=v((function(e){return e.param.theme})),s=v((function(e){return e.param.line_name})),i=v((function(e){return e.param.line_num})),c=v((function(e){return e.param.stn_list[t]})),o=2===c.parents.length||2===c.children.length,l=r>0||1===c.parents.indexOf(c.branch.left[1]||"")||1===c.children.indexOf(c.branch.right[1]||"")?180:0,m=c.name[1].split("\\").length,d=o?180===l?16+12*(m-1)*Math.cos(-45):-9:180===l?-6:(25+15*(m-1))*Math.cos(-45);return f.jsxs(f.Fragment,{children:[f.jsx(Q,{intInfos:o?[{theme:[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"],name:s}].concat(u(c.transfer.groups[0].lines)):c.transfer.groups[0].lines,stnState:n,tickRotation:l}),f.jsx($,{lineNum:i,stnNum:c.num,strokeColour:a[2],textClassName:"rmg-name__zh",passed:-1===n}),f.jsx("g",{transform:"translate(".concat(-d,",0)"),children:f.jsx(q,{primaryName:c.name,secondaryName:c.secondaryName||void 0,stationState:n,flipped:180===l,express:c.services.includes(S.express)})})]})}var Q=function(e){return f.jsxs(f.Fragment,{children:[f.jsx(X,x({strokeWidth:4},e)),f.jsx(ee,x({transform:"translate(0,".concat(180===e.tickRotation?-47:23,")")},e))]})},X=function(e){var t=e.intInfos,n=e.stnState,r=e.tickRotation,s=p(e,a);return f.jsx("g",x(x({},s),{},{children:t.map((function(e,a){var s;return f.jsx("use",{xlinkHref:"#inttick",stroke:-1===n?"#aaa":null===(s=e.theme)||void 0===s?void 0:s[2],transform:"translate(".concat(-2*(t.length-1)+4*a,",0)rotate(").concat(180===r?180:0,")")},a)}))}))},ee=function(e){var t=e.intInfos,n=e.tickRotation,r=e.stnState,a=p(e,s);return f.jsx("g",x(x({},a),{},{children:t.map((function(e,t){var a,s,i,c;return f.jsx("g",{transform:"translate(0,".concat(28*t*(180===n?-1:1),")"),children:f.jsx(D,{lineName:e.name,foregroundColour:null!==(a=null===(s=e.theme)||void 0===s?void 0:s[3])&&void 0!==a?a:j.white,backgroundColour:null!==(i=null===(c=e.theme)||void 0===c?void 0:c[2])&&void 0!==i?i:"#aaaaaa",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en",passed:-1===r})},t)}))}))},te=function(e,t){return 2===e[t].parents.length||2===e[t].children.length?.25:0},ne=function(){var e,t=v((function(e){return e.helper})),n=t.branches,r=t.routes,a=t.depsStr,s=v((function(e){return e.param})),i=s.svgWidth,c=s.svg_height,o=s.y_pc,l=s.padding,u=s.branchSpacingPct,m=s.direction,d=s.line_name,p=s.current_stn_idx,j=s.stn_list,y=b(j,te,te),S=h.useMemo((function(){return console.log("computing x shares"),Object.keys(j).reduce((function(e,t){return x(x({},e),{},g({},t,function(e,t,n){var r=w("linestart","lineend",t);if(r.nodes.includes(e))return w(r.nodes[1],e,t).len;for(var a=n.filter((function(t){return t.includes(e)}))[0],s=e;!r.nodes.includes(s);)s=a[a.indexOf(s)-1];for(var i=e;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var c="linestart"===s,o="lineend"===i;if(a.toString()===n[0].toString()){var l=[];return c||o?c?(l[0]=0,l[1]=w(r.nodes[1],i,t).len,l[2]=w(a[1],e,t).len,l[3]=w(e,i,t).len):(l[0]=w(r.nodes[1],s,t).len,l[1]=w(s,r.nodes.slice(-2)[0],t).len,l[2]=w(s,e,t).len,l[3]=w(e,a.slice(-2)[0],t).len):(l[0]=w(r.nodes[1],s,t).len,l[1]=w(s,i,t).len,l[2]=w(s,e,t).len,l[3]=w(e,i,t).len),l[0]+l[2]*l[1]/(l[2]+l[3])}if(c||o)return c?w(r.nodes[1],i,t).len-w(e,i,t).len:w(r.nodes[1],s,t).len+w(s,e,t).len;var u=[];return u[0]=w(r.nodes[1],s,t).len,u[1]=w(s,i,t).len,u[2]=w(s,e,t).len,u[3]=w(e,i,t).len,u[0]+u[2]*u[1]/(u[2]+u[3])}(t,y,n)))}),{})}),[n.toString(),JSON.stringify(y)]),z=w("linestart","lineend",y),B=w(z.nodes[1],z.nodes.slice(-2)[0],y),A=m===_.right?[i[N.RailMap]*l/100+65,i[N.RailMap]*(1-l/100)-20]:[i[N.RailMap]*l/100,i[N.RailMap]*(1-l/100)-65],R=Object.keys(S).reduce((function(e,t){return x(x({},e),{},g({},t,A[0]+S[t]/B.len*(A[1]-A[0])))}),{}),C=h.useMemo((function(){return console.log("computing y shares"),Object.keys(j).reduce((function(e,t){if(n[0].includes(t))return x(x({},e),{},g({},t,0));var r=n.slice(1).filter((function(e){return e.includes(t)}))[0];return x(x({},e),{},g({},t,j[r[0]].children.indexOf(r[1])?-2:2))}),{})}),[a]),I=Object.keys(C).reduce((function(e,t){return x(x({},e),{},g({},t,-C[t]*u*c/200))}),{}),M=h.useMemo((function(){return O(p,r,m)}),[p,m,r.toString()]),E=n.map((function(e){return k(e,M)})).reduce((function(e,t){return e.main.push(t.main),e.pass.push(t.pass),e}),{main:[],pass:[]}),P=Object.keys(E).reduce((function(e,t){return x(x({},e),{},g({},t,E[t].map((function(e){return ae(e,R,I)}))))}),{});return f.jsxs("g",{id:"main",style:(e={},g(e,"--y-percentage",o),g(e,"transform","translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"),e),children:[f.jsx(re,{paths:P}),f.jsx(se,{xs:R,ys:I,stnStates:M}),f.jsx("g",{id:"line_name",style:g({},"--translate-x",m===_.right?"".concat(A[0]-65,"px"):"".concat(A[1]+65,"px")),children:f.jsx(D,{lineName:d,foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)",zhClassName:"rmg-name__zh",enClassName:"rmg-name__en"})})]})},re=h.memo((function(e){return f.jsxs("g",{fill:"none",strokeWidth:4,children:[f.jsx("g",{stroke:"#aaa",strokeDasharray:4,children:e.paths.pass.map((function(e,t){return f.jsx("path",{d:e},t)}))}),f.jsx("g",{stroke:"var(--rmg-theme-colour)",children:e.paths.main.map((function(e,t){return f.jsx("path",{d:e},t)}))})]})}),(function(e,t){return JSON.stringify(e.paths)===JSON.stringify(t.paths)})),ae=function(e,t,n){var r,a=[];return e.forEach((function(e){var s=t[e],i=n[e];if(!r&&0!==r)return r=i,void a.push("M ".concat(s,",").concat(i));0===i?(i<r&&a.push("H ".concat(s-40),"a 40,40 0 0,0 40,-40","V ".concat(i)),i>r&&a.push("H ".concat(s-40),"a 40,40 0 0,1 40,40","V ".concat(i))):(i<r&&a.push("V ".concat(i+40),"a 40,40 0 0,1 40,-40","H ".concat(s)),i>r&&a.push("V ".concat(i-40),"a 40,40 0 0,0 40,40","H ".concat(s))),a.push("H ".concat(s)),r=i})),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},se=function(e){var t=e.xs,n=e.ys,r=e.stnStates,a=v((function(e){return e.param.stn_list}));return f.jsx("g",{id:"stn_icons",children:Object.keys(a).filter((function(e){return!["linestart","lineend"].includes(e)})).map((function(e){return f.jsx("g",{style:{transform:"translate(".concat(t[e],"px,").concat(n[e],"px)")},children:f.jsx(K,{stnId:e,stnState:r[e],stnY:n[e]})},e)}))})};function ie(e){return f.jsx("path",x({d:"M60,60 L0,0 L60,-60 H90 L40,-10 H150 V10 H40 L90,60z",fill:"black"},e))}function ce(e){var t=e.destIds,n=e.textAnchor,r=p(e,i),a=v((function(e){return e.param.direction})),s=v((function(e){return e.param.stn_list})),c=t.map((function(e){return s[e].name[0].length})),o=Math.min.apply(Math,u(c)),l=o>1&&c[0]!==c[1]?Math.abs(c[0]-c[1])/(o-1):0;return f.jsxs("g",x(x({textAnchor:n},r),{},{children:[t.map((function(e,t){var r=c[t]>c[1-t],i=!A()&&"end"===n&&!r;return f.jsxs(h.Fragment,{children:[f.jsx("text",{className:"rmg-name__zh",fontSize:25,x:a===_.left?0:-75,y:42*t-21,letterSpacing:r?"0em":"".concat(l,"em"),dx:i?"".concat(l,"em"):"0em",children:s[e].name[0]}),f.jsx("text",{className:"rmg-name__en",fontSize:11.5,x:a===_.left?0:-75,y:42*t-1,children:"Towards "+s[e].name[1].replace("\\"," ")})]},e)})),f.jsx("text",{className:"rmg-name__zh",fontSize:28,x:a===_.left?25*(Math.max.apply(Math,u(c))+1):0,y:5,children:"方向"})]}))}var oe=N.RailMap,le=function(){var e=v((function(e){return e.app})).canvasScale,t=v((function(e){return e.param})),n=t.svgWidth,r=t.svg_height,a=t.direction,s=t.psd_num,i=t.info_panel_type,c=t.notesGZMTR,o=t.current_stn_idx,l=t.stn_list,u=t.theme,m=n[oe],d=l[o];return f.jsxs(B,{type:oe,svgWidth:m,svgHeight:r,canvasScale:e,theme:u,children:[f.jsx(ue,{}),f.jsx(R,{variant:i,isShowLight:i===z.gz2otis,isShowPSD:i===z.gz2otis&&s}),a===_.left&&d.parents.includes("linestart")||a===_.right&&d.children.includes("lineend")?f.jsx(fe,{}):f.jsxs(f.Fragment,{children:[f.jsx(ne,{}),f.jsx(me,{}),c.map((function(e,t){return f.jsx(he,{note:e},t)}))]}),i===z.gz2otis&&f.jsx("line",{x2:m,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},ue=h.memo((function(){return f.jsx("defs",{children:f.jsx("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"})})})),me=function(){var e,t=v((function(e){return e.helper})).routes,n=v((function(e){return e.param})),r=n.direction,a=n.direction_gz_x,s=n.direction_gz_y,i=n.current_stn_idx,c=h.useMemo((function(){return u(new Set(t.reduce((function(e,t){return t.includes(i)?e.concat(t.filter((function(e){return!["linestart","lineend"].includes(e)})).slice(r===_.left?0:-1)[0]):e}),[]).filter((function(e){return e!==i}))))}),[i,r,t.toString()]),o={textAnchor:r===_.left?"start":"end",transform:"translate(".concat(r===_.left?65:-65,",-5)"),destIds:c};return f.jsxs("g",{id:"direction_gz",style:(e={},g(e,"--x-percentage",a),g(e,"--y-percentage",s),e),children:[f.jsx(ie,{transform:"scale(0.35)rotate(".concat(r===_.left?0:180,")")}),2!==c.length?f.jsx(de,x({},o)):f.jsx(ce,x({},o))]})},de=function(e){var t=e.destIds,n=p(e,c),r=v((function(e){return e.param.stn_list}));return f.jsxs("g",x(x({},n),{},{children:[f.jsx("text",{className:"rmg-name__zh",fontSize:28,children:t.map((function(e){return r[e].name[0]})).join("/")+"方向"}),f.jsx("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map((function(e){return r[e].name[1].replace("\\"," ")})).join("/")})]}))},fe=h.memo((function(){return f.jsxs("g",{id:"terminus_gz",textAnchor:"middle",children:[f.jsx("text",{className:"rmg-name__zh",fontSize:90,children:"终 点 站"}),f.jsx("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),f.jsxs("g",{strokeWidth:8,stroke:"#000",children:[f.jsx("path",{d:"M -160,68 h -160"}),f.jsx("path",{d:"M 160,68 h 160"})]})]})})),he=h.memo((function(e){var t,n=h.useRef(null),r=m(h.useState({width:0,height:0,y:0}),2),a=r[0],s=r[1];return h.useEffect((function(){n.current&&s(n.current.getBBox())}),[e.note[0],e.note[1]]),f.jsxs("g",{className:"note-box",style:(t={},g(t,"--x-percentage",e.note[2]),g(t,"--y-percentage",e.note[3]),t),children:[e.note[4]&&f.jsx("rect",{height:a.height+4,width:a.width+4,x:-2,y:a.y-2,fill:"none",stroke:"black",strokeWidth:.5}),f.jsxs("g",{ref:n,children:[f.jsx("g",{fontSize:16,letterSpacing:1.2,children:e.note[0].split("\n").map((function(e,t){return f.jsx("text",{className:"rmg-name__zh",y:18*t,children:e},t)}))}),f.jsx("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*e.note[0].split("\n").length,")"),children:e.note[1].split("\n").map((function(t,n){var r;return f.jsx("text",{className:"rmg-name__en",y:11*n,textLength:n<((null===(r=e.note[1].match(/\n/g))||void 0===r?void 0:r.length)||0)?a.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:t},n)}))})]})]})}),(function(e,t){return e.note.toString()===t.note.toString()})),xe=h.memo((function(e){var t=e.stnName,n=e.onUpdate,r=h.useRef(null);return h.useEffect((function(){r.current&&n&&n(r.current.getBBox())}),[t.toString()]),f.jsxs("g",{ref:r,children:[f.jsx("text",{className:"rmg-name__zh",fontSize:90,children:t[0]}),f.jsx("g",{fontSize:36,children:t[1].split("\\").map((function(e,t){return f.jsx("text",{className:"rmg-name__en",dy:70+36*t,children:e},t)}))})]})}),(function(e,t){return e.stnName.toString()===t.stnName.toString()})),ge=function(e){var t=e.secondaryName,n=e.transform,r=h.useRef(null),a=m(h.useState({x:0,width:0}),2),s=a[0],i=a[1];return h.useEffect((function(){r.current&&i(r.current.getBBox())}),[t.toString()]),f.jsxs("g",{transform:n,children:[f.jsxs("g",{transform:"translate(0,4.5)",fontSize:36,children:[f.jsx("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),f.jsx("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),f.jsxs("g",{ref:r,textAnchor:"middle",children:[f.jsx("text",{className:"rmg-name__zh",fontSize:26,children:t[0]}),f.jsx("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t[1]})]})]})},pe=function(){var e,t=v((function(e){return e.param})),n=t.svg_height,r=t.svgWidth,a=t.theme,s=t.direction,i=t.info_panel_type,c=t.line_num,o=t.current_stn_idx,l=t.stn_list[o],u=m(h.useState({width:0}),2),d=u[0],x=u[1],p=l[s===_.left?"parents":"children"],j={name:"translate(".concat((s===_.left?1:-1)*r[N.RunIn]/4,",45)"),next:"translate(".concat((s===_.left?1:-1)*r[N.RunIn]/10,",45)")},y={nameGroup:{x:r.runin/2,y:.5*n-50-18*(l.name[1].split("\\").length-1)-(l.secondaryName?29:0)},secondaryName:{x:0,y:70+36*l.name[1].split("\\").length}};return f.jsxs("g",{children:[f.jsxs("g",{transform:i===z.gz2otis?j.name:"",children:[f.jsxs("g",{textAnchor:"middle",transform:"translate(".concat(y.nameGroup.x,",").concat(y.nameGroup.y,")"),children:[f.jsx(xe,{stnName:l.name,onUpdate:x}),l.secondaryName&&f.jsx(ge,{secondaryName:l.secondaryName,transform:"translate(".concat(y.secondaryName.x,",").concat(y.secondaryName.y,")")})]}),f.jsx($,{lineNum:c,stnNum:l.num,strokeColour:a[2],textClassName:"rmg-name__zh",style:(e={},g(e,"--translate-x","".concat((r[N.RunIn]+d.width)/2+55,"px")),g(e,"--translate-y","".concat(.5*n-30-18*(l.name[1].split("\\").length-1)-(l.secondaryName?29:0),"px")),g(e,"transform","translate(var(--translate-x, 800px), var(--translate-y, 145px))"),e),large:!0})]}),f.jsx("g",{transform:i===z.gz2otis?j.next:"",children:!p||p.includes("linestart")||p.includes("lineend")?f.jsx(f.Fragment,{}):1===p.length?f.jsx(je,{nextId:p[0],nameBBox:d}):f.jsx(ve,{nextIds:p,nameBBox:d})})]})},je=function(e){var t,n=e.nextId,r=e.nameBBox,a=v((function(e){return e.param.svgWidth})),s=v((function(e){return e.param.direction})),i=v((function(e){return e.param.stn_list[n]})),c=i.name,o=i.secondaryName,l=m(h.useState({width:0}),2),u=l[0],d=l[1],x=h.useRef(null);h.useEffect((function(){x.current&&d(x.current.getBBox())}),[c.toString()]);var p=c[0].length,j=(a[N.RunIn]-r.width)/2;return f.jsxs(f.Fragment,{children:[f.jsxs("g",{id:"big_next",children:[f.jsxs("g",{textAnchor:"middle",style:g({},"--translate-x",s===_.left?"80px":"".concat(p<=2?a[N.RunIn]-45-u.width-70:a[N.RunIn]-45-u.width-52.5,"px")),children:[f.jsx("text",{className:"rmg-name__zh",fontSize:35,children:"下站"}),f.jsx("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),f.jsxs("g",{textAnchor:"start",ref:x,style:g({},"--translate-x",s===_.left?"".concat(p<=2?150:132.5,"px"):"".concat(a[N.RunIn]-45-u.width,"px")),children:[f.jsx("text",{className:"rmg-name__zh",fontSize:35,children:c[0]}),f.jsx("g",{fontSize:17,children:c[1].split("\\").map((function(e,t){return f.jsx("text",{className:"rmg-name__en",dy:30+17*t,children:e},t)}))})]}),o&&f.jsx("g",{textAnchor:"middle",style:g({},"--translate-x",s===_.left?"".concat(p<=2?150:132.5,"px"):"".concat(a[N.RunIn]-45-u.width,"px")),children:f.jsx(ye,{secName:o,transform:"translate(".concat(u.width/2,",").concat(30+17*c[1].split("\\").length+5,")")})})]}),f.jsx(ie,{id:"arrow",style:(t={},g(t,"--translate-x",s===_.left?"".concat((115+35*((p<=2?1:.5)+p)+j)/2-20,"px"):"".concat((a[N.RunIn]-45-u.width-(p<=2?105:87.5)+j+e.nameBBox.width+55+25.9)/2+20,"px")),g(t,"--rotate",s===_.left?"0deg":"180deg"),t)})]})},ye=function(e){var t=e.secName,n=p(e,o),r=h.useRef(null),a=m(h.useState({x:0,width:0}),2),s=a[0],i=a[1];return h.useEffect((function(){r.current&&i(r.current.getBBox())}),[e.secName.toString()]),f.jsxs("g",x(x({},n),{},{children:[f.jsxs("g",{transform:"translate(0,2.5)",fontSize:25,children:[f.jsx("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),f.jsx("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),f.jsxs("g",{ref:r,children:[f.jsx("text",{className:"rmg-name__zh",fontSize:18,children:t[0]}),f.jsx("text",{className:"rmg-name__en",fontSize:10,dy:15,children:t[1]})]})]}))},ve=function(e){var t,n=e.nextIds,r=e.nameBBox,a=v((function(e){return e.helper})).routes,s=v((function(e){return e.param.svgWidth})),i=v((function(e){return e.param.direction})),c=v((function(e){return e.param.stn_list})),o=n.map((function(e){return c[e].name})),l=m(h.useState({width:0}),2),d=l[0],p=l[1],j=h.useRef([]);h.useEffect((function(){p((function(e){return x(x({},e),{},{width:0})})),j.current.forEach((function(e){var t=null==e?void 0:e.getBBox();p((function(e){return t?e.width>t.width?e:t:e}))}))}),[o.toString()]);var y=e.nextIds.map((function(e){return a.reduce((function(t,n){return n.includes(e)?t.concat(n.filter((function(e){return!["linestart","lineend"].includes(e)})).slice(i===_.left?0:-1)[0]):t}),[])})),S=Math.max.apply(Math,u(o.map((function(e){return e[0].length})))),z=(s[N.RunIn]-r.width)/2;return f.jsxs(f.Fragment,{children:[f.jsx("g",{id:"big_next_2",children:o.map((function(e,t){return f.jsxs(h.Fragment,{children:[f.jsxs("g",{textAnchor:"middle",style:g({},"--translate-x",i===_.left?"72px":"".concat(s[N.RunIn]-45-d.width-41,"px")),children:[f.jsx("text",{className:"rmg-name__zh",children:"下站"}),f.jsx("text",{className:"rmg-name__en",y:22,children:"Next"})]}),f.jsxs("g",{ref:function(e){return j.current[t]=e},textAnchor:"start",style:g({},"--translate-x",i===_.left?"113px":"".concat(s[N.RunIn]-45-d.width,"px")),children:[f.jsx("text",{className:"rmg-name__zh",children:e[0]}),e[1].split("\\").map((function(e,t){return f.jsx("text",{className:"rmg-name__en",y:22+13*t,children:e},t)})),f.jsx("text",{className:"rmg-name__zh",y:-35,children:y[t].map((function(e){return c[e].name[0]})).join("/")+"方向"}),f.jsx("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+y[t].map((function(e){return c[e].name[1]})).join("/").replace("\\"," ")})]})]},t)}))}),f.jsx(ie,{id:"arrow",style:(t={},g(t,"--translate-x",i===_.left?"".concat((99+27*(1+S)+z)/2-20,"px"):"".concat((s[N.RunIn]-45-d.width-41-27+z+e.nameBBox.width+55+25.9)/2+20,"px")),g(t,"--rotate",i===_.left?"0deg":"180deg"),t)})]})};function Se(e){var t=e.num,n=p(e,l);return f.jsxs("g",x(x({textAnchor:"middle",fill:"var(--rmg-theme-fg)"},n),{},{children:[f.jsx("circle",{cx:0,cy:0,r:30,fill:"var(--rmg-theme-colour)"}),f.jsx("text",{className:"rmg-name__en",fontSize:38,dy:-9.5,children:t}),f.jsx("text",{className:"rmg-name__zh",fontSize:13,dy:10,children:"站台"}),f.jsx("text",{className:"rmg-name__en",fontSize:9,dy:21,children:"Platform"})]}))}function _e(e){var t=e.canvasType,n=v((function(e){return e.param})),r=n.svgWidth,a=n.svg_height;return f.jsxs("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[f.jsx("line",{y2:a,transform:"translate(".concat(r[t]/2,",0)")}),f.jsx("line",{x2:r[t],transform:"translate(0,90)"})]})}var Ne=N.RunIn;function ze(){var e,t=v((function(e){return e.app})).canvasScale,n=v((function(e){return e.param})),r=n.svgWidth,a=n.svg_height,s=n.direction,i=n.info_panel_type,c=n.platform_num,o=n.psd_num,l=n.theme,u=r[Ne],m={platform:"translate(".concat(s===_.left?50:-50,",45)")};return f.jsxs(B,{type:Ne,svgWidth:u,svgHeight:a,canvasScale:t,theme:l,children:[f.jsx(R,{variant:i,isShowLight:i!==z.gz2otis,isShowPSD:i!==z.gz2otis&&o}),f.jsx("g",{transform:i===z.gz2otis?m.platform:"",children:f.jsx(Se,{num:c,style:(e={},g(e,"--translate-x","".concat(s===_.left?u-100:100,"px")),g(e,"--translate-y","calc(var(--rmg-svg-height) / 2 - 30px)"),g(e,"transform","translate(var(--translate-x, 100px), var(--translate-y))"),e)})}),f.jsx(pe,{}),i===z.gz2otis&&f.jsx(_e,{canvasType:Ne})]})}e("default",{runin:f.jsx(ze,{}),railmap:f.jsx(le,{})})}}}))}();
