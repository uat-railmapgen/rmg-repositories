"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[8049],{58049:function(n,t,e){e.r(t),e.d(t,{default:function(){return Qn}});var r=e(29439),i=e(93433),a=e(72791),c=e(37732),o=e(36705),s=e(20713),l=function(n,t,e,r){var a=n.length-2*r-e,c=[].concat((0,i.Z)(n),(0,i.Z)(n),(0,i.Z)(n)),o=n.length+n.findIndex((function(n){return n===t})),s=c[o+a-1],l=n.length+n.findIndex((function(n){return n===s}))+(o+a>2*n.length?n.length:0);return{top:c.slice(o,l+1),left:c.slice(o-r,o),right:c.slice(l+1,l+1+r),bottom:c.slice(l+1+r,l+1+r+e)}},u=e(90059),d=e(80184),f=s.Ht.Destination;function h(){var n=(0,c.Qy)((function(n){return n.app})).canvasScale,t=(0,c.Qy)((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,a=e[f];return(0,d.jsxs)(u.Z,{type:f,svgWidth:a,svgHeight:r,canvasScale:n,theme:i,children:[(0,d.jsx)(m,{}),(0,d.jsx)(g,{})]})}var m=(0,a.memo)((function(){return(0,d.jsx)("defs",{children:(0,d.jsx)("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})})})})),g=function(){var n=(0,c.Qy)((function(n){return n.helper})),t=n.routes,e=n.branches,a=(0,c.Qy)((function(n){return n.param})),s=a.line_name,l=a.theme,u=a.current_stn_idx,f=a.direction,h=a.stn_list,m=a.info_panel_type,g=a.loop,p=a.coline,j=function(n,t,e){return(0,i.Z)(new Set(n.filter((function(n){return n.includes(e)})).map((function(n){var e=n.filter((function(n){return!["linestart","lineend"].includes(n)}));return"l"===t?e[0]:e.reverse()[0]}))))},v=function(n,t){return t?[[n.map((function(n){return h[n].name[0]})).join("\uff0c"),n.map((function(n){return h[n].name[1]})).join(", ")].map((function(n){return n.replace("\\","")}))]:n.map((function(n){return h[n].name.map((function(n){return n.replace("\\","")}))}))},_=g?function(n,t,e,r){var a=n[0].filter((function(n){return!["linestart","lineend"].includes(n)})),c=[].concat((0,i.Z)(a),(0,i.Z)(a),(0,i.Z)(a)),o="r"===t?c:c.reverse(),s=o.findIndex((function(n){return r===n}))+a.length;return o.slice(s+1).filter((function(n){return e[n].loop_pivot})).slice(void 0,2)}(e,f,h,u):j(t,f,u),y=(g?j(t,f,u):_).filter((function(n){return e.slice(1).filter((function(n){return(0,o.Qo)(n,h)})).some((function(t){return t.includes(n)}))})),Z=v(_.filter((function(n){return!y.includes(n)})),!g&&!("sh2020"===m));console.log(Z);var k=v(y,!0),w=Object.fromEntries(y.map((function(n){return[n,Object.values(p).filter((function(t){return t.from===n||t.to===n})).at(0)]})).filter((function(n){var t=(0,r.Z)(n,2);t[0];return t[1]})));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(x,{dest_names:Z,line_name:s,line_color:[l[2],l[3]],coline:!!y.length,upper:!!y.length}),y.length&&y.map((function(n){var t,e,r;return(0,d.jsx)("g",{transform:"translate(0,".concat(-250,")"),children:(0,d.jsx)(x,{dest_names:[k.at(0)],line_name:null===(t=w[n])||void 0===t?void 0:t.colors.at(0).slice(4),line_color:[null===(e=w[n])||void 0===e?void 0:e.colors.at(0)[2],null===(r=w[n])||void 0===r?void 0:r.colors.at(0)[3]],coline:!0,upper:!1})},"coline_".concat(n))}))]})},x=function(n){var t=n.dest_names,e=n.line_name,i=n.line_color,o=n.coline,s=n.upper,l=(0,c.Qy)((function(n){return n.param})),u=l.current_stn_idx,f=l.direction,h=l.platform_num,m=l.svgWidth,g=l.svg_height,x=(0,a.useRef)(null),y=(0,a.useState)({width:0}),Z=(0,r.Z)(y,2),k=Z[0],w=Z[1];(0,a.useEffect)((function(){return w(x.current.getBBox())}),[JSON.stringify(t),JSON.stringify(u)]);var b=m.destination/2,S=b-10-36-k.width>=162.5&&b-10-36-264>=162.5?b:"l"===f?(m.destination+k.width-264)/2:(m.destination-k.width+264)/2;return(0,d.jsxs)("g",{transform:"translate(0,".concat(g-300,")"),children:[(0,d.jsx)("path",{stroke:i[0],strokeWidth:12,d:"l"===f?"M".concat(m.destination-24,",16 H 36"):"M24,16 H ".concat(m.destination-36),transform:"translate(0,".concat(s?-20:220,")"),markerEnd:o?void 0:"url(#slope)"}),(0,d.jsx)(p,{ref:x,dest_names:t}),""!==h&&(0,d.jsx)("g",{transform:"translate(".concat(S,",0)"),children:(0,d.jsx)(j,{})}),e[0].match(/^[\w\d]+(\u53f7)?\u7ebf/)?(0,d.jsx)(_,{line_name:e,line_color:i}):(0,d.jsx)(v,{line_name:e,line_color:i})]})},p=(0,a.forwardRef)((function(n,t){var e=n.dest_names,r=(0,c.Qy)((function(n){return n.param})),i=r.direction,o=r.svgWidth;return(0,d.jsxs)("g",{ref:t,transform:"translate(".concat("l"===i?36:o.destination-36,",145)"),children:[(0,d.jsx)("g",{transform:"translate(0,".concat(2===e.length?-20:20,")"),children:(0,d.jsx)("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",fill:"black",transform:"rotate(".concat("l"===i?0:180,")scale(0.8)")})}),(0,d.jsx)("g",{textAnchor:"l"===i?"start":"end",transform:"translate(".concat("l"===i?148:-148,",25)"),children:e.map((function(n,t){return(0,d.jsxs)(a.Fragment,{children:[(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:70,dy:-100*t+7,children:"\u5f80"+n[0]},"zh".concat(t)),(0,d.jsx)("text",{className:"rmg-name__en",fontSize:25,dy:-100*t+40,children:"To "+n[1]},"en".concat(t))]},t)}))})]})})),j=function(){var n=(0,c.Qy)((function(n){return n.param})).platform_num;return(0,a.useMemo)((function(){return(0,d.jsxs)("g",{transform:"translate(".concat(-102.5,",150)"),children:[(0,d.jsx)("circle",{r:60,fill:"none",stroke:"black",strokeWidth:2}),(0,d.jsx)("text",{className:"rmg-name__en",dominantBaseline:"central",fontSize:120,textAnchor:"middle",children:n}),(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:100,dominantBaseline:"central",x:65,children:"\u7ad9\u53f0"})]})}),[n])},v=function(n){var t=n.line_name,e=n.line_color,o=(0,c.Qy)((function(n){return n.param})),s=o.direction,l=o.svgWidth,u="l"===s?l.destination-42:42,f=(0,a.useRef)(null),h=a.useState({width:0}),m=(0,r.Z)(h,2),g=m[0],x=m[1];a.useEffect((function(){return x(f.current.getBBox())}),(0,i.Z)(t));var p=("l"===s?-g.width:0)-6,j=("l"===s?-1:1)*g.width/2;return(0,a.useMemo)((function(){return(0,d.jsxs)("g",{transform:"translate(".concat(u,",92)"),children:[(0,d.jsx)("rect",{fill:e[0],x:p,width:g.width+10,height:120}),(0,d.jsxs)("g",{textAnchor:"r"===s?"start":"end",transform:"translate(0,68)",fill:e[1],children:[(0,d.jsx)("g",{ref:f,children:(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:68,children:t[0]})}),(0,d.jsx)("text",{className:"rmg-name__en",fontSize:30,textAnchor:"middle",x:j,dy:42,children:t[1]})]})]})}),[g].concat((0,i.Z)(t),(0,i.Z)(e),[s,l.destination]))},_=function(n){var t=n.line_name,e=n.line_color,o=(0,c.Qy)((function(n){return n.param})),s=o.direction,l=o.svgWidth,u=t[0].match(/^[\w\d]+|.+/g),f=(0,r.Z)(u,2),h=f[0],m=f[1],g="l"===s?l.destination-36-210:90;return(0,a.useMemo)((function(){return(0,d.jsxs)("g",{transform:"translate(".concat(g,",92)"),children:[(0,d.jsx)("rect",{fill:e[0],x:-54,width:108,height:120}),(0,d.jsx)("text",{className:"rmg-name__zh",fill:e[1],fontSize:96,textAnchor:"middle",dominantBaseline:"central",transform:"translate(0,60)",letterSpacing:-5,children:h}),(0,d.jsxs)("g",{textAnchor:"start",transform:"translate(74,68)",children:[(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:68,children:m}),(0,d.jsx)("text",{className:"rmg-name__en",fontSize:30,dy:42,children:t[1]})]})]})}),[g].concat((0,i.Z)(t),(0,i.Z)(e),[s,l.destination]))},y=e(1413),Z=e(45987),k=e(23824),w=function(n,t){return n.map((function(n){var e=t.filter((function(t){return t.includes(n.from)&&t.includes(n.to)}));if(1!==e.length)return{linePath:[],colors:n.colors};var r=e.flat(),i=r.indexOf(n.from),a=r.indexOf(n.to);return{linePath:i<a?r.slice(i,a+1):r.slice(a,i+1),colors:n.colors}})).filter((function(n){return 0!==n.linePath.length}))},b=["nextName"],S=s.Ht.RunIn,M=function(){var n=(0,c.Qy)((function(n){return n.app})).canvasScale,t=(0,c.Qy)((function(n){return n.helper})),e=t.branches,r=t.routes,i=t.depsStr,o=(0,c.Qy)((function(n){return n.param})),s=o.svgWidth,l=o.svg_height,f=o.current_stn_idx,h=o.direction,m=o.loop,g=o.theme,x=s[S],p=l-300,j=(0,a.useMemo)((function(){var n=r.filter((function(n){return n.includes(f)})).map((function(n){return n[n.indexOf(f)+("l"===h?1:-1)]})).reduce((function(n,t){return n.includes(t)?n:n.concat(t)}),[]);return m&&e[0].includes(f)&&1===n.length&&["linestart","lineend"].includes(n[0])&&(n="l"===h?[e[0][1]]:[e[0][e[0].length-2]]),n}),[i,f,h,m]),v=(0,a.useMemo)((function(){var n=r.filter((function(n){return n.includes(f)})).map((function(n){return n[n.indexOf(f)+("l"===h?-1:1)]})).reduce((function(n,t){return n.includes(t)?n:n.concat(t)}),[]);return m&&e[0].includes(f)&&1===n.length&&["linestart","lineend"].includes(n[0])&&(n="l"===h?[e[0][e[0].length-2]]:[e[0][1]]),n}),[i,f,h,m]);return(0,d.jsxs)(u.Z,{type:S,svgWidth:x,svgHeight:l,canvasScale:n,theme:g,children:[(0,d.jsx)(z,{}),(0,d.jsx)("g",{transform:"translate(0,".concat(p,")"),children:(0,d.jsx)(H,{prevStnIds:j,nextStnIds:v})})]})},z=(0,a.memo)((function(){return(0,d.jsxs)("defs",{children:[(0,d.jsx)("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),(0,d.jsxs)("filter",{id:"pujiang_outline_runin",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[(0,d.jsx)("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"0",result:"e1"}),(0,d.jsx)("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"1",result:"e2"}),(0,d.jsx)("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"outline"}),(0,d.jsx)("feComposite",{in:"outline",in2:"SourceGraphic",operator:"over",result:"output"})]})]})})),H=function(n){var t=n.prevStnIds,e=n.nextStnIds,r=(0,c.Qy)((function(n){return n.param})),i=r.info_panel_type,a=r.svgWidth,o=r.stn_list,s=a.runin/2,l=1===e.length&&["linestart","lineend"].includes(e[0]),u=1===t.length&&["linestart","lineend"].includes(t[0]),f=e.map((function(n){return o[n].name})),h=t.map((function(n){return o[n].name})),m=10+(e.length>1?-50*(f[0][0].split("\\").length-1)+-30*(f[0][1].split("\\").length-1):0),g=10+(t.length>1?-50*(h[0][0].split("\\").length-1)+-30*(h[0][1].split("\\").length-1):0);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(N,{prevStnIds:t,nextStnIds:e,nextBranchLineDy:m,prevBranchLineDy:g}),l&&"sh2020"!==i?(0,d.jsx)(O,{mode:"terminal",prevStnIds:t,nextStnIds:e}):u&&"sh2020"!==i?(0,d.jsx)(O,{mode:"original",prevStnIds:t,nextStnIds:e}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(I,{prevStnIds:t,nextStnIds:e}),(0,d.jsx)("g",{transform:"translate(".concat(s,",160)"),textAnchor:"middle",children:(0,d.jsx)(L,{})})]}),(u||!l)&&(0,d.jsx)(F,{stnIds:n.nextStnIds}),(l||!u)&&(0,d.jsx)(W,{stnIds:n.prevStnIds})]})},O=function(n){var t,e=n.mode,r=n.prevStnIds,i=n.nextStnIds,a=(0,c.Qy)((function(n){return n.param})),o=a.current_stn_idx,s=a.theme,l=a.svgWidth,u=a.direction,f=a.coline,h=(0,c.Qy)((function(n){return n.helper})).branches,m={l:{original:{x:l.runin-36,anchor:"end"},terminal:{x:36,anchor:"start"}},r:{original:{x:36,anchor:"start"},terminal:{x:l.runin-36,anchor:"end"}}},g=w(Object.values(f),h),x="terminal"===e?r:i,p=i.length>1?"var(--rmg-theme-colour)":null!==(t=g.filter((function(n){return n.linePath.includes(o)&&n.linePath.includes(x[0])})).map((function(n){return n.colors[0][2]}))[0])&&void 0!==t?t:"var(--rmg-theme-colour)";return(0,d.jsxs)(d.Fragment,{children:["original"===e&&(0,d.jsx)("path",{transform:"translate(0,".concat(f.length?"198":"220",")").concat(f.length?"scale(1,2)":""),stroke:p,strokeWidth:12,d:"l"===u?"M ".concat(l.runin-24,",16 H 36"):"M24,16 H ".concat(l.runin-36),markerEnd:"url(#slope)"}),"terminal"===e&&(0,d.jsx)("g",{filter:"#999999"===s[2]?"url(#pujiang_outline_runin)":void 0,children:(0,d.jsx)("path",{transform:"translate(0,".concat(f.length?"198":"220",")").concat(f.length?"scale(1,2)":""),stroke:"var(--rmg-grey)",strokeWidth:12,d:"M24,16 H ".concat(l.runin-24)})}),(0,d.jsx)("g",{transform:"translate(".concat(m[u][e].x,",160)"),textAnchor:m[u][e].anchor,children:(0,d.jsx)(L,{})})]})},I=function(n){var t,e=n.prevStnIds,r=n.nextStnIds,i=(0,c.Qy)((function(n){return n.param})),a=i.direction,s=i.svgWidth,l=i.theme,u=i.coline,f=i.current_stn_idx,h=i.stn_list,m=(0,c.Qy)((function(n){return n.helper})).branches,g=s.runin/2,x=function(n){return n.includes("linestart")||n.includes("lineend")},p=w(Object.values(u),m),j=r.length>1?"single":x(r)?p.filter((function(n){return[f,e[0]].every((function(t){return n.linePath.includes(t)}))})).length>0?"multiple":"single":[f,r[0]].every((function(n){return m[0].includes(n)}))&&p.filter((function(n){return[f,r[0]].every((function(t){return n.linePath.includes(t)}))})).length>0?"multiple":"single",v=x(r)?e:r,_=r.length>1?"var(--rmg-theme-colour)":null!==(t=p.filter((function(n){return n.linePath.includes(f)&&n.linePath.includes(v[0])})).map((function(n){return n.colors[0][2]}))[0])&&void 0!==t?t:"var(--rmg-theme-colour)",y=Object.keys(u).length>0&&function(n,t,e,r){return n.slice(1).filter((function(n){return[t,e[0]].every((function(t){return n.includes(t)}))})).filter((function(n){return(0,o.Qo)(n,r)})).length>0}(m,f,r,h)?_:"var(--rmg-theme-colour)",Z=Object.keys(u).length>0&&1===r.length&&(!(!x(e)&&!x(r))||!([f,r[0]].every((function(n){return m[0].includes(n)}))&&0!==p.filter((function(n){return n.linePath.includes(f)&&n.linePath.includes(r[0])})).length)),k=Object.keys(u).length>0&&1===e.length;return(0,d.jsxs)("g",{transform:"translate(0,220)",strokeWidth:12,children:[(0,d.jsxs)(d.Fragment,{children:["var(--rmg-theme-colour)"!==y&&(0,d.jsx)("marker",{id:"slope_".concat(y),viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:y})}),(0,d.jsx)("path",{stroke:y,d:"M ".concat(g,",16 H ").concat("l"===a?36:s.runin-36),markerEnd:"var(--rmg-theme-colour)"===y?"url(#slope)":"url(#slope_".concat(y,")"),transform:Z?"translate(0,-22)scale(1,2)":void 0})]}),"multiple"===j&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("marker",{id:"slope_".concat(_),viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:_})}),(0,d.jsx)("path",{stroke:_,d:"M ".concat(g,",16 H ").concat("l"===a?48:s.runin-48),markerEnd:"url(#slope_".concat(_,")"),transform:"translate(0,-12)"})]}),(0,d.jsx)("g",{filter:"#999999"===l[2]?"url(#pujiang_outline_runin)":void 0,transform:"translate(0,".concat(k?-22:0,")scale(1,").concat(k?2:1,")"),children:(0,d.jsx)("path",{stroke:"var(--rmg-grey)",d:"M ".concat(g,",16 H ").concat("l"===a?s.runin-24:24," ")})})]})},N=function(n){var t=n.prevStnIds,e=n.nextStnIds,r=n.nextBranchLineDy,i=n.prevBranchLineDy,a=(0,c.Qy)((function(n){return n.param})),o=a.direction,s=a.svgWidth,l=a.current_stn_idx,u=a.coline,f=a.theme,h=(0,c.Qy)((function(n){return n.helper})).branches,m=s.runin/2,g=125,x=function(n){return"".concat(n[0],",").concat(n[1])},p=function(n){return"M".concat(x(n.at(0))," ")+n.slice(1).map((function(n){return"L".concat(x(n))})).join(" ")},j="l"===o?[[s.runin/3,g],[s.runin/6,r],[36,r]]:[[s.runin/3*2,g],[s.runin/6*5,r],[s.runin-36,r]],v="l"===o?[[s.runin/3*2,g],[s.runin/6*5,i],[s.runin-24,i]]:[[s.runin/3,g],[s.runin/6,i],[24,i]],_="var(--rmg-theme-colour)";if(Object.keys(u).length>0){var y=w(Object.values(u),h);e.length>1&&y.filter((function(n){return n.linePath.includes(l)&&e.some((function(t){return n.linePath.includes(t)}))}))&&(j[0][1]-=11,j.unshift([m,114]),_=y.filter((function(n){return n.linePath.includes(l)&&e.some((function(t){return n.linePath.includes(t)}))})).at(0).colors.at(0)[2]),t.length>1&&y.filter((function(n){return n.linePath.includes(l)&&t.some((function(t){return n.linePath.includes(t)}))}))&&(v[0][1]-=11,v.unshift([m,114]))}return(0,d.jsxs)("g",{transform:"translate(0,110)",strokeWidth:12,fill:"none",filter:"#999999"===f[2]?"url(#pujiang_outline_runin)":void 0,children:[(0,d.jsx)("marker",{id:"slope_branch",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:_})}),e.length>1&&(0,d.jsx)("path",{stroke:_,d:p(j),markerEnd:"url(#slope_branch)"}),t.length>1&&(0,d.jsx)("path",{stroke:"var(--rmg-grey)",d:p(v)})]})},L=function(){var n=(0,c.Qy)((function(n){return n.param})),t=n.stn_list[n.current_stn_idx].name;return(0,a.useMemo)((function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:112,children:t[0].replace("\\","")}),(0,d.jsx)("text",{className:"rmg-name__en",fontSize:36,dy:50,children:t[1].replace("\\","")})]})}),(0,i.Z)(t))},Q=function(n){var t=n.nextName,e=(0,Z.Z)(n,b);return(0,d.jsx)("g",(0,y.Z)((0,y.Z)({},e),{},{children:(0,a.useMemo)((function(){return(0,d.jsxs)(d.Fragment,{children:[t[0].split("\\").map((function(n,e,r){return(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:48,dy:-50*(r.length-1-e)-30*(t[1].split("\\").length-1),children:n},n)})),t[1].split("\\").map((function(n,t,e){return(0,d.jsx)("text",{className:"rmg-name__en",fontSize:24,dy:28+-30*(e.length-1-t),children:n},n)}))]})}),(0,i.Z)(t))}))},W=function(n){var t=(0,c.Qy)((function(n){return n.param})),e=n.stnIds.map((function(n){return t.stn_list[n].name})),r=(n.stnIds.length>1?15:125)+-50*e.map((function(n){return n[0].split("\\").length})).reduce((function(n,t){return n+t}),-e.length)+-30*e.map((function(n){return n[1].split("\\").length})).reduce((function(n,t){return n+t}),-e.length),i=70+(n.stnIds.length>1?-50*(e[0][0].split("\\").length-1)+-30*(e[0][1].split("\\").length-1):0);return(0,d.jsxs)("g",{fill:"gray",textAnchor:"l"===t.direction?"end":"start",transform:"translate(".concat("l"===t.direction?t.svgWidth.runin-36:36,",0)"),children:[(0,d.jsx)(Q,{nextName:e[0],transform:"translate(0,183)"}),n.stnIds.length>1&&(0,d.jsx)(Q,{nextName:e[1],transform:"translate(0,".concat(i,")")}),(0,d.jsxs)("g",{transform:"translate(0, ".concat(r,")"),children:[(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:22,children:"\u4e0a\u4e00\u7ad9"}),(0,d.jsx)("text",{className:"rmg-name__en",fontSize:12,dx:"l"===t.direction?-70:70,children:"Past Stop"})]})]})},F=function(n){var t=(0,c.Qy)((function(n){return n.param})),e=n.stnIds.map((function(n){return t.stn_list[n].name})),r=(n.stnIds.length>1?15:125)+-50*e.map((function(n){return n[0].split("\\").length})).reduce((function(n,t){return n+t}),-e.length)+-30*e.map((function(n){return n[1].split("\\").length})).reduce((function(n,t){return n+t}),-e.length),i=70+(n.stnIds.length>1?-50*(e[0][0].split("\\").length-1)+-30*(e[0][1].split("\\").length-1):0);return(0,d.jsxs)("g",{textAnchor:"l"===t.direction?"start":"end",transform:"translate(".concat("l"===t.direction?36:t.svgWidth.runin-36,",0)"),children:[(0,d.jsx)(Q,{nextName:t.stn_list[n.stnIds[0]].name,transform:"translate(0,183)"}),n.stnIds.length>1&&(0,d.jsx)(Q,{nextName:t.stn_list[n.stnIds[1]].name,transform:"translate(0,".concat(i,")")}),(0,d.jsxs)("g",{transform:"translate(0, ".concat(r,")"),children:[(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:22,children:"\u4e0b\u4e00\u7ad9"}),(0,d.jsx)("text",{className:"rmg-name__en",fontSize:12,dx:"l"===t.direction?70:-70,children:"Next Stop"})]})]})},P=e(4942),E=["stnName","oneLine","directionPolarity"],B=["intInfos","direction"],A=function(n){var t=n.stnId,e=n.stnState,r=n.color,a=n.bank,o=n.direction,s=(0,c.Qy)((function(n){return n.param})),l=s.direction,u=s.info_panel_type,f=s.stn_list,h=s.loop,m=f[t],g=null!==o&&void 0!==o?o:l,x=h?0:([].concat((0,i.Z)(m.branch.left),(0,i.Z)(m.branch.right)).length?8+12*m.name[1].split("\\").length:0)*("r"===g?-1:1),p="",j={};"sh2020"===u?(p=3===m.services.length?"stn_sh_2020_direct":2===m.services.length?"stn_sh_2020_express":"stn_sh_2020",j.fill=-1===e?"gray":r||"var(--rmg-theme-colour)"):(p=3===m.services.length?"direct_sh":2===m.services.length?"express_sh":[].concat((0,i.Z)(m.transfer.info[0]),(0,i.Z)(m.transfer.info[1]||[])).length>0?"int2_sh":"stn_sh",j.stroke=-1===e?"gray":r||"var(--rmg-theme-colour)");var v=null!==a&&void 0!==a?a:0,_=("l"===g?6:-6)+x+30*v,Z=("sh2020"===u?-20:-6)+Math.abs(v)*("sh2020"===u?25:11),k=v?0:"l"===g?-45:45;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("use",(0,y.Z)((0,y.Z)({xlinkHref:"#".concat(p)},j),{},{transform:"translate(".concat(v*("sh2020"===u?5:0),",0)")+"rotate(".concat(90*v*("sh2020"===u?1:-1),")")})),(0,d.jsx)("g",{transform:"translate(".concat(_,",").concat(Z,")rotate(").concat(k,")"),children:(0,d.jsx)(C,{name:m.name,infos:m.transfer.info,stnState:e,direction:g,facility:m.facility,bank:v,oneLine:m.one_line,intPadding:m.int_padding})}),0===e?(0,d.jsx)(D,{}):void 0]})},C=function(n){var t,e=n.name,c=n.infos,o=n.stnState,l=n.direction,u=n.facility,f=n.bank,h=n.oneLine,m=n.intPadding,g=a.useRef(null),x="l"===l?1:-1,p=u!==s.mV.none?30:0,j=f?-12:0,v=a.useRef(null),_=a.useState(0),y=(0,r.Z)(_,2),Z=y[0],k=y[1];a.useEffect((function(){var n,t;return k(null!==(n=null===(t=v.current)||void 0===t?void 0:t.getBBox().width)&&void 0!==n?n:0)}),(0,i.Z)(JSON.stringify(c)));var w=m-Z;return(0,d.jsxs)(d.Fragment,{children:[c.flat().length>0&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("line",{x1:(j+p)*x,x2:w*x,stroke:-1===o?"gray":"black",strokeWidth:.5}),(0,d.jsx)(V,{ref:v,intInfos:c,direction:l,transform:"translate(".concat(w*x,",-10.75)")})]}),u!==s.mV.none&&(0,d.jsx)("use",{xlinkHref:"#"+u,x:10*x,y:-30}),(0,d.jsxs)("g",{textAnchor:"l"===l?"start":"end",transform:"translate(".concat(p*x,",-14)"),children:[(0,d.jsx)(R,{ref:g,stnName:e,oneLine:h,directionPolarity:x,fill:-1===o?"gray":0===o?"red":"black"}),(null===(t=c[1])||void 0===t?void 0:t.length)>0&&(0,d.jsx)("g",{transform:"translate(".concat((w+Z/2)*x,",-30)"),children:(0,d.jsx)(T,{osiInfos:c[1]})}),(0,i.Z)(c[2]||[]).length>0&&(0,d.jsx)("g",{transform:"translate(".concat((m+5)*x,",0)"),children:(0,d.jsx)(X,{osysiInfos:c[2],direction:n.direction})})]})]})},R=a.forwardRef((function(n,t){var e=n.stnName,c=n.oneLine,o=n.directionPolarity,s=(0,Z.Z)(n,E),l=a.useRef(null),u=a.useState(0),f=(0,r.Z)(u,2),h=f[0],m=f[1];a.useEffect((function(){m(c?l.current.getBBox().width+5:0)}),[].concat((0,i.Z)(e),[c]));return(0,d.jsx)("g",(0,y.Z)((0,y.Z)({ref:t},s),{},{children:a.useMemo((function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("g",{ref:l,children:e[0].split("\\").map((function(n,t,r){return(0,d.jsx)("text",{className:"rmg-name__zh",dy:-20*(r.length-1-t)+(c?8:-8*(e[1].split("\\").length-1)),children:n},t)}))}),(0,d.jsx)("g",{fontSize:8,transform:"translate(".concat(h*o,",0)"),children:e[1].split("\\").map((function(n,t,e){return(0,d.jsx)("text",{className:"rmg-name__en",dy:-8*(e.length-2-t)+2,children:n},t)}))})]})}),[].concat((0,i.Z)(e),[c,h,o]))}))})),D=function(){var n=(0,c.Qy)((function(n){return n.param})).stn_list,t=[-1,35,50,75][new Set(Object.values(n).map((function(n){return n.services})).flat()).size];return(0,d.jsx)("g",{transform:"translate(0, ".concat(t,")"),children:(0,d.jsx)("text",{className:"rmg-name__zh",fill:"red",textAnchor:"middle",children:"\u672c\u7ad9"})})},V=a.forwardRef((function(n,t){var e,r=n.intInfos,a=(n.direction,(0,Z.Z)(n,B)),c=[].concat((0,i.Z)(r[0]),(0,i.Z)(r[1]||[]),(0,i.Z)((null===(e=r[2])||void 0===e?void 0:e.filter((function(n){return Boolean(n[4].match(/^\u78c1(\u60ac)*\u6d6e/))})))||[])),o=0;return(0,d.jsx)("g",(0,y.Z)((0,y.Z)({ref:t,fontSize:14,textAnchor:"middle"},a),{},{children:c.map((function(t,e){var r=Boolean(t[4].match(/^[\w\d]+(\u53f7)?\u7ebf/)),i=Boolean(t[4].match(/^\u78c1(\u60ac)*\u6d6e/));"r"===n.direction&&(o-=(r||i?20:14*t[4].length+12)+(0===e?0:5));var a=(0,d.jsx)("g",{});return a=i?(0,d.jsx)("g",{transform:"translate(".concat(o,",-16)scale(0.1428571429)"),children:(0,d.jsx)(Y,{info:t})},e):r?(0,d.jsx)("g",{transform:"translate(".concat(o,",0)"),children:(0,d.jsx)(G,{info:t})},e):(0,d.jsx)("g",{transform:"translate(".concat(o,",0)"),children:(0,d.jsx)(U,{info:t})},e),"l"===n.direction&&(o+=r||i?25:14*t[4].length+12+5),a}))}))})),Y=a.memo((function(n){return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("use",{xlinkHref:"#intbox_maglev",fill:n.info[2],stroke:n.info[2]})})}),(function(n,t){return n.info.toString()===t.info.toString()})),G=a.memo((function(n){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("use",{xlinkHref:"#intbox_number",fill:n.info[2]}),(0,d.jsx)("text",{x:10,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].match(/(\d*)\w+/)[0]})]})}),(function(n,t){return n.info.toString()===t.info.toString()})),U=a.memo((function(n){var t=n.info[4].split("\\")[0].length;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("rect",{height:22,width:14*t+12,y:-11,fill:n.info[2]}),(0,d.jsx)("text",{x:7*t+6,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].split("\\")[0]})]})}),(function(n,t){return n.info.toString()===t.info.toString()})),T=function(n){var t=n.osiInfos.map((function(n){return n[4]})).join("\uff0c");return a.useMemo((function(){return(0,d.jsxs)("g",{textAnchor:"middle",fontSize:"50%",children:[(0,d.jsx)("text",{className:"rmg-name__zh",dy:-5,children:"\u6362\u4e58".concat(t)}),(0,d.jsx)("text",{className:"rmg-name__zh",dy:5,children:"\u4ec5\u9650\u516c\u5171\u4ea4\u901a\u5361"}),(0,d.jsx)("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]})}),[t.toString()])},X=function(n){var t=n.osysiInfos.map((function(n){return n[4]})).join("\uff0c"),e=n.osysiInfos.map((function(n){return n[5]})).join(", ");return a.useMemo((function(){return(0,d.jsxs)("g",{textAnchor:"l"===n.direction?"start":"end",fontSize:"50%",children:[(0,d.jsxs)("text",{className:"rmg-name__zh",dy:3,children:["\u8f6c\u4e58",t]}),(0,d.jsxs)("text",{className:"rmg-name__en",dy:10,fontSize:"75%",children:["To ",e]})]})}),[n.osysiInfos.toString(),n.direction])},J=["shanghai","sh4","#5F259F","#fff","4\u53f7\u7ebf","Line 4"],K=function(n){var t=n.xs,e=n.servicesPresent,o=n.stnStates,s=(0,c.Qy)((function(n){return n.param})),l=s.svg_height,u=s.direction,f=s.stn_list,h=s.current_stn_idx,m=s.branchSpacingPct,g=s.info_panel_type,x=s.coline,p=(0,c.Qy)((function(n){return n.helper})),j=p.branches,v=p.depsStr,_=a.useMemo((function(){return console.log("computing y shares"),Object.keys(f).reduce((function(n,t){if(j[0].includes(t))return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,0));var e=j.slice(1).filter((function(n){return n.includes(t)}))[0];return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,f[e[0]].children.indexOf(e[1])?-3:3))}),{})}),[v]),Z=Object.entries(_).filter((function(n){var t=(0,r.Z)(n,2);t[0];return t[1]<=0})).reduce((function(n,t){var e=(0,r.Z)(t,2),i=e[0],a=e[1];return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},i,a))}),{}),b=Object.keys(Z).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,-Z[t]*m*l/300))}),{}),S=a.useMemo((function(){return function(n,t){return n.map((function(n){var e=(0,k.pS)(n.linePath,t);return{main:[{linePath:e.main,colors:n.colors}],pass:[{linePath:e.pass,colors:n.colors}]}})).reduce((function(n,t){return n.main=[].concat((0,i.Z)(n.main),(0,i.Z)(t.main)),n.pass=[].concat((0,i.Z)(n.pass),(0,i.Z)(t.pass)),n}),{main:[],pass:[]})}(w(Object.values(x).filter((function(n){return n.display})),j),o)}),[JSON.stringify(x),h,u,v]),M=e.reduce((function(n,r){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},r,Object.keys(S).reduce((function(n,i){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},i,S[i].map((function(n){return{path:rn(n.linePath,i,t,b,u,r,e.length,f,"diagonal"),colors:n.colors}})).filter((function(n){return""!==n.path}))))}),{})))}),{}),z=w(Object.values(x).filter((function(n){return n.display})),j).map((function(n){return n.linePath})).flat(),H="sh2020"===g?3:0;return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("g",{id:"coline",transform:"translate(0,".concat(12+H,")"),children:[(0,d.jsx)($,{paths:M,direction:u}),(0,d.jsx)(q,{colineStns:S,branches:j,xs:t,ys:b,stnStates:o,lineWidth:12,colineGap:H}),(0,d.jsx)(nn,{stnIds:Object.entries(_).filter((function(n){var t=(0,r.Z)(n,2);t[0];return t[1]<0})).reduce((function(n,t){var e=(0,r.Z)(t,2),a=e[0];e[1];return[].concat((0,i.Z)(n),[a])}),[]).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==f[n].services.length})).filter((function(n){return z.includes(n)})),xs:t,ys:b,stnStates:o})]})})},$=function(n){var t=n.paths,e=n.direction;return(0,d.jsx)(d.Fragment,{children:Object.keys(t).map((function(n,r){var i,c;return(0,d.jsx)("g",{transform:"translate(0,".concat(25*r,")"),children:(0,d.jsxs)("g",{children:[null===(i=t[n])||void 0===i?void 0:i.pass.map((function(t,e){return(0,d.jsx)(a.Fragment,{children:(0,d.jsx)("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:t.path,strokeLinejoin:"round",filter:n===s.K9.local?void 0:"url(#contrast-".concat(n,")")},e)},e)})),null===(c=t[n])||void 0===c?void 0:c.main.map((function(t,r){var i;return(0,d.jsxs)(a.Fragment,{children:[t.colors.length>1&&(0,d.jsx)("linearGradient",{id:"grad".concat(r),y1:"-100%",y2:"100%",x1:"0",x2:"0",gradientUnits:"userSpaceOnUse",children:t.colors.map((function(n,e){return(0,d.jsxs)(a.Fragment,{children:[(0,d.jsx)("stop",{offset:"".concat(100/t.colors.length*(e+0),"%"),stopColor:n[2]}),(0,d.jsx)("stop",{offset:"".concat(100/t.colors.length*(e+1),"%"),stopColor:n[2]})]},e)}))}),"l"===e&&(0,d.jsx)("marker",{id:"arrow_left_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_")),refY:.5,refX:1,children:(0,d.jsx)("path",{d:"M1,0L0,1H1z",fill:t.colors.length>1?"url(#grad".concat(r,")"):t.colors[0][2]})}),"r"===e&&(0,d.jsx)("marker",{id:"arrow_right_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_")),refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:t.colors.length>1?"url(#grad".concat(r,")"):t.colors[0][2]})}),(0,d.jsx)("path",{stroke:(null!==(i=t.colors.at(-1))&&void 0!==i?i:J)[2],strokeWidth:12,fill:"none",d:t.path,markerStart:"l"===e?"url(#arrow_left_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_"),")"):void 0,markerEnd:"r"===e?"url(#arrow_right_".concat(r,"_").concat(t.colors.map((function(n){return n[2]})).join("_"),")"):void 0,strokeLinejoin:"round",filter:n===s.K9.local?void 0:"url(#contrast-".concat(n,")")},r)]},r)}))]})},"servicePath".concat(r))}))})},q=function(n){var t=n.colineStns,e=n.branches,r=n.xs,a=n.ys,o=n.stnStates,s=n.lineWidth,l=n.colineGap,u=(0,c.Qy)((function(n){return n.param})),f=u.line_name,h=u.theme,m=u.info_panel_type,g=[].concat((0,i.Z)(t.main),(0,i.Z)(t.pass)).map((function(n){return n.linePath.map((function(t){var e;return{curStn:t,x:r[t],y:a[t],color:null!==(e=n.colors.at(-1))&&void 0!==e?e:[].concat((0,i.Z)(h),(0,i.Z)(f))}}))})).flat().reduce((function(n,t){return n.find((function(n){return n.curStn===t.curStn}))?n:n.concat(t)}),[]).filter((function(n){return e[0].includes(n.curStn)}));return console.log(g),(0,d.jsx)("g",{id:"stations_in_mainline",children:g.map((function(n){var t=n.curStn,e=n.x,r=n.y,i=n.color,a=(-1===o[t]?0:s)+l+s,c=(-1===o[t]?0:-s)-l-s/2;return(0,d.jsx)("g",{transform:"translate(".concat(e,",").concat(r,")"),children:"sh2020"===m?(0,d.jsx)("rect",{stroke:"none",height:a,width:12,x:-6,y:c,fill:-1===o[t]?"var(--rmg-grey)":i[2]}):(0,d.jsx)("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:"translate(0,".concat(-s,")")})},t)}))})},nn=function(n){var t=n.xs,e=n.ys,r=n.stnStates,o=n.stnIds,s=(0,c.Qy)((function(n){return n.helper})),l=s.branches,u=s.depsStr,f=(0,c.Qy)((function(n){return n.param})),h=f.line_name,m=f.theme,g=f.coline,x=a.useMemo((function(){return w(Object.values(g),l)}),[JSON.stringify(g),u]),p=o.reduce((function(n,t){var e;return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,null!==(e=x.filter((function(n){return n.linePath.includes(t)})).map((function(n){return n.colors})).flat().at(0))&&void 0!==e?e:[].concat((0,i.Z)(m),(0,i.Z)(h))))}),{});return(0,d.jsx)("g",{id:"stations_in_coline",children:o.map((function(n){return(0,d.jsx)("g",{transform:"translate(".concat(t[n],",").concat(e[n],")"),children:(0,d.jsx)(A,{stnId:n,stnState:r[n],color:p[n][2]})},n)}))})},tn=function(){var n=(0,c.Qy)((function(n){return n.helper})),t=n.routes,e=n.branches,i=n.depsStr,o=(0,c.Qy)((function(n){return n.param})),l=(0,c.Qy)((function(n){return n.param})),u=l.svg_height,f=l.stn_list,h=l.branchSpacingPct,m=l.coline,g=l.direction,x=(0,k.Az)(o.stn_list,(function(){return 0}),(function(){return 0})),p=(0,k.QE)("linestart","lineend",x),j=(0,k.QE)(p.nodes[1],p.nodes.slice(-2)[0],x),v=a.useMemo((function(){return console.log("computing x shares"),Object.keys(o.stn_list).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,(0,k.ML)(t,x,e)))}),{})}),[e.toString(),JSON.stringify(x)]),_=[o.svgWidth.railmap*o.padding/100,o.svgWidth.railmap*(1-o.padding/100)],Z=Object.keys(v).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,_[0]+v[t]/j.len*(_[1]-_[0])))}),{}),w=a.useMemo((function(){return console.log("computing y shares"),Object.keys(f).reduce((function(n,t){if(e[0].includes(t))return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,0));var r=e.slice(1).filter((function(n){return n.includes(t)}))[0];return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,f[r[0]].children.indexOf(r[1])?-3:3))}),{})}),[i]),b=Object.entries(w).filter((function(n){var t=(0,r.Z)(n,2);t[0];return t[1]>=0})).reduce((function(n,t){var e=(0,r.Z)(t,2),i=e[0],a=e[1];return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},i,a))}),{}),S=Object.keys(b).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,-b[t]*h*u/300))}),{}),M=a.useMemo((function(){return(0,k.h6)(o.current_stn_idx,t,o.direction)}),[o.current_stn_idx,o.direction,t.toString()]),z=Object.values(s.K9),H=Object.values(o.stn_list).map((function(n){return n.services})).flat().reduce((function(n,t){return n[z.indexOf(t)]=!0,n}),[!1,!1,!1]).map((function(n,t){return[z[t],n]})).filter((function(n){return n[1]})).map((function(n){return n[0]})),O=e.map((function(n){return(0,k.pS)(n,M)})).reduce((function(n,t){return n.main.push(t.main),n.pass.push(t.pass),n}),{main:[],pass:[]}),I=H.reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,Object.keys(O).reduce((function(n,e){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},e,O[e].map((function(n){return rn(n,e,Z,S,g,t,H.length,f)})).filter((function(n){return""!==n}))))}),{})))}),{});return(0,d.jsxs)("g",{id:"main",transform:"translate(0,".concat(o.svg_height*(Object.keys(m).length>0?.5:.7+.1),")"),children:[(0,d.jsx)(en,{paths:I,direction:o.direction}),(0,d.jsx)(an,{stnIds:Object.keys(b).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==f[n].services.length})),xs:Z,ys:S,stnStates:M}),Object.keys(m).length>0&&(0,d.jsx)(K,{xs:Z,servicesPresent:H,stnStates:M}),H.length>1&&(0,d.jsx)(cn,{servicesLevel:H,lineXs:_})]})},en=function(n){var t=(0,c.Qy)((function(n){return n.param})).theme,e=n.paths,r=n.direction;return(0,d.jsx)(d.Fragment,{children:Object.keys(e).map((function(i,a){var c,o;return(0,d.jsxs)("g",{transform:"translate(0,".concat(25*a,")"),filter:"#999999"===t[2]?"url(#pujiang_outline_railmap)":void 0,children:[(0,d.jsx)("g",{children:null===(c=e[i])||void 0===c?void 0:c.pass.map((function(t,e){return(0,d.jsx)("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:t,markerStart:"l"===n.direction?"url(#arrow_gray)":void 0,markerEnd:"r"===n.direction?"url(#arrow_gray)":void 0,strokeLinejoin:"round"},e)}))}),(0,d.jsx)("g",{children:null===(o=e[i])||void 0===o?void 0:o.main.map((function(n,t){return(0,d.jsx)("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:n,markerStart:"l"===r?"url(#arrow_theme_left)":void 0,markerEnd:"r"===r?"url(#arrow_theme_right)":void 0,strokeLinejoin:"round",filter:i===s.K9.local?void 0:"url(#contrast-".concat(i,")")},t)}))})]},"servicePath".concat(a))}))})},rn=function(n,t,e,i,a,c,o,s){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"rightangle",u=[],d=(0,r.Z)(u,2),f=d[0],h=d[1],m={},g={local:0,express:20,direct:40}[c],x=o>1?50:0,p=30;if(n.length>0){var j=!1,v=!1;s[n.at(-1)||0].children.some((function(n){return["linestart","lineend"].includes(n)}))?v=!0:s[n.at(0)||0].parents.some((function(n){return["linestart","lineend"].includes(n)}))&&(j=!0),p=j||v?p:0}var _=30;if(n.forEach((function(n){var t=e[n],r=i[n];if(!f&&0!==f)return h=t,f=r,void(m.start=[t,r]);0===r?r!==f&&(m.bifurcate=[h,f]):r!==f&&(m.bifurcate=[t,r]),m.end=[t,r],h=t,f=r})),m.hasOwnProperty("start")){if(m.hasOwnProperty("end")){if(m.hasOwnProperty("bifurcate")){var y=(0,r.Z)(m.start,2),Z=y[0],k=y[1],w=m.bifurcate[0],b=(0,r.Z)(m.end,2),S=b[0],M=b[1];return"main"===t?"l"===a?M>k?(console.log(m),"rightangle"===l?"M ".concat(Z-p,",").concat(k," H ").concat(S," V ").concat(M):"M ".concat(Z,",").concat(k," H ").concat(Z+_," L ").concat(w-_,",").concat(M," H ").concat(S)):"rightangle"===l?"M ".concat(Z,",").concat(k," V ").concat(M," H ").concat(S):"M ".concat(Z-p,",").concat(k," H ").concat(w+_," L ").concat(S-_,",").concat(M," H ").concat(S):M>k?"rightangle"===l?"M ".concat(Z,",").concat(k," H ").concat(S," V ").concat(M):"M ".concat(Z,",").concat(k," H ").concat(Z+_," L ").concat(w-_,",").concat(M," H ").concat(S+p):"rightangle"===l?"M ".concat(Z,",").concat(k," V ").concat(M," H ").concat(S+p):"M ".concat(Z,",").concat(k," H ").concat(w+_," L ").concat(S-_,",").concat(M," H ").concat(S):M>k?"rightangle"===l?"M ".concat(Z-p,",").concat(k," H ").concat(S," V ").concat(M):"M ".concat(Z,",").concat(k," H ").concat(Z+_," L ").concat(w-_,",").concat(M," H ").concat(S+p):"rightangle"===l?"M ".concat(Z,",").concat(k," V ").concat(M," H ").concat(S+p):"M ".concat(Z-p,",").concat(k," H ").concat(w+_," L ").concat(S-_,",").concat(M," H ").concat(S)}var z=(0,r.Z)(m.start,2),H=z[0],O=z[1],I=m.end[0];return"main"===t?"l"===a?"M ".concat(H-p-g,",").concat(O," H ").concat(I):"M ".concat(H,",").concat(O," H ").concat(I+p+g):"l"===a?"M ".concat(H-p,",").concat(O," H ").concat(I+p+x):"M ".concat(H-p-x,",").concat(O," H ").concat(I+p)}var N=(0,r.Z)(m.start,2),L=N[0],Q=N[1];return"main"===t?"l"===a?"M ".concat(L-p-g,",").concat(Q," H ").concat(L):"M ".concat(L,",").concat(Q," H ").concat(L+p+g):"l"===a?"M ".concat(L,",").concat(Q," L ").concat(L+p+x,",").concat(Q):"M ".concat(L-p-x,",").concat(Q," L ").concat(L,",").concat(Q)}return""},an=function(n){var t=n.xs,e=n.ys,r=n.stnStates,i=n.stnIds;return(0,d.jsx)("g",{children:i.map((function(n){return(0,d.jsx)("g",{transform:"translate(".concat(t[n],",").concat(e[n],")"),children:(0,d.jsx)(A,{stnId:n,stnState:r[n]})},n)}))})},cn=function(n){var t=(0,c.Qy)((function(n){return n.param})),e=t.svg_height,r=t.direction,i=t.svgWidth,o=130-e,s=n.servicesLevel.map((function(n){return{local:"\u666e\u901a\u8f66",express:"\u5927\u7ad9\u8f66",direct:"\u76f4\u8fbe\u8f66"}[n]})),l="r"===r?n.lineXs[0]-42:n.lineXs[1]+42,u=2===n.servicesLevel.length?350:500;return a.useMemo((function(){return(0,d.jsxs)("g",{children:[s.map((function(n,t){return(0,d.jsxs)("g",{transform:"translate(".concat(l,",").concat(25*t,")"),children:[(0,d.jsx)("rect",{x:-27.5,height:10,width:55,fill:"white",stroke:"black",y:-5}),(0,d.jsx)("text",{className:"rmg-name__zh",fontSize:9,y:3,textAnchor:"middle",children:"".concat(n,"\u8fd0\u884c\u7ebf")})]},n)})),(0,d.jsxs)("g",{transform:"translate(".concat("r"===r?30:i.railmap-u,",").concat(o,")"),children:[(0,d.jsx)("text",{className:"rmg-name__zh",children:"\u56fe\u4f8b\uff1a"}),s.map((function(n,t){return(0,d.jsxs)("g",{transform:"translate(".concat(150*t+50,",0)"),children:[(0,d.jsx)("line",{x1:"0",x2:"35",y1:"-5",y2:"-5",stroke:"var(--rmg-theme-colour)",strokeWidth:"12",filter:2===t?"url(#contrast-direct)":1===t?"url(#contrast-express)":""}),(0,d.jsx)("use",{x:"17.5",y:"-5",xlinkHref:"#stn_sh",fill:"var(--rmg-theme-colour)"}),(0,d.jsx)("text",{x:"40",className:"rmg-name__zh",children:"".concat(n,"\u505c\u9760\u7ad9")})]},"serviceLevel".concat(t))}))]})]})}),[e,r,i,n.servicesLevel,n.lineXs])},on=function(){var n=(0,c.Qy)((function(n){return n.param})),t=n.direction,e=n.svgWidth,r=n.coline,i=!!Object.keys(r).length;return a.useMemo((function(){return(0,d.jsxs)("g",{transform:"translate(".concat("l"===t?50:e.railmap-150,",50)"),children:[(0,d.jsx)("text",{className:"rmg-name__zh",children:"\u5217\u8f66\u524d\u8fdb\u65b9\u5411"}),(0,d.jsx)("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",stroke:i?"var(--rmg-black)":void 0,strokeWidth:i?5:void 0,fill:i?"var(--rmg-white)":"var(--rmg-theme-colour)",transform:"translate(".concat("l"===t?-30:125,",-5)rotate(").concat("l"===t?0:180,")scale(0.15)")})]})}),[t,r,e.railmap])},sn=["stnName","nameDirection"],ln=function(n){var t=n.stnId,e=n.nameDirection,r=n.services,a=n.color,o=(0,c.Qy)((function(n){return n.param.stn_list[t]})),s=[].concat((0,i.Z)(o.transfer.info[0]),(0,i.Z)(o.transfer.info[1]||[])),l="";l=3===o.services.length?"direct_indoor_sh":2===o.services.length?"express_indoor_sh":s.length>0?"int2_indoor_sh":"stn_indoor_sh";var u="left"===e||"right"===e?90:0;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(dn,{name:o.name,infos:o.transfer.info,nameDirection:e,services:r}),(0,d.jsx)("use",{xlinkHref:"#".concat(l),stroke:s.length>0?"var(--rmg-black)":null!==a&&void 0!==a?a:"var(--rmg-theme-colour)",transform:"rotate(".concat(u,")")}),o.services.length>1&&(0,d.jsx)("text",{className:"rmg-name__zh",writingMode:"tb",fontSize:"60%",dy:"-12",children:"\u5927\u7ad9\u8f66".concat(o.services.length>2?" \u76f4\u8fbe\u8f66":"","\u505c\u9760")})]})},un=ln,dn=function(n){var t,e,r,a,c,o,s,l,u=n.name,f=n.infos,h=n.nameDirection,m=n.services,g={upward:60,downward:-30,left:0,right:0}[h],x={upward:0,downward:0,left:85,right:-85}[h],p={upward:-185,downward:150+(3===m.length?40:0),left:-30,right:-30}[h],j=(null===(t=f[2])||void 0===t?void 0:t.length)>0?{upward:0,downward:0,left:f[0].length+f[1].length!==0?85:25,right:f[0].length+f[1].length!==0?-85:-25}[h]:0,v=(null===(e=f[2])||void 0===e?void 0:e.length)>0?{upward:null!==(r=f[1])&&void 0!==r&&r.length?-210:f[0].length?-180:-100,downward:(null!==(a=f[1])&&void 0!==a&&a.length?190:f[0].length?160:100)+(3===m.length?40:0),left:null!==(c=f[1])&&void 0!==c&&c.length?-60:f[0].length?-30:0,right:null!==(o=f[1])&&void 0!==o&&o.length?-60:f[0].length?-30:0}[h]:0;return(0,d.jsxs)("g",{transform:"translate(0,".concat(g,")"),children:["upward"===h||"downward"===h?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("line",{x1:-30,x2:30,y1:"upward"===h?-23:-10,y2:"upward"===h?-23:-10,stroke:"black"}),(0,d.jsx)("line",{y1:"upward"===h?-23:-10,y2:"upward"===h?-48:20,stroke:"black"})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("line",{x1:"left"===h?-50:15,x2:"left"===h?-15:50,y1:0,y2:0,stroke:"black"}),(0,d.jsx)("line",{x1:"left"===h?-50:50,x2:"left"===h?-50:50,y1:-30,y2:30,stroke:"black"})]}),[].concat((0,i.Z)(f[0]),(0,i.Z)(f[1]||[])).length>0&&(0,d.jsx)(hn,{intInfos:[].concat((0,i.Z)(f[0]),(0,i.Z)(f[1]||[])),arrowDirection:h,services:m}),(0,d.jsx)(fn,{stnName:u,nameDirection:h,fill:"black"}),(null===(s=f[1])||void 0===s?void 0:s.length)>0&&(0,d.jsx)("g",{transform:"translate(".concat(x,",").concat(p,")"),children:(0,d.jsx)(mn,{osiInfos:f[1],nameDirection:h})}),(null===(l=f[2])||void 0===l?void 0:l.length)>0&&(0,d.jsx)("g",{transform:"translate(".concat(j,",").concat(v,")"),children:(0,d.jsx)(gn,{osysiInfos:f[2],nameDirection:h})})]})},fn=a.forwardRef((function(n,t){var e=n.stnName,r=n.nameDirection,c=(0,Z.Z)(n,sn),o=e[0].split("\\"),s=e[1].split("\\").length,l={upward:0,downward:0,left:-60,right:60}[r],u={upward:-2,downward:-30-12*(s-1),left:-10*(s-1),right:-10*(s-1)}[r],f={upward:"middle",downward:"middle",left:"end",right:"start"}[r];return(0,d.jsx)("g",(0,y.Z)((0,y.Z)({ref:t},c),{},{textAnchor:f,transform:"translate(".concat(l,",").concat(u,")"),children:a.useMemo((function(){return(0,d.jsxs)(d.Fragment,{children:[o.map((function(n,t,e){return(0,d.jsx)("text",{className:"rmg-name__zh",dy:"upward"===r?16*t:-16*(e.length-1-t),children:n},t)})),(0,d.jsx)("g",{fontSize:9.6,children:e[1].split("\\").map((function(n,t){return(0,d.jsx)("text",{className:"rmg-name__en",dy:12*(t+1)+("upward"===r&&o.length>1?7.5*o.length:0),children:n},t)}))})]})}),(0,i.Z)(e))}))})),hn=function(n){var t=n.intInfos,e=n.arrowDirection,r=n.services,i=t.map((function(n){return n[2]})).reduce((function(n,t){return n+t}),""),c=[t.filter((function(n){return n[4].match(/^\d+.*$/)})).map((function(n){return n[4].replace(/^(\d+)(.*)$/,"$1")})).join("\uff0c").concat("\u53f7\u7ebf"),t.filter((function(n){return!n[4].match(/^\d+.*$/)})).map((function(n){return n[4]})).join("\uff0c")].filter((function(n){return n&&"\u53f7\u7ebf"!==n})).join("\uff0c"),o=["Line ".concat(t.filter((function(n){return n[5].match(/^L|line$/)})).map((function(n){return n[5].replace("Line","").replace("line","").trim()})).join(",")),t.filter((function(n){return!n[5].match(/^L|line$/)})).map((function(n){return n[5]})).join("\uff0c")].filter((function(n){return n&&"Line "!==n})).join(","),s=3===r.length?80:45,l={upward:-145,downward:125+(3===r.length?40:0),left:7,right:7}[e],u={upward:0,downward:0,left:20,right:-20}[e],f={upward:-74,downward:44,left:0,right:0}[e],h={upward:0,downward:180,left:90,right:-90}[e],m={upward:0,downward:0,left:85,right:-85}[e],g={upward:"middle",downward:"middle",left:"start",right:"end"}[e];return(0,d.jsxs)("g",{children:[(0,d.jsx)("path",{id:"int_indoor_arrow_sh",stroke:"var(--rmg-black)",strokeWidth:1,transform:"translate(".concat(u,",").concat(f,")rotate(").concat(h,")"),fill:1===t.length?t[0][2]:"url(#grad".concat(i,")"),d:"M -7.5,0 v -".concat(s," h -7.5 l 15,-15 l 15,15 h -7.5 v ").concat(s," Z")}),t.length>1&&(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("linearGradient",{id:"grad".concat(i),y1:"0",y2:"0",x1:"upward"===e?"25%":"75%",x2:"upward"===e?"75%":"25%",children:t.map((function(n,e){return(0,d.jsxs)(a.Fragment,{children:[(0,d.jsx)("stop",{offset:"".concat(100/t.length*(e+0),"%"),stopColor:n[2]}),(0,d.jsx)("stop",{offset:"".concat(100/t.length*(e+1),"%"),stopColor:n[2]})]},e)}))})}),(0,d.jsxs)("g",{transform:"translate(".concat(m,",").concat(l,")"),textAnchor:"".concat(g),children:[(0,d.jsx)("text",{className:"rmg-name__zh",dy:-7,children:"\u6362\u4e58".concat(c)}),(0,d.jsx)("text",{className:"rmg-name__en",dy:5,fontSize:9.6,children:"Interchange ".concat(o)})]})]})},mn=function(n){var t={upward:"middle",downward:"middle",left:"start",right:"end"}[n.nameDirection];return a.useMemo((function(){return(0,d.jsxs)("g",{textAnchor:"".concat(t),fontSize:"50%",children:[(0,d.jsx)("text",{className:"rmg-name__zh",dy:-5,children:"\u6362\u4e58".concat(n.osiInfos.map((function(n){return n[4]})).join("\uff0c"))}),(0,d.jsx)("text",{className:"rmg-name__zh",dy:5,children:"\u4ec5\u9650\u516c\u5171\u4ea4\u901a\u5361"}),(0,d.jsx)("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]})}),[n.osiInfos.toString(),n.nameDirection])},gn=function(n){var t={upward:"middle",downward:"middle",left:"start",right:"end"}[n.nameDirection];return a.useMemo((function(){return(0,d.jsxs)("g",{textAnchor:"".concat(t),children:[(0,d.jsx)("text",{className:"rmg-name__zh",dy:-5,children:"\u8f6c\u4e58".concat(n.osysiInfos.map((function(n){return n[4]})).join("\uff0c"))}),(0,d.jsx)("text",{className:"rmg-name__en",dy:7.5,fontSize:9.6,children:"To ".concat(n.osysiInfos.map((function(n){return n[5]})).join(", "))})]})}),[n.osysiInfos.toString(),n.nameDirection])},xn=function(n){var t,e,i,o,l=n.loop_branches,u=n.edges,f=n.xs,h=n.ys,m=n.canvas,g=(0,r.Z)(u,4),x=g[0],p=g[1],j=g[2],v=(g[3],(0,c.Qy)((function(n){return n.helper})).branches),_=(0,c.Qy)((function(n){return n.param})),y=_.current_stn_idx,Z=_.direction,k=_.coline,w=m===s.Ht.RailMap?30:0,b=["M ".concat(x,",").concat(j," H ").concat(Number(f[null!==(t=null===(e=l.at(0))||void 0===e?void 0:e.at(0))&&void 0!==t?t:""])-w),"M ".concat(p,",").concat(j," H ").concat(Number(f[null!==(i=null===(o=l.at(1))||void 0===o?void 0:o.at(-1))&&void 0!==i?i:""])+w)],S=v[0].filter((function(n){return!["linestart","lineend"].includes(n)})),M=Object.values(k).filter((function(n){return![n.from,n.to].every((function(n){return S.includes(n)}))})).map((function(n){return n.colors}));return(0,d.jsx)(d.Fragment,{children:l.map((function(n,t){var e,r,i;return(0,d.jsxs)(a.Fragment,{children:[M.filter((function(n,t,e){return t===e.findIndex((function(t){var e,r;return(null===(e=t.at(0))||void 0===e?void 0:e.at(2))===(null===(r=n.at(0))||void 0===r?void 0:r.at(2))}))})).map((function(n){return(0,d.jsx)("marker",{id:"arrow_theme_".concat(n[0][2]),refX:1,refY:.5,children:(0,d.jsx)("path",{d:"M0,1H2L1,0z",fill:n[0][2]})},n[0][2])})),(0,d.jsx)("path",{stroke:null!==(e=null===(r=M.at(t))||void 0===r||null===(i=r.at(0))||void 0===i?void 0:i.at(2))&&void 0!==e?e:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:b[t],markerEnd:m===s.Ht.RailMap&&("l"===Z&&0===t||"r"===Z&&1===t)?M.at(t)?"url(#arrow_theme_".concat(M[t][0][2],")"):"url(#arrow_theme)":void 0}),n.filter((function(n){return!["linestart","lineend"].includes(n)})).map((function(n){var e,r,i,c;return(0,d.jsxs)(a.Fragment,{children:[m===s.Ht.RailMap&&(0,d.jsx)("g",{transform:"translate(".concat(f[n],",").concat(h[n],")"),children:(0,d.jsx)(A,{stnId:n,stnState:y===n?0:1,bank:0,direction:Z,color:null===(e=M.at(t))||void 0===e||null===(r=e.at(0))||void 0===r?void 0:r.at(2)})},n),m===s.Ht.Indoor&&(0,d.jsx)("g",{transform:"translate(".concat(f[n],",").concat(h[n],")"),children:(0,d.jsx)(ln,{stnId:n,nameDirection:l.filter((function(t){return t.includes(n)})).map((function(t){return t.indexOf(n)%2===0?"downward":"upward"}))[0],services:[s.K9.local],color:null===(i=M.at(t))||void 0===i||null===(c=i.at(0))||void 0===c?void 0:c.at(2)})},n)]},n)}))]},n.at(0))}))})},pn=function(n){var t,e=n.edges,i=n.loop_stns,a=n.xs,l=n.ys,u=n.canvas,f=(0,r.Z)(e,4),h=f[0],m=f[1],g=f[2],x=(f[3],(0,c.Qy)((function(n){return n.param}))),p=x.info_panel_type,j=x.stn_list,v=x.coline,_=(0,c.Qy)((function(n){return n.helper})).branches,y=Object.values(v).filter((function(n){return[n.from,n.to].every((function(n){return _.slice(1,3).filter((function(n){return(0,o.Qo)(n,j)})).flat().includes(n)}))})).map((function(n){return n.colors})).at(0),Z=u===s.Ht.RailMap&&"sh2020"===p?3:0;return(0,d.jsxs)("g",{id:"coline_main",children:[(0,d.jsx)("path",{d:"M ".concat(h,",").concat(g," H").concat(m),strokeWidth:12,stroke:null===y||void 0===y||null===(t=y.at(0))||void 0===t?void 0:t.at(2)}),u===s.Ht.RailMap&&Object.keys(v).length>0&&i.top.map((function(n){var t;return(0,d.jsx)("g",{transform:"translate(".concat(a[n],",").concat(l[n],")"),children:"sh2020"===p?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("rect",{stroke:"none",height:24,width:12,x:-6,y:-Z-1,fill:null===y||void 0===y||null===(t=y.at(0))||void 0===t?void 0:t.at(2)}),(0,d.jsx)("rect",{stroke:"none",height:Z+12,width:12,x:-6,y:10,fill:"var(--rmg-theme-colour)"})]}):(0,d.jsx)("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:"translate(0,".concat(13,")")})},n)}))]})},jn=function(n){var t,e,a=n.bank_angle,u=n.canvas,f=(0,c.Qy)((function(n){return n.helper})).branches,h=(0,c.Qy)((function(n){return n.param})),m=h.current_stn_idx,g=h.svgWidth,x=h.svg_height,p=h.padding,j=h.branchSpacingPct,v=h.direction,_=h.info_panel_type,Z=h.stn_list,k=h.loop_info,w=k.left_and_right_factor,b=k.bottom_factor,S=h.coline,M=f[0].filter((function(n){return!["linestart","lineend"].includes(n)})),z=f.slice(0,3).flat().filter((e={},function(n){return 2===(e[n]=(e[n]||0)+1)})).filter((function(n){return!["linestart","lineend"].includes(n)})),H=null!==(t=Object.values(S).filter((function(n){return[n.from,n.to].every((function(n){return f.slice(1,3).filter((function(n){return(0,o.Qo)(n,Z)})).flat().includes(n)}))})).map((function(n){var t=M.findIndex((function(t){return t===n.from})),e=M.findIndex((function(t){return t===n.to}));return Math.abs(e-t)>M.length-2-Math.abs(e-t)?"major":"minor"})).at(0))&&void 0!==t?t:"minor",O=z.at(1)?function(n,t,e,i){var a=n.findIndex((function(n){return n===t[0]})),c=n.findIndex((function(n){return n===t[1]})),o=a>c?[c,a,t[1],t[0]]:[a,c,t[0],t[1]],s=(0,r.Z)(o,4);a=s[0],c=s[1],t[0]=s[2],t[1]=s[3];var u=n.slice(a,c+1),d=n.filter((function(n){return!u.filter((function(n){return!t.includes(n)})).includes(n)})),f=n.length-("major"===i?Math.max:Math.min)(u.length,d.length)-2*e,h="major"===i?u.length>d.length?t[0]:t[1]:u.length>d.length?t[1]:t[0];return l(n,h,f,e)}(M,z,w,H):z.at(0)?l(M,z[0],b,w):function(n,t,e,r){var a=n.length-2*r-e,c=n.findIndex((function(n){return n===t})),o=[].concat((0,i.Z)(n),(0,i.Z)(n),(0,i.Z)(n)),s=n.length+c-Math.floor(a/2)+(a%2===0?1:0),l=n.length+c+Math.floor(a/2);return{top:o.slice(s,l+1),left:o.slice(s-r,s),right:o.slice(l+1,l+1+r),bottom:o.slice(l+1+r,l+1+r+e)}}(M,m,b,w),I=function(n,t){var e=Object.fromEntries(n.map((function(n){return[n,-1]}))),r=Object.fromEntries(n.map((function(n){return[n,-1]})));return t.top.forEach((function(n,i){e[n]=0+1/(t.top.length+1)*(i+1),r[n]=0})),t.right.forEach((function(n,i){e[n]=1,r[n]=0+1/(t.right.length+1)*(i+1)})),t.bottom.forEach((function(n,i){e[n]=1-1/(t.bottom.length+1)*(i+1),r[n]=1})),t.left.forEach((function(n,i){e[n]=0,r[n]=1-1/(t.left.length+1)*(i+1)})),{x_shares:e,y_shares:r}}(M,O),N=I.x_shares,L=I.y_shares,Q=function(n,t,e,r,a,c){var o,s,l,u,d=n[0].filter((function(n){return!["linestart","lineend"].includes(n)})),f=n.slice(1,3).map((function(n){return n.slice(1,n.length-1)})),h=f.reduce((function(n,e){return n+e.filter((function(n){return!["linestart","lineend"].concat((0,i.Z)(t)).includes(n)})).length}),0)+d.length-c-2*a,m=(e-e*r/100*2)/(1+h),g=[e*r/100+(null!==(o=f.at(0))&&void 0!==o?o:[]).length*m,e*(1-r/100)-(null!==(s=f.at(1))&&void 0!==s?s:[]).length*m],x=(0,y.Z)((0,y.Z)({},Object.fromEntries((null!==(l=f.at(0))&&void 0!==l?l:[]).map((function(n,t){return[n,e*r/100+t*m]})))),Object.fromEntries((null!==(u=f.at(1))&&void 0!==u?u:[]).map((function(n,t){return[n,g[1]+(1+t)*m]}))));return{loop_branches:f,line_xs_branches:g,xs_branches:x}}(f,z,g[u],p,w,O.bottom.length),W=Q.loop_branches,F=Q.line_xs_branches,E=Q.xs_branches,B=(0,y.Z)((0,y.Z)({},L),Object.fromEntries(W.flat().map((function(n){return[n,0]})))),A=j*x/300,C=[225+A,x-75-(u===s.Ht.RailMap?0:125)-A],R=Object.keys(B).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,C[0]+B[t]*(C[1]-C[0])))}),{}),D=[Math.max(g[u]*p/100+(a&&u===s.Ht.RailMap?100:0),F[0]),Math.min(g[u]*(1-p/100)-(a&&u===s.Ht.RailMap?100:0),F[1])],V=Object.keys(N).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,D[0]+N[t]*(D[1]-D[0])))}),{}),Y=a?{l:1,r:-1}[v]:0;[].concat((0,i.Z)(O.right),(0,i.Z)(O.left)).forEach((function(n){V[n]-=(R[n]-C[0])*Y})),O.bottom.forEach((function(n){V[n]-=(C[1]-C[0])*Y}));var G=(0,y.Z)((0,y.Z)({},E),V),U=vn(O,G,R,Y,[].concat(D,C),v),T=u===s.Ht.RailMap&&"sh2020"===_?3:0;Object.keys(S).length>0&&O.top.forEach((function(n){R[n]-=T+12}));var X=W.length?0:(C[1]-C[0])*Y/2;return(0,d.jsxs)("g",{id:"loop",transform:"translate(".concat(X,",0)"),children:[(0,d.jsx)("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:U,strokeLinejoin:"round"}),u===s.Ht.RailMap&&(0,d.jsx)(_n,{canvas:u,loop_stns:O,xs:G,ys:R}),(0,d.jsxs)("g",{transform:"translate(0,".concat(Object.keys(S).length>0?-12-T:0,")"),children:[(0,d.jsx)(xn,{loop_branches:W,edges:[].concat(D,C),xs:G,ys:R,canvas:u}),Object.keys(S).length>0&&(0,d.jsx)(pn,{edges:[].concat(D,C),loop_stns:O,xs:G,ys:R,canvas:u})]}),u===s.Ht.Indoor&&(0,d.jsx)(_n,{canvas:u,loop_stns:O,xs:G,ys:R})]})},vn=function(n,t,e,i,a,c){var o=(0,r.Z)(a,4),s=o[0],l=o[1],u=o[2],d=o[3],f=function(n,t,e,r,a){return{right:[e+(r-u)*i,t],bottom:[n-(d-t)*i,r],left:[e-(d-r)*i,t],top:[n+(t-u)*i,r]}[a]},h=[];n.top.forEach((function(n){h.push([t[n],e[n]])})),["right","bottom","left"].forEach((function(r){if(n[r].length>0)h.push(f(h.at(-1)[0],h.at(-1)[1],t[n[r][0]],e[n[r][0]],r)),n[r].forEach((function(n){h.push([t[n],e[n]])}));else{var a={right:[l,h.at(-1)[1]],bottom:[h.at(-1)[0]+(d-h.at(-1)[1])*-i,h.at(-1)[1]+(d-h.at(-1)[1])],left:[s+(0===i?0:(d-u)*("l"===c?-1:1)),h.at(-1)[1]]};h.push(a[r])}})),h.push(f(h.at(-1)[0],h.at(-1)[1],t[n.top[0]],e[n.top[0]],"top"));var m=h.slice(1).map((function(n){var t=(0,r.Z)(n,2),e=t[0],i=t[1];return"L".concat(e,",").concat(i," ")})).join(" ");return"M".concat(h[0][0],",").concat(h[0][1]," ").concat(m," Z")},_n=function(n){var t=n.canvas,e=n.loop_stns,i=n.xs,a=n.ys,o=(0,c.Qy)((function(n){return n.param})).current_stn_idx,l={top:0,bottom:0,left:-1,right:1},u={left:"r",right:"l",top:void 0,bottom:void 0},f=function(n,t){return{top:t%2===0?"upward":"downward",bottom:t%2===0?"upward":"downward",left:"left",right:"right"}[n]};return(0,d.jsxs)("g",{id:"loop_stations",children:[t===s.Ht.RailMap&&Object.entries(e).map((function(n){var t=(0,r.Z)(n,2),e=t[0];return t[1].map((function(n){return(0,d.jsx)("g",{transform:"translate(".concat(i[n],",").concat(a[n],")"),children:(0,d.jsx)(A,{stnId:n,stnState:o===n?0:1,bank:l[e],direction:u[e]})},n)}))})),t===s.Ht.Indoor&&Object.entries(e).map((function(n){var t=(0,r.Z)(n,2),e=t[0];return t[1].map((function(n,t){return(0,d.jsx)("g",{transform:"translate(".concat(i[n],",").concat(a[n],")"),children:(0,d.jsx)(ln,{stnId:n,nameDirection:f(e,t),services:[s.K9.local]})},n)}))}))]})},yn=s.Ht.RailMap;function Zn(){var n=(0,c.Qy)((function(n){return n.app})).canvasScale,t=(0,c.Qy)((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,a=t.loop,o=t.loop_info.bank,l=e[yn];return(0,d.jsxs)(u.Z,{type:yn,svgWidth:l,svgHeight:r,canvasScale:n,theme:i,children:[(0,d.jsx)(kn,{}),a?(0,d.jsx)(jn,{bank_angle:o,canvas:s.Ht.RailMap}):(0,d.jsx)(tn,{}),(0,d.jsx)(on,{})]})}var kn=a.memo((function(){return(0,d.jsxs)("defs",{children:[(0,d.jsx)("circle",{id:"stn_sh",fill:"var(--rmg-white)",strokeWidth:2,r:5}),(0,d.jsx)("path",{id:"int2_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),(0,d.jsx)("path",{id:"express_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),(0,d.jsx)("path",{id:"direct_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V50 a 5,5 0 1 1 -10,0Z"}),(0,d.jsx)("rect",{id:"stn_sh_2020",stroke:"none",height:24,width:12,x:-6,y:-18}),(0,d.jsx)("rect",{id:"stn_sh_2020_express",stroke:"none",height:49,width:12,x:-6,y:-18}),(0,d.jsx)("rect",{id:"stn_sh_2020_direct",stroke:"none",height:74,width:12,x:-6,y:-18}),(0,d.jsx)("rect",{id:"intbox_number",height:22,width:20,y:-11}),(0,d.jsxs)("g",{id:"intbox_maglev",transform:"translate(-25,0)",children:[(0,d.jsx)("rect",{id:"maglev_5",height:144,width:130,y:"40",x:"30",strokeWidth:10}),(0,d.jsx)("path",{id:"maglev_3",fill:"var(--rmg-white)",d:"m90,55a40,5 0 0 0 -40,3a5,5 0 0 0 -5,5a5,60 0 0 0 -3,60a5,5 0 0 0 5,5l96,0a5,5 0 0 0 5,-5a5,60 0 0 0 -3,-60a5,5 0 0 0 -5,-5a40,5 0 0 0 -40,-3l-5,-10l-5,10"}),(0,d.jsx)("path",{id:"maglev_4",fill:"var(--rmg-white)",d:"m90,140l-40,0a10,5 0 0 1 -10,-5l0,25a10,15 0 0 0 10,15l15,0l0,-10l-15,0l0,-15l90,0l0,15l-15,0l0,10l15,0a10,15 0 0 0 10,-15l0,-25a10,5 0 0 1 -10,5l-50,0"}),(0,d.jsx)("rect",{id:"maglev_1",height:"25",width:"40",y:"80",x:"50"}),(0,d.jsx)("rect",{id:"maglev_2",height:"25",width:"40",y:"80",x:"100"})]}),(0,d.jsxs)("g",{id:"airport",transform:"scale(0.5)",children:[(0,d.jsx)("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),(0,d.jsx)("path",{id:"airport",d:"M28.9769,6.60134c1.711.013,3.111,2.53205,3.111,4.241v10.337s17.106,15.435,17.358,15.666a1.145,1.145,0,0,1,.488,1.152v2.833c0,.651-.451.61-.695.467-.334-.119-17.151-8.863-17.151-8.863-.004,1.458-.797,9.006-1.326,13.304,0,0,4.61,2.457,4.699,2.521.334.268.352.359.352.852v2.001c0,.477-.352.428-.51.324-.183-.062-5.693-1.921-5.693-1.921a2.56018,2.56018,0,0,0-.633-.127,2.31654,2.31654,0,0,0-.666.127s-5.477,1.859-5.672,1.921c-.185.104-.523.153-.523-.324v-2.001c0-.493.029-.584.367-.852.086-.064,4.678-2.521,4.678-2.521-.524-4.298-1.307-11.846-1.325-13.304,0,0-16.822,8.744-17.148,8.863-.217.143-.69.184-.69-.467v-2.833a1.16206,1.16206,0,0,1,.473-1.152c.276-.231,17.365-15.666,17.365-15.666v-10.337c0-1.709,1.403-4.228,3.14105-4.241",transform:"translate(-28.9697,0.14347)",fill:"var(--rmg-white)"})]}),(0,d.jsxs)("g",{id:"disney",transform:"scale(0.5)",children:[(0,d.jsx)("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),(0,d.jsx)("path",{fill:"var(--rmg-white)",d:"M45.6152,7.85015a9.80248,9.80248,0,0,0-9.79907,9.801,9.70059,9.70059,0,0,0,.342,2.582c.002.026.002.055.002.093a.31815.31815,0,0,1-.31494.318.67741.67741,0,0,1-.12806-.02,15.71521,15.71521,0,0,0-13.498,0,.61.61,0,0,1-.122.02.31841.31841,0,0,1-.322-.318v-.067a9.62553,9.62553,0,0,0,.35608-2.608,9.803,9.803,0,1,0-9.797,9.8,10.10364,10.10364,0,0,0,2.308-.271h.05493a.31113.31113,0,0,1,.31409.318.32433.32433,0,0,1-.019.12,15.72588,15.72588,0,1,0,29.703,7.216,15.83676,15.83676,0,0,0-1.746-7.23.18417.18417,0,0,1-.0271-.106.31612.31612,0,0,1,.32007-.318h.057a10.15953,10.15953,0,0,0,2.316.271,9.80051,9.80051,0,0,0,0-19.601",transform:"translate(-28.9697 0.13398)"})]}),(0,d.jsxs)("g",{id:"railway",children:[(0,d.jsx)("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)",transform:"translate(0,-2)scale(0.5)"}),(0,d.jsx)("path",{fill:"var(--rmg-white)",d:"M169,273.5c0-19,14.7-34.8,33.7-36.3c18.9-1.5,38.1-2.2,57.4-2.2c19.3,0,38.4,0.8,57.3,2.2  c19,1.5,33.7,17.3,33.7,36.3v47.3l-51.3,14.7c-11.2,3.2-18.9,13.4-18.9,25v147.8c0,17.4,12.2,32.3,29.3,35.7l110.6,22.1  c4.9,1,8.4,5.2,8.4,10.2V599H91v-22.7c0-5,3.5-9.2,8.4-10.2L209.9,544c17-3.4,29.3-18.3,29.3-35.7V360.5c0-11.6-7.7-21.8-18.9-25  L169,320.8V273.5z M309.4,31.7c0.2-1.2,0.3-2.4,0.3-3.6c0-14-11.1-25.4-24.9-26C276.6,1.4,268.3,1,260,1c-8.3,0-16.6,0.4-24.7,1.1  c-13.9,0.6-24.9,12-24.9,26c0,1.2,0.1,2.5,0.3,3.6C90.6,54.8,0,160.3,0,287c0,97.2,53.4,182,132.4,226.6l36.8-48.1  C104.3,432.4,59.8,364.9,59.8,287c0-110.6,89.6-200.2,200.2-200.2S460.2,176.4,460.2,287c0,77.9-44.5,145.4-109.4,178.5  c15,19.6,25.6,33.5,36.8,48.1C466.6,469,520,384.2,520,287C520,160.3,429.4,54.8,309.4,31.7z",transform:"translate(-10,0)scale(0.04)"})]}),(0,d.jsx)("marker",{id:"arrow_gray",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-grey)"})}),(0,d.jsx)("marker",{id:"arrow_theme_left",refX:1,refY:.5,children:(0,d.jsx)("path",{d:"M1,0L0,1H1z",fill:"var(--rmg-theme-colour)"})}),(0,d.jsx)("marker",{id:"arrow_theme_right",refY:.5,children:(0,d.jsx)("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),(0,d.jsx)("marker",{id:"arrow_theme",refX:1,refY:.5,children:(0,d.jsx)("path",{d:"M0,1H2L1,0z",fill:"var(--rmg-theme-colour)"})}),(0,d.jsx)("filter",{id:"contrast-direct",filterUnits:"userSpaceOnUse",children:(0,d.jsxs)("feComponentTransfer",{children:[(0,d.jsx)("feFuncR",{type:"linear",slope:.5,intercept:.25}),(0,d.jsx)("feFuncG",{type:"linear",slope:.5,intercept:.25}),(0,d.jsx)("feFuncB",{type:"linear",slope:.5,intercept:.25})]})}),(0,d.jsx)("filter",{id:"contrast-express",filterUnits:"userSpaceOnUse",children:(0,d.jsxs)("feComponentTransfer",{children:[(0,d.jsx)("feFuncR",{type:"linear",slope:.75,intercept:.125}),(0,d.jsx)("feFuncG",{type:"linear",slope:.75,intercept:.125}),(0,d.jsx)("feFuncB",{type:"linear",slope:.75,intercept:.125})]})}),(0,d.jsxs)("filter",{id:"pujiang_outline_railmap",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[(0,d.jsxs)("feComponentTransfer",{in:"SourceGraphic",children:[(0,d.jsx)("feFuncR",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),(0,d.jsx)("feFuncG",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),(0,d.jsx)("feFuncB",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"})]}),(0,d.jsx)("feColorMatrix",{type:"matrix",values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 1 1 1 1 -3",result:"selectedColor1"}),(0,d.jsx)("feMorphology",{operator:"erode",in:"selectedColor1",radius:"0",result:"e1"}),(0,d.jsx)("feMorphology",{operator:"erode",in:"selectedColor1",radius:"1",result:"e2"}),(0,d.jsx)("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"uncoloredOutline"}),(0,d.jsx)("feFlood",{floodColor:"rgb(0,0,0)"}),(0,d.jsx)("feComposite",{operator:"in",in2:"uncoloredOutline",result:"outline"}),(0,d.jsx)("feComposite",{in:"outline",in2:"selectedColor1",operator:"over",result:"result"}),(0,d.jsx)("feComposite",{in:"result",in2:"SourceGraphic",operator:"over"})]})]})})),wn=e(78359),bn=s.Ht.Indoor;function Sn(){var n=(0,c.Qy)((function(n){return n.app})).canvasScale,t=(0,c.Qy)((function(n){return n.param})),e=t.svgWidth,r=t.svg_height,i=t.theme,a=t.loop,o=e[bn];return(0,d.jsxs)(u.Z,{type:bn,svgWidth:o,svgHeight:r,canvasScale:n,theme:i,children:[(0,d.jsx)(Mn,{}),a?(0,d.jsx)(jn,{bank_angle:!1,canvas:s.Ht.Indoor}):(0,d.jsx)(On,{}),(0,d.jsx)(Ln,{})]})}var Mn=a.memo((function(){return(0,d.jsxs)("defs",{children:[(0,d.jsx)("circle",{id:"stn_indoor_sh",fill:"var(--rmg-white)",strokeWidth:5,r:8,transform:"scale(1.5)"}),(0,d.jsx)("path",{id:"int2_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),(0,d.jsx)("path",{id:"express_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),(0,d.jsx)("path",{id:"direct_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V40 a 5,5 0 1 1 -10,0Z"})]})})),zn=function(n,t){var e=0;return 2===n[t].parents.length&&(e+=1),2===n[n[t].parents[0]].children.length&&(e+=1),e},Hn=function(n,t){var e=0;return 2===n[t].children.length&&(e+=1),2===n[n[t].children[0]].parents.length&&(e+=1),e},On=function(){var n=(0,c.Qy)((function(n){return n.helper})),t=n.routes,e=n.branches,r=n.depsStr,i=(0,c.Qy)((function(n){return n.param})),o=(0,k.Az)(i.stn_list,zn,Hn),l=(0,k.QE)("linestart","lineend",o),u=(0,k.QE)(l.nodes[1],l.nodes.slice(-2)[0],o),f=a.useMemo((function(){return console.log("computing x shares"),Object.keys(i.stn_list).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,(0,k.ML)(t,o,e)))}),{})}),[e.toString(),JSON.stringify(o)]),h=[i.svgWidth.indoor*i.padding/100,i.svgWidth.indoor*(1-i.padding/100)],m=Object.keys(f).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,h[0]+f[t]/u.len*(h[1]-h[0])))}),{}),g=(0,a.useMemo)((function(){return wn.A_.getYShares(i.stn_list,e)}),[r]),x=Object.keys(g).reduce((function(n,t){return(0,y.Z)((0,y.Z)({},n),{},(0,P.Z)({},t,g[t]*i.branchSpacingPct*i.svg_height/200))}),{}),p=a.useMemo((function(){return(0,k.h6)(i.current_stn_idx,t,i.direction)}),[i.current_stn_idx,i.direction,t.toString()]),j=Object.values(s.K9),v=Object.values(i.stn_list).map((function(n){return n.services})).flat().reduce((function(n,t){return n[j.indexOf(t)]=!0,n}),[!1,!1,!1]).map((function(n,t){return[j[t],n]})).filter((function(n){return n[1]})).map((function(n){return n[0]})),_=wn.A_.drawLine(e,p,i.stn_list,h,m,x,i.branchSpacingPct*i.svg_height/200,l,0);return(0,d.jsxs)("g",{id:"main",transform:"translate(0,".concat(i.svg_height/2,")"),children:[(0,d.jsx)(In,{paths:_,services:v}),(0,d.jsx)(Nn,{xs:m,ys:x,services:v})]})},In=function(n){return(0,d.jsx)("g",{fill:"none",strokeWidth:12,stroke:"var(--rmg-theme-colour)",children:n.services.map((function(t,e){return(0,d.jsxs)("g",{transform:"translate(0, ".concat(30*e,")"),children:[n.paths.main.map((function(n,t){return(0,d.jsx)("path",{d:n},t)})),n.paths.pass.map((function(n,t){return(0,d.jsx)("path",{d:n},t)}))]},"indoor_line_".concat(e))}))})},Nn=function(n){var t=(0,c.Qy)((function(n){return n.helper})).branches,e=(0,c.Qy)((function(n){return n.param})),r=n.xs,i=n.ys,a=n.services;return(0,d.jsx)("g",{children:Object.keys(e.stn_list).filter((function(n){return!["linestart","lineend"].includes(n)})).filter((function(n){return 0!==e.stn_list[n].services.length})).map((function(n){return(0,d.jsx)("g",{transform:"translate(".concat(r[n],",").concat(i[n],")"),children:(0,d.jsx)(un,{stnId:n,nameDirection:t.filter((function(t){return t.includes(n)})).map((function(t){return t.indexOf(n)%2===0||a.length>1?"downward":"upward"}))[0],services:a})},n)}))})},Ln=function(){var n=(0,c.Qy)((function(n){return n.param}));return a.useMemo((function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("g",{transform:"translate(".concat(n.svgWidth.indoor/2,",50)"),children:(0,d.jsxs)("text",{textAnchor:"middle",fontSize:"30",className:"rmg-name__zh",children:["\u8f68\u9053\u4ea4\u901a",n.line_name[0],"\u8fd0\u8425\u7ebf\u8def\u793a\u610f\u56fe"]})}),(0,d.jsxs)("g",{transform:"translate(".concat(n.svgWidth.indoor/2,",").concat(n.svg_height-270,")"),children:[(0,d.jsx)("text",{textAnchor:"middle",fontSize:"18",className:"rmg-name__zh",dx:"-30",dy:"230",children:"\u53cb\u60c5\u63d0\u793a\uff1a\u8bf7\u7559\u610f\u60a8\u9700\u8981\u6362\u4e58\u7ebf\u8def\u7684\u9996\u672b\u73ed\u65f6\u95f4\uff0c\u4ee5\u514d\u803d\u8bef\u60a8\u7684\u51fa\u884c\uff0c\u672b\u73ed\u8f66\u8fdb\u7ad9\u524d\u4e09\u5206\u949f\u505c\u552e\u8be5\u672b\u73ed\u8f66\u8f66\u7968\u3002"}),(0,d.jsx)("text",{textAnchor:"middle",fontSize:"12",className:"rmg-name__en",dx:"10",dy:"250",children:"Please pay attention to the interchange schedule if you want to transfer to other lines. Stop selling tickets 3 minutes before the last train services."}),(0,d.jsxs)("g",{transform:"translate(-600,215)",children:[(0,d.jsx)("rect",{x:"-5",y:"-25",width:"100",height:"70",fill:"none",stroke:"black",rx:"5"}),(0,d.jsx)("line",{x1:"28",x2:"28",y1:"-20",y2:"40",stroke:"black"}),(0,d.jsx)("text",{className:"rmg-name__zh",dx:"3",fontSize:"18",children:"\u56fe"}),(0,d.jsx)("text",{className:"rmg-name__zh",dx:"3",dy:"18",fontSize:"18",children:"\u4f8b"}),(0,d.jsx)("text",{className:"rmg-name__en",dy:"35",fontSize:"8",children:"legend"}),(0,d.jsx)("use",{transform:"translate(45,10)",xlinkHref:"#int2_indoor_sh",stroke:"var(--rmg-theme-colour)"}),(0,d.jsx)("text",{className:"rmg-name__zh",dx:"60",dy:"10",fontSize:"10",children:"\u6362\u4e58\u7ad9"}),(0,d.jsx)("text",{className:"rmg-name__en",dx:"60",dy:"20",fontSize:"6",children:"Interchange"}),(0,d.jsx)("text",{className:"rmg-name__en",dx:"60",dy:"30",fontSize:"6",children:"Station"})]})]})]})}),[n.svgWidth.indoor,n.svg_height,n.line_name])},Qn={destination:(0,d.jsx)(h,{}),runin:(0,d.jsx)(M,{}),railmap:(0,d.jsx)(Zn,{}),indoor:(0,d.jsx)(Sn,{})}}}]);
//# sourceMappingURL=8049.291e8d14.chunk.js.map