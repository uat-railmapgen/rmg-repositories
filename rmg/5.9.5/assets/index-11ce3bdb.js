import{p as M,b as e,j as y,a9 as z,b4 as te}from"./vendor-fed6313f.js";import{ar as W,u as N,F as ne,j as A}from"./index-2366cb1b.js";import{i as X}from"./app-router-141a3360.js";import{S as U,d as de,a as me,c as Y,g as fe,b as ge}from"./share-dd02cfc4.js";import{a as re}from"./mtr-838ad449.js";const ve=(s,n,t,r)=>{const a=s.length-r*2-t,i=s.findIndex(d=>d===n),l=[...s,...s,...s],o=s.length+i-Math.floor(a/2)+(a%2===0?1:0),h=s.length+i+Math.floor(a/2);return{top:l.slice(o,h+1),left:l.slice(o-r,o),right:l.slice(h+1,h+1+r),bottom:l.slice(h+1+r,h+1+r+t)}},ue=(s,n,t,r)=>{const a=s.length-r*2-t,i=[...s,...s,...s],l=s.length+s.findIndex(d=>d===n),o=i[l+a-1],h=s.length+s.findIndex(d=>d===o)+(l+a>s.length*2?s.length:0);return{top:i.slice(l,h+1),left:i.slice(l-r,l),right:i.slice(h+1,h+1+r),bottom:i.slice(h+1+r,h+1+r+t)}},ye=(s,n,t,r)=>{let a=s.findIndex(g=>g===n[0]),i=s.findIndex(g=>g===n[1]);[a,i,n[0],n[1]]=a>i?[i,a,n[1],n[0]]:[a,i,n[0],n[1]];const l=s.slice(a,i+1),o=s.filter(g=>!l.filter(f=>!n.includes(f)).includes(g)),h=s.length-(r==="major"?Math.max:Math.min)(l.length,o.length)-t*2,d=r==="major"?l.length>o.length?n[0]:n[1]:l.length>o.length?n[1]:n[0];return ue(s,d,h,t)},Se=(s,n)=>{const t=Object.fromEntries(s.map(d=>[d,-1])),r=Object.fromEntries(s.map(d=>[d,-1])),[a,i,l,o]=[0,1,0,1],h=0;return n.top.forEach((d,g)=>{t[d]=h/2+(1-h)/(n.top.length+1)*(g+1),r[d]=a}),n.right.forEach((d,g)=>{t[d]=o,r[d]=h/2+(1-h)/(n.right.length+1)*(g+1)}),n.bottom.forEach((d,g)=>{t[d]=1-h/2-(1-h)/(n.bottom.length+1)*(g+1),r[d]=i}),n.left.forEach((d,g)=>{t[d]=l,r[d]=1-h/2-(1-h)/(n.left.length+1)*(g+1)}),{x_shares:t,y_shares:r}},ke=(s,n,t,r)=>{const a=s[0].filter(h=>!["linestart","lineend"].includes(h)),i=[...a,...a,...a],l=n==="r"?i:i.reverse(),o=l.findIndex(h=>r===h)+a.length;return l.slice(o+1).filter(h=>t[h].loop_pivot).slice(void 0,2)},se=W.Destination;function we(){const{canvasScale:s}=N(i=>i.app),{svgWidth:n,svg_height:t,theme:r}=N(i=>i.param),a=n[se];return y(U,{type:se,svgWidth:a,svgHeight:t,canvasScale:s,theme:r,children:[e(Me,{}),e(be,{})]})}const Me=M.memo(function(){return e("defs",{children:e("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})})})}),be=()=>{const{routes:s,branches:n}=N(v=>v.helper),{line_name:t,theme:r,current_stn_idx:a,direction:i,stn_list:l,info_panel_type:o,loop:h,coline:d}=N(v=>v.param),g=(v,w,S)=>[...new Set(v.filter(b=>b.includes(S)).map(b=>{const k=b.filter(H=>!["linestart","lineend"].includes(H));return w==="l"?k[0]:k.reverse()[0]}))],f=(v,w)=>w?[[v.map(S=>l[S].name[0]).join("，"),v.map(S=>l[S].name[1]).join(", ")].map(S=>S.replace("\\",""))]:v.map(S=>l[S].name.map(b=>b.replace("\\",""))),_=h?ke(n,i,l,a):g(s,i,a),p=(h?g(s,i,a):_).filter(v=>n.slice(1).filter(w=>X(w,l)).some(w=>w.includes(v))),c=_.filter(v=>!p.includes(v)),u=f(c,!h&&o!=="sh2020");console.log(u);const m=f(p,!0),x=250,$=Object.fromEntries(p.map(v=>[v,Object.values(d).filter(w=>w.from===v||w.to===v).at(0)]).filter(([,v])=>v));return y(z,{children:[e(ie,{dest_names:u,line_name:t,line_color:[r[2],r[3]],coline:!!p.length,upper:!!p.length}),p.length&&p.map(v=>{var w,S,b;return e("g",{transform:`translate(0,${-x})`,children:e(ie,{dest_names:[m.at(0)],line_name:(w=$[v])==null?void 0:w.colors.at(0).slice(4),line_color:[(S=$[v])==null?void 0:S.colors.at(0)[2],(b=$[v])==null?void 0:b.colors.at(0)[3]],coline:!0,upper:!1})},`coline_${v}`)})]})},ie=s=>{const{dest_names:n,line_name:t,line_color:r,coline:a,upper:i}=s,{current_stn_idx:l,direction:o,platform_num:h,svgWidth:d,svg_height:g}=N(w=>w.param),f=M.useRef(null),[_,p]=M.useState({width:0});M.useEffect(()=>{f.current&&p(f.current.getBBox())},[JSON.stringify(n),JSON.stringify(l)]);const[c,u,m,x,$]=[d.destination/2,10,36,264,325],v=c-u-m-_.width>=$/2&&c-u-m-x>=$/2?c:o==="l"?(d.destination+_.width-x)/2:(d.destination-_.width+x)/2;return y("g",{transform:`translate(0,${g-300})`,children:[e("path",{stroke:r[0],strokeWidth:12,d:o==="l"?`M${d.destination-24},16 H 36`:`M24,16 H ${d.destination-36}`,transform:`translate(0,${i?-20:220})`,markerEnd:a?void 0:"url(#slope)"}),e(Ne,{ref:f,dest_names:n}),h!==""&&e("g",{transform:`translate(${v},0)`,children:e(He,{})}),t[0].match(/^[\w\d]+(号)?线/)?e(Ie,{line_name:t,line_color:r}):e(Oe,{line_name:t,line_color:r})]})},Ne=M.forwardRef(function(n,t){const{dest_names:r}=n,{direction:a,svgWidth:i}=N(l=>l.param);return y("g",{ref:t,transform:`translate(${a==="l"?36:i.destination-36},145)`,children:[e("g",{transform:`translate(0,${r.length===2?-20:20})`,children:e("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",fill:"black",transform:`rotate(${a==="l"?0:180})scale(0.8)`})}),e("g",{textAnchor:a==="l"?"start":"end",transform:`translate(${a==="l"?128+20:-128-20},25)`,children:r.map((l,o)=>y(M.Fragment,{children:[e("text",{className:"rmg-name__zh",fontSize:70,dy:o*-100+7,children:"往"+l[0]},`zh${o}`),e("text",{className:"rmg-name__en",fontSize:25,dy:o*-100+40,children:"To "+l[1]},`en${o}`)]},o))})]})}),He=()=>{const{platform_num:s}=N(n=>n.param);return M.useMemo(()=>y("g",{transform:`translate(${-325/2+60},150)`,children:[e("circle",{r:60,fill:"none",stroke:"black",strokeWidth:2}),e("text",{className:"rmg-name__en",dominantBaseline:"central",fontSize:120,textAnchor:"middle",children:s}),e("text",{className:"rmg-name__zh",fontSize:100,dominantBaseline:"central",x:65,children:"站台"})]}),[s])},Oe=s=>{const{line_name:n,line_color:t}=s,{direction:r,svgWidth:a}=N(f=>f.param),i=r==="l"?a.destination-42:42,l=M.useRef(null),[o,h]=M.useState({width:0});M.useEffect(()=>{l.current&&h(l.current.getBBox())},[...n]);const d=(r==="l"?-o.width:0)-6,g=(r==="l"?-1:1)*o.width/2;return M.useMemo(()=>y("g",{transform:`translate(${i},92)`,children:[e("rect",{fill:t[0],x:d,width:o.width+10,height:120}),y("g",{textAnchor:r==="r"?"start":"end",transform:"translate(0,68)",fill:t[1],children:[e("g",{ref:l,children:e("text",{className:"rmg-name__zh",fontSize:68,children:n[0]})}),e("text",{className:"rmg-name__en",fontSize:30,textAnchor:"middle",x:g,dy:42,children:n[1]})]})]}),[o,...n,...t,r,a.destination])},Ie=s=>{const{line_name:n,line_color:t}=s,{direction:r,svgWidth:a}=N(h=>h.param),[i,l]=n[0].match(/^[\w\d]+|.+/g),o=r==="l"?a.destination-36-210:36+54;return M.useMemo(()=>y("g",{transform:`translate(${o},92)`,children:[e("rect",{fill:t[0],x:-54,width:108,height:120}),e("text",{className:"rmg-name__zh",fill:t[1],fontSize:96,textAnchor:"middle",dominantBaseline:"central",transform:"translate(0,60)",letterSpacing:-5,children:i}),y("g",{textAnchor:"start",transform:"translate(74,68)",children:[e("text",{className:"rmg-name__zh",fontSize:68,children:l}),e("text",{className:"rmg-name__en",fontSize:30,dy:42,children:n[1]})]})]}),[o,...n,...t,r,a.destination])},F=(s,n)=>s.map(t=>{const r=n.filter(h=>h.includes(t.from)&&h.includes(t.to));if(r.length!==1)return{linePath:[],colors:t.colors};const a=r.flat(),i=a.indexOf(t.from),l=a.indexOf(t.to);return{linePath:i<l?a.slice(i,l+1):a.slice(l,i+1),colors:t.colors}}).filter(t=>t.linePath.length!==0),ze=(s,n)=>s.map(t=>{const r=de(t.linePath,n);return{main:[{linePath:r.main,colors:t.colors}],pass:[{linePath:r.pass,colors:t.colors}]}}).reduce((t,r)=>(t.main=[...t.main,...r.main],t.pass=[...t.pass,...r.pass],t),{main:[],pass:[]}),R=12,le=W.RunIn,Le=()=>{const{canvasScale:s}=N(c=>c.app),{branches:n,routes:t,depsStr:r}=N(c=>c.helper),{svgWidth:a,svg_height:i,current_stn_idx:l,direction:o,loop:h,theme:d}=N(c=>c.param),g=a[le],f=i-300,_=M.useMemo(()=>{let c=t.filter(u=>u.includes(l)).map(u=>u[u.indexOf(l)+(o==="l"?1:-1)]).reduce((u,m)=>u.includes(m)?u:u.concat(m),[]);return h&&n[0].includes(l)&&c.length===1&&["linestart","lineend"].includes(c[0])&&(c=o==="l"?[n[0][1]]:[n[0][n[0].length-2]]),c},[r,l,o,h]),p=M.useMemo(()=>{let c=t.filter(u=>u.includes(l)).map(u=>u[u.indexOf(l)+(o==="l"?-1:1)]).reduce((u,m)=>u.includes(m)?u:u.concat(m),[]);return h&&n[0].includes(l)&&c.length===1&&["linestart","lineend"].includes(c[0])&&(c=o==="l"?[n[0][n[0].length-2]]:[n[0][1]]),c},[r,l,o,h]);return y(U,{type:le,svgWidth:g,svgHeight:i,canvasScale:s,theme:d,children:[e(je,{}),e("g",{transform:`translate(0,${f})`,children:e(We,{prevStnIds:_,nextStnIds:p})})]})},je=M.memo(function(){return y("defs",{children:[e("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),y("filter",{id:"pujiang_outline_runin",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[e("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"0",result:"e1"}),e("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"1",result:"e2"}),e("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"outline"}),e("feComposite",{in:"outline",in2:"SourceGraphic",operator:"over",result:"output"})]})]})}),We=s=>{const{prevStnIds:n,nextStnIds:t}=s,{info_panel_type:r,svgWidth:a,stn_list:i}=N(p=>p.param),l=a.runin/2,o=t.length===1&&["linestart","lineend"].includes(t[0]),h=n.length===1&&["linestart","lineend"].includes(n[0]),d=t.map(p=>i[p].name),g=n.map(p=>i[p].name),f=(t.length>1?(d[0][0].split("\\").length-1)*-50+(d[0][1].split("\\").length-1)*-30:0)+10,_=(n.length>1?(g[0][0].split("\\").length-1)*-50+(g[0][1].split("\\").length-1)*-30:0)+10;return y(z,{children:[e(Pe,{prevStnIds:n,nextStnIds:t,nextBranchLineDy:f,prevBranchLineDy:_}),o&&r!=="sh2020"?e(ae,{mode:"terminal",prevStnIds:n,nextStnIds:t}):h&&r!=="sh2020"?e(ae,{mode:"original",prevStnIds:n,nextStnIds:t}):y(z,{children:[e(Ee,{prevStnIds:n,nextStnIds:t}),e("g",{transform:`translate(${l},160)`,textAnchor:"middle",children:e(pe,{})})]}),(h||!o)&&e(Be,{stnIds:s.nextStnIds}),(o||!h)&&e(Te,{stnIds:s.prevStnIds})]})},ae=s=>{var c;const{mode:n,prevStnIds:t,nextStnIds:r}=s,{current_stn_idx:a,theme:i,svgWidth:l,direction:o,coline:h}=N(u=>u.param),{branches:d}=N(u=>u.helper),g={l:{original:{x:l.runin-36,anchor:"end"},terminal:{x:36,anchor:"start"}},r:{original:{x:36,anchor:"start"},terminal:{x:l.runin-36,anchor:"end"}}},f=F(Object.values(h),d),_=n==="terminal"?t:r,p=r.length>1?"var(--rmg-theme-colour)":(c=f.filter(u=>u.linePath.includes(a)&&u.linePath.includes(_[0])).map(u=>u.colors[0][2])[0])!=null?c:"var(--rmg-theme-colour)";return y(z,{children:[n==="original"&&e("path",{transform:`translate(0,${h.length?"198":"220"})${h.length?"scale(1,2)":""}`,stroke:p,strokeWidth:12,d:o==="l"?`M ${l.runin-24},16 H 36`:`M24,16 H ${l.runin-36}`,markerEnd:"url(#slope)"}),n==="terminal"&&e("g",{filter:i[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,children:e("path",{transform:`translate(0,${h.length?"198":"220"})${h.length?"scale(1,2)":""}`,stroke:"var(--rmg-grey)",strokeWidth:12,d:`M24,16 H ${l.runin-24}`})}),e("g",{transform:`translate(${g[o][n].x},160)`,textAnchor:g[o][n].anchor,children:e(pe,{})})]})},Ee=s=>{var w;const{prevStnIds:n,nextStnIds:t}=s,{direction:r,svgWidth:a,theme:i,coline:l,current_stn_idx:o,stn_list:h}=N(S=>S.param),{branches:d}=N(S=>S.helper),g=a.runin/2,f=S=>S.includes("linestart")||S.includes("lineend"),_=F(Object.values(l),d),p=t.length>1?"single":f(t)?_.filter(S=>[o,n[0]].every(b=>S.linePath.includes(b))).length>0?"multiple":"single":[o,t[0]].every(S=>d[0].includes(S))&&_.filter(S=>[o,t[0]].every(b=>S.linePath.includes(b))).length>0?"multiple":"single",c=f(t)?n:t,u=t.length>1?"var(--rmg-theme-colour)":(w=_.filter(S=>S.linePath.includes(o)&&S.linePath.includes(c[0])).map(S=>S.colors[0][2])[0])!=null?w:"var(--rmg-theme-colour)",m=(S,b,k,H)=>S.slice(1).filter(j=>[b,k[0]].every(L=>j.includes(L))).filter(j=>X(j,H)).length>0,x=Object.keys(l).length>0&&m(d,o,t,h)?u:"var(--rmg-theme-colour)",$=Object.keys(l).length>0&&t.length===1&&(f(n)||f(t)?!0:!([o,t[0]].every(S=>d[0].includes(S))&&_.filter(S=>S.linePath.includes(o)&&S.linePath.includes(t[0])).length!==0)),v=Object.keys(l).length>0&&n.length===1;return y("g",{transform:"translate(0,220)",strokeWidth:12,children:[y(z,{children:[x!=="var(--rmg-theme-colour)"&&e("marker",{id:`slope_${x}`,viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:x})}),e("path",{stroke:x,d:`M ${g},16 H ${r==="l"?36:a.runin-36}`,markerEnd:x==="var(--rmg-theme-colour)"?"url(#slope)":`url(#slope_${x})`,transform:$?"translate(0,-22)scale(1,2)":void 0})]}),p==="multiple"&&y(z,{children:[e("marker",{id:`slope_${u}`,viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:u})}),e("path",{stroke:u,d:`M ${g},16 H ${r==="l"?36+R:a.runin-(36+R)}`,markerEnd:`url(#slope_${u})`,transform:"translate(0,-12)"})]}),e("g",{filter:i[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,transform:`translate(0,${v?-22:0})scale(1,${v?2:1})`,children:e("path",{stroke:"var(--rmg-grey)",d:`M ${g},16 H ${r==="l"?a.runin-24:24} `})})]})},Pe=s=>{const{prevStnIds:n,nextStnIds:t,nextBranchLineDy:r,prevBranchLineDy:a}=s,{direction:i,svgWidth:l,current_stn_idx:o,coline:h,theme:d}=N($=>$.param),{branches:g}=N($=>$.helper),f=l.runin/2,_=125,p=$=>`${$[0]},${$[1]}`,c=$=>`M${p($.at(0))} `+$.slice(1).map(v=>`L${p(v)}`).join(" "),u=i==="l"?[[l.runin/3,_],[l.runin/6,r],[36,r]]:[[l.runin/3*2,_],[l.runin/6*5,r],[l.runin-36,r]],m=i==="l"?[[l.runin/3*2,_],[l.runin/6*5,a],[l.runin-24,a]]:[[l.runin/3,_],[l.runin/6,a],[24,a]];let x="var(--rmg-theme-colour)";if(Object.keys(h).length>0){const $=F(Object.values(h),g);t.length>1&&$.filter(v=>v.linePath.includes(o)&&t.some(w=>v.linePath.includes(w)))&&(u[0][1]-=R-1,u.unshift([f,_-R+1]),x=$.filter(v=>v.linePath.includes(o)&&t.some(w=>v.linePath.includes(w))).at(0).colors.at(0)[2]),n.length>1&&$.filter(v=>v.linePath.includes(o)&&n.some(w=>v.linePath.includes(w)))&&(m[0][1]-=R-1,m.unshift([f,_-R+1]))}return y("g",{transform:"translate(0,110)",strokeWidth:12,fill:"none",filter:d[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,children:[e("marker",{id:"slope_branch",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:x})}),t.length>1&&e("path",{stroke:x,d:c(u),markerEnd:"url(#slope_branch)"}),n.length>1&&e("path",{stroke:"var(--rmg-grey)",d:c(m)})]})},pe=()=>{const s=N(t=>t.param),{name:n}=s.stn_list[s.current_stn_idx];return M.useMemo(()=>y(z,{children:[e("text",{className:"rmg-name__zh",fontSize:112,children:n[0].replace("\\","")}),e("text",{className:"rmg-name__en",fontSize:36,dy:50,children:n[1].replace("\\","")})]}),[...n])},V=s=>{const{nextName:n,...t}=s;return e("g",{...t,children:M.useMemo(()=>y(z,{children:[n[0].split("\\").map((r,a,i)=>e("text",{className:"rmg-name__zh",fontSize:48,dy:(i.length-1-a)*-50-(n[1].split("\\").length-1)*30,children:r},r)),n[1].split("\\").map((r,a,i)=>e("text",{className:"rmg-name__en",fontSize:24,dy:28+(i.length-1-a)*-30,children:r},r))]}),[...n])})},Te=s=>{const n=N(i=>i.param),t=s.stnIds.map(i=>n.stn_list[i].name),r=(s.stnIds.length>1?15:125)+t.map(i=>i[0].split("\\").length).reduce((i,l)=>i+l,-t.length)*-50+t.map(i=>i[1].split("\\").length).reduce((i,l)=>i+l,-t.length)*-30,a=(s.stnIds.length>1?(t[0][0].split("\\").length-1)*-50+(t[0][1].split("\\").length-1)*-30:0)+70;return y("g",{fill:"gray",textAnchor:n.direction==="l"?"end":"start",transform:`translate(${n.direction==="l"?n.svgWidth.runin-36:36},0)`,children:[e(V,{nextName:t[0],transform:"translate(0,183)"}),s.stnIds.length>1&&e(V,{nextName:t[1],transform:`translate(0,${a})`}),y("g",{transform:`translate(0, ${r})`,children:[e("text",{className:"rmg-name__zh",fontSize:22,children:"上一站"}),e("text",{className:"rmg-name__en",fontSize:12,dx:n.direction==="l"?-70:70,children:"Past Stop"})]})]})},Be=s=>{const n=N(i=>i.param),t=s.stnIds.map(i=>n.stn_list[i].name),r=(s.stnIds.length>1?15:125)+t.map(i=>i[0].split("\\").length).reduce((i,l)=>i+l,-t.length)*-50+t.map(i=>i[1].split("\\").length).reduce((i,l)=>i+l,-t.length)*-30,a=(s.stnIds.length>1?(t[0][0].split("\\").length-1)*-50+(t[0][1].split("\\").length-1)*-30:0)+70;return y("g",{textAnchor:n.direction==="l"?"start":"end",transform:`translate(${n.direction==="l"?36:n.svgWidth.runin-36},0)`,children:[e(V,{nextName:n.stn_list[s.stnIds[0]].name,transform:"translate(0,183)"}),s.stnIds.length>1&&e(V,{nextName:n.stn_list[s.stnIds[1]].name,transform:`translate(0,${a})`}),y("g",{transform:`translate(0, ${r})`,children:[e("text",{className:"rmg-name__zh",fontSize:22,children:"下一站"}),e("text",{className:"rmg-name__en",fontSize:12,dx:n.direction==="l"?70:-70,children:"Next Stop"})]})]})},Z=s=>{const{stnId:n,stnState:t,color:r,bank:a,direction:i}=s,{direction:l,info_panel_type:o,stn_list:h,loop:d}=N(v=>v.param),g=h[n],f=i!=null?i:l,_=d?0:([...g.branch.left,...g.branch.right].length?8+12*g.name[1].split("\\").length:0)*(f==="r"?-1:1);let p;const c={};o==="sh2020"?(g.services.length===3?p="stn_sh_2020_direct":g.services.length===2?p="stn_sh_2020_express":p="stn_sh_2020",c.fill=t===-1?"gray":r||"var(--rmg-theme-colour)"):(g.services.length===3?p="direct_sh":g.services.length===2?p="express_sh":[...g.transfer.info[0],...g.transfer.info[1]||[]].length>0?p="int2_sh":p="stn_sh",c.stroke=t===-1?"gray":r||"var(--rmg-theme-colour)");const u=a!=null?a:0,m=(f==="l"?6:-6)+_+u*30,x=(o==="sh2020"?-20:-6)+Math.abs(u)*(o==="sh2020"?25:11),$=u?0:f==="l"?-45:45;return y(z,{children:[e("use",{xlinkHref:`#${p}`,...c,transform:`translate(${u*(o==="sh2020"?5:0)},0)rotate(${u*90*(o==="sh2020"?1:-1)})`}),e("g",{transform:`translate(${m},${x})rotate(${$})`,children:e(Ce,{name:g.name,infos:g.transfer.info,stnState:t,direction:f,facility:g.facility,bank:u,oneLine:g.one_line,intPadding:g.int_padding})}),t===0?e(Ae,{}):void 0]})},Ce=s=>{var x;const{name:n,infos:t,stnState:r,direction:a,facility:i,bank:l,oneLine:o,intPadding:h}=s,d=M.useRef(null),g=a==="l"?1:-1,f=i!==ne.none?30:0,_=l?-12:0,p=M.useRef(null),[c,u]=M.useState(0);M.useEffect(()=>{var $,v;return u((v=($=p.current)==null?void 0:$.getBBox().width)!=null?v:0)},[...JSON.stringify(t)]);const m=h-c;return y(z,{children:[t.flat().length>0&&y(z,{children:[e("line",{x1:(_+f)*g,x2:m*g,stroke:r===-1?"gray":"black",strokeWidth:.5}),e(Re,{ref:p,intInfos:t,direction:a,transform:`translate(${m*g},-10.75)`})]}),i!==ne.none&&e("use",{xlinkHref:"#"+i,x:10*g,y:-30}),y("g",{textAnchor:a==="l"?"start":"end",transform:`translate(${f*g},-14)`,children:[e(De,{ref:d,stnName:n,oneLine:o,directionPolarity:g,fill:r===-1?"gray":r===0?"red":"black"}),((x=t[1])==null?void 0:x.length)>0&&e("g",{transform:`translate(${(m+c/2)*g},-30)`,children:e(Ve,{osiInfos:t[1]})}),[...t[2]||[]].length>0&&e("g",{transform:`translate(${(h+5)*g},0)`,children:e(Xe,{osysiInfos:t[2],direction:s.direction})})]})]})},De=M.forwardRef(function(n,t){const{stnName:r,oneLine:a,directionPolarity:i,...l}=n,o=M.useRef(null),[h,d]=M.useState(0);M.useEffect(()=>{a&&o.current?d(o.current.getBBox().width+5):d(0)},[...r,a]);const[g,f]=[20,8];return e("g",{ref:t,...l,children:M.useMemo(()=>y(z,{children:[e("g",{ref:o,children:r[0].split("\\").map((_,p,c)=>e("text",{className:"rmg-name__zh rmg-outline",dy:(c.length-1-p)*-g+(a?f:(r[1].split("\\").length-1)*-f),children:_},p))}),e("g",{fontSize:8,transform:`translate(${h*i},0)`,children:r[1].split("\\").map((_,p,c)=>e("text",{className:"rmg-name__en rmg-outline",dy:(c.length-2-p)*-f+2,children:_},p))})]}),[...r,a,h,i])})}),Ae=()=>{const{stn_list:s}=N(r=>r.param),n=new Set(Object.values(s).map(r=>r.services).flat()),t=[-1,35,50,75][n.size];return e("g",{transform:`translate(0, ${t})`,children:e("text",{className:"rmg-name__zh",fill:"red",textAnchor:"middle",children:"本站"})})},Re=M.forwardRef(function(n,t){var h;const{intInfos:r,direction:a,...i}=n,l=[...r[0],...r[1]||[],...((h=r[2])==null?void 0:h.filter(d=>!!d[4].match(/^磁(悬)*浮/)))||[]];let o=0;return e("g",{ref:t,fontSize:14,textAnchor:"middle",...i,children:l.map((d,g)=>{const f=!!d[4].match(/^\w+(号)?线/),_=!!d[4].match(/^磁(悬)*浮/);n.direction==="r"&&(o-=(f||_?20:d[4].length*14+12)+(g===0?0:5));let p;return _?p=e("g",{transform:`translate(${o},-16)scale(0.1428571429)`,children:e(Fe,{info:d})},g):f?p=e("g",{transform:`translate(${o},0)`,children:e(Ge,{info:d})},g):p=e("g",{transform:`translate(${o},0)`,children:e(Ye,{info:d})},g),n.direction==="l"&&(o+=f||_?20+5:d[4].length*14+12+5),p})})}),Fe=M.memo(function(n){return e(z,{children:e("use",{xlinkHref:"#intbox_maglev",fill:n.info[2],stroke:n.info[2]})})},(s,n)=>s.info.toString()===n.info.toString()),Ge=M.memo(function(n){var t;return y(z,{children:[e("use",{xlinkHref:"#intbox_number",fill:n.info[2]}),e("text",{x:10,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:(t=n.info[4].match(/(\d*)\w+/))==null?void 0:t[0]})]})},(s,n)=>s.info.toString()===n.info.toString()),Ye=M.memo(function(n){const t=n.info[4].split("\\")[0].length;return y(z,{children:[e("rect",{height:22,width:t*14+12,y:-11,fill:n.info[2]}),e("text",{x:t*7+6,className:"rmg-name__zh",fill:n.info[3],dominantBaseline:"central",children:n.info[4].split("\\")[0]})]})},(s,n)=>s.info.toString()===n.info.toString()),Ve=s=>{const n=s.osiInfos.map(t=>t[4]).join("，");return M.useMemo(()=>y("g",{textAnchor:"middle",fontSize:"50%",children:[e("text",{className:"rmg-name__zh",dy:-5,children:`换乘${n}`}),e("text",{className:"rmg-name__zh",dy:5,children:"仅限公共交通卡"}),e("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]}),[n.toString()])},Xe=s=>{const n=s.osysiInfos.map(r=>r[4]).join("，"),t=s.osysiInfos.map(r=>r[5]).join(", ");return M.useMemo(()=>y("g",{textAnchor:s.direction==="l"?"start":"end",fontSize:"50%",children:[y("text",{className:"rmg-name__zh",dy:3,children:["转乘",n]}),y("text",{className:"rmg-name__en",dy:10,fontSize:"75%",children:["To ",t]})]}),[s.osysiInfos.toString(),s.direction])},Ue=["shanghai","sh4","#5F259F","#fff","4号线","Line 4"],Ze=s=>{const{xs:n,servicesPresent:t,stnStates:r}=s,{svg_height:a,direction:i,stn_list:l,current_stn_idx:o,branchSpacingPct:h,info_panel_type:d,coline:g}=N(S=>S.param),{branches:f,depsStr:_}=N(S=>S.helper),p=M.useMemo(()=>(console.log("computing y shares"),Object.keys(l).reduce((S,b)=>{if(f[0].includes(b))return{...S,[b]:0};{const k=f.slice(1).filter(H=>H.includes(b))[0];return{...S,[b]:l[k[0]].children.indexOf(k[1])?-3:3}}},{})),[_]),c=Object.entries(p).filter(([S,b])=>b<=0).reduce((S,[b,k])=>({...S,[b]:k}),{}),u=Object.keys(c).reduce((S,b)=>({...S,[b]:-c[b]*h*a/300}),{}),m=M.useMemo(()=>ze(F(Object.values(g).filter(S=>S.display),f),r),[JSON.stringify(g),o,i,_]),x=t.reduce((S,b)=>({...S,[b]:Object.keys(m).reduce((k,H)=>({...k,[H]:m[H].map(j=>({path:_e(j.linePath,H,n,u,i,b,t.length,l,"diagonal"),colors:j.colors})).filter(j=>j.path!=="")}),{})}),{}),$=F(Object.values(g).filter(S=>S.display),f).map(S=>S.linePath).flat(),v=12,w=d==="sh2020"?3:0;return e(z,{children:y("g",{id:"coline",transform:`translate(0,${v+w})`,children:[e(Je,{paths:x,direction:i}),e(qe,{colineStns:m,branches:f,xs:n,ys:u,stnStates:r,lineWidth:v,colineGap:w}),e(Ke,{stnIds:Object.entries(p).filter(([S,b])=>b<0).reduce((S,[b,k])=>[...S,b],[]).filter(S=>!["linestart","lineend"].includes(S)).filter(S=>l[S].services.length!==0).filter(S=>$.includes(S)),xs:n,ys:u,stnStates:r})]})})},Je=s=>{const{paths:n,direction:t}=s;return e(z,{children:Object.keys(n).map((r,a)=>{var i,l;return e("g",{transform:`translate(0,${a*25})`,children:y("g",{children:[(i=n[r])==null?void 0:i.pass.map((o,h)=>e(M.Fragment,{children:e("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:o.path,strokeLinejoin:"round",filter:r===A.local?void 0:`url(#contrast-${r})`},h)},h)),(l=n[r])==null?void 0:l.main.map((o,h)=>{var d;return y(M.Fragment,{children:[o.colors.length>1&&e("linearGradient",{id:`grad${h}`,y1:"-100%",y2:"100%",x1:"0",x2:"0",gradientUnits:"userSpaceOnUse",children:o.colors.map((g,f)=>y(M.Fragment,{children:[e("stop",{offset:`${100/o.colors.length*(f+0)}%`,stopColor:g[2]}),e("stop",{offset:`${100/o.colors.length*(f+1)}%`,stopColor:g[2]})]},f))}),t==="l"&&e("marker",{id:`arrow_left_${h}_${o.colors.map(g=>g[2]).join("_")}`,refY:.5,refX:1,children:e("path",{d:"M1,0L0,1H1z",fill:o.colors.length>1?`url(#grad${h})`:o.colors[0][2]})}),t==="r"&&e("marker",{id:`arrow_right_${h}_${o.colors.map(g=>g[2]).join("_")}`,refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:o.colors.length>1?`url(#grad${h})`:o.colors[0][2]})}),e("path",{stroke:((d=o.colors.at(-1))!=null?d:Ue)[2],strokeWidth:12,fill:"none",d:o.path,markerStart:t==="l"?`url(#arrow_left_${h}_${o.colors.map(g=>g[2]).join("_")})`:void 0,markerEnd:t==="r"?`url(#arrow_right_${h}_${o.colors.map(g=>g[2]).join("_")})`:void 0,strokeLinejoin:"round",filter:r===A.local?void 0:`url(#contrast-${r})`},h)]},h)})]})},`servicePath${a}`)})})},qe=s=>{const{colineStns:n,branches:t,xs:r,ys:a,stnStates:i,lineWidth:l,colineGap:o}=s,{line_name:h,theme:d,info_panel_type:g}=N(_=>_.param),f=[...n.main,...n.pass].map(_=>_.linePath.map(p=>{var c;return{curStn:p,x:r[p],y:a[p],color:(c=_.colors.at(-1))!=null?c:[...d,...h]}})).flat().reduce((_,p)=>_.find(c=>c.curStn===p.curStn)?_:_.concat(p),[]).filter(_=>t[0].includes(_.curStn));return console.log(f),e("g",{id:"stations_in_mainline",children:f.map(_=>{const{curStn:p,x:c,y:u,color:m}=_,x=(i[p]===-1?0:l)+o+l,$=(i[p]===-1?0:-l)-o-l/2;return e("g",{transform:`translate(${c},${u})`,children:g==="sh2020"?e("rect",{stroke:"none",height:x,width:12,x:-6,y:$,fill:i[p]===-1?"var(--rmg-grey)":m[2]}):e("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:`translate(0,${-l})`})},p)})})},Ke=s=>{const{xs:n,ys:t,stnStates:r,stnIds:a}=s,{branches:i,depsStr:l}=N(_=>_.helper),{line_name:o,theme:h,coline:d}=N(_=>_.param),g=M.useMemo(()=>F(Object.values(d),i),[JSON.stringify(d),l]),f=a.reduce((_,p)=>{var c;return{..._,[p]:(c=g.filter(u=>u.linePath.includes(p)).map(u=>u.colors).flat().at(0))!=null?c:[...h,...o]}},{});return e("g",{id:"stations_in_coline",children:a.map(_=>e("g",{transform:`translate(${n[_]},${t[_]})`,children:e(Z,{stnId:_,stnState:r[_],color:f[_][2]})},_))})},Qe=()=>{const{routes:s,branches:n,depsStr:t}=N(k=>k.helper),r=N(k=>k.param),{svg_height:a,stn_list:i,branchSpacingPct:l,coline:o,direction:h}=N(k=>k.param),d=me(r.stn_list,()=>0,()=>0),g=Y("linestart","lineend",d),f=Y(g.nodes[1],g.nodes.slice(-2)[0],d),_=M.useMemo(()=>(console.log("computing x shares"),Object.keys(r.stn_list).reduce((k,H)=>({...k,[H]:fe(H,d,n)}),{})),[n.toString(),JSON.stringify(d)]),p=[r.svgWidth.railmap*r.padding/100,r.svgWidth.railmap*(1-r.padding/100)],c=Object.keys(_).reduce((k,H)=>({...k,[H]:p[0]+_[H]/f.len*(p[1]-p[0])}),{}),u=M.useMemo(()=>(console.log("computing y shares"),Object.keys(i).reduce((k,H)=>{if(n[0].includes(H))return{...k,[H]:0};{const j=n.slice(1).filter(L=>L.includes(H))[0];return{...k,[H]:i[j[0]].children.indexOf(j[1])?-3:3}}},{})),[t]),m=Object.entries(u).filter(([,k])=>k>=0).reduce((k,[H,j])=>({...k,[H]:j}),{}),x=Object.keys(m).reduce((k,H)=>({...k,[H]:-m[H]*l*a/300}),{}),$=M.useMemo(()=>ge(r.current_stn_idx,s,r.direction),[r.current_stn_idx,r.direction,s.toString()]),v=Object.values(A),w=Object.values(r.stn_list).map(k=>k.services).flat().reduce((k,H)=>(k[v.indexOf(H)]=!0,k),[!1,!1,!1]).map((k,H)=>[v[H],k]).filter(k=>k[1]).map(k=>k[0]),S=n.map(k=>de(k,$)).reduce((k,H)=>(k.main.push(H.main),k.pass.push(H.pass),k),{main:[],pass:[]}),b=w.reduce((k,H)=>({...k,[H]:Object.keys(S).reduce((j,L)=>({...j,[L]:S[L].map(O=>_e(O,L,c,x,h,H,w.length,i)).filter(O=>O!=="")}),{})}),{});return y("g",{id:"main",transform:`translate(0,${r.svg_height*(Object.keys(o).length>0?.5:.7+.1)})`,children:[e(et,{paths:b,direction:r.direction}),e(tt,{stnIds:Object.keys(m).filter(k=>!["linestart","lineend"].includes(k)).filter(k=>i[k].services.length!==0),xs:c,ys:x,stnStates:$}),Object.keys(o).length>0&&e(Ze,{xs:c,servicesPresent:w,stnStates:$}),w.length>1&&e(nt,{servicesLevel:w,lineXs:p})]})},et=s=>{const{theme:n}=N(a=>a.param),{paths:t,direction:r}=s;return e(z,{children:Object.keys(t).map((a,i)=>{var l,o;return y("g",{transform:`translate(0,${i*25})`,filter:n[2]==="#999999"?"url(#pujiang_outline_railmap)":void 0,children:[e("g",{children:(l=t[a])==null?void 0:l.pass.map((h,d)=>e("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:h,markerStart:s.direction==="l"?"url(#arrow_gray)":void 0,markerEnd:s.direction==="r"?"url(#arrow_gray)":void 0,strokeLinejoin:"round"},d))}),e("g",{children:(o=t[a])==null?void 0:o.main.map((h,d)=>e("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:h,markerStart:r==="l"?"url(#arrow_theme_left)":void 0,markerEnd:r==="r"?"url(#arrow_theme_right)":void 0,strokeLinejoin:"round",filter:a===A.local?void 0:`url(#contrast-${a})`},d))})]},`servicePath${i}`)})})},_e=(s,n,t,r,a,i,l,o,h="rightangle")=>{let[d,g]=[];const f={},_={local:0,express:20,direct:40}[i],p=l>1?50:0;let c=30;if(s.length>0){let m=!1,x=!1;o[s.at(-1)||0].children.some($=>["linestart","lineend"].includes($))?x=!0:o[s.at(0)||0].parents.some($=>["linestart","lineend"].includes($))&&(m=!0),c=m||x?c:0}const u=30;if(s.forEach(m=>{const x=t[m],$=r[m];if(!d&&d!==0){[g,d]=[x,$],f.start=[x,$];return}$===0?$!==d&&(f.bifurcate=[g,d]):$!==d&&(f.bifurcate=[x,$]),f.end=[x,$],[g,d]=[x,$]}),"start"in f)if("end"in f)if("bifurcate"in f){const[m,x]=f.start,$=f.bifurcate[0],[v,w]=f.end;return n==="main"?a==="l"?w>x?(console.log(f),h==="rightangle"?`M ${m-c},${x} H ${v} V ${w}`:`M ${m},${x} H ${m+u} L ${$-u},${w} H ${v}`):h==="rightangle"?`M ${m},${x} V ${w} H ${v}`:`M ${m-c},${x} H ${$+u} L ${v-u},${w} H ${v}`:w>x?h==="rightangle"?`M ${m},${x} H ${v} V ${w}`:`M ${m},${x} H ${m+u} L ${$-u},${w} H ${v+c}`:h==="rightangle"?`M ${m},${x} V ${w} H ${v+c}`:`M ${m},${x} H ${$+u} L ${v-u},${w} H ${v}`:a==="l"?w>x?h==="rightangle"?`M ${m-c},${x} H ${v} V ${w}`:`M ${m},${x} H ${m+u} L ${$-u},${w} H ${v+c}`:h==="rightangle"?`M ${m},${x} V ${w} H ${v+c}`:`M ${m-c},${x} H ${$+u} L ${v-u},${w} H ${v}`:w>x?h==="rightangle"?`M ${m-c},${x} H ${v} V ${w}`:`M ${m},${x} H ${m+u} L ${$-u},${w} H ${v+c}`:h==="rightangle"?`M ${m},${x} V ${w} H ${v+c}`:`M ${m-c},${x} H ${$+u} L ${v-u},${w} H ${v}`}else{const[m,x]=f.start,$=f.end[0];return n==="main"?a==="l"?`M ${m-c-_},${x} H ${$}`:`M ${m},${x} H ${$+c+_}`:a==="l"?`M ${m-c},${x} H ${$+c+p}`:`M ${m-c-p},${x} H ${$+c}`}else{const[m,x]=f.start;return n==="main"?a==="l"?`M ${m-c-_},${x} H ${m}`:`M ${m},${x} H ${m+c+_}`:a==="l"?`M ${m},${x} L ${m+c+p},${x}`:`M ${m-c-p},${x} L ${m},${x}`}else return""},tt=s=>{const{xs:n,ys:t,stnStates:r,stnIds:a}=s;return e("g",{children:a.map(i=>e("g",{transform:`translate(${n[i]},${t[i]})`,children:e(Z,{stnId:i,stnState:r[i]})},i))})},nt=s=>{const{svg_height:n,direction:t,svgWidth:r}=N(h=>h.param),a=-n+130,i=s.servicesLevel.map(h=>({local:"普通车",express:"大站车",direct:"直达车"})[h]),l=t==="r"?s.lineXs[0]-42:s.lineXs[1]+42,o=s.servicesLevel.length===2?350:500;return M.useMemo(()=>y("g",{children:[i.map((h,d)=>y("g",{transform:`translate(${l},${d*25})`,children:[e("rect",{x:-27.5,height:10,width:55,fill:"white",stroke:"black",y:-5}),e("text",{className:"rmg-name__zh",fontSize:9,y:3,textAnchor:"middle",children:`${h}运行线`})]},h)),y("g",{transform:`translate(${t==="r"?30:r.railmap-o},${a})`,children:[e("text",{className:"rmg-name__zh",children:"图例："}),i.map((h,d)=>y("g",{transform:`translate(${d*150+50},0)`,children:[e("line",{x1:"0",x2:"35",y1:"-5",y2:"-5",stroke:"var(--rmg-theme-colour)",strokeWidth:"12",filter:d===2?"url(#contrast-direct)":d===1?"url(#contrast-express)":""}),e("use",{x:"17.5",y:"-5",xlinkHref:"#stn_sh",fill:"var(--rmg-theme-colour)"}),e("text",{x:"40",className:"rmg-name__zh",children:`${h}停靠站`})]},`serviceLevel${d}`))]})]}),[n,t,r,s.servicesLevel,s.lineXs])},rt=()=>{const{direction:s,svgWidth:n,coline:t}=N(a=>a.param),r=!!Object.keys(t).length;return M.useMemo(()=>y("g",{transform:`translate(${s==="l"?50:n.railmap-150},50)`,children:[e("text",{className:"rmg-name__zh",children:"列车前进方向"}),e("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",stroke:r?"var(--rmg-black)":void 0,strokeWidth:r?5:void 0,fill:r?"var(--rmg-white)":"var(--rmg-theme-colour)",transform:`translate(${s==="l"?-30:125},-5)rotate(${s==="l"?0:180})scale(0.15)`})]}),[s,t,n.railmap])},q=s=>{const{stnId:n,nameDirection:t,services:r,color:a}=s,i=N(d=>d.param.stn_list[n]),l=[...i.transfer.info[0],...i.transfer.info[1]||[]];let o;i.services.length===3?o="direct_indoor_sh":i.services.length===2?o="express_indoor_sh":l.length>0?o="int2_indoor_sh":o="stn_indoor_sh";const h=t==="left"||t==="right"?90:0;return y(z,{children:[e(st,{name:i.name,infos:i.transfer.info,nameDirection:t,services:r}),e("use",{xlinkHref:`#${o}`,stroke:l.length>0?"var(--rmg-black)":a!=null?a:"var(--rmg-theme-colour)",transform:`rotate(${h})`}),i.services.length>1&&e("text",{className:"rmg-name__zh",writingMode:"tb",fontSize:"60%",dy:"-12",children:`大站车${i.services.length>2?" 直达车":""}停靠`})]})},st=s=>{var g,f,_,p,c,u,m,x;const{name:n,infos:t,nameDirection:r,services:a}=s,i={upward:60,downward:-30,left:0,right:0}[r],l={upward:0,downward:0,left:85,right:-85}[r],o={upward:-185,downward:150+(a.length===3?40:0),left:-30,right:-30}[r],h=((g=t[2])==null?void 0:g.length)>0?{upward:0,downward:0,left:t[0].length+t[1].length!==0?85:25,right:t[0].length+t[1].length!==0?-85:-25}[r]:0,d=((f=t[2])==null?void 0:f.length)>0?{upward:(_=t[1])!=null&&_.length?-210:t[0].length?-180:-100,downward:((p=t[1])!=null&&p.length?190:t[0].length?160:100)+(a.length===3?40:0),left:(c=t[1])!=null&&c.length?-60:t[0].length?-30:0,right:(u=t[1])!=null&&u.length?-60:t[0].length?-30:0}[r]:0;return y("g",{transform:`translate(0,${i})`,children:[r==="upward"||r==="downward"?y(z,{children:[e("line",{x1:-30,x2:30,y1:r==="upward"?-23:-10,y2:r==="upward"?-23:-10,stroke:"black"}),e("line",{y1:r==="upward"?-23:-10,y2:r==="upward"?-23-25:20,stroke:"black"})]}):y(z,{children:[e("line",{x1:r==="left"?-50:15,x2:r==="left"?-15:50,y1:0,y2:0,stroke:"black"}),e("line",{x1:r==="left"?-50:50,x2:r==="left"?-50:50,y1:-30,y2:30,stroke:"black"})]}),[...t[0],...t[1]||[]].length>0&&e(lt,{intInfos:[...t[0],...t[1]||[]],arrowDirection:r,services:a}),e(it,{stnName:n,nameDirection:r,fill:"black"}),((m=t[1])==null?void 0:m.length)>0&&e("g",{transform:`translate(${l},${o})`,children:e(at,{osiInfos:t[1],nameDirection:r})}),((x=t[2])==null?void 0:x.length)>0&&e("g",{transform:`translate(${h},${d})`,children:e(ot,{osysiInfos:t[2],nameDirection:r})})]})},it=M.forwardRef(function(n,t){const{stnName:r,nameDirection:a,...i}=n,l=r[0].split("\\"),o=r[1].split("\\").length,h={upward:0,downward:0,left:-60,right:60}[a],d={upward:-2,downward:-30-12*(o-1),left:-10*(o-1),right:-10*(o-1)}[a],g={upward:"middle",downward:"middle",left:"end",right:"start"}[a];return e("g",{ref:t,...i,textAnchor:g,transform:`translate(${h},${d})`,children:M.useMemo(()=>y(z,{children:[l.map((f,_,p)=>e("text",{className:"rmg-name__zh",dy:a==="upward"?16*_:(p.length-1-_)*-16,children:f},_)),e("g",{fontSize:9.6,children:r[1].split("\\").map((f,_)=>e("text",{className:"rmg-name__en",dy:12*(_+1)+(a==="upward"&&l.length>1?l.length*7.5:0),children:f},_))})]}),[...r])})}),lt=s=>{const{intInfos:n,arrowDirection:t,services:r}=s,a=n.map(c=>c[2]).reduce((c,u)=>c+u,""),i=[n.filter(c=>c[4].match(/^\d+.*$/)).map(c=>c[4].replace(/^(\d+)(.*)$/,"$1")).join("，").concat("号线"),n.filter(c=>!c[4].match(/^\d+.*$/)).map(c=>c[4]).join("，")].filter(c=>c&&c!=="号线").join("，"),l=["Line ".concat(n.filter(c=>c[5].match(/^(L|l)ine$/)).map(c=>c[5].replace("Line","").replace("line","").trim()).join(",")),n.filter(c=>!c[5].match(/^(L|l)ine$/)).map(c=>c[5]).join("，")].filter(c=>c&&c!=="Line ").join(","),o=r.length===3?80:45,h={upward:-145,downward:125+(r.length===3?40:0),left:7,right:7}[t],d={upward:0,downward:0,left:20,right:-20}[t],g={upward:-74,downward:44,left:0,right:0}[t],f={upward:0,downward:180,left:90,right:-90}[t],_={upward:0,downward:0,left:85,right:-85}[t],p={upward:"middle",downward:"middle",left:"start",right:"end"}[t];return y("g",{children:[e("path",{id:"int_indoor_arrow_sh",stroke:"var(--rmg-black)",strokeWidth:1,transform:`translate(${d},${g})rotate(${f})`,fill:n.length===1?n[0][2]:`url(#grad${a})`,d:`M -7.5,0 v -${o} h -7.5 l 15,-15 l 15,15 h -7.5 v ${o} Z`}),n.length>1&&e(z,{children:e("linearGradient",{id:`grad${a}`,y1:"0",y2:"0",x1:t==="upward"?"25%":"75%",x2:t==="upward"?"75%":"25%",children:n.map((c,u)=>y(M.Fragment,{children:[e("stop",{offset:`${100/n.length*u}%`,stopColor:c[2]}),e("stop",{offset:`${100/n.length*(u+1)}%`,stopColor:c[2]})]},u))})}),y("g",{transform:`translate(${_},${h})`,textAnchor:`${p}`,children:[e("text",{className:"rmg-name__zh",dy:-7,children:`换乘${i}`}),e("text",{className:"rmg-name__en",dy:5,fontSize:9.6,children:`Interchange ${l}`})]})]})},at=s=>{const n={upward:"middle",downward:"middle",left:"start",right:"end"}[s.nameDirection];return M.useMemo(()=>y("g",{textAnchor:`${n}`,fontSize:"50%",children:[e("text",{className:"rmg-name__zh",dy:-5,children:`换乘${s.osiInfos.map(t=>t[4]).join("，")}`}),e("text",{className:"rmg-name__zh",dy:5,children:"仅限公共交通卡"}),e("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]}),[s.osiInfos.toString(),s.nameDirection])},ot=s=>{const n={upward:"middle",downward:"middle",left:"start",right:"end"}[s.nameDirection];return M.useMemo(()=>y("g",{textAnchor:`${n}`,children:[e("text",{className:"rmg-name__zh",dy:-5,children:`转乘${s.osysiInfos.map(t=>t[4]).join("，")}`}),e("text",{className:"rmg-name__en",dy:7.5,fontSize:9.6,children:`To ${s.osysiInfos.map(t=>t[5]).join(", ")}`})]}),[s.osysiInfos.toString(),s.nameDirection])},ct=(s,n,t,r,a,i)=>{var _,p,c,u;const l=s[0].filter(m=>!["linestart","lineend"].includes(m)),o=s.slice(1,3).map(m=>m.slice(1,m.length-1)),h=o.reduce((m,x)=>m+x.filter($=>!["linestart","lineend",...n].includes($)).length,0)+l.length-i-a*2,d=(t-t*r/100*2)/(1+h),g=[t*r/100+((_=o.at(0))!=null?_:[]).length*d,t*(1-r/100)-((p=o.at(1))!=null?p:[]).length*d],f={...Object.fromEntries(((c=o.at(0))!=null?c:[]).map((m,x)=>[m,t*r/100+x*d])),...Object.fromEntries(((u=o.at(1))!=null?u:[]).map((m,x)=>[m,g[1]+(1+x)*d]))};return{loop_branches:o,line_xs_branches:g,xs_branches:f}},ht=s=>{var $,v,w,S;const{loop_branches:n,edges:t,xs:r,ys:a,canvas:i}=s,[l,o,h,d]=t,{branches:g}=N(b=>b.helper),{current_stn_idx:f,direction:_,coline:p}=N(b=>b.param),c=i===W.RailMap?30:0,u=[`M ${l},${h} H ${Number(r[(v=($=n.at(0))==null?void 0:$.at(0))!=null?v:""])-c}`,`M ${o},${h} H ${Number(r[(S=(w=n.at(1))==null?void 0:w.at(-1))!=null?S:""])+c}`],m=g[0].filter(b=>!["linestart","lineend"].includes(b)),x=Object.values(p).filter(b=>![b.from,b.to].every(k=>m.includes(k))).map(b=>b.colors);return e(z,{children:n.map((b,k)=>{var H,j,L;return y(te.Fragment,{children:[x.filter((O,P,C)=>P===C.findIndex(B=>{var T,D;return((T=B.at(0))==null?void 0:T.at(2))===((D=O.at(0))==null?void 0:D.at(2))})).map(O=>e("marker",{id:`arrow_theme_${O[0][2]}`,refX:1,refY:.5,children:e("path",{d:"M0,1H2L1,0z",fill:O[0][2]})},O[0][2])),e("path",{stroke:(L=(j=(H=x.at(k))==null?void 0:H.at(0))==null?void 0:j.at(2))!=null?L:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:u[k],markerEnd:i===W.RailMap&&(_==="l"&&k===0||_==="r"&&k===1)?x.at(k)?`url(#arrow_theme_${x[k][0][2]})`:"url(#arrow_theme)":void 0}),b.filter(O=>!["linestart","lineend"].includes(O)).map(O=>{var P,C,B,T;return y(te.Fragment,{children:[i===W.RailMap&&e("g",{transform:`translate(${r[O]},${a[O]})`,children:e(Z,{stnId:O,stnState:f===O?0:1,bank:0,direction:_,color:(C=(P=x.at(k))==null?void 0:P.at(0))==null?void 0:C.at(2)})},O),i===W.Indoor&&e("g",{transform:`translate(${r[O]},${a[O]})`,children:e(q,{stnId:O,nameDirection:n.filter(D=>D.includes(O)).map(D=>D.indexOf(O)%2===0?"downward":"upward")[0],services:[A.local],color:(T=(B=x.at(k))==null?void 0:B.at(0))==null?void 0:T.at(2)})},O)]},O)})]},b.at(0))})})},dt=s=>{var x;const{edges:n,loop_stns:t,xs:r,ys:a,canvas:i}=s,[l,o,h,d]=n,{info_panel_type:g,stn_list:f,coline:_}=N($=>$.param),{branches:p}=N($=>$.helper),c=Object.values(_).filter($=>[$.from,$.to].every(v=>p.slice(1,3).filter(w=>X(w,f)).flat().includes(v))).map($=>$.colors).at(0),u=12,m=i===W.RailMap&&g==="sh2020"?3:0;return y("g",{id:"coline_main",children:[e("path",{d:`M ${l},${h} H${o}`,strokeWidth:12,stroke:(x=c==null?void 0:c.at(0))==null?void 0:x.at(2)}),i===W.RailMap&&Object.keys(_).length>0&&t.top.map($=>{var v;return e("g",{transform:`translate(${r[$]},${a[$]})`,children:g==="sh2020"?y(z,{children:[e("rect",{stroke:"none",height:24,width:12,x:-6,y:-m-1,fill:(v=c==null?void 0:c.at(0))==null?void 0:v.at(2)}),e("rect",{stroke:"none",height:m+u,width:12,x:-6,y:u-2,fill:"var(--rmg-theme-colour)"})]}):e("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:`translate(0,${1+u})`})},$)})]})},xe=s=>{var ee;const{bank_angle:n,canvas:t}=s,{branches:r}=N(I=>I.helper),{current_stn_idx:a,svgWidth:i,svg_height:l,padding:o,branchSpacingPct:h,direction:d,info_panel_type:g,stn_list:f,loop_info:{left_and_right_factor:_,bottom_factor:p},coline:c}=N(I=>I.param),u=r[0].filter(I=>!["linestart","lineend"].includes(I)),m=r.slice(0,3).flat().filter((I=>E=>(I[E]=(I[E]||0)+1)===2)({})).filter(I=>!["linestart","lineend"].includes(I)),x=(ee=Object.values(c).filter(I=>[I.from,I.to].every(E=>r.slice(1,3).filter(G=>X(G,f)).flat().includes(E))).map(I=>{const E=u.findIndex(J=>J===I.from),G=u.findIndex(J=>J===I.to);return Math.abs(G-E)>u.length-2-Math.abs(G-E)?"major":"minor"}).at(0))!=null?ee:"minor",$=m.at(1)?ye(u,m,_,x):m.at(0)?ue(u,m[0],p,_):ve(u,a,p,_),{x_shares:v,y_shares:w}=Se(u,$),{loop_branches:S,line_xs_branches:b,xs_branches:k}=ct(r,m,i[t],o,_,$.bottom.length),H={...w,...Object.fromEntries(S.flat().map(I=>[I,0]))},j=h*l/300,L=[225+j,l-75-(t===W.RailMap?0:125)-j],O=Object.keys(H).reduce((I,E)=>({...I,[E]:L[0]+H[E]*(L[1]-L[0])}),{}),P=[Math.max(i[t]*o/100+(n&&t===W.RailMap?100:0),b[0]),Math.min(i[t]*(1-o/100)-(n&&t===W.RailMap?100:0),b[1])],C=Object.keys(v).reduce((I,E)=>({...I,[E]:P[0]+v[E]*(P[1]-P[0])}),{}),B=n?{l:1,r:-1}[d]:0;[...$.right,...$.left].forEach(I=>{C[I]-=(O[I]-L[0])*B}),$.bottom.forEach(I=>{C[I]-=(L[1]-L[0])*B});const T={...k,...C},D=mt($,T,O,B,[...P,...L],d),K=12,Q=t===W.RailMap&&g==="sh2020"?3:0;Object.keys(c).length>0&&$.top.forEach(I=>{O[I]-=Q+K});const $e=S.length?0:(L[1]-L[0])*B/2;return y("g",{id:"loop",transform:`translate(${$e},0)`,children:[e("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:D,strokeLinejoin:"round"}),t===W.RailMap&&e(oe,{canvas:t,loop_stns:$,xs:T,ys:O}),y("g",{transform:`translate(0,${Object.keys(c).length>0?-K-Q:0})`,children:[e(ht,{loop_branches:S,edges:[...P,...L],xs:T,ys:O,canvas:t}),Object.keys(c).length>0&&e(dt,{edges:[...P,...L],loop_stns:$,xs:T,ys:O,canvas:t})]}),t===W.Indoor&&e(oe,{canvas:t,loop_stns:$,xs:T,ys:O})]})},mt=(s,n,t,r,a,i)=>{const[l,o,h,d]=a,g=(p,c,u,m,x)=>({right:[u+(m-h)*r,c],bottom:[p-(d-c)*r,m],left:[u-(d-m)*r,c],top:[p+(c-h)*r,m]})[x],f=[];s.top.forEach(p=>{f.push([n[p],t[p]])}),["right","bottom","left"].forEach(p=>{if(s[p].length>0)f.push(g(f.at(-1)[0],f.at(-1)[1],n[s[p][0]],t[s[p][0]],p)),s[p].forEach(c=>{f.push([n[c],t[c]])});else{const c={right:[o,f.at(-1)[1]],bottom:[f.at(-1)[0]+(d-f.at(-1)[1])*-r,f.at(-1)[1]+(d-f.at(-1)[1])],left:[l+(r===0?0:(d-h)*(i==="l"?-1:1)),f.at(-1)[1]]};f.push(c[p])}}),f.push(g(f.at(-1)[0],f.at(-1)[1],n[s.top[0]],t[s.top[0]],"top"));const _=f.slice(1).map(([p,c])=>`L${p},${c} `).join(" ");return`M${f[0][0]},${f[0][1]} ${_} Z`},oe=s=>{const{canvas:n,loop_stns:t,xs:r,ys:a}=s,{current_stn_idx:i}=N(d=>d.param),l={top:0,bottom:0,left:-1,right:1},o={left:"r",right:"l",top:void 0,bottom:void 0},h=(d,g)=>({top:g%2===0?"upward":"downward",bottom:g%2===0?"upward":"downward",left:"left",right:"right"})[d];return y("g",{id:"loop_stations",children:[n===W.RailMap&&Object.entries(t).map(([d,g])=>g.map(f=>e("g",{transform:`translate(${r[f]},${a[f]})`,children:e(Z,{stnId:f,stnState:i===f?0:1,bank:l[d],direction:o[d]})},f))),n===W.Indoor&&Object.entries(t).map(([d,g])=>g.map((f,_)=>e("g",{transform:`translate(${r[f]},${a[f]})`,children:e(q,{stnId:f,nameDirection:h(d,_),services:[A.local]})},f)))]})},ce=W.RailMap;function ft(){const{canvasScale:s}=N(o=>o.app),{svgWidth:n,svg_height:t,theme:r,loop:a,loop_info:{bank:i}}=N(o=>o.param),l=n[ce];return y(U,{type:ce,svgWidth:l,svgHeight:t,canvasScale:s,theme:r,children:[e(gt,{}),a?e(xe,{bank_angle:i,canvas:W.RailMap}):e(Qe,{}),e(rt,{})]})}const gt=M.memo(function(){return y("defs",{children:[e("circle",{id:"stn_sh",fill:"var(--rmg-white)",strokeWidth:2,r:5}),e("path",{id:"int2_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"express_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"direct_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V50 a 5,5 0 1 1 -10,0Z"}),e("rect",{id:"stn_sh_2020",stroke:"none",height:24,width:12,x:-6,y:-18}),e("rect",{id:"stn_sh_2020_express",stroke:"none",height:49,width:12,x:-6,y:-18}),e("rect",{id:"stn_sh_2020_direct",stroke:"none",height:74,width:12,x:-6,y:-18}),e("rect",{id:"intbox_number",height:22,width:20,y:-11}),y("g",{id:"intbox_maglev",transform:"translate(-25,0)",children:[e("rect",{id:"maglev_5",height:144,width:130,y:"40",x:"30",strokeWidth:10}),e("path",{id:"maglev_3",fill:"var(--rmg-white)",d:"m90,55a40,5 0 0 0 -40,3a5,5 0 0 0 -5,5a5,60 0 0 0 -3,60a5,5 0 0 0 5,5l96,0a5,5 0 0 0 5,-5a5,60 0 0 0 -3,-60a5,5 0 0 0 -5,-5a40,5 0 0 0 -40,-3l-5,-10l-5,10"}),e("path",{id:"maglev_4",fill:"var(--rmg-white)",d:"m90,140l-40,0a10,5 0 0 1 -10,-5l0,25a10,15 0 0 0 10,15l15,0l0,-10l-15,0l0,-15l90,0l0,15l-15,0l0,10l15,0a10,15 0 0 0 10,-15l0,-25a10,5 0 0 1 -10,5l-50,0"}),e("rect",{id:"maglev_1",height:"25",width:"40",y:"80",x:"50"}),e("rect",{id:"maglev_2",height:"25",width:"40",y:"80",x:"100"})]}),y("g",{id:"airport",transform:"scale(0.5)",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),e("path",{id:"airport",d:"M28.9769,6.60134c1.711.013,3.111,2.53205,3.111,4.241v10.337s17.106,15.435,17.358,15.666a1.145,1.145,0,0,1,.488,1.152v2.833c0,.651-.451.61-.695.467-.334-.119-17.151-8.863-17.151-8.863-.004,1.458-.797,9.006-1.326,13.304,0,0,4.61,2.457,4.699,2.521.334.268.352.359.352.852v2.001c0,.477-.352.428-.51.324-.183-.062-5.693-1.921-5.693-1.921a2.56018,2.56018,0,0,0-.633-.127,2.31654,2.31654,0,0,0-.666.127s-5.477,1.859-5.672,1.921c-.185.104-.523.153-.523-.324v-2.001c0-.493.029-.584.367-.852.086-.064,4.678-2.521,4.678-2.521-.524-4.298-1.307-11.846-1.325-13.304,0,0-16.822,8.744-17.148,8.863-.217.143-.69.184-.69-.467v-2.833a1.16206,1.16206,0,0,1,.473-1.152c.276-.231,17.365-15.666,17.365-15.666v-10.337c0-1.709,1.403-4.228,3.14105-4.241",transform:"translate(-28.9697,0.14347)",fill:"var(--rmg-white)"})]}),y("g",{id:"disney",transform:"scale(0.5)",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),e("path",{fill:"var(--rmg-white)",d:"M45.6152,7.85015a9.80248,9.80248,0,0,0-9.79907,9.801,9.70059,9.70059,0,0,0,.342,2.582c.002.026.002.055.002.093a.31815.31815,0,0,1-.31494.318.67741.67741,0,0,1-.12806-.02,15.71521,15.71521,0,0,0-13.498,0,.61.61,0,0,1-.122.02.31841.31841,0,0,1-.322-.318v-.067a9.62553,9.62553,0,0,0,.35608-2.608,9.803,9.803,0,1,0-9.797,9.8,10.10364,10.10364,0,0,0,2.308-.271h.05493a.31113.31113,0,0,1,.31409.318.32433.32433,0,0,1-.019.12,15.72588,15.72588,0,1,0,29.703,7.216,15.83676,15.83676,0,0,0-1.746-7.23.18417.18417,0,0,1-.0271-.106.31612.31612,0,0,1,.32007-.318h.057a10.15953,10.15953,0,0,0,2.316.271,9.80051,9.80051,0,0,0,0-19.601",transform:"translate(-28.9697 0.13398)"})]}),y("g",{id:"railway",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)",transform:"translate(0,-2)scale(0.5)"}),e("path",{fill:"var(--rmg-white)",d:"M169,273.5c0-19,14.7-34.8,33.7-36.3c18.9-1.5,38.1-2.2,57.4-2.2c19.3,0,38.4,0.8,57.3,2.2  c19,1.5,33.7,17.3,33.7,36.3v47.3l-51.3,14.7c-11.2,3.2-18.9,13.4-18.9,25v147.8c0,17.4,12.2,32.3,29.3,35.7l110.6,22.1  c4.9,1,8.4,5.2,8.4,10.2V599H91v-22.7c0-5,3.5-9.2,8.4-10.2L209.9,544c17-3.4,29.3-18.3,29.3-35.7V360.5c0-11.6-7.7-21.8-18.9-25  L169,320.8V273.5z M309.4,31.7c0.2-1.2,0.3-2.4,0.3-3.6c0-14-11.1-25.4-24.9-26C276.6,1.4,268.3,1,260,1c-8.3,0-16.6,0.4-24.7,1.1  c-13.9,0.6-24.9,12-24.9,26c0,1.2,0.1,2.5,0.3,3.6C90.6,54.8,0,160.3,0,287c0,97.2,53.4,182,132.4,226.6l36.8-48.1  C104.3,432.4,59.8,364.9,59.8,287c0-110.6,89.6-200.2,200.2-200.2S460.2,176.4,460.2,287c0,77.9-44.5,145.4-109.4,178.5  c15,19.6,25.6,33.5,36.8,48.1C466.6,469,520,384.2,520,287C520,160.3,429.4,54.8,309.4,31.7z",transform:"translate(-10,0)scale(0.04)"})]}),e("marker",{id:"arrow_gray",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-grey)"})}),e("marker",{id:"arrow_theme_left",refX:1,refY:.5,children:e("path",{d:"M1,0L0,1H1z",fill:"var(--rmg-theme-colour)"})}),e("marker",{id:"arrow_theme_right",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),e("marker",{id:"arrow_theme",refX:1,refY:.5,children:e("path",{d:"M0,1H2L1,0z",fill:"var(--rmg-theme-colour)"})}),e("filter",{id:"contrast-direct",filterUnits:"userSpaceOnUse",children:y("feComponentTransfer",{children:[e("feFuncR",{type:"linear",slope:.5,intercept:.25}),e("feFuncG",{type:"linear",slope:.5,intercept:.25}),e("feFuncB",{type:"linear",slope:.5,intercept:.25})]})}),e("filter",{id:"contrast-express",filterUnits:"userSpaceOnUse",children:y("feComponentTransfer",{children:[e("feFuncR",{type:"linear",slope:.75,intercept:.125}),e("feFuncG",{type:"linear",slope:.75,intercept:.125}),e("feFuncB",{type:"linear",slope:.75,intercept:.125})]})}),y("filter",{id:"pujiang_outline_railmap",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[y("feComponentTransfer",{in:"SourceGraphic",children:[e("feFuncR",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),e("feFuncG",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),e("feFuncB",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"})]}),e("feColorMatrix",{type:"matrix",values:`1 0 0 0 0
                                                 0 1 0 0 0
                                                 0 0 1 0 0
                                                 1 1 1 1 -3`,result:"selectedColor1"}),e("feMorphology",{operator:"erode",in:"selectedColor1",radius:"0",result:"e1"}),e("feMorphology",{operator:"erode",in:"selectedColor1",radius:"1",result:"e2"}),e("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"uncoloredOutline"}),e("feFlood",{floodColor:"rgb(0,0,0)"}),e("feComposite",{operator:"in",in2:"uncoloredOutline",result:"outline"}),e("feComposite",{in:"outline",in2:"selectedColor1",operator:"over",result:"result"}),e("feComposite",{in:"result",in2:"SourceGraphic",operator:"over"})]})]})}),he=W.Indoor;function ut(){const{canvasScale:s}=N(l=>l.app),{svgWidth:n,svg_height:t,theme:r,loop:a}=N(l=>l.param),i=n[he];return y(U,{type:he,svgWidth:i,svgHeight:t,canvasScale:s,theme:r,children:[e(pt,{}),a?e(xe,{bank_angle:!1,canvas:W.Indoor}):e($t,{}),e(St,{})]})}const pt=M.memo(function(){return y("defs",{children:[e("circle",{id:"stn_indoor_sh",fill:"var(--rmg-white)",strokeWidth:5,r:8,transform:"scale(1.5)"}),e("path",{id:"int2_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"express_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"direct_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V40 a 5,5 0 1 1 -10,0Z"})]})}),_t=(s,n)=>{let t=0;return s[n].parents.length===2&&(t+=1),s[s[n].parents[0]].children.length===2&&(t+=1),t},xt=(s,n)=>{let t=0;return s[n].children.length===2&&(t+=1),s[s[n].children[0]].parents.length===2&&(t+=1),t},$t=()=>{const{routes:s,branches:n,depsStr:t}=N(m=>m.helper),r=N(m=>m.param),a=me(r.stn_list,_t,xt),i=Y("linestart","lineend",a),l=Y(i.nodes[1],i.nodes.slice(-2)[0],a),o=M.useMemo(()=>(console.log("computing x shares"),Object.keys(r.stn_list).reduce((m,x)=>({...m,[x]:fe(x,a,n)}),{})),[n.toString(),JSON.stringify(a)]),h=[r.svgWidth.indoor*r.padding/100,r.svgWidth.indoor*(1-r.padding/100)],d=Object.keys(o).reduce((m,x)=>({...m,[x]:h[0]+o[x]/l.len*(h[1]-h[0])}),{}),g=M.useMemo(()=>re.getYShares(r.stn_list,n),[t]),f=Object.keys(g).reduce((m,x)=>({...m,[x]:g[x]*r.branchSpacingPct*r.svg_height/200}),{}),_=M.useMemo(()=>ge(r.current_stn_idx,s,r.direction),[r.current_stn_idx,r.direction,s.toString()]),p=Object.values(A),c=Object.values(r.stn_list).map(m=>m.services).flat().reduce((m,x)=>(m[p.indexOf(x)]=!0,m),[!1,!1,!1]).map((m,x)=>[p[x],m]).filter(m=>m[1]).map(m=>m[0]),u=re.drawLine(n,_,r.stn_list,h,d,f,r.branchSpacingPct*r.svg_height/200,i,0);return y("g",{id:"main",transform:`translate(0,${r.svg_height/2})`,children:[e(vt,{paths:u,services:c}),e(yt,{xs:d,ys:f,services:c})]})},vt=s=>e("g",{fill:"none",strokeWidth:12,stroke:"var(--rmg-theme-colour)",children:s.services.map((n,t)=>y("g",{transform:`translate(0, ${t*30})`,children:[s.paths.main.map((r,a)=>e("path",{d:r},a)),s.paths.pass.map((r,a)=>e("path",{d:r},a))]},`indoor_line_${t}`))}),yt=s=>{const{branches:n}=N(l=>l.helper),t=N(l=>l.param),{xs:r,ys:a,services:i}=s;return e("g",{children:Object.keys(t.stn_list).filter(l=>!["linestart","lineend"].includes(l)).filter(l=>t.stn_list[l].services.length!==0).map(l=>e("g",{transform:`translate(${r[l]},${a[l]})`,children:e(q,{stnId:l,nameDirection:n.filter(o=>o.includes(l)).map(o=>o.indexOf(l)%2===0||i.length>1?"downward":"upward")[0],services:i})},l))})},St=()=>{const s=N(n=>n.param);return M.useMemo(()=>y(z,{children:[e("g",{transform:`translate(${s.svgWidth.indoor/2},50)`,children:y("text",{textAnchor:"middle",fontSize:"30",className:"rmg-name__zh",children:["轨道交通",s.line_name[0],"运营线路示意图"]})}),y("g",{transform:`translate(${s.svgWidth.indoor/2},${s.svg_height-270})`,children:[e("text",{textAnchor:"middle",fontSize:"18",className:"rmg-name__zh",dx:"-30",dy:"230",children:"友情提示：请留意您需要换乘线路的首末班时间，以免耽误您的出行，末班车进站前三分钟停售该末班车车票。"}),e("text",{textAnchor:"middle",fontSize:"12",className:"rmg-name__en",dx:"10",dy:"250",children:"Please pay attention to the interchange schedule if you want to transfer to other lines. Stop selling tickets 3 minutes before the last train services."}),y("g",{transform:"translate(-600,215)",children:[e("rect",{x:"-5",y:"-25",width:"100",height:"70",fill:"none",stroke:"black",rx:"5"}),e("line",{x1:"28",x2:"28",y1:"-20",y2:"40",stroke:"black"}),e("text",{className:"rmg-name__zh",dx:"3",fontSize:"18",children:"图"}),e("text",{className:"rmg-name__zh",dx:"3",dy:"18",fontSize:"18",children:"例"}),e("text",{className:"rmg-name__en",dy:"35",fontSize:"8",children:"legend"}),e("use",{transform:"translate(45,10)",xlinkHref:"#int2_indoor_sh",stroke:"var(--rmg-black)"}),e("text",{className:"rmg-name__zh",dx:"60",dy:"10",fontSize:"10",children:"换乘站"}),e("text",{className:"rmg-name__en",dx:"60",dy:"20",fontSize:"6",children:"Interchange"}),e("text",{className:"rmg-name__en",dx:"60",dy:"30",fontSize:"6",children:"Station"})]})]})]}),[s.svgWidth.indoor,s.svg_height,s.line_name])},Ht={destination:e(we,{}),runin:e(Le,{}),railmap:e(ft,{}),indoor:e(ut,{})};export{Ht as default};
