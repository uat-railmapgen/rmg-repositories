import{o as K,r as he,j as p,F as Ae,Q as mt,P as an,u as ae,a6 as Se,H as xe,a7 as _e,t as Ln,a8 as Gt,X as ze,a9 as on,aa as $t,Y as we,ab as ln,a as Dn,M as De,b as Fe,c as Be,e as Me,f as Ve,g as Ne,V as pt,ac as Tt,ad as zt,ae as $e,af as It,ag as ut,n as Ge,m as it,h as wt,I as Fn,k as Bn,B as de,s as Pe,ah as Mn,ai as Ue,q as Ie,aj as Le,ak as Et,al as Vn,am as ft,an as at,ao as Lt,ap as He,a0 as Dt,aq as jt,ar as kt,as as Yt,at as cn,au as dn,av as Nn,a2 as Ye,aw as Ft,ax as Bt,ay as Hn,az as Un,aA as Wn,aB as Zn,aC as Gn,aD as $n,aE as Yn,aF as qn,aG as ct,aH as Kn,v as Xn,w as Jn,aI as Qn,y as er,z as qt,aJ as tr,aK as nr,aL as rr,aM as sr,aN as ir,aO as ar,aP as or,aQ as lr,aR as un,aS as At,aT as cr,aU as dr,aV as ur,aW as hr,aX as mr,aY as hn,aZ as pr,a_ as fr}from"./vendor-996bcf09.js";import{_ as E,u as ee,E as ye,a as ge,b as _r,R as Q,c as Kt,d as Xt,S as qe,e as gr,f as Jt,g as vr,h as Qt,r as yr,i as br,j as Ot,F as Te,k as xr,l as Sr,m as wr,n as Er,o as jr,p as kr,B as ht,D as je,q as Ar,s as Or,t as Cr,v as Mt,w as Pr,x as Rr,y as Tr,z as zr,A as Ir,C as Lr,G as Dr,P as mn,H as pn,I as en,J as Fr,K as Br,L as Mr,M as Vr,N as Nr,O as Hr,Q as Ur,T as Wr,U as vt,V as Zr,W as Gr,X as $r,Y as Yr,Z as qr,$ as Kr,a0 as Xr,a1 as Jr,a2 as We,a3 as Ke,a4 as Xe,a5 as Ze,a6 as fn,a7 as Ct,a8 as Pt,a9 as Qr,aa as es,ab as tn,ac as _n,ad as gn,ae as ts,af as ns,ag as rs,ah as ss,ai as is,aj as yt,ak as as,al as bt,am as xt,an as rt,ao as os,ap as ls}from"./index-30d7226a.js";const cs={mtr:()=>E(()=>import("./index-844cf89f.js"),["assets/index-844cf89f.js","assets/vendor-996bcf09.js","assets/index-30d7226a.js","assets/index-1aae2bd9.css","assets/share-d96d617c.js","assets/mtr-29765b59.js"]),gzmtr:()=>E(()=>import("./index-90afb7ee.js"),["assets/index-90afb7ee.js","assets/vendor-996bcf09.js","assets/index-30d7226a.js","assets/index-1aae2bd9.css","assets/share-d96d617c.js"]),shmetro:()=>E(()=>import("./index-74bcefa9.js"),["assets/index-74bcefa9.js","assets/vendor-996bcf09.js","assets/index-30d7226a.js","assets/index-1aae2bd9.css","assets/share-d96d617c.js","assets/mtr-29765b59.js"])};function ds(s){const[f,n]=K.useState({});return K.useEffect(()=>(cs[s]().then(l=>{n(l.default)}).catch(l=>{console.error(`Failed to load canvas for style ${s}`,l),n({})}),()=>{n({})}),[s]),f}const us={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function hs(){const{canvasToShow:s,canvasScale:f}=ee(e=>e.app),{svg_height:n,style:l}=ee(e=>e.param),o=ds(l);K.useEffect(()=>{document.getElementById("css_share").href=`/rmg/styles/share_${l}.css`,he.event(ye.STYLE_CHANGE,{style:l})},[l]);const t=Object.keys(o).filter(e=>s.includes(e)),r=n*f;return p.jsx(Ae,{minH:r,sx:us,children:Object.keys(o).length===0?p.jsx(mt,{isIndeterminate:!0}):t.map(e=>p.jsx(an,{sx:{minWidth:750,height:r},children:o[e]},e+l))})}function ms(){const{t:s}=ae(),f=ge(),n=ee(i=>i.app.selectedStation);console.log("InfoSection:: Rendering for",n);const l=ee(i=>i.param.style),{num:o,name:t,secondaryName:r}=ee(i=>i.param.stn_list[n]),e=[{type:"input",label:s("StationSidePanel.info.num"),value:o,placeholder:"01",onChange:i=>f(_r(n,i)),hidden:![Q.GZMTR].includes(l)},{type:"input",label:s("Chinese name"),value:t[0],onChange:i=>f(Kt(n,[i,t[1]]))},{type:"input",label:s("English name"),value:t[1],onChange:i=>f(Kt(n,[t[0],i]))},{type:"input",label:s("StationSidePanel.info.zhSecondary"),value:r?r[0]:"",placeholder:"1号航站楼",onChange:i=>f(Xt(n,[i,r?r[1]:""])),hidden:![Q.GZMTR].includes(l)},{type:"input",label:s("StationSidePanel.info.enSecondary"),value:r?r[1]:"",placeholder:"Terminal 1",onChange:i=>f(Xt(n,[r?r[0]:"",i])),hidden:![Q.GZMTR].includes(l)}];return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("StationSidePanel.info.title")}),p.jsx(_e,{fields:e,minW:130})]})}const vn=(s,f)=>{const n=s[f];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((l,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+f)))})};function ps(s){const{countryCode:f,svgFilename:n}=s,[l,o]=K.useState(void 0);return K.useEffect(()=>{n&&vn(Object.assign({"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1F7.svg":()=>E(()=>import("./1F1E6-1F1F7-249b5959.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1F9.svg":()=>E(()=>import("./1F1E6-1F1F9-a3474a87.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1FF.svg":()=>E(()=>import("./1F1E6-1F1FF-c961f61f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1EA.svg":()=>E(()=>import("./1F1E7-1F1EA-87b63ce0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1F4.svg":()=>E(()=>import("./1F1E7-1F1F4-8e88acbd.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1F7.svg":()=>E(()=>import("./1F1E7-1F1F7-2e5da46f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1E6.svg":()=>E(()=>import("./1F1E8-1F1E6-572cf376.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1F1.svg":()=>E(()=>import("./1F1E8-1F1F1-bb957357.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1F3.svg":()=>E(()=>import("./1F1E8-1F1F3-866d09b5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E9-1F1EA.svg":()=>E(()=>import("./1F1E9-1F1EA-2bcac591.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E9-1F1F0.svg":()=>E(()=>import("./1F1E9-1F1F0-130b3df9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EA-1F1EC.svg":()=>E(()=>import("./1F1EA-1F1EC-190b639e.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EA-1F1F8.svg":()=>E(()=>import("./1F1EA-1F1F8-e9f6e238.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EB-1F1F7.svg":()=>E(()=>import("./1F1EB-1F1F7-12f823eb.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EC-1F1F7.svg":()=>E(()=>import("./1F1EC-1F1F7-d16bd178.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1ED-1F1F0.svg":()=>E(()=>import("./1F1ED-1F1F0-1346b158.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1ED-1F1FA.svg":()=>E(()=>import("./1F1ED-1F1FA-e44befe3.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1E9.svg":()=>E(()=>import("./1F1EE-1F1E9-256ea73c.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F3.svg":()=>E(()=>import("./1F1EE-1F1F3-44d109aa.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F7.svg":()=>E(()=>import("./1F1EE-1F1F7-c924004a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F9.svg":()=>E(()=>import("./1F1EE-1F1F9-38eff108.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EF-1F1F5.svg":()=>E(()=>import("./1F1EF-1F1F5-93518547.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F0-1F1F7.svg":()=>E(()=>import("./1F1F0-1F1F7-4e778503.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1F4.svg":()=>E(()=>import("./1F1F2-1F1F4-bb2225c7.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1FD.svg":()=>E(()=>import("./1F1F2-1F1FD-31d458ab.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1FE.svg":()=>E(()=>import("./1F1F2-1F1FE-9d12ac27.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F3-1F1F4.svg":()=>E(()=>import("./1F1F3-1F1F4-36b22a7a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1EA.svg":()=>E(()=>import("./1F1F5-1F1EA-2359ab5b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1F1.svg":()=>E(()=>import("./1F1F5-1F1F1-56d472c9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1F9.svg":()=>E(()=>import("./1F1F5-1F1F9-48f96f04.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F7-1F1F4.svg":()=>E(()=>import("./1F1F7-1F1F4-a774c3a2.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F7-1F1FA.svg":()=>E(()=>import("./1F1F7-1F1FA-3b81f8de.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1E6.svg":()=>E(()=>import("./1F1F8-1F1E6-481d8837.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1EA.svg":()=>E(()=>import("./1F1F8-1F1EA-3583e0b5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1EC.svg":()=>E(()=>import("./1F1F8-1F1EC-2b92413d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1ED.svg":()=>E(()=>import("./1F1F9-1F1ED-0757641b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1F7.svg":()=>E(()=>import("./1F1F9-1F1F7-f7cf6b4a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1FC.svg":()=>E(()=>import("./1F1F9-1F1FC-82e8fcc5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1E6.svg":()=>E(()=>import("./1F1FA-1F1E6-fc868471.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1F3.svg":()=>E(()=>import("./1F1FA-1F1F3-dddb091b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1F8.svg":()=>E(()=>import("./1F1FA-1F1F8-47f8491b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1FF.svg":()=>E(()=>import("./1F1FA-1F1FF-0989e0a8.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FB-1F1EA.svg":()=>E(()=>import("./1F1FB-1F1EA-8edd6b29.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FB-1F1F3.svg":()=>E(()=>import("./1F1FB-1F1F3-2e88414b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F3F4-E0067-E0062-E0065-E006E-E0067-E007F.svg":()=>E(()=>import("./1F3F4-E0067-E0062-E0065-E006E-E0067-E007F-8302e24f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F3F4-E0067-E0062-E0073-E0063-E0074-E007F.svg":()=>E(()=>import("./1F3F4-E0067-E0062-E0073-E0063-E0074-E007F-a5d75104.js"),[])}),`../../../../node_modules/@railmapgen/rmg-palette-resources/flags/${n.slice(0,-4)}.svg`).then(t=>t.default).then(o).catch(t=>console.error(`Failed to find SVG file ${n} as ${t==null?void 0:t.message}`))},[n]),l?p.jsx(Ln,{src:l,alt:`Flag of ${f}`,h:17,mr:1}):p.jsx(p.Fragment,{})}function fs(s){const{defaultValueId:f,onChange:n}=s,{i18n:l}=ae(),o=f?Gt.find(c=>c.id===f):void 0,t=c=>{var v,u;return(u=(v=l.languages.map(_=>c.name[_]).find(_=>_!==void 0))!=null?v:c.name.en)!=null?u:""},r=c=>{var m,b;const v=c.country==="TW"&&["zh-Hans","zh-CN"].includes(l.languages[0]),u=["Win32","Win64"].includes(navigator.platform),_=l.languages.map(y=>c.name[y]).find(y=>y!==void 0),d=(m=$t.find(y=>y.id===c.country))==null?void 0:m.flagSvg,g=(b=$t.find(y=>y.id===c.country))==null?void 0:b.flagEmoji;return p.jsxs(p.Fragment,{children:[v?p.jsx("span",{children:"🏴 "}):u?p.jsx(ps,{countryCode:c.country,svgFilename:d}):p.jsxs("span",{children:[g," "]}),_]})},e=(c,v)=>Object.values(c.name).some(u=>u.includes(v)),i=Gt.slice().sort((c,v)=>c.id===ze.Other?1:v.id===ze.Other?-1:t(c).localeCompare(t(v),l.languages[0]));return p.jsx(on,{data:i,displayValue:t,displayHandler:r,predicate:e,defaultValue:o,onChange:c=>n==null?void 0:n(c.id)})}const _s=s=>{const[f,n]=K.useState([]);return K.useEffect(()=>{vn(Object.assign({"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ankara.js":()=>E(()=>import("./ankara-73b26dc5.js"),["assets/ankara-73b26dc5.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/athens.js":()=>E(()=>import("./athens-430a1480.js"),["assets/athens-430a1480.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/baku.js":()=>E(()=>import("./baku-bae24922.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bangkok.js":()=>E(()=>import("./bangkok-a87902da.js"),["assets/bangkok-a87902da.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/barcelona.js":()=>E(()=>import("./barcelona-88b38159.js"),["assets/barcelona-88b38159.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/beijing.js":()=>E(()=>import("./beijing-ed004580.js"),["assets/beijing-ed004580.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/berlin.js":()=>E(()=>import("./berlin-b02a7fb0.js"),["assets/berlin-b02a7fb0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bonn.js":()=>E(()=>import("./bonn-17161567.js"),["assets/bonn-17161567.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/boston.js":()=>E(()=>import("./boston-1fcedb0b.js"),["assets/boston-1fcedb0b.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/brussels.js":()=>E(()=>import("./brussels-8a704eb6.js"),["assets/brussels-8a704eb6.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bucharest.js":()=>E(()=>import("./bucharest-dec16d21.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/budapest.js":()=>E(()=>import("./budapest-c49cb113.js"),["assets/budapest-c49cb113.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/buenosaires.js":()=>E(()=>import("./buenosaires-1af882a4.js"),["assets/buenosaires-1af882a4.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/busan.js":()=>E(()=>import("./busan-bd2b1665.js"),["assets/busan-bd2b1665.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cairo.js":()=>E(()=>import("./cairo-1e92ad5d.js"),["assets/cairo-1e92ad5d.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/caracas.js":()=>E(()=>import("./caracas-78f0bc18.js"),["assets/caracas-78f0bc18.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changchun.js":()=>E(()=>import("./changchun-9c0103e4.js"),["assets/changchun-9c0103e4.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changsha.js":()=>E(()=>import("./changsha-5412e561.js"),["assets/changsha-5412e561.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/chengdu.js":()=>E(()=>import("./chengdu-2fde8740.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/chongqing.js":()=>E(()=>import("./chongqing-0295eed0.js"),["assets/chongqing-0295eed0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cochabamba.js":()=>E(()=>import("./cochabamba-58910ea2.js"),["assets/cochabamba-58910ea2.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cologne.js":()=>E(()=>import("./cologne-6b022676.js"),["assets/cologne-6b022676.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/copenhagen.js":()=>E(()=>import("./copenhagen-99fbcd7a.js"),["assets/copenhagen-99fbcd7a.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/daegu.js":()=>E(()=>import("./daegu-8f53d357.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dalian.js":()=>E(()=>import("./dalian-08981d46.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/delhi.js":()=>E(()=>import("./delhi-eaa3d5a0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dongguan.js":()=>E(()=>import("./dongguan-9877cd9c.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dortmund.js":()=>E(()=>import("./dortmund-f7d73aa8.js"),["assets/dortmund-f7d73aa8.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/edinburgh.js":()=>E(()=>import("./edinburgh-cc29c10f.js"),["assets/edinburgh-cc29c10f.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/eskisehir.js":()=>E(()=>import("./eskisehir-5404753b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/foshan.js":()=>E(()=>import("./foshan-ca566e10.js"),["assets/foshan-ca566e10.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/frankfurt.js":()=>E(()=>import("./frankfurt-f1ee3295.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/fuzhou.js":()=>E(()=>import("./fuzhou-a788713d.js"),["assets/fuzhou-a788713d.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/glasgow.js":()=>E(()=>import("./glasgow-e714346d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/gothenburg.js":()=>E(()=>import("./gothenburg-842bb5eb.js"),["assets/gothenburg-842bb5eb.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/guadalajara.js":()=>E(()=>import("./guadalajara-dc4a5f1d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/guangzhou.js":()=>E(()=>import("./guangzhou-eb2db43e.js"),["assets/guangzhou-eb2db43e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hamburg.js":()=>E(()=>import("./hamburg-e0d4a697.js"),["assets/hamburg-e0d4a697.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hangzhou.js":()=>E(()=>import("./hangzhou-8b5d39b0.js"),["assets/hangzhou-8b5d39b0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hanoi.js":()=>E(()=>import("./hanoi-6c252433.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/harbin.js":()=>E(()=>import("./harbin-687d6138.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hefei.js":()=>E(()=>import("./hefei-35083b6c.js"),["assets/hefei-35083b6c.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hiroshima.js":()=>E(()=>import("./hiroshima-99d709b0.js"),["assets/hiroshima-99d709b0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hochiminh.js":()=>E(()=>import("./hochiminh-9f62b24b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hongkong.js":()=>E(()=>import("./hongkong-1f572c4b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/iashi.js":()=>E(()=>import("./iashi-76bb88cb.js"),["assets/iashi-76bb88cb.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/istanbul.js":()=>E(()=>import("./istanbul-cad9e359.js"),["assets/istanbul-cad9e359.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/jakarta.js":()=>E(()=>import("./jakarta-82dd9d9c.js"),["assets/jakarta-82dd9d9c.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/jinan.js":()=>E(()=>import("./jinan-b6389b78.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kansai.js":()=>E(()=>import("./kansai-c41fb9a0.js"),["assets/kansai-c41fb9a0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kaohsiung.js":()=>E(()=>import("./kaohsiung-1a75e57f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kharkiv.js":()=>E(()=>import("./kharkiv-9a29284e.js"),["assets/kharkiv-9a29284e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/klangvalley.js":()=>E(()=>import("./klangvalley-9114a5fa.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kunming.js":()=>E(()=>import("./kunming-aa5d5d75.js"),["assets/kunming-aa5d5d75.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/lima.js":()=>E(()=>import("./lima-118ba6e3.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/lisbon.js":()=>E(()=>import("./lisbon-82e2f436.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/london.js":()=>E(()=>import("./london-4cc3d948.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/luoyang.js":()=>E(()=>import("./luoyang-79ecd96e.js"),["assets/luoyang-79ecd96e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/macao.js":()=>E(()=>import("./macao-19ac9346.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/madrid.js":()=>E(()=>import("./madrid-5f0af0f6.js"),["assets/madrid-5f0af0f6.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/manchester.js":()=>E(()=>import("./manchester-2f0aa8aa.js"),["assets/manchester-2f0aa8aa.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/milan.js":()=>E(()=>import("./milan-be02ed35.js"),["assets/milan-be02ed35.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/monterrey.js":()=>E(()=>import("./monterrey-4f5e5784.js"),["assets/monterrey-4f5e5784.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/montreal.js":()=>E(()=>import("./montreal-52b4a866.js"),["assets/montreal-52b4a866.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/munich.js":()=>E(()=>import("./munich-b765096c.js"),["assets/munich-b765096c.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/nanjing.js":()=>E(()=>import("./nanjing-189b2e2a.js"),["assets/nanjing-189b2e2a.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/nanning.js":()=>E(()=>import("./nanning-384312a8.js"),["assets/nanning-384312a8.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/naples.js":()=>E(()=>import("./naples-19d71e84.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/neworleans.js":()=>E(()=>import("./neworleans-f54e63fd.js"),["assets/neworleans-f54e63fd.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/newtaipei.js":()=>E(()=>import("./newtaipei-2d07dd7a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/newyork.js":()=>E(()=>import("./newyork-bea14663.js"),["assets/newyork-bea14663.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ningbo.js":()=>E(()=>import("./ningbo-45154f57.js"),["assets/ningbo-45154f57.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/osaka.js":()=>E(()=>import("./osaka-120ad40f.js"),["assets/osaka-120ad40f.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/oslo.js":()=>E(()=>import("./oslo-2b09fad6.js"),["assets/oslo-2b09fad6.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/other.js":()=>E(()=>import("./other-176be433.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ottawa.js":()=>E(()=>import("./ottawa-08142d17.js"),["assets/ottawa-08142d17.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/paris.js":()=>E(()=>import("./paris-dad2ebf0.js"),["assets/paris-dad2ebf0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/qingdao.js":()=>E(()=>import("./qingdao-c7b6dbd7.js"),["assets/qingdao-c7b6dbd7.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rheinruhr.js":()=>E(()=>import("./rheinruhr-d291a748.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rio.js":()=>E(()=>import("./rio-9148e368.js"),["assets/rio-9148e368.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/riyadh.js":()=>E(()=>import("./riyadh-2b5f4911.js"),["assets/riyadh-2b5f4911.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rome.js":()=>E(()=>import("./rome-861bfbee.js"),["assets/rome-861bfbee.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sanfrancisco.js":()=>E(()=>import("./sanfrancisco-cc122e1e.js"),["assets/sanfrancisco-cc122e1e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sanktpeterburg.js":()=>E(()=>import("./sanktpeterburg-87b7088d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/santiago.js":()=>E(()=>import("./santiago-f32d44e1.js"),["assets/santiago-f32d44e1.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/saopaulo.js":()=>E(()=>import("./saopaulo-b4df3144.js"),["assets/saopaulo-b4df3144.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/seoul.js":()=>E(()=>import("./seoul-d445b3bc.js"),["assets/seoul-d445b3bc.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sevilla.js":()=>E(()=>import("./sevilla-4cd86048.js"),["assets/sevilla-4cd86048.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shanghai.js":()=>E(()=>import("./shanghai-fdeb201e.js"),["assets/shanghai-fdeb201e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shaoxing.js":()=>E(()=>import("./shaoxing-3883f1d2.js"),["assets/shaoxing-3883f1d2.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shenyang.js":()=>E(()=>import("./shenyang-62628740.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shenzhen.js":()=>E(()=>import("./shenzhen-c482e26e.js"),["assets/shenzhen-c482e26e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shijiazhuang.js":()=>E(()=>import("./shijiazhuang-3272c903.js"),["assets/shijiazhuang-3272c903.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/singapore.js":()=>E(()=>import("./singapore-cc1b2c02.js"),["assets/singapore-cc1b2c02.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/stockholm.js":()=>E(()=>import("./stockholm-5eca41a9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/suzhou.js":()=>E(()=>import("./suzhou-aff0237c.js"),["assets/suzhou-aff0237c.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taichung.js":()=>E(()=>import("./taichung-6065e619.js"),["assets/taichung-6065e619.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taipei.js":()=>E(()=>import("./taipei-78be3350.js"),["assets/taipei-78be3350.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taiyuan.js":()=>E(()=>import("./taiyuan-7d0e1002.js"),["assets/taiyuan-7d0e1002.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taoyuan.js":()=>E(()=>import("./taoyuan-85475d66.js"),["assets/taoyuan-85475d66.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tashkent.js":()=>E(()=>import("./tashkent-8096986f.js"),["assets/tashkent-8096986f.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tehran.js":()=>E(()=>import("./tehran-293c71a8.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tianjin.js":()=>E(()=>import("./tianjin-7fd66eca.js"),["assets/tianjin-7fd66eca.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tokyo.js":()=>E(()=>import("./tokyo-3aa9fa24.js"),["assets/tokyo-3aa9fa24.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/toronto.js":()=>E(()=>import("./toronto-7d8a020e.js"),["assets/toronto-7d8a020e.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tyneandwear.js":()=>E(()=>import("./tyneandwear-b3da8462.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/urumqi.js":()=>E(()=>import("./urumqi-95355072.js"),["assets/urumqi-95355072.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/vienna.js":()=>E(()=>import("./vienna-1e8eea57.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/warsaw.js":()=>E(()=>import("./warsaw-21a55fba.js"),["assets/warsaw-21a55fba.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/washington.js":()=>E(()=>import("./washington-3d8ef62b.js"),["assets/washington-3d8ef62b.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/wuhan.js":()=>E(()=>import("./wuhan-eb678328.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/wuxi.js":()=>E(()=>import("./wuxi-68576026.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xiamen.js":()=>E(()=>import("./xiamen-cca9c4f0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xian.js":()=>E(()=>import("./xian-84e19a1a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xuzhou.js":()=>E(()=>import("./xuzhou-ba70a34a.js"),["assets/xuzhou-ba70a34a.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/yevpatoria.js":()=>E(()=>import("./yevpatoria-3e5bf1c0.js"),["assets/yevpatoria-3e5bf1c0.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/yokohama.js":()=>E(()=>import("./yokohama-93dcdbed.js"),["assets/yokohama-93dcdbed.js","assets/vendor-996bcf09.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/zhengzhou.js":()=>E(()=>import("./zhengzhou-6f59fed7.js"),["assets/zhengzhou-6f59fed7.js","assets/vendor-996bcf09.js"])}),`../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/${s}.js`).then(l=>n(l.default)).catch(()=>n([]))},[s]),f};function gs(s){const{city:f,defaultValueId:n,onChange:l}=s,{i18n:o}=ae(),t=_s(f),r=n?t.find(v=>v.id===n):void 0,e=v=>{var u;return(u=o.languages.map(_=>v.name[_]).find(_=>_!==void 0))!=null?u:""},i=v=>{const u=e(v);return p.jsx(ln,{name:u,fg:v.fg||we.white,bg:v.colour})},c=(v,u)=>Object.values(v.name).some(_=>_.includes(u));return p.jsx(on,{data:t,displayValue:e,displayHandler:i,predicate:c,defaultValue:r,onChange:v=>l==null?void 0:l(v.id,v.colour,v.fg||we.white)})}function Vt(s){const{isOpen:f,onClose:n,defaultTheme:l,onUpdate:o}=s,{t}=ae(),r=Dn("primary.500","primary.300"),[e,i]=K.useState(l==null?void 0:l[0]),[c,v]=K.useState(l==null?void 0:l[1]),[u,_]=K.useState((l==null?void 0:l[2])||"#AAAAAA"),[d,g]=K.useState((l==null?void 0:l[3])||we.white);K.useEffect(()=>{l&&(i(l[0]),v(l[1]),_(l[2]),g(l[3]))},[f,l==null?void 0:l.toString()]);const m=[{type:"custom",label:t("ColourModal.city"),component:p.jsx(fs,{defaultValueId:e,onChange:j=>{i(j),v(void 0),_("#AAAAAA"),g(we.white)}})},{type:"custom",label:t("ColourModal.line"),component:p.jsx(gs,{city:e,defaultValueId:c,onChange:(j,O,F)=>{v(j),_(O),g(F)}})}],b=[{type:"input",label:t("ColourModal.bg"),variant:"color",value:u,placeholder:"#F3D03E",onChange:j=>{i(ze.Other),v("other"),_(j)}},{type:"select",label:t("ColourModal.fg"),value:d,options:{[we.white]:t("ColourModal.white"),[we.black]:t("ColourModal.black")},onChange:j=>{i(ze.Other),v("other"),g(j)}}],y=()=>{he.isStandaloneWindow()?window.open("/rmg-palette","_blank"):he.openApp("rmg-palette")},S=e&&c&&u&&d,A=()=>{S&&(o==null||o([e,c,u,d]),n(),he.event(ye.SELECT_COLOUR,{cityCode:e,lineCode:c}))};return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[p.jsx(Me,{children:t("ColourModal.title")}),p.jsx(Ve,{}),p.jsx(Ne,{children:p.jsxs(pt,{children:[p.jsx(ln,{name:t("ColourModal.example"),fg:d,bg:u}),p.jsxs(Tt,{isFitted:!0,colorScheme:"primary",w:"100%",defaultIndex:e===ze.Other?1:0,children:[p.jsxs(zt,{children:[p.jsx($e,{children:t("ColourModal.palette")}),p.jsx($e,{children:t("ColourModal.custom")})]}),p.jsxs(It,{children:[p.jsx(ut,{children:p.jsx(_e,{fields:m})}),p.jsx(ut,{children:p.jsx(_e,{fields:b})})]})]})]})}),p.jsxs(Ge,{children:[p.jsxs(it,{fontSize:"sm",marginRight:2,children:[t("ColourModal.seeAll"),p.jsxs(wt,{color:r,onClick:y,children:[t("Palette")," ",p.jsx(Fn,{as:Bn})]})]}),p.jsx(de,{colorScheme:"primary",onClick:A,isDisabled:!S,children:t("Confirm")})]})]})]})}class vs{static hexToRgb(f){return[parseInt(f.slice(1,3),16),parseInt(f.slice(3,5),16),parseInt(f.slice(5,7),16)]}static fade(f,n){return`rgba(${[...this.hexToRgb(f),n].join(",")})`}static euclideanDistance(f,n){return this.hexToRgb(f).reduce((l,o,t)=>l+Math.pow(o-this.hexToRgb(n)[t],2),0)}}function Nt(s){const{theme:f,onClick:n}=s,{t:l}=ae();return p.jsx(Pe,{size:"xs","aria-label":l("Colour"),mt:"0.45px",color:f[3],bg:f[2],_hover:{bg:vs.fade(f[2],.7)},icon:p.jsx(Mn,{}),onClick:n})}function ys(s){var g;const{interchangeList:f,onAdd:n,onDelete:l,onUpdate:o}=s,{t}=ae(),[r,e]=K.useState(!1),[i,c]=K.useState(0),{theme:v,stn_list:u}=ee(m=>m.param),_=Object.values(u).reduce((m,b)=>{const[y,S]=m;return[[...new Set(y.concat(b.transfer.info.flat().map(A=>A[4])))],[...new Set(S.concat(b.transfer.info.flat().map(A=>A[5])))]]},[[],[]]),d=f.map((m,b)=>[{type:"input",label:t("Chinese name"),value:m[4],minW:"80px",onChange:y=>o==null?void 0:o(b,[m[0],m[1],m[2],m[3],y,m[5]]),optionList:_[0]},{type:"input",label:t("English name"),value:m[5],minW:"80px",onChange:y=>o==null?void 0:o(b,[m[0],m[1],m[2],m[3],m[4],y]),optionList:_[1]}]);return p.jsxs(Ue,{direction:"column",children:[f.length===0&&p.jsxs(Ie,{spacing:.5,"data-testid":"interchange-card-stack",children:[p.jsx(it,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:t("StationSidePanel.interchange.noInterchanges")}),p.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n([v[0],"","#aaaaaa",we.white,"",""]),icon:p.jsx(Le,{})})]}),f.map((m,b)=>p.jsxs(Ie,{spacing:.5,"data-testid":`interchange-card-stack-${b}`,children:[p.jsx(Et,{label:t("Colour"),minW:"40px",noLabel:b!==0,children:p.jsx(Nt,{theme:[m[0],m[1],m[2],m[3]],onClick:()=>{e(!0),c(b)}})}),p.jsx(_e,{fields:d[b],noLabel:b!==0}),n&&b===d.length-1?p.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(f.slice(-1)[0]),icon:p.jsx(Vn,{})}):p.jsx(Se,{minW:8}),l&&p.jsx(Pe,{size:"sm",variant:"ghost","aria-label":t("StationSidePanel.interchange.remove"),onClick:()=>l==null?void 0:l(b),icon:p.jsx(ft,{})})]},b)),p.jsx(Vt,{isOpen:r,onClose:()=>e(!1),defaultTheme:(g=f[i])==null?void 0:g.slice(0,4),onUpdate:m=>o==null?void 0:o(i,[...m,f[i][4],f[i][5]])})]})}function bs(){const{t:s}=ae(),f=ge(),n=ee(u=>u.app.selectedStation),{theme:l,style:o}=ee(u=>u.param),{transfer:t}=ee(u=>u.param.stn_list[n]),r=u=>{var _,d;return[{type:"input",label:s("Station Chinese name"),value:(_=t.osi_names[u])==null?void 0:_[0],hidden:![Q.MTR].includes(o),onChange:g=>{var m;return f(Jt(n,u,[g,(m=t.osi_names[u])==null?void 0:m[1]]))}},{type:"input",label:s("Station English name"),value:(d=t.osi_names[u])==null?void 0:d[1],hidden:![Q.MTR].includes(o),onChange:g=>{var m;return f(Jt(n,u,[(m=t.osi_names[u])==null?void 0:m[0],g]))}},{type:"switch",label:s("Paid area"),isChecked:t.paid_area,onChange:g=>f(vr(n,g)),hidden:![Q.MTR].includes(o)||u!==0,oneLine:!0}]},e=u=>_=>{f(Qt(n,u,_))},i=u=>_=>{f(yr(n,u,_))},c=u=>(_,d)=>{f(br(n,u,_,d))},v=()=>{f(Qt(n,t.info.length,[l[0],"","#AAAAAA",we.white,"",""]))};return p.jsxs(pt,{align:"flex-start",p:1,children:[p.jsxs(Ae,{w:"100%",children:[p.jsx(xe,{as:"h5",size:"sm",mr:"auto",children:s("StationSidePanel.interchange.title")}),o===Q.MTR&&p.jsx(at,{selections:[{label:s("Text on the left"),value:qe.left},{label:s("Text on the right"),value:qe.right}],defaultValue:t.tick_direc,onChange:u=>f(gr(n,u))})]}),t.info.map((u,_)=>p.jsxs(K.Fragment,{children:[p.jsx(xe,{as:"h6",size:"xs",children:s(_===0?"StationSidePanel.interchange.within":_===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),_!==0&&p.jsx(_e,{fields:r(_-1)}),p.jsx(ys,{interchangeList:u,onAdd:e(_),onDelete:i(_),onUpdate:c(_)})]},_)),t.info.length<3&&p.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:p.jsx(Le,{}),onClick:v,children:s("StationSidePanel.interchange.addGroup")})]})}function xs(){const{t:s}=ae(),f=ge(),n=ee(g=>g.app.selectedStation),{style:l,loop:o}=ee(g=>g.param),{services:t,facility:r,loop_pivot:e,one_line:i,int_padding:c}=ee(g=>g.param.stn_list[n]),v=Object.values(Ot).map(g=>({label:s("StationSidePanel.more."+g),value:g,disabled:g===Ot.local&&l!==Q.SHMetro})),u={[Te.none]:s("StationSidePanel.more.none"),[Te.airport]:s("StationSidePanel.more.airport"),[Te.hsr]:s("StationSidePanel.more.hsr"),[Te.disney]:s("StationSidePanel.more.disney")},_={[Te.none]:s("StationSidePanel.more.none"),[Te.airport]:s("StationSidePanel.more.airport"),[Te.railway]:s("StationSidePanel.more.railway"),[Te.disney]:s("StationSidePanel.more.disney")},d=[{type:"custom",label:s("StationSidePanel.more.service"),component:p.jsx(at,{selections:v,defaultValue:t,onChange:g=>f(xr(n,g)),multiSelect:!0}),hidden:![Q.GZMTR,Q.SHMetro].includes(l)},{type:"select",label:s("StationSidePanel.more.facility"),value:r,options:l===Q.MTR?u:_,onChange:g=>f(Sr(n,g)),hidden:![Q.MTR,Q.SHMetro].includes(l)},{type:"switch",label:s("StationSidePanel.more.pivot"),isChecked:e,onChange:g=>f(wr(n,g)),hidden:![Q.SHMetro].includes(l)||!o,minW:"full",oneLine:!0},{type:"switch",label:s("StationSidePanel.more.oneLine"),isChecked:i,onChange:g=>f(Er(n,g)),hidden:![Q.SHMetro].includes(l),minW:"full",oneLine:!0},{type:"input",label:s("StationSidePanel.more.intPadding"),value:c.toString(),validator:g=>Number.isInteger(g),onChange:g=>f(jr(n,Number(g))),hidden:![Q.SHMetro].includes(l)},{type:"custom",label:s("StationSidePanel.more.intPaddingApplyGlobal"),component:p.jsx(at,{selections:[{label:s("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:g=>f(kr(n))}),oneLine:!0,hidden:![Q.SHMetro].includes(l)}];return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("StationSidePanel.more.title")}),p.jsx(_e,{fields:d})]})}function Ss(){const{t:s}=ae(),f=ge(),n=ee(u=>u.app.selectedStation),l=ee(u=>u.param.stn_list),{parents:o,children:t,branch:r}=l[n],e={[ht.through]:s("StationSidePanel.branch.through"),[ht.nonThrough]:s("StationSidePanel.branch.nonThrough")},i=u=>(u===je.left?o:t).reduce((_,d)=>({..._,[d]:l[d].name.join(" ")}),{}),c={upper:s("StationSidePanel.branch.upper"),lower:s("StationSidePanel.branch.lower")},v=u=>r[u].length?[{type:"select",label:s("StationSidePanel.branch.type"),options:e,value:r[u][0],onChange:_=>f(Ar(n,u,_))},{type:"select",label:s("StationSidePanel.branch.firstStation"),options:i(u),value:r[u][1],onChange:_=>f(Or(n,u,_))},{type:"select",label:s("StationSidePanel.branch.position"),options:c,value:(u===je.left?o:t)[0]===r[u][1]?"upper":"lower",onChange:()=>f(Cr(n,u))}]:[];return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("Branches")}),p.jsx(xe,{as:"h6",size:"xs",children:s("Branch on the left")}),p.jsx(Ue,{direction:"column",children:o.length===2?p.jsx(_e,{fields:v(je.left)}):p.jsx(it,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:s("No branches found")})}),p.jsx(xe,{as:"h6",size:"xs",children:s("Branch on the right")}),p.jsx(Ue,{direction:"column",children:t.length===2?p.jsx(_e,{fields:v(je.right)}):p.jsx(it,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:s("No branches found")})})]})}function ws(){return p.jsxs(Lt,{children:[p.jsx(ms,{}),p.jsx(He,{}),p.jsx(bs,{}),p.jsx(He,{}),p.jsx(Ss,{}),p.jsx(He,{}),p.jsx(xs,{})]})}function Es(){const{t:s}=ae(),f=Dt(),{style:n,svgWidth:l,svg_height:o,y_pc:t,branchSpacingPct:r,padding:e,direction_gz_x:i,direction_gz_y:c,loop:v}=ee(_=>_.param),u=[...Mt[n].map(_=>({type:"input",label:s(`StyleSidePanel.layout.${_}Width`),value:l[_].toString(),onChange:d=>f(Pr(Number(d),_))})),{type:"input",label:s("StyleSidePanel.layout.canvasHeight"),value:o.toString(),onChange:_=>f(Rr(Number(_)))},{type:"slider",label:s("StyleSidePanel.layout.verticalPosition"),value:t,min:0,max:100,onChange:_=>f(Tr(_)),leftIcon:p.jsx(jt,{}),rightIcon:p.jsx(kt,{}),hidden:![Q.MTR,Q.GZMTR].includes(n)},{type:"slider",label:s(v?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:r,min:0,max:v?50:100,onChange:_=>f(zr(_)),leftIcon:p.jsx(Yt,{}),rightIcon:p.jsx(Le,{})},{type:"slider",label:s("StyleSidePanel.layout.padding"),value:e,min:0,max:50,onChange:_=>f(Ir(_)),leftIcon:p.jsx(Yt,{}),rightIcon:p.jsx(Le,{})},{type:"slider",label:s("StyleSidePanel.layout.directionGzX"),value:i,min:0,max:100,onChange:_=>f(Lr(_)),leftIcon:p.jsx(cn,{}),rightIcon:p.jsx(dn,{}),hidden:![Q.GZMTR].includes(n)},{type:"slider",label:s("StyleSidePanel.layout.directionGzY"),value:c,min:0,max:100,onChange:_=>f(Dr(_)),leftIcon:p.jsx(jt,{}),rightIcon:p.jsx(kt,{}),hidden:![Q.GZMTR].includes(n)}];return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("StyleSidePanel.layout.title")}),p.jsx(_e,{fields:u,minW:130})]})}function js(){const{t:s}=ae(),f=ge(),{style:n,theme:l,line_name:o,line_num:t,direction:r,platform_num:e,psd_num:i,namePosMTR:c,customiseMTRDest:v,info_panel_type:u}=ee(j=>j.param),[_,d]=K.useState(!1),g=[{label:s("StyleSidePanel.design.left"),value:qe.left},{label:s("StyleSidePanel.design.right"),value:qe.right}],m=Object.values(mn).reduce((j,O)=>({...j,[O]:s("StyleSidePanel.design."+O)}),{}),b=Object.values(pn).reduce((j,O)=>({...j,[O]:s("StyleSidePanel.design."+O)}),{}),y=[{type:"custom",label:s("Colour"),component:p.jsx(Nt,{theme:l,onClick:()=>d(!0)}),minW:"40px"},{type:"input",label:s("StyleSidePanel.design.zhLineName"),value:o[0],onChange:j=>f(en([j,o[1]])),minW:130},{type:"input",label:s("StyleSidePanel.design.enLineName"),value:o[1],onChange:j=>f(en([o[0],j])),minW:130},{type:"input",label:s("StyleSidePanel.design.lineNum"),value:t,onChange:j=>f(Fr(j)),hidden:![Q.GZMTR].includes(n)},{type:"input",label:s("StyleSidePanel.design.platformNum"),value:e||"",onChange:j=>f(Br(j))},{type:"input",label:s("StyleSidePanel.design.psdNum"),value:i,onChange:j=>f(Mr(j)),hidden:![Q.GZMTR].includes(n)},{type:"select",label:s("StyleSidePanel.design.panelType"),value:u,options:n===Q.GZMTR?m:b,onChange:j=>f(Vr(j)),hidden:![Q.GZMTR,Q.SHMetro].includes(n)},{type:"custom",label:s("StyleSidePanel.design.direction"),component:p.jsx(at,{selections:g,defaultValue:r,onChange:j=>f(Nr(j))}),minW:"full",oneLine:!0}],S=[{label:s("StyleSidePanel.design.alternatively"),value:!0},{label:s("StyleSidePanel.design.onOneSide"),value:!1}],A=[{type:"custom",label:s("StyleSidePanel.design.nameDisplay"),component:p.jsxs(Ie,{spacing:.5,children:[p.jsx(Pe,{size:"xs",variant:"ghost","aria-label":s("StyleSidePanel.design.flip"),title:s("StyleSidePanel.design.flip"),icon:p.jsx(Nn,{}),onClick:()=>f(Hr())}),p.jsx(at,{selections:S,defaultValue:c.isStagger,onChange:j=>f(Ur(j))})]}),minW:"full",oneLine:!0,hidden:![Q.MTR].includes(n)},{type:"switch",label:s("StyleSidePanel.design.legacyDestination"),isChecked:v.isLegacy,onChange:j=>f(Wr(j)),hidden:![Q.MTR].includes(n),minW:"full",oneLine:!0},{type:"switch",label:s("StyleSidePanel.design.overrideTerminal"),isChecked:v.terminal!==!1,onChange:j=>f(vt(j?["",""]:!1)),hidden:![Q.MTR].includes(n),minW:"full",oneLine:!0},{type:"input",label:s("StyleSidePanel.design.terminalZhName"),value:v.terminal?v.terminal[0]:"",placeholder:"機場及博覽館",onChange:j=>f(vt([j,v.terminal?v.terminal[1]:""])),hidden:![Q.MTR].includes(n)||v.terminal===!1},{type:"input",label:s("StyleSidePanel.design.terminalEnName"),value:v.terminal?v.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:j=>f(vt([v.terminal?v.terminal[0]:"",j])),hidden:![Q.MTR].includes(n)||v.terminal===!1}];return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("StyleSidePanel.design.title")}),p.jsx(_e,{fields:[...y,...A],minW:130}),p.jsx(Vt,{isOpen:_,onClose:()=>d(!1),defaultTheme:l,onUpdate:j=>f(Zr(j))})]})}function ks(){const{t:s}=ae(),f=ge(),{branches:n}=ee(_=>_.helper),{loop:l,loop_info:o}=ee(_=>_.param),{bank:t,left_and_right_factor:r,bottom_factor:e}=o,i=n.flat().filter((_=>d=>(_[d]=(_[d]||0)+1)===2)({})).filter(_=>!["linestart","lineend"].includes(_)),c=Math.abs(n[0].indexOf(i[0])-n[0].indexOf(i[1])),v=n.length>=2?(0,Math.min)(n[0].length-2-c,c):Math.floor((n[0].length-2-e*2)/2),u=[{type:"switch",label:s("StyleSidePanel.loop.isLoop"),isChecked:l,onChange:_=>f(Gr(_)),minW:"full",oneLine:!0},{type:"switch",label:s("StyleSidePanel.loop.isBank"),isChecked:t,onChange:_=>f($r(_)),minW:"full",oneLine:!0,hidden:!l},{type:"slider",label:s("StyleSidePanel.loop.leftRightFactor"),value:r,min:0,max:v,onChange:_=>f(Yr(Math.floor(_))),hidden:!l},{type:"slider",label:s("StyleSidePanel.loop.bottomFactor"),value:e,min:0,max:Math.floor((n[0].length-2-r*2)/2),onChange:_=>f(qr(Math.floor(_))),hidden:!l||l&&n.length>2}];return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("StyleSidePanel.loop.title")}),p.jsx(_e,{fields:u})]})}function As(s){const{note:f,onUpdate:n,onDelete:l}=s,{t:o}=ae(),t=[{type:"textarea",label:o("StyleSidePanel.note.zhNote"),value:f[0],onChange:e=>n==null?void 0:n([e,f[1],f[2],f[3],f[4]])},{type:"textarea",label:o("StyleSidePanel.note.enNote"),value:f[1],onChange:e=>n==null?void 0:n([f[0],e,f[2],f[3],f[4]])},{type:"switch",label:o("StyleSidePanel.note.border"),isChecked:f[4],onChange:e=>n==null?void 0:n([f[0],f[1],f[2],f[3],e]),oneLine:!0}],r=[{type:"slider",label:o("StyleSidePanel.note.positionX"),value:f[2],min:0,max:100,onChange:e=>n==null?void 0:n([f[0],f[1],e,f[3],f[4]]),leftIcon:p.jsx(cn,{}),rightIcon:p.jsx(dn,{})},{type:"slider",label:o("StyleSidePanel.note.positionY"),value:f[3],min:0,max:100,onChange:e=>n==null?void 0:n([f[0],f[1],f[2],e,f[4]]),leftIcon:p.jsx(jt,{}),rightIcon:p.jsx(kt,{})}];return p.jsxs(Ue,{direction:"column",children:[p.jsx(_e,{fields:t,minW:"full"}),p.jsxs(Ie,{spacing:.5,sx:{"&>div":{flex:1}},children:[p.jsx(_e,{fields:r}),p.jsx(Pe,{size:"sm",variant:"ghost","aria-label":o("StyleSidePanel.note.remove"),onClick:()=>l==null?void 0:l(),icon:p.jsx(ft,{})})]})]})}function Os(){const{t:s}=ae(),f=ge(),n=ee(l=>l.param.notesGZMTR);return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("StyleSidePanel.note.title")}),p.jsxs(pt,{spacing:.5,children:[n.map((l,o)=>p.jsx(As,{note:l,onUpdate:t=>f(Kr(o,t)),onDelete:()=>f(Xr(o))},o)),p.jsx(de,{size:"xs",variant:"ghost",leftIcon:p.jsx(Le,{}),alignSelf:"flex-end",onClick:()=>f(Jr()),children:s("StyleSidePanel.note.add")})]})]})}function Cs(){const{style:s}=ee(f=>f.param);return p.jsxs(Lt,{children:[p.jsx(Es,{}),p.jsx(He,{}),p.jsx(js,{}),s===Q.GZMTR&&p.jsxs(p.Fragment,{children:[p.jsx(He,{}),p.jsx(Os,{})]}),s===Q.SHMetro&&p.jsxs(p.Fragment,{children:[p.jsx(He,{}),p.jsx(ks,{})]})]})}const Ht=(s,f)=>{if(["linestart","lineend"].includes(s)||f[s].parents.length>1||f[s].children.length>1)return 0;const n=f[s].parents[0];return n?f[n].children.length===1?Ht(n,f):f[n].children.indexOf(s)===0?1:-1:0},Ps=s=>(f,n)=>{const{stn_list:l,current_stn_idx:o}=n().param;if(s===o)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:t,children:r}=l[s];return Object.keys(l).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):t.length===2&&r.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(l).some(i=>![s,"linestart","lineend"].includes(i)&&Ht(i,l)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Rs=s=>(f,n)=>{const l=n().param.stn_list,{parents:o,children:t}=l[s];let r=JSON.parse(JSON.stringify(l));o.length===2||t.length===2?(o.forEach(e=>{r[e].children=t}),t.forEach(e=>{r[e].parents=o}),o.length===1&&(r[o[0]].branch.right=r[s].branch.right),t.length===1&&(r[t[0]].branch.left=r[s].branch.left)):l[o[0]].children.length===2&&l[t[0]].parents.length===2?r={...l,[o[0]]:{...l[o[0]],children:l[o[0]].children.filter(e=>e!==s),branch:{...l[o[0]].branch,right:[]}},[t[0]]:{...l[t[0]],parents:l[t[0]].parents.filter(e=>e!==s),branch:{...l[t[0]].branch,left:[]}}}:(o.forEach(e=>{const i=r[e].children.indexOf(s);t.length?r[e].children[i]=t[0]:r[e].children.splice(i,1),r[e].branch.right[1]===s&&(r[e].branch.right[1]=t[0])}),t.forEach(e=>{const i=r[e].parents.indexOf(s);o.length?r[e].parents[i]=o[0]:r[e].parents.splice(i,1),r[e].branch.left[1]===s&&(r[e].branch.left[1]=o[0])})),delete r[s],f(We(r))};function Ts(...s){return s.reduce((f,n)=>f.map(l=>n.map(o=>l.concat([o]))).reduce((l,o)=>l.concat(o),[]),[[]])}const Je=(s,f)=>!!f[s[0]].children.indexOf(s[1]),yn=(s,f)=>[s[0][1],s[0][s[0].length-2],...s[0].filter(n=>s.slice(1).filter(l=>Je(l,f)).map(l=>l.filter(o=>!["linestart","lineend"].includes(o))).map(l=>[l[0],l[l.length-1]]).flat().includes(n))],zs=(s,f)=>s.slice(1).filter(n=>Je(n,f)).map(n=>n.filter(l=>!["linestart","lineend"].includes(l))).map(n=>[n[0],n[n.length-1]]),Is=s=>(f,n)=>{const l=n().helper.branches;if(s===0){const o=n().param.stn_list,t=yn(l,o);return Ts(t,t).filter(r=>r[0]!==r[1])}else{const o=l[s];if(o){const t=o.filter(r=>!["linestart","lineend"].includes(r));return[[t[0],t.slice(-1)[0]]]}else return[]}},Zi=(s,f)=>(n,l)=>{const o=l().param.coline,t=l().helper.branches[f];for(const[r,e]of Object.entries(o))if(e.from===s&&t.includes(e.to)){const i=t.indexOf(s),c=t.indexOf(e.to);if(c>i)return[c-i+1,r]}else if(e.to===s&&t.includes(e.to)){const i=t.indexOf(s),c=t.indexOf(e.from);if(c>i)return[c-i+1,r]}return[0,void 0]},bn=(s,f)=>(n,l)=>{const o=l().param.stn_list,t=l().helper.branches;if(s===f)throw new Error("addColine():: failed for same stnId");const r=yn(t,o).filter(i=>[s,f].includes(i)),e=zs(t,o).filter(i=>[s,f].every(c=>i.includes(c)));if(r.length===2&&e.length>0)throw new Error(`addColine():: main check failed for ${s}, ${f}`);if(r.length!==2&&e.length!==1)throw new Error(`addColine():: branch check failed for ${s}, ${f}`)},Ls=s=>(f,n)=>{const l=n().param.coline,t=n().helper.branches[s];return t?Object.entries(l).reduce((r,e)=>t.includes(e[1].from)&&t.includes(e[1].to)?{...r,[e[0]]:e[1]}:{...r},{}):{}},Ds=s=>(f,n)=>{const l=n().param.coline;if(Object.keys(l).length===0)return;const o=Object.entries(l).reduce((t,r)=>r[1].from!==s&&r[1].to!==s?{...t,[r[0]]:r[1]}:{...t},{});f(Ke(o))},Fs=(s,f,n,l=!0)=>(o,t)=>{const r=t().param.coline;o(bn(s,f)),o(Ke({...r,[Ye(4)]:{from:s,to:f,colors:n,display:l}}))},Bs=(s,f,n,l=!0)=>(o,t)=>{const r=t().param.coline;if(s in r){o(bn(f,n));const e={...r,[s]:{...r[s],from:f,to:n,display:l}};o(Ke(e))}},Ms=(s,f)=>(n,l)=>{const o=l().param.coline;if(s in o&&o[s].colors.length>f){const t=o[s].colors.filter((r,e)=>e!==f);if(t.length===0){const{[s]:r,...e}=o;n(Ke(e))}else{const r={...o,[s]:{...o[s],colors:t}};n(Ke(r))}}},Vs=(s,f,n)=>(l,o)=>{const t=o().param.coline;s in t&&t[s].colors.length>f&&(t[s].colors=t[s].colors.map((r,e)=>e===f?[0,1,2,3,4,5].map(i=>n[i]===void 0?r[i]:n[i]):r),l(Ke(t)))};function Ns(s){const{isOpen:f,onClose:n}=s,{t:l}=ae(),o=ge(),t=ee(c=>c.app.selectedStation),[r,e]=K.useState(!1);K.useEffect(()=>{f||e(!1)},[f]);const i=()=>{const c=o(Ps(t));c?(n(),o(Xe(Ze.CLOSE)),o(fn("linestart")),o(Ds(t)),o(Rs(t))):e(!0),he.event(ye.REMOVE_STATION,{success:c})};return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[r&&p.jsxs(Ft,{status:"error",variant:"solid",size:"xs",children:[p.jsx(Bt,{}),l("Unable to remove this station.")]}),p.jsxs(Se,{position:"relative",children:[p.jsx(Me,{children:l("Remove station")}),p.jsx(Ve,{})]}),p.jsx(Ne,{children:l("Are you sure to remove station? You cannot undo this action.")}),p.jsxs(Ge,{children:[p.jsx(de,{onClick:n,children:l("Cancel")}),p.jsx(de,{colorScheme:"primary",onClick:i,ml:3,children:l("Confirm")})]})]})]})}function Hs(){const{t:s}=ae(),f=ge(),n=ee(t=>t.app.selectedStation),[l,o]=K.useState(!1);return p.jsxs(Hn,{children:[p.jsxs(Ie,{children:[p.jsx(de,{size:"sm",variant:"outline",onClick:()=>f(Ct(n)),children:s("StationSidePanel.footer.current")}),p.jsx(de,{size:"sm",variant:"outline",onClick:()=>o(!0),children:s("StationSidePanel.footer.remove")})]}),p.jsx(Ns,{isOpen:l,onClose:()=>o(!1)})]})}function Us(s){const{colineInfo:f,routeOptions:n,onUpdateRoute:l,onUpdateColourInfo:o,onDelete:t}=s,{t:r}=ae(),[e,i]=K.useState(!1),c=[{type:"select",label:"Route",value:[f.from,f.to].join(","),options:n,onChange:u=>l==null?void 0:l(u)}],v=[{type:"custom",label:r("Colour"),component:p.jsx(Nt,{theme:[f.colors[0][0],f.colors[0][1],f.colors[0][2],f.colors[0][3]],onClick:()=>i(!0)})},{type:"input",label:r("Chinese name"),value:f.colors[0][4],minW:120,onChange:u=>o==null?void 0:o([f.colors[0][0],f.colors[0][1],f.colors[0][2],f.colors[0][3],u,f.colors[0][5]])},{type:"input",label:r("English name"),value:f.colors[0][5],minW:120,onChange:u=>o==null?void 0:o([f.colors[0][0],f.colors[0][1],f.colors[0][2],f.colors[0][3],f.colors[0][4],u])}];return p.jsxs(Ue,{direction:"column",children:[p.jsx(_e,{fields:c,minW:"full"}),p.jsxs(Ie,{spacing:.5,children:[p.jsx(_e,{fields:v}),p.jsx(Pe,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>t==null?void 0:t(0),icon:p.jsx(ft,{})})]}),p.jsx(Vt,{isOpen:e,onClose:()=>i(!1),defaultTheme:f.colors[0].slice(0,4),onUpdate:u=>o==null?void 0:o([...u,f.colors[0][4],f.colors[0][5]])})]})}function Ws(){const{t:s}=ae(),f=ge(),n=ee(_=>_.app.selectedBranch),{theme:l,stn_list:o}=ee(_=>_.param),t=f(Ls(n)),r=f(Is(n)),e=_=>_.map(d=>o[d].name.join(" - ")).join(" ~ "),i=r.reduce((_,d)=>({..._,[d.join(",")]:e(d)}),{}),c=()=>{console.log(`ColineSection.handleAddTrackSharing():: Adding track sharing to branch ${n} with default combination`,r[0]),f(Fs(r[0][0],r[0][1],[[l[0],"","#AAAAAA",we.white,"",""]]))},v=_=>d=>{const[g,m]=d.split(",");console.log(`ColineSection.handleUpdateRoute():: Updating route, colineId=${_}, from=${g}, to=${m}`);try{f(Bs(_,g,m))}catch(b){f(Pt({status:"error",message:"Unable to draw this share track."}))}},u=(_,d)=>{f(Ms(_,d))};return p.jsxs(pt,{align:"flex-start",p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("BranchSidePanel.coline.title")}),Object.entries(t).map(([_,d])=>p.jsx(Us,{colineInfo:d,routeOptions:i,onUpdateRoute:v(_),onUpdateColourInfo:g=>f(Vs(_,0,g)),onDelete:g=>u(_,g)},_)),(n===0||Object.keys(t).length===0)&&p.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:p.jsx(Le,{}),onClick:c,children:s("BranchSidePanel.coline.add")})]})}function Zs(s){const{isOpen:f,onClose:n}=s,{t:l}=ae(),o=ge(),t=ee(j=>j.app.selectedBranch),{style:r,stn_list:e}=ee(j=>j.param),i=ee(j=>j.helper.branches),[c,v]=K.useState(t),[u,_]=K.useState("1"),[d,g]=K.useState("2"),[m,b]=K.useState("asc");K.useEffect(()=>{v(t)},[t]);const y=[{type:"select",label:l("AutoNumModal.where"),value:c,options:{...i.reduce((j,O,F)=>({...j,[F]:F===0?l("AutoNumModal.main"):r!==Q.SHMetro||!Je(O,e)?l("AutoNumModal.branch")+" "+F:l("AutoNumModal.external")+" "+F}),{})},onChange:j=>v(j)},{type:"input",label:l("AutoNumModal.from"),value:u,validator:j=>!isNaN(Number(j)),onChange:_,debouncedDelay:0},{type:"input",label:l("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:d,onChange:g,debouncedDelay:0},{type:"select",label:l("AutoNumModal.sort"),value:m,options:{asc:l("AutoNumModal.asc"),desc:l("AutoNumModal.desc")},onChange:j=>b(j)}],S=()=>{o(Qr(c,Number(u),Number(d),m)),n(),he.event(ye.AUTO_NUMBERING,{})},A=!u||!d||isNaN(Number(u))||isNaN(Number(d));return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[p.jsx(Me,{children:l("AutoNumModal.title")}),p.jsx(Ve,{}),p.jsx(Ne,{children:p.jsx(_e,{fields:y})}),p.jsx(Ge,{children:p.jsx(de,{colorScheme:"primary",isDisabled:A,onClick:S,children:l("Confirm")})})]})]})}const Ut=s=>(f,n)=>{const o=n().helper.branches[s];return o.includes("linestart")||o.includes("lineend")?1:2},xn=s=>(f,n)=>{const{branches:l}=n().helper,o=l[0],t=l[s];return o.slice(o.indexOf(t[0])+1,o.indexOf(t.slice(-1)[0]))},Gs=(s,f)=>n=>n(Ut(f))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(xn(f)).includes(s)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),$s=(s,f)=>(n,l)=>{if(!n(Gs(s,f)))return!1;const{branches:t}=l().helper,r=l().param.stn_list,e=t[f];if(e[0]==="linestart"){const i={...r,[e[1]]:{...r[e[1]],parents:[s]},[s]:{...r[s],children:r.linestart.children.map(c=>c===e[1]?c:r[s].children[0]),branch:{left:[],right:r.linestart.branch.right}},linestart:{...r.linestart,children:r.linestart.children.filter(c=>c!==e[1]),branch:{left:[],right:[]}}};return n(We(i)),!0}else{const i=e.slice(-2)[0],c={...r,[i]:{...r[i],children:[s]},[s]:{...r[s],parents:r.lineend.parents.map(v=>v===i?v:r[s].parents[0]),branch:{right:[],left:r.lineend.branch.left}},lineend:{...r.lineend,parents:r.lineend.parents.filter(v=>v!==i),branch:{left:[],right:[]}}};return n(We(c)),!0}},Sn=s=>(f,n)=>{const{branches:l}=n().helper,o=n().param.stn_list,t=l[0],r=l[s];if(f(Ut(s))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const i=t.indexOf(r[0]),c=t.slice(0,i),v=t.indexOf(r.slice(-1)[0]),u=t.slice(v+1),_=c.every(g=>o[g].children.length<=1&&o[g].parents.length<=1),d=u.every(g=>o[g].children.length<=1&&o[g].parents.length<=1);return _?d?[je.left,je.right]:[je.left]:d?[je.right]:[]},Ys=(s,f)=>(n,l)=>{if(!n(Sn(f)).includes(s))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:t}=l().helper,r=l().param.stn_list,e=t[0],i=t[f];if(s===je.left){const c=i[0],v={...r,[i[1]]:{...r[i[1]],parents:["linestart"]},[c]:{...r[c],children:r[c].children.filter(u=>u!==i[1]),branch:{right:[],left:[]}},linestart:{...r.linestart,children:r[c].children.map(u=>u===i[1]?u:e[1]),branch:{left:[],right:r[c].branch.right}}};return n(We(v)),!0}else{const c=i.slice(-1)[0],v=i.slice(-2)[0],u={...r,[v]:{...r[v],children:["lineend"]},[c]:{...r[c],parents:r[c].parents.filter(_=>_!==v),branch:{right:[],left:[]}},lineend:{...r.lineend,parents:r[c].parents.map(_=>_===v?_:e.slice(-2)[0]),branch:{right:[],left:r[c].branch.left}}};return n(We(u)),!0}};function nn(s){const{direction:f}=s,{t:n}=ae(),l=ge(),{branches:o}=ee(z=>z.helper),t=ee(z=>z.app.selectedBranch),{style:r,stn_list:e}=ee(z=>z.param),[i,c]=K.useState(!1),[v,u]=K.useState(""),_=o[t].filter(z=>!["linestart","lineend"].includes(z)),d=f===je.left?_[0]:_.slice(-1)[0],g=e[d],m=l(xn(t)),b=l(Ut(t)),y=l(Sn(t)),S=b===1&&!o[0].includes(d),A=y.includes(f),j=m.reduce((z,B)=>{var R;return{...z,[B]:(R=e[B])==null?void 0:R.name.join(" - ")}},{"":n("Please select...")}),O=()=>{const z=l($s(v,t));z?c(!1):l(Pt({status:"error",message:n("Unable to connect to main line.")})),he.event(ye.CONNECT_BRANCH,{style:r,success:z})},F=()=>{const z=l(Ys(f,t));z||l(Pt({status:"error",message:n("Unable to disconnect from main line.")})),he.event(ye.DISCONNECT_BRANCH,{style:r,success:z})};return p.jsxs(Ue,{direction:"column",children:[p.jsxs(Ae,{alignItems:"center",children:[p.jsx(Et,{label:n("Station name"),flex:1,children:p.jsx(Un,{defaultValue:g.name.join(" "),isDisabled:!0})}),i?p.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>c(!1),children:n("Cancel")}):S?p.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>c(!0),children:n("Connect to main line")}):p.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:F,isDisabled:!A,children:n("Disconnect from main line")})]}),i&&p.jsxs(Ae,{alignItems:"center",children:[p.jsx(Et,{label:n("Target station"),flex:1,children:p.jsx(Wn,{defaultValue:v,options:j,disabledOptions:[""],onChange:({target:{value:z}})=>u(z)})}),p.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:O,isDisabled:!v,children:n("Confirm")})]})]})}function qs(){const{t:s}=ae(),f=ge(),n=ee(e=>e.param.style),l=ee(e=>e.app.selectedBranch),[o,t]=K.useState(!1),r=()=>{f(es(n===Q.SHMetro)),he.event(ye.REVERSE_STATIONS,{style:n})};return p.jsxs(Se,{p:1,children:[p.jsx(xe,{as:"h5",size:"sm",children:s("BranchSidePanel.action.title")}),p.jsxs(Ae,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[l!==0&&n!==Q.SHMetro&&p.jsxs(p.Fragment,{children:[p.jsx(xe,{as:"h6",size:"xs",children:s("Branch left end")}),p.jsx(nn,{direction:je.left}),p.jsx(xe,{as:"h6",size:"xs",children:s("Branch right end")}),p.jsx(nn,{direction:je.right})]}),n===Q.GZMTR&&p.jsx(de,{size:"sm",variant:"outline",leftIcon:p.jsx(Zn,{}),alignSelf:"flex-end",onClick:()=>t(!0),children:s("BranchSidePanel.action.autoNum")}),p.jsx(de,{size:"sm",variant:"outline",leftIcon:p.jsx(Gn,{}),alignSelf:"flex-end",onClick:r,children:n===Q.SHMetro?s("BranchSidePanel.action.flip"):s("BranchSidePanel.action.reverse")})]}),p.jsx(Zs,{isOpen:o,onClose:()=>t(!1)})]})}function Ks(){const s=ee(o=>o.app.selectedBranch),{style:f,stn_list:n}=ee(o=>o.param),l=ee(o=>o.helper.branches);return p.jsxs(Lt,{children:[f===Q.SHMetro&&(s===0||Je(l[s],n))&&p.jsxs(p.Fragment,{children:[p.jsx(Ws,{}),p.jsx(He,{})]}),p.jsx(qs,{})]})}const Xs=375;function Js(){var e,i;const{t:s}=ae(),f=Dt(),{sidePanelMode:n,selectedStation:l}=ee(c=>c.app),o=ee(c=>{var v;return(v=c.param.stn_list[l])==null?void 0:v.name}),t={STATION:{header:p.jsx($n,{text:(o==null?void 0:o.join(" - "))||""}),body:p.jsx(ws,{}),footer:p.jsx(Hs,{})},STYLE:{header:s("StyleSidePanel.header"),body:p.jsx(Cs,{})},BRANCH:{header:s("BranchSidePanel.header"),body:p.jsx(Ks,{})},CLOSE:{header:"Close"}},r=()=>{f(Xe(Ze.CLOSE))};return p.jsxs(Yn,{isOpen:n!==Ze.CLOSE,width:Xs,header:"Dummy header",children:[p.jsx(qn,{onClose:r,children:t[n].header}),(e=t[n])==null?void 0:e.body,(i=t[n])==null?void 0:i.footer]})}const wn=(s,f,n)=>{const l=new Blob([n],{type:f});Rt(s,l)},Rt=(s,f)=>{const n=window.URL.createObjectURL(f),l=document.createElement("a");l.href=n,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(n)},Qs=s=>new Promise(f=>{const n=new FileReader;n.onloadend=()=>f(n.result),n.readAsText(s)}),En=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),ei=s=>{if(s){const f=new Date().getTime()-s;return f<60*1e3?["Just now"]:f<2*60*1e3?["1","minute ago"]:f<60*60*1e3?[Math.floor(f/1e3/60).toString(),"minutes ago"]:f<2*60*60*1e3?["1","hour ago"]:f<24*60*60*1e3?[Math.floor(f/1e3/60/60).toString(),"hours ago"]:f<48*60*60*1e3?["1","day ago"]:[Math.floor(f/1e3/60/60/24).toString(),"days ago"]}else return["Unknown"]};function dt(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,f){(function(n){s.exports=n()})(function(){return function n(l,o,t){function r(c,v){if(!o[c]){if(!l[c]){var u=typeof dt=="function"&&dt;if(!v&&u)return u(c,!0);if(e)return e(c,!0);var _=new Error("Cannot find module '"+c+"'");throw _.code="MODULE_NOT_FOUND",_}var d=o[c]={exports:{}};l[c][0].call(d.exports,function(g){var m=l[c][1][g];return r(m||g)},d,d.exports,n,l,o,t)}return o[c].exports}for(var e=typeof dt=="function"&&dt,i=0;i<t.length;i++)r(t[i]);return r}({1:[function(n,l,o){var t=n("./utils"),r=n("./support"),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(i){for(var c,v,u,_,d,g,m,b=[],y=0,S=i.length,A=S,j=t.getTypeOf(i)!=="string";y<i.length;)A=S-y,u=j?(c=i[y++],v=y<S?i[y++]:0,y<S?i[y++]:0):(c=i.charCodeAt(y++),v=y<S?i.charCodeAt(y++):0,y<S?i.charCodeAt(y++):0),_=c>>2,d=(3&c)<<4|v>>4,g=1<A?(15&v)<<2|u>>6:64,m=2<A?63&u:64,b.push(e.charAt(_)+e.charAt(d)+e.charAt(g)+e.charAt(m));return b.join("")},o.decode=function(i){var c,v,u,_,d,g,m=0,b=0,y="data:";if(i.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var S,A=3*(i=i.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(i.charAt(i.length-1)===e.charAt(64)&&A--,i.charAt(i.length-2)===e.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(S=r.uint8array?new Uint8Array(0|A):new Array(0|A);m<i.length;)c=e.indexOf(i.charAt(m++))<<2|(_=e.indexOf(i.charAt(m++)))>>4,v=(15&_)<<4|(d=e.indexOf(i.charAt(m++)))>>2,u=(3&d)<<6|(g=e.indexOf(i.charAt(m++))),S[b++]=c,d!==64&&(S[b++]=v),g!==64&&(S[b++]=u);return S}},{"./support":30,"./utils":32}],2:[function(n,l,o){var t=n("./external"),r=n("./stream/DataWorker"),e=n("./stream/Crc32Probe"),i=n("./stream/DataLengthProbe");function c(v,u,_,d,g){this.compressedSize=v,this.uncompressedSize=u,this.crc32=_,this.compression=d,this.compressedContent=g}c.prototype={getContentWorker:function(){var v=new r(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new i("data_length")),u=this;return v.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new r(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(v,u,_){return v.pipe(new e).pipe(new i("uncompressedSize")).pipe(u.compressWorker(_)).pipe(new i("compressedSize")).withStreamInfo("compression",u)},l.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,l,o){var t=n("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},o.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,l,o){var t=n("./utils"),r=function(){for(var e,i=[],c=0;c<256;c++){e=c;for(var v=0;v<8;v++)e=1&e?3988292384^e>>>1:e>>>1;i[c]=e}return i}();l.exports=function(e,i){return e!==void 0&&e.length?t.getTypeOf(e)!=="string"?function(c,v,u,_){var d=r,g=_+u;c^=-1;for(var m=_;m<g;m++)c=c>>>8^d[255&(c^v[m])];return-1^c}(0|i,e,e.length,0):function(c,v,u,_){var d=r,g=_+u;c^=-1;for(var m=_;m<g;m++)c=c>>>8^d[255&(c^v.charCodeAt(m))];return-1^c}(0|i,e,e.length,0):0}},{"./utils":32}],5:[function(n,l,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(n,l,o){var t=null;t=typeof Promise<"u"?Promise:n("lie"),l.exports={Promise:t}},{lie:37}],7:[function(n,l,o){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=n("pako"),e=n("./utils"),i=n("./stream/GenericWorker"),c=t?"uint8array":"array";function v(u,_){i.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=_,this.meta={}}o.magic="\b\0",e.inherits(v,i),v.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(e.transformTo(c,u.data),!1)},v.prototype.flush=function(){i.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(_){u.push({data:_,meta:u.meta})}},o.compressWorker=function(u){return new v("Deflate",u)},o.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,l,o){function t(d,g){var m,b="";for(m=0;m<g;m++)b+=String.fromCharCode(255&d),d>>>=8;return b}function r(d,g,m,b,y,S){var A,j,O=d.file,F=d.compression,z=S!==c.utf8encode,B=e.transformTo("string",S(O.name)),R=e.transformTo("string",c.utf8encode(O.name)),N=O.comment,Y=e.transformTo("string",S(N)),k=e.transformTo("string",c.utf8encode(N)),D=R.length!==O.name.length,h=k.length!==N.length,M="",re="",W="",ie=O.dir,Z=O.date,se={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(se.crc32=d.crc32,se.compressedSize=d.compressedSize,se.uncompressedSize=d.uncompressedSize);var I=0;g&&(I|=8),z||!D&&!h||(I|=2048);var T=0,ne=0;ie&&(T|=16),y==="UNIX"?(ne=798,T|=function(q,me){var be=q;return q||(be=me?16893:33204),(65535&be)<<16}(O.unixPermissions,ie)):(ne=20,T|=function(q){return 63&(q||0)}(O.dosPermissions)),A=Z.getUTCHours(),A<<=6,A|=Z.getUTCMinutes(),A<<=5,A|=Z.getUTCSeconds()/2,j=Z.getUTCFullYear()-1980,j<<=4,j|=Z.getUTCMonth()+1,j<<=5,j|=Z.getUTCDate(),D&&(re=t(1,1)+t(v(B),4)+R,M+="up"+t(re.length,2)+re),h&&(W=t(1,1)+t(v(Y),4)+k,M+="uc"+t(W.length,2)+W);var X="";return X+=`
\0`,X+=t(I,2),X+=F.magic,X+=t(A,2),X+=t(j,2),X+=t(se.crc32,4),X+=t(se.compressedSize,4),X+=t(se.uncompressedSize,4),X+=t(B.length,2),X+=t(M.length,2),{fileRecord:u.LOCAL_FILE_HEADER+X+B+M,dirRecord:u.CENTRAL_FILE_HEADER+t(ne,2)+X+t(Y.length,2)+"\0\0\0\0"+t(T,4)+t(b,4)+B+M+Y}}var e=n("../utils"),i=n("../stream/GenericWorker"),c=n("../utf8"),v=n("../crc32"),u=n("../signature");function _(d,g,m,b){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}e.inherits(_,i),_.prototype.push=function(d){var g=d.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,i.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-b-1))/m:100}}))},_.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var g=this.streamFiles&&!d.file.dir;if(g){var m=r(d,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(d){this.accumulate=!1;var g=this.streamFiles&&!d.file.dir,m=r(d,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(b){return u.DATA_DESCRIPTOR+t(b.crc32,4)+t(b.compressedSize,4)+t(b.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var d=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-d,b=function(y,S,A,j,O){var F=e.transformTo("string",O(j));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(y,2)+t(y,2)+t(S,4)+t(A,4)+t(F.length,2)+F}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(d){this._sources.push(d);var g=this;return d.on("data",function(m){g.processChunk(m)}),d.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),d.on("error",function(m){g.error(m)}),this},_.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(d){var g=this._sources;if(!i.prototype.error.call(this,d))return!1;for(var m=0;m<g.length;m++)try{g[m].error(d)}catch(b){}return!0},_.prototype.lock=function(){i.prototype.lock.call(this);for(var d=this._sources,g=0;g<d.length;g++)d[g].lock()},l.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,l,o){var t=n("../compressions"),r=n("./ZipFileWorker");o.generateWorker=function(e,i,c){var v=new r(i.streamFiles,c,i.platform,i.encodeFileName),u=0;try{e.forEach(function(_,d){u++;var g=function(S,A){var j=S||A,O=t[j];if(!O)throw new Error(j+" is not a valid compression method !");return O}(d.options.compression,i.compression),m=d.options.compressionOptions||i.compressionOptions||{},b=d.dir,y=d.date;d._compressWorker(g,m).withStreamInfo("file",{name:_,dir:b,date:y,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(v)}),v.entriesCount=u}catch(_){v.error(_)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,l,o){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new t;for(var e in this)typeof this[e]!="function"&&(r[e]=this[e]);return r}}(t.prototype=n("./object")).loadAsync=n("./load"),t.support=n("./support"),t.defaults=n("./defaults"),t.version="3.10.1",t.loadAsync=function(r,e){return new t().loadAsync(r,e)},t.external=n("./external"),l.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,l,o){var t=n("./utils"),r=n("./external"),e=n("./utf8"),i=n("./zipEntries"),c=n("./stream/Crc32Probe"),v=n("./nodejsUtils");function u(_){return new r.Promise(function(d,g){var m=_.decompressed.getContentWorker().pipe(new c);m.on("error",function(b){g(b)}).on("end",function(){m.streamInfo.crc32!==_.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}l.exports=function(_,d){var g=this;return d=t.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:e.utf8decode}),v.isNode&&v.isStream(_)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",_,!0,d.optimizedBinaryString,d.base64).then(function(m){var b=new i(d);return b.load(m),b}).then(function(m){var b=[r.Promise.resolve(m)],y=m.files;if(d.checkCRC32)for(var S=0;S<y.length;S++)b.push(u(y[S]));return r.Promise.all(b)}).then(function(m){for(var b=m.shift(),y=b.files,S=0;S<y.length;S++){var A=y[S],j=A.fileNameStr,O=t.resolve(A.fileNameStr);g.file(O,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:d.createFolders}),A.dir||(g.file(O).unsafeOriginalName=j)}return b.zipComment.length&&(g.comment=b.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,l,o){var t=n("../utils"),r=n("../stream/GenericWorker");function e(i,c){r.call(this,"Nodejs stream input adapter for "+i),this._upstreamEnded=!1,this._bindStream(c)}t.inherits(e,r),e.prototype._bindStream=function(i){var c=this;(this._stream=i).pause(),i.on("data",function(v){c.push({data:v,meta:{percent:0}})}).on("error",function(v){c.isPaused?this.generatedError=v:c.error(v)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},e.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},e.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=e},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,l,o){var t=n("readable-stream").Readable;function r(e,i,c){t.call(this,i),this._helper=e;var v=this;e.on("data",function(u,_){v.push(u)||v._helper.pause(),c&&c(_)}).on("error",function(u){v.emit("error",u)}).on("end",function(){v.push(null)})}n("../utils").inherits(r,t),r.prototype._read=function(){this._helper.resume()},l.exports=r},{"../utils":32,"readable-stream":16}],14:[function(n,l,o){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,r);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,r)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var r=new Buffer(t);return r.fill(0),r},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(n,l,o){function t(O,F,z){var B,R=e.getTypeOf(F),N=e.extend(z||{},v);N.date=N.date||new Date,N.compression!==null&&(N.compression=N.compression.toUpperCase()),typeof N.unixPermissions=="string"&&(N.unixPermissions=parseInt(N.unixPermissions,8)),N.unixPermissions&&16384&N.unixPermissions&&(N.dir=!0),N.dosPermissions&&16&N.dosPermissions&&(N.dir=!0),N.dir&&(O=y(O)),N.createFolders&&(B=b(O))&&S.call(this,B,!0);var Y=R==="string"&&N.binary===!1&&N.base64===!1;z&&z.binary!==void 0||(N.binary=!Y),(F instanceof u&&F.uncompressedSize===0||N.dir||!F||F.length===0)&&(N.base64=!1,N.binary=!0,F="",N.compression="STORE",R="string");var k=null;k=F instanceof u||F instanceof i?F:g.isNode&&g.isStream(F)?new m(O,F):e.prepareContent(O,F,N.binary,N.optimizedBinaryString,N.base64);var D=new _(O,k,N);this.files[O]=D}var r=n("./utf8"),e=n("./utils"),i=n("./stream/GenericWorker"),c=n("./stream/StreamHelper"),v=n("./defaults"),u=n("./compressedObject"),_=n("./zipObject"),d=n("./generate"),g=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(O){O.slice(-1)==="/"&&(O=O.substring(0,O.length-1));var F=O.lastIndexOf("/");return 0<F?O.substring(0,F):""},y=function(O){return O.slice(-1)!=="/"&&(O+="/"),O},S=function(O,F){return F=F!==void 0?F:v.createFolders,O=y(O),this.files[O]||t.call(this,O,null,{dir:!0,createFolders:F}),this.files[O]};function A(O){return Object.prototype.toString.call(O)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(O){var F,z,B;for(F in this.files)B=this.files[F],(z=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&O(z,B)},filter:function(O){var F=[];return this.forEach(function(z,B){O(z,B)&&F.push(B)}),F},file:function(O,F,z){if(arguments.length!==1)return O=this.root+O,t.call(this,O,F,z),this;if(A(O)){var B=O;return this.filter(function(N,Y){return!Y.dir&&B.test(N)})}var R=this.files[this.root+O];return R&&!R.dir?R:null},folder:function(O){if(!O)return this;if(A(O))return this.filter(function(R,N){return N.dir&&O.test(R)});var F=this.root+O,z=S.call(this,F),B=this.clone();return B.root=z.name,B},remove:function(O){O=this.root+O;var F=this.files[O];if(F||(O.slice(-1)!=="/"&&(O+="/"),F=this.files[O]),F&&!F.dir)delete this.files[O];else for(var z=this.filter(function(R,N){return N.name.slice(0,O.length)===O}),B=0;B<z.length;B++)delete this.files[z[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(O){var F,z={};try{if((z=e.extend(O||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=z.type.toLowerCase(),z.compression=z.compression.toUpperCase(),z.type==="binarystring"&&(z.type="string"),!z.type)throw new Error("No output type specified.");e.checkSupport(z.type),z.platform!=="darwin"&&z.platform!=="freebsd"&&z.platform!=="linux"&&z.platform!=="sunos"||(z.platform="UNIX"),z.platform==="win32"&&(z.platform="DOS");var B=z.comment||this.comment||"";F=d.generateWorker(this,z,B)}catch(R){(F=new i("error")).error(R)}return new c(F,z.type||"string",z.mimeType)},generateAsync:function(O,F){return this.generateInternalStream(O).accumulate(F)},generateNodeStream:function(O,F){return(O=O||{}).type||(O.type="nodebuffer"),this.generateInternalStream(O).toNodejsStream(F)}};l.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,l,o){l.exports=n("stream")},{stream:void 0}],17:[function(n,l,o){var t=n("./DataReader");function r(e){t.call(this,e);for(var i=0;i<this.data.length;i++)e[i]=255&e[i]}n("../utils").inherits(r,t),r.prototype.byteAt=function(e){return this.data[this.zero+e]},r.prototype.lastIndexOfSignature=function(e){for(var i=e.charCodeAt(0),c=e.charCodeAt(1),v=e.charCodeAt(2),u=e.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===i&&this.data[_+1]===c&&this.data[_+2]===v&&this.data[_+3]===u)return _-this.zero;return-1},r.prototype.readAndCheckSignature=function(e){var i=e.charCodeAt(0),c=e.charCodeAt(1),v=e.charCodeAt(2),u=e.charCodeAt(3),_=this.readData(4);return i===_[0]&&c===_[1]&&v===_[2]&&u===_[3]},r.prototype.readData=function(e){if(this.checkOffset(e),e===0)return[];var i=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,i},l.exports=r},{"../utils":32,"./DataReader":18}],18:[function(n,l,o){var t=n("../utils");function r(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var i,c=0;for(this.checkOffset(e),i=this.index+e-1;i>=this.index;i--)c=(c<<8)+this.byteAt(i);return this.index+=e,c},readString:function(e){return t.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},l.exports=r},{"../utils":32}],19:[function(n,l,o){var t=n("./Uint8ArrayReader");function r(e){t.call(this,e)}n("../utils").inherits(r,t),r.prototype.readData=function(e){this.checkOffset(e);var i=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,i},l.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,l,o){var t=n("./DataReader");function r(e){t.call(this,e)}n("../utils").inherits(r,t),r.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},r.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},r.prototype.readData=function(e){this.checkOffset(e);var i=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,i},l.exports=r},{"../utils":32,"./DataReader":18}],21:[function(n,l,o){var t=n("./ArrayReader");function r(e){t.call(this,e)}n("../utils").inherits(r,t),r.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array(0);var i=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,i},l.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(n,l,o){var t=n("../utils"),r=n("../support"),e=n("./ArrayReader"),i=n("./StringReader"),c=n("./NodeBufferReader"),v=n("./Uint8ArrayReader");l.exports=function(u){var _=t.getTypeOf(u);return t.checkSupport(_),_!=="string"||r.uint8array?_==="nodebuffer"?new c(u):r.uint8array?new v(t.transformTo("uint8array",u)):new e(t.transformTo("array",u)):new i(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,l,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,l,o){var t=n("./GenericWorker"),r=n("../utils");function e(i){t.call(this,"ConvertWorker to "+i),this.destType=i}r.inherits(e,t),e.prototype.processChunk=function(i){this.push({data:r.transformTo(this.destType,i.data),meta:i.meta})},l.exports=e},{"../utils":32,"./GenericWorker":28}],25:[function(n,l,o){var t=n("./GenericWorker"),r=n("../crc32");function e(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(e,t),e.prototype.processChunk=function(i){this.streamInfo.crc32=r(i.data,this.streamInfo.crc32||0),this.push(i)},l.exports=e},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,l,o){var t=n("../utils"),r=n("./GenericWorker");function e(i){r.call(this,"DataLengthProbe for "+i),this.propName=i,this.withStreamInfo(i,0)}t.inherits(e,r),e.prototype.processChunk=function(i){if(i){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+i.data.length}r.prototype.processChunk.call(this,i)},l.exports=e},{"../utils":32,"./GenericWorker":28}],27:[function(n,l,o){var t=n("../utils"),r=n("./GenericWorker");function e(i){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,i.then(function(v){c.dataIsReady=!0,c.data=v,c.max=v&&v.length||0,c.type=t.getTypeOf(v),c.isPaused||c._tickAndRepeat()},function(v){c.error(v)})}t.inherits(e,r),e.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},e.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},e.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},e.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var i=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":i=this.data.substring(this.index,c);break;case"uint8array":i=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":i=this.data.slice(this.index,c)}return this.index=c,this.push({data:i,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=e},{"../utils":32,"./GenericWorker":28}],28:[function(n,l,o){function t(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,e){return this._listeners[r].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,e){if(this._listeners[r])for(var i=0;i<this._listeners[r].length;i++)this._listeners[r][i].call(this,e)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var e=this;return r.on("data",function(i){e.processChunk(i)}),r.on("end",function(){e.end()}),r.on("error",function(i){e.error(i)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,e){return this.extraStreamInfo[r]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},l.exports=t},{}],29:[function(n,l,o){var t=n("../utils"),r=n("./ConvertWorker"),e=n("./GenericWorker"),i=n("../base64"),c=n("../support"),v=n("../external"),u=null;if(c.nodestream)try{u=n("../nodejs/NodejsStreamOutputAdapter")}catch(g){}function _(g,m){return new v.Promise(function(b,y){var S=[],A=g._internalType,j=g._outputType,O=g._mimeType;g.on("data",function(F,z){S.push(F),m&&m(z)}).on("error",function(F){S=[],y(F)}).on("end",function(){try{var F=function(z,B,R){switch(z){case"blob":return t.newBlob(t.transformTo("arraybuffer",B),R);case"base64":return i.encode(B);default:return t.transformTo(z,B)}}(j,function(z,B){var R,N=0,Y=null,k=0;for(R=0;R<B.length;R++)k+=B[R].length;switch(z){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Y=new Uint8Array(k),R=0;R<B.length;R++)Y.set(B[R],N),N+=B[R].length;return Y;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+z+"'")}}(A,S),O);b(F)}catch(z){y(z)}S=[]}).resume()})}function d(g,m,b){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=b,t.checkSupport(y),this._worker=g.pipe(new r(y)),g.lock()}catch(S){this._worker=new e("error"),this._worker.error(S)}}d.prototype={accumulate:function(g){return _(this,g)},on:function(g,m){var b=this;return g==="data"?this._worker.on(g,function(y){m.call(b,y.data,y.meta)}):this._worker.on(g,function(){t.delay(m,arguments,b)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},g)}},l.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,l,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var t=new ArrayBuffer(0);try{o.blob=new Blob([t],{type:"application/zip"}).size===0}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(t),o.blob=r.getBlob("application/zip").size===0}catch(i){o.blob=!1}}}try{o.nodestream=!!n("readable-stream").Readable}catch(e){o.nodestream=!1}},{"readable-stream":16}],31:[function(n,l,o){for(var t=n("./utils"),r=n("./support"),e=n("./nodejsUtils"),i=n("./stream/GenericWorker"),c=new Array(256),v=0;v<256;v++)c[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;c[254]=c[254]=1;function u(){i.call(this,"utf-8 decode"),this.leftOver=null}function _(){i.call(this,"utf-8 encode")}o.utf8encode=function(d){return r.nodebuffer?e.newBufferFrom(d,"utf-8"):function(g){var m,b,y,S,A,j=g.length,O=0;for(S=0;S<j;S++)(64512&(b=g.charCodeAt(S)))==55296&&S+1<j&&(64512&(y=g.charCodeAt(S+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),S++),O+=b<128?1:b<2048?2:b<65536?3:4;for(m=r.uint8array?new Uint8Array(O):new Array(O),S=A=0;A<O;S++)(64512&(b=g.charCodeAt(S)))==55296&&S+1<j&&(64512&(y=g.charCodeAt(S+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),S++),b<128?m[A++]=b:(b<2048?m[A++]=192|b>>>6:(b<65536?m[A++]=224|b>>>12:(m[A++]=240|b>>>18,m[A++]=128|b>>>12&63),m[A++]=128|b>>>6&63),m[A++]=128|63&b);return m}(d)},o.utf8decode=function(d){return r.nodebuffer?t.transformTo("nodebuffer",d).toString("utf-8"):function(g){var m,b,y,S,A=g.length,j=new Array(2*A);for(m=b=0;m<A;)if((y=g[m++])<128)j[b++]=y;else if(4<(S=c[y]))j[b++]=65533,m+=S-1;else{for(y&=S===2?31:S===3?15:7;1<S&&m<A;)y=y<<6|63&g[m++],S--;1<S?j[b++]=65533:y<65536?j[b++]=y:(y-=65536,j[b++]=55296|y>>10&1023,j[b++]=56320|1023&y)}return j.length!==b&&(j.subarray?j=j.subarray(0,b):j.length=b),t.applyFromCharCode(j)}(d=t.transformTo(r.uint8array?"uint8array":"array",d))},t.inherits(u,i),u.prototype.processChunk=function(d){var g=t.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var b=function(S,A){var j;for((A=A||S.length)>S.length&&(A=S.length),j=A-1;0<=j&&(192&S[j])==128;)j--;return j<0||j===0?A:j+c[S[j]]>A?j:A}(g),y=g;b!==g.length&&(r.uint8array?(y=g.subarray(0,b),this.leftOver=g.subarray(b,g.length)):(y=g.slice(0,b),this.leftOver=g.slice(b,g.length))),this.push({data:o.utf8decode(y),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=u,t.inherits(_,i),_.prototype.processChunk=function(d){this.push({data:o.utf8encode(d.data),meta:d.meta})},o.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,l,o){var t=n("./support"),r=n("./base64"),e=n("./nodejsUtils"),i=n("./external");function c(m){return m}function v(m,b){for(var y=0;y<m.length;++y)b[y]=255&m.charCodeAt(y);return b}n("setimmediate"),o.newBlob=function(m,b){o.checkSupport("blob");try{return new Blob([m],{type:b})}catch(S){try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(b)}catch(A){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,b,y){var S=[],A=0,j=m.length;if(j<=y)return String.fromCharCode.apply(null,m);for(;A<j;)b==="array"||b==="nodebuffer"?S.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+y,j)))):S.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+y,j)))),A+=y;return S.join("")},stringifyByChar:function(m){for(var b="",y=0;y<m.length;y++)b+=String.fromCharCode(m[y]);return b},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(m){return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,e.allocBuffer(1)).length===1}catch(m){return!1}}()}};function _(m){var b=65536,y=o.getTypeOf(m),S=!0;if(y==="uint8array"?S=u.applyCanBeUsed.uint8array:y==="nodebuffer"&&(S=u.applyCanBeUsed.nodebuffer),S)for(;1<b;)try{return u.stringifyByChunk(m,y,b)}catch(A){b=Math.floor(b/2)}return u.stringifyByChar(m)}function d(m,b){for(var y=0;y<m.length;y++)b[y]=m[y];return b}o.applyFromCharCode=_;var g={};g.string={string:c,array:function(m){return v(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return v(m,new Uint8Array(m.length))},nodebuffer:function(m){return v(m,e.allocBuffer(m.length))}},g.array={string:_,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return e.newBufferFrom(m)}},g.arraybuffer={string:function(m){return _(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return e.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:_,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return e.newBufferFrom(m)}},g.nodebuffer={string:_,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:c},o.transformTo=function(m,b){if(b=b||"",!m)return b;o.checkSupport(m);var y=o.getTypeOf(b);return g[y][m](b)},o.resolve=function(m){for(var b=m.split("/"),y=[],S=0;S<b.length;S++){var A=b[S];A==="."||A===""&&S!==0&&S!==b.length-1||(A===".."?y.pop():y.push(A))}return y.join("/")},o.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":t.nodebuffer&&e.isBuffer(m)?"nodebuffer":t.uint8array&&m instanceof Uint8Array?"uint8array":t.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(m){if(!t[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(m){var b,y,S="";for(y=0;y<(m||"").length;y++)S+="\\x"+((b=m.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return S},o.delay=function(m,b,y){setImmediate(function(){m.apply(y||null,b||[])})},o.inherits=function(m,b){function y(){}y.prototype=b.prototype,m.prototype=new y},o.extend=function(){var m,b,y={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&y[b]===void 0&&(y[b]=arguments[m][b]);return y},o.prepareContent=function(m,b,y,S,A){return i.Promise.resolve(b).then(function(j){return t.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new i.Promise(function(O,F){var z=new FileReader;z.onload=function(B){O(B.target.result)},z.onerror=function(B){F(B.target.error)},z.readAsArrayBuffer(j)}):j}).then(function(j){var O=o.getTypeOf(j);return O?(O==="arraybuffer"?j=o.transformTo("uint8array",j):O==="string"&&(A?j=r.decode(j):y&&S!==!0&&(j=function(F){return v(F,t.uint8array?new Uint8Array(F.length):new Array(F.length))}(j))),j):i.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,l,o){var t=n("./reader/readerFor"),r=n("./utils"),e=n("./signature"),i=n("./zipEntry"),c=n("./support");function v(u){this.files=[],this.loadOptions=u}v.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(_)+", expected "+r.pretty(u)+")")}},isSignature:function(u,_){var d=this.reader.index;this.reader.setIndex(u);var g=this.reader.readString(4)===_;return this.reader.setIndex(d),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),_=c.uint8array?"uint8array":"array",d=r.transformTo(_,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,_,d,g=this.zip64EndOfCentralSize-44;0<g;)u=this.reader.readInt(2),_=this.reader.readInt(4),d=this.reader.readData(_),this.zip64ExtensibleData[u]={id:u,length:_,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,_;for(u=0;u<this.files.length;u++)_=this.files[u],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(e.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(e.CENTRAL_FILE_HEADER);)(u=new i({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(e.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,e.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var _=u;if(this.checkSignature(e.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,e.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var g=_-d;if(0<g)this.isSignature(_,e.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(u){this.reader=t(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,l,o){var t=n("./reader/readerFor"),r=n("./utils"),e=n("./compressedObject"),i=n("./crc32"),c=n("./utf8"),v=n("./compressions"),u=n("./support");function _(d,g){this.options=d,this.loadOptions=g}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var g,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(b){for(var y in v)if(Object.prototype.hasOwnProperty.call(v,y)&&v[y].magic===b)return v[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new e(this.compressedSize,this.uncompressedSize,this.crc32,g,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var g=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(g),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=t(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var g,m,b,y=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<y;)g=d.readInt(2),m=d.readInt(2),b=d.readData(m),this.extraFields[g]={id:g,length:m,value:b};d.setIndex(y)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var g=t(d.value);return g.readInt(1)!==1||i(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var g=t(d.value);return g.readInt(1)!==1||i(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(d.length-5))}return null}},l.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,l,o){function t(g,m,b){this.name=g,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var r=n("./stream/StreamHelper"),e=n("./stream/DataWorker"),i=n("./utf8"),c=n("./compressedObject"),v=n("./stream/GenericWorker");t.prototype={internalStream:function(g){var m=null,b="string";try{if(!g)throw new Error("No output type specified.");var y=(b=g.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var S=!this._dataBinary;S&&!y&&(m=m.pipe(new i.Utf8EncodeWorker)),!S&&y&&(m=m.pipe(new i.Utf8DecodeWorker))}catch(A){(m=new v("error")).error(A)}return new r(m,b,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new i.Utf8EncodeWorker)),c.createWorkerFrom(b,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof v?this._data:new e(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)t.prototype[u[d]]=_;l.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,l,o){(function(t){var r,e,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var c=0,v=new i(g),u=t.document.createTextNode("");v.observe(u,{characterData:!0}),r=function(){u.data=c=++c%2}}else if(t.setImmediate||t.MessageChannel===void 0)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var m=t.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},t.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var _=new t.MessageChannel;_.port1.onmessage=g,r=function(){_.port2.postMessage(0)}}var d=[];function g(){var m,b;e=!0;for(var y=d.length;y;){for(b=d,d=[],m=-1;++m<y;)b[m]();y=d.length}e=!1}l.exports=function(m){d.push(m)!==1||e||r()}}).call(this,typeof ct<"u"?ct:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,l,o){var t=n("immediate");function r(){}var e={},i=["REJECTED"],c=["FULFILLED"],v=["PENDING"];function u(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,y!==r&&m(this,y)}function _(y,S,A){this.promise=y,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function d(y,S,A){t(function(){var j;try{j=S(A)}catch(O){return e.reject(y,O)}j===y?e.reject(y,new TypeError("Cannot resolve promise with itself")):e.resolve(y,j)})}function g(y){var S=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof S=="function")return function(){S.apply(y,arguments)}}function m(y,S){var A=!1;function j(z){A||(A=!0,e.reject(y,z))}function O(z){A||(A=!0,e.resolve(y,z))}var F=b(function(){S(O,j)});F.status==="error"&&j(F.value)}function b(y,S){var A={};try{A.value=y(S),A.status="success"}catch(j){A.status="error",A.value=j}return A}(l.exports=u).prototype.finally=function(y){if(typeof y!="function")return this;var S=this.constructor;return this.then(function(A){return S.resolve(y()).then(function(){return A})},function(A){return S.resolve(y()).then(function(){throw A})})},u.prototype.catch=function(y){return this.then(null,y)},u.prototype.then=function(y,S){if(typeof y!="function"&&this.state===c||typeof S!="function"&&this.state===i)return this;var A=new this.constructor(r);return this.state!==v?d(A,this.state===c?y:S,this.outcome):this.queue.push(new _(A,y,S)),A},_.prototype.callFulfilled=function(y){e.resolve(this.promise,y)},_.prototype.otherCallFulfilled=function(y){d(this.promise,this.onFulfilled,y)},_.prototype.callRejected=function(y){e.reject(this.promise,y)},_.prototype.otherCallRejected=function(y){d(this.promise,this.onRejected,y)},e.resolve=function(y,S){var A=b(g,S);if(A.status==="error")return e.reject(y,A.value);var j=A.value;if(j)m(y,j);else{y.state=c,y.outcome=S;for(var O=-1,F=y.queue.length;++O<F;)y.queue[O].callFulfilled(S)}return y},e.reject=function(y,S){y.state=i,y.outcome=S;for(var A=-1,j=y.queue.length;++A<j;)y.queue[A].callRejected(S);return y},u.resolve=function(y){return y instanceof this?y:e.resolve(new this(r),y)},u.reject=function(y){var S=new this(r);return e.reject(S,y)},u.all=function(y){var S=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,j=!1;if(!A)return this.resolve([]);for(var O=new Array(A),F=0,z=-1,B=new this(r);++z<A;)R(y[z],z);return B;function R(N,Y){S.resolve(N).then(function(k){O[Y]=k,++F!==A||j||(j=!0,e.resolve(B,O))},function(k){j||(j=!0,e.reject(B,k))})}},u.race=function(y){var S=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,j=!1;if(!A)return this.resolve([]);for(var O=-1,F=new this(r);++O<A;)z=y[O],S.resolve(z).then(function(B){j||(j=!0,e.resolve(F,B))},function(B){j||(j=!0,e.reject(F,B))});var z;return F}},{immediate:36}],38:[function(n,l,o){var t={};(0,n("./lib/utils/common").assign)(t,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),l.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,l,o){var t=n("./zlib/deflate"),r=n("./utils/common"),e=n("./utils/strings"),i=n("./zlib/messages"),c=n("./zlib/zstream"),v=Object.prototype.toString,u=0,_=-1,d=0,g=8;function m(y){if(!(this instanceof m))return new m(y);this.options=r.assign({level:_,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},y||{});var S=this.options;S.raw&&0<S.windowBits?S.windowBits=-S.windowBits:S.gzip&&0<S.windowBits&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var A=t.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(A!==u)throw new Error(i[A]);if(S.header&&t.deflateSetHeader(this.strm,S.header),S.dictionary){var j;if(j=typeof S.dictionary=="string"?e.string2buf(S.dictionary):v.call(S.dictionary)==="[object ArrayBuffer]"?new Uint8Array(S.dictionary):S.dictionary,(A=t.deflateSetDictionary(this.strm,j))!==u)throw new Error(i[A]);this._dict_set=!0}}function b(y,S){var A=new m(S);if(A.push(y,!0),A.err)throw A.msg||i[A.err];return A.result}m.prototype.push=function(y,S){var A,j,O=this.strm,F=this.options.chunkSize;if(this.ended)return!1;j=S===~~S?S:S===!0?4:0,typeof y=="string"?O.input=e.string2buf(y):v.call(y)==="[object ArrayBuffer]"?O.input=new Uint8Array(y):O.input=y,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new r.Buf8(F),O.next_out=0,O.avail_out=F),(A=t.deflate(O,j))!==1&&A!==u)return this.onEnd(A),!(this.ended=!0);O.avail_out!==0&&(O.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(e.buf2binstring(r.shrinkBuf(O.output,O.next_out))):this.onData(r.shrinkBuf(O.output,O.next_out)))}while((0<O.avail_in||O.avail_out===0)&&A!==1);return j===4?(A=t.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===u):j!==2||(this.onEnd(u),!(O.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},o.Deflate=m,o.deflate=b,o.deflateRaw=function(y,S){return(S=S||{}).raw=!0,b(y,S)},o.gzip=function(y,S){return(S=S||{}).gzip=!0,b(y,S)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,l,o){var t=n("./zlib/inflate"),r=n("./utils/common"),e=n("./utils/strings"),i=n("./zlib/constants"),c=n("./zlib/messages"),v=n("./zlib/zstream"),u=n("./zlib/gzheader"),_=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var y=t.inflateInit2(this.strm,b.windowBits);if(y!==i.Z_OK)throw new Error(c[y]);this.header=new u,t.inflateGetHeader(this.strm,this.header)}function g(m,b){var y=new d(b);if(y.push(m,!0),y.err)throw y.msg||c[y.err];return y.result}d.prototype.push=function(m,b){var y,S,A,j,O,F,z=this.strm,B=this.options.chunkSize,R=this.options.dictionary,N=!1;if(this.ended)return!1;S=b===~~b?b:b===!0?i.Z_FINISH:i.Z_NO_FLUSH,typeof m=="string"?z.input=e.binstring2buf(m):_.call(m)==="[object ArrayBuffer]"?z.input=new Uint8Array(m):z.input=m,z.next_in=0,z.avail_in=z.input.length;do{if(z.avail_out===0&&(z.output=new r.Buf8(B),z.next_out=0,z.avail_out=B),(y=t.inflate(z,i.Z_NO_FLUSH))===i.Z_NEED_DICT&&R&&(F=typeof R=="string"?e.string2buf(R):_.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,y=t.inflateSetDictionary(this.strm,F)),y===i.Z_BUF_ERROR&&N===!0&&(y=i.Z_OK,N=!1),y!==i.Z_STREAM_END&&y!==i.Z_OK)return this.onEnd(y),!(this.ended=!0);z.next_out&&(z.avail_out!==0&&y!==i.Z_STREAM_END&&(z.avail_in!==0||S!==i.Z_FINISH&&S!==i.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=e.utf8border(z.output,z.next_out),j=z.next_out-A,O=e.buf2string(z.output,A),z.next_out=j,z.avail_out=B-j,j&&r.arraySet(z.output,z.output,A,j,0),this.onData(O)):this.onData(r.shrinkBuf(z.output,z.next_out)))),z.avail_in===0&&z.avail_out===0&&(N=!0)}while((0<z.avail_in||z.avail_out===0)&&y!==i.Z_STREAM_END);return y===i.Z_STREAM_END&&(S=i.Z_FINISH),S===i.Z_FINISH?(y=t.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===i.Z_OK):S!==i.Z_SYNC_FLUSH||(this.onEnd(i.Z_OK),!(z.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===i.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},o.Inflate=d,o.inflate=g,o.inflateRaw=function(m,b){return(b=b||{}).raw=!0,g(m,b)},o.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,l,o){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(i){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var v=c.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var u in v)v.hasOwnProperty(u)&&(i[u]=v[u])}}return i},o.shrinkBuf=function(i,c){return i.length===c?i:i.subarray?i.subarray(0,c):(i.length=c,i)};var r={arraySet:function(i,c,v,u,_){if(c.subarray&&i.subarray)i.set(c.subarray(v,v+u),_);else for(var d=0;d<u;d++)i[_+d]=c[v+d]},flattenChunks:function(i){var c,v,u,_,d,g;for(c=u=0,v=i.length;c<v;c++)u+=i[c].length;for(g=new Uint8Array(u),c=_=0,v=i.length;c<v;c++)d=i[c],g.set(d,_),_+=d.length;return g}},e={arraySet:function(i,c,v,u,_){for(var d=0;d<u;d++)i[_+d]=c[v+d]},flattenChunks:function(i){return[].concat.apply([],i)}};o.setTyped=function(i){i?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,r)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,e))},o.setTyped(t)},{}],42:[function(n,l,o){var t=n("./common"),r=!0,e=!0;try{String.fromCharCode.apply(null,[0])}catch(u){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){e=!1}for(var i=new t.Buf8(256),c=0;c<256;c++)i[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function v(u,_){if(_<65537&&(u.subarray&&e||!u.subarray&&r))return String.fromCharCode.apply(null,t.shrinkBuf(u,_));for(var d="",g=0;g<_;g++)d+=String.fromCharCode(u[g]);return d}i[254]=i[254]=1,o.string2buf=function(u){var _,d,g,m,b,y=u.length,S=0;for(m=0;m<y;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),S+=d<128?1:d<2048?2:d<65536?3:4;for(_=new t.Buf8(S),m=b=0;b<S;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),d<128?_[b++]=d:(d<2048?_[b++]=192|d>>>6:(d<65536?_[b++]=224|d>>>12:(_[b++]=240|d>>>18,_[b++]=128|d>>>12&63),_[b++]=128|d>>>6&63),_[b++]=128|63&d);return _},o.buf2binstring=function(u){return v(u,u.length)},o.binstring2buf=function(u){for(var _=new t.Buf8(u.length),d=0,g=_.length;d<g;d++)_[d]=u.charCodeAt(d);return _},o.buf2string=function(u,_){var d,g,m,b,y=_||u.length,S=new Array(2*y);for(d=g=0;d<y;)if((m=u[d++])<128)S[g++]=m;else if(4<(b=i[m]))S[g++]=65533,d+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&d<y;)m=m<<6|63&u[d++],b--;1<b?S[g++]=65533:m<65536?S[g++]=m:(m-=65536,S[g++]=55296|m>>10&1023,S[g++]=56320|1023&m)}return v(S,g)},o.utf8border=function(u,_){var d;for((_=_||u.length)>u.length&&(_=u.length),d=_-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?_:d+i[u[d]]>_?d:_}},{"./common":41}],43:[function(n,l,o){l.exports=function(t,r,e,i){for(var c=65535&t|0,v=t>>>16&65535|0,u=0;e!==0;){for(e-=u=2e3<e?2e3:e;v=v+(c=c+r[i++]|0)|0,--u;);c%=65521,v%=65521}return c|v<<16|0}},{}],44:[function(n,l,o){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,l,o){var t=function(){for(var r,e=[],i=0;i<256;i++){r=i;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;e[i]=r}return e}();l.exports=function(r,e,i,c){var v=t,u=c+i;r^=-1;for(var _=c;_<u;_++)r=r>>>8^v[255&(r^e[_])];return-1^r}},{}],46:[function(n,l,o){var t,r=n("../utils/common"),e=n("./trees"),i=n("./adler32"),c=n("./crc32"),v=n("./messages"),u=0,_=4,d=0,g=-2,m=-1,b=4,y=2,S=8,A=9,j=286,O=30,F=19,z=2*j+1,B=15,R=3,N=258,Y=N+R+1,k=42,D=113,h=1,M=2,re=3,W=4;function ie(a,V){return a.msg=v[V],V}function Z(a){return(a<<1)-(4<a?9:0)}function se(a){for(var V=a.length;0<=--V;)a[V]=0}function I(a){var V=a.state,L=V.pending;L>a.avail_out&&(L=a.avail_out),L!==0&&(r.arraySet(a.output,V.pending_buf,V.pending_out,L,a.next_out),a.next_out+=L,V.pending_out+=L,a.total_out+=L,a.avail_out-=L,V.pending-=L,V.pending===0&&(V.pending_out=0))}function T(a,V){e._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,V),a.block_start=a.strstart,I(a.strm)}function ne(a,V){a.pending_buf[a.pending++]=V}function X(a,V){a.pending_buf[a.pending++]=V>>>8&255,a.pending_buf[a.pending++]=255&V}function q(a,V){var L,w,x=a.max_chain_length,C=a.strstart,H=a.prev_length,U=a.nice_match,P=a.strstart>a.w_size-Y?a.strstart-(a.w_size-Y):0,G=a.window,J=a.w_mask,$=a.prev,te=a.strstart+N,ue=G[C+H-1],le=G[C+H];a.prev_length>=a.good_match&&(x>>=2),U>a.lookahead&&(U=a.lookahead);do if(G[(L=V)+H]===le&&G[L+H-1]===ue&&G[L]===G[C]&&G[++L]===G[C+1]){C+=2,L++;do;while(G[++C]===G[++L]&&G[++C]===G[++L]&&G[++C]===G[++L]&&G[++C]===G[++L]&&G[++C]===G[++L]&&G[++C]===G[++L]&&G[++C]===G[++L]&&G[++C]===G[++L]&&C<te);if(w=N-(te-C),C=te-N,H<w){if(a.match_start=V,U<=(H=w))break;ue=G[C+H-1],le=G[C+H]}}while((V=$[V&J])>P&&--x!=0);return H<=a.lookahead?H:a.lookahead}function me(a){var V,L,w,x,C,H,U,P,G,J,$=a.w_size;do{if(x=a.window_size-a.lookahead-a.strstart,a.strstart>=$+($-Y)){for(r.arraySet(a.window,a.window,$,$,0),a.match_start-=$,a.strstart-=$,a.block_start-=$,V=L=a.hash_size;w=a.head[--V],a.head[V]=$<=w?w-$:0,--L;);for(V=L=$;w=a.prev[--V],a.prev[V]=$<=w?w-$:0,--L;);x+=$}if(a.strm.avail_in===0)break;if(H=a.strm,U=a.window,P=a.strstart+a.lookahead,G=x,J=void 0,J=H.avail_in,G<J&&(J=G),L=J===0?0:(H.avail_in-=J,r.arraySet(U,H.input,H.next_in,J,P),H.state.wrap===1?H.adler=i(H.adler,U,J,P):H.state.wrap===2&&(H.adler=c(H.adler,U,J,P)),H.next_in+=J,H.total_in+=J,J),a.lookahead+=L,a.lookahead+a.insert>=R)for(C=a.strstart-a.insert,a.ins_h=a.window[C],a.ins_h=(a.ins_h<<a.hash_shift^a.window[C+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[C+R-1])&a.hash_mask,a.prev[C&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=C,C++,a.insert--,!(a.lookahead+a.insert<R)););}while(a.lookahead<Y&&a.strm.avail_in!==0)}function be(a,V){for(var L,w;;){if(a.lookahead<Y){if(me(a),a.lookahead<Y&&V===u)return h;if(a.lookahead===0)break}if(L=0,a.lookahead>=R&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),L!==0&&a.strstart-L<=a.w_size-Y&&(a.match_length=q(a,L)),a.match_length>=R)if(w=e._tr_tally(a,a.strstart-a.match_start,a.match_length-R),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=R){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else w=e._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(w&&(T(a,!1),a.strm.avail_out===0))return h}return a.insert=a.strstart<R-1?a.strstart:R-1,V===_?(T(a,!0),a.strm.avail_out===0?re:W):a.last_lit&&(T(a,!1),a.strm.avail_out===0)?h:M}function oe(a,V){for(var L,w,x;;){if(a.lookahead<Y){if(me(a),a.lookahead<Y&&V===u)return h;if(a.lookahead===0)break}if(L=0,a.lookahead>=R&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=R-1,L!==0&&a.prev_length<a.max_lazy_match&&a.strstart-L<=a.w_size-Y&&(a.match_length=q(a,L),a.match_length<=5&&(a.strategy===1||a.match_length===R&&4096<a.strstart-a.match_start)&&(a.match_length=R-1)),a.prev_length>=R&&a.match_length<=a.prev_length){for(x=a.strstart+a.lookahead-R,w=e._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-R),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=x&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+R-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=R-1,a.strstart++,w&&(T(a,!1),a.strm.avail_out===0))return h}else if(a.match_available){if((w=e._tr_tally(a,0,a.window[a.strstart-1]))&&T(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return h}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(w=e._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<R-1?a.strstart:R-1,V===_?(T(a,!0),a.strm.avail_out===0?re:W):a.last_lit&&(T(a,!1),a.strm.avail_out===0)?h:M}function ce(a,V,L,w,x){this.good_length=a,this.max_lazy=V,this.nice_length=L,this.max_chain=w,this.func=x}function ve(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*z),this.dyn_dtree=new r.Buf16(2*(2*O+1)),this.bl_tree=new r.Buf16(2*(2*F+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(B+1),this.heap=new r.Buf16(2*j+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*j+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(a){var V;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=y,(V=a.state).pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?k:D,a.adler=V.wrap===2?0:1,V.last_flush=u,e._tr_init(V),d):ie(a,g)}function Oe(a){var V=pe(a);return V===d&&function(L){L.window_size=2*L.w_size,se(L.head),L.max_lazy_match=t[L.level].max_lazy,L.good_match=t[L.level].good_length,L.nice_match=t[L.level].nice_length,L.max_chain_length=t[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=R-1,L.match_available=0,L.ins_h=0}(a.state),V}function ke(a,V,L,w,x,C){if(!a)return g;var H=1;if(V===m&&(V=6),w<0?(H=0,w=-w):15<w&&(H=2,w-=16),x<1||A<x||L!==S||w<8||15<w||V<0||9<V||C<0||b<C)return ie(a,g);w===8&&(w=9);var U=new ve;return(a.state=U).strm=a,U.wrap=H,U.gzhead=null,U.w_bits=w,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=x+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+R-1)/R),U.window=new r.Buf8(2*U.w_size),U.head=new r.Buf16(U.hash_size),U.prev=new r.Buf16(U.w_size),U.lit_bufsize=1<<x+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new r.Buf8(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=V,U.strategy=C,U.method=L,Oe(a)}t=[new ce(0,0,0,0,function(a,V){var L=65535;for(L>a.pending_buf_size-5&&(L=a.pending_buf_size-5);;){if(a.lookahead<=1){if(me(a),a.lookahead===0&&V===u)return h;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var w=a.block_start+L;if((a.strstart===0||a.strstart>=w)&&(a.lookahead=a.strstart-w,a.strstart=w,T(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-Y&&(T(a,!1),a.strm.avail_out===0))return h}return a.insert=0,V===_?(T(a,!0),a.strm.avail_out===0?re:W):(a.strstart>a.block_start&&(T(a,!1),a.strm.avail_out),h)}),new ce(4,4,8,4,be),new ce(4,5,16,8,be),new ce(4,6,32,32,be),new ce(4,4,16,16,oe),new ce(8,16,32,32,oe),new ce(8,16,128,128,oe),new ce(8,32,128,256,oe),new ce(32,128,258,1024,oe),new ce(32,258,258,4096,oe)],o.deflateInit=function(a,V){return ke(a,V,S,15,8,0)},o.deflateInit2=ke,o.deflateReset=Oe,o.deflateResetKeep=pe,o.deflateSetHeader=function(a,V){return a&&a.state?a.state.wrap!==2?g:(a.state.gzhead=V,d):g},o.deflate=function(a,V){var L,w,x,C;if(!a||!a.state||5<V||V<0)return a?ie(a,g):g;if(w=a.state,!a.output||!a.input&&a.avail_in!==0||w.status===666&&V!==_)return ie(a,a.avail_out===0?-5:g);if(w.strm=a,L=w.last_flush,w.last_flush=V,w.status===k)if(w.wrap===2)a.adler=0,ne(w,31),ne(w,139),ne(w,8),w.gzhead?(ne(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),ne(w,255&w.gzhead.time),ne(w,w.gzhead.time>>8&255),ne(w,w.gzhead.time>>16&255),ne(w,w.gzhead.time>>24&255),ne(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),ne(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(ne(w,255&w.gzhead.extra.length),ne(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(a.adler=c(a.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(ne(w,0),ne(w,0),ne(w,0),ne(w,0),ne(w,0),ne(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),ne(w,3),w.status=D);else{var H=S+(w.w_bits-8<<4)<<8;H|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(H|=32),H+=31-H%31,w.status=D,X(w,H),w.strstart!==0&&(X(w,a.adler>>>16),X(w,65535&a.adler)),a.adler=1}if(w.status===69)if(w.gzhead.extra){for(x=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>x&&(a.adler=c(a.adler,w.pending_buf,w.pending-x,x)),I(a),x=w.pending,w.pending!==w.pending_buf_size));)ne(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>x&&(a.adler=c(a.adler,w.pending_buf,w.pending-x,x)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){x=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>x&&(a.adler=c(a.adler,w.pending_buf,w.pending-x,x)),I(a),x=w.pending,w.pending===w.pending_buf_size)){C=1;break}C=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,ne(w,C)}while(C!==0);w.gzhead.hcrc&&w.pending>x&&(a.adler=c(a.adler,w.pending_buf,w.pending-x,x)),C===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){x=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>x&&(a.adler=c(a.adler,w.pending_buf,w.pending-x,x)),I(a),x=w.pending,w.pending===w.pending_buf_size)){C=1;break}C=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,ne(w,C)}while(C!==0);w.gzhead.hcrc&&w.pending>x&&(a.adler=c(a.adler,w.pending_buf,w.pending-x,x)),C===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&I(a),w.pending+2<=w.pending_buf_size&&(ne(w,255&a.adler),ne(w,a.adler>>8&255),a.adler=0,w.status=D)):w.status=D),w.pending!==0){if(I(a),a.avail_out===0)return w.last_flush=-1,d}else if(a.avail_in===0&&Z(V)<=Z(L)&&V!==_)return ie(a,-5);if(w.status===666&&a.avail_in!==0)return ie(a,-5);if(a.avail_in!==0||w.lookahead!==0||V!==u&&w.status!==666){var U=w.strategy===2?function(P,G){for(var J;;){if(P.lookahead===0&&(me(P),P.lookahead===0)){if(G===u)return h;break}if(P.match_length=0,J=e._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,J&&(T(P,!1),P.strm.avail_out===0))return h}return P.insert=0,G===_?(T(P,!0),P.strm.avail_out===0?re:W):P.last_lit&&(T(P,!1),P.strm.avail_out===0)?h:M}(w,V):w.strategy===3?function(P,G){for(var J,$,te,ue,le=P.window;;){if(P.lookahead<=N){if(me(P),P.lookahead<=N&&G===u)return h;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=R&&0<P.strstart&&($=le[te=P.strstart-1])===le[++te]&&$===le[++te]&&$===le[++te]){ue=P.strstart+N;do;while($===le[++te]&&$===le[++te]&&$===le[++te]&&$===le[++te]&&$===le[++te]&&$===le[++te]&&$===le[++te]&&$===le[++te]&&te<ue);P.match_length=N-(ue-te),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=R?(J=e._tr_tally(P,1,P.match_length-R),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(J=e._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),J&&(T(P,!1),P.strm.avail_out===0))return h}return P.insert=0,G===_?(T(P,!0),P.strm.avail_out===0?re:W):P.last_lit&&(T(P,!1),P.strm.avail_out===0)?h:M}(w,V):t[w.level].func(w,V);if(U!==re&&U!==W||(w.status=666),U===h||U===re)return a.avail_out===0&&(w.last_flush=-1),d;if(U===M&&(V===1?e._tr_align(w):V!==5&&(e._tr_stored_block(w,0,0,!1),V===3&&(se(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),I(a),a.avail_out===0))return w.last_flush=-1,d}return V!==_?d:w.wrap<=0?1:(w.wrap===2?(ne(w,255&a.adler),ne(w,a.adler>>8&255),ne(w,a.adler>>16&255),ne(w,a.adler>>24&255),ne(w,255&a.total_in),ne(w,a.total_in>>8&255),ne(w,a.total_in>>16&255),ne(w,a.total_in>>24&255)):(X(w,a.adler>>>16),X(w,65535&a.adler)),I(a),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?d:1)},o.deflateEnd=function(a){var V;return a&&a.state?(V=a.state.status)!==k&&V!==69&&V!==73&&V!==91&&V!==103&&V!==D&&V!==666?ie(a,g):(a.state=null,V===D?ie(a,-3):d):g},o.deflateSetDictionary=function(a,V){var L,w,x,C,H,U,P,G,J=V.length;if(!a||!a.state||(C=(L=a.state).wrap)===2||C===1&&L.status!==k||L.lookahead)return g;for(C===1&&(a.adler=i(a.adler,V,J,0)),L.wrap=0,J>=L.w_size&&(C===0&&(se(L.head),L.strstart=0,L.block_start=0,L.insert=0),G=new r.Buf8(L.w_size),r.arraySet(G,V,J-L.w_size,L.w_size,0),V=G,J=L.w_size),H=a.avail_in,U=a.next_in,P=a.input,a.avail_in=J,a.next_in=0,a.input=V,me(L);L.lookahead>=R;){for(w=L.strstart,x=L.lookahead-(R-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[w+R-1])&L.hash_mask,L.prev[w&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=w,w++,--x;);L.strstart=w,L.lookahead=R-1,me(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=R-1,L.match_available=0,a.next_in=U,a.input=P,a.avail_in=H,L.wrap=C,d},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,l,o){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,l,o){l.exports=function(t,r){var e,i,c,v,u,_,d,g,m,b,y,S,A,j,O,F,z,B,R,N,Y,k,D,h,M;e=t.state,i=t.next_in,h=t.input,c=i+(t.avail_in-5),v=t.next_out,M=t.output,u=v-(r-t.avail_out),_=v+(t.avail_out-257),d=e.dmax,g=e.wsize,m=e.whave,b=e.wnext,y=e.window,S=e.hold,A=e.bits,j=e.lencode,O=e.distcode,F=(1<<e.lenbits)-1,z=(1<<e.distbits)-1;e:do{A<15&&(S+=h[i++]<<A,A+=8,S+=h[i++]<<A,A+=8),B=j[S&F];t:for(;;){if(S>>>=R=B>>>24,A-=R,(R=B>>>16&255)===0)M[v++]=65535&B;else{if(!(16&R)){if(!(64&R)){B=j[(65535&B)+(S&(1<<R)-1)];continue t}if(32&R){e.mode=12;break e}t.msg="invalid literal/length code",e.mode=30;break e}N=65535&B,(R&=15)&&(A<R&&(S+=h[i++]<<A,A+=8),N+=S&(1<<R)-1,S>>>=R,A-=R),A<15&&(S+=h[i++]<<A,A+=8,S+=h[i++]<<A,A+=8),B=O[S&z];n:for(;;){if(S>>>=R=B>>>24,A-=R,!(16&(R=B>>>16&255))){if(!(64&R)){B=O[(65535&B)+(S&(1<<R)-1)];continue n}t.msg="invalid distance code",e.mode=30;break e}if(Y=65535&B,A<(R&=15)&&(S+=h[i++]<<A,(A+=8)<R&&(S+=h[i++]<<A,A+=8)),d<(Y+=S&(1<<R)-1)){t.msg="invalid distance too far back",e.mode=30;break e}if(S>>>=R,A-=R,(R=v-u)<Y){if(m<(R=Y-R)&&e.sane){t.msg="invalid distance too far back",e.mode=30;break e}if(D=y,(k=0)===b){if(k+=g-R,R<N){for(N-=R;M[v++]=y[k++],--R;);k=v-Y,D=M}}else if(b<R){if(k+=g+b-R,(R-=b)<N){for(N-=R;M[v++]=y[k++],--R;);if(k=0,b<N){for(N-=R=b;M[v++]=y[k++],--R;);k=v-Y,D=M}}}else if(k+=b-R,R<N){for(N-=R;M[v++]=y[k++],--R;);k=v-Y,D=M}for(;2<N;)M[v++]=D[k++],M[v++]=D[k++],M[v++]=D[k++],N-=3;N&&(M[v++]=D[k++],1<N&&(M[v++]=D[k++]))}else{for(k=v-Y;M[v++]=M[k++],M[v++]=M[k++],M[v++]=M[k++],2<(N-=3););N&&(M[v++]=M[k++],1<N&&(M[v++]=M[k++]))}break}}break}}while(i<c&&v<_);i-=N=A>>3,S&=(1<<(A-=N<<3))-1,t.next_in=i,t.next_out=v,t.avail_in=i<c?c-i+5:5-(i-c),t.avail_out=v<_?_-v+257:257-(v-_),e.hold=S,e.bits=A}},{}],49:[function(n,l,o){var t=n("../utils/common"),r=n("./adler32"),e=n("./crc32"),i=n("./inffast"),c=n("./inftrees"),v=1,u=2,_=0,d=-2,g=1,m=852,b=592;function y(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(k){var D;return k&&k.state?(D=k.state,k.total_in=k.total_out=D.total=0,k.msg="",D.wrap&&(k.adler=1&D.wrap),D.mode=g,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new t.Buf32(m),D.distcode=D.distdyn=new t.Buf32(b),D.sane=1,D.back=-1,_):d}function j(k){var D;return k&&k.state?((D=k.state).wsize=0,D.whave=0,D.wnext=0,A(k)):d}function O(k,D){var h,M;return k&&k.state?(M=k.state,D<0?(h=0,D=-D):(h=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?d:(M.window!==null&&M.wbits!==D&&(M.window=null),M.wrap=h,M.wbits=D,j(k))):d}function F(k,D){var h,M;return k?(M=new S,(k.state=M).window=null,(h=O(k,D))!==_&&(k.state=null),h):d}var z,B,R=!0;function N(k){if(R){var D;for(z=new t.Buf32(512),B=new t.Buf32(32),D=0;D<144;)k.lens[D++]=8;for(;D<256;)k.lens[D++]=9;for(;D<280;)k.lens[D++]=7;for(;D<288;)k.lens[D++]=8;for(c(v,k.lens,0,288,z,0,k.work,{bits:9}),D=0;D<32;)k.lens[D++]=5;c(u,k.lens,0,32,B,0,k.work,{bits:5}),R=!1}k.lencode=z,k.lenbits=9,k.distcode=B,k.distbits=5}function Y(k,D,h,M){var re,W=k.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new t.Buf8(W.wsize)),M>=W.wsize?(t.arraySet(W.window,D,h-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(M<(re=W.wsize-W.wnext)&&(re=M),t.arraySet(W.window,D,h-M,re,W.wnext),(M-=re)?(t.arraySet(W.window,D,h-M,M,0),W.wnext=M,W.whave=W.wsize):(W.wnext+=re,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=re))),0}o.inflateReset=j,o.inflateReset2=O,o.inflateResetKeep=A,o.inflateInit=function(k){return F(k,15)},o.inflateInit2=F,o.inflate=function(k,D){var h,M,re,W,ie,Z,se,I,T,ne,X,q,me,be,oe,ce,ve,pe,Oe,ke,a,V,L,w,x=0,C=new t.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return d;(h=k.state).mode===12&&(h.mode=13),ie=k.next_out,re=k.output,se=k.avail_out,W=k.next_in,M=k.input,Z=k.avail_in,I=h.hold,T=h.bits,ne=Z,X=se,V=_;e:for(;;)switch(h.mode){case g:if(h.wrap===0){h.mode=13;break}for(;T<16;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(2&h.wrap&&I===35615){C[h.check=0]=255&I,C[1]=I>>>8&255,h.check=e(h.check,C,2,0),T=I=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&I)<<8)+(I>>8))%31){k.msg="incorrect header check",h.mode=30;break}if((15&I)!=8){k.msg="unknown compression method",h.mode=30;break}if(T-=4,a=8+(15&(I>>>=4)),h.wbits===0)h.wbits=a;else if(a>h.wbits){k.msg="invalid window size",h.mode=30;break}h.dmax=1<<a,k.adler=h.check=1,h.mode=512&I?10:12,T=I=0;break;case 2:for(;T<16;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(h.flags=I,(255&h.flags)!=8){k.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){k.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=I>>8&1),512&h.flags&&(C[0]=255&I,C[1]=I>>>8&255,h.check=e(h.check,C,2,0)),T=I=0,h.mode=3;case 3:for(;T<32;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}h.head&&(h.head.time=I),512&h.flags&&(C[0]=255&I,C[1]=I>>>8&255,C[2]=I>>>16&255,C[3]=I>>>24&255,h.check=e(h.check,C,4,0)),T=I=0,h.mode=4;case 4:for(;T<16;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}h.head&&(h.head.xflags=255&I,h.head.os=I>>8),512&h.flags&&(C[0]=255&I,C[1]=I>>>8&255,h.check=e(h.check,C,2,0)),T=I=0,h.mode=5;case 5:if(1024&h.flags){for(;T<16;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}h.length=I,h.head&&(h.head.extra_len=I),512&h.flags&&(C[0]=255&I,C[1]=I>>>8&255,h.check=e(h.check,C,2,0)),T=I=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(Z<(q=h.length)&&(q=Z),q&&(h.head&&(a=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),t.arraySet(h.head.extra,M,W,q,a)),512&h.flags&&(h.check=e(h.check,M,q,W)),Z-=q,W+=q,h.length-=q),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(Z===0)break e;for(q=0;a=M[W+q++],h.head&&a&&h.length<65536&&(h.head.name+=String.fromCharCode(a)),a&&q<Z;);if(512&h.flags&&(h.check=e(h.check,M,q,W)),Z-=q,W+=q,a)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(Z===0)break e;for(q=0;a=M[W+q++],h.head&&a&&h.length<65536&&(h.head.comment+=String.fromCharCode(a)),a&&q<Z;);if(512&h.flags&&(h.check=e(h.check,M,q,W)),Z-=q,W+=q,a)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;T<16;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(I!==(65535&h.check)){k.msg="header crc mismatch",h.mode=30;break}T=I=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),k.adler=h.check=0,h.mode=12;break;case 10:for(;T<32;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}k.adler=h.check=y(I),T=I=0,h.mode=11;case 11:if(h.havedict===0)return k.next_out=ie,k.avail_out=se,k.next_in=W,k.avail_in=Z,h.hold=I,h.bits=T,2;k.adler=h.check=1,h.mode=12;case 12:if(D===5||D===6)break e;case 13:if(h.last){I>>>=7&T,T-=7&T,h.mode=27;break}for(;T<3;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}switch(h.last=1&I,T-=1,3&(I>>>=1)){case 0:h.mode=14;break;case 1:if(N(h),h.mode=20,D!==6)break;I>>>=2,T-=2;break e;case 2:h.mode=17;break;case 3:k.msg="invalid block type",h.mode=30}I>>>=2,T-=2;break;case 14:for(I>>>=7&T,T-=7&T;T<32;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if((65535&I)!=(I>>>16^65535)){k.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&I,T=I=0,h.mode=15,D===6)break e;case 15:h.mode=16;case 16:if(q=h.length){if(Z<q&&(q=Z),se<q&&(q=se),q===0)break e;t.arraySet(re,M,W,q,ie),Z-=q,W+=q,se-=q,ie+=q,h.length-=q;break}h.mode=12;break;case 17:for(;T<14;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(h.nlen=257+(31&I),I>>>=5,T-=5,h.ndist=1+(31&I),I>>>=5,T-=5,h.ncode=4+(15&I),I>>>=4,T-=4,286<h.nlen||30<h.ndist){k.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;T<3;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}h.lens[H[h.have++]]=7&I,I>>>=3,T-=3}for(;h.have<19;)h.lens[H[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,L={bits:h.lenbits},V=c(0,h.lens,0,19,h.lencode,0,h.work,L),h.lenbits=L.bits,V){k.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;ce=(x=h.lencode[I&(1<<h.lenbits)-1])>>>16&255,ve=65535&x,!((oe=x>>>24)<=T);){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(ve<16)I>>>=oe,T-=oe,h.lens[h.have++]=ve;else{if(ve===16){for(w=oe+2;T<w;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(I>>>=oe,T-=oe,h.have===0){k.msg="invalid bit length repeat",h.mode=30;break}a=h.lens[h.have-1],q=3+(3&I),I>>>=2,T-=2}else if(ve===17){for(w=oe+3;T<w;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}T-=oe,a=0,q=3+(7&(I>>>=oe)),I>>>=3,T-=3}else{for(w=oe+7;T<w;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}T-=oe,a=0,q=11+(127&(I>>>=oe)),I>>>=7,T-=7}if(h.have+q>h.nlen+h.ndist){k.msg="invalid bit length repeat",h.mode=30;break}for(;q--;)h.lens[h.have++]=a}}if(h.mode===30)break;if(h.lens[256]===0){k.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,L={bits:h.lenbits},V=c(v,h.lens,0,h.nlen,h.lencode,0,h.work,L),h.lenbits=L.bits,V){k.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,L={bits:h.distbits},V=c(u,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,L),h.distbits=L.bits,V){k.msg="invalid distances set",h.mode=30;break}if(h.mode=20,D===6)break e;case 20:h.mode=21;case 21:if(6<=Z&&258<=se){k.next_out=ie,k.avail_out=se,k.next_in=W,k.avail_in=Z,h.hold=I,h.bits=T,i(k,X),ie=k.next_out,re=k.output,se=k.avail_out,W=k.next_in,M=k.input,Z=k.avail_in,I=h.hold,T=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;ce=(x=h.lencode[I&(1<<h.lenbits)-1])>>>16&255,ve=65535&x,!((oe=x>>>24)<=T);){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(ce&&!(240&ce)){for(pe=oe,Oe=ce,ke=ve;ce=(x=h.lencode[ke+((I&(1<<pe+Oe)-1)>>pe)])>>>16&255,ve=65535&x,!(pe+(oe=x>>>24)<=T);){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}I>>>=pe,T-=pe,h.back+=pe}if(I>>>=oe,T-=oe,h.back+=oe,h.length=ve,ce===0){h.mode=26;break}if(32&ce){h.back=-1,h.mode=12;break}if(64&ce){k.msg="invalid literal/length code",h.mode=30;break}h.extra=15&ce,h.mode=22;case 22:if(h.extra){for(w=h.extra;T<w;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}h.length+=I&(1<<h.extra)-1,I>>>=h.extra,T-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;ce=(x=h.distcode[I&(1<<h.distbits)-1])>>>16&255,ve=65535&x,!((oe=x>>>24)<=T);){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(!(240&ce)){for(pe=oe,Oe=ce,ke=ve;ce=(x=h.distcode[ke+((I&(1<<pe+Oe)-1)>>pe)])>>>16&255,ve=65535&x,!(pe+(oe=x>>>24)<=T);){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}I>>>=pe,T-=pe,h.back+=pe}if(I>>>=oe,T-=oe,h.back+=oe,64&ce){k.msg="invalid distance code",h.mode=30;break}h.offset=ve,h.extra=15&ce,h.mode=24;case 24:if(h.extra){for(w=h.extra;T<w;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}h.offset+=I&(1<<h.extra)-1,I>>>=h.extra,T-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){k.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(se===0)break e;if(q=X-se,h.offset>q){if((q=h.offset-q)>h.whave&&h.sane){k.msg="invalid distance too far back",h.mode=30;break}me=q>h.wnext?(q-=h.wnext,h.wsize-q):h.wnext-q,q>h.length&&(q=h.length),be=h.window}else be=re,me=ie-h.offset,q=h.length;for(se<q&&(q=se),se-=q,h.length-=q;re[ie++]=be[me++],--q;);h.length===0&&(h.mode=21);break;case 26:if(se===0)break e;re[ie++]=h.length,se--,h.mode=21;break;case 27:if(h.wrap){for(;T<32;){if(Z===0)break e;Z--,I|=M[W++]<<T,T+=8}if(X-=se,k.total_out+=X,h.total+=X,X&&(k.adler=h.check=h.flags?e(h.check,re,X,ie-X):r(h.check,re,X,ie-X)),X=se,(h.flags?I:y(I))!==h.check){k.msg="incorrect data check",h.mode=30;break}T=I=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;T<32;){if(Z===0)break e;Z--,I+=M[W++]<<T,T+=8}if(I!==(4294967295&h.total)){k.msg="incorrect length check",h.mode=30;break}T=I=0}h.mode=29;case 29:V=1;break e;case 30:V=-3;break e;case 31:return-4;case 32:default:return d}return k.next_out=ie,k.avail_out=se,k.next_in=W,k.avail_in=Z,h.hold=I,h.bits=T,(h.wsize||X!==k.avail_out&&h.mode<30&&(h.mode<27||D!==4))&&Y(k,k.output,k.next_out,X-k.avail_out)?(h.mode=31,-4):(ne-=k.avail_in,X-=k.avail_out,k.total_in+=ne,k.total_out+=X,h.total+=X,h.wrap&&X&&(k.adler=h.check=h.flags?e(h.check,re,X,k.next_out-X):r(h.check,re,X,k.next_out-X)),k.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(ne==0&&X===0||D===4)&&V===_&&(V=-5),V)},o.inflateEnd=function(k){if(!k||!k.state)return d;var D=k.state;return D.window&&(D.window=null),k.state=null,_},o.inflateGetHeader=function(k,D){var h;return k&&k.state&&2&(h=k.state).wrap?((h.head=D).done=!1,_):d},o.inflateSetDictionary=function(k,D){var h,M=D.length;return k&&k.state?(h=k.state).wrap!==0&&h.mode!==11?d:h.mode===11&&r(1,D,M,0)!==h.check?-3:Y(k,D,M,M)?(h.mode=31,-4):(h.havedict=1,_):d},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,l,o){var t=n("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],e=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(v,u,_,d,g,m,b,y){var S,A,j,O,F,z,B,R,N,Y=y.bits,k=0,D=0,h=0,M=0,re=0,W=0,ie=0,Z=0,se=0,I=0,T=null,ne=0,X=new t.Buf16(16),q=new t.Buf16(16),me=null,be=0;for(k=0;k<=15;k++)X[k]=0;for(D=0;D<d;D++)X[u[_+D]]++;for(re=Y,M=15;1<=M&&X[M]===0;M--);if(M<re&&(re=M),M===0)return g[m++]=20971520,g[m++]=20971520,y.bits=1,0;for(h=1;h<M&&X[h]===0;h++);for(re<h&&(re=h),k=Z=1;k<=15;k++)if(Z<<=1,(Z-=X[k])<0)return-1;if(0<Z&&(v===0||M!==1))return-1;for(q[1]=0,k=1;k<15;k++)q[k+1]=q[k]+X[k];for(D=0;D<d;D++)u[_+D]!==0&&(b[q[u[_+D]]++]=D);if(z=v===0?(T=me=b,19):v===1?(T=r,ne-=257,me=e,be-=257,256):(T=i,me=c,-1),k=h,F=m,ie=D=I=0,j=-1,O=(se=1<<(W=re))-1,v===1&&852<se||v===2&&592<se)return 1;for(;;){for(B=k-ie,N=b[D]<z?(R=0,b[D]):b[D]>z?(R=me[be+b[D]],T[ne+b[D]]):(R=96,0),S=1<<k-ie,h=A=1<<W;g[F+(I>>ie)+(A-=S)]=B<<24|R<<16|N|0,A!==0;);for(S=1<<k-1;I&S;)S>>=1;if(S!==0?(I&=S-1,I+=S):I=0,D++,--X[k]==0){if(k===M)break;k=u[_+b[D]]}if(re<k&&(I&O)!==j){for(ie===0&&(ie=re),F+=h,Z=1<<(W=k-ie);W+ie<M&&!((Z-=X[W+ie])<=0);)W++,Z<<=1;if(se+=1<<W,v===1&&852<se||v===2&&592<se)return 1;g[j=I&O]=re<<24|W<<16|F-m|0}}return I!==0&&(g[F+I]=k-ie<<24|64<<16|0),y.bits=re,0}},{"../utils/common":41}],51:[function(n,l,o){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,l,o){var t=n("../utils/common"),r=0,e=1;function i(x){for(var C=x.length;0<=--C;)x[C]=0}var c=0,v=29,u=256,_=u+1+v,d=30,g=19,m=2*_+1,b=15,y=16,S=7,A=256,j=16,O=17,F=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(_+2));i(Y);var k=new Array(2*d);i(k);var D=new Array(512);i(D);var h=new Array(256);i(h);var M=new Array(v);i(M);var re,W,ie,Z=new Array(d);function se(x,C,H,U,P){this.static_tree=x,this.extra_bits=C,this.extra_base=H,this.elems=U,this.max_length=P,this.has_stree=x&&x.length}function I(x,C){this.dyn_tree=x,this.max_code=0,this.stat_desc=C}function T(x){return x<256?D[x]:D[256+(x>>>7)]}function ne(x,C){x.pending_buf[x.pending++]=255&C,x.pending_buf[x.pending++]=C>>>8&255}function X(x,C,H){x.bi_valid>y-H?(x.bi_buf|=C<<x.bi_valid&65535,ne(x,x.bi_buf),x.bi_buf=C>>y-x.bi_valid,x.bi_valid+=H-y):(x.bi_buf|=C<<x.bi_valid&65535,x.bi_valid+=H)}function q(x,C,H){X(x,H[2*C],H[2*C+1])}function me(x,C){for(var H=0;H|=1&x,x>>>=1,H<<=1,0<--C;);return H>>>1}function be(x,C,H){var U,P,G=new Array(b+1),J=0;for(U=1;U<=b;U++)G[U]=J=J+H[U-1]<<1;for(P=0;P<=C;P++){var $=x[2*P+1];$!==0&&(x[2*P]=me(G[$]++,$))}}function oe(x){var C;for(C=0;C<_;C++)x.dyn_ltree[2*C]=0;for(C=0;C<d;C++)x.dyn_dtree[2*C]=0;for(C=0;C<g;C++)x.bl_tree[2*C]=0;x.dyn_ltree[2*A]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function ce(x){8<x.bi_valid?ne(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function ve(x,C,H,U){var P=2*C,G=2*H;return x[P]<x[G]||x[P]===x[G]&&U[C]<=U[H]}function pe(x,C,H){for(var U=x.heap[H],P=H<<1;P<=x.heap_len&&(P<x.heap_len&&ve(C,x.heap[P+1],x.heap[P],x.depth)&&P++,!ve(C,U,x.heap[P],x.depth));)x.heap[H]=x.heap[P],H=P,P<<=1;x.heap[H]=U}function Oe(x,C,H){var U,P,G,J,$=0;if(x.last_lit!==0)for(;U=x.pending_buf[x.d_buf+2*$]<<8|x.pending_buf[x.d_buf+2*$+1],P=x.pending_buf[x.l_buf+$],$++,U===0?q(x,P,C):(q(x,(G=h[P])+u+1,C),(J=z[G])!==0&&X(x,P-=M[G],J),q(x,G=T(--U),H),(J=B[G])!==0&&X(x,U-=Z[G],J)),$<x.last_lit;);q(x,A,C)}function ke(x,C){var H,U,P,G=C.dyn_tree,J=C.stat_desc.static_tree,$=C.stat_desc.has_stree,te=C.stat_desc.elems,ue=-1;for(x.heap_len=0,x.heap_max=m,H=0;H<te;H++)G[2*H]!==0?(x.heap[++x.heap_len]=ue=H,x.depth[H]=0):G[2*H+1]=0;for(;x.heap_len<2;)G[2*(P=x.heap[++x.heap_len]=ue<2?++ue:0)]=1,x.depth[P]=0,x.opt_len--,$&&(x.static_len-=J[2*P+1]);for(C.max_code=ue,H=x.heap_len>>1;1<=H;H--)pe(x,G,H);for(P=te;H=x.heap[1],x.heap[1]=x.heap[x.heap_len--],pe(x,G,1),U=x.heap[1],x.heap[--x.heap_max]=H,x.heap[--x.heap_max]=U,G[2*P]=G[2*H]+G[2*U],x.depth[P]=(x.depth[H]>=x.depth[U]?x.depth[H]:x.depth[U])+1,G[2*H+1]=G[2*U+1]=P,x.heap[1]=P++,pe(x,G,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],function(le,Ee){var Qe,Ce,et,fe,ot,gt,Re=Ee.dyn_tree,Wt=Ee.max_code,Tn=Ee.stat_desc.static_tree,zn=Ee.stat_desc.has_stree,In=Ee.stat_desc.extra_bits,Zt=Ee.stat_desc.extra_base,tt=Ee.stat_desc.max_length,lt=0;for(fe=0;fe<=b;fe++)le.bl_count[fe]=0;for(Re[2*le.heap[le.heap_max]+1]=0,Qe=le.heap_max+1;Qe<m;Qe++)tt<(fe=Re[2*Re[2*(Ce=le.heap[Qe])+1]+1]+1)&&(fe=tt,lt++),Re[2*Ce+1]=fe,Wt<Ce||(le.bl_count[fe]++,ot=0,Zt<=Ce&&(ot=In[Ce-Zt]),gt=Re[2*Ce],le.opt_len+=gt*(fe+ot),zn&&(le.static_len+=gt*(Tn[2*Ce+1]+ot)));if(lt!==0){do{for(fe=tt-1;le.bl_count[fe]===0;)fe--;le.bl_count[fe]--,le.bl_count[fe+1]+=2,le.bl_count[tt]--,lt-=2}while(0<lt);for(fe=tt;fe!==0;fe--)for(Ce=le.bl_count[fe];Ce!==0;)Wt<(et=le.heap[--Qe])||(Re[2*et+1]!==fe&&(le.opt_len+=(fe-Re[2*et+1])*Re[2*et],Re[2*et+1]=fe),Ce--)}}(x,C),be(G,ue,x.bl_count)}function a(x,C,H){var U,P,G=-1,J=C[1],$=0,te=7,ue=4;for(J===0&&(te=138,ue=3),C[2*(H+1)+1]=65535,U=0;U<=H;U++)P=J,J=C[2*(U+1)+1],++$<te&&P===J||($<ue?x.bl_tree[2*P]+=$:P!==0?(P!==G&&x.bl_tree[2*P]++,x.bl_tree[2*j]++):$<=10?x.bl_tree[2*O]++:x.bl_tree[2*F]++,G=P,ue=($=0)===J?(te=138,3):P===J?(te=6,3):(te=7,4))}function V(x,C,H){var U,P,G=-1,J=C[1],$=0,te=7,ue=4;for(J===0&&(te=138,ue=3),U=0;U<=H;U++)if(P=J,J=C[2*(U+1)+1],!(++$<te&&P===J)){if($<ue)for(;q(x,P,x.bl_tree),--$!=0;);else P!==0?(P!==G&&(q(x,P,x.bl_tree),$--),q(x,j,x.bl_tree),X(x,$-3,2)):$<=10?(q(x,O,x.bl_tree),X(x,$-3,3)):(q(x,F,x.bl_tree),X(x,$-11,7));G=P,ue=($=0)===J?(te=138,3):P===J?(te=6,3):(te=7,4)}}i(Z);var L=!1;function w(x,C,H,U){X(x,(c<<1)+(U?1:0),3),function(P,G,J,$){ce(P),$&&(ne(P,J),ne(P,~J)),t.arraySet(P.pending_buf,P.window,G,J,P.pending),P.pending+=J}(x,C,H,!0)}o._tr_init=function(x){L||(function(){var C,H,U,P,G,J=new Array(b+1);for(P=U=0;P<v-1;P++)for(M[P]=U,C=0;C<1<<z[P];C++)h[U++]=P;for(h[U-1]=P,P=G=0;P<16;P++)for(Z[P]=G,C=0;C<1<<B[P];C++)D[G++]=P;for(G>>=7;P<d;P++)for(Z[P]=G<<7,C=0;C<1<<B[P]-7;C++)D[256+G++]=P;for(H=0;H<=b;H++)J[H]=0;for(C=0;C<=143;)Y[2*C+1]=8,C++,J[8]++;for(;C<=255;)Y[2*C+1]=9,C++,J[9]++;for(;C<=279;)Y[2*C+1]=7,C++,J[7]++;for(;C<=287;)Y[2*C+1]=8,C++,J[8]++;for(be(Y,_+1,J),C=0;C<d;C++)k[2*C+1]=5,k[2*C]=me(C,5);re=new se(Y,z,u+1,_,b),W=new se(k,B,0,d,b),ie=new se(new Array(0),R,0,g,S)}(),L=!0),x.l_desc=new I(x.dyn_ltree,re),x.d_desc=new I(x.dyn_dtree,W),x.bl_desc=new I(x.bl_tree,ie),x.bi_buf=0,x.bi_valid=0,oe(x)},o._tr_stored_block=w,o._tr_flush_block=function(x,C,H,U){var P,G,J=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=function($){var te,ue=4093624447;for(te=0;te<=31;te++,ue>>>=1)if(1&ue&&$.dyn_ltree[2*te]!==0)return r;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return e;for(te=32;te<u;te++)if($.dyn_ltree[2*te]!==0)return e;return r}(x)),ke(x,x.l_desc),ke(x,x.d_desc),J=function($){var te;for(a($,$.dyn_ltree,$.l_desc.max_code),a($,$.dyn_dtree,$.d_desc.max_code),ke($,$.bl_desc),te=g-1;3<=te&&$.bl_tree[2*N[te]+1]===0;te--);return $.opt_len+=3*(te+1)+5+5+4,te}(x),P=x.opt_len+3+7>>>3,(G=x.static_len+3+7>>>3)<=P&&(P=G)):P=G=H+5,H+4<=P&&C!==-1?w(x,C,H,U):x.strategy===4||G===P?(X(x,2+(U?1:0),3),Oe(x,Y,k)):(X(x,4+(U?1:0),3),function($,te,ue,le){var Ee;for(X($,te-257,5),X($,ue-1,5),X($,le-4,4),Ee=0;Ee<le;Ee++)X($,$.bl_tree[2*N[Ee]+1],3);V($,$.dyn_ltree,te-1),V($,$.dyn_dtree,ue-1)}(x,x.l_desc.max_code+1,x.d_desc.max_code+1,J+1),Oe(x,x.dyn_ltree,x.dyn_dtree)),oe(x),U&&ce(x)},o._tr_tally=function(x,C,H){return x.pending_buf[x.d_buf+2*x.last_lit]=C>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&C,x.pending_buf[x.l_buf+x.last_lit]=255&H,x.last_lit++,C===0?x.dyn_ltree[2*H]++:(x.matches++,C--,x.dyn_ltree[2*(h[H]+u+1)]++,x.dyn_dtree[2*T(C)]++),x.last_lit===x.lit_bufsize-1},o._tr_align=function(x){X(x,2,3),q(x,A,Y),function(C){C.bi_valid===16?(ne(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):8<=C.bi_valid&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)}(x)}},{"../utils/common":41}],53:[function(n,l,o){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,l,o){(function(t){(function(r,e){if(!r.setImmediate){var i,c,v,u,_=1,d={},g=!1,m=r.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(r);b=b&&b.setTimeout?b:r,i={}.toString.call(r.process)==="[object process]"?function(j){process.nextTick(function(){S(j)})}:function(){if(r.postMessage&&!r.importScripts){var j=!0,O=r.onmessage;return r.onmessage=function(){j=!1},r.postMessage("","*"),r.onmessage=O,j}}()?(u="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",A,!1):r.attachEvent("onmessage",A),function(j){r.postMessage(u+j,"*")}):r.MessageChannel?((v=new MessageChannel).port1.onmessage=function(j){S(j.data)},function(j){v.port2.postMessage(j)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(j){var O=m.createElement("script");O.onreadystatechange=function(){S(j),O.onreadystatechange=null,c.removeChild(O),O=null},c.appendChild(O)}):function(j){setTimeout(S,0,j)},b.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var O=new Array(arguments.length-1),F=0;F<O.length;F++)O[F]=arguments[F+1];var z={callback:j,args:O};return d[_]=z,i(_),_++},b.clearImmediate=y}function y(j){delete d[j]}function S(j){if(g)setTimeout(S,0,j);else{var O=d[j];if(O){g=!0;try{(function(F){var z=F.callback,B=F.args;switch(B.length){case 0:z();break;case 1:z(B[0]);break;case 2:z(B[0],B[1]);break;case 3:z(B[0],B[1],B[2]);break;default:z.apply(e,B)}})(O)}finally{y(j),g=!1}}}}function A(j){j.source===r&&typeof j.data=="string"&&j.data.indexOf(u)===0&&S(+j.data.slice(u.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof ct<"u"?ct:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jn);var ti=jn.exports;const ni=Kn(ti),ri=async(s,f,n,l,o)=>{var i,c,v;const t=document.querySelector(`svg#${s}`);if(!t)throw new Error("Requested canvas SVG element not found");const r=Number((i=t.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:i[0]),e=t.cloneNode(!0);if(e.setAttribute("height",(r*(o||100)/100).toString()),e.style.setProperty("all","initial"),["share"].map(u=>{var _;return[...((_=[...document.querySelectorAll("link")].filter(d=>d.id==="css_"+u)[0])==null?void 0:_.sheet).cssRules].map(d=>d.cssText).join(" ")}).forEach(u=>{const _=document.createElement("style");_.textContent=u,e.prepend(_)}),(c=e.querySelector("rect#canvas-border"))==null||c.setAttribute("stroke",l?"black":"none"),(v=e.querySelector("rect#canvas-bg"))==null||v.setAttribute("fill",n?"none":"white"),f===Q.MTR)try{const u=await ai(e),_=document.createElement("style");_.textContent=u.join(`
`),e.prepend(_)}catch(u){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(u)}return e},si=s=>new Promise(f=>{const n=new FileReader;n.onloadend=()=>f(n.result),n.readAsDataURL(s)}),ii=(s,f)=>s.find(n=>{const l=n.style;return l.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===f.family&&l.getPropertyValue("unicode-range")===f.unicodeRange}),ai=async s=>{var t,r,e;const f=Array.from(new Set([...s.querySelectorAll(".rmg-name__zh"),...s.querySelectorAll(".rmg-name__en")].map(i=>i.innerHTML).join("").replace(/\s/g,""))).join(""),n=await document.fonts.load("80px GenYoMin TW, Vegur",f),l=Array.from(((e=(r=(t=document.querySelector("link#css_share"))==null?void 0:t.sheet)==null?void 0:r.cssRules)==null?void 0:e[0]).styleSheet.cssRules),o=n.reduce((i,c)=>{const v=ii(l,c);return v?i.find(_=>{const d=_.style,g=v.style;return d.getPropertyValue("font-family")===g.getPropertyValue("font-family")&&d.getPropertyValue("unicode-range")===g.getPropertyValue("unicode-range")})?i:i.concat(v):i},[]);return await Promise.all(o.map(async i=>{try{const c=await fetch(oi(i)),v=await si(await c.blob());return i.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${v}'); `)}catch(c){return console.error(c),""}}))},oi=s=>{var n;const f=s.style.src;return En()?f.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmg/styles/"+((n=f.match(/^url\("([\S*]+)"\)/))==null?void 0:n[1])},li=async(s,f,n)=>{const l=s.viewBox.baseVal.width,o=s.viewBox.baseVal.height,t=document.querySelectorAll("canvas")[0];t.width=Number(l)*window.devicePixelRatio*f,t.height=Number(o)*window.devicePixelRatio*f,s.setAttribute("width",t.width.toString()),s.setAttribute("height",t.height.toString());const r=t.getContext("2d");return r.clearRect(0,0,t.width,t.height),s.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach(e=>e.setAttribute("font-size","11px")),s.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(e=>e.setAttribute("font-size","8.5px")),s.querySelectorAll("text, tspan").forEach(e=>{const i=window.getComputedStyle(e);e.setAttribute("font-family",i.fontFamily),e.setAttribute("fill",i.fill),e.setAttribute("dominant-baseline",i.dominantBaseline),e.setAttribute("text-anchor",i.textAnchor||"")}),new Promise((e,i)=>{const c=new Image;c.onload=()=>{setTimeout(()=>{r.drawImage(c,0,0,t.width,t.height),t.toBlob(v=>{v?e(v):i("Canvas blob is null")},"image/png")},n?2e3:0)},c.onerror=i,c.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s.outerHTML)))})},ci=s=>{var f,n,l,o,t,r,e;"line_name"in s||(s.line_name=["路線名","Name of Line"]),"dest_legacy"in s||(s.dest_legacy=!1),delete s.fontZH,delete s.fontEN,delete s.weightZH,delete s.weightEN;for(const[i,c]of Object.entries(s.stn_list))"branch"in c||(s.stn_list[i].branch={left:[],right:[]},c.children.length===2?s.stn_list[i].branch.right=["through",c.children[1]]:s.stn_list[i].branch.right=[],c.parents.length===2?s.stn_list[i].branch.left=["through",c.parents[1]]:s.stn_list[i].branch.left=[]);"psd_num"in s?s.psd_num=s.psd_num.toString():s.psd_num="1","line_num"in s||(s.line_num="1"),s.theme.length===3&&s.theme.push("#fff");for(const[i,c]of Object.entries(s.stn_list))"num"in c||(s.stn_list[i].num="00"),"interchange"in c&&c.interchange.map(v=>v.forEach(u=>{u.length===5&&u.splice(3,0,"#fff")}));for(const[i,c]of Object.entries(s.stn_list))c.change_type==="osi22_end_p"&&(s.stn_list[i].change_type="osi22_pr"),c.change_type==="osi22_end_u"&&(s.stn_list[i].change_type="osi22_ur");for(const[i,c]of Object.entries(s.stn_list))"interchange"in c||(s.stn_list[i].interchange=[[]]);"info_panel_type"in s?s.info_panel_type=(i=>{switch(i){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return i}})(s.info_panel_type):s.info_panel_type="gz28","direction_gz_x"in s||(s.direction_gz_x=50),"direction_gz_y"in s||(s.direction_gz_y=70);for(const[i,c]of Object.entries(s.stn_list))"transfer"in c||(s.stn_list[i].transfer={tick_direc:c.change_type==="none"||c.change_type==="int2"?"r":(f=c.change_type)==null?void 0:f.split("_")[1].split("").slice().reverse()[0],paid_area:((n=c.change_type)==null?void 0:n.indexOf("osi"))!==-1?((l=c.change_type)==null?void 0:l.split("_")[1][0])==="p":!0,osi_names:((o=c.change_type)==null?void 0:o.indexOf("osi"))!==-1?[c.interchange[1][0]]:[],info:c.interchange.length===2?[c.interchange[0],c.interchange[1].slice(1)]:c.interchange}),delete s.stn_list[i].change_type,delete s.stn_list[i].interchange;for(const[i,c]of Object.entries(s.stn_list))"services"in c||(s.stn_list[i].services=["local"]),"facility"in c||("usage"in c?s.stn_list[i].facility=c.usage:s.stn_list[i].facility=""),delete s.stn_list[i].usage;"customiseMTRDest"in s||(s.customiseMTRDest={isLegacy:s.dest_legacy||!1,terminal:!1}),delete s.dest_legacy,"svgWidth"in s||(s.svgWidth={destination:s.svg_dest_width,runin:s.svg_dest_width,railmap:s.svg_width,indoor:s.svg_width}),"indoor"in s.svgWidth||(s.svgWidth.indoor=s.svgWidth.railmap),delete s.svg_width,delete s.svg_dest_width,"notesGZMTR"in s||(s.notesGZMTR=[]),s.notesGZMTR=(t=s.notesGZMTR)==null?void 0:t.map(i=>i.length===4?i.concat([!1]):i),delete s.char_form,delete s.show_outer,delete s.strip_pc,delete s.txt_bg_gap,"namePosMTR"in s||(s.namePosMTR={isStagger:!0,isFlip:s.txt_flip}),delete s.txt_flip,Object.keys(s.stn_list).forEach(i=>{"secondaryName"in s.stn_list[i]?s.stn_list[i].secondaryName!==!1&&s.stn_list[i].secondaryName.join()===","&&(s.stn_list[i].secondaryName=!1):s.stn_list[i].secondaryName=!1,"type"in s.stn_list[i].transfer&&delete s.stn_list[i].transfer.type}),s.style=s.style===void 0||!Object.values(Q).includes(s.style)?Q.MTR:s.style,s.coline=(r=s.coline)!=null?r:[],s.loop=(e=s.loop)!=null?e:!1,s.loop_info=s.loop_info===void 0?{bank:!0,left_and_right_factor:0,bottom_factor:1}:{...s.loop_info,bottom_factor:Math.max(s.loop_info.bottom_factor,1)};for(const[i,c]of Object.entries(s.stn_list))"loop_pivot"in c||(s.stn_list[i].loop_pivot=!1);return Array.isArray(s.coline)&&(s.coline=s.coline.reduce((i,c)=>({...i,[Ye(4)]:c}),{})),s.platform_num===!1&&(s.platform_num=""),Object.values(s.stn_list).forEach(i=>{var v,u;const c=i;c.one_line=(v=c.one_line)!=null?v:!1,c.int_padding=(u=c.int_padding)!=null?u:s.loop?250:355}),s.branchSpacingPct===void 0&&(s.style===Q.SHMetro?s.branchSpacingPct=Math.round(s.branch_spacing/s.svg_height*300):s.branchSpacingPct=Math.round(s.branch_spacing/s.svg_height*200),delete s.branch_spacing),s},di=s=>new Promise(f=>{setTimeout(f,s)});function ui(s){const{isOpen:f,onClose:n}=s,{t:l}=ae(),o=ge(),[t,r]=K.useState(""),[e,i]=K.useState(!1),[c,v]=K.useState(!1),[u,_]=K.useState(100),[d,g]=K.useState("png"),m=ee(R=>R.app.canvasToShow),{style:b,stn_list:y,current_stn_idx:S,line_name:A}=ee(R=>R.param);K.useEffect(()=>{t!==""&&!m.includes(t)&&r("")},[m]);const j=Mt[b].reduce((R,N)=>m.includes(N)?{...R,[N]:l("CanvasType."+N)}:{...R},{"":l("DownloadModal.pleaseSelect")}),O=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((R,N)=>({...R,[N]:`${N}%`}),{}),F={png:l("DownloadModal.png"),svg:l("DownloadModal.svg")},z=[{type:"select",label:l("DownloadModal.canvas"),value:t,options:j,disabledOptions:[""],onChange:R=>r(R),minW:"full"},{type:"switch",label:l("DownloadModal.transparent"),isChecked:e,onChange:i,oneLine:!0,minW:"full"},{type:"switch",label:l("DownloadModal.showBorder"),isChecked:c,onChange:v,oneLine:!0,minW:"full"},{type:"select",label:l("DownloadModal.scale"),value:u,options:O,onChange:R=>_(R)},{type:"select",label:l("DownloadModal.format"),value:d,options:F,onChange:R=>g(R)}],B=async R=>{o(tn(0));const N=R==="current"?[S]:Object.keys(y).filter(k=>!["linestart","lineend"].includes(k)),Y=new ni;for(const k in N){o(tn((Number(k)+1)/N.length*100));const D=N[k];o(Ct(D)),await di(500);const h=await ri(t,b,e,c,u);document.body.appendChild(h);const M=`rmg.${D}.${y[D].name[0]}.${y[D].name[1]}`.replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(d==="png"){const re=En()&&k==="0",W=await li(h,u/100,re);N.length>1?Y.file(`${M}.png`,W):Rt(`${M}.png`,W)}else if(d==="svg"){h.removeAttribute("height");const re="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h.outerHTML)));N.length>1?Y.file(`${M}.svg`,re.split("base64,")[1],{base64:!0}):wn(M+".svg","image/svg+xml",h.outerHTML)}document.body.removeChild(h)}if(N.length>1){const k=await Y.generateAsync({type:"blob"}),D=`rmg.${A[0]}.${A[1]}.zip`.replaceAll(" ","_");Rt(D,k)}he.event(ye.DOWNLOAD_IMAGES,{canvasToDownload:t,style:b,option:R,format:d}),o(Ct(S)),o(_n()),n()};return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[p.jsx(Me,{children:l("DownloadModal.title")}),p.jsx(Ve,{}),p.jsx(Ne,{children:p.jsx(_e,{fields:z})}),p.jsx(Ge,{children:p.jsxs(Ie,{children:[p.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>B("current"),isDisabled:!t,children:l("DownloadModal.downloadOne")}),b!==Q.GZMTR&&p.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>B("all"),isDisabled:!t,children:l("DownloadModal.downloadAll")})]})})]})]})}function hi(){const{t:s}=ae(),[f,n]=K.useState(!1),{paramConfig:l}=ee(r=>r.app),o=ee(r=>r.param),t=()=>{wn(`RMG_${l==null?void 0:l.id}.json`,"application/json",JSON.stringify(o)),he.event(ye.DOWNLOAD_PARAM,{style:o.style})};return p.jsxs(Xn,{children:[p.jsx(Jn,{as:de,variant:"ghost",size:"sm",rightIcon:p.jsx(Qn,{}),children:s("DownloadActions.downloads")}),p.jsxs(er,{children:[p.jsx(qt,{onClick:t,children:s("DownloadActions.configFile")}),p.jsx(qt,{onClick:()=>n(!0),children:s("DownloadActions.images")})]}),p.jsx(ui,{isOpen:f,onClose:()=>n(!1)})]})}function _t(){const[s,f]=tr();return[s,l=>{if(f(l),Object.keys(l)){const o=new URLSearchParams(l);he.updateUrl("/rmg/?"+o)}else he.updateUrl("/rmg/")}]}function mi(){const{t:s}=ae(),f=Dt(),[,n]=_t(),l=()=>{f(Xe(Ze.CLOSE)),f(gn(void 0)),n({})};return p.jsxs(Ie,{ml:"auto",w:"fit-content",children:[p.jsx(de,{variant:"ghost",size:"sm",leftIcon:p.jsx(nr,{}),onClick:l,children:s("All projects")}),p.jsx(hi,{}),p.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:p.jsx(rr,{}),onClick:()=>f(Xe(Ze.STYLE)),children:s("HeaderActions.editStyle")})]})}function pi(){const{t:s}=ae(),f=ge(),{canvasToShow:n,canvasScale:l}=ee(c=>c.app),o=ee(c=>c.param.style),t=Object.values(Q).reduce((c,v)=>({...c,[v]:s("RmgStyle."+v)}),{}),r=Mt[o].map(c=>({label:s("CanvasType."+c),value:c})),e=c=>{f(rs(c))},i=[{type:"select",label:s("Style"),value:o,options:t,onChange:c=>e(c)},{type:"custom",label:s("View"),component:p.jsx(sr,{displayValue:s("Select canvas"),selections:r,defaultValue:n,onChange:c=>f(ts(c))})},{type:"slider",label:s("Canvas scale"),value:l,min:.1,max:2,step:.01,onChange:c=>f(ns(c)),leftIcon:p.jsx(ir,{}),rightIcon:p.jsx(ar,{})}];return p.jsxs(or,{children:[p.jsx(_e,{fields:i,minW:160}),p.jsx(mi,{})]})}const fi=s=>{switch(s){case Q.MTR:return[ze.Hongkong,"twl","#E2231A",we.white];case Q.GZMTR:return[ze.Guangzhou,"gz1","#F3D03E",we.black];case Q.SHMetro:return[ze.Shanghai,"sh1","#E4002B",we.white];default:return[ze.Other,"other","#AAAAAA",we.white]}},_i=s=>{switch(s){case"zh-Hans":return["1号线","Line 1"];case"zh-Hant":return["荃灣綫","Tsuen Wan Line"];default:return["地鐵線","Metro Line"]}},nt=s=>({name:["未命名 "+s,"Unnamed "+s],secondaryName:!1,num:"00",services:[Ot.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{info:[[]],tick_direc:qe.right,paid_area:!0,osi_names:[]},facility:Te.none,loop_pivot:!1,one_line:!0,int_padding:355}),gi=(s,f)=>{const n=nt("linestart");n.name=["LEFT END","LEFT END"];const l=nt("lineend");l.name=["RIGHT END","RIGHT END"];const o=Ye(6),t=nt(o);t.num="01";const r=Ye(6),e=nt(r);return e.num="02",n.children=[o],t.parents=["linestart"],t.children=[r],e.parents=[o],e.children=["lineend"],l.parents=[r],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:s,y_pc:50,padding:10,branchSpacingPct:33,direction:qe.left,platform_num:"1",theme:fi(s),line_name:_i(f),current_stn_idx:r,stn_list:{linestart:n,[o]:t,[r]:e,lineend:l},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:s===Q.SHMetro?pn.sh:mn.gz1,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}},st=(s,f,n,l)=>(o,t)=>{const r=t().param.stn_list;let e=Ye(6);for(;e in r;)e=Ye(6);const i=nt(e);if(s!=="new"){const c={...r,[f]:{...r[f],children:r[f].children.map(v=>v===n?e:v),branch:{left:r[f].branch.left,right:r[f].branch.right.length&&r[f].branch.right[1]===n?[r[f].branch.right[0],e]:r[f].branch.right}},[n]:{...r[n],parents:r[n].parents.map(v=>v===f?e:v),branch:{left:r[n].branch.left.length&&r[n].branch.left[1]===f?[r[n].branch.left[0],e]:r[n].branch.left,right:r[n].branch.right}},[e]:{...i,parents:[f],children:[n]}};return o(We(c)),e}else{if(!l)return!1;const c={...r,[f]:{...r[f],children:l==="upper"?[e,r[f].children[0]]:[r[f].children[0],e],branch:{left:r[f].branch.left,right:[ht.through,e]}},[n]:{...r[n],parents:l==="upper"?[e,r[n].parents[0]]:[r[n].parents[0],e],branch:{left:[ht.through,e],right:r[n].branch.right}},[e]:{...i,parents:[f],children:[n]}};return o(We(c)),e}},vi=(s,f,n)=>(l,o)=>{const r=o().helper.branches[s];if(r!=null&&r.length)if(f==="before"){const e=r[r.indexOf(n)-1];return l(st(s.toString(),e,n))}else{const e=r[r.indexOf(n)+1];return l(st(s.toString(),n,e))}else return!1},yi=()=>(s,f)=>{const n=f().param.stn_list;return f().helper.branches[0].filter(o=>{const t=n[o].parents.length+n[o].children.length===4,r=Ht(o,n)===0;return!t&&r})},rn=(s,f)=>(n,l)=>{const o=l().param.stn_list,t=l().helper.branches;return!t[0].includes(s)||!t[0].includes(f)?"Branch should end at main line":t[0].indexOf(s)>=t[0].indexOf(f)?"Not in correct ordering":s==="linestart"&&f==="lineend"?"Should not be parallel to main line":s==="linestart"&&t[0].indexOf(f)===1?"Branch should not be open jaw from the first station":f==="lineend"&&t[0].indexOf(s)===t[0].length-2?"Branch should not be open jaw from the last station":o[s].children.length>1||o[f].parents.length>1?"Branch already exist":t.slice(1).some(i=>i.slice(1,-1).includes(s)||i.slice(1,-1).includes(f))?"Cannot branch out from existing branch":t[0].slice(t[0].indexOf(s)+1,t[0].indexOf(f)).every(i=>o[i].parents.length===1&&o[i].children.length===1)?"":"One or more stations between both ends are branching out"};function bi(s){var F,z;const{isOpen:f,onClose:n}=s,{t:l}=ae(),o=ge(),t=ee(B=>B.app.selectedBranch),{style:r,stn_list:e}=ee(B=>B.param),i=ee(B=>B.helper.branches),[c,v]=K.useState(t),[u,_]=K.useState("before"),[d,g]=K.useState(""),[m,b]=K.useState(!1);K.useEffect(()=>{v(t)},[t]),K.useEffect(()=>{f||b(!1)},[f]);const y=(z=(F=i[Number(c)])==null?void 0:F.slice(1,-1))!=null?z:[],S=B=>B.reduce((R,N)=>{var Y;return{...R,[N]:(Y=e[N])==null?void 0:Y.name.join(" - ")}},{"":l("AddStationModal.pleaseSelect")}),A=[{type:"select",label:l("AddStationModal.where"),value:c,options:{...i.reduce((B,R,N)=>({...B,[N]:N===0?l("AddStationModal.main"):r!==Q.SHMetro||!Je(R,e)?l("AddStationModal.branch")+" "+N:l("AddStationModal.external")+" "+N}),{})},onChange:B=>j(B),minW:"full"},{type:"select",label:l("AddStationModal.preposition"),value:u,options:{before:l("AddStationModal.before"),after:l("AddStationModal.after")},onChange:B=>_(B)},{type:"select",label:l("AddStationModal.pivot"),value:d,options:S(y),disabledOptions:[""],onChange:B=>g(B)}],j=B=>{v(B),g("")},O=()=>{const B=o(vi(c,u,d));B?(n(),o(fn(B)),o(Xe(Ze.STATION))):(console.log("false here"),b(!0)),he.event(ye.ADD_STATION,{style:r,branchIndex:c,success:B})};return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[m&&p.jsxs(Ft,{status:"error",variant:"solid",size:"xs",children:[p.jsx(Bt,{}),l("AddStationModal.error")]}),p.jsxs(Se,{position:"relative",children:[p.jsx(Me,{children:l("AddStationModal.title")}),p.jsx(Ve,{})]}),p.jsx(Ne,{children:p.jsx(_e,{fields:A})}),p.jsx(Ge,{children:p.jsx(de,{colorScheme:"primary",onClick:O,isDisabled:!d,children:l("Confirm")})})]})]})}function xi(s){const{isOpen:f,onClose:n}=s,{t:l}=ae(),o=ge(),[t,r]=K.useState("new"),[e,i]=K.useState(""),[c,v]=K.useState(""),[u,_]=K.useState("upper"),[d,g]=K.useState(""),[m,b]=K.useState(""),{style:y,stn_list:S}=ee(Y=>Y.param);K.useEffect(()=>{f||(r("new"),i(""),v(""))},[f]);const j=(Y=>Y.reduce((k,D)=>{var h;return{...k,[D]:(h=S[D])==null?void 0:h.name.join(" - ")}},{"":l("NewBranchModal.pleaseSelect")}))(o(yi())),O=[{type:"select",label:l("NewBranchModal.where"),value:t,options:{new:l("NewBranchModal.new"),ext:l("NewBranchModal.ext")},disabledOptions:y===Q.SHMetro?[]:["ext"],onChange:Y=>F(Y),minW:"full"},{type:"select",label:l("NewBranchModal.from"),value:e,options:j,disabledOptions:[""],onChange:Y=>z(Y),isInvalid:!!d},{type:"select",label:l("NewBranchModal.to"),value:c,options:j,disabledOptions:[""],onChange:Y=>B(Y),isInvalid:!!m},{type:"select",label:l("NewBranchModal.position"),value:u,options:{upper:l("NewBranchModal.upper"),lower:l("NewBranchModal.lower")},onChange:Y=>_(Y),minW:"full",hidden:t!=="new"||y===Q.SHMetro}],F=Y=>{r(Y),i(""),v(""),g(""),b("")},z=Y=>{i(Y),g(""),Y&&c&&b(o(rn(Y,c)))},B=Y=>{v(Y),b(""),e&&Y&&g(o(rn(e,Y)))},R=()=>{let Y;t==="ext"?Y=o(st("new",e,c,"lower")):y===Q.SHMetro?Y=o(st("new",e,c,"upper")):Y=o(st("new",e,c,u)),Y&&(n(),he.event(ye.ADD_BRANCH,{style:y,where:t}))},N=!!(!e||!c||d||m);return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[p.jsx(Me,{children:l("NewBranchModal.title")}),p.jsx(Ve,{}),p.jsx(Ne,{children:p.jsx(_e,{fields:O})}),p.jsx(Ge,{children:p.jsx(de,{colorScheme:"primary",title:N?d||m:l("Confirm"),onClick:R,isDisabled:N,children:l("Confirm")})})]})]})}const Si=K.lazy(()=>E(()=>import("./station-ag-grid-89d00c63.js"),["assets/station-ag-grid-89d00c63.js","assets/vendor-996bcf09.js","assets/index-30d7226a.js","assets/index-1aae2bd9.css"]));function wi(){const{t:s}=ae(),f=ge(),[n,l]=K.useState(!1),[o,t]=K.useState(!1),r=ee(u=>u.app.selectedBranch),{style:e,stn_list:i}=ee(u=>u.param),c=ee(u=>u.helper.branches),v=()=>{f(Xe(Ze.BRANCH))};return p.jsxs(Se,{flex:1,overflow:"hidden",children:[p.jsxs(Tt,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:r,onChange:u=>f(ss(u)),children:[p.jsxs(zt,{children:[c.map((u,_)=>_===0?p.jsx($e,{children:s("GridTabs.main")},_):e!==Q.SHMetro||!Je(u,i)?p.jsx($e,{children:s("GridTabs.branch")+" "+_},_):p.jsx($e,{children:s("GridTabs.external")+" "+_},_)),p.jsx(Pe,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>t(!0),icon:p.jsx(Le,{})}),p.jsxs(Ie,{marginLeft:"auto",marginRight:1,children:[p.jsx(de,{variant:"outline",size:"xs",leftIcon:p.jsx(Le,{}),onClick:()=>l(!0),children:s("GridTabs.addStation")}),p.jsx(de,{size:"xs",colorScheme:"primary",onClick:v,children:s("GridTabs.editLine")})]})]}),p.jsx(It,{flex:1,overflowY:"auto",children:c.map((u,_)=>p.jsx(ut,{padding:0,h:"100%",position:"relative",children:p.jsx(an,{suspenseFallback:p.jsx(mt,{isIndeterminate:!0}),children:p.jsx(Si,{branchIndex:_})})},_))})]}),p.jsx(bi,{isOpen:n,onClose:()=>l(!1)}),p.jsx(xi,{isOpen:o,onClose:()=>t(!1)})]})}function Ei(){const s=ge(),f=ee(l=>l.app.globalAlerts),n=l=>{he.isStandaloneWindow()?window.open(`/${l}`,"_blank"):he.openApp(l)};return p.jsx(p.Fragment,{children:Object.entries(f).map(([l,{message:o,url:t,linkedApp:r}])=>p.jsxs(Ft,{status:l,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[p.jsx(Bt,{}),r?p.jsx(wt,{onClick:()=>n(r),children:o}):t?p.jsx(wt,{href:t,target:"_blank",children:o}):o,p.jsx(lr,{ml:"auto",onClick:()=>s(is(l))})]},l))})}function ji(){const s=ee(f=>f.app.isLoading);return p.jsxs(un,{children:[s&&p.jsx(mt,{isIndeterminate:s<0,value:s>=0?s:void 0}),p.jsx(pi,{}),p.jsx(Ei,{}),p.jsxs(Ae,{flex:1,overflow:"hidden",position:"relative",children:[p.jsxs(Ae,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[p.jsx(Se,{children:p.jsx(hs,{})}),p.jsx(wi,{})]}),p.jsx(Js,{})]}),p.jsx("canvas",{style:{display:"none"}})]})}function ki(s){var c;const{config:f,onClose:n,onUpdate:l}=s,{t:o}=ae(),[t,r]=K.useState((c=f==null?void 0:f.name)!=null?c:"");K.useEffect(()=>{var v;f&&r((v=f.name)!=null?v:"")},[f]);const e=[{type:"input",label:o("Project name"),value:t,onChange:r,debouncedDelay:0}],i=()=>{var v;f&&((v=f.name)!=null?v:"")!==t&&l({...f,name:t})};return p.jsxs(De,{isOpen:!!f,onClose:n,isCentered:!0,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[p.jsx(Me,{children:o("Edit project info")}),p.jsx(Ve,{}),p.jsx(Ne,{children:p.jsx(_e,{fields:e})}),p.jsx(Ge,{children:p.jsx(de,{colorScheme:"primary",onClick:i,children:o("Confirm")})})]})]})}const Ai={flex:"2 1 0%",overflow:"hidden",minW:{base:"unset",md:240},w:{base:"100%",md:"unset"},mr:{base:0,md:2},mb:{base:2,md:0},"& > div":{flexDirection:"column",h:200,overflowX:"hidden",overflowY:"auto",borderRadius:"md",borderWidth:2,"& >.chakra-button":{alignItems:"center"},"& .chakra-button__group":{"& button:not(:first-of-type)":{h:"100%"}}}};function Oi(s){const{paramRegistry:f,downloading:n,selectedParam:l,onParamSelect:o,onParamRemove:t,onParamUpdate:r}=s,{t:e}=ae(),[i,c]=K.useState(),v=u=>{r(u),c(void 0)};return p.jsxs(Se,{sx:Ai,children:[p.jsxs(Ae,{children:[n&&p.jsx(At,{variant:"ghost",primaryText:e("Downloading")+"...",secondaryText:n,isDisabled:!0}),f.slice().sort((u,_)=>{var d,g;return((d=_.lastModified)!=null?d:0)-((g=u.lastModified)!=null?g:0)}).map(u=>{var _;return p.jsxs(cr,{size:"sm",isAttached:!0,colorScheme:l===u.id?"primary":void 0,variant:l===u.id?"solid":"ghost",children:[p.jsx(At,{primaryText:(_=u.name)!=null?_:e("Project")+" "+u.id,secondaryText:e("Last modified")+": "+ei(u.lastModified).map(e).join(" "),onClick:()=>o(u.id)}),p.jsx(Pe,{"aria-label":e("Edit project info"),title:e("Edit project info"),icon:p.jsx(dr,{}),onClick:()=>c(u)}),p.jsx(Pe,{"aria-label":e("Remove project"),title:e("Remove project"),icon:p.jsx(ft,{}),onClick:()=>t(u.id)})]},u.id)})]}),f.length>=10&&p.jsx(it,{as:"em",fontSize:"xs",children:e("You have reached the maximum number of projects.")}),p.jsx(ki,{config:i,onClose:()=>c(void 0),onUpdate:v})]})}const kn=[{id:"basic",name:{en:"Basic",ko:"기본",zh:"基本"}},{id:"mtr",name:{en:"MTR",ko:"홍콩 지하철","zh-Hans":"港铁","zh-Hant":"港鐵"}},{id:"gzmtr",name:{en:"Guangzhou Metro",ko:"광저우 지하철","zh-Hans":"广州地铁","zh-Hant":"廣州地鐵"}},{id:"shmetro",name:{en:"Shanghai Metro",ko:"상해 지하철","zh-Hans":"上海地铁","zh-Hant":"上海地鐵"}}],Ci=Object.freeze(Object.defineProperty({__proto__:null,default:kn},Symbol.toStringTag,{value:"Module"})),An=[{filename:"default",name:{en:"Default",ko:"묵인","zh-Hans":"默认","zh-Hant":"預設"},style:"mtr"},{filename:"coline",name:{en:"Track Share",ko:"공용선","zh-Hans":"共线","zh-Hant":"共綫"},style:"shmetro"},{filename:"loop",name:{en:"Loop Line",ko:"순환선","zh-Hans":"环线","zh-Hant":"環綫"},style:"shmetro"}],On=[{filename:"twl",name:{en:"Tsuen Wan Line",ko:"췬완선","zh-Hans":"荃湾线","zh-Hant":"荃灣綫"},uploadBy:"wongchito",style:"mtr"},{filename:"ktl",name:{en:"Kwun Tong Line",ko:"군통선","zh-Hans":"观塘线","zh-Hant":"觀塘綫"},uploadBy:"wongchito",style:"mtr"},{filename:"isl",name:{en:"Island Line",ko:"공도선","zh-Hans":"港岛线","zh-Hant":"港島綫"},uploadBy:"wongchito",style:"mtr"},{filename:"tkl",name:{en:"Tseung Kwan O Line",ko:"정관오선","zh-Hans":"将军澳线","zh-Hant":"將軍澳綫"},uploadBy:"wongchito",style:"mtr"},{filename:"tcl",name:{en:"Tung Chung Line",ko:"둥충선","zh-Hans":"东涌线","zh-Hant":"東涌綫"},uploadBy:"wongchito",style:"mtr"},{filename:"sile",name:{en:"South Island Line",ko:"남공도선","zh-Hans":"南港岛线","zh-Hant":"南港島綫"},uploadBy:"wongchito",style:"mtr"},{filename:"drl",name:{en:"Disneyland Resort Line",ko:"디즈니선","zh-Hans":"迪士尼线","zh-Hant":"迪士尼綫"},uploadBy:"wongchito",style:"mtr"},{filename:"ael",name:{en:"Airport Express",ko:"홍콩 공항철도","zh-Hans":"机场快线","zh-Hant":"機場快綫"},uploadBy:"wongchito",style:"mtr"},{filename:"eal",name:{en:"East Rail Line",ko:"둥팃선","zh-Hans":"东铁线","zh-Hant":"東鐵綫"},uploadBy:"wongchito",style:"mtr"},{filename:"tml",name:{en:"Tuen Ma Line",ko:"튄마선","zh-Hans":"屯马线","zh-Hant":"屯馬綫"},uploadBy:"wongchito",style:"mtr"}],Cn=[{filename:"gz1",name:{en:"Line 1",ko:"1호선","zh-Hans":"1号线","zh-Hant":"1號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz2",name:{en:"Line 2",ko:"2호선","zh-Hans":"2号线","zh-Hant":"2號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz3",name:{en:"Line 3",ko:"3호선","zh-Hans":"3号线","zh-Hant":"3號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz4",name:{en:"Line 4",ko:"4호선","zh-Hans":"4号线","zh-Hant":"4號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz5",name:{en:"Line 5",ko:"5호선","zh-Hans":"5号线","zh-Hant":"5號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz6",name:{en:"Line 6",ko:"6호선","zh-Hans":"6号线","zh-Hant":"6號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz7",name:{en:"Line 7",ko:"7호선","zh-Hans":"7号线","zh-Hant":"7號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz8",name:{en:"Line 8",ko:"8호선","zh-Hans":"8号线","zh-Hant":"8號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz9",name:{en:"Line 9",ko:"9호선","zh-Hans":"9号线","zh-Hant":"9號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz13",name:{en:"Line 13",ko:"13호선","zh-Hans":"13号线","zh-Hant":"13號線"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"gz14",name:{en:"Line 14",ko:"14호선","zh-Hans":"14号线","zh-Hant":"14號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz18",name:{en:"Line 18","zh-Hans":"18号线","zh-Hant":"18號線",ko:"18호선"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"gz21",name:{en:"Line 21",ko:"21호선","zh-Hans":"21号线","zh-Hant":"21號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz22",name:{en:"Line 22",ko:"22호선","zh-Hans":"22号线","zh-Hant":"22號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gf",name:{en:"Guangfo Line",ko:"광포 지하철","zh-Hans":"广佛线","zh-Hant":"廣佛線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"apm",name:{en:"APM Line",ko:"주장신청 자동운송 체계","zh-Hans":"APM线","zh-Hant":"APM線"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"thz1",name:{en:"Haizhu Tram Line 1",ko:"하이주 전차 1호선","zh-Hans":"海珠有轨1号线","zh-Hant":"海珠有軌1號線"},uploadBy:"clearng-kly",style:"gzmtr"},{filename:"thp1",name:{en:"Huangpu Tram Line 1",ko:"황푸 전차 1호선","zh-Hans":"黄埔有轨1号线","zh-Hant":"黃埔有軌1號線"},uploadBy:"clearng-kly",style:"gzmtr"}],Pn=[{filename:"sh1",name:{en:"Line 1",ko:"1호선","zh-Hans":"1号线","zh-Hant":"1號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh2",name:{en:"Line 2",ko:"2호선","zh-Hans":"2号线","zh-Hant":"2號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh3",name:{en:"Line 3 (External)",ko:"3호선(공선)","zh-Hans":"3号线 （共线）","zh-Hant":"3號線 （共線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh4",name:{en:"Line 4 (Loop)",ko:"4호선(순환선)","zh-Hans":"4号线 （环线）","zh-Hant":"4號線 （環線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh3&4",name:{en:"Line 3 and 4 (External with Loop)",ko:"3호선과 4호선(공선과 순환선)","zh-Hans":"3与4号线 （共线与环线）","zh-Hant":"3與4號線 （共線與環線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh5",name:{en:"Line 5",ko:"5호선","zh-Hans":"5号线","zh-Hant":"5號線"},uploadBy:"Tianxiu11111",style:"shmetro"},{filename:"sh6",name:{en:"Line 6",ko:"6호선","zh-Hans":"6号线","zh-Hant":"6號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh7",name:{en:"Line 7",ko:"7호선","zh-Hans":"7号线","zh-Hant":"7號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh8",name:{en:"Line 8",ko:"8호선","zh-Hans":"8号线","zh-Hant":"8號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh9",name:{en:"Line 9",ko:"9호선","zh-Hans":"9号线","zh-Hant":"9號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh10",name:{en:"Line 10 (Branch)",ko:"10호선(지선)","zh-Hans":"10号线 （支线）","zh-Hant":"10號線 （支線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh11",name:{en:"Line 11",ko:"11호선","zh-Hans":"11号线","zh-Hant":"11號線"},uploadBy:"Tianxiu11111",style:"shmetro"},{filename:"sh12",name:{en:"Line 12",ko:"12호선","zh-Hans":"12号线","zh-Hant":"12號線"},uploadBy:"Andy1782010",style:"shmetro"},{filename:"sh13",name:{en:"Line 13",ko:"13호선","zh-Hans":"13号线","zh-Hant":"13號線"},uploadBy:"Andy1782010",style:"shmetro"},{filename:"sh14",name:{en:"Line 14",ko:"14호선","zh-Hans":"14号线","zh-Hant":"14號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh15",name:{en:"Line 15",ko:"15호선","zh-Hans":"15号线","zh-Hant":"15號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh16",name:{en:"Line 16 (Express)",ko:"16호선(급행)","zh-Hans":"16号线 （快车）","zh-Hant":"16號線 （快車）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh17",name:{en:"Line 17",ko:"17호선","zh-Hans":"17号线","zh-Hant":"17號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh18",name:{en:"Line 18",ko:"18호선","zh-Hans":"18号线","zh-Hant":"18號線"},uploadBy:"Tianxiu11111",style:"shmetro"}],Rn={basic:An,mtr:On,gzmtr:Cn,shmetro:Pn},Pi=Object.freeze(Object.defineProperty({__proto__:null,basic:An,default:Rn,gzmtr:Cn,mtr:On,shmetro:Pn},Symbol.toStringTag,{value:"Module"}));var sn;(function(s){s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro"})(sn||(sn={}));const St=kn,Ri=Rn,Ti=async()=>{try{return await(await fetch("/rmg-templates/resources/other-company-config.json")).json()}catch(s){return console.error("Failed to fetch non-core company config",s),[]}},zi=async s=>{try{return await(await fetch("/rmg-templates/resources/templates/"+s+"/00config.json")).json()}catch(f){return console.error("Failed to fetch template list for "+s,f),[]}},Ii=async(s,f)=>await(await fetch(`/rmg-templates/resources/templates/${s}/${f}.json`)).json(),Li=Object.assign({"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/coline.json":()=>E(()=>import("./coline-f8f9d6ad.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/default.json":()=>E(()=>import("./default-8638e856.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/loop.json":()=>E(()=>import("./loop-d33ec3ba.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/company-config.json":()=>E(()=>Promise.resolve().then(()=>Ci),void 0),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/apm.json":()=>E(()=>import("./apm-6e72c810.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gf.json":()=>E(()=>import("./gf-18503731.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz1.json":()=>E(()=>import("./gz1-75ca50af.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz13.json":()=>E(()=>import("./gz13-05ce4bc5.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz14.json":()=>E(()=>import("./gz14-0d29f52b.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz18.json":()=>E(()=>import("./gz18-e8d4e789.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz2.json":()=>E(()=>import("./gz2-4c7b72d4.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz21.json":()=>E(()=>import("./gz21-fde5cfda.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz22.json":()=>E(()=>import("./gz22-68732269.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz3.json":()=>E(()=>import("./gz3-6bbd1d1a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz4.json":()=>E(()=>import("./gz4-cda087f7.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz5.json":()=>E(()=>import("./gz5-9cfad33f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz6.json":()=>E(()=>import("./gz6-ef051d83.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz7.json":()=>E(()=>import("./gz7-d485fe1c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz8.json":()=>E(()=>import("./gz8-9bfb0da0.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz9.json":()=>E(()=>import("./gz9-d4b7ed92.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/thp1.json":()=>E(()=>import("./thp1-a903ecca.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/thz1.json":()=>E(()=>import("./thz1-1ae6befb.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/ael.json":()=>E(()=>import("./ael-4597497c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/drl.json":()=>E(()=>import("./drl-31b14420.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/eal.json":()=>E(()=>import("./eal-34089efb.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/isl.json":()=>E(()=>import("./isl-f1ae743f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/ktl.json":()=>E(()=>import("./ktl-a9936c0c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/sile.json":()=>E(()=>import("./sile-9f2ad194.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tcl.json":()=>E(()=>import("./tcl-820e4d78.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tkl.json":()=>E(()=>import("./tkl-8050f7fc.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tml.json":()=>E(()=>import("./tml-a6ec2eb1.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/twl.json":()=>E(()=>import("./twl-cfa1235a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh1.json":()=>E(()=>import("./sh1-16505f5a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh10.json":()=>E(()=>import("./sh10-20d49595.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh11.json":()=>E(()=>import("./sh11-f590ba3c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh12.json":()=>E(()=>import("./sh12-55a7651d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh13.json":()=>E(()=>import("./sh13-f5ab141e.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh14.json":()=>E(()=>import("./sh14-e4f19564.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh15.json":()=>E(()=>import("./sh15-450e891e.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh16.json":()=>E(()=>import("./sh16-af851e67.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh17.json":()=>E(()=>import("./sh17-7a345c0f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh18.json":()=>E(()=>import("./sh18-57e7f645.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh2.json":()=>E(()=>import("./sh2-5e30f125.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh3&4.json":()=>E(()=>import("./sh3_4-e404007d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh3.json":()=>E(()=>import("./sh3-d2f3bfdd.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh4.json":()=>E(()=>import("./sh4-f52274b7.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh5.json":()=>E(()=>import("./sh5-4c805b99.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh6.json":()=>E(()=>import("./sh6-9ebc745d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh7.json":()=>E(()=>import("./sh7-8f088603.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh8.json":()=>E(()=>import("./sh8-87130c53.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh9.json":()=>E(()=>import("./sh9-7e967e6c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/template-configs.json":()=>E(()=>Promise.resolve().then(()=>Pi),void 0)});function Di(s){const{isOpen:f,onClose:n,onOpenParam:l}=s,{t:o}=ae(),t=ge(),[r,e]=K.useState(St),[i,c]=K.useState(Ri);K.useEffect(()=>{Ti().then(u=>{e([...St,...u]);for(const _ of u)zi(_.id).then(d=>{c(g=>({...g,[_.id]:d}))})})},[]);const v=async(u,_,d)=>{t(as());const g=r.find(y=>y.id===u),m=g?yt(g.name):u,b=St.some(y=>y.id===u);try{const y=b?(await Li[`/node_modules/@railmapgen/rmg-templates-resources/templates/${u}/${_}.json`]()).default:await Ii(u,_);l(y,[m,d].join(" "))}catch(y){console.error("Failed to fetch template",y)}he.event(ye.OPEN_TEMPLATE,{company:u,filename:_}),t(_n())};return p.jsxs(De,{isOpen:f,onClose:n,children:[p.jsx(Fe,{}),p.jsxs(Be,{children:[p.jsx(Me,{children:o("TemplateModal.title")}),p.jsx(Ve,{}),p.jsx(Ne,{children:p.jsxs(Tt,{isLazy:!0,size:"sm",orientation:"vertical",colorScheme:"primary",children:[p.jsx(zt,{maxW:150,children:r.map(u=>p.jsx($e,{children:yt(u.name)},u.id))}),p.jsx(It,{maxW:250,children:Object.entries(i).sort((u,_)=>r.findIndex(d=>d.id===u[0])-r.findIndex(d=>d.id===_[0])).map(([u,_])=>p.jsx(ut,{as:Ae,flexDirection:"column",py:0,px:1,children:_.map(d=>{var m;const g=yt(d.name);return p.jsx(At,{variant:"ghost",size:"sm",primaryText:g,secondaryText:o("by")+": "+((m=d.uploadBy)!=null?m:"Unknown"),onClick:()=>v(u,d.filename,g)},d.filename)})},u))})]})})]})]})}const Fi={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function Bi(s){const{selectedParam:f,disableNew:n,onError:l}=s,{t:o}=ae(),[,t]=_t(),[r,e]=K.useState(!1),i=K.useRef(null),c=K.useRef(null);K.useEffect(()=>{var g;f&&((g=c.current)==null||g.focus())},[f]);const v=()=>{const g=gi(Q.MTR,he.getLanguage()),m=bt(JSON.stringify(g));t({project:m}),he.event(ye.NEW_PARAM,{})},u=(g,m)=>{const b=bt(JSON.stringify(g),m);t({project:b})},_=async g=>{var b;const m=(b=g.target.files)==null?void 0:b[0];console.log("handleImportProject():: received file",m);try{if(!m)l(o("OpenActions.unknownError"));else if(m.type!=="application/json")l(o("OpenActions.invalidType"));else{const y=await Qs(m),S=bt(y);t({project:S}),he.event(ye.UPLOAD_PARAM,{})}}catch(y){l(o("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",y)}g.target.value=""},d=()=>{f&&(t({project:f}),he.event(ye.OPEN_PARAM,{}))};return p.jsxs(Ae,{sx:Fi,children:[p.jsx(de,{leftIcon:p.jsx(Le,{}),onClick:v,isDisabled:n,children:o("Blank project")}),p.jsx(de,{leftIcon:p.jsx(ur,{}),onClick:()=>e(!0),isDisabled:n,children:o("Open template")}),p.jsx(de,{leftIcon:p.jsx(hr,{}),onClick:()=>{var g;return(g=i.current)==null?void 0:g.click()},isDisabled:n,children:o("Import project")}),p.jsx(de,{ref:c,colorScheme:"primary",leftIcon:p.jsx(mr,{}),onClick:d,isDisabled:f===void 0,children:o("Open selected")}),p.jsx("input",{ref:i,type:"file",accept:".json",hidden:!0,onChange:_,"data-testid":"file-upload"}),p.jsx(Di,{isOpen:r,onClose:()=>e(!1),onOpenParam:u})]})}const Mi={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function Vi(s){const{downloading:f}=s,{t:n}=ae(),[l]=_t(),o=l.get("project"),[t,r]=K.useState([]),[e,i]=K.useState(),c=K.useRef(null),v=hn();K.useEffect(()=>{r(xt())},[f]),pr({ref:c,handler:()=>i(void 0)});const u=g=>{const{id:m,name:b,lastModified:y}=g;m&&(window.localStorage.setItem(rt.PARAM_CONFIG_BY_ID+m,JSON.stringify({name:b,lastModified:y})),i(void 0),r(xt()),he.event(ye.UPDATE_PARAM_CONFIG,{}))},_=g=>{window.localStorage.removeItem(rt.PARAM_BY_ID+g),window.localStorage.removeItem(rt.PARAM_CONFIG_BY_ID+g),i(void 0),r(xt()),he.event(ye.REMOVE_PARAM,{})},d=g=>{v({description:g,status:"error",duration:1e4,isClosable:!0})};return p.jsxs(un,{justifyContent:"center",children:[o&&p.jsx(mt,{isIndeterminate:!0}),p.jsx(fr,{children:p.jsxs(Ue,{sx:Mi,children:[p.jsx(xe,{as:"h3",size:"lg",children:n("Saved projects")}),p.jsxs(Ae,{ref:c,children:[p.jsx(Oi,{paramRegistry:t,downloading:f,selectedParam:e,onParamSelect:i,onParamRemove:_,onParamUpdate:u}),p.jsx(Bi,{selectedParam:e,disableNew:t.length>=10,onError:d})]})]})})]})}const Ni=s=>f=>{let n={id:s};const l=window.localStorage.getItem(rt.PARAM_CONFIG_BY_ID+s);l===null?console.warn(`Config for paramID=${s} does not exist in localStorage`):n={...n,...JSON.parse(l)};try{const o=window.localStorage.getItem(rt.PARAM_BY_ID+s);if(o===null)return console.warn(`Param ID=${s} does not exist in localStorage`),!1;{const t=ci(JSON.parse(o));return f(gn(n)),f(os(t)),!0}}catch(o){return console.warn("Failed to parse param.",o),!1}};function Hi(){const{t:s}=ae(),f=ge(),{paramConfig:n}=ee(_=>_.app),[l,o]=_t(),t=l.get("project"),r=l.get("external"),[e,i]=K.useState(!1),[c,v]=K.useState(),u=hn();return K.useEffect(()=>{if(console.log(`searchParam: project=${t}, external=${r}`),t&&r)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),o({project:t});else if(t)u.closeAll(),t===(n==null?void 0:n.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),i(!0)):(console.log(`AppRouter:: Loading app view for param (ID=${t})...`),f(Ni(t))?i(!0):(console.log(`AppRouter:: Failed to read param (ID=${t}). Rendering param selector view...`),u({description:s("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),o({})));else if(r){console.log("AppRouter:: External project URl is provided. Downloading project...");const _=decodeURIComponent(r);v(_),ls(_).then(d=>{d?o({project:d}):(console.log(`AppRouter:: Failed to download param from ${_}. Rendering param selector view...`),u({description:s("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),o({})),v(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),i(!1)},[t,r]),e?p.jsx(ji,{}):p.jsx(Vi,{downloading:c})}const Gi=Object.freeze(Object.defineProperty({__proto__:null,default:Hi},Symbol.toStringTag,{value:"Module"}));export{Gi as a,Zi as g,Je as i,di as w};
