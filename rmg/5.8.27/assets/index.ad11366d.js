import{j as d,M as P,l as t,z as h,ab as R}from"./vendor.f27047fc.js";import{at as T,u as f,j as X,S,ar as w,P as $}from"./index.62dae999.js";import{a as Y,c as y,b as J,e as q,S as O}from"./share.11746275.js";function K(n){const{num:e,inStrip:a,...r}=n;return d("g",{textAnchor:"middle",fill:a?P.black:"var(--rmg-theme-fg)",...r,children:[t("rect",{height:40,width:40,rx:4,x:-20,fill:a?"#fff":"var(--rmg-theme-colour)"}),t("text",{className:"rmg-name__en",fontSize:20,dy:12,children:e}),t("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"\u5C4F\u853D\u95E8"}),t("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})}const G=n=>{const e=(s=>{switch(s){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":return 20;default:return 0}})(n.variant),a=h.exports.useMemo(()=>{switch(n.variant){case"gz1":return t("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return t("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return t("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return t("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return t("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return t("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return t("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return t("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});default:return t(R,{})}},[n.variant]),r=-20;return d("g",{transform:`translate(0,${n.variant==="gz4"?r:0})`,children:[t("rect",{id:"strip_gz",style:{["--height"]:`${e}px`}}),t("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:n.isShowLight&&a}),n.isShowPSD!==!1&&t(Q,{...n})]})},Q=h.exports.memo(function(e){const a=["gz28","gz2otis","gz6","gzgf"].includes(e.variant),r=(s=>{switch(s){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";default:return"58px"}})(e.variant);return t(K,{num:e.isShowPSD,inStrip:a,style:{["--psd-dy"]:r,transform:"translate(var(--translate-x), var(--translate-y))",["--translate-x"]:"calc(var(--rmg-svg-width) / 2 + 80px)",["--translate-y"]:"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))"}})},(n,e)=>n.variant===e.variant&&n.isShowPSD===e.isShowPSD),j=h.exports.memo(function(e){const{passed:a,large:r}=e;return t("path",{d:r?"M0,12.95 V-12.95 H-12.95 a12.95,12.95 0 0,0 0,25.9 h25.9 a12.95,12.95 0 0,0 0,-25.9 H0":"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:"#fff",strokeWidth:2,stroke:a?"#aaa":"var(--rmg-theme-colour)"})},(n,e)=>n.passed===e.passed&&n.large===e.large),A=15;function Z(n){const{lineNum:e,stnNum:a,passed:r,large:s,...o}=n,i=h.exports.useRef(null),c=h.exports.useRef(null),[m,l]=h.exports.useState({width:0}),[p,x]=h.exports.useState({width:0});h.exports.useEffect(()=>{i.current&&l(i.current.getBBox()),c.current&&x(c.current.getBBox())},[e,a]);const g=A/Math.max(A,m.width),N=e.length===2&&a.length===2?g:A/Math.max(A,p.width);return d("g",{...o,children:[t(j,{passed:r,large:s}),d("g",{textAnchor:"middle",fontSize:13.5,transform:s?"scale(1.4)":"",fill:r?"#aaa":"#000",children:[t("g",{transform:`translate(-9.25,0)scale(${g})`,children:t("text",{ref:i,className:"rmg-name__zh",children:e})}),t("g",{transform:`translate(9.25,0)scale(${N})`,children:t("text",{ref:c,className:"rmg-name__zh",children:a})})]})]})}const ee=h.exports.memo(function(e){const{lineName:a,commonPart:r}=e,s=h.exports.useRef(null),[o,i]=h.exports.useState({x:0,height:0,width:0});h.exports.useEffect(()=>{s.current&&i(s.current.getBBox())},[a.toString()]);const c=k/Math.max(k,o.width),m=(-o.x-o.width/2)*c,l=o.height*(1-c)*1.2/2;return t("g",{ref:s,transform:`translate(${m},${l})scale(${c})`,children:d("text",{className:"rmg-name__zh",fontSize:14,y:12,textAnchor:"end",children:[r,t("tspan",{className:"rmg-name__zh",fontSize:8,x:0,dy:-2,textAnchor:"start",children:a[0].slice(r.length).trim()}),t("tspan",{className:"rmg-name__en",fontSize:4,x:0,dy:6,textAnchor:"start",children:a[1].slice(r.length).trim()})]})})},(n,e)=>n.lineName.toString()===e.lineName.toString());function te(n){return t("rect",{x:-22.5,height:24,width:45,rx:4.5,...n})}const k=42,F=h.exports.memo(function(e){const{lineName:a,foregroundColour:r,backgroundColour:s,passed:o}=e,[i,c]=ne(a),m=h.exports.useRef(null),l=h.exports.useRef(null),[p,x]=h.exports.useState({width:0}),[g,N]=h.exports.useState({width:0});h.exports.useEffect(()=>{m.current&&x(m.current.getBBox()),l.current&&N(l.current.getBBox())},[a.toString()]);const u=k/Math.max(k,p.width),v=k/Math.max(k,g.width),_={nameZh:{y:7.3+13.5*(1-u)*u/2},nameEn:{y:19.5-9*(1-v)*v/2}};return d("g",{textAnchor:"middle",fill:o?P.white:r,children:[t(te,{fill:o?"#aaa":s}),i===2?t(ee,{lineName:a,commonPart:c}):d(R,{children:[t("text",{ref:m,className:"rmg-name__zh",fontSize:12,transform:`translate(0,${_.nameZh.y})scale(${u})`,children:i===1?d(R,{children:[t("tspan",{fontSize:16,dy:.7,className:"rmg-name__zh",children:c}),t("tspan",{dy:-.7,className:"rmg-name__zh",children:a[0].slice(c.length)})]}):a[0]}),t("text",{ref:l,className:"rmg-name__en",fontSize:8,transform:`translate(0,${_.nameEn.y})scale(${v})`,children:a[1]})]})]})},(n,e)=>n.lineName.toString()===e.lineName.toString()&&n.foregroundColour===e.foregroundColour&&n.backgroundColour===e.backgroundColour&&n.passed===e.passed),ne=n=>{const e=n[0].match(/^(\d+)\D+$/);if(e)return[1,e[1]];const a=n.map(r=>r.match(/^(\w+).+$/));return a[0]&&a[1]&&a[0][1]===a[1][1]?[2,a[0][1]]:[3,""]},re=h.exports.memo(function(e){const{stnName:a,onUpdate:r}=e,s=h.exports.useRef(null);return h.exports.useEffect(()=>{s.current&&r&&r(s.current.getBBox())},[a.toString()]),d("g",{ref:s,children:[t("text",{className:"rmg-name__zh",fontSize:18,children:a[0]}),t("g",{fontSize:10.5,children:a[1].split("\\").map((o,i)=>t("text",{className:"rmg-name__en",dy:16+i*11,children:o},i))})]})},(n,e)=>n.stnName.toString()===e.stnName.toString());function se(n){const{stnName:e,onUpdate:a,passed:r,...s}=n,o=h.exports.useRef(null),[i,c]=h.exports.useState({x:0,width:0});return h.exports.useEffect(()=>{if(o.current){const m=o.current.getBBox();c(m),a&&a(m)}},[e.toString()]),d("g",{fill:r?"#aaa":"#000",...s,children:[d("g",{transform:"translate(0,3)",fontSize:18,children:[t("text",{textAnchor:"end",x:i.x-3,className:"rmg-name__zh",children:"("}),t("text",{textAnchor:"start",x:i.width+i.x+3,className:"rmg-name__zh",children:")"})]}),d("g",{ref:o,textAnchor:"middle",children:[t("text",{className:"rmg-name__zh",fontSize:13,children:e[0]}),t("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:e[1]})]})]})}function ae(n){const{passed:e,...a}=n;return d("g",{textAnchor:"middle",fill:e?"#aaa":"var(--rmg-theme-colour)",...a,children:[t("text",{className:"rmg-name__zh",fontSize:13,children:"\u5FEB\u8F66\u505C\u9760\u7AD9"}),t("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function oe(n){const{primaryName:e,secondaryName:a,stationState:r,flipped:s,express:o}=n,[i,c]=h.exports.useState({width:0}),[m,l]=h.exports.useState({x:0,width:-20}),p=N=>{switch(N){case T.PASSED:return"#aaa";case T.CURRENT:return"#f00";case T.FUTURE:return"#000"}},x=e[1].split("\\").length,g={g:{x:0,y:s?17.5:-20-x*14*Math.cos(-45)},StationSecondaryName:{x:(i.width+m.width/2+10)*(s?-1:1),y:2+5*(x-1)},ExpressTag:{x:(i.width+m.width+20+35)*(s?-1:1),y:2+5*(x-1)}};return d("g",{textAnchor:s?"end":"start",fill:p(r),transform:`translate(${g.g.x},${g.g.y})rotate(-45)`,children:[t(re,{stnName:e,onUpdate:c}),a&&t(se,{stnName:a,onUpdate:l,passed:r===T.PASSED,transform:`translate(${g.StationSecondaryName.x},${g.StationSecondaryName.y})`}),o&&t(ae,{passed:r===T.PASSED,transform:`translate(${g.ExpressTag.x},${g.ExpressTag.y})`})]})}const ie=n=>{const{stnId:e,stnState:a,stnY:r}=n,s=f(g=>g.param.theme),o=f(g=>g.param.line_name),i=f(g=>g.param.line_num),c=f(g=>g.param.stn_list[e]),m=c.parents.length===2||c.children.length===2,l=r>0||c.parents.indexOf(c.branch.left[1]||"")===1||c.children.indexOf(c.branch.right[1]||"")===1?180:0,p=c.name[1].split("\\").length,x=m?l===180?16+(p-1)*12*Math.cos(-45):-9:l===180?-6:(25+(p-1)*15)*Math.cos(-45);return d(R,{children:[t(ce,{intInfos:m?[[s[0],s[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)",...o]].concat(c.transfer.info[0]):c.transfer.info[0],stnState:a,tickRotation:l}),t(Z,{lineNum:i,stnNum:c.num,passed:a===-1}),t("g",{transform:`translate(${-x},0)`,children:t(oe,{primaryName:c.name,secondaryName:c.secondaryName||void 0,stationState:a,flipped:l===180,express:c.services.includes(X.express)})})]})},ce=n=>d(R,{children:[t(le,{strokeWidth:4,...n}),t(me,{transform:`translate(0,${n.tickRotation===180?-47:23})`,...n})]}),le=n=>{const{intInfos:e,stnState:a,tickRotation:r,...s}=n;return t("g",{...s,children:e.map((o,i)=>t("use",{xlinkHref:"#inttick",stroke:a===-1?"#aaa":o[2],transform:`translate(${-2*(e.length-1)+4*i},0)rotate(${r===180?180:0})`},i))})},me=n=>{const{intInfos:e,tickRotation:a,stnState:r,...s}=n;return t("g",{...s,children:e.map((o,i)=>t("g",{transform:`translate(0,${i*28*(a===180?-1:1)})`,children:t(F,{lineName:[o[4],o[5]],foregroundColour:o[3],backgroundColour:o[2],passed:r===-1})},i))})},C=(n,e)=>n[e].parents.length===2||n[e].children.length===2?.25:0,he=(n,e,a)=>{const r=y("linestart","lineend",e);if(r.nodes.includes(n))return y(r.nodes[1],n,e).len;{const s=a.filter(l=>l.includes(n))[0];let o=n;for(;!r.nodes.includes(o);)o=s[s.indexOf(o)-1];let i=n;for(;!r.nodes.includes(i);)i=s[s.indexOf(i)+1];const c=o==="linestart",m=i==="lineend";if(s.toString()===a[0].toString()){const l=[];return!c&&!m?(l[0]=y(r.nodes[1],o,e).len,l[1]=y(o,i,e).len,l[2]=y(o,n,e).len,l[3]=y(n,i,e).len):c?(l[0]=0,l[1]=y(r.nodes[1],i,e).len,l[2]=y(s[1],n,e).len,l[3]=y(n,i,e).len):(l[0]=y(r.nodes[1],o,e).len,l[1]=y(o,r.nodes.slice(-2)[0],e).len,l[2]=y(o,n,e).len,l[3]=y(n,s.slice(-2)[0],e).len),l[0]+l[2]*l[1]/(l[2]+l[3])}else if(!c&&!m){const l=[];return l[0]=y(r.nodes[1],o,e).len,l[1]=y(o,i,e).len,l[2]=y(o,n,e).len,l[3]=y(n,i,e).len,l[0]+l[2]*l[1]/(l[2]+l[3])}else return c?y(r.nodes[1],i,e).len-y(n,i,e).len:y(r.nodes[1],o,e).len+y(o,n,e).len}},de=()=>{const{branches:n,routes:e,depsStr:a}=f(z=>z.helper),{svgWidth:r,svg_height:s,y_pc:o,padding:i,branchSpacingPct:c,direction:m,line_name:l,current_stn_idx:p,stn_list:x}=f(z=>z.param),g=Y(x,C,C),N=h.exports.useMemo(()=>(console.log("computing x shares"),Object.keys(x).reduce((z,B)=>({...z,[B]:he(B,g,n)}),{})),[n.toString(),JSON.stringify(g)]),u=y("linestart","lineend",g),v=y(u.nodes[1],u.nodes.slice(-2)[0],g),_=m===S.right?[r[w.RailMap]*i/100+65,r[w.RailMap]*(1-i/100)-20]:[r[w.RailMap]*i/100,r[w.RailMap]*(1-i/100)-65],E=Object.keys(N).reduce((z,B)=>({...z,[B]:_[0]+N[B]/v.len*(_[1]-_[0])}),{}),I=h.exports.useMemo(()=>(console.log("computing y shares"),Object.keys(x).reduce((z,B)=>{if(n[0].includes(B))return{...z,[B]:0};{const b=n.slice(1).filter(U=>U.includes(B))[0];return{...z,[B]:x[b[0]].children.indexOf(b[1])?-2:2}}},{})),[a]),L=Object.keys(I).reduce((z,B)=>({...z,[B]:-I[B]*c*s/200}),{}),H=h.exports.useMemo(()=>J(p,e,m),[p,m,e.toString()]),M=n.map(z=>q(z,H)).reduce((z,B)=>(z.main.push(B.main),z.pass.push(B.pass),z),{main:[],pass:[]}),V=Object.keys(M).reduce((z,B)=>({...z,[B]:M[B].map(b=>xe(b,E,L))}),{});return d("g",{id:"main",style:{["--y-percentage"]:o,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[t(ge,{paths:V}),t(ue,{xs:E,ys:L,stnStates:H}),t("g",{id:"line_name",style:{["--translate-x"]:m===S.right?`${_[0]-65}px`:`${_[1]+65}px`},children:t(F,{lineName:l,foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)"})})]})},ge=h.exports.memo(function(e){return d("g",{fill:"none",strokeWidth:4,children:[t("g",{stroke:"#aaa",strokeDasharray:4,children:e.paths.pass.map((a,r)=>t("path",{d:a},r))}),t("g",{stroke:"var(--rmg-theme-colour)",children:e.paths.main.map((a,r)=>t("path",{d:a},r))})]})},(n,e)=>JSON.stringify(n.paths)===JSON.stringify(e.paths)),xe=(n,e,a)=>{let r;const s=[];return n.forEach(o=>{const i=e[o],c=a[o];if(!r&&r!==0){r=c,s.push(`M ${i},${c}`);return}c===0?(c<r&&s.push(`H ${i-40}`,"a 40,40 0 0,0 40,-40",`V ${c}`),c>r&&s.push(`H ${i-40}`,"a 40,40 0 0,1 40,40",`V ${c}`)):(c<r&&s.push(`V ${c+40}`,"a 40,40 0 0,1 40,-40",`H ${i}`),c>r&&s.push(`V ${c-40}`,"a 40,40 0 0,0 40,40",`H ${i}`)),s.push(`H ${i}`),r=c}),s.join(" ").replace(/( H ([\d.]+))+/g," H $2")},ue=n=>{const{xs:e,ys:a,stnStates:r}=n,s=f(o=>o.param.stn_list);return t("g",{id:"stn_icons",children:Object.keys(s).filter(o=>!["linestart","lineend"].includes(o)).map(o=>t("g",{style:{transform:`translate(${e[o]}px,${a[o]}px)`},children:t(ie,{stnId:o,stnState:r[o],stnY:a[o]})},o))})},W=w.RailMap,fe=()=>{const{canvasScale:n}=f(g=>g.app),{svgWidth:e,svg_height:a,direction:r,psd_num:s,info_panel_type:o,notesGZMTR:i,current_stn_idx:c,stn_list:m,theme:l}=f(g=>g.param),p=e[W],x=m[c];return d(O,{type:W,svgWidth:p,svgHeight:a,canvasScale:n,theme:l,children:[t(pe,{}),t(G,{variant:o,isShowLight:o===$.gz2otis,isShowPSD:o===$.gz2otis&&s}),r===S.left&&x.parents.includes("linestart")||r===S.right&&x.children.includes("lineend")?t(Ne,{}):d(R,{children:[t(de,{}),t(Se,{}),i.map((g,N)=>t(ze,{note:g},N))]}),o===$.gz2otis&&t("line",{x2:p,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},pe=h.exports.memo(function(){return d("defs",{children:[t("path",{id:"arrow_direction",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black"}),t("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"})]})}),Se=()=>{const{routes:n}=f(c=>c.helper),{direction:e,direction_gz_x:a,direction_gz_y:r,current_stn_idx:s}=f(c=>c.param),o=h.exports.useMemo(()=>[...new Set(n.reduce((c,m)=>m.includes(s)?c.concat(m.filter(l=>!["linestart","lineend"].includes(l)).slice(e===S.left?0:-1)[0]):c,[]).filter(c=>c!==s))],[s,e,n.toString()]),i={textAnchor:e===S.left?"start":"end",transform:`translate(${e===S.left?65:-65},-5)`,destIds:o};return d("g",{id:"direction_gz",style:{["--x-percentage"]:a,["--y-percentage"]:r},children:[t("use",{xlinkHref:"#arrow_direction",style:{["--rotate"]:e===S.left?"0deg":"180deg"}}),o.length!==2?t(_e,{...i}):t(ye,{...i})]})},_e=n=>{const{destIds:e,...a}=n,r=f(s=>s.param.stn_list);return d("g",{...a,children:[t("text",{className:"rmg-name__zh",fontSize:28,children:e.map(s=>r[s].name[0]).join("/")+"\u65B9\u5411"}),t("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+e.map(s=>r[s].name[1].replace("\\"," ")).join("/")})]})},ye=n=>{const{destIds:e,...a}=n,r=f(m=>m.param.direction),s=f(m=>m.param.stn_list),o=e.map(m=>s[m].name[0].length),i=Math.min(...o),c=i>1&&o[0]!==o[1]?Math.abs(o[0]-o[1])/(i-1):0;return d("g",{...a,children:[e.map((m,l)=>d(h.exports.Fragment,{children:[t("text",{className:"rmg-name__zh",fontSize:25,x:r===S.left?0:-75,y:-21+42*l,letterSpacing:o[l]>o[1-l]?"0em":`${c}em`,children:s[m].name[0]}),t("text",{className:"rmg-name__en",fontSize:11.5,x:r===S.left?0:-75,y:-1+42*l,children:"Towards "+s[m].name[1].replace("\\"," ")})]},m)),t("text",{className:"rmg-name__zh",fontSize:28,x:r===S.left?25*(Math.max(...o)+1):0,y:5,children:"\u65B9\u5411"})]})},Ne=h.exports.memo(function(){return d("g",{id:"terminus_gz",textAnchor:"middle",children:[t("text",{className:"rmg-name__zh",fontSize:90,children:"\u7EC8 \u70B9 \u7AD9"}),t("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),d("g",{strokeWidth:8,stroke:"#000",children:[t("path",{d:"M -160,68 h -160"}),t("path",{d:"M 160,68 h 160"})]})]})}),ze=h.exports.memo(function(e){const a=h.exports.useRef(null),[r,s]=h.exports.useState({width:0,height:0,y:0});return h.exports.useEffect(()=>{a.current&&s(a.current.getBBox())},[e.note[0],e.note[1]]),d("g",{className:"note-box",style:{["--x-percentage"]:e.note[2],["--y-percentage"]:e.note[3]},children:[e.note[4]&&t("rect",{height:r.height+4,width:r.width+4,x:-2,y:r.y-2,fill:"none",stroke:"black",strokeWidth:.5}),d("g",{ref:a,children:[t("g",{fontSize:16,letterSpacing:1.2,children:e.note[0].split(`
`).map((o,i)=>t("text",{className:"rmg-name__zh",y:i*18,children:o},i))}),t("g",{fontSize:10,letterSpacing:.33,transform:`translate(0,${18*e.note[0].split(`
`).length})`,children:e.note[1].split(`
`).map((o,i)=>{var c;return t("text",{className:"rmg-name__en",y:i*11,textLength:i<(((c=e.note[1].match(/\n/g))==null?void 0:c.length)||0)?r.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:o},i)})})]})]})},(n,e)=>n.note.toString()===e.note.toString()),Be=h.exports.memo(function(e){const{stnName:a,onUpdate:r}=e,s=h.exports.useRef(null);return h.exports.useEffect(()=>{s.current&&r&&r(s.current.getBBox())},[a.toString()]),d("g",{ref:s,children:[t("text",{className:"rmg-name__zh",fontSize:90,children:a[0]}),t("g",{fontSize:36,children:a[1].split("\\").map((o,i)=>t("text",{className:"rmg-name__en",dy:70+i*36,children:o},i))})]})},(n,e)=>n.stnName.toString()===e.stnName.toString()),we=n=>{const{secondaryName:e,transform:a}=n,r=h.exports.useRef(null),[s,o]=h.exports.useState({x:0,width:0});return h.exports.useEffect(()=>{r.current&&o(r.current.getBBox())},[e.toString()]),d("g",{transform:a,children:[d("g",{transform:"translate(0,4.5)",fontSize:36,children:[t("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),t("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),d("g",{ref:r,textAnchor:"middle",children:[t("text",{className:"rmg-name__zh",fontSize:26,children:e[0]}),t("text",{dy:22,className:"rmg-name__en",fontSize:14,children:e[1]})]})]})},ve=()=>{const n=f(g=>g.param.svg_height),e=f(g=>g.param.svgWidth),a=f(g=>g.param.direction),r=f(g=>g.param.info_panel_type),s=f(g=>g.param.line_num),o=f(g=>g.param.current_stn_idx),i=f(g=>g.param.stn_list[o]),[c,m]=h.exports.useState({width:0}),l=i[a===S.left?"parents":"children"],p={name:`translate(${(a===S.left?1:-1)*e[w.RunIn]/4},45)`,next:`translate(${(a===S.left?1:-1)*e[w.RunIn]/10},45)`},x={nameGroup:{x:e.runin/2,y:.5*n-50-(i.name[1].split("\\").length-1)*18-(i.secondaryName?29:0)},secondaryName:{x:0,y:70+i.name[1].split("\\").length*36}};return d("g",{children:[d("g",{transform:r===$.gz2otis?p.name:"",children:[d("g",{textAnchor:"middle",transform:`translate(${x.nameGroup.x},${x.nameGroup.y})`,children:[t(Be,{stnName:i.name,onUpdate:m}),i.secondaryName&&t(we,{secondaryName:i.secondaryName,transform:`translate(${x.secondaryName.x},${x.secondaryName.y})`})]}),t(Z,{lineNum:s,stnNum:i.num,style:{["--translate-x"]:`${(e[w.RunIn]+c.width)/2+55}px`,["--translate-y"]:`${.5*n-30-(i.name[1].split("\\").length-1)*18-(i.secondaryName?58/2:0)}px`,transform:"translate(var(--translate-x, 800px), var(--translate-y, 145px))"},large:!0})]}),t("g",{transform:r===$.gz2otis?p.next:"",children:!l||l.includes("linestart")||l.includes("lineend")?t(R,{}):l.length===1?t($e,{nextId:l[0],nameBBox:c}):t(Ee,{nextIds:l,nameBBox:c})})]})},$e=n=>{const{nextId:e,nameBBox:a}=n,r=f(N=>N.param.svgWidth),s=f(N=>N.param.direction),o=f(N=>N.param.stn_list[e]),{name:i,secondaryName:c}=o,[m,l]=h.exports.useState({width:0}),p=h.exports.useRef(null);h.exports.useEffect(()=>{p.current&&l(p.current.getBBox())},[i.toString()]);const x=i[0].length,g=(r[w.RunIn]-a.width)/2;return d(R,{children:[d("g",{id:"big_next",children:[d("g",{textAnchor:"middle",style:{["--translate-x"]:s===S.left?"80px":x<=2?`${r[w.RunIn]-45-m.width-70}px`:`${r[w.RunIn]-45-m.width-35*1.5}px`},children:[t("text",{className:"rmg-name__zh",fontSize:35,children:"\u4E0B\u7AD9"}),t("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),d("g",{textAnchor:"start",ref:p,style:{["--translate-x"]:s===S.left?x<=2?`${115+35}px`:`${115+35/2}px`:`${r[w.RunIn]-45-m.width}px`},children:[t("text",{className:"rmg-name__zh",fontSize:35,children:i[0]}),t("g",{fontSize:17,children:i[1].split("\\").map((N,u)=>t("text",{className:"rmg-name__en",dy:30+u*17,children:N},u))})]}),c&&t("g",{textAnchor:"middle",style:{["--translate-x"]:s===S.left?x<=2?`${115+35}px`:`${115+35/2}px`:`${r[w.RunIn]-45-m.width}px`},children:t(Re,{secName:c,transform:`translate(${m.width/2},${30+i[1].split("\\").length*17+5})`})})]}),t("path",{id:"arrow",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black",style:{["--translate-x"]:s===S.left?`${(115+35*((x<=2?1:.5)+x)+g)/2-20}px`:`${(r[w.RunIn]-45-m.width-(x<=2?70+35:35*2.5)+g+n.nameBBox.width+55+18.5*1.4)/2+20}px`,["--rotate"]:s===S.left?"0deg":"180deg"}})]})},Re=n=>{const{secName:e,...a}=n,r=h.exports.useRef(null),[s,o]=h.exports.useState({x:0,width:0});return h.exports.useEffect(()=>{r.current&&o(r.current.getBBox())},[n.secName.toString()]),d("g",{...a,children:[d("g",{transform:"translate(0,2.5)",fontSize:25,children:[t("text",{textAnchor:"end",x:s.x-3,className:"rmg-name__zh",children:"("}),t("text",{textAnchor:"start",x:s.width+s.x+3,className:"rmg-name__zh",children:")"})]}),d("g",{ref:r,children:[t("text",{className:"rmg-name__zh",fontSize:18,children:e[0]}),t("text",{className:"rmg-name__en",fontSize:10,dy:15,children:e[1]})]})]})},Ee=n=>{const{nextIds:e,nameBBox:a}=n,{routes:r}=f(u=>u.helper),s=f(u=>u.param.svgWidth),o=f(u=>u.param.direction),i=f(u=>u.param.stn_list),c=e.map(u=>i[u].name),[m,l]=h.exports.useState({width:0}),p=h.exports.useRef([]);h.exports.useEffect(()=>{l(u=>({...u,width:0})),p.current.forEach(u=>{const v=u==null?void 0:u.getBBox();l(_=>v?_.width>v.width?_:v:_)})},[c.toString()]);const x=n.nextIds.map(u=>r.reduce((v,_)=>_.includes(u)?v.concat(_.filter(E=>!["linestart","lineend"].includes(E)).slice(o===S.left?0:-1)[0]):v,[])),g=Math.max(...c.map(u=>u[0].length)),N=(s[w.RunIn]-a.width)/2;return d(R,{children:[t("g",{id:"big_next_2",children:c.map((u,v)=>d(h.exports.Fragment,{children:[d("g",{textAnchor:"middle",style:{["--translate-x"]:o===S.left?"72px":`${s[w.RunIn]-45-m.width-41}px`},children:[t("text",{className:"rmg-name__zh",children:"\u4E0B\u7AD9"}),t("text",{className:"rmg-name__en",y:22,children:"Next"})]}),d("g",{ref:_=>p.current[v]=_,textAnchor:"start",style:{["--translate-x"]:o===S.left?"113px":`${s[w.RunIn]-45-m.width}px`},children:[t("text",{className:"rmg-name__zh",children:u[0]}),u[1].split("\\").map((_,E)=>t("text",{className:"rmg-name__en",y:22+E*13,children:_},E)),t("text",{className:"rmg-name__zh",y:-35,children:x[v].map(_=>i[_].name[0]).join("/")+"\u65B9\u5411"}),t("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+x[v].map(_=>i[_].name[1]).join("/").replace("\\"," ")})]})]},v))}),t("path",{id:"arrow",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black",style:{["--translate-x"]:o===S.left?`${(99+27*(1+g)+N)/2-20}px`:`${(s[w.RunIn]-45-m.width-41-27+N+n.nameBBox.width+55+18.5*1.4)/2+20}px`,["--rotate"]:o===S.left?"0deg":"180deg"}})]})};function ke(n){const{num:e,...a}=n;return d("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...a,children:[t("circle",{cx:0,cy:0,r:30,fill:"var(--rmg-theme-colour)"}),t("text",{className:"rmg-name__en",fontSize:38,dy:-9.5,children:e}),t("text",{className:"rmg-name__zh",fontSize:13,dy:10,children:"\u7AD9\u53F0"}),t("text",{className:"rmg-name__en",fontSize:9,dy:21,children:"Platform"})]})}function Te(n){const{canvasType:e}=n,{svgWidth:a,svg_height:r}=f(s=>s.param);return d("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[t("line",{y2:r,transform:`translate(${a[e]/2},0)`}),t("line",{x2:a[e],transform:"translate(0,90)"})]})}const D=w.RunIn;function be(){const{canvasScale:n}=f(p=>p.app),{svgWidth:e,svg_height:a,direction:r,info_panel_type:s,platform_num:o,psd_num:i,theme:c}=f(p=>p.param),m=e[D],l={platform:`translate(${r===S.left?50:-50},45)`};return d(O,{type:D,svgWidth:m,svgHeight:a,canvasScale:n,theme:c,children:[t(G,{variant:s,isShowLight:s!==$.gz2otis,isShowPSD:s!==$.gz2otis&&i}),t("g",{transform:s===$.gz2otis?l.platform:"",children:t(ke,{num:o,style:{["--translate-x"]:`${r===S.left?m-100:100}px`,["--translate-y"]:"calc(var(--rmg-svg-height) / 2 - 30px)",transform:"translate(var(--translate-x, 100px), var(--translate-y))"}})}),t(ve,{}),s===$.gz2otis&&t(Te,{canvasType:D})]})}const Le={runin:t(be,{}),railmap:t(fe,{})};export{Le as default};
