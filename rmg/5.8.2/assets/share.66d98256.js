var O=Object.defineProperty;var P=(l,e,t)=>e in l?O(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var c=(l,e,t)=>(P(l,typeof e!="symbol"?e+"":e,t),t);import{j as T,l as m}from"./vendor.75c64018.js";import{S as W}from"./index.194ced85.js";function Y(l){const{type:e,svgWidth:t,svgHeight:i,canvasScale:r,theme:s,children:n}=l;return T("svg",{id:e,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",height:i*r,viewBox:`0 0 ${t} ${i}`,colorInterpolationFilters:"sRGB",style:{["--rmg-svg-width"]:t+"px",["--rmg-svg-height"]:i+"px",["--rmg-theme-colour"]:s[2],["--rmg-theme-fg"]:s[3]},children:[m("rect",{id:"canvas-bg",fill:"white",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}}),n,m("rect",{id:"canvas-border",fill:"none",strokeWidth:3,stroke:"none",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}})]})}const q=(l,e,t)=>Object.keys(l).reduce((i,r)=>({...i,[r]:l[r].children.reduce((s,n)=>({...s,[n]:1+e(l,n)+t(l,r)}),{})}),{}),a=(l,e,t)=>{if(l===e)return{len:0,nodes:[l]};let i=[],r=[];Object.keys(t[l]).forEach(n=>{let f=a(n,e,t);f.len<0||(i.push(t[l][n]+f.len),f.nodes.unshift(l),r.push(f.nodes))});let s=Math.max(...i);return{len:s,nodes:r[i.indexOf(s)]}},B=(l,e,t)=>{let i=a("linestart","lineend",e);if(i.nodes.includes(l))return a(i.nodes[1],l,e).len;{let r=t.filter(p=>p.includes(l))[0],s=l;for(;!i.nodes.includes(s);)s=r[r.indexOf(s)-1];let n=l;for(;!i.nodes.includes(n);)n=r[r.indexOf(n)+1];let f=s==="linestart",S=n==="lineend",h=[];return!f&&!S?(h[0]=a(i.nodes[1],s,e).len,h[1]=a(s,n,e).len,h[2]=a(s,l,e).len,h[3]=a(l,n,e).len):f?(h[0]=0,h[1]=a(i.nodes[1],n,e).len,h[2]=a(r[1],l,e).len,h[3]=a(l,n,e).len):(h[0]=a(i.nodes[1],s,e).len,h[1]=a(s,i.nodes.slice(-2)[0],e).len,h[2]=a(s,l,e).len,h[3]=a(l,r.slice(-2)[0],e).len),h[0]+h[2]*h[1]/(h[2]+h[3])}},k=(l,e,t)=>{for(let i of t){let r=i.indexOf(l),s=i.indexOf(e);if(s!==-1&&s<r)return!0}return!1},E=(l,e,t)=>{for(let i of t){let r=i.indexOf(l),s=i.indexOf(e);if(r!==-1&&r<s)return!0}return!1},D=(l,e,t)=>(console.log("computing stations' states"),[...new Set([].concat(...e))].reduce((i,r)=>({...i,[r]:r===l?0:(t===W.right?E(l,r,e):k(l,r,e))?1:-1}),{}));class G{constructor(e){c(this,"yShares",{});c(this,"xShares",{});c(this,"namePoss",{});c(this,"stnList",{});c(this,"criticalPath",{});c(this,"leftWideFactor",e=>0);c(this,"rightWideFactor",e=>0);c(this,"pathTurnParams",e=>{let t=35,i=t/2,r=t-i*Math.sqrt(3),s=e-2*r,n=s*Math.sqrt(3);return{tr:t,dx_a:i,dy_a:r,dx_l:n,dy_l:s}});c(this,"pathTurnSE",e=>{let{tr:t,dx_a:i,dy_a:r,dx_l:s,dy_l:n}=this.pathTurnParams(e);return`a ${t},${t} 0 0,1 ${i},${r} l ${s},${n} a ${t},${t} 0 0,0 ${i},${r}`});c(this,"pathTurnNE",e=>{let{tr:t,dx_a:i,dy_a:r,dx_l:s,dy_l:n}=this.pathTurnParams(e);return`a ${t},${t} 0 0,0 ${i},${-r} l ${s},${-n} a ${t},${t} 0 0,1 ${i},${-r}`});this.stnList=e.stnList,this.criticalPath=e.criticalPath}getYShare(e,t){if(e in this.yShares)return this.yShares[e];if(["linestart","lineend"].includes(e)||this.stnList[e].parents.length>1||this.stnList[e].children.length>1)return this.yShares[e]=0,0;var i=this.stnList[e].parents[0];if(i)if(this.stnList[i].children.length===1){let r=this.getYShare(i);return this.yShares[e]=r,r}else{let r=this.stnList[i].children.indexOf(e)===0?1:-1;return this.yShares[e]=r,r}else return this.yShares[e]=0,0}static getYShares(e,t){console.log("computing y shares");let i=new this({stnList:e});return Object.keys(e).forEach(r=>{["linestart","lineend"].includes(r)||r in i.yShares||i.getYShare(r,t)}),i.yShares}_linePath(e,t,i,r,s,n,f,S){var[h,p,v]=[],o=[];let{dx_a:w,dx_l:_}=this.pathTurnParams(n),y=w+_/2,$=(t[1]-t[0])/f.len*2,x=((t[1]-t[0])/f.len-2*y)/2;return x+$<0&&console.warn(`SVG width too small! ${x+$}`),e.forEach(d=>{let g=r[d],u=s[d];if(!p&&p!==0){[h,v,p]=[d,g,u],e.length===1?o.push(`M ${g},${u}`):i[0].includes(d)?i[0].includes(e[1])?o.push(`M ${g},${u}`):(r[e[1]]>0&&o.push(`M ${g},${u+S}`),s[e[1]]<0&&o.push(`M ${g},${u-S}`)):o.push(`M ${g},${u}`);return}u>p?(o.push(u===0?`h ${g-v-$*this.leftWideFactor(d)-x-y*2}`:`h ${$*this.rightWideFactor(h)+x}`),o.push(this.pathTurnSE(n))):u<p&&(o.push(u===0?`h ${g-v-$*this.leftWideFactor(d)-x-y*2}`:`h ${$*this.rightWideFactor(h)+x}`),o.push(this.pathTurnNE(n))),o.push(`H ${g}`),[h,v,p]=[d,g,u]}),o.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}const J=(l,e)=>{l=l.filter(r=>!["linestart","lineend"].includes(r));let t=l.filter(r=>e[r]>=0),i=l.filter(r=>e[r]<=0);return t.length===1&&(i=l),t.filter(r=>i.indexOf(r)!==-1).length===0&&t.length&&(i[0]===l[0]?i.push(t[0]):t[0]===l[0]&&t[t.length-1]===l[l.length-1]&&i.length?(i=l,t=[]):i.unshift(t[t.length-1])),{main:t,pass:i}};export{Y as S,q as a,D as b,a as c,G as d,J as e,B as g};
