import{j as h,M as G,l as e,b1 as $,ab as E,z as g}from"./vendor.75c64018.js";import{as as b,u as f,j as J,S,aq as w,P as R}from"./index.194ced85.js";import{a as q,c as _,b as K,e as Q,S as F}from"./share.66d98256.js";function j(n){const{num:t,inStrip:r,...s}=n;return h("g",{textAnchor:"middle",fill:r?G.black:"var(--rmg-theme-fg)",...s,children:[e("rect",{height:40,width:40,rx:4,x:-20,fill:r?"#fff":"var(--rmg-theme-colour)"}),e("text",{className:"rmg-name__en",fontSize:20,dy:12,children:t}),e("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"\u5C4F\u853D\u95E8"}),e("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]})}const Z=n=>{const t=(a=>{switch(a){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":return 20;default:return 0}})(n.variant),r=$.useMemo(()=>{switch(n.variant){case"gz1":return e("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return e("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return e("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return e("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return e("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return e("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return e("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return e("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});default:return e(E,{})}},[n.variant]),s=-20;return h("g",{transform:`translate(0,${n.variant==="gz4"?s:0})`,children:[e("rect",{id:"strip_gz",style:{["--height"]:`${t}px`}}),e("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:n.isShowLight&&r}),n.isShowPSD!==!1&&e(ee,{...n})]})},ee=$.memo(n=>{const t=["gz28","gz2otis","gz6","gzgf"].includes(n.variant),r=(s=>{switch(s){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";default:return"58px"}})(n.variant);return e(j,{num:n.isShowPSD,inStrip:t,style:{["--psd-dy"]:r,transform:"translate(var(--translate-x), var(--translate-y))",["--translate-x"]:"calc(var(--rmg-svg-width) / 2 + 80px)",["--translate-y"]:"calc(var(--rmg-svg-height) - var(--psd-dy, 58px))"}})},(n,t)=>n.variant===t.variant&&n.isShowPSD===t.isShowPSD),te=g.exports.memo(function(t){const{passed:r,large:s}=t;return e("path",{d:s?"M0,12.95 V-12.95 H-12.95 a12.95,12.95 0 0,0 0,25.9 h25.9 a12.95,12.95 0 0,0 0,-25.9 H0":"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0",fill:"#fff",strokeWidth:2,stroke:r?"#aaa":"var(--rmg-theme-colour)"})},(n,t)=>n.passed===t.passed&&n.large===t.large),I=15;function V(n){const{lineNum:t,stnNum:r,passed:s,large:a,...i}=n,o=g.exports.useRef(null),c=g.exports.useRef(null),[m,l]=g.exports.useState({width:0}),[p,x]=g.exports.useState({width:0});g.exports.useEffect(()=>{l(o.current.getBBox()),x(c.current.getBBox())},[t,r]);const d=I/Math.max(I,m.width),y=t.length===2&&r.length===2?d:I/Math.max(I,p.width);return h("g",{...i,children:[e(te,{passed:s,large:a}),h("g",{textAnchor:"middle",fontSize:13.5,transform:a?"scale(1.4)":"",fill:s?"#aaa":"#000",children:[e("g",{transform:`translate(-9.25,0)scale(${d})`,children:e("text",{ref:o,className:"rmg-name__zh",children:t})}),e("g",{transform:`translate(9.25,0)scale(${y})`,children:e("text",{ref:c,className:"rmg-name__zh",children:r})})]})]})}const ne=g.exports.memo(function(t){const{lineName:r,commonPart:s}=t,a=g.exports.useRef(null),[i,o]=g.exports.useState({x:0,height:0,width:0});g.exports.useEffect(()=>{a.current&&o(a.current.getBBox())},[r.toString()]);const c=T/Math.max(T,i.width),m=(-i.x-i.width/2)*c,l=i.height*(1-c)*1.2/2;return e("g",{ref:a,transform:`translate(${m},${l})scale(${c})`,children:h("text",{className:"rmg-name__zh",fontSize:14,y:12,textAnchor:"end",children:[s,e("tspan",{className:"rmg-name__zh",fontSize:8,x:0,dy:-2,textAnchor:"start",children:r[0].slice(s.length).trim()}),e("tspan",{className:"rmg-name__en",fontSize:4,x:0,dy:6,textAnchor:"start",children:r[1].slice(s.length).trim()})]})})},(n,t)=>n.lineName.toString()===t.lineName.toString());function re(n){return e("rect",{x:-22.5,height:24,width:45,rx:4.5,...n})}const T=42,X=g.exports.memo(function(t){const{lineName:r,foregroundColour:s,backgroundColour:a,passed:i}=t,[o,c]=se(r),m=g.exports.useRef(null),l=g.exports.useRef(null),[p,x]=g.exports.useState({width:0}),[d,y]=g.exports.useState({width:0});g.exports.useEffect(()=>{m.current&&x(m.current.getBBox()),l.current&&y(l.current.getBBox())},[r.toString()]);const u=T/Math.max(T,p.width),v=T/Math.max(T,d.width);return h("g",{textAnchor:"middle",fill:i?G.white:s,children:[e(re,{fill:i?"#aaa":a}),o===2?e(ne,{lineName:r,commonPart:c}):h(E,{children:[e("text",{ref:m,y:W(o,"zh",u),className:"rmg-name__zh",fontSize:12,transform:`scale(${u})`,children:o===1?h(E,{children:[e("tspan",{fontSize:16,dy:.7,className:"rmg-name__zh",children:c}),e("tspan",{dy:-.7,className:"rmg-name__zh",children:r[0].slice(c.length)})]}):r[0]}),e("text",{ref:l,y:W(o,"en",v),className:"rmg-name__en",fontSize:8,transform:`scale(${v})`,children:r[1]})]})]})},(n,t)=>n.lineName.toString()===t.lineName.toString()&&n.foregroundColour===t.foregroundColour&&n.backgroundColour===t.backgroundColour&&n.passed===t.passed),se=n=>{const t=n[0].match(/^(\d+)\D+$/);if(t)return[1,t[1]];const r=n.map(s=>s.match(/^([\w\d]+).+$/));return r[0]&&r[1]&&r[0][1]===r[1][1]?[2,r[0][1]]:[3,""]},W=(n,t,r)=>{switch(n){case 1:return(t==="zh"?7.3:19.5)*(1+1-r);case 2:return 0;case 3:return t==="zh"?8*(2-r):19.5+19.5*(19.5/8)*(1-r)-(r===1?0:5.5)}},ae=g.exports.memo(function(t){const{stnName:r,onUpdate:s}=t,a=g.exports.useRef(null);return g.exports.useEffect(()=>{s&&s(a.current.getBBox())},[r.toString()]),h("g",{ref:a,children:[e("text",{className:"rmg-name__zh",fontSize:18,children:r[0]}),e("g",{fontSize:10.5,children:r[1].split("\\").map((i,o)=>e("text",{className:"rmg-name__en",dy:16+o*11,children:i},o))})]})},(n,t)=>n.stnName.toString()===t.stnName.toString());function ie(n){const{stnName:t,onUpdate:r,passed:s,...a}=n,i=g.exports.useRef(null),[o,c]=g.exports.useState({x:0,width:0});return g.exports.useEffect(()=>{const m=i.current.getBBox();c(m),r&&r(m)},[t.toString()]),h("g",{fill:s?"#aaa":"#000",...a,children:[h("g",{transform:"translate(0,3)",fontSize:18,children:[e("text",{textAnchor:"end",x:o.x-3,className:"rmg-name__zh",children:"("}),e("text",{textAnchor:"start",x:o.width+o.x+3,className:"rmg-name__zh",children:")"})]}),h("g",{ref:i,textAnchor:"middle",children:[e("text",{className:"rmg-name__zh",fontSize:13,children:t[0]}),e("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:t[1]})]})]})}function oe(n){const{passed:t,...r}=n;return h("g",{textAnchor:"middle",fill:t?"#aaa":"var(--rmg-theme-colour)",...r,children:[e("text",{className:"rmg-name__zh",fontSize:13,children:"\u5FEB\u8F66\u505C\u9760\u7AD9"}),e("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]})}function ce(n){const{primaryName:t,secondaryName:r,stationState:s,flipped:a,express:i}=n,[o,c]=g.exports.useState({width:0}),[m,l]=g.exports.useState({x:0,width:-20}),p=y=>{switch(y){case b.PASSED:return"#aaa";case b.CURRENT:return"#f00";case b.FUTURE:return"#000"}},x=t[1].split("\\").length,d={g:{x:0,y:a?17.5:-20-x*14*Math.cos(-45)},StationSecondaryName:{x:(o.width+m.width/2+10)*(a?-1:1),y:2+5*(x-1)},ExpressTag:{x:(o.width+m.width+20+35)*(a?-1:1),y:2+5*(x-1)}};return h("g",{textAnchor:a?"end":"start",fill:p(s),transform:`translate(${d.g.x},${d.g.y})rotate(-45)`,children:[e(ae,{stnName:t,onUpdate:c}),r&&e(ie,{stnName:r,onUpdate:l,passed:s===b.PASSED,transform:`translate(${d.StationSecondaryName.x},${d.StationSecondaryName.y})`}),i&&e(oe,{passed:s===b.PASSED,transform:`translate(${d.ExpressTag.x},${d.ExpressTag.y})`})]})}const le=n=>{const{stnId:t,stnState:r,stnY:s}=n,a=f(d=>d.param.theme),i=f(d=>d.param.line_name),o=f(d=>d.param.line_num),c=f(d=>d.param.stn_list[t]),m=c.parents.length===2||c.children.length===2,l=s>0||c.parents.indexOf(c.branch.left[1]||"")===1||c.children.indexOf(c.branch.right[1]||"")===1?180:0,p=c.name[1].split("\\").length,x=m?l===180?16+(p-1)*12*Math.cos(-45):-9:l===180?-6:(25+(p-1)*15)*Math.cos(-45);return h(E,{children:[e(me,{intInfos:m?[[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)",...i]].concat(c.transfer.info[0]):c.transfer.info[0],stnState:r,tickRotation:l}),e(V,{lineNum:o,stnNum:c.num,passed:r===-1}),e("g",{transform:`translate(${-x},0)`,children:e(ce,{primaryName:c.name,secondaryName:c.secondaryName||void 0,stationState:r,flipped:l===180,express:c.services.includes(J.express)})})]})},me=n=>h(E,{children:[e(he,{strokeWidth:4,...n}),e(de,{transform:`translate(0,${n.tickRotation===180?-47:23})`,...n})]}),he=n=>{const{intInfos:t,stnState:r,tickRotation:s,...a}=n;return e("g",{...a,children:t.map((i,o)=>e("use",{xlinkHref:"#inttick",stroke:r===-1?"#aaa":i[2],transform:`translate(${-2*(t.length-1)+4*o},0)rotate(${s===180?180:0})`},o))})},de=n=>{const{intInfos:t,tickRotation:r,stnState:s,...a}=n;return e("g",{...a,children:t.map((i,o)=>e("g",{transform:`translate(0,${o*28*(r===180?-1:1)})`,children:e(X,{lineName:[i[4],i[5]],foregroundColour:i[3],backgroundColour:i[2],passed:s===-1})},o))})},P=(n,t)=>n[t].parents.length===2||n[t].children.length===2?.25:0,ge=(n,t,r)=>{let s=_("linestart","lineend",t);if(s.nodes.includes(n))return _(s.nodes[1],n,t).len;{let a=r.filter(l=>l.includes(n))[0],i=n;for(;!s.nodes.includes(i);)i=a[a.indexOf(i)-1];let o=n;for(;!s.nodes.includes(o);)o=a[a.indexOf(o)+1];let c=i==="linestart",m=o==="lineend";if(a.toString()===r[0].toString()){let l=[];return!c&&!m?(l[0]=_(s.nodes[1],i,t).len,l[1]=_(i,o,t).len,l[2]=_(i,n,t).len,l[3]=_(n,o,t).len):c?(l[0]=0,l[1]=_(s.nodes[1],o,t).len,l[2]=_(a[1],n,t).len,l[3]=_(n,o,t).len):(l[0]=_(s.nodes[1],i,t).len,l[1]=_(i,s.nodes.slice(-2)[0],t).len,l[2]=_(i,n,t).len,l[3]=_(n,a.slice(-2)[0],t).len),l[0]+l[2]*l[1]/(l[2]+l[3])}else if(!c&&!m){let l=[];return l[0]=_(s.nodes[1],i,t).len,l[1]=_(i,o,t).len,l[2]=_(i,n,t).len,l[3]=_(n,o,t).len,l[0]+l[2]*l[1]/(l[2]+l[3])}else return c?_(s.nodes[1],o,t).len-_(n,o,t).len:_(s.nodes[1],i,t).len+_(i,n,t).len}},xe=()=>{const{branches:n,routes:t,depsStr:r}=f(z=>z.helper),{svgWidth:s,svg_height:a,y_pc:i,padding:o,branchSpacingPct:c,direction:m,line_name:l,current_stn_idx:p,stn_list:x}=f(z=>z.param),d=q(x,P,P),y=g.exports.useMemo(()=>(console.log("computing x shares"),Object.keys(x).reduce((z,B)=>({...z,[B]:ge(B,d,n)}),{})),[n.toString(),JSON.stringify(d)]),u=_("linestart","lineend",d),v=_(u.nodes[1],u.nodes.slice(-2)[0],d),N=m===S.right?[s[w.RailMap]*o/100+65,s[w.RailMap]*(1-o/100)-20]:[s[w.RailMap]*o/100,s[w.RailMap]*(1-o/100)-65],k=Object.keys(y).reduce((z,B)=>({...z,[B]:N[0]+y[B]/v.len*(N[1]-N[0])}),{}),H=g.exports.useMemo(()=>(console.log("computing y shares"),Object.keys(x).reduce((z,B)=>{if(n[0].includes(B))return{...z,[B]:0};{let A=n.slice(1).filter(U=>U.includes(B))[0];return{...z,[B]:x[A[0]].children.indexOf(A[1])?-2:2}}},{})),[r]),L=Object.keys(H).reduce((z,B)=>({...z,[B]:-H[B]*c*a/200}),{}),M=g.exports.useMemo(()=>K(p,t,m),[p,m,t.toString()]),C=n.map(z=>Q(z,M)).reduce((z,B)=>(z.main.push(B.main),z.pass.push(B.pass),z),{main:[],pass:[]}),Y=Object.keys(C).reduce((z,B)=>({...z,[B]:C[B].map(A=>fe(A,k,L))}),{});return h("g",{id:"main",style:{["--y-percentage"]:i,transform:"translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"},children:[e(ue,{paths:Y}),e(pe,{xs:k,ys:L,stnStates:M}),e("g",{id:"line_name",style:{["--translate-x"]:m===S.right?`${N[0]-65}px`:`${N[1]+65}px`},children:e(X,{lineName:l,foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)"})})]})},ue=$.memo(n=>h("g",{fill:"none",strokeWidth:4,children:[e("g",{stroke:"#aaa",strokeDasharray:4,children:n.paths.pass.map((t,r)=>e("path",{d:t},r))}),e("g",{stroke:"var(--rmg-theme-colour)",children:n.paths.main.map((t,r)=>e("path",{d:t},r))})]}),(n,t)=>JSON.stringify(n.paths)===JSON.stringify(t.paths)),fe=(n,t,r)=>{let s;var a=[];return n.forEach(i=>{let o=t[i],c=r[i];if(!s&&s!==0){s=c,a.push(`M ${o},${c}`);return}c===0?(c<s&&a.push(`H ${o-40}`,"a 40,40 0 0,0 40,-40",`V ${c}`),c>s&&a.push(`H ${o-40}`,"a 40,40 0 0,1 40,40",`V ${c}`)):(c<s&&a.push(`V ${c+40}`,"a 40,40 0 0,1 40,-40",`H ${o}`),c>s&&a.push(`V ${c-40}`,"a 40,40 0 0,0 40,40",`H ${o}`)),a.push(`H ${o}`),s=c}),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},pe=n=>{const{xs:t,ys:r,stnStates:s}=n,a=f(i=>i.param.stn_list);return e("g",{id:"stn_icons",children:Object.keys(a).filter(i=>!["linestart","lineend"].includes(i)).map(i=>e("g",{style:{transform:`translate(${t[i]}px,${r[i]}px)`},children:e(le,{stnId:i,stnState:s[i],stnY:r[i]})},i))})},O=w.RailMap,Se=()=>{const{canvasScale:n}=f(d=>d.app),{svgWidth:t,svg_height:r,direction:s,psd_num:a,info_panel_type:i,notesGZMTR:o,current_stn_idx:c,stn_list:m,theme:l}=f(d=>d.param),p=t[O],x=m[c];return h(F,{type:O,svgWidth:p,svgHeight:r,canvasScale:n,theme:l,children:[e(_e,{}),e(Z,{variant:i,isShowLight:i===R.gz2otis,isShowPSD:i===R.gz2otis&&a}),s===S.left&&x.parents.includes("linestart")||s===S.right&&x.children.includes("lineend")?e(Be,{}):h(E,{children:[e(xe,{}),e(ye,{}),o.map((d,y)=>e(we,{note:d},y))]}),i===R.gz2otis&&e("line",{x2:p,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},_e=g.exports.memo(()=>h("defs",{children:[e("path",{id:"arrow_direction",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black"}),e("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"})]})),ye=()=>{const{routes:n}=f(c=>c.helper),{direction:t,direction_gz_x:r,direction_gz_y:s,current_stn_idx:a}=f(c=>c.param),i=g.exports.useMemo(()=>[...new Set(n.reduce((c,m)=>m.includes(a)?c.concat(m.filter(l=>!["linestart","lineend"].includes(l)).slice(t===S.left?0:-1)[0]):c,[]).filter(c=>c!==a))],[a,t,n.toString()]),o={textAnchor:t===S.left?"start":"end",transform:`translate(${t===S.left?65:-65},-5)`,destIds:i};return h("g",{id:"direction_gz",style:{["--x-percentage"]:r,["--y-percentage"]:s},children:[e("use",{xlinkHref:"#arrow_direction",style:{["--rotate"]:t===S.left?"0deg":"180deg"}}),i.length!==2?e(Ne,{...o}):e(ze,{...o})]})},Ne=n=>{const{destIds:t,...r}=n,s=f(a=>a.param.stn_list);return h("g",{...r,children:[e("text",{className:"rmg-name__zh",fontSize:28,children:t.map(a=>s[a].name[0]).join("/")+"\u65B9\u5411"}),e("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+t.map(a=>s[a].name[1].replace("\\"," ")).join("/")})]})},ze=n=>{const{destIds:t,...r}=n,s=f(m=>m.param.direction),a=f(m=>m.param.stn_list),i=t.map(m=>a[m].name[0].length),o=Math.min(...i),c=o>1&&i[0]!==i[1]?Math.abs(i[0]-i[1])/(o-1):0;return h("g",{...r,children:[t.map((m,l)=>h($.Fragment,{children:[e("text",{className:"rmg-name__zh",fontSize:25,x:s===S.left?0:-75,y:-21+42*l,letterSpacing:i[l]>i[1-l]?"0em":`${c}em`,children:a[m].name[0]}),e("text",{className:"rmg-name__en",fontSize:11.5,x:s===S.left?0:-75,y:-1+42*l,children:"Towards "+a[m].name[1].replace("\\"," ")})]},m)),e("text",{className:"rmg-name__zh",fontSize:28,x:s===S.left?25*(Math.max(...i)+1):0,y:5,children:"\u65B9\u5411"})]})},Be=$.memo(()=>h("g",{id:"terminus_gz",textAnchor:"middle",children:[e("text",{className:"rmg-name__zh",fontSize:90,children:"\u7EC8 \u70B9 \u7AD9"}),e("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),h("g",{strokeWidth:8,stroke:"#000",children:[e("path",{d:"M -160,68 h -160"}),e("path",{d:"M 160,68 h 160"})]})]})),we=$.memo(n=>{const t=$.useRef(null),[r,s]=$.useState({width:0,height:0,y:0});return $.useEffect(()=>s(t.current.getBBox()),[n.note[0],n.note[1]]),h("g",{className:"note-box",style:{["--x-percentage"]:n.note[2],["--y-percentage"]:n.note[3]},children:[n.note[4]&&e("rect",{height:r.height+4,width:r.width+4,x:-2,y:r.y-2,fill:"none",stroke:"black",strokeWidth:.5}),h("g",{ref:t,children:[e("g",{fontSize:16,letterSpacing:1.2,children:n.note[0].split(`
`).map((a,i)=>e("text",{className:"rmg-name__zh",y:i*18,children:a},i))}),e("g",{fontSize:10,letterSpacing:.33,transform:`translate(0,${18*n.note[0].split(`
`).length})`,children:n.note[1].split(`
`).map((a,i)=>{var o;return e("text",{className:"rmg-name__en",y:i*11,textLength:i<(((o=n.note[1].match(/\n/g))==null?void 0:o.length)||0)?r.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:a},i)})})]})]})},(n,t)=>n.note.toString()===t.note.toString()),ve=g.exports.memo(function(t){const{stnName:r,onUpdate:s}=t,a=g.exports.useRef(null);return g.exports.useEffect(()=>{s==null||s(a.current.getBBox())},[r.toString()]),h("g",{ref:a,children:[e("text",{className:"rmg-name__zh",fontSize:90,children:r[0]}),e("g",{fontSize:36,children:r[1].split("\\").map((i,o)=>e("text",{className:"rmg-name__en",dy:70+o*36,children:i},o))})]})},(n,t)=>n.stnName.toString()===t.stnName.toString()),$e=n=>{const{secondaryName:t,transform:r}=n,s=g.exports.useRef(null),[a,i]=g.exports.useState({x:0,width:0});return g.exports.useEffect(()=>i(s.current.getBBox()),[t.toString()]),h("g",{transform:r,children:[h("g",{transform:"translate(0,4.5)",fontSize:36,children:[e("text",{textAnchor:"end",x:a.x-3,className:"rmg-name__zh",children:"("}),e("text",{textAnchor:"start",x:a.width+a.x+3,className:"rmg-name__zh",children:")"})]}),h("g",{ref:s,textAnchor:"middle",children:[e("text",{className:"rmg-name__zh",fontSize:26,children:t[0]}),e("text",{dy:22,className:"rmg-name__en",fontSize:14,children:t[1]})]})]})},Re=()=>{const n=f(d=>d.param.svg_height),t=f(d=>d.param.svgWidth),r=f(d=>d.param.direction),s=f(d=>d.param.info_panel_type),a=f(d=>d.param.line_num),i=f(d=>d.param.current_stn_idx),o=f(d=>d.param.stn_list[i]),[c,m]=g.exports.useState({width:0}),l=o[r===S.left?"parents":"children"],p={name:`translate(${(r===S.left?1:-1)*t[w.RunIn]/4},45)`,next:`translate(${(r===S.left?1:-1)*t[w.RunIn]/10},45)`},x={nameGroup:{x:t.runin/2,y:.5*n-50-(o.name[1].split("\\").length-1)*18-(o.secondaryName?29:0)},secondaryName:{x:0,y:70+o.name[1].split("\\").length*36}};return h("g",{children:[h("g",{transform:s===R.gz2otis?p.name:"",children:[h("g",{textAnchor:"middle",transform:`translate(${x.nameGroup.x},${x.nameGroup.y})`,children:[e(ve,{stnName:o.name,onUpdate:m}),o.secondaryName&&e($e,{secondaryName:o.secondaryName,transform:`translate(${x.secondaryName.x},${x.secondaryName.y})`})]}),e(V,{lineNum:a,stnNum:o.num,style:{["--translate-x"]:`${(t[w.RunIn]+c.width)/2+55}px`,["--translate-y"]:`${.5*n-30-(o.name[1].split("\\").length-1)*18-(o.secondaryName?58/2:0)}px`,transform:"translate(var(--translate-x, 800px), var(--translate-y, 145px))"},large:!0})]}),e("g",{transform:s===R.gz2otis?p.next:"",children:!l||l.includes("linestart")||l.includes("lineend")?e(E,{}):l.length===1?e(Ee,{nextId:l[0],nameBBox:c}):e(Te,{nextIds:l,nameBBox:c})})]})},Ee=n=>{const{nextId:t,nameBBox:r}=n,s=f(y=>y.param.svgWidth),a=f(y=>y.param.direction),i=f(y=>y.param.stn_list[t]),{name:o,secondaryName:c}=i,[m,l]=g.exports.useState({width:0}),p=$.useRef(null);g.exports.useEffect(()=>l(p.current.getBBox()),[o.toString()]);const x=o[0].length,d=(s[w.RunIn]-r.width)/2;return h(E,{children:[h("g",{id:"big_next",children:[h("g",{textAnchor:"middle",style:{["--translate-x"]:a===S.left?"80px":x<=2?`${s[w.RunIn]-45-m.width-70}px`:`${s[w.RunIn]-45-m.width-35*1.5}px`},children:[e("text",{className:"rmg-name__zh",fontSize:35,children:"\u4E0B\u7AD9"}),e("text",{className:"rmg-name__en",fontSize:17,dy:30,children:"Next"})]}),h("g",{textAnchor:"start",ref:p,style:{["--translate-x"]:a===S.left?x<=2?`${115+35}px`:`${115+35/2}px`:`${s[w.RunIn]-45-m.width}px`},children:[e("text",{className:"rmg-name__zh",fontSize:35,children:o[0]}),e("g",{fontSize:17,children:o[1].split("\\").map((y,u)=>e("text",{className:"rmg-name__en",dy:30+u*17,children:y},u))})]}),c&&e("g",{textAnchor:"middle",style:{["--translate-x"]:a===S.left?x<=2?`${115+35}px`:`${115+35/2}px`:`${s[w.RunIn]-45-m.width}px`},children:e(ke,{secName:c,transform:`translate(${m.width/2},${30+o[1].split("\\").length*17+5})`})})]}),e("path",{id:"arrow",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black",style:{["--translate-x"]:a===S.left?`${(115+35*((x<=2?1:.5)+x)+d)/2-20}px`:`${(s[w.RunIn]-45-m.width-(x<=2?70+35:35*2.5)+d+n.nameBBox.width+55+18.5*1.4)/2+20}px`,["--rotate"]:a===S.left?"0deg":"180deg"}})]})},ke=n=>{const{secName:t,...r}=n,s=g.exports.useRef(null),[a,i]=g.exports.useState({x:0,width:0});return g.exports.useEffect(()=>i(s.current.getBBox()),[n.secName.toString()]),h("g",{...r,children:[h("g",{transform:"translate(0,2.5)",fontSize:25,children:[e("text",{textAnchor:"end",x:a.x-3,className:"rmg-name__zh",children:"("}),e("text",{textAnchor:"start",x:a.width+a.x+3,className:"rmg-name__zh",children:")"})]}),h("g",{ref:s,children:[e("text",{className:"rmg-name__zh",fontSize:18,children:t[0]}),e("text",{className:"rmg-name__en",fontSize:10,dy:15,children:t[1]})]})]})},Te=n=>{const{nextIds:t,nameBBox:r}=n,{routes:s}=f(u=>u.helper),a=f(u=>u.param.svgWidth),i=f(u=>u.param.direction),o=f(u=>u.param.stn_list),c=t.map(u=>o[u].name),[m,l]=g.exports.useState({width:0}),p=g.exports.useRef([]);g.exports.useEffect(()=>{l(u=>({...u,width:0})),p.current.forEach(u=>{let v=u==null?void 0:u.getBBox();l(N=>v?N.width>v.width?N:v:N)})},[c.toString()]);const x=n.nextIds.map(u=>s.reduce((v,N)=>N.includes(u)?v.concat(N.filter(k=>!["linestart","lineend"].includes(k)).slice(i===S.left?0:-1)[0]):v,[])),d=Math.max(...c.map(u=>u[0].length)),y=(a[w.RunIn]-r.width)/2;return h(E,{children:[e("g",{id:"big_next_2",children:c.map((u,v)=>h($.Fragment,{children:[h("g",{textAnchor:"middle",style:{["--translate-x"]:i===S.left?"72px":`${a[w.RunIn]-45-m.width-41}px`},children:[e("text",{className:"rmg-name__zh",children:"\u4E0B\u7AD9"}),e("text",{className:"rmg-name__en",y:22,children:"Next"})]}),h("g",{ref:N=>p.current[v]=N,textAnchor:"start",style:{["--translate-x"]:i===S.left?"113px":`${a[w.RunIn]-45-m.width}px`},children:[e("text",{className:"rmg-name__zh",children:u[0]}),u[1].split("\\").map((N,k)=>e("text",{className:"rmg-name__en",y:22+k*13,children:N},k)),e("text",{className:"rmg-name__zh",y:-35,children:x[v].map(N=>o[N].name[0]).join("/")+"\u65B9\u5411"}),e("text",{className:"rmg-name__en rmg-name__gzmtr--next2-dest",y:-20,children:"Towards "+x[v].map(N=>o[N].name[1]).join("/").replace("\\"," ")})]})]},v))}),e("path",{id:"arrow",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black",style:{["--translate-x"]:i===S.left?`${(99+27*(1+d)+y)/2-20}px`:`${(a[w.RunIn]-45-m.width-41-27+y+n.nameBBox.width+55+18.5*1.4)/2+20}px`,["--rotate"]:i===S.left?"0deg":"180deg"}})]})};function be(n){const{num:t,...r}=n;return h("g",{textAnchor:"middle",fill:"var(--rmg-theme-fg)",...r,children:[e("circle",{cx:0,cy:0,r:30,fill:"var(--rmg-theme-colour)"}),e("text",{className:"rmg-name__en",fontSize:38,dy:-9.5,children:t}),e("text",{className:"rmg-name__zh",fontSize:13,dy:10,children:"\u7AD9\u53F0"}),e("text",{className:"rmg-name__en",fontSize:9,dy:21,children:"Platform"})]})}function Ae(n){const{canvasType:t}=n,{svgWidth:r,svg_height:s}=f(a=>a.param);return h("g",{id:"otis_frame",strokeWidth:3,stroke:"black",children:[e("line",{y2:s,transform:`translate(${r[t]/2},0)`}),e("line",{x2:r[t],transform:"translate(0,90)"})]})}const D=w.RunIn;function Ie(){const{canvasScale:n}=f(p=>p.app),{svgWidth:t,svg_height:r,direction:s,info_panel_type:a,platform_num:i,psd_num:o,theme:c}=f(p=>p.param),m=t[D],l={platform:`translate(${s===S.left?50:-50},45)`};return h(F,{type:D,svgWidth:m,svgHeight:r,canvasScale:n,theme:c,children:[e(Z,{variant:a,isShowLight:a!==R.gz2otis,isShowPSD:a!==R.gz2otis&&o}),e("g",{transform:a===R.gz2otis?l.platform:"",children:e(be,{num:i,style:{["--translate-x"]:`${s===S.left?m-100:100}px`,["--translate-y"]:"calc(var(--rmg-svg-height) / 2 - 30px)",transform:"translate(var(--translate-x, 100px), var(--translate-y))"}})}),e(Re,{}),a===R.gz2otis&&e(Ae,{canvasType:D})]})}const Me={runin:e(Ie,{}),railmap:e(Se,{})};export{Me as default};
