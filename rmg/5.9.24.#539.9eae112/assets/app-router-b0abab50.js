import{m as K,r as he,j as f,$ as Pe,G as mt,F as sn,u as le,a0 as Ee,H as Se,a1 as ge,a2 as zn,a3 as Ut,K as Ce,a4 as an,a5 as Zt,P as xe,a6 as on,a as Ln,M as Ne,b as He,c as We,e as Ue,f as Ze,g as Ge,a7 as ft,a8 as Tt,a9 as Ct,aa as $e,ab as It,ac as ht,l as Qe,ad as at,h as Ye,I as Dn,k as Fn,B as de,s as Le,ae as Bn,af as Be,o as Ie,ag as ze,ah as jt,ai as Mn,aj as zt,ak as ot,al as Lt,am as De,V as Dt,an as kt,ao as At,ap as Gt,aq as ln,ar as cn,as as Vn,X as qe,at as _t,au as gt,av as Nn,aw as Hn,ax as Wn,ay as Un,az as Zn,aA as Gn,aB as $n,aC as Yn,aD as dt,aE as qn,p as Kn,q as Xn,aF as Jn,v as Qn,w as $t,aG as er,aH as tr,aI as nr,aJ as rr,aK as sr,aL as ir,aM as ar,aN as or,aO as dn,aP as lr,aQ as cr,aR as dr,aS as ur,aT as un,aU as hr,aV as pr}from"./vendor-dfcbff68.js";import{_ as w,u as ee,E as ye,a as _e,b as mr,R as Q,c as Yt,d as qt,S as Ke,e as fr,f as Kt,g as _r,h as Xt,r as gr,i as vr,j as Ot,F as Te,k as yr,l as br,m as Sr,n as xr,o as Er,p as wr,B as pt,D as je,q as jr,s as kr,t as Ar,v as Ft,w as Or,x as Pr,y as Rr,z as Tr,A as Cr,C as Ir,G as zr,P as hn,H as pn,I as Jt,J as Lr,K as Dr,L as Fr,M as Br,N as Mr,O as Vr,Q as Nr,T as Hr,U as bt,V as Wr,W as Ur,X as Zr,Y as Gr,Z as $r,$ as Yr,a0 as qr,a1 as Kr,a2 as Me,a3 as Xe,a4 as Je,a5 as Ve,a6 as mn,a7 as Pt,a8 as Rt,a9 as Xr,aa as Jr,ab as Qt,ac as fn,ad as _n,ae as Qr,af as es,ag as ts,ah as ns,ai as rs,aj as Fe,ak as St,al as ss,am as xt,an as Et,ao as is,ap as as}from"./index-13ec54b0.js";import{i as gn,w as os,d as en,a as vn,r as ls,P as cs}from"./param-selector-45ed06b7.js";const ds={mtr:()=>w(()=>import("./index-4589f4d4.js"),["assets/index-4589f4d4.js","assets/vendor-dfcbff68.js","assets/index-13ec54b0.js","assets/index-522067ed.css","assets/share-4a3ac9b1.js","assets/mtr-a99cb7b2.js","assets/param-selector-45ed06b7.js"]),gzmtr:()=>w(()=>import("./index-303e689a.js"),["assets/index-303e689a.js","assets/vendor-dfcbff68.js","assets/index-13ec54b0.js","assets/index-522067ed.css","assets/share-4a3ac9b1.js"]),shmetro:()=>w(()=>import("./index-104028ba.js"),["assets/index-104028ba.js","assets/vendor-dfcbff68.js","assets/index-13ec54b0.js","assets/index-522067ed.css","assets/share-4a3ac9b1.js","assets/mtr-a99cb7b2.js","assets/param-selector-45ed06b7.js"])};function us(s){const[_,n]=K.useState({});return K.useEffect(()=>(ds[s]().then(l=>{n(l.default)}).catch(l=>{console.error(`Failed to load canvas for style ${s}`,l),n({})}),()=>{n({})}),[s]),_}const hs={position:"relative",flexDirection:"row",overflowX:"auto","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}};function ps(){const{canvasToShow:s,canvasScale:_}=ee(t=>t.app),{svg_height:n,style:l}=ee(t=>t.param),o=us(l);K.useEffect(()=>{document.getElementById("css_share").href=`/rmg/styles/share_${l}.css`,he.event(ye.STYLE_CHANGE,{style:l})},[l]);const e=Object.keys(o).filter(t=>s.includes(t)),r=n*_;return f.jsx(Pe,{minH:r,sx:hs,children:Object.keys(o).length===0?f.jsx(mt,{isIndeterminate:!0}):e.map(t=>f.jsx(sn,{sx:{minWidth:750,height:r},children:o[t]},t+l))})}function ms(){const{t:s}=le(),_=_e(),n=ee(i=>i.app.selectedStation);console.log("InfoSection:: Rendering for",n);const l=ee(i=>i.param.style),{num:o,name:e,secondaryName:r}=ee(i=>i.param.stn_list[n]),t=[{type:"input",label:s("StationSidePanel.info.num"),value:o,placeholder:"01",onChange:i=>_(mr(n,i)),hidden:![Q.GZMTR].includes(l)},{type:"input",label:s("Chinese name"),value:e[0],onChange:i=>_(Yt(n,[i,e[1]]))},{type:"input",label:s("English name"),value:e[1],onChange:i=>_(Yt(n,[e[0],i]))},{type:"input",label:s("StationSidePanel.info.zhSecondary"),value:r?r[0]:"",placeholder:"1号航站楼",onChange:i=>_(qt(n,[i,r?r[1]:""])),hidden:![Q.GZMTR].includes(l)},{type:"input",label:s("StationSidePanel.info.enSecondary"),value:r?r[1]:"",placeholder:"Terminal 1",onChange:i=>_(qt(n,[r?r[0]:"",i])),hidden:![Q.GZMTR].includes(l)}];return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("StationSidePanel.info.title")}),f.jsx(ge,{fields:t,minW:130})]})}const yn=(s,_)=>{const n=s[_];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((l,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+_)))})};function fs(s){const{countryCode:_,svgFilename:n}=s,[l,o]=K.useState(void 0);return K.useEffect(()=>{n&&yn(Object.assign({"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1F7.svg":()=>w(()=>import("./1F1E6-1F1F7-249b5959.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1F9.svg":()=>w(()=>import("./1F1E6-1F1F9-a3474a87.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E6-1F1FF.svg":()=>w(()=>import("./1F1E6-1F1FF-c961f61f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1EA.svg":()=>w(()=>import("./1F1E7-1F1EA-87b63ce0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1F4.svg":()=>w(()=>import("./1F1E7-1F1F4-8e88acbd.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E7-1F1F7.svg":()=>w(()=>import("./1F1E7-1F1F7-2e5da46f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1E6.svg":()=>w(()=>import("./1F1E8-1F1E6-572cf376.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1F1.svg":()=>w(()=>import("./1F1E8-1F1F1-bb957357.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E8-1F1F3.svg":()=>w(()=>import("./1F1E8-1F1F3-866d09b5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E9-1F1EA.svg":()=>w(()=>import("./1F1E9-1F1EA-2bcac591.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1E9-1F1F0.svg":()=>w(()=>import("./1F1E9-1F1F0-130b3df9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EA-1F1EC.svg":()=>w(()=>import("./1F1EA-1F1EC-190b639e.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EA-1F1F8.svg":()=>w(()=>import("./1F1EA-1F1F8-e9f6e238.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EB-1F1F7.svg":()=>w(()=>import("./1F1EB-1F1F7-12f823eb.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EC-1F1F7.svg":()=>w(()=>import("./1F1EC-1F1F7-d16bd178.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1ED-1F1F0.svg":()=>w(()=>import("./1F1ED-1F1F0-1346b158.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1ED-1F1FA.svg":()=>w(()=>import("./1F1ED-1F1FA-e44befe3.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1E9.svg":()=>w(()=>import("./1F1EE-1F1E9-256ea73c.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F3.svg":()=>w(()=>import("./1F1EE-1F1F3-44d109aa.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F7.svg":()=>w(()=>import("./1F1EE-1F1F7-c924004a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EE-1F1F9.svg":()=>w(()=>import("./1F1EE-1F1F9-38eff108.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1EF-1F1F5.svg":()=>w(()=>import("./1F1EF-1F1F5-93518547.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F0-1F1F7.svg":()=>w(()=>import("./1F1F0-1F1F7-4e778503.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1F4.svg":()=>w(()=>import("./1F1F2-1F1F4-bb2225c7.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1FD.svg":()=>w(()=>import("./1F1F2-1F1FD-31d458ab.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F2-1F1FE.svg":()=>w(()=>import("./1F1F2-1F1FE-9d12ac27.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F3-1F1F1.svg":()=>w(()=>import("./1F1F3-1F1F1-d799cc7f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F3-1F1F4.svg":()=>w(()=>import("./1F1F3-1F1F4-36b22a7a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1EA.svg":()=>w(()=>import("./1F1F5-1F1EA-2359ab5b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1F1.svg":()=>w(()=>import("./1F1F5-1F1F1-56d472c9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F5-1F1F9.svg":()=>w(()=>import("./1F1F5-1F1F9-48f96f04.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F7-1F1F4.svg":()=>w(()=>import("./1F1F7-1F1F4-a774c3a2.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F7-1F1FA.svg":()=>w(()=>import("./1F1F7-1F1FA-3b81f8de.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1E6.svg":()=>w(()=>import("./1F1F8-1F1E6-481d8837.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1EA.svg":()=>w(()=>import("./1F1F8-1F1EA-3583e0b5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F8-1F1EC.svg":()=>w(()=>import("./1F1F8-1F1EC-2b92413d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1ED.svg":()=>w(()=>import("./1F1F9-1F1ED-0757641b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1F7.svg":()=>w(()=>import("./1F1F9-1F1F7-f7cf6b4a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1F9-1F1FC.svg":()=>w(()=>import("./1F1F9-1F1FC-82e8fcc5.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1E6.svg":()=>w(()=>import("./1F1FA-1F1E6-fc868471.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1F3.svg":()=>w(()=>import("./1F1FA-1F1F3-dddb091b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1F8.svg":()=>w(()=>import("./1F1FA-1F1F8-47f8491b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FA-1F1FF.svg":()=>w(()=>import("./1F1FA-1F1FF-0989e0a8.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FB-1F1EA.svg":()=>w(()=>import("./1F1FB-1F1EA-8edd6b29.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F1FB-1F1F3.svg":()=>w(()=>import("./1F1FB-1F1F3-2e88414b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F3F4-E0067-E0062-E0065-E006E-E0067-E007F.svg":()=>w(()=>import("./1F3F4-E0067-E0062-E0065-E006E-E0067-E007F-8302e24f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/flags/1F3F4-E0067-E0062-E0073-E0063-E0074-E007F.svg":()=>w(()=>import("./1F3F4-E0067-E0062-E0073-E0063-E0074-E007F-a5d75104.js"),[])}),`../../../../node_modules/@railmapgen/rmg-palette-resources/flags/${n.slice(0,-4)}.svg`).then(e=>e.default).then(o).catch(e=>console.error(`Failed to find SVG file ${n} as ${e==null?void 0:e.message}`))},[n]),l?f.jsx(zn,{src:l,alt:`Flag of ${_}`,h:17,mr:1}):f.jsx(f.Fragment,{})}function _s(s){const{defaultValueId:_,onChange:n}=s,{i18n:l}=le(),o=_?Ut.find(c=>c.id===_):void 0,e=c=>{var y,h;return(h=(y=l.languages.map(m=>c.name[m]).find(m=>m!==void 0))!=null?y:c.name.en)!=null?h:""},r=c=>{var p,b;const y=c.country==="TW"&&["zh-Hans","zh-CN"].includes(l.languages[0]),h=["Win32","Win64"].includes(navigator.platform),m=l.languages.map(g=>c.name[g]).find(g=>g!==void 0),d=(p=Zt.find(g=>g.id===c.country))==null?void 0:p.flagSvg,v=(b=Zt.find(g=>g.id===c.country))==null?void 0:b.flagEmoji;return f.jsxs(f.Fragment,{children:[y?f.jsx("span",{children:"🏴 "}):h?f.jsx(fs,{countryCode:c.country,svgFilename:d}):f.jsxs("span",{children:[v," "]}),m]})},t=(c,y)=>Object.values(c.name).some(h=>h.includes(y)),i=Ut.slice().sort((c,y)=>c.id===Ce.Other?1:y.id===Ce.Other?-1:e(c).localeCompare(e(y),l.languages[0]));return f.jsx(an,{data:i,displayValue:e,displayHandler:r,predicate:t,defaultValue:o,onChange:c=>n==null?void 0:n(c.id)})}const gs=s=>{const[_,n]=K.useState([]);return K.useEffect(()=>{yn(Object.assign({"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/amsterdam.js":()=>w(()=>import("./amsterdam-452aca52.js"),["assets/amsterdam-452aca52.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ankara.js":()=>w(()=>import("./ankara-72946346.js"),["assets/ankara-72946346.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/athens.js":()=>w(()=>import("./athens-b0457e1b.js"),["assets/athens-b0457e1b.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/baku.js":()=>w(()=>import("./baku-bae24922.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bangkok.js":()=>w(()=>import("./bangkok-3d015c9c.js"),["assets/bangkok-3d015c9c.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/barcelona.js":()=>w(()=>import("./barcelona-e8f4d08f.js"),["assets/barcelona-e8f4d08f.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/beijing.js":()=>w(()=>import("./beijing-83cc5f69.js"),["assets/beijing-83cc5f69.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/berlin.js":()=>w(()=>import("./berlin-42cd9625.js"),["assets/berlin-42cd9625.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bonn.js":()=>w(()=>import("./bonn-c8da408e.js"),["assets/bonn-c8da408e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/boston.js":()=>w(()=>import("./boston-33a8fb91.js"),["assets/boston-33a8fb91.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/brussels.js":()=>w(()=>import("./brussels-7f1cc820.js"),["assets/brussels-7f1cc820.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/bucharest.js":()=>w(()=>import("./bucharest-dec16d21.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/budapest.js":()=>w(()=>import("./budapest-de8e897a.js"),["assets/budapest-de8e897a.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/buenosaires.js":()=>w(()=>import("./buenosaires-5fa2ebc6.js"),["assets/buenosaires-5fa2ebc6.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/busan.js":()=>w(()=>import("./busan-bf668f6e.js"),["assets/busan-bf668f6e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cairo.js":()=>w(()=>import("./cairo-2cdeea73.js"),["assets/cairo-2cdeea73.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/caracas.js":()=>w(()=>import("./caracas-a98f8cf2.js"),["assets/caracas-a98f8cf2.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changchun.js":()=>w(()=>import("./changchun-66bf3492.js"),["assets/changchun-66bf3492.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changsha.js":()=>w(()=>import("./changsha-beb03ea3.js"),["assets/changsha-beb03ea3.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/changzhou.js":()=>w(()=>import("./changzhou-3dbfde74.js"),["assets/changzhou-3dbfde74.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/chengdu.js":()=>w(()=>import("./chengdu-2fde8740.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/chongqing.js":()=>w(()=>import("./chongqing-8e82595b.js"),["assets/chongqing-8e82595b.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cochabamba.js":()=>w(()=>import("./cochabamba-b46dc4fa.js"),["assets/cochabamba-b46dc4fa.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/cologne.js":()=>w(()=>import("./cologne-8f546394.js"),["assets/cologne-8f546394.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/copenhagen.js":()=>w(()=>import("./copenhagen-776ea0e7.js"),["assets/copenhagen-776ea0e7.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/daegu.js":()=>w(()=>import("./daegu-8f53d357.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dalian.js":()=>w(()=>import("./dalian-08981d46.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/delhi.js":()=>w(()=>import("./delhi-eaa3d5a0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dongguan.js":()=>w(()=>import("./dongguan-9877cd9c.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dortmund.js":()=>w(()=>import("./dortmund-3b70d262.js"),["assets/dortmund-3b70d262.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/dublin.js":()=>w(()=>import("./dublin-6d46da51.js"),["assets/dublin-6d46da51.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/edinburgh.js":()=>w(()=>import("./edinburgh-62a302f1.js"),["assets/edinburgh-62a302f1.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/eskisehir.js":()=>w(()=>import("./eskisehir-5404753b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/foshan.js":()=>w(()=>import("./foshan-39b69f72.js"),["assets/foshan-39b69f72.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/frankfurt.js":()=>w(()=>import("./frankfurt-f1ee3295.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/fuzhou.js":()=>w(()=>import("./fuzhou-08293377.js"),["assets/fuzhou-08293377.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/glasgow.js":()=>w(()=>import("./glasgow-e714346d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/gothenburg.js":()=>w(()=>import("./gothenburg-d7e7b396.js"),["assets/gothenburg-d7e7b396.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/guadalajara.js":()=>w(()=>import("./guadalajara-dc4a5f1d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/guangzhou.js":()=>w(()=>import("./guangzhou-61dabb20.js"),["assets/guangzhou-61dabb20.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hamburg.js":()=>w(()=>import("./hamburg-645a80e6.js"),["assets/hamburg-645a80e6.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hangzhou.js":()=>w(()=>import("./hangzhou-42808780.js"),["assets/hangzhou-42808780.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hanoi.js":()=>w(()=>import("./hanoi-6c252433.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/harbin.js":()=>w(()=>import("./harbin-687d6138.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hefei.js":()=>w(()=>import("./hefei-45df0096.js"),["assets/hefei-45df0096.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hiroshima.js":()=>w(()=>import("./hiroshima-357660c3.js"),["assets/hiroshima-357660c3.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hochiminh.js":()=>w(()=>import("./hochiminh-9f62b24b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/hongkong.js":()=>w(()=>import("./hongkong-1f572c4b.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/iashi.js":()=>w(()=>import("./iashi-94bdcd99.js"),["assets/iashi-94bdcd99.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/istanbul.js":()=>w(()=>import("./istanbul-dbcd8f71.js"),["assets/istanbul-dbcd8f71.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/jakarta.js":()=>w(()=>import("./jakarta-e1c4d5c4.js"),["assets/jakarta-e1c4d5c4.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/jinan.js":()=>w(()=>import("./jinan-b6389b78.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kansai.js":()=>w(()=>import("./kansai-b81cd799.js"),["assets/kansai-b81cd799.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kaohsiung.js":()=>w(()=>import("./kaohsiung-1a75e57f.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kaosiung.js":()=>w(()=>import("./kaosiung-c17db08d.js"),["assets/kaosiung-c17db08d.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kharkiv.js":()=>w(()=>import("./kharkiv-991aa349.js"),["assets/kharkiv-991aa349.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/klangvalley.js":()=>w(()=>import("./klangvalley-9114a5fa.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/kunming.js":()=>w(()=>import("./kunming-1ad352e1.js"),["assets/kunming-1ad352e1.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/lima.js":()=>w(()=>import("./lima-118ba6e3.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/lisbon.js":()=>w(()=>import("./lisbon-82e2f436.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/london.js":()=>w(()=>import("./london-4cc3d948.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/luoyang.js":()=>w(()=>import("./luoyang-40102508.js"),["assets/luoyang-40102508.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/macao.js":()=>w(()=>import("./macao-19ac9346.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/madrid.js":()=>w(()=>import("./madrid-8661373e.js"),["assets/madrid-8661373e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/manchester.js":()=>w(()=>import("./manchester-a48201d1.js"),["assets/manchester-a48201d1.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/milan.js":()=>w(()=>import("./milan-f3c4b076.js"),["assets/milan-f3c4b076.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/monterrey.js":()=>w(()=>import("./monterrey-1d7a972e.js"),["assets/monterrey-1d7a972e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/montreal.js":()=>w(()=>import("./montreal-d1c84dff.js"),["assets/montreal-d1c84dff.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/munich.js":()=>w(()=>import("./munich-2b354cab.js"),["assets/munich-2b354cab.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/nanjing.js":()=>w(()=>import("./nanjing-f84ef755.js"),["assets/nanjing-f84ef755.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/nanning.js":()=>w(()=>import("./nanning-015f966c.js"),["assets/nanning-015f966c.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/naples.js":()=>w(()=>import("./naples-19d71e84.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/neworleans.js":()=>w(()=>import("./neworleans-97dfa757.js"),["assets/neworleans-97dfa757.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/newtaipei.js":()=>w(()=>import("./newtaipei-2d07dd7a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/newyork.js":()=>w(()=>import("./newyork-4b6a5f12.js"),["assets/newyork-4b6a5f12.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ningbo.js":()=>w(()=>import("./ningbo-5e5eb727.js"),["assets/ningbo-5e5eb727.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/osaka.js":()=>w(()=>import("./osaka-2f58e40e.js"),["assets/osaka-2f58e40e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/oslo.js":()=>w(()=>import("./oslo-0fdbb41d.js"),["assets/oslo-0fdbb41d.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/other.js":()=>w(()=>import("./other-176be433.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/ottawa.js":()=>w(()=>import("./ottawa-ec1c5152.js"),["assets/ottawa-ec1c5152.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/paris.js":()=>w(()=>import("./paris-a122ebb1.js"),["assets/paris-a122ebb1.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/qingdao.js":()=>w(()=>import("./qingdao-08873907.js"),["assets/qingdao-08873907.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rheinruhr.js":()=>w(()=>import("./rheinruhr-d291a748.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rio.js":()=>w(()=>import("./rio-66ffaeee.js"),["assets/rio-66ffaeee.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/riyadh.js":()=>w(()=>import("./riyadh-7be17df3.js"),["assets/riyadh-7be17df3.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/rome.js":()=>w(()=>import("./rome-948e4c61.js"),["assets/rome-948e4c61.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sanfrancisco.js":()=>w(()=>import("./sanfrancisco-9628d94e.js"),["assets/sanfrancisco-9628d94e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sanktpeterburg.js":()=>w(()=>import("./sanktpeterburg-87b7088d.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/santiago.js":()=>w(()=>import("./santiago-6f5a28dc.js"),["assets/santiago-6f5a28dc.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/saopaulo.js":()=>w(()=>import("./saopaulo-81a3637e.js"),["assets/saopaulo-81a3637e.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/seoul.js":()=>w(()=>import("./seoul-89755fa1.js"),["assets/seoul-89755fa1.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/sevilla.js":()=>w(()=>import("./sevilla-852a01d4.js"),["assets/sevilla-852a01d4.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shanghai.js":()=>w(()=>import("./shanghai-143088c2.js"),["assets/shanghai-143088c2.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shaoxing.js":()=>w(()=>import("./shaoxing-d7bdc5a2.js"),["assets/shaoxing-d7bdc5a2.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shenyang.js":()=>w(()=>import("./shenyang-62628740.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shenzhen.js":()=>w(()=>import("./shenzhen-ba76769a.js"),["assets/shenzhen-ba76769a.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/shijiazhuang.js":()=>w(()=>import("./shijiazhuang-10c95866.js"),["assets/shijiazhuang-10c95866.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/singapore.js":()=>w(()=>import("./singapore-b16fadb3.js"),["assets/singapore-b16fadb3.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/stockholm.js":()=>w(()=>import("./stockholm-5eca41a9.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/suzhou.js":()=>w(()=>import("./suzhou-41ed70a3.js"),["assets/suzhou-41ed70a3.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taichung.js":()=>w(()=>import("./taichung-cf27f3b2.js"),["assets/taichung-cf27f3b2.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taipei.js":()=>w(()=>import("./taipei-aee6679c.js"),["assets/taipei-aee6679c.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taiyuan.js":()=>w(()=>import("./taiyuan-900623ad.js"),["assets/taiyuan-900623ad.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/taoyuan.js":()=>w(()=>import("./taoyuan-7600cc1d.js"),["assets/taoyuan-7600cc1d.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tashkent.js":()=>w(()=>import("./tashkent-5a2ea18c.js"),["assets/tashkent-5a2ea18c.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tehran.js":()=>w(()=>import("./tehran-293c71a8.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tianjin.js":()=>w(()=>import("./tianjin-596f6ba8.js"),["assets/tianjin-596f6ba8.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tokyo.js":()=>w(()=>import("./tokyo-41051661.js"),["assets/tokyo-41051661.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/toronto.js":()=>w(()=>import("./toronto-660500bd.js"),["assets/toronto-660500bd.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/tyneandwear.js":()=>w(()=>import("./tyneandwear-b3da8462.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/urumqi.js":()=>w(()=>import("./urumqi-319b1a7b.js"),["assets/urumqi-319b1a7b.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/vienna.js":()=>w(()=>import("./vienna-1e8eea57.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/warsaw.js":()=>w(()=>import("./warsaw-fb3381af.js"),["assets/warsaw-fb3381af.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/washington.js":()=>w(()=>import("./washington-16acf9af.js"),["assets/washington-16acf9af.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/wuhan.js":()=>w(()=>import("./wuhan-eb678328.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/wuxi.js":()=>w(()=>import("./wuxi-68576026.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xiamen.js":()=>w(()=>import("./xiamen-cca9c4f0.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xian.js":()=>w(()=>import("./xian-84e19a1a.js"),[]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/xuzhou.js":()=>w(()=>import("./xuzhou-dd8545f4.js"),["assets/xuzhou-dd8545f4.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/yevpatoria.js":()=>w(()=>import("./yevpatoria-10756081.js"),["assets/yevpatoria-10756081.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/yokohama.js":()=>w(()=>import("./yokohama-d8864963.js"),["assets/yokohama-d8864963.js","assets/vendor-dfcbff68.js"]),"../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/zhengzhou.js":()=>w(()=>import("./zhengzhou-e71ecb3a.js"),["assets/zhengzhou-e71ecb3a.js","assets/vendor-dfcbff68.js"])}),`../../../../node_modules/@railmapgen/rmg-palette-resources/palettes/${s}.js`).then(l=>n(l.default)).catch(()=>n([]))},[s]),_};function vs(s){const{city:_,defaultValueId:n,onChange:l}=s,{i18n:o}=le(),e=gs(_),r=n?e.find(y=>y.id===n):void 0,t=y=>{var h;return(h=o.languages.map(m=>y.name[m]).find(m=>m!==void 0))!=null?h:""},i=y=>{const h=t(y);return f.jsx(on,{name:h,fg:y.fg||xe.white,bg:y.colour})},c=(y,h)=>Object.values(y.name).some(m=>m.includes(h));return f.jsx(an,{data:e,displayValue:t,displayHandler:i,predicate:c,defaultValue:r,onChange:y=>l==null?void 0:l(y.id,y.colour,y.fg||xe.white)})}function Bt(s){const{isOpen:_,onClose:n,defaultTheme:l,onUpdate:o}=s,{t:e}=le(),r=Ln("primary.500","primary.300"),[t,i]=K.useState(l==null?void 0:l[0]),[c,y]=K.useState(l==null?void 0:l[1]),[h,m]=K.useState((l==null?void 0:l[2])||"#AAAAAA"),[d,v]=K.useState((l==null?void 0:l[3])||xe.white);K.useEffect(()=>{l&&(i(l[0]),y(l[1]),m(l[2]),v(l[3]))},[_,l==null?void 0:l.toString()]);const p=[{type:"custom",label:e("ColourModal.city"),component:f.jsx(_s,{defaultValueId:t,onChange:j=>{i(j),y(void 0),m("#AAAAAA"),v(xe.white)}})},{type:"custom",label:e("ColourModal.line"),component:f.jsx(vs,{city:t,defaultValueId:c,onChange:(j,O,F)=>{y(j),m(O),v(F)}})}],b=[{type:"input",label:e("ColourModal.bg"),variant:"color",value:h,placeholder:"#F3D03E",onChange:j=>{i(Ce.Other),y("other"),m(j)}},{type:"select",label:e("ColourModal.fg"),value:d,options:{[xe.white]:e("ColourModal.white"),[xe.black]:e("ColourModal.black")},onChange:j=>{i(Ce.Other),y("other"),v(j)}}],g=()=>{he.isStandaloneWindow()?window.open("/rmg-palette","_blank"):he.openApp("rmg-palette")},x=t&&c&&h&&d,A=()=>{x&&(o==null||o([t,c,h,d]),n(),he.event(ye.SELECT_COLOUR,{cityCode:t,lineCode:c}))};return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[f.jsx(Ue,{children:e("ColourModal.title")}),f.jsx(Ze,{}),f.jsx(Ge,{children:f.jsxs(ft,{children:[f.jsx(on,{name:e("ColourModal.example"),fg:d,bg:h}),f.jsxs(Tt,{isFitted:!0,colorScheme:"primary",w:"100%",defaultIndex:t===Ce.Other?1:0,children:[f.jsxs(Ct,{children:[f.jsx($e,{children:e("ColourModal.palette")}),f.jsx($e,{children:e("ColourModal.custom")})]}),f.jsxs(It,{children:[f.jsx(ht,{children:f.jsx(ge,{fields:p})}),f.jsx(ht,{children:f.jsx(ge,{fields:b})})]})]})]})}),f.jsxs(Qe,{children:[f.jsxs(at,{fontSize:"sm",marginRight:2,children:[e("ColourModal.seeAll"),f.jsxs(Ye,{color:r,onClick:g,children:[e("Palette")," ",f.jsx(Dn,{as:Fn})]})]}),f.jsx(de,{colorScheme:"primary",onClick:A,isDisabled:!x,children:e("Confirm")})]})]})]})}class ys{static hexToRgb(_){return[parseInt(_.slice(1,3),16),parseInt(_.slice(3,5),16),parseInt(_.slice(5,7),16)]}static fade(_,n){return`rgba(${[...this.hexToRgb(_),n].join(",")})`}static euclideanDistance(_,n){return this.hexToRgb(_).reduce((l,o,e)=>l+Math.pow(o-this.hexToRgb(n)[e],2),0)}}function Mt(s){var o;const{theme:_,onClick:n}=s,{t:l}=le();return f.jsx(Le,{size:"xs","aria-label":l("Colour"),mt:"0.45px",color:_==null?void 0:_[3],bg:_==null?void 0:_[2],_hover:{bg:ys.fade((o=_==null?void 0:_[2])!=null?o:"#aaaaaa",.7)},icon:f.jsx(Bn,{}),onClick:n})}function bs(s){var v;const{interchangeList:_,onAdd:n,onDelete:l,onUpdate:o}=s,{t:e}=le(),[r,t]=K.useState(!1),[i,c]=K.useState(0),{theme:y,stn_list:h}=ee(p=>p.param),m=Object.values(h).reduce((p,b)=>{const[g,x]=p;return[[...new Set(g.concat(b.transfer.groups.map(A=>A.lines.map(j=>j.name[0])).flat()))],[...new Set(x.concat(b.transfer.groups.map(A=>A.lines.map(j=>j.name[1])).flat()))]]},[[],[]]),d=_.map((p,b)=>[{type:"input",label:e("Chinese name"),value:p.name[0],minW:"80px",onChange:g=>o==null?void 0:o(b,{...p,name:[g,p.name[1]]}),optionList:m[0]},{type:"input",label:e("English name"),value:p.name[1],minW:"80px",onChange:g=>o==null?void 0:o(b,{...p,name:[p.name[0],g]}),optionList:m[1]}]);return f.jsxs(Be,{direction:"column",children:[_.length===0&&f.jsxs(Ie,{spacing:.5,"data-testid":"interchange-card-stack",children:[f.jsx(at,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:e("StationSidePanel.interchange.noInterchanges")}),f.jsx(Le,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.add"),onClick:()=>n==null?void 0:n({theme:[y[0],"","#aaaaaa",xe.white],name:["",""]}),icon:f.jsx(ze,{})})]}),_.map((p,b)=>f.jsxs(Ie,{spacing:.5,"data-testid":`interchange-card-stack-${b}`,children:[f.jsx(jt,{label:e("Colour"),minW:"40px",noLabel:b!==0,children:f.jsx(Mt,{theme:p.theme,onClick:()=>{t(!0),c(b)}})}),f.jsx(ge,{fields:d[b],noLabel:b!==0}),n&&b===d.length-1?f.jsx(Le,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.copy"),onClick:()=>n==null?void 0:n(_.slice(-1)[0]),icon:f.jsx(Mn,{})}):f.jsx(Ee,{minW:8}),l&&f.jsx(Le,{size:"sm",variant:"ghost","aria-label":e("StationSidePanel.interchange.remove"),onClick:()=>l==null?void 0:l(b),icon:f.jsx(zt,{})})]},b)),f.jsx(Bt,{isOpen:r,onClose:()=>t(!1),defaultTheme:(v=_[i])==null?void 0:v.theme,onUpdate:p=>o==null?void 0:o(i,{..._[i],theme:p})})]})}function Ss(){const{t:s}=le(),_=_e(),n=ee(h=>h.app.selectedStation),{theme:l,style:o}=ee(h=>h.param),{transfer:e}=ee(h=>h.param.stn_list[n]),r=h=>{var m,d,v,p;return[{type:"input",label:s("Station Chinese name"),value:(d=(m=e.groups[h].name)==null?void 0:m[0])!=null?d:"",hidden:![Q.MTR].includes(o),onChange:b=>{var g,x;return _(Kt(n,h,[b,(x=(g=e.groups[h].name)==null?void 0:g[1])!=null?x:""]))}},{type:"input",label:s("Station English name"),value:(p=(v=e.groups[h].name)==null?void 0:v[1])!=null?p:"",hidden:![Q.MTR].includes(o),onChange:b=>{var g,x;return _(Kt(n,h,[(x=(g=e.groups[h].name)==null?void 0:g[0])!=null?x:"",b]))}},{type:"switch",label:s("Paid area"),isChecked:e.paid_area,onChange:b=>_(_r(n,b)),hidden:![Q.MTR].includes(o)||h!==0,oneLine:!0}]},t=h=>m=>{_(Xt(n,h,m))},i=h=>m=>{_(gr(n,h,m))},c=h=>(m,d)=>{_(vr(n,h,m,d))},y=()=>{_(Xt(n,e.groups.length,{theme:[l[0],"","#AAAAAA",xe.white],name:["",""]}))};return f.jsxs(ft,{align:"flex-start",p:1,children:[f.jsxs(Pe,{w:"100%",children:[f.jsx(Se,{as:"h5",size:"sm",mr:"auto",children:s("StationSidePanel.interchange.title")}),o===Q.MTR&&f.jsx(ot,{selections:[{label:s("Text on the left"),value:Ke.left},{label:s("Text on the right"),value:Ke.right}],defaultValue:e.tick_direc,onChange:h=>_(fr(n,h))})]}),e.groups.map((h,m)=>f.jsxs(K.Fragment,{children:[f.jsx(Se,{as:"h6",size:"xs",children:s(m===0?"StationSidePanel.interchange.within":m===1?"StationSidePanel.interchange.outStation":"StationSidePanel.interchange.outSystem")}),m!==0&&f.jsx(ge,{fields:r(m)}),f.jsx(bs,{interchangeList:h.lines,onAdd:t(m),onDelete:i(m),onUpdate:c(m)})]},m)),e.groups.length<3&&f.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:f.jsx(ze,{}),onClick:y,children:s("StationSidePanel.interchange.addGroup")})]})}function xs(){const{t:s}=le(),_=_e(),n=ee(v=>v.app.selectedStation),{style:l,loop:o}=ee(v=>v.param),{services:e,facility:r,loop_pivot:t,one_line:i,int_padding:c}=ee(v=>v.param.stn_list[n]),y=Object.values(Ot).map(v=>({label:s("StationSidePanel.more."+v),value:v,disabled:v===Ot.local&&l!==Q.SHMetro})),h={[Te.none]:s("StationSidePanel.more.none"),[Te.airport]:s("StationSidePanel.more.airport"),[Te.hsr]:s("StationSidePanel.more.hsr"),[Te.disney]:s("StationSidePanel.more.disney")},m={[Te.none]:s("StationSidePanel.more.none"),[Te.airport]:s("StationSidePanel.more.airport"),[Te.railway]:s("StationSidePanel.more.railway"),[Te.disney]:s("StationSidePanel.more.disney")},d=[{type:"custom",label:s("StationSidePanel.more.service"),component:f.jsx(ot,{selections:y,defaultValue:e,onChange:v=>_(yr(n,v)),multiSelect:!0}),hidden:![Q.GZMTR,Q.SHMetro].includes(l)},{type:"select",label:s("StationSidePanel.more.facility"),value:r,options:l===Q.MTR?h:m,onChange:v=>_(br(n,v)),hidden:![Q.MTR,Q.SHMetro].includes(l)},{type:"switch",label:s("StationSidePanel.more.pivot"),isChecked:t,onChange:v=>_(Sr(n,v)),hidden:![Q.SHMetro].includes(l)||!o,minW:"full",oneLine:!0},{type:"switch",label:s("StationSidePanel.more.oneLine"),isChecked:i,onChange:v=>_(xr(n,v)),hidden:![Q.SHMetro].includes(l),minW:"full",oneLine:!0},{type:"input",label:s("StationSidePanel.more.intPadding"),value:c.toString(),validator:v=>Number.isInteger(v),onChange:v=>_(Er(n,Number(v))),hidden:![Q.SHMetro].includes(l)},{type:"custom",label:s("StationSidePanel.more.intPaddingApplyGlobal"),component:f.jsx(ot,{selections:[{label:s("StationSidePanel.more.apply"),value:"",disabled:!1}],defaultValue:"",onChange:v=>_(wr(n))}),oneLine:!0,hidden:![Q.SHMetro].includes(l)}];return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("StationSidePanel.more.title")}),f.jsx(ge,{fields:d})]})}function Es(){const{t:s}=le(),_=_e(),n=ee(h=>h.app.selectedStation),l=ee(h=>h.param.stn_list),{parents:o,children:e,branch:r}=l[n],t={[pt.through]:s("StationSidePanel.branch.through"),[pt.nonThrough]:s("StationSidePanel.branch.nonThrough")},i=h=>(h===je.left?o:e).reduce((m,d)=>({...m,[d]:l[d].name.join(" ")}),{}),c={upper:s("StationSidePanel.branch.upper"),lower:s("StationSidePanel.branch.lower")},y=h=>r[h].length?[{type:"select",label:s("StationSidePanel.branch.type"),options:t,value:r[h][0],onChange:m=>_(jr(n,h,m))},{type:"select",label:s("StationSidePanel.branch.firstStation"),options:i(h),value:r[h][1],onChange:m=>_(kr(n,h,m))},{type:"select",label:s("StationSidePanel.branch.position"),options:c,value:(h===je.left?o:e)[0]===r[h][1]?"upper":"lower",onChange:()=>_(Ar(n,h))}]:[];return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("Branches")}),f.jsx(Se,{as:"h6",size:"xs",children:s("Branch on the left")}),f.jsx(Be,{direction:"column",children:o.length===2?f.jsx(ge,{fields:y(je.left)}):f.jsx(at,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:s("No branches found")})}),f.jsx(Se,{as:"h6",size:"xs",children:s("Branch on the right")}),f.jsx(Be,{direction:"column",children:e.length===2?f.jsx(ge,{fields:y(je.right)}):f.jsx(at,{as:"i",flex:1,align:"center",fontSize:"md",colorScheme:"gray",children:s("No branches found")})})]})}function ws(){return f.jsxs(Lt,{children:[f.jsx(ms,{}),f.jsx(De,{}),f.jsx(Ss,{}),f.jsx(De,{}),f.jsx(Es,{}),f.jsx(De,{}),f.jsx(xs,{})]})}function js(){const{t:s}=le(),_=Dt(),{style:n,svgWidth:l,svg_height:o,y_pc:e,branchSpacingPct:r,padding:t,direction_gz_x:i,direction_gz_y:c,loop:y}=ee(m=>m.param),h=[...Ft[n].map(m=>({type:"input",label:s(`StyleSidePanel.layout.${m}Width`),value:l[m].toString(),onChange:d=>_(Or(Number(d),m))})),{type:"input",label:s("StyleSidePanel.layout.canvasHeight"),value:o.toString(),onChange:m=>_(Pr(Number(m)))},{type:"slider",label:s("StyleSidePanel.layout.verticalPosition"),value:e,min:0,max:100,onChange:m=>_(Rr(m)),leftIcon:f.jsx(kt,{}),rightIcon:f.jsx(At,{}),hidden:![Q.MTR,Q.GZMTR].includes(n)},{type:"slider",label:s(y?"StyleSidePanel.layout.branchSpacingLoop":"Branch spacing"),value:r,min:0,max:y?50:100,onChange:m=>_(Tr(m)),leftIcon:f.jsx(Gt,{}),rightIcon:f.jsx(ze,{})},{type:"slider",label:s("StyleSidePanel.layout.padding"),value:t,min:0,max:50,onChange:m=>_(Cr(m)),leftIcon:f.jsx(Gt,{}),rightIcon:f.jsx(ze,{})},{type:"slider",label:s("StyleSidePanel.layout.directionGzX"),value:i,min:0,max:100,onChange:m=>_(Ir(m)),leftIcon:f.jsx(ln,{}),rightIcon:f.jsx(cn,{}),hidden:![Q.GZMTR].includes(n)},{type:"slider",label:s("StyleSidePanel.layout.directionGzY"),value:c,min:0,max:100,onChange:m=>_(zr(m)),leftIcon:f.jsx(kt,{}),rightIcon:f.jsx(At,{}),hidden:![Q.GZMTR].includes(n)}];return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("StyleSidePanel.layout.title")}),f.jsx(ge,{fields:h,minW:130})]})}function ks(){const{t:s}=le(),_=_e(),{style:n,theme:l,line_name:o,line_num:e,direction:r,platform_num:t,psd_num:i,namePosMTR:c,customiseMTRDest:y,info_panel_type:h}=ee(j=>j.param),[m,d]=K.useState(!1),v=[{label:s("StyleSidePanel.design.left"),value:Ke.left},{label:s("StyleSidePanel.design.right"),value:Ke.right}],p=Object.values(hn).reduce((j,O)=>({...j,[O]:s("StyleSidePanel.design."+O)}),{}),b=Object.values(pn).reduce((j,O)=>({...j,[O]:s("StyleSidePanel.design."+O)}),{}),g=[{type:"custom",label:s("Colour"),component:f.jsx(Mt,{theme:l,onClick:()=>d(!0)}),minW:"40px"},{type:"input",label:s("StyleSidePanel.design.zhLineName"),value:o[0],onChange:j=>_(Jt([j,o[1]])),minW:130},{type:"input",label:s("StyleSidePanel.design.enLineName"),value:o[1],onChange:j=>_(Jt([o[0],j])),minW:130},{type:"input",label:s("StyleSidePanel.design.lineNum"),value:e,onChange:j=>_(Lr(j)),hidden:![Q.GZMTR].includes(n)},{type:"input",label:s("StyleSidePanel.design.platformNum"),value:t||"",onChange:j=>_(Dr(j))},{type:"input",label:s("StyleSidePanel.design.psdNum"),value:i,onChange:j=>_(Fr(j)),hidden:![Q.GZMTR].includes(n)},{type:"select",label:s("StyleSidePanel.design.panelType"),value:h,options:n===Q.GZMTR?p:b,onChange:j=>_(Br(j)),hidden:![Q.GZMTR,Q.SHMetro].includes(n)},{type:"custom",label:s("StyleSidePanel.design.direction"),component:f.jsx(ot,{selections:v,defaultValue:r,onChange:j=>_(Mr(j))}),minW:"full",oneLine:!0}],x=[{label:s("StyleSidePanel.design.alternatively"),value:!0},{label:s("StyleSidePanel.design.onOneSide"),value:!1}],A=[{type:"custom",label:s("StyleSidePanel.design.nameDisplay"),component:f.jsxs(Ie,{spacing:.5,children:[f.jsx(Le,{size:"xs",variant:"ghost","aria-label":s("StyleSidePanel.design.flip"),title:s("StyleSidePanel.design.flip"),icon:f.jsx(Vn,{}),onClick:()=>_(Vr())}),f.jsx(ot,{selections:x,defaultValue:c.isStagger,onChange:j=>_(Nr(j))})]}),minW:"full",oneLine:!0,hidden:![Q.MTR].includes(n)},{type:"switch",label:s("StyleSidePanel.design.legacyDestination"),isChecked:y.isLegacy,onChange:j=>_(Hr(j)),hidden:![Q.MTR].includes(n),minW:"full",oneLine:!0},{type:"switch",label:s("StyleSidePanel.design.overrideTerminal"),isChecked:y.terminal!==!1,onChange:j=>_(bt(j?["",""]:!1)),hidden:![Q.MTR].includes(n),minW:"full",oneLine:!0},{type:"input",label:s("StyleSidePanel.design.terminalZhName"),value:y.terminal?y.terminal[0]:"",placeholder:"機場及博覽館",onChange:j=>_(bt([j,y.terminal?y.terminal[1]:""])),hidden:![Q.MTR].includes(n)||y.terminal===!1},{type:"input",label:s("StyleSidePanel.design.terminalEnName"),value:y.terminal?y.terminal[1]:"",placeholder:"Airport and AsiaWorld-Expo",onChange:j=>_(bt([y.terminal?y.terminal[0]:"",j])),hidden:![Q.MTR].includes(n)||y.terminal===!1}];return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("StyleSidePanel.design.title")}),f.jsx(ge,{fields:[...g,...A],minW:130}),f.jsx(Bt,{isOpen:m,onClose:()=>d(!1),defaultTheme:l,onUpdate:j=>_(Wr(j))})]})}function As(){const{t:s}=le(),_=_e(),{branches:n}=ee(m=>m.helper),{loop:l,loop_info:o}=ee(m=>m.param),{bank:e,left_and_right_factor:r,bottom_factor:t}=o,i=n.flat().filter((m=>d=>(m[d]=(m[d]||0)+1)===2)({})).filter(m=>!["linestart","lineend"].includes(m)),c=Math.abs(n[0].indexOf(i[0])-n[0].indexOf(i[1])),y=n.length>=2?(0,Math.min)(n[0].length-2-c,c):Math.floor((n[0].length-2-t*2)/2),h=[{type:"switch",label:s("StyleSidePanel.loop.isLoop"),isChecked:l,onChange:m=>_(Ur(m)),minW:"full",oneLine:!0},{type:"switch",label:s("StyleSidePanel.loop.isBank"),isChecked:e,onChange:m=>_(Zr(m)),minW:"full",oneLine:!0,hidden:!l},{type:"slider",label:s("StyleSidePanel.loop.leftRightFactor"),value:r,min:0,max:y,onChange:m=>_(Gr(Math.floor(m))),hidden:!l},{type:"slider",label:s("StyleSidePanel.loop.bottomFactor"),value:t,min:0,max:Math.floor((n[0].length-2-r*2)/2),onChange:m=>_($r(Math.floor(m))),hidden:!l||l&&n.length>2}];return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("StyleSidePanel.loop.title")}),f.jsx(ge,{fields:h})]})}function Os(s){const{note:_,onUpdate:n,onDelete:l}=s,{t:o}=le(),e=[{type:"textarea",label:o("StyleSidePanel.note.zhNote"),value:_[0],onChange:t=>n==null?void 0:n([t,_[1],_[2],_[3],_[4]])},{type:"textarea",label:o("StyleSidePanel.note.enNote"),value:_[1],onChange:t=>n==null?void 0:n([_[0],t,_[2],_[3],_[4]])},{type:"switch",label:o("StyleSidePanel.note.border"),isChecked:_[4],onChange:t=>n==null?void 0:n([_[0],_[1],_[2],_[3],t]),oneLine:!0}],r=[{type:"slider",label:o("StyleSidePanel.note.positionX"),value:_[2],min:0,max:100,onChange:t=>n==null?void 0:n([_[0],_[1],t,_[3],_[4]]),leftIcon:f.jsx(ln,{}),rightIcon:f.jsx(cn,{})},{type:"slider",label:o("StyleSidePanel.note.positionY"),value:_[3],min:0,max:100,onChange:t=>n==null?void 0:n([_[0],_[1],_[2],t,_[4]]),leftIcon:f.jsx(kt,{}),rightIcon:f.jsx(At,{})}];return f.jsxs(Be,{direction:"column",children:[f.jsx(ge,{fields:e,minW:"full"}),f.jsxs(Ie,{spacing:.5,sx:{"&>div":{flex:1}},children:[f.jsx(ge,{fields:r}),f.jsx(Le,{size:"sm",variant:"ghost","aria-label":o("StyleSidePanel.note.remove"),onClick:()=>l==null?void 0:l(),icon:f.jsx(zt,{})})]})]})}function Ps(){const{t:s}=le(),_=_e(),n=ee(l=>l.param.notesGZMTR);return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("StyleSidePanel.note.title")}),f.jsxs(ft,{spacing:.5,children:[n.map((l,o)=>f.jsx(Os,{note:l,onUpdate:e=>_(Yr(o,e)),onDelete:()=>_(qr(o))},o)),f.jsx(de,{size:"xs",variant:"ghost",leftIcon:f.jsx(ze,{}),alignSelf:"flex-end",onClick:()=>_(Kr()),children:s("StyleSidePanel.note.add")})]})]})}function Rs(){const{style:s}=ee(_=>_.param);return f.jsxs(Lt,{children:[f.jsx(js,{}),f.jsx(De,{}),f.jsx(ks,{}),s===Q.GZMTR&&f.jsxs(f.Fragment,{children:[f.jsx(De,{}),f.jsx(Ps,{})]}),s===Q.SHMetro&&f.jsxs(f.Fragment,{children:[f.jsx(De,{}),f.jsx(As,{})]})]})}const Vt=(s,_)=>{if(["linestart","lineend"].includes(s)||_[s].parents.length>1||_[s].children.length>1)return 0;const n=_[s].parents[0];return n?_[n].children.length===1?Vt(n,_):_[n].children.indexOf(s)===0?1:-1:0},Ts=s=>(_,n)=>{const{stn_list:l,current_stn_idx:o}=n().param;if(s===o)return console.log("removeStation():: failed as current station cannot be deleted"),!1;const{parents:e,children:r}=l[s];return Object.keys(l).length===4?(console.log("removeStation():: failed as only 2 stations remaining"),!1):e.length===2&&r.length===2?(console.log("removeStation():: failed as branches on both sides cannot be combined"),!1):Object.keys(l).some(i=>![s,"linestart","lineend"].includes(i)&&Vt(i,l)===0)?!0:(console.log("removeStation():: failed as selected station is the only station without siblings"),!1)},Cs=s=>(_,n)=>{const l=n().param.stn_list,{parents:o,children:e}=l[s];let r=JSON.parse(JSON.stringify(l));o.length===2||e.length===2?(o.forEach(t=>{r[t].children=e}),e.forEach(t=>{r[t].parents=o}),o.length===1&&(r[o[0]].branch.right=r[s].branch.right),e.length===1&&(r[e[0]].branch.left=r[s].branch.left)):l[o[0]].children.length===2&&l[e[0]].parents.length===2?r={...l,[o[0]]:{...l[o[0]],children:l[o[0]].children.filter(t=>t!==s),branch:{...l[o[0]].branch,right:[]}},[e[0]]:{...l[e[0]],parents:l[e[0]].parents.filter(t=>t!==s),branch:{...l[e[0]].branch,left:[]}}}:(o.forEach(t=>{const i=r[t].children.indexOf(s);e.length?r[t].children[i]=e[0]:r[t].children.splice(i,1),r[t].branch.right[1]===s&&(r[t].branch.right[1]=e[0])}),e.forEach(t=>{const i=r[t].parents.indexOf(s);o.length?r[t].parents[i]=o[0]:r[t].parents.splice(i,1),r[t].branch.left[1]===s&&(r[t].branch.left[1]=o[0])})),delete r[s],_(Me(r))};function Is(...s){return s.reduce((_,n)=>_.map(l=>n.map(o=>l.concat([o]))).reduce((l,o)=>l.concat(o),[]),[[]])}const et=(s,_)=>!!_[s[0]].children.indexOf(s[1]),bn=(s,_)=>[s[0][1],s[0][s[0].length-2],...s[0].filter(n=>s.slice(1).filter(l=>et(l,_)).map(l=>l.filter(o=>!["linestart","lineend"].includes(o))).map(l=>[l[0],l[l.length-1]]).flat().includes(n))],zs=(s,_)=>s.slice(1).filter(n=>et(n,_)).map(n=>n.filter(l=>!["linestart","lineend"].includes(l))).map(n=>[n[0],n[n.length-1]]),Ls=s=>(_,n)=>{const l=n().helper.branches;if(s===0){const o=n().param.stn_list,e=bn(l,o);return Is(e,e).filter(r=>r[0]!==r[1])}else{const o=l[s];if(o){const e=o.filter(r=>!["linestart","lineend"].includes(r));return[[e[0],e.slice(-1)[0]]]}else return[]}},Hi=(s,_)=>(n,l)=>{const o=l().param.coline,e=l().helper.branches[_];for(const[r,t]of Object.entries(o))if(t.from===s&&e.includes(t.to)){const i=e.indexOf(s),c=e.indexOf(t.to);if(c>i)return[c-i+1,r]}else if(t.to===s&&e.includes(t.to)){const i=e.indexOf(s),c=e.indexOf(t.from);if(c>i)return[c-i+1,r]}return[0,void 0]},Sn=(s,_)=>(n,l)=>{const o=l().param.stn_list,e=l().helper.branches;if(s===_)throw new Error("addColine():: failed for same stnId");const r=bn(e,o).filter(i=>[s,_].includes(i)),t=zs(e,o).filter(i=>[s,_].every(c=>i.includes(c)));if(r.length===2&&t.length>0)throw new Error(`addColine():: main check failed for ${s}, ${_}`);if(r.length!==2&&t.length!==1)throw new Error(`addColine():: branch check failed for ${s}, ${_}`)},Ds=s=>(_,n)=>{const l=n().param.coline,e=n().helper.branches[s];return e?Object.entries(l).reduce((r,t)=>e.includes(t[1].from)&&e.includes(t[1].to)?{...r,[t[0]]:t[1]}:{...r},{}):{}},Fs=s=>(_,n)=>{const l=n().param.coline;if(Object.keys(l).length===0)return;const o=Object.entries(l).reduce((e,r)=>r[1].from!==s&&r[1].to!==s?{...e,[r[0]]:r[1]}:{...e},{});_(Xe(o))},Bs=(s,_,n,l=!0)=>(o,e)=>{const r=e().param.coline;o(Sn(s,_)),o(Xe({...r,[qe(4)]:{from:s,to:_,colors:n,display:l}}))},Ms=(s,_,n,l=!0)=>(o,e)=>{const r=e().param.coline;if(s in r){o(Sn(_,n));const t={...r,[s]:{...r[s],from:_,to:n,display:l}};o(Xe(t))}},Vs=(s,_)=>(n,l)=>{const o=l().param.coline;if(s in o&&o[s].colors.length>_){const e=o[s].colors.filter((r,t)=>t!==_);if(e.length===0){const{[s]:r,...t}=o;n(Xe(t))}else{const r={...o,[s]:{...o[s],colors:e}};n(Xe(r))}}},Ns=(s,_,n)=>(l,o)=>{const e=o().param.coline;s in e&&e[s].colors.length>_&&(e[s].colors=e[s].colors.map((r,t)=>t===_?[0,1,2,3,4,5].map(i=>n[i]===void 0?r[i]:n[i]):r),l(Xe(e)))};function Hs(s){const{isOpen:_,onClose:n}=s,{t:l}=le(),o=_e(),e=ee(c=>c.app.selectedStation),[r,t]=K.useState(!1);K.useEffect(()=>{_||t(!1)},[_]);const i=()=>{const c=o(Ts(e));c?(n(),o(Je(Ve.CLOSE)),o(mn("linestart")),o(Fs(e)),o(Cs(e))):t(!0),he.event(ye.REMOVE_STATION,{success:c})};return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[r&&f.jsxs(_t,{status:"error",variant:"solid",size:"xs",children:[f.jsx(gt,{}),l("Unable to remove this station.")]}),f.jsxs(Ee,{position:"relative",children:[f.jsx(Ue,{children:l("Remove station")}),f.jsx(Ze,{})]}),f.jsx(Ge,{children:l("Are you sure to remove station? You cannot undo this action.")}),f.jsxs(Qe,{children:[f.jsx(de,{onClick:n,children:l("Cancel")}),f.jsx(de,{colorScheme:"primary",onClick:i,ml:3,children:l("Confirm")})]})]})]})}function Ws(){const{t:s}=le(),_=_e(),n=ee(e=>e.app.selectedStation),[l,o]=K.useState(!1);return f.jsxs(Nn,{children:[f.jsxs(Ie,{children:[f.jsx(de,{size:"sm",variant:"outline",onClick:()=>_(Pt(n)),children:s("StationSidePanel.footer.current")}),f.jsx(de,{size:"sm",variant:"outline",onClick:()=>o(!0),children:s("StationSidePanel.footer.remove")})]}),f.jsx(Hs,{isOpen:l,onClose:()=>o(!1)})]})}function Us(s){const{colineInfo:_,routeOptions:n,onUpdateRoute:l,onUpdateColourInfo:o,onDelete:e}=s,{t:r}=le(),[t,i]=K.useState(!1),c=[{type:"select",label:"Route",value:[_.from,_.to].join(","),options:n,onChange:h=>l==null?void 0:l(h)}],y=[{type:"custom",label:r("Colour"),component:f.jsx(Mt,{theme:[_.colors[0][0],_.colors[0][1],_.colors[0][2],_.colors[0][3]],onClick:()=>i(!0)})},{type:"input",label:r("Chinese name"),value:_.colors[0][4],minW:120,onChange:h=>o==null?void 0:o([_.colors[0][0],_.colors[0][1],_.colors[0][2],_.colors[0][3],h,_.colors[0][5]])},{type:"input",label:r("English name"),value:_.colors[0][5],minW:120,onChange:h=>o==null?void 0:o([_.colors[0][0],_.colors[0][1],_.colors[0][2],_.colors[0][3],_.colors[0][4],h])}];return f.jsxs(Be,{direction:"column",children:[f.jsx(ge,{fields:c,minW:"full"}),f.jsxs(Ie,{spacing:.5,children:[f.jsx(ge,{fields:y}),f.jsx(Le,{size:"sm",variant:"ghost","aria-label":"Delete colour for route",onClick:()=>e==null?void 0:e(0),icon:f.jsx(zt,{})})]}),f.jsx(Bt,{isOpen:t,onClose:()=>i(!1),defaultTheme:_.colors[0].slice(0,4),onUpdate:h=>o==null?void 0:o([...h,_.colors[0][4],_.colors[0][5]])})]})}function Zs(){const{t:s}=le(),_=_e(),n=ee(m=>m.app.selectedBranch),{theme:l,stn_list:o}=ee(m=>m.param),e=_(Ds(n)),r=_(Ls(n)),t=m=>m.map(d=>o[d].name.join(" - ")).join(" ~ "),i=r.reduce((m,d)=>({...m,[d.join(",")]:t(d)}),{}),c=()=>{console.log(`ColineSection.handleAddTrackSharing():: Adding track sharing to branch ${n} with default combination`,r[0]),_(Bs(r[0][0],r[0][1],[[l[0],"","#AAAAAA",xe.white,"",""]]))},y=m=>d=>{const[v,p]=d.split(",");console.log(`ColineSection.handleUpdateRoute():: Updating route, colineId=${m}, from=${v}, to=${p}`);try{_(Ms(m,v,p))}catch(b){_(Rt({status:"error",message:"Unable to draw this share track."}))}},h=(m,d)=>{_(Vs(m,d))};return f.jsxs(ft,{align:"flex-start",p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("BranchSidePanel.coline.title")}),Object.entries(e).map(([m,d])=>f.jsx(Us,{colineInfo:d,routeOptions:i,onUpdateRoute:y(m),onUpdateColourInfo:v=>_(Ns(m,0,v)),onDelete:v=>h(m,v)},m)),(n===0||Object.keys(e).length===0)&&f.jsx(de,{size:"xs",variant:"ghost",alignSelf:"flex-end",leftIcon:f.jsx(ze,{}),onClick:c,children:s("BranchSidePanel.coline.add")})]})}function Gs(s){const{isOpen:_,onClose:n}=s,{t:l}=le(),o=_e(),e=ee(j=>j.app.selectedBranch),{style:r,stn_list:t}=ee(j=>j.param),i=ee(j=>j.helper.branches),[c,y]=K.useState(e),[h,m]=K.useState("1"),[d,v]=K.useState("2"),[p,b]=K.useState("asc");K.useEffect(()=>{y(e)},[e]);const g=[{type:"select",label:l("AutoNumModal.where"),value:c,options:{...i.reduce((j,O,F)=>({...j,[F]:F===0?l("AutoNumModal.main"):r!==Q.SHMetro||!et(O,t)?l("AutoNumModal.branch")+" "+F:l("AutoNumModal.external")+" "+F}),{})},onChange:j=>y(j)},{type:"input",label:l("AutoNumModal.from"),value:h,validator:j=>!isNaN(Number(j)),onChange:m,debouncedDelay:0},{type:"input",label:l("AutoNumModal.maxLength"),validator:j=>!isNaN(Number(j)),value:d,onChange:v,debouncedDelay:0},{type:"select",label:l("AutoNumModal.sort"),value:p,options:{asc:l("AutoNumModal.asc"),desc:l("AutoNumModal.desc")},onChange:j=>b(j)}],x=()=>{o(Xr(c,Number(h),Number(d),p)),n(),he.event(ye.AUTO_NUMBERING,{})},A=!h||!d||isNaN(Number(h))||isNaN(Number(d));return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[f.jsx(Ue,{children:l("AutoNumModal.title")}),f.jsx(Ze,{}),f.jsx(Ge,{children:f.jsx(ge,{fields:g})}),f.jsx(Qe,{children:f.jsx(de,{colorScheme:"primary",isDisabled:A,onClick:x,children:l("Confirm")})})]})]})}const Nt=s=>(_,n)=>{const o=n().helper.branches[s];return o.includes("linestart")||o.includes("lineend")?1:2},xn=s=>(_,n)=>{const{branches:l}=n().helper,o=l[0],e=l[s];return o.slice(o.indexOf(e[0])+1,o.indexOf(e.slice(-1)[0]))},$s=(s,_)=>n=>n(Nt(_))===2?(console.log("isStationValid2ConnectBranch():: failed as current branch has 2 connected ends"),!1):n(xn(_)).includes(s)?!0:(console.log("isStationValid2ConnectBranch():: failed as the target station is invalid"),!1),Ys=(s,_)=>(n,l)=>{if(!n($s(s,_)))return!1;const{branches:e}=l().helper,r=l().param.stn_list,t=e[_];if(t[0]==="linestart"){const i={...r,[t[1]]:{...r[t[1]],parents:[s]},[s]:{...r[s],children:r.linestart.children.map(c=>c===t[1]?c:r[s].children[0]),branch:{left:[],right:r.linestart.branch.right}},linestart:{...r.linestart,children:r.linestart.children.filter(c=>c!==t[1]),branch:{left:[],right:[]}}};return n(Me(i)),!0}else{const i=t.slice(-2)[0],c={...r,[i]:{...r[i],children:[s]},[s]:{...r[s],parents:r.lineend.parents.map(y=>y===i?y:r[s].parents[0]),branch:{right:[],left:r.lineend.branch.left}},lineend:{...r.lineend,parents:r.lineend.parents.filter(y=>y!==i),branch:{left:[],right:[]}}};return n(Me(c)),!0}},En=s=>(_,n)=>{const{branches:l}=n().helper,o=n().param.stn_list,e=l[0],r=l[s];if(_(Nt(s))!==2)return console.log("getPossibleDirection():: failed as there is no possible direction"),[];const i=e.indexOf(r[0]),c=e.slice(0,i),y=e.indexOf(r.slice(-1)[0]),h=e.slice(y+1),m=c.every(v=>o[v].children.length<=1&&o[v].parents.length<=1),d=h.every(v=>o[v].children.length<=1&&o[v].parents.length<=1);return m?d?[je.left,je.right]:[je.left]:d?[je.right]:[]},qs=(s,_)=>(n,l)=>{if(!n(En(_)).includes(s))return console.log("disconnectFromMainLine():: failed as the aim direction is not in the possible direction list"),!1;const{branches:e}=l().helper,r=l().param.stn_list,t=e[0],i=e[_];if(s===je.left){const c=i[0],y={...r,[i[1]]:{...r[i[1]],parents:["linestart"]},[c]:{...r[c],children:r[c].children.filter(h=>h!==i[1]),branch:{right:[],left:[]}},linestart:{...r.linestart,children:r[c].children.map(h=>h===i[1]?h:t[1]),branch:{left:[],right:r[c].branch.right}}};return n(Me(y)),!0}else{const c=i.slice(-1)[0],y=i.slice(-2)[0],h={...r,[y]:{...r[y],children:["lineend"]},[c]:{...r[c],parents:r[c].parents.filter(m=>m!==y),branch:{right:[],left:[]}},lineend:{...r.lineend,parents:r[c].parents.map(m=>m===y?m:t.slice(-2)[0]),branch:{right:[],left:r[c].branch.left}}};return n(Me(h)),!0}};function tn(s){const{direction:_}=s,{t:n}=le(),l=_e(),{branches:o}=ee(I=>I.helper),e=ee(I=>I.app.selectedBranch),{style:r,stn_list:t}=ee(I=>I.param),[i,c]=K.useState(!1),[y,h]=K.useState(""),m=o[e].filter(I=>!["linestart","lineend"].includes(I)),d=_===je.left?m[0]:m.slice(-1)[0],v=t[d],p=l(xn(e)),b=l(Nt(e)),g=l(En(e)),x=b===1&&!o[0].includes(d),A=g.includes(_),j=p.reduce((I,B)=>{var T;return{...I,[B]:(T=t[B])==null?void 0:T.name.join(" - ")}},{"":n("Please select...")}),O=()=>{const I=l(Ys(y,e));I?c(!1):l(Rt({status:"error",message:n("Unable to connect to main line.")})),he.event(ye.CONNECT_BRANCH,{style:r,success:I})},F=()=>{const I=l(qs(_,e));I||l(Rt({status:"error",message:n("Unable to disconnect from main line.")})),he.event(ye.DISCONNECT_BRANCH,{style:r,success:I})};return f.jsxs(Be,{direction:"column",children:[f.jsxs(Pe,{alignItems:"center",children:[f.jsx(jt,{label:n("Station name"),flex:1,children:f.jsx(Hn,{defaultValue:v.name.join(" "),isDisabled:!0})}),i?f.jsx(de,{mx:1,size:"sm",variant:"outline",onClick:()=>c(!1),children:n("Cancel")}):x?f.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:()=>c(!0),children:n("Connect to main line")}):f.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:F,isDisabled:!A,children:n("Disconnect from main line")})]}),i&&f.jsxs(Pe,{alignItems:"center",children:[f.jsx(jt,{label:n("Target station"),flex:1,children:f.jsx(Wn,{defaultValue:y,options:j,disabledOptions:[""],onChange:({target:{value:I}})=>h(I)})}),f.jsx(de,{mx:1,size:"sm",variant:"solid",colorScheme:"primary",onClick:O,isDisabled:!y,children:n("Confirm")})]})]})}function Ks(){const{t:s}=le(),_=_e(),n=ee(t=>t.param.style),l=ee(t=>t.app.selectedBranch),[o,e]=K.useState(!1),r=()=>{_(Jr(n===Q.SHMetro)),he.event(ye.REVERSE_STATIONS,{style:n})};return f.jsxs(Ee,{p:1,children:[f.jsx(Se,{as:"h5",size:"sm",children:s("BranchSidePanel.action.title")}),f.jsxs(Pe,{wrap:"wrap",sx:{p:1,"&> *":{flexShrink:0,flexBasis:"100%","&:not(:first-of-type)":{marginTop:2}}},children:[l!==0&&n!==Q.SHMetro&&f.jsxs(f.Fragment,{children:[f.jsx(Se,{as:"h6",size:"xs",children:s("Branch left end")}),f.jsx(tn,{direction:je.left}),f.jsx(Se,{as:"h6",size:"xs",children:s("Branch right end")}),f.jsx(tn,{direction:je.right})]}),n===Q.GZMTR&&f.jsx(de,{size:"sm",variant:"outline",leftIcon:f.jsx(Un,{}),alignSelf:"flex-end",onClick:()=>e(!0),children:s("BranchSidePanel.action.autoNum")}),f.jsx(de,{size:"sm",variant:"outline",leftIcon:f.jsx(Zn,{}),alignSelf:"flex-end",onClick:r,children:n===Q.SHMetro?s("BranchSidePanel.action.flip"):s("BranchSidePanel.action.reverse")})]}),f.jsx(Gs,{isOpen:o,onClose:()=>e(!1)})]})}function Xs(){const s=ee(o=>o.app.selectedBranch),{style:_,stn_list:n}=ee(o=>o.param),l=ee(o=>o.helper.branches);return f.jsxs(Lt,{children:[_===Q.SHMetro&&(s===0||et(l[s],n))&&f.jsxs(f.Fragment,{children:[f.jsx(Zs,{}),f.jsx(De,{})]}),f.jsx(Ks,{})]})}const Js=375;function Qs(){var t,i;const{t:s}=le(),_=Dt(),{sidePanelMode:n,selectedStation:l}=ee(c=>c.app),o=ee(c=>{var y;return(y=c.param.stn_list[l])==null?void 0:y.name}),e={STATION:{header:f.jsx(Gn,{text:(o==null?void 0:o.join(" - "))||""}),body:f.jsx(ws,{}),footer:f.jsx(Ws,{})},STYLE:{header:s("StyleSidePanel.header"),body:f.jsx(Rs,{})},BRANCH:{header:s("BranchSidePanel.header"),body:f.jsx(Xs,{})},CLOSE:{header:"Close"}},r=()=>{_(Je(Ve.CLOSE))};return f.jsxs($n,{isOpen:n!==Ve.CLOSE,width:Js,header:"Dummy header",children:[f.jsx(Yn,{onClose:r,children:e[n].header}),(t=e[n])==null?void 0:t.body,(i=e[n])==null?void 0:i.footer]})}function ut(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var wn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,_){(function(n){s.exports=n()})(function(){return function n(l,o,e){function r(c,y){if(!o[c]){if(!l[c]){var h=typeof ut=="function"&&ut;if(!y&&h)return h(c,!0);if(t)return t(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var d=o[c]={exports:{}};l[c][0].call(d.exports,function(v){var p=l[c][1][v];return r(p||v)},d,d.exports,n,l,o,e)}return o[c].exports}for(var t=typeof ut=="function"&&ut,i=0;i<e.length;i++)r(e[i]);return r}({1:[function(n,l,o){var e=n("./utils"),r=n("./support"),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(i){for(var c,y,h,m,d,v,p,b=[],g=0,x=i.length,A=x,j=e.getTypeOf(i)!=="string";g<i.length;)A=x-g,h=j?(c=i[g++],y=g<x?i[g++]:0,g<x?i[g++]:0):(c=i.charCodeAt(g++),y=g<x?i.charCodeAt(g++):0,g<x?i.charCodeAt(g++):0),m=c>>2,d=(3&c)<<4|y>>4,v=1<A?(15&y)<<2|h>>6:64,p=2<A?63&h:64,b.push(t.charAt(m)+t.charAt(d)+t.charAt(v)+t.charAt(p));return b.join("")},o.decode=function(i){var c,y,h,m,d,v,p=0,b=0,g="data:";if(i.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,A=3*(i=i.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(i.charAt(i.length-1)===t.charAt(64)&&A--,i.charAt(i.length-2)===t.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=r.uint8array?new Uint8Array(0|A):new Array(0|A);p<i.length;)c=t.indexOf(i.charAt(p++))<<2|(m=t.indexOf(i.charAt(p++)))>>4,y=(15&m)<<4|(d=t.indexOf(i.charAt(p++)))>>2,h=(3&d)<<6|(v=t.indexOf(i.charAt(p++))),x[b++]=c,d!==64&&(x[b++]=y),v!==64&&(x[b++]=h);return x}},{"./support":30,"./utils":32}],2:[function(n,l,o){var e=n("./external"),r=n("./stream/DataWorker"),t=n("./stream/Crc32Probe"),i=n("./stream/DataLengthProbe");function c(y,h,m,d,v){this.compressedSize=y,this.uncompressedSize=h,this.crc32=m,this.compression=d,this.compressedContent=v}c.prototype={getContentWorker:function(){var y=new r(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new i("data_length")),h=this;return y.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),y},getCompressedWorker:function(){return new r(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(y,h,m){return y.pipe(new t).pipe(new i("uncompressedSize")).pipe(h.compressWorker(m)).pipe(new i("compressedSize")).withStreamInfo("compression",h)},l.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,l,o){var e=n("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}},o.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,l,o){var e=n("./utils"),r=function(){for(var t,i=[],c=0;c<256;c++){t=c;for(var y=0;y<8;y++)t=1&t?3988292384^t>>>1:t>>>1;i[c]=t}return i}();l.exports=function(t,i){return t!==void 0&&t.length?e.getTypeOf(t)!=="string"?function(c,y,h,m){var d=r,v=m+h;c^=-1;for(var p=m;p<v;p++)c=c>>>8^d[255&(c^y[p])];return-1^c}(0|i,t,t.length,0):function(c,y,h,m){var d=r,v=m+h;c^=-1;for(var p=m;p<v;p++)c=c>>>8^d[255&(c^y.charCodeAt(p))];return-1^c}(0|i,t,t.length,0):0}},{"./utils":32}],5:[function(n,l,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(n,l,o){var e=null;e=typeof Promise<"u"?Promise:n("lie"),l.exports={Promise:e}},{lie:37}],7:[function(n,l,o){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=n("pako"),t=n("./utils"),i=n("./stream/GenericWorker"),c=e?"uint8array":"array";function y(h,m){i.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=m,this.meta={}}o.magic="\b\0",t.inherits(y,i),y.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(t.transformTo(c,h.data),!1)},y.prototype.flush=function(){i.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},y.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._pako=null},y.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(m){h.push({data:m,meta:h.meta})}},o.compressWorker=function(h){return new y("Deflate",h)},o.uncompressWorker=function(){return new y("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,l,o){function e(d,v){var p,b="";for(p=0;p<v;p++)b+=String.fromCharCode(255&d),d>>>=8;return b}function r(d,v,p,b,g,x){var A,j,O=d.file,F=d.compression,I=x!==c.utf8encode,B=t.transformTo("string",x(O.name)),T=t.transformTo("string",c.utf8encode(O.name)),N=O.comment,Y=t.transformTo("string",x(N)),k=t.transformTo("string",c.utf8encode(N)),D=T.length!==O.name.length,u=k.length!==N.length,M="",re="",U="",ie=O.dir,Z=O.date,se={crc32:0,compressedSize:0,uncompressedSize:0};v&&!p||(se.crc32=d.crc32,se.compressedSize=d.compressedSize,se.uncompressedSize=d.uncompressedSize);var z=0;v&&(z|=8),I||!D&&!u||(z|=2048);var C=0,ne=0;ie&&(C|=16),g==="UNIX"?(ne=798,C|=function(q,pe){var be=q;return q||(be=pe?16893:33204),(65535&be)<<16}(O.unixPermissions,ie)):(ne=20,C|=function(q){return 63&(q||0)}(O.dosPermissions)),A=Z.getUTCHours(),A<<=6,A|=Z.getUTCMinutes(),A<<=5,A|=Z.getUTCSeconds()/2,j=Z.getUTCFullYear()-1980,j<<=4,j|=Z.getUTCMonth()+1,j<<=5,j|=Z.getUTCDate(),D&&(re=e(1,1)+e(y(B),4)+T,M+="up"+e(re.length,2)+re),u&&(U=e(1,1)+e(y(Y),4)+k,M+="uc"+e(U.length,2)+U);var X="";return X+=`
\0`,X+=e(z,2),X+=F.magic,X+=e(A,2),X+=e(j,2),X+=e(se.crc32,4),X+=e(se.compressedSize,4),X+=e(se.uncompressedSize,4),X+=e(B.length,2),X+=e(M.length,2),{fileRecord:h.LOCAL_FILE_HEADER+X+B+M,dirRecord:h.CENTRAL_FILE_HEADER+e(ne,2)+X+e(Y.length,2)+"\0\0\0\0"+e(C,4)+e(b,4)+B+M+Y}}var t=n("../utils"),i=n("../stream/GenericWorker"),c=n("../utf8"),y=n("../crc32"),h=n("../signature");function m(d,v,p,b){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=v,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}t.inherits(m,i),m.prototype.push=function(d){var v=d.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,i.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:p?(v+100*(p-b-1))/p:100}}))},m.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var v=this.streamFiles&&!d.file.dir;if(v){var p=r(d,v,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(d){this.accumulate=!1;var v=this.streamFiles&&!d.file.dir,p=r(d,v,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),v)this.push({data:function(b){return h.DATA_DESCRIPTOR+e(b.crc32,4)+e(b.compressedSize,4)+e(b.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var d=this.bytesWritten,v=0;v<this.dirRecords.length;v++)this.push({data:this.dirRecords[v],meta:{percent:100}});var p=this.bytesWritten-d,b=function(g,x,A,j,O){var F=t.transformTo("string",O(j));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+e(g,2)+e(g,2)+e(x,4)+e(A,4)+e(F.length,2)+F}(this.dirRecords.length,p,d,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(d){this._sources.push(d);var v=this;return d.on("data",function(p){v.processChunk(p)}),d.on("end",function(){v.closedSource(v.previous.streamInfo),v._sources.length?v.prepareNextSource():v.end()}),d.on("error",function(p){v.error(p)}),this},m.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(d){var v=this._sources;if(!i.prototype.error.call(this,d))return!1;for(var p=0;p<v.length;p++)try{v[p].error(d)}catch(b){}return!0},m.prototype.lock=function(){i.prototype.lock.call(this);for(var d=this._sources,v=0;v<d.length;v++)d[v].lock()},l.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,l,o){var e=n("../compressions"),r=n("./ZipFileWorker");o.generateWorker=function(t,i,c){var y=new r(i.streamFiles,c,i.platform,i.encodeFileName),h=0;try{t.forEach(function(m,d){h++;var v=function(x,A){var j=x||A,O=e[j];if(!O)throw new Error(j+" is not a valid compression method !");return O}(d.options.compression,i.compression),p=d.options.compressionOptions||i.compressionOptions||{},b=d.dir,g=d.date;d._compressWorker(v,p).withStreamInfo("file",{name:m,dir:b,date:g,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(y)}),y.entriesCount=h}catch(m){y.error(m)}return y}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,l,o){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new e;for(var t in this)typeof this[t]!="function"&&(r[t]=this[t]);return r}}(e.prototype=n("./object")).loadAsync=n("./load"),e.support=n("./support"),e.defaults=n("./defaults"),e.version="3.10.1",e.loadAsync=function(r,t){return new e().loadAsync(r,t)},e.external=n("./external"),l.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,l,o){var e=n("./utils"),r=n("./external"),t=n("./utf8"),i=n("./zipEntries"),c=n("./stream/Crc32Probe"),y=n("./nodejsUtils");function h(m){return new r.Promise(function(d,v){var p=m.decompressed.getContentWorker().pipe(new c);p.on("error",function(b){v(b)}).on("end",function(){p.streamInfo.crc32!==m.decompressed.crc32?v(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}l.exports=function(m,d){var v=this;return d=e.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:t.utf8decode}),y.isNode&&y.isStream(m)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",m,!0,d.optimizedBinaryString,d.base64).then(function(p){var b=new i(d);return b.load(p),b}).then(function(p){var b=[r.Promise.resolve(p)],g=p.files;if(d.checkCRC32)for(var x=0;x<g.length;x++)b.push(h(g[x]));return r.Promise.all(b)}).then(function(p){for(var b=p.shift(),g=b.files,x=0;x<g.length;x++){var A=g[x],j=A.fileNameStr,O=e.resolve(A.fileNameStr);v.file(O,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:d.createFolders}),A.dir||(v.file(O).unsafeOriginalName=j)}return b.zipComment.length&&(v.comment=b.zipComment),v})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,l,o){var e=n("../utils"),r=n("../stream/GenericWorker");function t(i,c){r.call(this,"Nodejs stream input adapter for "+i),this._upstreamEnded=!1,this._bindStream(c)}e.inherits(t,r),t.prototype._bindStream=function(i){var c=this;(this._stream=i).pause(),i.on("data",function(y){c.push({data:y,meta:{percent:0}})}).on("error",function(y){c.isPaused?this.generatedError=y:c.error(y)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},t.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},t.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=t},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,l,o){var e=n("readable-stream").Readable;function r(t,i,c){e.call(this,i),this._helper=t;var y=this;t.on("data",function(h,m){y.push(h)||y._helper.pause(),c&&c(m)}).on("error",function(h){y.emit("error",h)}).on("end",function(){y.push(null)})}n("../utils").inherits(r,e),r.prototype._read=function(){this._helper.resume()},l.exports=r},{"../utils":32,"readable-stream":16}],14:[function(n,l,o){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(e,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,r);if(typeof e=="number")throw new Error('The "data" argument must not be a number');return new Buffer(e,r)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var r=new Buffer(e);return r.fill(0),r},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&typeof e.on=="function"&&typeof e.pause=="function"&&typeof e.resume=="function"}}},{}],15:[function(n,l,o){function e(O,F,I){var B,T=t.getTypeOf(F),N=t.extend(I||{},y);N.date=N.date||new Date,N.compression!==null&&(N.compression=N.compression.toUpperCase()),typeof N.unixPermissions=="string"&&(N.unixPermissions=parseInt(N.unixPermissions,8)),N.unixPermissions&&16384&N.unixPermissions&&(N.dir=!0),N.dosPermissions&&16&N.dosPermissions&&(N.dir=!0),N.dir&&(O=g(O)),N.createFolders&&(B=b(O))&&x.call(this,B,!0);var Y=T==="string"&&N.binary===!1&&N.base64===!1;I&&I.binary!==void 0||(N.binary=!Y),(F instanceof h&&F.uncompressedSize===0||N.dir||!F||F.length===0)&&(N.base64=!1,N.binary=!0,F="",N.compression="STORE",T="string");var k=null;k=F instanceof h||F instanceof i?F:v.isNode&&v.isStream(F)?new p(O,F):t.prepareContent(O,F,N.binary,N.optimizedBinaryString,N.base64);var D=new m(O,k,N);this.files[O]=D}var r=n("./utf8"),t=n("./utils"),i=n("./stream/GenericWorker"),c=n("./stream/StreamHelper"),y=n("./defaults"),h=n("./compressedObject"),m=n("./zipObject"),d=n("./generate"),v=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),b=function(O){O.slice(-1)==="/"&&(O=O.substring(0,O.length-1));var F=O.lastIndexOf("/");return 0<F?O.substring(0,F):""},g=function(O){return O.slice(-1)!=="/"&&(O+="/"),O},x=function(O,F){return F=F!==void 0?F:y.createFolders,O=g(O),this.files[O]||e.call(this,O,null,{dir:!0,createFolders:F}),this.files[O]};function A(O){return Object.prototype.toString.call(O)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(O){var F,I,B;for(F in this.files)B=this.files[F],(I=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&O(I,B)},filter:function(O){var F=[];return this.forEach(function(I,B){O(I,B)&&F.push(B)}),F},file:function(O,F,I){if(arguments.length!==1)return O=this.root+O,e.call(this,O,F,I),this;if(A(O)){var B=O;return this.filter(function(N,Y){return!Y.dir&&B.test(N)})}var T=this.files[this.root+O];return T&&!T.dir?T:null},folder:function(O){if(!O)return this;if(A(O))return this.filter(function(T,N){return N.dir&&O.test(T)});var F=this.root+O,I=x.call(this,F),B=this.clone();return B.root=I.name,B},remove:function(O){O=this.root+O;var F=this.files[O];if(F||(O.slice(-1)!=="/"&&(O+="/"),F=this.files[O]),F&&!F.dir)delete this.files[O];else for(var I=this.filter(function(T,N){return N.name.slice(0,O.length)===O}),B=0;B<I.length;B++)delete this.files[I[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(O){var F,I={};try{if((I=t.extend(O||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");t.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var B=I.comment||this.comment||"";F=d.generateWorker(this,I,B)}catch(T){(F=new i("error")).error(T)}return new c(F,I.type||"string",I.mimeType)},generateAsync:function(O,F){return this.generateInternalStream(O).accumulate(F)},generateNodeStream:function(O,F){return(O=O||{}).type||(O.type="nodebuffer"),this.generateInternalStream(O).toNodejsStream(F)}};l.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,l,o){l.exports=n("stream")},{stream:void 0}],17:[function(n,l,o){var e=n("./DataReader");function r(t){e.call(this,t);for(var i=0;i<this.data.length;i++)t[i]=255&t[i]}n("../utils").inherits(r,e),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var i=t.charCodeAt(0),c=t.charCodeAt(1),y=t.charCodeAt(2),h=t.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===i&&this.data[m+1]===c&&this.data[m+2]===y&&this.data[m+3]===h)return m-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var i=t.charCodeAt(0),c=t.charCodeAt(1),y=t.charCodeAt(2),h=t.charCodeAt(3),m=this.readData(4);return i===m[0]&&c===m[1]&&y===m[2]&&h===m[3]},r.prototype.readData=function(t){if(this.checkOffset(t),t===0)return[];var i=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=r},{"../utils":32,"./DataReader":18}],18:[function(n,l,o){var e=n("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var i,c=0;for(this.checkOffset(t),i=this.index+t-1;i>=this.index;i--)c=(c<<8)+this.byteAt(i);return this.index+=t,c},readString:function(t){return e.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},l.exports=r},{"../utils":32}],19:[function(n,l,o){var e=n("./Uint8ArrayReader");function r(t){e.call(this,t)}n("../utils").inherits(r,e),r.prototype.readData=function(t){this.checkOffset(t);var i=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,l,o){var e=n("./DataReader");function r(t){e.call(this,t)}n("../utils").inherits(r,e),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var i=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=r},{"../utils":32,"./DataReader":18}],21:[function(n,l,o){var e=n("./ArrayReader");function r(t){e.call(this,t)}n("../utils").inherits(r,e),r.prototype.readData=function(t){if(this.checkOffset(t),t===0)return new Uint8Array(0);var i=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,i},l.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(n,l,o){var e=n("../utils"),r=n("../support"),t=n("./ArrayReader"),i=n("./StringReader"),c=n("./NodeBufferReader"),y=n("./Uint8ArrayReader");l.exports=function(h){var m=e.getTypeOf(h);return e.checkSupport(m),m!=="string"||r.uint8array?m==="nodebuffer"?new c(h):r.uint8array?new y(e.transformTo("uint8array",h)):new t(e.transformTo("array",h)):new i(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,l,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,l,o){var e=n("./GenericWorker"),r=n("../utils");function t(i){e.call(this,"ConvertWorker to "+i),this.destType=i}r.inherits(t,e),t.prototype.processChunk=function(i){this.push({data:r.transformTo(this.destType,i.data),meta:i.meta})},l.exports=t},{"../utils":32,"./GenericWorker":28}],25:[function(n,l,o){var e=n("./GenericWorker"),r=n("../crc32");function t(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(t,e),t.prototype.processChunk=function(i){this.streamInfo.crc32=r(i.data,this.streamInfo.crc32||0),this.push(i)},l.exports=t},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,l,o){var e=n("../utils"),r=n("./GenericWorker");function t(i){r.call(this,"DataLengthProbe for "+i),this.propName=i,this.withStreamInfo(i,0)}e.inherits(t,r),t.prototype.processChunk=function(i){if(i){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+i.data.length}r.prototype.processChunk.call(this,i)},l.exports=t},{"../utils":32,"./GenericWorker":28}],27:[function(n,l,o){var e=n("../utils"),r=n("./GenericWorker");function t(i){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,i.then(function(y){c.dataIsReady=!0,c.data=y,c.max=y&&y.length||0,c.type=e.getTypeOf(y),c.isPaused||c._tickAndRepeat()},function(y){c.error(y)})}e.inherits(t,r),t.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},t.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},t.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},t.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var i=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":i=this.data.substring(this.index,c);break;case"uint8array":i=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":i=this.data.slice(this.index,c)}return this.index=c,this.push({data:i,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=t},{"../utils":32,"./GenericWorker":28}],28:[function(n,l,o){function e(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}e.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,t){return this._listeners[r].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,t){if(this._listeners[r])for(var i=0;i<this._listeners[r].length;i++)this._listeners[r][i].call(this,t)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var t=this;return r.on("data",function(i){t.processChunk(i)}),r.on("end",function(){t.end()}),r.on("error",function(i){t.error(i)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,t){return this.extraStreamInfo[r]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},l.exports=e},{}],29:[function(n,l,o){var e=n("../utils"),r=n("./ConvertWorker"),t=n("./GenericWorker"),i=n("../base64"),c=n("../support"),y=n("../external"),h=null;if(c.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch(v){}function m(v,p){return new y.Promise(function(b,g){var x=[],A=v._internalType,j=v._outputType,O=v._mimeType;v.on("data",function(F,I){x.push(F),p&&p(I)}).on("error",function(F){x=[],g(F)}).on("end",function(){try{var F=function(I,B,T){switch(I){case"blob":return e.newBlob(e.transformTo("arraybuffer",B),T);case"base64":return i.encode(B);default:return e.transformTo(I,B)}}(j,function(I,B){var T,N=0,Y=null,k=0;for(T=0;T<B.length;T++)k+=B[T].length;switch(I){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Y=new Uint8Array(k),T=0;T<B.length;T++)Y.set(B[T],N),N+=B[T].length;return Y;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+I+"'")}}(A,x),O);b(F)}catch(I){g(I)}x=[]}).resume()})}function d(v,p,b){var g=p;switch(p){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=p,this._mimeType=b,e.checkSupport(g),this._worker=v.pipe(new r(g)),v.lock()}catch(x){this._worker=new t("error"),this._worker.error(x)}}d.prototype={accumulate:function(v){return m(this,v)},on:function(v,p){var b=this;return v==="data"?this._worker.on(v,function(g){p.call(b,g.data,g.meta)}):this._worker.on(v,function(){e.delay(p,arguments,b)}),this},resume:function(){return e.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(v){if(e.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},v)}},l.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,l,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var e=new ArrayBuffer(0);try{o.blob=new Blob([e],{type:"application/zip"}).size===0}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(e),o.blob=r.getBlob("application/zip").size===0}catch(i){o.blob=!1}}}try{o.nodestream=!!n("readable-stream").Readable}catch(t){o.nodestream=!1}},{"readable-stream":16}],31:[function(n,l,o){for(var e=n("./utils"),r=n("./support"),t=n("./nodejsUtils"),i=n("./stream/GenericWorker"),c=new Array(256),y=0;y<256;y++)c[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;c[254]=c[254]=1;function h(){i.call(this,"utf-8 decode"),this.leftOver=null}function m(){i.call(this,"utf-8 encode")}o.utf8encode=function(d){return r.nodebuffer?t.newBufferFrom(d,"utf-8"):function(v){var p,b,g,x,A,j=v.length,O=0;for(x=0;x<j;x++)(64512&(b=v.charCodeAt(x)))==55296&&x+1<j&&(64512&(g=v.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),x++),O+=b<128?1:b<2048?2:b<65536?3:4;for(p=r.uint8array?new Uint8Array(O):new Array(O),x=A=0;A<O;x++)(64512&(b=v.charCodeAt(x)))==55296&&x+1<j&&(64512&(g=v.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),x++),b<128?p[A++]=b:(b<2048?p[A++]=192|b>>>6:(b<65536?p[A++]=224|b>>>12:(p[A++]=240|b>>>18,p[A++]=128|b>>>12&63),p[A++]=128|b>>>6&63),p[A++]=128|63&b);return p}(d)},o.utf8decode=function(d){return r.nodebuffer?e.transformTo("nodebuffer",d).toString("utf-8"):function(v){var p,b,g,x,A=v.length,j=new Array(2*A);for(p=b=0;p<A;)if((g=v[p++])<128)j[b++]=g;else if(4<(x=c[g]))j[b++]=65533,p+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&p<A;)g=g<<6|63&v[p++],x--;1<x?j[b++]=65533:g<65536?j[b++]=g:(g-=65536,j[b++]=55296|g>>10&1023,j[b++]=56320|1023&g)}return j.length!==b&&(j.subarray?j=j.subarray(0,b):j.length=b),e.applyFromCharCode(j)}(d=e.transformTo(r.uint8array?"uint8array":"array",d))},e.inherits(h,i),h.prototype.processChunk=function(d){var v=e.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var p=v;(v=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),v.set(p,this.leftOver.length)}else v=this.leftOver.concat(v);this.leftOver=null}var b=function(x,A){var j;for((A=A||x.length)>x.length&&(A=x.length),j=A-1;0<=j&&(192&x[j])==128;)j--;return j<0||j===0?A:j+c[x[j]]>A?j:A}(v),g=v;b!==v.length&&(r.uint8array?(g=v.subarray(0,b),this.leftOver=v.subarray(b,v.length)):(g=v.slice(0,b),this.leftOver=v.slice(b,v.length))),this.push({data:o.utf8decode(g),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=h,e.inherits(m,i),m.prototype.processChunk=function(d){this.push({data:o.utf8encode(d.data),meta:d.meta})},o.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,l,o){var e=n("./support"),r=n("./base64"),t=n("./nodejsUtils"),i=n("./external");function c(p){return p}function y(p,b){for(var g=0;g<p.length;++g)b[g]=255&p.charCodeAt(g);return b}n("setimmediate"),o.newBlob=function(p,b){o.checkSupport("blob");try{return new Blob([p],{type:b})}catch(x){try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(p),g.getBlob(b)}catch(A){throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(p,b,g){var x=[],A=0,j=p.length;if(j<=g)return String.fromCharCode.apply(null,p);for(;A<j;)b==="array"||b==="nodebuffer"?x.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+g,j)))):x.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+g,j)))),A+=g;return x.join("")},stringifyByChar:function(p){for(var b="",g=0;g<p.length;g++)b+=String.fromCharCode(p[g]);return b},applyCanBeUsed:{uint8array:function(){try{return e.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(p){return!1}}(),nodebuffer:function(){try{return e.nodebuffer&&String.fromCharCode.apply(null,t.allocBuffer(1)).length===1}catch(p){return!1}}()}};function m(p){var b=65536,g=o.getTypeOf(p),x=!0;if(g==="uint8array"?x=h.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=h.applyCanBeUsed.nodebuffer),x)for(;1<b;)try{return h.stringifyByChunk(p,g,b)}catch(A){b=Math.floor(b/2)}return h.stringifyByChar(p)}function d(p,b){for(var g=0;g<p.length;g++)b[g]=p[g];return b}o.applyFromCharCode=m;var v={};v.string={string:c,array:function(p){return y(p,new Array(p.length))},arraybuffer:function(p){return v.string.uint8array(p).buffer},uint8array:function(p){return y(p,new Uint8Array(p.length))},nodebuffer:function(p){return y(p,t.allocBuffer(p.length))}},v.array={string:m,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return t.newBufferFrom(p)}},v.arraybuffer={string:function(p){return m(new Uint8Array(p))},array:function(p){return d(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return t.newBufferFrom(new Uint8Array(p))}},v.uint8array={string:m,array:function(p){return d(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return t.newBufferFrom(p)}},v.nodebuffer={string:m,array:function(p){return d(p,new Array(p.length))},arraybuffer:function(p){return v.nodebuffer.uint8array(p).buffer},uint8array:function(p){return d(p,new Uint8Array(p.length))},nodebuffer:c},o.transformTo=function(p,b){if(b=b||"",!p)return b;o.checkSupport(p);var g=o.getTypeOf(b);return v[g][p](b)},o.resolve=function(p){for(var b=p.split("/"),g=[],x=0;x<b.length;x++){var A=b[x];A==="."||A===""&&x!==0&&x!==b.length-1||(A===".."?g.pop():g.push(A))}return g.join("/")},o.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":e.nodebuffer&&t.isBuffer(p)?"nodebuffer":e.uint8array&&p instanceof Uint8Array?"uint8array":e.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(p){if(!e[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(p){var b,g,x="";for(g=0;g<(p||"").length;g++)x+="\\x"+((b=p.charCodeAt(g))<16?"0":"")+b.toString(16).toUpperCase();return x},o.delay=function(p,b,g){setImmediate(function(){p.apply(g||null,b||[])})},o.inherits=function(p,b){function g(){}g.prototype=b.prototype,p.prototype=new g},o.extend=function(){var p,b,g={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&g[b]===void 0&&(g[b]=arguments[p][b]);return g},o.prepareContent=function(p,b,g,x,A){return i.Promise.resolve(b).then(function(j){return e.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new i.Promise(function(O,F){var I=new FileReader;I.onload=function(B){O(B.target.result)},I.onerror=function(B){F(B.target.error)},I.readAsArrayBuffer(j)}):j}).then(function(j){var O=o.getTypeOf(j);return O?(O==="arraybuffer"?j=o.transformTo("uint8array",j):O==="string"&&(A?j=r.decode(j):g&&x!==!0&&(j=function(F){return y(F,e.uint8array?new Uint8Array(F.length):new Array(F.length))}(j))),j):i.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,l,o){var e=n("./reader/readerFor"),r=n("./utils"),t=n("./signature"),i=n("./zipEntry"),c=n("./support");function y(h){this.files=[],this.loadOptions=h}y.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(m)+", expected "+r.pretty(h)+")")}},isSignature:function(h,m){var d=this.reader.index;this.reader.setIndex(h);var v=this.reader.readString(4)===m;return this.reader.setIndex(d),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),m=c.uint8array?"uint8array":"array",d=r.transformTo(m,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,m,d,v=this.zip64EndOfCentralSize-44;0<v;)h=this.reader.readInt(2),m=this.reader.readInt(4),d=this.reader.readData(m),this.zip64ExtensibleData[h]={id:h,length:m,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,m;for(h=0;h<this.files.length;h++)m=this.files[h],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(t.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(t.CENTRAL_FILE_HEADER);)(h=new i({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(t.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,t.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var m=h;if(this.checkSignature(t.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,t.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var v=m-d;if(0<v)this.isSignature(m,t.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(h){this.reader=e(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=y},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,l,o){var e=n("./reader/readerFor"),r=n("./utils"),t=n("./compressedObject"),i=n("./crc32"),c=n("./utf8"),y=n("./compressions"),h=n("./support");function m(d,v){this.options=d,this.loadOptions=v}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var v,p;if(d.skip(22),this.fileNameLength=d.readInt(2),p=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((v=function(b){for(var g in y)if(Object.prototype.hasOwnProperty.call(y,g)&&y[g].magic===b)return y[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new t(this.compressedSize,this.uncompressedSize,this.crc32,v,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var v=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(v),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=e(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var v,p,b,g=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<g;)v=d.readInt(2),p=d.readInt(2),b=d.readData(p),this.extraFields[v]={id:v,length:p,value:b};d.setIndex(g)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var v=this.findExtraFieldUnicodePath();if(v!==null)this.fileNameStr=v;else{var p=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var g=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var v=e(d.value);return v.readInt(1)!==1||i(this.fileName)!==v.readInt(4)?null:c.utf8decode(v.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var v=e(d.value);return v.readInt(1)!==1||i(this.fileComment)!==v.readInt(4)?null:c.utf8decode(v.readData(d.length-5))}return null}},l.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,l,o){function e(v,p,b){this.name=v,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var r=n("./stream/StreamHelper"),t=n("./stream/DataWorker"),i=n("./utf8"),c=n("./compressedObject"),y=n("./stream/GenericWorker");e.prototype={internalStream:function(v){var p=null,b="string";try{if(!v)throw new Error("No output type specified.");var g=(b=v.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(p=p.pipe(new i.Utf8EncodeWorker)),!x&&g&&(p=p.pipe(new i.Utf8DecodeWorker))}catch(A){(p=new y("error")).error(A)}return new r(p,b,"")},async:function(v,p){return this.internalStream(v).accumulate(p)},nodeStream:function(v,p){return this.internalStream(v||"nodebuffer").toNodejsStream(p)},_compressWorker:function(v,p){if(this._data instanceof c&&this._data.compression.magic===v.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new i.Utf8EncodeWorker)),c.createWorkerFrom(b,v,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof y?this._data:new t(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)e.prototype[h[d]]=m;l.exports=e},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,l,o){(function(e){var r,t,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var c=0,y=new i(v),h=e.document.createTextNode("");y.observe(h,{characterData:!0}),r=function(){h.data=c=++c%2}}else if(e.setImmediate||e.MessageChannel===void 0)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var p=e.document.createElement("script");p.onreadystatechange=function(){v(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},e.document.documentElement.appendChild(p)}:function(){setTimeout(v,0)};else{var m=new e.MessageChannel;m.port1.onmessage=v,r=function(){m.port2.postMessage(0)}}var d=[];function v(){var p,b;t=!0;for(var g=d.length;g;){for(b=d,d=[],p=-1;++p<g;)b[p]();g=d.length}t=!1}l.exports=function(p){d.push(p)!==1||t||r()}}).call(this,typeof dt<"u"?dt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,l,o){var e=n("immediate");function r(){}var t={},i=["REJECTED"],c=["FULFILLED"],y=["PENDING"];function h(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=y,this.queue=[],this.outcome=void 0,g!==r&&p(this,g)}function m(g,x,A){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function d(g,x,A){e(function(){var j;try{j=x(A)}catch(O){return t.reject(g,O)}j===g?t.reject(g,new TypeError("Cannot resolve promise with itself")):t.resolve(g,j)})}function v(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function p(g,x){var A=!1;function j(I){A||(A=!0,t.reject(g,I))}function O(I){A||(A=!0,t.resolve(g,I))}var F=b(function(){x(O,j)});F.status==="error"&&j(F.value)}function b(g,x){var A={};try{A.value=g(x),A.status="success"}catch(j){A.status="error",A.value=j}return A}(l.exports=h).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(A){return x.resolve(g()).then(function(){return A})},function(A){return x.resolve(g()).then(function(){throw A})})},h.prototype.catch=function(g){return this.then(null,g)},h.prototype.then=function(g,x){if(typeof g!="function"&&this.state===c||typeof x!="function"&&this.state===i)return this;var A=new this.constructor(r);return this.state!==y?d(A,this.state===c?g:x,this.outcome):this.queue.push(new m(A,g,x)),A},m.prototype.callFulfilled=function(g){t.resolve(this.promise,g)},m.prototype.otherCallFulfilled=function(g){d(this.promise,this.onFulfilled,g)},m.prototype.callRejected=function(g){t.reject(this.promise,g)},m.prototype.otherCallRejected=function(g){d(this.promise,this.onRejected,g)},t.resolve=function(g,x){var A=b(v,x);if(A.status==="error")return t.reject(g,A.value);var j=A.value;if(j)p(g,j);else{g.state=c,g.outcome=x;for(var O=-1,F=g.queue.length;++O<F;)g.queue[O].callFulfilled(x)}return g},t.reject=function(g,x){g.state=i,g.outcome=x;for(var A=-1,j=g.queue.length;++A<j;)g.queue[A].callRejected(x);return g},h.resolve=function(g){return g instanceof this?g:t.resolve(new this(r),g)},h.reject=function(g){var x=new this(r);return t.reject(x,g)},h.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=g.length,j=!1;if(!A)return this.resolve([]);for(var O=new Array(A),F=0,I=-1,B=new this(r);++I<A;)T(g[I],I);return B;function T(N,Y){x.resolve(N).then(function(k){O[Y]=k,++F!==A||j||(j=!0,t.resolve(B,O))},function(k){j||(j=!0,t.reject(B,k))})}},h.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=g.length,j=!1;if(!A)return this.resolve([]);for(var O=-1,F=new this(r);++O<A;)I=g[O],x.resolve(I).then(function(B){j||(j=!0,t.resolve(F,B))},function(B){j||(j=!0,t.reject(F,B))});var I;return F}},{immediate:36}],38:[function(n,l,o){var e={};(0,n("./lib/utils/common").assign)(e,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),l.exports=e},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,l,o){var e=n("./zlib/deflate"),r=n("./utils/common"),t=n("./utils/strings"),i=n("./zlib/messages"),c=n("./zlib/zstream"),y=Object.prototype.toString,h=0,m=-1,d=0,v=8;function p(g){if(!(this instanceof p))return new p(g);this.options=r.assign({level:m,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var A=e.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(A!==h)throw new Error(i[A]);if(x.header&&e.deflateSetHeader(this.strm,x.header),x.dictionary){var j;if(j=typeof x.dictionary=="string"?t.string2buf(x.dictionary):y.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(A=e.deflateSetDictionary(this.strm,j))!==h)throw new Error(i[A]);this._dict_set=!0}}function b(g,x){var A=new p(x);if(A.push(g,!0),A.err)throw A.msg||i[A.err];return A.result}p.prototype.push=function(g,x){var A,j,O=this.strm,F=this.options.chunkSize;if(this.ended)return!1;j=x===~~x?x:x===!0?4:0,typeof g=="string"?O.input=t.string2buf(g):y.call(g)==="[object ArrayBuffer]"?O.input=new Uint8Array(g):O.input=g,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new r.Buf8(F),O.next_out=0,O.avail_out=F),(A=e.deflate(O,j))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);O.avail_out!==0&&(O.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(t.buf2binstring(r.shrinkBuf(O.output,O.next_out))):this.onData(r.shrinkBuf(O.output,O.next_out)))}while((0<O.avail_in||O.avail_out===0)&&A!==1);return j===4?(A=e.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):j!==2||(this.onEnd(h),!(O.avail_out=0))},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},o.Deflate=p,o.deflate=b,o.deflateRaw=function(g,x){return(x=x||{}).raw=!0,b(g,x)},o.gzip=function(g,x){return(x=x||{}).gzip=!0,b(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,l,o){var e=n("./zlib/inflate"),r=n("./utils/common"),t=n("./utils/strings"),i=n("./zlib/constants"),c=n("./zlib/messages"),y=n("./zlib/zstream"),h=n("./zlib/gzheader"),m=Object.prototype.toString;function d(p){if(!(this instanceof d))return new d(p);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var g=e.inflateInit2(this.strm,b.windowBits);if(g!==i.Z_OK)throw new Error(c[g]);this.header=new h,e.inflateGetHeader(this.strm,this.header)}function v(p,b){var g=new d(b);if(g.push(p,!0),g.err)throw g.msg||c[g.err];return g.result}d.prototype.push=function(p,b){var g,x,A,j,O,F,I=this.strm,B=this.options.chunkSize,T=this.options.dictionary,N=!1;if(this.ended)return!1;x=b===~~b?b:b===!0?i.Z_FINISH:i.Z_NO_FLUSH,typeof p=="string"?I.input=t.binstring2buf(p):m.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new r.Buf8(B),I.next_out=0,I.avail_out=B),(g=e.inflate(I,i.Z_NO_FLUSH))===i.Z_NEED_DICT&&T&&(F=typeof T=="string"?t.string2buf(T):m.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,g=e.inflateSetDictionary(this.strm,F)),g===i.Z_BUF_ERROR&&N===!0&&(g=i.Z_OK,N=!1),g!==i.Z_STREAM_END&&g!==i.Z_OK)return this.onEnd(g),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&g!==i.Z_STREAM_END&&(I.avail_in!==0||x!==i.Z_FINISH&&x!==i.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=t.utf8border(I.output,I.next_out),j=I.next_out-A,O=t.buf2string(I.output,A),I.next_out=j,I.avail_out=B-j,j&&r.arraySet(I.output,I.output,A,j,0),this.onData(O)):this.onData(r.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(N=!0)}while((0<I.avail_in||I.avail_out===0)&&g!==i.Z_STREAM_END);return g===i.Z_STREAM_END&&(x=i.Z_FINISH),x===i.Z_FINISH?(g=e.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===i.Z_OK):x!==i.Z_SYNC_FLUSH||(this.onEnd(i.Z_OK),!(I.avail_out=0))},d.prototype.onData=function(p){this.chunks.push(p)},d.prototype.onEnd=function(p){p===i.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},o.Inflate=d,o.inflate=v,o.inflateRaw=function(p,b){return(b=b||{}).raw=!0,v(p,b)},o.ungzip=v},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,l,o){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(i){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var y=c.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(var h in y)y.hasOwnProperty(h)&&(i[h]=y[h])}}return i},o.shrinkBuf=function(i,c){return i.length===c?i:i.subarray?i.subarray(0,c):(i.length=c,i)};var r={arraySet:function(i,c,y,h,m){if(c.subarray&&i.subarray)i.set(c.subarray(y,y+h),m);else for(var d=0;d<h;d++)i[m+d]=c[y+d]},flattenChunks:function(i){var c,y,h,m,d,v;for(c=h=0,y=i.length;c<y;c++)h+=i[c].length;for(v=new Uint8Array(h),c=m=0,y=i.length;c<y;c++)d=i[c],v.set(d,m),m+=d.length;return v}},t={arraySet:function(i,c,y,h,m){for(var d=0;d<h;d++)i[m+d]=c[y+d]},flattenChunks:function(i){return[].concat.apply([],i)}};o.setTyped=function(i){i?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,r)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,t))},o.setTyped(e)},{}],42:[function(n,l,o){var e=n("./common"),r=!0,t=!0;try{String.fromCharCode.apply(null,[0])}catch(h){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){t=!1}for(var i=new e.Buf8(256),c=0;c<256;c++)i[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function y(h,m){if(m<65537&&(h.subarray&&t||!h.subarray&&r))return String.fromCharCode.apply(null,e.shrinkBuf(h,m));for(var d="",v=0;v<m;v++)d+=String.fromCharCode(h[v]);return d}i[254]=i[254]=1,o.string2buf=function(h){var m,d,v,p,b,g=h.length,x=0;for(p=0;p<g;p++)(64512&(d=h.charCodeAt(p)))==55296&&p+1<g&&(64512&(v=h.charCodeAt(p+1)))==56320&&(d=65536+(d-55296<<10)+(v-56320),p++),x+=d<128?1:d<2048?2:d<65536?3:4;for(m=new e.Buf8(x),p=b=0;b<x;p++)(64512&(d=h.charCodeAt(p)))==55296&&p+1<g&&(64512&(v=h.charCodeAt(p+1)))==56320&&(d=65536+(d-55296<<10)+(v-56320),p++),d<128?m[b++]=d:(d<2048?m[b++]=192|d>>>6:(d<65536?m[b++]=224|d>>>12:(m[b++]=240|d>>>18,m[b++]=128|d>>>12&63),m[b++]=128|d>>>6&63),m[b++]=128|63&d);return m},o.buf2binstring=function(h){return y(h,h.length)},o.binstring2buf=function(h){for(var m=new e.Buf8(h.length),d=0,v=m.length;d<v;d++)m[d]=h.charCodeAt(d);return m},o.buf2string=function(h,m){var d,v,p,b,g=m||h.length,x=new Array(2*g);for(d=v=0;d<g;)if((p=h[d++])<128)x[v++]=p;else if(4<(b=i[p]))x[v++]=65533,d+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&d<g;)p=p<<6|63&h[d++],b--;1<b?x[v++]=65533:p<65536?x[v++]=p:(p-=65536,x[v++]=55296|p>>10&1023,x[v++]=56320|1023&p)}return y(x,v)},o.utf8border=function(h,m){var d;for((m=m||h.length)>h.length&&(m=h.length),d=m-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?m:d+i[h[d]]>m?d:m}},{"./common":41}],43:[function(n,l,o){l.exports=function(e,r,t,i){for(var c=65535&e|0,y=e>>>16&65535|0,h=0;t!==0;){for(t-=h=2e3<t?2e3:t;y=y+(c=c+r[i++]|0)|0,--h;);c%=65521,y%=65521}return c|y<<16|0}},{}],44:[function(n,l,o){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,l,o){var e=function(){for(var r,t=[],i=0;i<256;i++){r=i;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;t[i]=r}return t}();l.exports=function(r,t,i,c){var y=e,h=c+i;r^=-1;for(var m=c;m<h;m++)r=r>>>8^y[255&(r^t[m])];return-1^r}},{}],46:[function(n,l,o){var e,r=n("../utils/common"),t=n("./trees"),i=n("./adler32"),c=n("./crc32"),y=n("./messages"),h=0,m=4,d=0,v=-2,p=-1,b=4,g=2,x=8,A=9,j=286,O=30,F=19,I=2*j+1,B=15,T=3,N=258,Y=N+T+1,k=42,D=113,u=1,M=2,re=3,U=4;function ie(a,V){return a.msg=y[V],V}function Z(a){return(a<<1)-(4<a?9:0)}function se(a){for(var V=a.length;0<=--V;)a[V]=0}function z(a){var V=a.state,L=V.pending;L>a.avail_out&&(L=a.avail_out),L!==0&&(r.arraySet(a.output,V.pending_buf,V.pending_out,L,a.next_out),a.next_out+=L,V.pending_out+=L,a.total_out+=L,a.avail_out-=L,V.pending-=L,V.pending===0&&(V.pending_out=0))}function C(a,V){t._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,V),a.block_start=a.strstart,z(a.strm)}function ne(a,V){a.pending_buf[a.pending++]=V}function X(a,V){a.pending_buf[a.pending++]=V>>>8&255,a.pending_buf[a.pending++]=255&V}function q(a,V){var L,E,S=a.max_chain_length,P=a.strstart,H=a.prev_length,W=a.nice_match,R=a.strstart>a.w_size-Y?a.strstart-(a.w_size-Y):0,G=a.window,J=a.w_mask,$=a.prev,te=a.strstart+N,ue=G[P+H-1],oe=G[P+H];a.prev_length>=a.good_match&&(S>>=2),W>a.lookahead&&(W=a.lookahead);do if(G[(L=V)+H]===oe&&G[L+H-1]===ue&&G[L]===G[P]&&G[++L]===G[P+1]){P+=2,L++;do;while(G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&G[++P]===G[++L]&&P<te);if(E=N-(te-P),P=te-N,H<E){if(a.match_start=V,W<=(H=E))break;ue=G[P+H-1],oe=G[P+H]}}while((V=$[V&J])>R&&--S!=0);return H<=a.lookahead?H:a.lookahead}function pe(a){var V,L,E,S,P,H,W,R,G,J,$=a.w_size;do{if(S=a.window_size-a.lookahead-a.strstart,a.strstart>=$+($-Y)){for(r.arraySet(a.window,a.window,$,$,0),a.match_start-=$,a.strstart-=$,a.block_start-=$,V=L=a.hash_size;E=a.head[--V],a.head[V]=$<=E?E-$:0,--L;);for(V=L=$;E=a.prev[--V],a.prev[V]=$<=E?E-$:0,--L;);S+=$}if(a.strm.avail_in===0)break;if(H=a.strm,W=a.window,R=a.strstart+a.lookahead,G=S,J=void 0,J=H.avail_in,G<J&&(J=G),L=J===0?0:(H.avail_in-=J,r.arraySet(W,H.input,H.next_in,J,R),H.state.wrap===1?H.adler=i(H.adler,W,J,R):H.state.wrap===2&&(H.adler=c(H.adler,W,J,R)),H.next_in+=J,H.total_in+=J,J),a.lookahead+=L,a.lookahead+a.insert>=T)for(P=a.strstart-a.insert,a.ins_h=a.window[P],a.ins_h=(a.ins_h<<a.hash_shift^a.window[P+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[P+T-1])&a.hash_mask,a.prev[P&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=P,P++,a.insert--,!(a.lookahead+a.insert<T)););}while(a.lookahead<Y&&a.strm.avail_in!==0)}function be(a,V){for(var L,E;;){if(a.lookahead<Y){if(pe(a),a.lookahead<Y&&V===h)return u;if(a.lookahead===0)break}if(L=0,a.lookahead>=T&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+T-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),L!==0&&a.strstart-L<=a.w_size-Y&&(a.match_length=q(a,L)),a.match_length>=T)if(E=t._tr_tally(a,a.strstart-a.match_start,a.match_length-T),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=T){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+T-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else E=t._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(E&&(C(a,!1),a.strm.avail_out===0))return u}return a.insert=a.strstart<T-1?a.strstart:T-1,V===m?(C(a,!0),a.strm.avail_out===0?re:U):a.last_lit&&(C(a,!1),a.strm.avail_out===0)?u:M}function ae(a,V){for(var L,E,S;;){if(a.lookahead<Y){if(pe(a),a.lookahead<Y&&V===h)return u;if(a.lookahead===0)break}if(L=0,a.lookahead>=T&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+T-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=T-1,L!==0&&a.prev_length<a.max_lazy_match&&a.strstart-L<=a.w_size-Y&&(a.match_length=q(a,L),a.match_length<=5&&(a.strategy===1||a.match_length===T&&4096<a.strstart-a.match_start)&&(a.match_length=T-1)),a.prev_length>=T&&a.match_length<=a.prev_length){for(S=a.strstart+a.lookahead-T,E=t._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-T),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=S&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+T-1])&a.hash_mask,L=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=T-1,a.strstart++,E&&(C(a,!1),a.strm.avail_out===0))return u}else if(a.match_available){if((E=t._tr_tally(a,0,a.window[a.strstart-1]))&&C(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return u}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(E=t._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<T-1?a.strstart:T-1,V===m?(C(a,!0),a.strm.avail_out===0?re:U):a.last_lit&&(C(a,!1),a.strm.avail_out===0)?u:M}function ce(a,V,L,E,S){this.good_length=a,this.max_lazy=V,this.nice_length=L,this.max_chain=E,this.func=S}function ve(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*I),this.dyn_dtree=new r.Buf16(2*(2*O+1)),this.bl_tree=new r.Buf16(2*(2*F+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(B+1),this.heap=new r.Buf16(2*j+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*j+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function me(a){var V;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=g,(V=a.state).pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?k:D,a.adler=V.wrap===2?0:1,V.last_flush=h,t._tr_init(V),d):ie(a,v)}function Ae(a){var V=me(a);return V===d&&function(L){L.window_size=2*L.w_size,se(L.head),L.max_lazy_match=e[L.level].max_lazy,L.good_match=e[L.level].good_length,L.nice_match=e[L.level].nice_length,L.max_chain_length=e[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=T-1,L.match_available=0,L.ins_h=0}(a.state),V}function ke(a,V,L,E,S,P){if(!a)return v;var H=1;if(V===p&&(V=6),E<0?(H=0,E=-E):15<E&&(H=2,E-=16),S<1||A<S||L!==x||E<8||15<E||V<0||9<V||P<0||b<P)return ie(a,v);E===8&&(E=9);var W=new ve;return(a.state=W).strm=a,W.wrap=H,W.gzhead=null,W.w_bits=E,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=S+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+T-1)/T),W.window=new r.Buf8(2*W.w_size),W.head=new r.Buf16(W.hash_size),W.prev=new r.Buf16(W.w_size),W.lit_bufsize=1<<S+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new r.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=V,W.strategy=P,W.method=L,Ae(a)}e=[new ce(0,0,0,0,function(a,V){var L=65535;for(L>a.pending_buf_size-5&&(L=a.pending_buf_size-5);;){if(a.lookahead<=1){if(pe(a),a.lookahead===0&&V===h)return u;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var E=a.block_start+L;if((a.strstart===0||a.strstart>=E)&&(a.lookahead=a.strstart-E,a.strstart=E,C(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-Y&&(C(a,!1),a.strm.avail_out===0))return u}return a.insert=0,V===m?(C(a,!0),a.strm.avail_out===0?re:U):(a.strstart>a.block_start&&(C(a,!1),a.strm.avail_out),u)}),new ce(4,4,8,4,be),new ce(4,5,16,8,be),new ce(4,6,32,32,be),new ce(4,4,16,16,ae),new ce(8,16,32,32,ae),new ce(8,16,128,128,ae),new ce(8,32,128,256,ae),new ce(32,128,258,1024,ae),new ce(32,258,258,4096,ae)],o.deflateInit=function(a,V){return ke(a,V,x,15,8,0)},o.deflateInit2=ke,o.deflateReset=Ae,o.deflateResetKeep=me,o.deflateSetHeader=function(a,V){return a&&a.state?a.state.wrap!==2?v:(a.state.gzhead=V,d):v},o.deflate=function(a,V){var L,E,S,P;if(!a||!a.state||5<V||V<0)return a?ie(a,v):v;if(E=a.state,!a.output||!a.input&&a.avail_in!==0||E.status===666&&V!==m)return ie(a,a.avail_out===0?-5:v);if(E.strm=a,L=E.last_flush,E.last_flush=V,E.status===k)if(E.wrap===2)a.adler=0,ne(E,31),ne(E,139),ne(E,8),E.gzhead?(ne(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),ne(E,255&E.gzhead.time),ne(E,E.gzhead.time>>8&255),ne(E,E.gzhead.time>>16&255),ne(E,E.gzhead.time>>24&255),ne(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),ne(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(ne(E,255&E.gzhead.extra.length),ne(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(a.adler=c(a.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(ne(E,0),ne(E,0),ne(E,0),ne(E,0),ne(E,0),ne(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),ne(E,3),E.status=D);else{var H=x+(E.w_bits-8<<4)<<8;H|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(H|=32),H+=31-H%31,E.status=D,X(E,H),E.strstart!==0&&(X(E,a.adler>>>16),X(E,65535&a.adler)),a.adler=1}if(E.status===69)if(E.gzhead.extra){for(S=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),z(a),S=E.pending,E.pending!==E.pending_buf_size));)ne(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){S=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),z(a),S=E.pending,E.pending===E.pending_buf_size)){P=1;break}P=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,ne(E,P)}while(P!==0);E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),P===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){S=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),z(a),S=E.pending,E.pending===E.pending_buf_size)){P=1;break}P=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,ne(E,P)}while(P!==0);E.gzhead.hcrc&&E.pending>S&&(a.adler=c(a.adler,E.pending_buf,E.pending-S,S)),P===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&z(a),E.pending+2<=E.pending_buf_size&&(ne(E,255&a.adler),ne(E,a.adler>>8&255),a.adler=0,E.status=D)):E.status=D),E.pending!==0){if(z(a),a.avail_out===0)return E.last_flush=-1,d}else if(a.avail_in===0&&Z(V)<=Z(L)&&V!==m)return ie(a,-5);if(E.status===666&&a.avail_in!==0)return ie(a,-5);if(a.avail_in!==0||E.lookahead!==0||V!==h&&E.status!==666){var W=E.strategy===2?function(R,G){for(var J;;){if(R.lookahead===0&&(pe(R),R.lookahead===0)){if(G===h)return u;break}if(R.match_length=0,J=t._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,J&&(C(R,!1),R.strm.avail_out===0))return u}return R.insert=0,G===m?(C(R,!0),R.strm.avail_out===0?re:U):R.last_lit&&(C(R,!1),R.strm.avail_out===0)?u:M}(E,V):E.strategy===3?function(R,G){for(var J,$,te,ue,oe=R.window;;){if(R.lookahead<=N){if(pe(R),R.lookahead<=N&&G===h)return u;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=T&&0<R.strstart&&($=oe[te=R.strstart-1])===oe[++te]&&$===oe[++te]&&$===oe[++te]){ue=R.strstart+N;do;while($===oe[++te]&&$===oe[++te]&&$===oe[++te]&&$===oe[++te]&&$===oe[++te]&&$===oe[++te]&&$===oe[++te]&&$===oe[++te]&&te<ue);R.match_length=N-(ue-te),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=T?(J=t._tr_tally(R,1,R.match_length-T),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(J=t._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),J&&(C(R,!1),R.strm.avail_out===0))return u}return R.insert=0,G===m?(C(R,!0),R.strm.avail_out===0?re:U):R.last_lit&&(C(R,!1),R.strm.avail_out===0)?u:M}(E,V):e[E.level].func(E,V);if(W!==re&&W!==U||(E.status=666),W===u||W===re)return a.avail_out===0&&(E.last_flush=-1),d;if(W===M&&(V===1?t._tr_align(E):V!==5&&(t._tr_stored_block(E,0,0,!1),V===3&&(se(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),z(a),a.avail_out===0))return E.last_flush=-1,d}return V!==m?d:E.wrap<=0?1:(E.wrap===2?(ne(E,255&a.adler),ne(E,a.adler>>8&255),ne(E,a.adler>>16&255),ne(E,a.adler>>24&255),ne(E,255&a.total_in),ne(E,a.total_in>>8&255),ne(E,a.total_in>>16&255),ne(E,a.total_in>>24&255)):(X(E,a.adler>>>16),X(E,65535&a.adler)),z(a),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?d:1)},o.deflateEnd=function(a){var V;return a&&a.state?(V=a.state.status)!==k&&V!==69&&V!==73&&V!==91&&V!==103&&V!==D&&V!==666?ie(a,v):(a.state=null,V===D?ie(a,-3):d):v},o.deflateSetDictionary=function(a,V){var L,E,S,P,H,W,R,G,J=V.length;if(!a||!a.state||(P=(L=a.state).wrap)===2||P===1&&L.status!==k||L.lookahead)return v;for(P===1&&(a.adler=i(a.adler,V,J,0)),L.wrap=0,J>=L.w_size&&(P===0&&(se(L.head),L.strstart=0,L.block_start=0,L.insert=0),G=new r.Buf8(L.w_size),r.arraySet(G,V,J-L.w_size,L.w_size,0),V=G,J=L.w_size),H=a.avail_in,W=a.next_in,R=a.input,a.avail_in=J,a.next_in=0,a.input=V,pe(L);L.lookahead>=T;){for(E=L.strstart,S=L.lookahead-(T-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[E+T-1])&L.hash_mask,L.prev[E&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=E,E++,--S;);L.strstart=E,L.lookahead=T-1,pe(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=T-1,L.match_available=0,a.next_in=W,a.input=R,a.avail_in=H,L.wrap=P,d},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,l,o){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,l,o){l.exports=function(e,r){var t,i,c,y,h,m,d,v,p,b,g,x,A,j,O,F,I,B,T,N,Y,k,D,u,M;t=e.state,i=e.next_in,u=e.input,c=i+(e.avail_in-5),y=e.next_out,M=e.output,h=y-(r-e.avail_out),m=y+(e.avail_out-257),d=t.dmax,v=t.wsize,p=t.whave,b=t.wnext,g=t.window,x=t.hold,A=t.bits,j=t.lencode,O=t.distcode,F=(1<<t.lenbits)-1,I=(1<<t.distbits)-1;e:do{A<15&&(x+=u[i++]<<A,A+=8,x+=u[i++]<<A,A+=8),B=j[x&F];t:for(;;){if(x>>>=T=B>>>24,A-=T,(T=B>>>16&255)===0)M[y++]=65535&B;else{if(!(16&T)){if(!(64&T)){B=j[(65535&B)+(x&(1<<T)-1)];continue t}if(32&T){t.mode=12;break e}e.msg="invalid literal/length code",t.mode=30;break e}N=65535&B,(T&=15)&&(A<T&&(x+=u[i++]<<A,A+=8),N+=x&(1<<T)-1,x>>>=T,A-=T),A<15&&(x+=u[i++]<<A,A+=8,x+=u[i++]<<A,A+=8),B=O[x&I];n:for(;;){if(x>>>=T=B>>>24,A-=T,!(16&(T=B>>>16&255))){if(!(64&T)){B=O[(65535&B)+(x&(1<<T)-1)];continue n}e.msg="invalid distance code",t.mode=30;break e}if(Y=65535&B,A<(T&=15)&&(x+=u[i++]<<A,(A+=8)<T&&(x+=u[i++]<<A,A+=8)),d<(Y+=x&(1<<T)-1)){e.msg="invalid distance too far back",t.mode=30;break e}if(x>>>=T,A-=T,(T=y-h)<Y){if(p<(T=Y-T)&&t.sane){e.msg="invalid distance too far back",t.mode=30;break e}if(D=g,(k=0)===b){if(k+=v-T,T<N){for(N-=T;M[y++]=g[k++],--T;);k=y-Y,D=M}}else if(b<T){if(k+=v+b-T,(T-=b)<N){for(N-=T;M[y++]=g[k++],--T;);if(k=0,b<N){for(N-=T=b;M[y++]=g[k++],--T;);k=y-Y,D=M}}}else if(k+=b-T,T<N){for(N-=T;M[y++]=g[k++],--T;);k=y-Y,D=M}for(;2<N;)M[y++]=D[k++],M[y++]=D[k++],M[y++]=D[k++],N-=3;N&&(M[y++]=D[k++],1<N&&(M[y++]=D[k++]))}else{for(k=y-Y;M[y++]=M[k++],M[y++]=M[k++],M[y++]=M[k++],2<(N-=3););N&&(M[y++]=M[k++],1<N&&(M[y++]=M[k++]))}break}}break}}while(i<c&&y<m);i-=N=A>>3,x&=(1<<(A-=N<<3))-1,e.next_in=i,e.next_out=y,e.avail_in=i<c?c-i+5:5-(i-c),e.avail_out=y<m?m-y+257:257-(y-m),t.hold=x,t.bits=A}},{}],49:[function(n,l,o){var e=n("../utils/common"),r=n("./adler32"),t=n("./crc32"),i=n("./inffast"),c=n("./inftrees"),y=1,h=2,m=0,d=-2,v=1,p=852,b=592;function g(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(k){var D;return k&&k.state?(D=k.state,k.total_in=k.total_out=D.total=0,k.msg="",D.wrap&&(k.adler=1&D.wrap),D.mode=v,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new e.Buf32(p),D.distcode=D.distdyn=new e.Buf32(b),D.sane=1,D.back=-1,m):d}function j(k){var D;return k&&k.state?((D=k.state).wsize=0,D.whave=0,D.wnext=0,A(k)):d}function O(k,D){var u,M;return k&&k.state?(M=k.state,D<0?(u=0,D=-D):(u=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?d:(M.window!==null&&M.wbits!==D&&(M.window=null),M.wrap=u,M.wbits=D,j(k))):d}function F(k,D){var u,M;return k?(M=new x,(k.state=M).window=null,(u=O(k,D))!==m&&(k.state=null),u):d}var I,B,T=!0;function N(k){if(T){var D;for(I=new e.Buf32(512),B=new e.Buf32(32),D=0;D<144;)k.lens[D++]=8;for(;D<256;)k.lens[D++]=9;for(;D<280;)k.lens[D++]=7;for(;D<288;)k.lens[D++]=8;for(c(y,k.lens,0,288,I,0,k.work,{bits:9}),D=0;D<32;)k.lens[D++]=5;c(h,k.lens,0,32,B,0,k.work,{bits:5}),T=!1}k.lencode=I,k.lenbits=9,k.distcode=B,k.distbits=5}function Y(k,D,u,M){var re,U=k.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new e.Buf8(U.wsize)),M>=U.wsize?(e.arraySet(U.window,D,u-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(M<(re=U.wsize-U.wnext)&&(re=M),e.arraySet(U.window,D,u-M,re,U.wnext),(M-=re)?(e.arraySet(U.window,D,u-M,M,0),U.wnext=M,U.whave=U.wsize):(U.wnext+=re,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=re))),0}o.inflateReset=j,o.inflateReset2=O,o.inflateResetKeep=A,o.inflateInit=function(k){return F(k,15)},o.inflateInit2=F,o.inflate=function(k,D){var u,M,re,U,ie,Z,se,z,C,ne,X,q,pe,be,ae,ce,ve,me,Ae,ke,a,V,L,E,S=0,P=new e.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return d;(u=k.state).mode===12&&(u.mode=13),ie=k.next_out,re=k.output,se=k.avail_out,U=k.next_in,M=k.input,Z=k.avail_in,z=u.hold,C=u.bits,ne=Z,X=se,V=m;e:for(;;)switch(u.mode){case v:if(u.wrap===0){u.mode=13;break}for(;C<16;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(2&u.wrap&&z===35615){P[u.check=0]=255&z,P[1]=z>>>8&255,u.check=t(u.check,P,2,0),C=z=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&z)<<8)+(z>>8))%31){k.msg="incorrect header check",u.mode=30;break}if((15&z)!=8){k.msg="unknown compression method",u.mode=30;break}if(C-=4,a=8+(15&(z>>>=4)),u.wbits===0)u.wbits=a;else if(a>u.wbits){k.msg="invalid window size",u.mode=30;break}u.dmax=1<<a,k.adler=u.check=1,u.mode=512&z?10:12,C=z=0;break;case 2:for(;C<16;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(u.flags=z,(255&u.flags)!=8){k.msg="unknown compression method",u.mode=30;break}if(57344&u.flags){k.msg="unknown header flags set",u.mode=30;break}u.head&&(u.head.text=z>>8&1),512&u.flags&&(P[0]=255&z,P[1]=z>>>8&255,u.check=t(u.check,P,2,0)),C=z=0,u.mode=3;case 3:for(;C<32;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}u.head&&(u.head.time=z),512&u.flags&&(P[0]=255&z,P[1]=z>>>8&255,P[2]=z>>>16&255,P[3]=z>>>24&255,u.check=t(u.check,P,4,0)),C=z=0,u.mode=4;case 4:for(;C<16;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}u.head&&(u.head.xflags=255&z,u.head.os=z>>8),512&u.flags&&(P[0]=255&z,P[1]=z>>>8&255,u.check=t(u.check,P,2,0)),C=z=0,u.mode=5;case 5:if(1024&u.flags){for(;C<16;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}u.length=z,u.head&&(u.head.extra_len=z),512&u.flags&&(P[0]=255&z,P[1]=z>>>8&255,u.check=t(u.check,P,2,0)),C=z=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(Z<(q=u.length)&&(q=Z),q&&(u.head&&(a=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),e.arraySet(u.head.extra,M,U,q,a)),512&u.flags&&(u.check=t(u.check,M,q,U)),Z-=q,U+=q,u.length-=q),u.length))break e;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(Z===0)break e;for(q=0;a=M[U+q++],u.head&&a&&u.length<65536&&(u.head.name+=String.fromCharCode(a)),a&&q<Z;);if(512&u.flags&&(u.check=t(u.check,M,q,U)),Z-=q,U+=q,a)break e}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(Z===0)break e;for(q=0;a=M[U+q++],u.head&&a&&u.length<65536&&(u.head.comment+=String.fromCharCode(a)),a&&q<Z;);if(512&u.flags&&(u.check=t(u.check,M,q,U)),Z-=q,U+=q,a)break e}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;C<16;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(z!==(65535&u.check)){k.msg="header crc mismatch",u.mode=30;break}C=z=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),k.adler=u.check=0,u.mode=12;break;case 10:for(;C<32;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}k.adler=u.check=g(z),C=z=0,u.mode=11;case 11:if(u.havedict===0)return k.next_out=ie,k.avail_out=se,k.next_in=U,k.avail_in=Z,u.hold=z,u.bits=C,2;k.adler=u.check=1,u.mode=12;case 12:if(D===5||D===6)break e;case 13:if(u.last){z>>>=7&C,C-=7&C,u.mode=27;break}for(;C<3;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}switch(u.last=1&z,C-=1,3&(z>>>=1)){case 0:u.mode=14;break;case 1:if(N(u),u.mode=20,D!==6)break;z>>>=2,C-=2;break e;case 2:u.mode=17;break;case 3:k.msg="invalid block type",u.mode=30}z>>>=2,C-=2;break;case 14:for(z>>>=7&C,C-=7&C;C<32;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if((65535&z)!=(z>>>16^65535)){k.msg="invalid stored block lengths",u.mode=30;break}if(u.length=65535&z,C=z=0,u.mode=15,D===6)break e;case 15:u.mode=16;case 16:if(q=u.length){if(Z<q&&(q=Z),se<q&&(q=se),q===0)break e;e.arraySet(re,M,U,q,ie),Z-=q,U+=q,se-=q,ie+=q,u.length-=q;break}u.mode=12;break;case 17:for(;C<14;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(u.nlen=257+(31&z),z>>>=5,C-=5,u.ndist=1+(31&z),z>>>=5,C-=5,u.ncode=4+(15&z),z>>>=4,C-=4,286<u.nlen||30<u.ndist){k.msg="too many length or distance symbols",u.mode=30;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;C<3;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}u.lens[H[u.have++]]=7&z,z>>>=3,C-=3}for(;u.have<19;)u.lens[H[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,L={bits:u.lenbits},V=c(0,u.lens,0,19,u.lencode,0,u.work,L),u.lenbits=L.bits,V){k.msg="invalid code lengths set",u.mode=30;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;ce=(S=u.lencode[z&(1<<u.lenbits)-1])>>>16&255,ve=65535&S,!((ae=S>>>24)<=C);){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(ve<16)z>>>=ae,C-=ae,u.lens[u.have++]=ve;else{if(ve===16){for(E=ae+2;C<E;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(z>>>=ae,C-=ae,u.have===0){k.msg="invalid bit length repeat",u.mode=30;break}a=u.lens[u.have-1],q=3+(3&z),z>>>=2,C-=2}else if(ve===17){for(E=ae+3;C<E;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}C-=ae,a=0,q=3+(7&(z>>>=ae)),z>>>=3,C-=3}else{for(E=ae+7;C<E;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}C-=ae,a=0,q=11+(127&(z>>>=ae)),z>>>=7,C-=7}if(u.have+q>u.nlen+u.ndist){k.msg="invalid bit length repeat",u.mode=30;break}for(;q--;)u.lens[u.have++]=a}}if(u.mode===30)break;if(u.lens[256]===0){k.msg="invalid code -- missing end-of-block",u.mode=30;break}if(u.lenbits=9,L={bits:u.lenbits},V=c(y,u.lens,0,u.nlen,u.lencode,0,u.work,L),u.lenbits=L.bits,V){k.msg="invalid literal/lengths set",u.mode=30;break}if(u.distbits=6,u.distcode=u.distdyn,L={bits:u.distbits},V=c(h,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,L),u.distbits=L.bits,V){k.msg="invalid distances set",u.mode=30;break}if(u.mode=20,D===6)break e;case 20:u.mode=21;case 21:if(6<=Z&&258<=se){k.next_out=ie,k.avail_out=se,k.next_in=U,k.avail_in=Z,u.hold=z,u.bits=C,i(k,X),ie=k.next_out,re=k.output,se=k.avail_out,U=k.next_in,M=k.input,Z=k.avail_in,z=u.hold,C=u.bits,u.mode===12&&(u.back=-1);break}for(u.back=0;ce=(S=u.lencode[z&(1<<u.lenbits)-1])>>>16&255,ve=65535&S,!((ae=S>>>24)<=C);){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(ce&&!(240&ce)){for(me=ae,Ae=ce,ke=ve;ce=(S=u.lencode[ke+((z&(1<<me+Ae)-1)>>me)])>>>16&255,ve=65535&S,!(me+(ae=S>>>24)<=C);){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}z>>>=me,C-=me,u.back+=me}if(z>>>=ae,C-=ae,u.back+=ae,u.length=ve,ce===0){u.mode=26;break}if(32&ce){u.back=-1,u.mode=12;break}if(64&ce){k.msg="invalid literal/length code",u.mode=30;break}u.extra=15&ce,u.mode=22;case 22:if(u.extra){for(E=u.extra;C<E;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}u.length+=z&(1<<u.extra)-1,z>>>=u.extra,C-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;ce=(S=u.distcode[z&(1<<u.distbits)-1])>>>16&255,ve=65535&S,!((ae=S>>>24)<=C);){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(!(240&ce)){for(me=ae,Ae=ce,ke=ve;ce=(S=u.distcode[ke+((z&(1<<me+Ae)-1)>>me)])>>>16&255,ve=65535&S,!(me+(ae=S>>>24)<=C);){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}z>>>=me,C-=me,u.back+=me}if(z>>>=ae,C-=ae,u.back+=ae,64&ce){k.msg="invalid distance code",u.mode=30;break}u.offset=ve,u.extra=15&ce,u.mode=24;case 24:if(u.extra){for(E=u.extra;C<E;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}u.offset+=z&(1<<u.extra)-1,z>>>=u.extra,C-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){k.msg="invalid distance too far back",u.mode=30;break}u.mode=25;case 25:if(se===0)break e;if(q=X-se,u.offset>q){if((q=u.offset-q)>u.whave&&u.sane){k.msg="invalid distance too far back",u.mode=30;break}pe=q>u.wnext?(q-=u.wnext,u.wsize-q):u.wnext-q,q>u.length&&(q=u.length),be=u.window}else be=re,pe=ie-u.offset,q=u.length;for(se<q&&(q=se),se-=q,u.length-=q;re[ie++]=be[pe++],--q;);u.length===0&&(u.mode=21);break;case 26:if(se===0)break e;re[ie++]=u.length,se--,u.mode=21;break;case 27:if(u.wrap){for(;C<32;){if(Z===0)break e;Z--,z|=M[U++]<<C,C+=8}if(X-=se,k.total_out+=X,u.total+=X,X&&(k.adler=u.check=u.flags?t(u.check,re,X,ie-X):r(u.check,re,X,ie-X)),X=se,(u.flags?z:g(z))!==u.check){k.msg="incorrect data check",u.mode=30;break}C=z=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;C<32;){if(Z===0)break e;Z--,z+=M[U++]<<C,C+=8}if(z!==(4294967295&u.total)){k.msg="incorrect length check",u.mode=30;break}C=z=0}u.mode=29;case 29:V=1;break e;case 30:V=-3;break e;case 31:return-4;case 32:default:return d}return k.next_out=ie,k.avail_out=se,k.next_in=U,k.avail_in=Z,u.hold=z,u.bits=C,(u.wsize||X!==k.avail_out&&u.mode<30&&(u.mode<27||D!==4))&&Y(k,k.output,k.next_out,X-k.avail_out)?(u.mode=31,-4):(ne-=k.avail_in,X-=k.avail_out,k.total_in+=ne,k.total_out+=X,u.total+=X,u.wrap&&X&&(k.adler=u.check=u.flags?t(u.check,re,X,k.next_out-X):r(u.check,re,X,k.next_out-X)),k.data_type=u.bits+(u.last?64:0)+(u.mode===12?128:0)+(u.mode===20||u.mode===15?256:0),(ne==0&&X===0||D===4)&&V===m&&(V=-5),V)},o.inflateEnd=function(k){if(!k||!k.state)return d;var D=k.state;return D.window&&(D.window=null),k.state=null,m},o.inflateGetHeader=function(k,D){var u;return k&&k.state&&2&(u=k.state).wrap?((u.head=D).done=!1,m):d},o.inflateSetDictionary=function(k,D){var u,M=D.length;return k&&k.state?(u=k.state).wrap!==0&&u.mode!==11?d:u.mode===11&&r(1,D,M,0)!==u.check?-3:Y(k,D,M,M)?(u.mode=31,-4):(u.havedict=1,m):d},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,l,o){var e=n("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],t=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(y,h,m,d,v,p,b,g){var x,A,j,O,F,I,B,T,N,Y=g.bits,k=0,D=0,u=0,M=0,re=0,U=0,ie=0,Z=0,se=0,z=0,C=null,ne=0,X=new e.Buf16(16),q=new e.Buf16(16),pe=null,be=0;for(k=0;k<=15;k++)X[k]=0;for(D=0;D<d;D++)X[h[m+D]]++;for(re=Y,M=15;1<=M&&X[M]===0;M--);if(M<re&&(re=M),M===0)return v[p++]=20971520,v[p++]=20971520,g.bits=1,0;for(u=1;u<M&&X[u]===0;u++);for(re<u&&(re=u),k=Z=1;k<=15;k++)if(Z<<=1,(Z-=X[k])<0)return-1;if(0<Z&&(y===0||M!==1))return-1;for(q[1]=0,k=1;k<15;k++)q[k+1]=q[k]+X[k];for(D=0;D<d;D++)h[m+D]!==0&&(b[q[h[m+D]]++]=D);if(I=y===0?(C=pe=b,19):y===1?(C=r,ne-=257,pe=t,be-=257,256):(C=i,pe=c,-1),k=u,F=p,ie=D=z=0,j=-1,O=(se=1<<(U=re))-1,y===1&&852<se||y===2&&592<se)return 1;for(;;){for(B=k-ie,N=b[D]<I?(T=0,b[D]):b[D]>I?(T=pe[be+b[D]],C[ne+b[D]]):(T=96,0),x=1<<k-ie,u=A=1<<U;v[F+(z>>ie)+(A-=x)]=B<<24|T<<16|N|0,A!==0;);for(x=1<<k-1;z&x;)x>>=1;if(x!==0?(z&=x-1,z+=x):z=0,D++,--X[k]==0){if(k===M)break;k=h[m+b[D]]}if(re<k&&(z&O)!==j){for(ie===0&&(ie=re),F+=u,Z=1<<(U=k-ie);U+ie<M&&!((Z-=X[U+ie])<=0);)U++,Z<<=1;if(se+=1<<U,y===1&&852<se||y===2&&592<se)return 1;v[j=z&O]=re<<24|U<<16|F-p|0}}return z!==0&&(v[F+z]=k-ie<<24|64<<16|0),g.bits=re,0}},{"../utils/common":41}],51:[function(n,l,o){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,l,o){var e=n("../utils/common"),r=0,t=1;function i(S){for(var P=S.length;0<=--P;)S[P]=0}var c=0,y=29,h=256,m=h+1+y,d=30,v=19,p=2*m+1,b=15,g=16,x=7,A=256,j=16,O=17,F=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(m+2));i(Y);var k=new Array(2*d);i(k);var D=new Array(512);i(D);var u=new Array(256);i(u);var M=new Array(y);i(M);var re,U,ie,Z=new Array(d);function se(S,P,H,W,R){this.static_tree=S,this.extra_bits=P,this.extra_base=H,this.elems=W,this.max_length=R,this.has_stree=S&&S.length}function z(S,P){this.dyn_tree=S,this.max_code=0,this.stat_desc=P}function C(S){return S<256?D[S]:D[256+(S>>>7)]}function ne(S,P){S.pending_buf[S.pending++]=255&P,S.pending_buf[S.pending++]=P>>>8&255}function X(S,P,H){S.bi_valid>g-H?(S.bi_buf|=P<<S.bi_valid&65535,ne(S,S.bi_buf),S.bi_buf=P>>g-S.bi_valid,S.bi_valid+=H-g):(S.bi_buf|=P<<S.bi_valid&65535,S.bi_valid+=H)}function q(S,P,H){X(S,H[2*P],H[2*P+1])}function pe(S,P){for(var H=0;H|=1&S,S>>>=1,H<<=1,0<--P;);return H>>>1}function be(S,P,H){var W,R,G=new Array(b+1),J=0;for(W=1;W<=b;W++)G[W]=J=J+H[W-1]<<1;for(R=0;R<=P;R++){var $=S[2*R+1];$!==0&&(S[2*R]=pe(G[$]++,$))}}function ae(S){var P;for(P=0;P<m;P++)S.dyn_ltree[2*P]=0;for(P=0;P<d;P++)S.dyn_dtree[2*P]=0;for(P=0;P<v;P++)S.bl_tree[2*P]=0;S.dyn_ltree[2*A]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function ce(S){8<S.bi_valid?ne(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ve(S,P,H,W){var R=2*P,G=2*H;return S[R]<S[G]||S[R]===S[G]&&W[P]<=W[H]}function me(S,P,H){for(var W=S.heap[H],R=H<<1;R<=S.heap_len&&(R<S.heap_len&&ve(P,S.heap[R+1],S.heap[R],S.depth)&&R++,!ve(P,W,S.heap[R],S.depth));)S.heap[H]=S.heap[R],H=R,R<<=1;S.heap[H]=W}function Ae(S,P,H){var W,R,G,J,$=0;if(S.last_lit!==0)for(;W=S.pending_buf[S.d_buf+2*$]<<8|S.pending_buf[S.d_buf+2*$+1],R=S.pending_buf[S.l_buf+$],$++,W===0?q(S,R,P):(q(S,(G=u[R])+h+1,P),(J=I[G])!==0&&X(S,R-=M[G],J),q(S,G=C(--W),H),(J=B[G])!==0&&X(S,W-=Z[G],J)),$<S.last_lit;);q(S,A,P)}function ke(S,P){var H,W,R,G=P.dyn_tree,J=P.stat_desc.static_tree,$=P.stat_desc.has_stree,te=P.stat_desc.elems,ue=-1;for(S.heap_len=0,S.heap_max=p,H=0;H<te;H++)G[2*H]!==0?(S.heap[++S.heap_len]=ue=H,S.depth[H]=0):G[2*H+1]=0;for(;S.heap_len<2;)G[2*(R=S.heap[++S.heap_len]=ue<2?++ue:0)]=1,S.depth[R]=0,S.opt_len--,$&&(S.static_len-=J[2*R+1]);for(P.max_code=ue,H=S.heap_len>>1;1<=H;H--)me(S,G,H);for(R=te;H=S.heap[1],S.heap[1]=S.heap[S.heap_len--],me(S,G,1),W=S.heap[1],S.heap[--S.heap_max]=H,S.heap[--S.heap_max]=W,G[2*R]=G[2*H]+G[2*W],S.depth[R]=(S.depth[H]>=S.depth[W]?S.depth[H]:S.depth[W])+1,G[2*H+1]=G[2*W+1]=R,S.heap[1]=R++,me(S,G,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(oe,we){var tt,Oe,nt,fe,lt,yt,Re=we.dyn_tree,Ht=we.max_code,Tn=we.stat_desc.static_tree,Cn=we.stat_desc.has_stree,In=we.stat_desc.extra_bits,Wt=we.stat_desc.extra_base,rt=we.stat_desc.max_length,ct=0;for(fe=0;fe<=b;fe++)oe.bl_count[fe]=0;for(Re[2*oe.heap[oe.heap_max]+1]=0,tt=oe.heap_max+1;tt<p;tt++)rt<(fe=Re[2*Re[2*(Oe=oe.heap[tt])+1]+1]+1)&&(fe=rt,ct++),Re[2*Oe+1]=fe,Ht<Oe||(oe.bl_count[fe]++,lt=0,Wt<=Oe&&(lt=In[Oe-Wt]),yt=Re[2*Oe],oe.opt_len+=yt*(fe+lt),Cn&&(oe.static_len+=yt*(Tn[2*Oe+1]+lt)));if(ct!==0){do{for(fe=rt-1;oe.bl_count[fe]===0;)fe--;oe.bl_count[fe]--,oe.bl_count[fe+1]+=2,oe.bl_count[rt]--,ct-=2}while(0<ct);for(fe=rt;fe!==0;fe--)for(Oe=oe.bl_count[fe];Oe!==0;)Ht<(nt=oe.heap[--tt])||(Re[2*nt+1]!==fe&&(oe.opt_len+=(fe-Re[2*nt+1])*Re[2*nt],Re[2*nt+1]=fe),Oe--)}}(S,P),be(G,ue,S.bl_count)}function a(S,P,H){var W,R,G=-1,J=P[1],$=0,te=7,ue=4;for(J===0&&(te=138,ue=3),P[2*(H+1)+1]=65535,W=0;W<=H;W++)R=J,J=P[2*(W+1)+1],++$<te&&R===J||($<ue?S.bl_tree[2*R]+=$:R!==0?(R!==G&&S.bl_tree[2*R]++,S.bl_tree[2*j]++):$<=10?S.bl_tree[2*O]++:S.bl_tree[2*F]++,G=R,ue=($=0)===J?(te=138,3):R===J?(te=6,3):(te=7,4))}function V(S,P,H){var W,R,G=-1,J=P[1],$=0,te=7,ue=4;for(J===0&&(te=138,ue=3),W=0;W<=H;W++)if(R=J,J=P[2*(W+1)+1],!(++$<te&&R===J)){if($<ue)for(;q(S,R,S.bl_tree),--$!=0;);else R!==0?(R!==G&&(q(S,R,S.bl_tree),$--),q(S,j,S.bl_tree),X(S,$-3,2)):$<=10?(q(S,O,S.bl_tree),X(S,$-3,3)):(q(S,F,S.bl_tree),X(S,$-11,7));G=R,ue=($=0)===J?(te=138,3):R===J?(te=6,3):(te=7,4)}}i(Z);var L=!1;function E(S,P,H,W){X(S,(c<<1)+(W?1:0),3),function(R,G,J,$){ce(R),$&&(ne(R,J),ne(R,~J)),e.arraySet(R.pending_buf,R.window,G,J,R.pending),R.pending+=J}(S,P,H,!0)}o._tr_init=function(S){L||(function(){var P,H,W,R,G,J=new Array(b+1);for(R=W=0;R<y-1;R++)for(M[R]=W,P=0;P<1<<I[R];P++)u[W++]=R;for(u[W-1]=R,R=G=0;R<16;R++)for(Z[R]=G,P=0;P<1<<B[R];P++)D[G++]=R;for(G>>=7;R<d;R++)for(Z[R]=G<<7,P=0;P<1<<B[R]-7;P++)D[256+G++]=R;for(H=0;H<=b;H++)J[H]=0;for(P=0;P<=143;)Y[2*P+1]=8,P++,J[8]++;for(;P<=255;)Y[2*P+1]=9,P++,J[9]++;for(;P<=279;)Y[2*P+1]=7,P++,J[7]++;for(;P<=287;)Y[2*P+1]=8,P++,J[8]++;for(be(Y,m+1,J),P=0;P<d;P++)k[2*P+1]=5,k[2*P]=pe(P,5);re=new se(Y,I,h+1,m,b),U=new se(k,B,0,d,b),ie=new se(new Array(0),T,0,v,x)}(),L=!0),S.l_desc=new z(S.dyn_ltree,re),S.d_desc=new z(S.dyn_dtree,U),S.bl_desc=new z(S.bl_tree,ie),S.bi_buf=0,S.bi_valid=0,ae(S)},o._tr_stored_block=E,o._tr_flush_block=function(S,P,H,W){var R,G,J=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function($){var te,ue=4093624447;for(te=0;te<=31;te++,ue>>>=1)if(1&ue&&$.dyn_ltree[2*te]!==0)return r;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return t;for(te=32;te<h;te++)if($.dyn_ltree[2*te]!==0)return t;return r}(S)),ke(S,S.l_desc),ke(S,S.d_desc),J=function($){var te;for(a($,$.dyn_ltree,$.l_desc.max_code),a($,$.dyn_dtree,$.d_desc.max_code),ke($,$.bl_desc),te=v-1;3<=te&&$.bl_tree[2*N[te]+1]===0;te--);return $.opt_len+=3*(te+1)+5+5+4,te}(S),R=S.opt_len+3+7>>>3,(G=S.static_len+3+7>>>3)<=R&&(R=G)):R=G=H+5,H+4<=R&&P!==-1?E(S,P,H,W):S.strategy===4||G===R?(X(S,2+(W?1:0),3),Ae(S,Y,k)):(X(S,4+(W?1:0),3),function($,te,ue,oe){var we;for(X($,te-257,5),X($,ue-1,5),X($,oe-4,4),we=0;we<oe;we++)X($,$.bl_tree[2*N[we]+1],3);V($,$.dyn_ltree,te-1),V($,$.dyn_dtree,ue-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,J+1),Ae(S,S.dyn_ltree,S.dyn_dtree)),ae(S),W&&ce(S)},o._tr_tally=function(S,P,H){return S.pending_buf[S.d_buf+2*S.last_lit]=P>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&P,S.pending_buf[S.l_buf+S.last_lit]=255&H,S.last_lit++,P===0?S.dyn_ltree[2*H]++:(S.matches++,P--,S.dyn_ltree[2*(u[H]+h+1)]++,S.dyn_dtree[2*C(P)]++),S.last_lit===S.lit_bufsize-1},o._tr_align=function(S){X(S,2,3),q(S,A,Y),function(P){P.bi_valid===16?(ne(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):8<=P.bi_valid&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,l,o){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,l,o){(function(e){(function(r,t){if(!r.setImmediate){var i,c,y,h,m=1,d={},v=!1,p=r.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(r);b=b&&b.setTimeout?b:r,i={}.toString.call(r.process)==="[object process]"?function(j){process.nextTick(function(){x(j)})}:function(){if(r.postMessage&&!r.importScripts){var j=!0,O=r.onmessage;return r.onmessage=function(){j=!1},r.postMessage("","*"),r.onmessage=O,j}}()?(h="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",A,!1):r.attachEvent("onmessage",A),function(j){r.postMessage(h+j,"*")}):r.MessageChannel?((y=new MessageChannel).port1.onmessage=function(j){x(j.data)},function(j){y.port2.postMessage(j)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function(j){var O=p.createElement("script");O.onreadystatechange=function(){x(j),O.onreadystatechange=null,c.removeChild(O),O=null},c.appendChild(O)}):function(j){setTimeout(x,0,j)},b.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var O=new Array(arguments.length-1),F=0;F<O.length;F++)O[F]=arguments[F+1];var I={callback:j,args:O};return d[m]=I,i(m),m++},b.clearImmediate=g}function g(j){delete d[j]}function x(j){if(v)setTimeout(x,0,j);else{var O=d[j];if(O){v=!0;try{(function(F){var I=F.callback,B=F.args;switch(B.length){case 0:I();break;case 1:I(B[0]);break;case 2:I(B[0],B[1]);break;case 3:I(B[0],B[1],B[2]);break;default:I.apply(t,B)}})(O)}finally{g(j),v=!1}}}}function A(j){j.source===r&&typeof j.data=="string"&&j.data.indexOf(h)===0&&x(+j.data.slice(h.length))}})(typeof self>"u"?e===void 0?this:e:self)}).call(this,typeof dt<"u"?dt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(wn);var ei=wn.exports;const ti=qn(ei),ni=async(s,_,n,l,o)=>{var i,c,y;const e=document.querySelector(`svg#${s}`);if(!e)throw new Error("Requested canvas SVG element not found");const r=Number((i=e.style.getPropertyValue("--rmg-svg-height").match(/\d+/g))==null?void 0:i[0]),t=e.cloneNode(!0);if(t.setAttribute("height",(r*(o||100)/100).toString()),t.style.setProperty("all","initial"),["share"].map(h=>{var m;return[...((m=[...document.querySelectorAll("link")].filter(d=>d.id==="css_"+h)[0])==null?void 0:m.sheet).cssRules].map(d=>d.cssText).join(" ")}).forEach(h=>{const m=document.createElement("style");m.textContent=h,t.prepend(m)}),(c=t.querySelector("rect#canvas-border"))==null||c.setAttribute("stroke",l?"black":"none"),(y=t.querySelector("rect#canvas-bg"))==null||y.setAttribute("fill",n?"none":"white"),_===Q.MTR)try{const h=await ii(t),m=document.createElement("style");m.textContent=h.join(`
`),t.prepend(m)}catch(h){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(h)}return t},ri=s=>new Promise(_=>{const n=new FileReader;n.onloadend=()=>_(n.result),n.readAsDataURL(s)}),si=(s,_)=>s.find(n=>{const l=n.style;return l.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===_.family&&l.getPropertyValue("unicode-range")===_.unicodeRange}),ii=async s=>{var e,r,t;const _=Array.from(new Set([...s.querySelectorAll(".rmg-name__zh"),...s.querySelectorAll(".rmg-name__en")].map(i=>i.innerHTML).join("").replace(/\s/g,""))).join(""),n=await document.fonts.load("80px GenYoMin TW, Vegur",_),l=Array.from(((t=(r=(e=document.querySelector("link#css_share"))==null?void 0:e.sheet)==null?void 0:r.cssRules)==null?void 0:t[0]).styleSheet.cssRules),o=n.reduce((i,c)=>{const y=si(l,c);return y?i.find(m=>{const d=m.style,v=y.style;return d.getPropertyValue("font-family")===v.getPropertyValue("font-family")&&d.getPropertyValue("unicode-range")===v.getPropertyValue("unicode-range")})?i:i.concat(y):i},[]);return await Promise.all(o.map(async i=>{try{const c=await fetch(ai(i)),y=await ri(await c.blob());return i.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${y}'); `)}catch(c){return console.error(c),""}}))},ai=s=>{var n;const _=s.style.src;return gn()?_.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmg/styles/"+((n=_.match(/^url\("([\S*]+)"\)/))==null?void 0:n[1])},oi=async(s,_,n)=>{const l=s.viewBox.baseVal.width,o=s.viewBox.baseVal.height,e=document.querySelectorAll("canvas")[0];e.width=Number(l)*window.devicePixelRatio*_,e.height=Number(o)*window.devicePixelRatio*_,s.setAttribute("width",e.width.toString()),s.setAttribute("height",e.height.toString());const r=e.getContext("2d");return r.clearRect(0,0,e.width,e.height),s.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach(t=>t.setAttribute("font-size","11px")),s.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach(t=>t.setAttribute("font-size","8.5px")),s.querySelectorAll("text, tspan").forEach(t=>{const i=window.getComputedStyle(t);t.setAttribute("font-family",i.fontFamily),t.setAttribute("fill",i.fill),t.setAttribute("dominant-baseline",i.dominantBaseline),t.setAttribute("text-anchor",i.textAnchor||"")}),new Promise((t,i)=>{const c=new Image;c.onload=()=>{setTimeout(()=>{r.drawImage(c,0,0,e.width,e.height),e.toBlob(y=>{y?t(y):i("Canvas blob is null")},"image/png")},n?2e3:0)},c.onerror=i,c.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s.outerHTML)))})};function li(s){const{isOpen:_,onClose:n}=s,{t:l}=le(),o=_e(),[e,r]=K.useState(""),[t,i]=K.useState(!1),[c,y]=K.useState(!1),[h,m]=K.useState(100),[d,v]=K.useState("png"),p=ee(T=>T.app.canvasToShow),{style:b,stn_list:g,current_stn_idx:x,line_name:A}=ee(T=>T.param);K.useEffect(()=>{e!==""&&!p.includes(e)&&r("")},[p]);const j=Ft[b].reduce((T,N)=>p.includes(N)?{...T,[N]:l("CanvasType."+N)}:{...T},{"":l("DownloadModal.pleaseSelect")}),O=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].reduce((T,N)=>({...T,[N]:`${N}%`}),{}),F={png:l("DownloadModal.png"),svg:l("DownloadModal.svg")},I=[{type:"select",label:l("DownloadModal.canvas"),value:e,options:j,disabledOptions:[""],onChange:T=>r(T),minW:"full"},{type:"switch",label:l("DownloadModal.transparent"),isChecked:t,onChange:i,oneLine:!0,minW:"full"},{type:"switch",label:l("DownloadModal.showBorder"),isChecked:c,onChange:y,oneLine:!0,minW:"full"},{type:"select",label:l("DownloadModal.scale"),value:h,options:O,onChange:T=>m(T)},{type:"select",label:l("DownloadModal.format"),value:d,options:F,onChange:T=>v(T)}],B=async T=>{o(Qt(0));const N=T==="current"?[x]:Object.keys(g).filter(k=>!["linestart","lineend"].includes(k)),Y=new ti;for(const k in N){o(Qt((Number(k)+1)/N.length*100));const D=N[k];o(Pt(D)),await os(500);const u=await ni(e,b,t,c,h);document.body.appendChild(u);const M=`rmg.${D}.${g[D].name[0]}.${g[D].name[1]}`.replaceAll(/\\|\/|\||\*|:|\?|<|>|"/g,"_");if(d==="png"){const re=gn()&&k==="0",U=await oi(u,h/100,re);N.length>1?Y.file(`${M}.png`,U):en(`${M}.png`,U)}else if(d==="svg"){u.removeAttribute("height");const re="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(u.outerHTML)));N.length>1?Y.file(`${M}.svg`,re.split("base64,")[1],{base64:!0}):vn(M+".svg","image/svg+xml",u.outerHTML)}document.body.removeChild(u)}if(N.length>1){const k=await Y.generateAsync({type:"blob"}),D=`rmg.${A[0]}.${A[1]}.zip`.replaceAll(" ","_");en(D,k)}he.event(ye.DOWNLOAD_IMAGES,{canvasToDownload:e,style:b,option:T,format:d}),o(Pt(x)),o(fn()),n()};return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[f.jsx(Ue,{children:l("DownloadModal.title")}),f.jsx(Ze,{}),f.jsx(Ge,{children:f.jsx(ge,{fields:I})}),f.jsx(Qe,{children:f.jsxs(Ie,{children:[f.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>B("current"),isDisabled:!e,children:l("DownloadModal.downloadOne")}),b!==Q.GZMTR&&f.jsx(de,{colorScheme:"primary",variant:"outline",size:"sm",onClick:()=>B("all"),isDisabled:!e,children:l("DownloadModal.downloadAll")})]})})]})]})}function ci(){const{t:s}=le(),[_,n]=K.useState(!1),{paramConfig:l}=ee(r=>r.app),o=ee(r=>r.param),e=()=>{vn(`RMG_${l==null?void 0:l.id}.json`,"application/json",JSON.stringify(o)),he.event(ye.DOWNLOAD_PARAM,{style:o.style})};return f.jsxs(Kn,{children:[f.jsx(Xn,{as:de,variant:"ghost",size:"sm",rightIcon:f.jsx(Jn,{}),children:s("DownloadActions.downloads")}),f.jsxs(Qn,{children:[f.jsx($t,{onClick:e,children:s("DownloadActions.configFile")}),f.jsx($t,{onClick:()=>n(!0),children:s("DownloadActions.images")})]}),f.jsx(li,{isOpen:_,onClose:()=>n(!1)})]})}function vt(){const[s,_]=er();return[s,l=>{if(_(l),Object.keys(l)){const o=new URLSearchParams(l);he.updateUrl("/rmg/?"+o)}else he.updateUrl("/rmg/")}]}function di(){const{t:s}=le(),_=Dt(),[,n]=vt(),l=()=>{_(Je(Ve.CLOSE)),_(_n(void 0)),n({})};return f.jsxs(Ie,{ml:"auto",w:"fit-content",children:[f.jsx(de,{variant:"ghost",size:"sm",leftIcon:f.jsx(tr,{}),onClick:l,children:s("All projects")}),f.jsx(ci,{}),f.jsx(de,{variant:"solid",size:"sm",colorScheme:"primary",leftIcon:f.jsx(nr,{}),onClick:()=>_(Je(Ve.STYLE)),children:s("HeaderActions.editStyle")})]})}function ui(){const{t:s}=le(),_=_e(),{canvasToShow:n,canvasScale:l}=ee(c=>c.app),o=ee(c=>c.param.style),e=Object.values(Q).reduce((c,y)=>({...c,[y]:s("RmgStyle."+y)}),{}),r=Ft[o].map(c=>({label:s("CanvasType."+c),value:c})),t=c=>{_(ts(c))},i=[{type:"select",label:s("Style"),value:o,options:e,onChange:c=>t(c)},{type:"custom",label:s("View"),component:f.jsx(rr,{displayValue:s("Select canvas"),selections:r,defaultValue:n,onChange:c=>_(Qr(c))})},{type:"slider",label:s("Canvas scale"),value:l,min:.1,max:2,step:.01,onChange:c=>_(es(c)),leftIcon:f.jsx(sr,{}),rightIcon:f.jsx(ir,{})}];return f.jsxs(ar,{children:[f.jsx(ge,{fields:i,minW:160}),f.jsx(di,{})]})}const hi=s=>{switch(s){case Q.MTR:return[Ce.Hongkong,"twl","#E2231A",xe.white];case Q.GZMTR:return[Ce.Guangzhou,"gz1","#F3D03E",xe.black];case Q.SHMetro:return[Ce.Shanghai,"sh1","#E4002B",xe.white];default:return[Ce.Other,"other","#AAAAAA",xe.white]}},pi=s=>{switch(s){case"zh-Hans":return["1号线","Line 1"];case"zh-Hant":return["荃灣綫","Tsuen Wan Line"];default:return["地鐵線","Metro Line"]}},st=s=>({name:["未命名 "+s,"Unnamed "+s],secondaryName:!1,num:"00",services:[Ot.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:Ke.right,paid_area:!0},facility:Te.none,loop_pivot:!1,one_line:!0,int_padding:355}),mi=(s,_)=>{const n=st("linestart");n.name=["LEFT END","LEFT END"];const l=st("lineend");l.name=["RIGHT END","RIGHT END"];const o=qe(6),e=st(o);e.num="01";const r=qe(6),t=st(r);return t.num="02",n.children=[o],e.parents=["linestart"],e.children=[r],t.parents=[o],t.children=["lineend"],l.parents=[r],{svgWidth:{destination:1200,runin:1200,railmap:1200,indoor:1200},svg_height:300,style:s,y_pc:50,padding:10,branchSpacingPct:33,direction:Ke.left,platform_num:"1",theme:hi(s),line_name:pi(_),current_stn_idx:r,stn_list:{linestart:n,[o]:e,[r]:t,lineend:l},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:s===Q.SHMetro?pn.sh:hn.gz1,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:1,bottom_factor:1}}},it=(s,_,n,l)=>(o,e)=>{const r=e().param.stn_list;let t=qe(6);for(;t in r;)t=qe(6);const i=st(t);if(s!=="new"){const c={...r,[_]:{...r[_],children:r[_].children.map(y=>y===n?t:y),branch:{left:r[_].branch.left,right:r[_].branch.right.length&&r[_].branch.right[1]===n?[r[_].branch.right[0],t]:r[_].branch.right}},[n]:{...r[n],parents:r[n].parents.map(y=>y===_?t:y),branch:{left:r[n].branch.left.length&&r[n].branch.left[1]===_?[r[n].branch.left[0],t]:r[n].branch.left,right:r[n].branch.right}},[t]:{...i,parents:[_],children:[n]}};return o(Me(c)),t}else{if(!l)return!1;const c={...r,[_]:{...r[_],children:l==="upper"?[t,r[_].children[0]]:[r[_].children[0],t],branch:{left:r[_].branch.left,right:[pt.through,t]}},[n]:{...r[n],parents:l==="upper"?[t,r[n].parents[0]]:[r[n].parents[0],t],branch:{left:[pt.through,t],right:r[n].branch.right}},[t]:{...i,parents:[_],children:[n]}};return o(Me(c)),t}},fi=(s,_,n)=>(l,o)=>{const r=o().helper.branches[s];if(r!=null&&r.length)if(_==="before"){const t=r[r.indexOf(n)-1];return l(it(s.toString(),t,n))}else{const t=r[r.indexOf(n)+1];return l(it(s.toString(),n,t))}else return!1},_i=()=>(s,_)=>{const n=_().param.stn_list;return _().helper.branches[0].filter(o=>{const e=n[o].parents.length+n[o].children.length===4,r=Vt(o,n)===0;return!e&&r})},nn=(s,_)=>(n,l)=>{const o=l().param.stn_list,e=l().helper.branches;return!e[0].includes(s)||!e[0].includes(_)?"Branch should end at main line":e[0].indexOf(s)>=e[0].indexOf(_)?"Not in correct ordering":s==="linestart"&&_==="lineend"?"Should not be parallel to main line":s==="linestart"&&e[0].indexOf(_)===1?"Branch should not be open jaw from the first station":_==="lineend"&&e[0].indexOf(s)===e[0].length-2?"Branch should not be open jaw from the last station":o[s].children.length>1||o[_].parents.length>1?"Branch already exist":e.slice(1).some(i=>i.slice(1,-1).includes(s)||i.slice(1,-1).includes(_))?"Cannot branch out from existing branch":e[0].slice(e[0].indexOf(s)+1,e[0].indexOf(_)).every(i=>o[i].parents.length===1&&o[i].children.length===1)?"":"One or more stations between both ends are branching out"};function gi(s){var F,I;const{isOpen:_,onClose:n}=s,{t:l}=le(),o=_e(),e=ee(B=>B.app.selectedBranch),{style:r,stn_list:t}=ee(B=>B.param),i=ee(B=>B.helper.branches),[c,y]=K.useState(e),[h,m]=K.useState("before"),[d,v]=K.useState(""),[p,b]=K.useState(!1);K.useEffect(()=>{y(e)},[e]),K.useEffect(()=>{_||b(!1)},[_]);const g=(I=(F=i[Number(c)])==null?void 0:F.slice(1,-1))!=null?I:[],x=B=>B.reduce((T,N)=>{var Y;return{...T,[N]:(Y=t[N])==null?void 0:Y.name.join(" - ")}},{"":l("AddStationModal.pleaseSelect")}),A=[{type:"select",label:l("AddStationModal.where"),value:c,options:{...i.reduce((B,T,N)=>({...B,[N]:N===0?l("AddStationModal.main"):r!==Q.SHMetro||!et(T,t)?l("AddStationModal.branch")+" "+N:l("AddStationModal.external")+" "+N}),{})},onChange:B=>j(B),minW:"full"},{type:"select",label:l("AddStationModal.preposition"),value:h,options:{before:l("AddStationModal.before"),after:l("AddStationModal.after")},onChange:B=>m(B)},{type:"select",label:l("AddStationModal.pivot"),value:d,options:x(g),disabledOptions:[""],onChange:B=>v(B)}],j=B=>{y(B),v("")},O=()=>{const B=o(fi(c,h,d));B?(n(),o(mn(B)),o(Je(Ve.STATION))):(console.log("false here"),b(!0)),he.event(ye.ADD_STATION,{style:r,branchIndex:c,success:B})};return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[p&&f.jsxs(_t,{status:"error",variant:"solid",size:"xs",children:[f.jsx(gt,{}),l("AddStationModal.error")]}),f.jsxs(Ee,{position:"relative",children:[f.jsx(Ue,{children:l("AddStationModal.title")}),f.jsx(Ze,{})]}),f.jsx(Ge,{children:f.jsx(ge,{fields:A})}),f.jsx(Qe,{children:f.jsx(de,{colorScheme:"primary",onClick:O,isDisabled:!d,children:l("Confirm")})})]})]})}function vi(s){const{isOpen:_,onClose:n}=s,{t:l}=le(),o=_e(),[e,r]=K.useState("new"),[t,i]=K.useState(""),[c,y]=K.useState(""),[h,m]=K.useState("upper"),[d,v]=K.useState(""),[p,b]=K.useState(""),{style:g,stn_list:x}=ee(Y=>Y.param);K.useEffect(()=>{_||(r("new"),i(""),y(""))},[_]);const j=(Y=>Y.reduce((k,D)=>{var u;return{...k,[D]:(u=x[D])==null?void 0:u.name.join(" - ")}},{"":l("NewBranchModal.pleaseSelect")}))(o(_i())),O=[{type:"select",label:l("NewBranchModal.where"),value:e,options:{new:l("NewBranchModal.new"),ext:l("NewBranchModal.ext")},disabledOptions:g===Q.SHMetro?[]:["ext"],onChange:Y=>F(Y),minW:"full"},{type:"select",label:l("NewBranchModal.from"),value:t,options:j,disabledOptions:[""],onChange:Y=>I(Y),isInvalid:!!d},{type:"select",label:l("NewBranchModal.to"),value:c,options:j,disabledOptions:[""],onChange:Y=>B(Y),isInvalid:!!p},{type:"select",label:l("NewBranchModal.position"),value:h,options:{upper:l("NewBranchModal.upper"),lower:l("NewBranchModal.lower")},onChange:Y=>m(Y),minW:"full",hidden:e!=="new"||g===Q.SHMetro}],F=Y=>{r(Y),i(""),y(""),v(""),b("")},I=Y=>{i(Y),v(""),Y&&c&&b(o(nn(Y,c)))},B=Y=>{y(Y),b(""),t&&Y&&v(o(nn(t,Y)))},T=()=>{let Y;e==="ext"?Y=o(it("new",t,c,"lower")):g===Q.SHMetro?Y=o(it("new",t,c,"upper")):Y=o(it("new",t,c,h)),Y&&(n(),he.event(ye.ADD_BRANCH,{style:g,where:e}))},N=!!(!t||!c||d||p);return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[f.jsx(Ue,{children:l("NewBranchModal.title")}),f.jsx(Ze,{}),f.jsx(Ge,{children:f.jsx(ge,{fields:O})}),f.jsx(Qe,{children:f.jsx(de,{colorScheme:"primary",title:N?d||p:l("Confirm"),onClick:T,isDisabled:N,children:l("Confirm")})})]})]})}const yi=K.lazy(()=>w(()=>import("./station-ag-grid-34571798.js"),["assets/station-ag-grid-34571798.js","assets/vendor-dfcbff68.js","assets/index-13ec54b0.js","assets/index-522067ed.css","assets/param-selector-45ed06b7.js"]));function bi(){const{t:s}=le(),_=_e(),[n,l]=K.useState(!1),[o,e]=K.useState(!1),r=ee(h=>h.app.selectedBranch),{style:t,stn_list:i}=ee(h=>h.param),c=ee(h=>h.helper.branches),y=()=>{_(Je(Ve.BRANCH))};return f.jsxs(Ee,{flex:1,overflow:"hidden",children:[f.jsxs(Tt,{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",index:r,onChange:h=>_(ns(h)),children:[f.jsxs(Ct,{children:[c.map((h,m)=>m===0?f.jsx($e,{children:s("GridTabs.main")},m):t!==Q.SHMetro||!et(h,i)?f.jsx($e,{children:s("GridTabs.branch")+" "+m},m):f.jsx($e,{children:s("GridTabs.external")+" "+m},m)),f.jsx(Le,{size:"sm",variant:"ghost",alignSelf:"center","aria-label":"New branch",onClick:()=>e(!0),icon:f.jsx(ze,{})}),f.jsxs(Ie,{marginLeft:"auto",marginRight:1,children:[f.jsx(de,{variant:"outline",size:"xs",leftIcon:f.jsx(ze,{}),onClick:()=>l(!0),children:s("GridTabs.addStation")}),f.jsx(de,{size:"xs",colorScheme:"primary",onClick:y,children:s("GridTabs.editLine")})]})]}),f.jsx(It,{flex:1,overflowY:"auto",children:c.map((h,m)=>f.jsx(ht,{padding:0,h:"100%",position:"relative",children:f.jsx(sn,{suspenseFallback:f.jsx(mt,{isIndeterminate:!0}),children:f.jsx(yi,{branchIndex:m})})},m))})]}),f.jsx(gi,{isOpen:n,onClose:()=>l(!1)}),f.jsx(vi,{isOpen:o,onClose:()=>e(!1)})]})}function Si(){const s=_e(),_=ee(l=>l.app.globalAlerts),n=l=>{he.isStandaloneWindow()?window.open(`/${l}`,"_blank"):he.openApp(l)};return f.jsx(f.Fragment,{children:Object.entries(_).map(([l,{message:o,url:e,linkedApp:r}])=>f.jsxs(_t,{status:l,variant:"solid",size:"xs",pl:3,pr:1,py:0,children:[f.jsx(gt,{}),r?f.jsx(Ye,{onClick:()=>n(r),children:o}):e?f.jsx(Ye,{href:e,target:"_blank",children:o}):o,f.jsx(or,{ml:"auto",onClick:()=>s(rs(l))})]},l))})}function xi(){const{t:s}=le(),_=ee(o=>o.app.isLoading),[n,l]=K.useState(!1);return K.useEffect(()=>{he.isStandaloneWindow()&&!window.localStorage.getItem(Fe.DO_NOT_SHOW_RMT_MSG)&&l(!0)},[]),f.jsxs(dn,{children:[_&&f.jsx(mt,{isIndeterminate:_<0,value:_>=0?_:void 0}),f.jsx(ui,{}),n&&f.jsxs(_t,{status:"info",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[f.jsx(gt,{}),f.jsxs(at,{sx:{"& a, button":{fontWeight:"bold",textDecoration:"underline"}},children:[s("Try out")," ",f.jsx(Ye,{href:"/?app=rmg",isExternal:!0,children:s("Rail Map Toolkit")})," ",s("now and enjoy an even better rail map design experience!")," ",f.jsx(Ye,{as:"button",ml:"auto",onClick:()=>l(!1),children:s("Close")})," | ",f.jsx(Ye,{as:"button",onClick:()=>{l(!1),window.localStorage.setItem(Fe.DO_NOT_SHOW_RMT_MSG,"true")},children:s("Don't show me again")})]})]}),f.jsx(Si,{}),f.jsxs(Pe,{flex:1,overflow:"hidden",position:"relative",children:[f.jsxs(Pe,{as:"section",direction:"column",flex:1,ml:1,mr:1,overflow:"hidden",children:[f.jsx(Ee,{children:f.jsx(ps,{})}),f.jsx(bi,{})]}),f.jsx(Qs,{})]}),f.jsx("canvas",{style:{display:"none"}})]})}const jn=[{id:"basic",name:{en:"Basic",ko:"기본",zh:"基本"}},{id:"mtr",name:{en:"MTR",ko:"홍콩 지하철","zh-Hans":"港铁","zh-Hant":"港鐵"}},{id:"gzmtr",name:{en:"Guangzhou Metro",ko:"광저우 지하철","zh-Hans":"广州地铁","zh-Hant":"廣州地鐵"}},{id:"shmetro",name:{en:"Shanghai Metro",ko:"상해 지하철","zh-Hans":"上海地铁","zh-Hant":"上海地鐵"}}],Ei=Object.freeze(Object.defineProperty({__proto__:null,default:jn},Symbol.toStringTag,{value:"Module"})),kn=[{filename:"default",name:{en:"Default",ko:"묵인","zh-Hans":"默认","zh-Hant":"預設"},style:"mtr"},{filename:"coline",name:{en:"Track Share",ko:"공용선","zh-Hans":"共线","zh-Hant":"共綫"},style:"shmetro"},{filename:"loop",name:{en:"Loop Line",ko:"순환선","zh-Hans":"环线","zh-Hant":"環綫"},style:"shmetro"}],An=[{filename:"twl",name:{en:"Tsuen Wan Line",ko:"췬완선","zh-Hans":"荃湾线","zh-Hant":"荃灣綫"},uploadBy:"wongchito",style:"mtr"},{filename:"ktl",name:{en:"Kwun Tong Line",ko:"군통선","zh-Hans":"观塘线","zh-Hant":"觀塘綫"},uploadBy:"wongchito",style:"mtr"},{filename:"isl",name:{en:"Island Line",ko:"공도선","zh-Hans":"港岛线","zh-Hant":"港島綫"},uploadBy:"wongchito",style:"mtr"},{filename:"tkl",name:{en:"Tseung Kwan O Line",ko:"정관오선","zh-Hans":"将军澳线","zh-Hant":"將軍澳綫"},uploadBy:"wongchito",style:"mtr"},{filename:"tcl",name:{en:"Tung Chung Line",ko:"둥충선","zh-Hans":"东涌线","zh-Hant":"東涌綫"},uploadBy:"wongchito",style:"mtr"},{filename:"sile",name:{en:"South Island Line",ko:"남공도선","zh-Hans":"南港岛线","zh-Hant":"南港島綫"},uploadBy:"wongchito",style:"mtr"},{filename:"drl",name:{en:"Disneyland Resort Line",ko:"디즈니선","zh-Hans":"迪士尼线","zh-Hant":"迪士尼綫"},uploadBy:"wongchito",style:"mtr"},{filename:"ael",name:{en:"Airport Express",ko:"홍콩 공항철도","zh-Hans":"机场快线","zh-Hant":"機場快綫"},uploadBy:"wongchito",style:"mtr"},{filename:"eal",name:{en:"East Rail Line",ko:"둥팃선","zh-Hans":"东铁线","zh-Hant":"東鐵綫"},uploadBy:"wongchito",style:"mtr"},{filename:"tml",name:{en:"Tuen Ma Line",ko:"튄마선","zh-Hans":"屯马线","zh-Hant":"屯馬綫"},uploadBy:"wongchito",style:"mtr"}],On=[{filename:"gz1",name:{en:"Line 1",ko:"1호선","zh-Hans":"1号线","zh-Hant":"1號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz2",name:{en:"Line 2",ko:"2호선","zh-Hans":"2号线","zh-Hant":"2號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz3",name:{en:"Line 3",ko:"3호선","zh-Hans":"3号线","zh-Hant":"3號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz4",name:{en:"Line 4",ko:"4호선","zh-Hans":"4号线","zh-Hant":"4號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz5",name:{en:"Line 5",ko:"5호선","zh-Hans":"5号线","zh-Hant":"5號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz6",name:{en:"Line 6",ko:"6호선","zh-Hans":"6号线","zh-Hant":"6號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz7",name:{en:"Line 7",ko:"7호선","zh-Hans":"7号线","zh-Hant":"7號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz8",name:{en:"Line 8",ko:"8호선","zh-Hans":"8号线","zh-Hant":"8號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz9",name:{en:"Line 9",ko:"9호선","zh-Hans":"9号线","zh-Hant":"9號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz13",name:{en:"Line 13",ko:"13호선","zh-Hans":"13号线","zh-Hant":"13號線"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"gz14",name:{en:"Line 14",ko:"14호선","zh-Hans":"14号线","zh-Hant":"14號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz18",name:{en:"Line 18","zh-Hans":"18号线","zh-Hant":"18號線",ko:"18호선"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"gz21",name:{en:"Line 21",ko:"21호선","zh-Hans":"21号线","zh-Hant":"21號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gz22",name:{en:"Line 22",ko:"22호선","zh-Hans":"22号线","zh-Hant":"22號線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"gf",name:{en:"Guangfo Line",ko:"광포 지하철","zh-Hans":"广佛线","zh-Hant":"廣佛線"},uploadBy:"wongchito",style:"gzmtr"},{filename:"apm",name:{en:"APM Line",ko:"주장신청 자동운송 체계","zh-Hans":"APM线","zh-Hant":"APM線"},uploadBy:"Dingdong2334",style:"gzmtr"},{filename:"thz1",name:{en:"Haizhu Tram Line 1",ko:"하이주 전차 1호선","zh-Hans":"海珠有轨1号线","zh-Hant":"海珠有軌1號線"},uploadBy:"clearng-kly",style:"gzmtr"},{filename:"thp1",name:{en:"Huangpu Tram Line 1",ko:"황푸 전차 1호선","zh-Hans":"黄埔有轨1号线","zh-Hant":"黃埔有軌1號線"},uploadBy:"clearng-kly",style:"gzmtr"}],Pn=[{filename:"sh1",name:{en:"Line 1",ko:"1호선","zh-Hans":"1号线","zh-Hant":"1號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh2",name:{en:"Line 2",ko:"2호선","zh-Hans":"2号线","zh-Hant":"2號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh3",name:{en:"Line 3 (External)",ko:"3호선(공선)","zh-Hans":"3号线 （共线）","zh-Hant":"3號線 （共線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh4",name:{en:"Line 4 (Loop)",ko:"4호선(순환선)","zh-Hans":"4号线 （环线）","zh-Hant":"4號線 （環線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh3&4",name:{en:"Line 3 and 4 (External with Loop)",ko:"3호선과 4호선(공선과 순환선)","zh-Hans":"3与4号线 （共线与环线）","zh-Hant":"3與4號線 （共線與環線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh5",name:{en:"Line 5",ko:"5호선","zh-Hans":"5号线","zh-Hant":"5號線"},uploadBy:"Tianxiu11111",style:"shmetro"},{filename:"sh6",name:{en:"Line 6",ko:"6호선","zh-Hans":"6号线","zh-Hant":"6號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh7",name:{en:"Line 7",ko:"7호선","zh-Hans":"7号线","zh-Hant":"7號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh8",name:{en:"Line 8",ko:"8호선","zh-Hans":"8号线","zh-Hant":"8號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh9",name:{en:"Line 9",ko:"9호선","zh-Hans":"9号线","zh-Hant":"9號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh10",name:{en:"Line 10 (Branch)",ko:"10호선(지선)","zh-Hans":"10号线 （支线）","zh-Hant":"10號線 （支線）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh11",name:{en:"Line 11",ko:"11호선","zh-Hans":"11号线","zh-Hant":"11號線"},uploadBy:"Tianxiu11111",style:"shmetro"},{filename:"sh12",name:{en:"Line 12",ko:"12호선","zh-Hans":"12号线","zh-Hant":"12號線"},uploadBy:"Andy1782010",style:"shmetro"},{filename:"sh13",name:{en:"Line 13",ko:"13호선","zh-Hans":"13号线","zh-Hant":"13號線"},uploadBy:"Andy1782010",style:"shmetro"},{filename:"sh14",name:{en:"Line 14",ko:"14호선","zh-Hans":"14号线","zh-Hant":"14號線"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh15",name:{en:"Line 15",ko:"15호선","zh-Hans":"15号线","zh-Hant":"15號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh16",name:{en:"Line 16 (Express)",ko:"16호선(급행)","zh-Hans":"16号线 （快车）","zh-Hant":"16號線 （快車）"},uploadBy:"thekingofcity",style:"shmetro"},{filename:"sh17",name:{en:"Line 17",ko:"17호선","zh-Hans":"17号线","zh-Hant":"17號線"},uploadBy:"Thomastzc",style:"shmetro"},{filename:"sh18",name:{en:"Line 18",ko:"18호선","zh-Hans":"18号线","zh-Hant":"18號線"},uploadBy:"Tianxiu11111",style:"shmetro"}],Rn={basic:kn,mtr:An,gzmtr:On,shmetro:Pn},wi=Object.freeze(Object.defineProperty({__proto__:null,basic:kn,default:Rn,gzmtr:On,mtr:An,shmetro:Pn},Symbol.toStringTag,{value:"Module"}));var rn;(function(s){s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro"})(rn||(rn={}));const wt=jn,ji=Rn,ki=async()=>{try{return await(await fetch("/rmg-templates/resources/other-company-config.json")).json()}catch(s){return console.error("Failed to fetch non-core company config",s),[]}},Ai=async s=>{try{return await(await fetch("/rmg-templates/resources/templates/"+s+"/00config.json")).json()}catch(_){return console.error("Failed to fetch template list for "+s,_),[]}},Oi=async(s,_)=>await(await fetch(`/rmg-templates/resources/templates/${s}/${_}.json`)).json(),Pi=Object.assign({"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/coline.json":()=>w(()=>import("./coline-f8f9d6ad.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/default.json":()=>w(()=>import("./default-8638e856.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/basic/loop.json":()=>w(()=>import("./loop-d33ec3ba.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/company-config.json":()=>w(()=>Promise.resolve().then(()=>Ei),void 0),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/apm.json":()=>w(()=>import("./apm-6e72c810.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gf.json":()=>w(()=>import("./gf-18503731.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz1.json":()=>w(()=>import("./gz1-75ca50af.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz13.json":()=>w(()=>import("./gz13-05ce4bc5.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz14.json":()=>w(()=>import("./gz14-0d29f52b.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz18.json":()=>w(()=>import("./gz18-e8d4e789.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz2.json":()=>w(()=>import("./gz2-4c7b72d4.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz21.json":()=>w(()=>import("./gz21-fde5cfda.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz22.json":()=>w(()=>import("./gz22-68732269.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz3.json":()=>w(()=>import("./gz3-6bbd1d1a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz4.json":()=>w(()=>import("./gz4-cda087f7.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz5.json":()=>w(()=>import("./gz5-9cfad33f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz6.json":()=>w(()=>import("./gz6-ef051d83.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz7.json":()=>w(()=>import("./gz7-d485fe1c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz8.json":()=>w(()=>import("./gz8-9bfb0da0.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/gz9.json":()=>w(()=>import("./gz9-d4b7ed92.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/thp1.json":()=>w(()=>import("./thp1-a903ecca.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/gzmtr/thz1.json":()=>w(()=>import("./thz1-1ae6befb.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/ael.json":()=>w(()=>import("./ael-4597497c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/drl.json":()=>w(()=>import("./drl-31b14420.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/eal.json":()=>w(()=>import("./eal-34089efb.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/isl.json":()=>w(()=>import("./isl-f1ae743f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/ktl.json":()=>w(()=>import("./ktl-a9936c0c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/sile.json":()=>w(()=>import("./sile-9f2ad194.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tcl.json":()=>w(()=>import("./tcl-820e4d78.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tkl.json":()=>w(()=>import("./tkl-8050f7fc.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/tml.json":()=>w(()=>import("./tml-a6ec2eb1.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/mtr/twl.json":()=>w(()=>import("./twl-cfa1235a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh1.json":()=>w(()=>import("./sh1-16505f5a.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh10.json":()=>w(()=>import("./sh10-20d49595.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh11.json":()=>w(()=>import("./sh11-f590ba3c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh12.json":()=>w(()=>import("./sh12-55a7651d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh13.json":()=>w(()=>import("./sh13-f5ab141e.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh14.json":()=>w(()=>import("./sh14-e4f19564.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh15.json":()=>w(()=>import("./sh15-450e891e.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh16.json":()=>w(()=>import("./sh16-af851e67.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh17.json":()=>w(()=>import("./sh17-7a345c0f.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh18.json":()=>w(()=>import("./sh18-57e7f645.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh2.json":()=>w(()=>import("./sh2-5e30f125.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh3&4.json":()=>w(()=>import("./sh3_4-e404007d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh3.json":()=>w(()=>import("./sh3-d2f3bfdd.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh4.json":()=>w(()=>import("./sh4-f52274b7.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh5.json":()=>w(()=>import("./sh5-4c805b99.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh6.json":()=>w(()=>import("./sh6-9ebc745d.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh7.json":()=>w(()=>import("./sh7-8f088603.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh8.json":()=>w(()=>import("./sh8-87130c53.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/shmetro/sh9.json":()=>w(()=>import("./sh9-7e967e6c.js"),[]),"/node_modules/@railmapgen/rmg-templates-resources/templates/template-configs.json":()=>w(()=>Promise.resolve().then(()=>wi),void 0)});function Ri(s){const{isOpen:_,onClose:n,onOpenParam:l}=s,{t:o}=le(),e=_e(),[r,t]=K.useState(wt),[i,c]=K.useState(ji);K.useEffect(()=>{ki().then(h=>{t([...wt,...h]);for(const m of h)Ai(m.id).then(d=>{c(v=>({...v,[m.id]:d}))})})},[]);const y=async(h,m,d)=>{e(ss());const v=r.find(g=>g.id===h),p=v?St(v.name):h,b=wt.some(g=>g.id===h);try{const g=b?(await Pi[`/node_modules/@railmapgen/rmg-templates-resources/templates/${h}/${m}.json`]()).default:await Oi(h,m);l(g,[p,d].join(" "))}catch(g){console.error("Failed to fetch template",g)}he.event(ye.OPEN_TEMPLATE,{company:h,filename:m}),e(fn())};return f.jsxs(Ne,{isOpen:_,onClose:n,children:[f.jsx(He,{}),f.jsxs(We,{children:[f.jsx(Ue,{children:o("TemplateModal.title")}),f.jsx(Ze,{}),f.jsx(Ge,{children:f.jsxs(Tt,{isLazy:!0,size:"sm",orientation:"vertical",colorScheme:"primary",children:[f.jsx(Ct,{maxW:150,children:r.map(h=>f.jsx($e,{children:St(h.name)},h.id))}),f.jsx(It,{maxW:250,children:Object.entries(i).sort((h,m)=>r.findIndex(d=>d.id===h[0])-r.findIndex(d=>d.id===m[0])).map(([h,m])=>f.jsx(ht,{as:Pe,flexDirection:"column",py:0,px:1,children:m.map(d=>{var p;const v=St(d.name);return f.jsx(lr,{variant:"ghost",size:"sm",primaryText:v,secondaryText:o("by")+": "+((p=d.uploadBy)!=null?p:"Unknown"),onClick:()=>y(h,d.filename,v)},d.filename)})},h))})]})})]})]})}const Ti={flexWrap:"wrap",flex:"1 1 0%",minW:120,"& button":{w:"100%",m:1}};function Ci(s){const{selectedParam:_,disableNew:n,onError:l}=s,{t:o}=le(),[,e]=vt(),[r,t]=K.useState(!1),i=K.useRef(null),c=K.useRef(null);K.useEffect(()=>{var v;_&&((v=c.current)==null||v.focus())},[_]);const y=()=>{const v=mi(Q.MTR,he.getLanguage()),p=xt(JSON.stringify(v));e({project:p}),he.event(ye.NEW_PARAM,{})},h=(v,p)=>{const b=xt(JSON.stringify(v),p);e({project:b})},m=async v=>{var b;const p=(b=v.target.files)==null?void 0:b[0];console.log("handleImportProject():: received file",p);try{if(!p)l(o("OpenActions.unknownError"));else if(p.type!=="application/json")l(o("OpenActions.invalidType"));else{const g=await ls(p),x=xt(g);e({project:x}),he.event(ye.UPLOAD_PARAM,{})}}catch(g){l(o("OpenActions.unknownError")),console.error("handleImportProject():: Unknown error occurred while parsing the uploaded file",g)}v.target.value=""},d=()=>{_&&(e({project:_}),he.event(ye.OPEN_PARAM,{}))};return f.jsxs(Pe,{sx:Ti,children:[f.jsx(de,{leftIcon:f.jsx(ze,{}),onClick:y,isDisabled:n,children:o("Blank project")}),f.jsx(de,{leftIcon:f.jsx(cr,{}),onClick:()=>t(!0),isDisabled:n,children:o("Open template")}),f.jsx(de,{leftIcon:f.jsx(dr,{}),onClick:()=>{var v;return(v=i.current)==null?void 0:v.click()},isDisabled:n,children:o("Import project")}),f.jsx(de,{ref:c,colorScheme:"primary",leftIcon:f.jsx(ur,{}),onClick:d,isDisabled:_===void 0,children:o("Open selected")}),f.jsx("input",{ref:i,type:"file",accept:".json",hidden:!0,onChange:m,"data-testid":"file-upload"}),f.jsx(Ri,{isOpen:r,onClose:()=>t(!1),onOpenParam:h})]})}const Ii={flexDirection:"column",p:2,h3:{m:2},"& > div":{m:2,flexWrap:"wrap",flexDirection:{base:"column",md:"row"}}};function zi(s){const{downloading:_}=s,{t:n}=le(),[l]=vt(),o=l.get("project"),[e,r]=K.useState([]),[t,i]=K.useState(),c=K.useRef(null),y=un();K.useEffect(()=>{r(Et())},[_]),hr({ref:c,handler:()=>i(void 0)});const h=v=>{const{id:p,name:b,lastModified:g}=v;p&&(window.localStorage.setItem(Fe.PARAM_CONFIG_BY_ID+p,JSON.stringify({name:b,lastModified:g})),i(void 0),r(Et()),he.event(ye.UPDATE_PARAM_CONFIG,{}))},m=v=>{window.localStorage.removeItem(Fe.PARAM_BY_ID+v),window.localStorage.removeItem(Fe.PARAM_CONFIG_BY_ID+v),i(void 0),r(Et()),he.event(ye.REMOVE_PARAM,{})},d=v=>{y({description:v,status:"error",duration:1e4,isClosable:!0})};return f.jsxs(dn,{justifyContent:"center",children:[o&&f.jsx(mt,{isIndeterminate:!0}),f.jsx(pr,{children:f.jsxs(Be,{sx:Ii,children:[f.jsx(Se,{as:"h3",size:"lg",children:n("Saved projects")}),f.jsxs(Pe,{ref:c,children:[f.jsx(cs,{paramRegistry:e,downloading:_,selectedParam:t,onParamSelect:i,onParamRemove:m,onParamUpdate:h}),f.jsx(Ci,{selectedParam:t,disableNew:e.length>=10,onError:d})]})]})})]})}const Li=s=>{var _,n,l,o,e,r,t;"line_name"in s||(s.line_name=["路線名","Name of Line"]),"dest_legacy"in s||(s.dest_legacy=!1),delete s.fontZH,delete s.fontEN,delete s.weightZH,delete s.weightEN;for(const[i,c]of Object.entries(s.stn_list))"branch"in c||(s.stn_list[i].branch={left:[],right:[]},c.children.length===2?s.stn_list[i].branch.right=["through",c.children[1]]:s.stn_list[i].branch.right=[],c.parents.length===2?s.stn_list[i].branch.left=["through",c.parents[1]]:s.stn_list[i].branch.left=[]);"psd_num"in s?s.psd_num=s.psd_num.toString():s.psd_num="1","line_num"in s||(s.line_num="1"),s.theme.length===3&&s.theme.push("#fff");for(const[i,c]of Object.entries(s.stn_list))"num"in c||(s.stn_list[i].num="00"),"interchange"in c&&c.interchange.map(y=>y.forEach(h=>{h.length===5&&h.splice(3,0,"#fff")}));for(const[i,c]of Object.entries(s.stn_list))c.change_type==="osi22_end_p"&&(s.stn_list[i].change_type="osi22_pr"),c.change_type==="osi22_end_u"&&(s.stn_list[i].change_type="osi22_ur");for(const[i,c]of Object.entries(s.stn_list))"interchange"in c||(s.stn_list[i].interchange=[[]]);"info_panel_type"in s?s.info_panel_type=(i=>{switch(i){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return i}})(s.info_panel_type):s.info_panel_type="gz28","direction_gz_x"in s||(s.direction_gz_x=50),"direction_gz_y"in s||(s.direction_gz_y=70);for(const[i,c]of Object.entries(s.stn_list))"transfer"in c||(s.stn_list[i].transfer={tick_direc:c.change_type==="none"||c.change_type==="int2"?"r":(_=c.change_type)==null?void 0:_.split("_")[1].split("").slice().reverse()[0],paid_area:((n=c.change_type)==null?void 0:n.indexOf("osi"))!==-1?((l=c.change_type)==null?void 0:l.split("_")[1][0])==="p":!0,osi_names:((o=c.change_type)==null?void 0:o.indexOf("osi"))!==-1?[c.interchange[1][0]]:[],info:c.interchange.length===2?[c.interchange[0],c.interchange[1].slice(1)]:c.interchange}),delete s.stn_list[i].change_type,delete s.stn_list[i].interchange;for(const[i,c]of Object.entries(s.stn_list))"services"in c||(s.stn_list[i].services=["local"]),"facility"in c||("usage"in c?s.stn_list[i].facility=c.usage:s.stn_list[i].facility=""),delete s.stn_list[i].usage;"customiseMTRDest"in s||(s.customiseMTRDest={isLegacy:s.dest_legacy||!1,terminal:!1}),delete s.dest_legacy,"svgWidth"in s||(s.svgWidth={destination:s.svg_dest_width,runin:s.svg_dest_width,railmap:s.svg_width,indoor:s.svg_width}),"indoor"in s.svgWidth||(s.svgWidth.indoor=s.svgWidth.railmap),delete s.svg_width,delete s.svg_dest_width,"notesGZMTR"in s||(s.notesGZMTR=[]),s.notesGZMTR=(e=s.notesGZMTR)==null?void 0:e.map(i=>i.length===4?i.concat([!1]):i),delete s.char_form,delete s.show_outer,delete s.strip_pc,delete s.txt_bg_gap,"namePosMTR"in s||(s.namePosMTR={isStagger:!0,isFlip:s.txt_flip}),delete s.txt_flip,Object.keys(s.stn_list).forEach(i=>{"secondaryName"in s.stn_list[i]?s.stn_list[i].secondaryName!==!1&&s.stn_list[i].secondaryName.join()===","&&(s.stn_list[i].secondaryName=!1):s.stn_list[i].secondaryName=!1,"type"in s.stn_list[i].transfer&&delete s.stn_list[i].transfer.type}),s.style=s.style===void 0||!Object.values(Q).includes(s.style)?Q.MTR:s.style,s.coline=(r=s.coline)!=null?r:[],s.loop=(t=s.loop)!=null?t:!1,s.loop_info=s.loop_info===void 0?{bank:!0,left_and_right_factor:0,bottom_factor:1}:{...s.loop_info,bottom_factor:Math.max(s.loop_info.bottom_factor,1)};for(const[i,c]of Object.entries(s.stn_list))"loop_pivot"in c||(s.stn_list[i].loop_pivot=!1);return Array.isArray(s.coline)&&(s.coline=s.coline.reduce((i,c)=>({...i,[qe(4)]:c}),{})),s.platform_num===!1&&(s.platform_num=""),Object.values(s.stn_list).forEach(i=>{var y,h;const c=i;c.one_line=(y=c.one_line)!=null?y:!1,c.int_padding=(h=c.int_padding)!=null?h:s.loop?250:355}),s.branchSpacingPct===void 0&&(s.style===Q.SHMetro?s.branchSpacingPct=Math.round(s.branch_spacing/s.svg_height*300):s.branchSpacingPct=Math.round(s.branch_spacing/s.svg_height*200),delete s.branch_spacing),Di(s),s},Di=s=>{for(const[_,n]of Object.entries(s.stn_list)){const l=n.transfer.info;l&&(s.stn_list[_].transfer.groups=l.map((o,e)=>o.length?{name:n.transfer.osi_names[e-1],lines:o.map(r=>{const t=r;return{theme:t.slice(0,4),name:t.slice(4,6)}})}:{lines:[]})),delete s.stn_list[_].transfer.info,delete s.stn_list[_].transfer.osi_names}},Fi=s=>_=>{let n={id:s};const l=window.localStorage.getItem(Fe.PARAM_CONFIG_BY_ID+s);l===null?console.warn(`Config for paramID=${s} does not exist in localStorage`):n={...n,...JSON.parse(l)};try{const o=window.localStorage.getItem(Fe.PARAM_BY_ID+s);if(o===null)return console.warn(`Param ID=${s} does not exist in localStorage`),!1;{const e=Li(JSON.parse(o));return _(_n(n)),_(is(e)),!0}}catch(o){return console.warn("Failed to parse param.",o),!1}};function Bi(){const{t:s}=le(),_=_e(),{paramConfig:n}=ee(m=>m.app),[l,o]=vt(),e=l.get("project"),r=l.get("external"),[t,i]=K.useState(!1),[c,y]=K.useState(),h=un();return K.useEffect(()=>{if(console.log(`searchParam: project=${e}, external=${r}`),e&&r)console.warn("AppRouter:: Both param ID and external URL are provided. External URL will be ignored."),o({project:e});else if(e)h.closeAll(),e===(n==null?void 0:n.id)?(console.log("AppRouter:: Store param ID matches URL param ID. Rendering app view..."),i(!0)):(console.log(`AppRouter:: Loading app view for param (ID=${e})...`),_(Fi(e))?i(!0):(console.log(`AppRouter:: Failed to read param (ID=${e}). Rendering param selector view...`),h({description:s("Project selected is invalid or corrupted."),status:"error",duration:1e4,isClosable:!0}),o({})));else if(r){console.log("AppRouter:: External project URl is provided. Downloading project...");const m=decodeURIComponent(r);y(m),as(m).then(d=>{d?o({project:d}):(console.log(`AppRouter:: Failed to download param from ${m}. Rendering param selector view...`),h({description:s("External URL cannot be opened."),status:"error",duration:1e4,isClosable:!0}),o({})),y(void 0)})}else console.log("AppRouter:: No URL param ID or external URL provided. Rendering param selector view..."),i(!1)},[e,r]),t?f.jsx(xi,{}):f.jsx(zi,{downloading:c})}const Wi=Object.freeze(Object.defineProperty({__proto__:null,default:Bi},Symbol.toStringTag,{value:"Module"}));export{Wi as a,Hi as g,et as i};
