"use strict";(self.webpackChunkrmg=self.webpackChunkrmg||[]).push([[4822],{37656:function(t,n,e){e.d(n,{Z:function(){return u}});var r=e(1413),a=e(29439),s=e(45987),i=e(72791),c=e(80184),o=(0,i.memo)((function(t){var n=t.passed,e=t.large?"M0,12.95 V-12.95 H-12.95 a12.95,12.95 0 0,0 0,25.9 h25.9 a12.95,12.95 0 0,0 0,-25.9 H0":"M0,9.25 V-9.25 H-9.25 a9.25,9.25 0 0,0 0,18.5 h18.5 a9.25,9.25 0 0,0 0,-18.5 H0";return(0,c.jsx)("path",{d:e,fill:"#fff",strokeWidth:2,stroke:n?"#aaa":"var(--rmg-theme-colour)"})}),(function(t,n){return t.passed===n.passed&&t.large===n.large})),l=["lineNum","stnNum","passed","large"];function u(t){var n=t.lineNum,e=t.stnNum,u=t.passed,h=t.large,d=(0,s.Z)(t,l),f=(0,i.useRef)(null),g=(0,i.useRef)(null),m=(0,i.useState)({width:0}),x=(0,a.Z)(m,2),p=x[0],v=x[1],y=(0,i.useState)({width:0}),j=(0,a.Z)(y,2),S=j[0],_=j[1];(0,i.useEffect)((function(){v(f.current.getBBox()),_(g.current.getBBox())}),[n,e]);var Z=15/Math.max(15,p.width),w=2===n.length&&2===e.length?Z:15/Math.max(15,S.width);return(0,c.jsxs)("g",(0,r.Z)((0,r.Z)({},d),{},{children:[(0,c.jsx)(o,{passed:u,large:h}),(0,c.jsxs)("g",{textAnchor:"middle",fontSize:13.5,transform:h?"scale(1.4)":"",fill:u?"#aaa":"#000",children:[(0,c.jsx)("g",{transform:"translate(-9.25,0)scale(".concat(Z,")"),children:(0,c.jsx)("text",{ref:f,className:"rmg-name__zh",children:n})}),(0,c.jsx)("g",{transform:"translate(9.25,0)scale(".concat(w,")"),children:(0,c.jsx)("text",{ref:g,className:"rmg-name__zh",children:e})})]})]}))}},23824:function(t,n,e){e.d(n,{Az:function(){return h},QE:function(){return d},ML:function(){return f},h6:function(){return g},LD:function(){return m},pS:function(){return x}});var r=e(29439),a=e(15671),s=e(43144),i=e(93433),c=e(37762),o=e(4942),l=e(1413),u=e(20713),h=function(t,n,e){return Object.keys(t).reduce((function(r,a){return(0,l.Z)((0,l.Z)({},r),{},(0,o.Z)({},a,t[a].children.reduce((function(r,s){return(0,l.Z)((0,l.Z)({},r),{},(0,o.Z)({},s,1+n(t,s)+e(t,a)))}),{})))}),{})},d=function t(n,e,r){if(n===e)return{len:0,nodes:[n]};var a=[],s=[];Object.keys(r[n]).forEach((function(i){var c=t(i,e,r);c.len<0||(a.push(r[n][i]+c.len),c.nodes.unshift(n),s.push(c.nodes))}));var i=Math.max.apply(Math,a);return{len:i,nodes:s[a.indexOf(i)]}},f=function(t,n,e){var r=d("linestart","lineend",n);if(r.nodes.includes(t))return d(r.nodes[1],t,n).len;for(var a=e.filter((function(n){return n.includes(t)}))[0],s=t;!r.nodes.includes(s);)s=a[a.indexOf(s)-1];for(var i=t;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var c="linestart"===s,o=[];return c||"lineend"===i?c?(o[0]=0,o[1]=d(r.nodes[1],i,n).len,o[2]=d(a[1],t,n).len,o[3]=d(t,i,n).len):(o[0]=d(r.nodes[1],s,n).len,o[1]=d(s,r.nodes.slice(-2)[0],n).len,o[2]=d(s,t,n).len,o[3]=d(t,a.slice(-2)[0],n).len):(o[0]=d(r.nodes[1],s,n).len,o[1]=d(s,i,n).len,o[2]=d(s,t,n).len,o[3]=d(t,i,n).len),o[0]+o[2]*o[1]/(o[2]+o[3])},g=function(t,n,e){var r;return console.log("computing stations' states"),(0,i.Z)(new Set((r=[]).concat.apply(r,(0,i.Z)(n)))).reduce((function(r,a){return(0,l.Z)((0,l.Z)({},r),{},(0,o.Z)({},a,a===t?0:(e===u.wA.right?function(t,n,e){var r,a=(0,c.Z)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=s.indexOf(t),o=s.indexOf(n);if(-1!==i&&i<o)return!0}}catch(l){a.e(l)}finally{a.f()}return!1}(t,a,n):function(t,n,e){var r,a=(0,c.Z)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=s.indexOf(t),o=s.indexOf(n);if(-1!==o&&o<i)return!0}}catch(l){a.e(l)}finally{a.f()}return!1}(t,a,n))?1:-1))}),{})},m=function(){function t(n){var e=this;(0,a.Z)(this,t),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(t){return 0},this.rightWideFactor=function(t){return 0},this.pathTurnParams=function(t){var n=35-17.5*Math.sqrt(3),e=t-2*n;return{tr:35,dx_a:17.5,dy_a:n,dx_l:e*Math.sqrt(3),dy_l:e}},this.pathTurnSE=function(t){var n=e.pathTurnParams(t),r=n.tr,a=n.dx_a,s=n.dy_a,i=n.dx_l,c=n.dy_l;return"a ".concat(r,",").concat(r," 0 0,1 ").concat(a,",").concat(s," l ").concat(i,",").concat(c," a ").concat(r,",").concat(r," 0 0,0 ").concat(a,",").concat(s)},this.pathTurnNE=function(t){var n=e.pathTurnParams(t),r=n.tr,a=n.dx_a,s=n.dy_a,i=n.dx_l,c=n.dy_l;return"a ".concat(r,",").concat(r," 0 0,0 ").concat(a,",").concat(-s," l ").concat(i,",").concat(-c," a ").concat(r,",").concat(r," 0 0,1 ").concat(a,",").concat(-s)},this.stnList=n.stnList,this.criticalPath=n.criticalPath}return(0,s.Z)(t,[{key:"getYShare",value:function(t,n){if(t in this.yShares)return this.yShares[t];if(["linestart","lineend"].includes(t)||this.stnList[t].parents.length>1||this.stnList[t].children.length>1)return this.yShares[t]=0,0;var e=this.stnList[t].parents[0];if(e){if(1===this.stnList[e].children.length){var r=this.getYShare(e);return this.yShares[t]=r,r}var a=0===this.stnList[e].children.indexOf(t)?1:-1;return this.yShares[t]=a,a}return this.yShares[t]=0,0}},{key:"_linePath",value:function(t,n,e,a,s,i,c,o){var l=this,u=(0,r.Z)([],3),h=u[0],d=u[1],f=u[2],g=[],m=this.pathTurnParams(i),x=m.dx_a+m.dx_l/2,p=(n[1]-n[0])/c.len*2,v=((n[1]-n[0])/c.len-2*x)/2;return v+p<0&&console.warn("SVG width too small! ".concat(v+p)),t.forEach((function(n){var r=a[n],c=s[n];if(!d&&0!==d)return h=n,f=r,d=c,void(1===t.length?g.push("M ".concat(r,",").concat(c)):e[0].includes(n)?e[0].includes(t[1])?g.push("M ".concat(r,",").concat(c)):(a[t[1]]>0&&g.push("M ".concat(r,",").concat(c+o)),s[t[1]]<0&&g.push("M ".concat(r,",").concat(c-o))):g.push("M ".concat(r,",").concat(c)));c>d?(g.push("h ".concat(0===c?r-f-p*l.leftWideFactor(n)-v-2*x:p*l.rightWideFactor(h)+v)),g.push(l.pathTurnSE(i))):c<d&&(g.push("h ".concat(0===c?r-f-p*l.leftWideFactor(n)-v-2*x:p*l.rightWideFactor(h)+v)),g.push(l.pathTurnNE(i))),g.push("H ".concat(r)),h=n,f=r,d=c})),g.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(t,n){console.log("computing y shares");var e=new this({stnList:t});return Object.keys(t).forEach((function(t){["linestart","lineend"].includes(t)||t in e.yShares||e.getYShare(t,n)})),e.yShares}}]),t}(),x=function(t,n){var e=(t=t.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return n[t]>=0})),r=t.filter((function(t){return n[t]<=0}));return 1===e.length&&(r=t),0===e.filter((function(t){return-1!==r.indexOf(t)})).length&&e.length&&(r[0]===t[0]?r.push(e[0]):e[0]===t[0]&&e[e.length-1]===t[t.length-1]&&r.length?(r=t,e=[]):r.unshift(e[e.length-1])),{main:e,pass:r}}},15951:function(t,n,e){e.r(n),e.d(n,{default:function(){return I}});var r=e(29439),a=e(45987),s=e(1413),i=e(4942),c=e(93433),o=e(72791),l=e(26541),u=e(37656),h=e(20713),d=e(37732),f=e(80184),g=(0,o.memo)((function(t){var n=t.lineName,e=t.commonPart,a=(0,o.useRef)(null),s=(0,o.useState)({x:0,height:0,width:0}),i=(0,r.Z)(s,2),c=i[0],l=i[1];(0,o.useEffect)((function(){a.current&&l(a.current.getBBox())}),[n.toString()]);var u=x/Math.max(x,c.width),h=(-c.x-c.width/2)*u,d=c.height*(1-u)*1.2/2;return(0,f.jsx)("g",{ref:a,transform:"translate(".concat(h,",").concat(d,")scale(").concat(u,")"),children:(0,f.jsxs)("text",{className:"rmg-name__zh",fontSize:14,y:12,textAnchor:"end",children:[e,(0,f.jsx)("tspan",{className:"rmg-name__zh",fontSize:8,x:0,dy:-2,textAnchor:"start",children:n[0].slice(e.length).trim()}),(0,f.jsx)("tspan",{className:"rmg-name__en",fontSize:4,x:0,dy:6,textAnchor:"start",children:n[1].slice(e.length).trim()})]})})}),(function(t,n){return t.lineName.toString()===n.lineName.toString()}));function m(t){return(0,f.jsx)("rect",(0,s.Z)({x:-22.5,height:24,width:45,rx:4.5},t))}var x=42,p=(0,o.memo)((function(t){var n=t.lineName,e=t.foregroundColour,a=t.backgroundColour,s=t.passed,i=v(n),c=(0,r.Z)(i,2),l=c[0],u=c[1],d=(0,o.useRef)(null),p=(0,o.useRef)(null),j=(0,o.useState)({width:0}),S=(0,r.Z)(j,2),_=S[0],Z=S[1],w=(0,o.useState)({width:0}),z=(0,r.Z)(w,2),N=z[0],k=z[1];(0,o.useEffect)((function(){d.current&&Z(d.current.getBBox()),p.current&&k(p.current.getBBox())}),[n.toString()]);var E=x/Math.max(x,_.width),M=x/Math.max(x,N.width);return(0,f.jsxs)("g",{textAnchor:"middle",fill:s?h.AJ.white:e,children:[(0,f.jsx)(m,{fill:s?"#aaa":a}),2===l?(0,f.jsx)(g,{lineName:n,commonPart:u}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("text",{ref:d,y:y(l,"zh",E),className:"rmg-name__zh",fontSize:12,transform:"scale(".concat(E,")"),children:1===l?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("tspan",{fontSize:16,dy:.7,className:"rmg-name__zh",children:u}),(0,f.jsx)("tspan",{dy:-.7,className:"rmg-name__zh",children:n[0].slice(u.length)})]}):n[0]}),(0,f.jsx)("text",{ref:p,y:y(l,"en",M),className:"rmg-name__en",fontSize:8,transform:"scale(".concat(M,")"),children:n[1]})]})]})}),(function(t,n){return t.lineName.toString()===n.lineName.toString()&&t.foregroundColour===n.foregroundColour&&t.backgroundColour===n.backgroundColour&&t.passed===n.passed})),v=function(t){var n=t[0].match(/^(\d+)\D+$/);if(n)return[1,n[1]];var e=t.map((function(t){return t.match(/^([\w\d]+).+$/)}));return e[0]&&e[1]&&e[0][1]===e[1][1]?[2,e[0][1]]:[3,""]},y=function(t,n,e){switch(t){case 1:return("zh"===n?7.3:19.5)*(2-e);case 2:return 0;case 3:return"zh"===n?8*(2-e):19.5+47.53125*(1-e)-(1===e?0:5.5)}},j=(0,o.memo)((function(t){var n=t.stnName,e=t.onUpdate,r=(0,o.useRef)(null);return(0,o.useEffect)((function(){e&&e(r.current.getBBox())}),[n.toString()]),(0,f.jsxs)("g",{ref:r,children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:18,children:n[0]}),(0,f.jsx)("g",{fontSize:10.5,children:n[1].split("\\").map((function(t,n){return(0,f.jsx)("text",{className:"rmg-name__en",dy:16+11*n,children:t},n)}))})]})}),(function(t,n){return t.stnName.toString()===n.stnName.toString()})),S=["stnName","onUpdate","passed"];function _(t){var n=t.stnName,e=t.onUpdate,i=t.passed,c=(0,a.Z)(t,S),l=(0,o.useRef)(null),u=(0,o.useState)({x:0,width:0}),h=(0,r.Z)(u,2),d=h[0],g=h[1];return(0,o.useEffect)((function(){var t=l.current.getBBox();g(t),e&&e(t)}),[n.toString()]),(0,f.jsxs)("g",(0,s.Z)((0,s.Z)({fill:i?"#aaa":"#000"},c),{},{children:[(0,f.jsxs)("g",{transform:"translate(0,3)",fontSize:18,children:[(0,f.jsx)("text",{textAnchor:"end",x:d.x-3,className:"rmg-name__zh",children:"("}),(0,f.jsx)("text",{textAnchor:"start",x:d.width+d.x+3,className:"rmg-name__zh",children:")"})]}),(0,f.jsxs)("g",{ref:l,textAnchor:"middle",children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:13,children:n[0]}),(0,f.jsx)("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:n[1]})]})]}))}var Z=["passed"];function w(t){var n=t.passed,e=(0,a.Z)(t,Z);return(0,f.jsxs)("g",(0,s.Z)((0,s.Z)({textAnchor:"middle",fill:n?"#aaa":"var(--rmg-theme-colour)"},e),{},{children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:13,children:"\u5feb\u8f66\u505c\u9760\u7ad9"}),(0,f.jsx)("text",{dy:10,className:"rmg-name__en",fontSize:6.5,children:"Express Station"})]}))}function z(t){var n=t.primaryName,e=t.secondaryName,a=t.stationState,s=t.flipped,i=t.express,c=(0,o.useState)({width:0}),l=(0,r.Z)(c,2),u=l[0],d=l[1],g=(0,o.useState)({x:0,width:-20}),m=(0,r.Z)(g,2),x=m[0],p=m[1],v=n[1].split("\\").length,y={g:{x:0,y:s?17.5:-20-14*v*Math.cos(-45)},StationSecondaryName:{x:(u.width+x.width/2+10)*(s?-1:1),y:2+5*(v-1)},ExpressTag:{x:(u.width+x.width+20+35)*(s?-1:1),y:2+5*(v-1)}};return(0,f.jsxs)("g",{textAnchor:s?"end":"start",fill:function(t){switch(t){case h.KR.PASSED:return"#aaa";case h.KR.CURRENT:return"#f00";case h.KR.FUTURE:return"#000"}}(a),transform:"translate(".concat(y.g.x,",").concat(y.g.y,")rotate(-45)"),children:[(0,f.jsx)(j,{stnName:n,onUpdate:d}),e&&(0,f.jsx)(_,{stnName:e,onUpdate:p,passed:a===h.KR.PASSED,transform:"translate(".concat(y.StationSecondaryName.x,",").concat(y.StationSecondaryName.y,")")}),i&&(0,f.jsx)(w,{passed:a===h.KR.PASSED,transform:"translate(".concat(y.ExpressTag.x,",").concat(y.ExpressTag.y,")")})]})}var N=["intInfos","stnState","tickRotation"],k=["intInfos","tickRotation","stnState"],E=function(t){var n=t.stnId,e=t.stnState,r=t.stnY,a=(0,d.Qy)((function(t){return t.param.theme})),s=(0,d.Qy)((function(t){return t.param.line_name})),i=(0,d.Qy)((function(t){return t.param.line_num})),o=(0,d.Qy)((function(t){return t.param.stn_list[n]})),l=2===o.parents.length||2===o.children.length,g=r>0||1===o.parents.indexOf(o.branch.left[1]||"")||1===o.children.indexOf(o.branch.right[1]||"")?180:0,m=o.name[1].split("\\").length,x=l?180===g?16+12*(m-1)*Math.cos(-45):-9:180===g?-6:(25+15*(m-1))*Math.cos(-45);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(M,{intInfos:l?[[a[0],a[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)"].concat((0,c.Z)(s))].concat(o.transfer.info[0]):o.transfer.info[0],stnState:e,tickRotation:g}),(0,f.jsx)(u.Z,{lineNum:i,stnNum:o.num,passed:-1===e}),(0,f.jsx)("g",{transform:"translate(".concat(-x,",0)"),children:(0,f.jsx)(z,{primaryName:o.name,secondaryName:o.secondaryName||void 0,stationState:e,flipped:180===g,express:o.services.includes(h.K9.express)})})]})},M=function(t){return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Q,(0,s.Z)({strokeWidth:4},t)),(0,f.jsx)(b,(0,s.Z)({transform:"translate(0,".concat(180===t.tickRotation?-47:23,")")},t))]})},Q=function(t){var n=t.intInfos,e=t.stnState,r=t.tickRotation,i=(0,a.Z)(t,N);return(0,f.jsx)("g",(0,s.Z)((0,s.Z)({},i),{},{children:n.map((function(t,a){return(0,f.jsx)("use",{xlinkHref:"#inttick",stroke:-1===e?"#aaa":t[2],transform:"translate(".concat(-2*(n.length-1)+4*a,",0)rotate(").concat(180===r?180:0,")")},a)}))}))},b=function(t){var n=t.intInfos,e=t.tickRotation,r=t.stnState,i=(0,a.Z)(t,k);return(0,f.jsx)("g",(0,s.Z)((0,s.Z)({},i),{},{children:n.map((function(t,n){return(0,f.jsx)("g",{transform:"translate(0,".concat(28*n*(180===e?-1:1),")"),children:(0,f.jsx)(p,{lineName:[t[4],t[5]],foregroundColour:t[3],backgroundColour:t[2],passed:-1===r})},n)}))}))},A=e(23824),R=function(t,n){return 2===t[n].parents.length||2===t[n].children.length?.25:0},H=function(){var t,n=(0,d.Qy)((function(t){return t.helper})),e=n.branches,r=n.routes,a=n.depsStr,c=(0,d.Qy)((function(t){return t.param})),l=c.svgWidth,u=c.svg_height,g=c.y_pc,m=c.padding,x=c.branchSpacingPct,v=c.direction,y=c.line_name,j=c.current_stn_idx,S=c.stn_list,_=(0,A.Az)(S,R,R),Z=(0,o.useMemo)((function(){return console.log("computing x shares"),Object.keys(S).reduce((function(t,n){return(0,s.Z)((0,s.Z)({},t),{},(0,i.Z)({},n,function(t,n,e){var r=(0,A.QE)("linestart","lineend",n);if(r.nodes.includes(t))return(0,A.QE)(r.nodes[1],t,n).len;for(var a=e.filter((function(n){return n.includes(t)}))[0],s=t;!r.nodes.includes(s);)s=a[a.indexOf(s)-1];for(var i=t;!r.nodes.includes(i);)i=a[a.indexOf(i)+1];var c="linestart"===s,o="lineend"===i;if(a.toString()===e[0].toString()){var l=[];return c||o?c?(l[0]=0,l[1]=(0,A.QE)(r.nodes[1],i,n).len,l[2]=(0,A.QE)(a[1],t,n).len,l[3]=(0,A.QE)(t,i,n).len):(l[0]=(0,A.QE)(r.nodes[1],s,n).len,l[1]=(0,A.QE)(s,r.nodes.slice(-2)[0],n).len,l[2]=(0,A.QE)(s,t,n).len,l[3]=(0,A.QE)(t,a.slice(-2)[0],n).len):(l[0]=(0,A.QE)(r.nodes[1],s,n).len,l[1]=(0,A.QE)(s,i,n).len,l[2]=(0,A.QE)(s,t,n).len,l[3]=(0,A.QE)(t,i,n).len),l[0]+l[2]*l[1]/(l[2]+l[3])}if(c||o)return c?(0,A.QE)(r.nodes[1],i,n).len-(0,A.QE)(t,i,n).len:(0,A.QE)(r.nodes[1],s,n).len+(0,A.QE)(s,t,n).len;var u=[];return u[0]=(0,A.QE)(r.nodes[1],s,n).len,u[1]=(0,A.QE)(s,i,n).len,u[2]=(0,A.QE)(s,t,n).len,u[3]=(0,A.QE)(t,i,n).len,u[0]+u[2]*u[1]/(u[2]+u[3])}(n,_,e)))}),{})}),[e.toString(),JSON.stringify(_)]),w=(0,A.QE)("linestart","lineend",_),z=(0,A.QE)(w.nodes[1],w.nodes.slice(-2)[0],_),N=v===h.wA.right?[l[h.Ht.RailMap]*m/100+65,l[h.Ht.RailMap]*(1-m/100)-20]:[l[h.Ht.RailMap]*m/100,l[h.Ht.RailMap]*(1-m/100)-65],k=Object.keys(Z).reduce((function(t,n){return(0,s.Z)((0,s.Z)({},t),{},(0,i.Z)({},n,N[0]+Z[n]/z.len*(N[1]-N[0])))}),{}),E=(0,o.useMemo)((function(){return console.log("computing y shares"),Object.keys(S).reduce((function(t,n){if(e[0].includes(n))return(0,s.Z)((0,s.Z)({},t),{},(0,i.Z)({},n,0));var r=e.slice(1).filter((function(t){return t.includes(n)}))[0];return(0,s.Z)((0,s.Z)({},t),{},(0,i.Z)({},n,S[r[0]].children.indexOf(r[1])?-2:2))}),{})}),[a]),M=Object.keys(E).reduce((function(t,n){return(0,s.Z)((0,s.Z)({},t),{},(0,i.Z)({},n,-E[n]*x*u/200))}),{}),Q=(0,o.useMemo)((function(){return(0,A.h6)(j,r,v)}),[j,v,r.toString()]),b=e.map((function(t){return(0,A.pS)(t,Q)})).reduce((function(t,n){return t.main.push(n.main),t.pass.push(n.pass),t}),{main:[],pass:[]}),H=Object.keys(b).reduce((function(t,n){return(0,s.Z)((0,s.Z)({},t),{},(0,i.Z)({},n,b[n].map((function(t){return P(t,k,M)}))))}),{});return(0,f.jsxs)("g",{id:"main",style:(t={},(0,i.Z)(t,"--y-percentage",g),(0,i.Z)(t,"transform","translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))"),t),children:[(0,f.jsx)(O,{paths:H}),(0,f.jsx)(L,{xs:k,ys:M,stnStates:Q}),(0,f.jsx)("g",{id:"line_name",style:(0,i.Z)({},"--translate-x",v===h.wA.right?"".concat(N[0]-65,"px"):"".concat(N[1]+65,"px")),children:(0,f.jsx)(p,{lineName:y,foregroundColour:"var(--rmg-theme-fg)",backgroundColour:"var(--rmg-theme-colour)"})})]})},O=o.memo((function(t){return(0,f.jsxs)("g",{fill:"none",strokeWidth:4,children:[(0,f.jsx)("g",{stroke:"#aaa",strokeDasharray:4,children:t.paths.pass.map((function(t,n){return(0,f.jsx)("path",{d:t},n)}))}),(0,f.jsx)("g",{stroke:"var(--rmg-theme-colour)",children:t.paths.main.map((function(t,n){return(0,f.jsx)("path",{d:t},n)}))})]})}),(function(t,n){return JSON.stringify(t.paths)===JSON.stringify(n.paths)})),P=function(t,n,e){var r,a=[];return t.forEach((function(t){var s=n[t],i=e[t];if(!r&&0!==r)return r=i,void a.push("M ".concat(s,",").concat(i));0===i?(i<r&&a.push("H ".concat(s-40),"a 40,40 0 0,0 40,-40","V ".concat(i)),i>r&&a.push("H ".concat(s-40),"a 40,40 0 0,1 40,40","V ".concat(i))):(i<r&&a.push("V ".concat(i+40),"a 40,40 0 0,1 40,-40","H ".concat(s)),i>r&&a.push("V ".concat(i-40),"a 40,40 0 0,0 40,40","H ".concat(s))),a.push("H ".concat(s)),r=i})),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},L=function(t){var n=t.xs,e=t.ys,r=t.stnStates,a=(0,d.Qy)((function(t){return t.param.stn_list}));return(0,f.jsx)("g",{id:"stn_icons",children:Object.keys(a).filter((function(t){return!["linestart","lineend"].includes(t)})).map((function(t){return(0,f.jsx)("g",{style:{transform:"translate(".concat(n[t],"px,").concat(e[t],"px)")},children:(0,f.jsx)(E,{stnId:t,stnState:r[t],stnY:e[t]})},t)}))})},B=e(62554),T=["destIds"],W=["destIds"],F=h.Ht.RailMap,I=function(){var t=(0,d.Qy)((function(t){return t.app})).canvasScale,n=(0,d.Qy)((function(t){return t.param})),e=n.svgWidth,r=n.svg_height,a=n.direction,s=n.psd_num,i=n.info_panel_type,c=n.notesGZMTR,o=n.current_stn_idx,u=n.stn_list,g=n.theme,m=e[F],x=u[o];return(0,f.jsxs)(B.Z,{type:F,svgWidth:m,svgHeight:r,canvasScale:t,theme:g,children:[(0,f.jsx)(C,{}),(0,f.jsx)(l.Z,{variant:i,isShowLight:i===h.p.gz2otis,isShowPSD:i===h.p.gz2otis&&s}),a===h.wA.left&&x.parents.includes("linestart")||a===h.wA.right&&x.children.includes("lineend")?(0,f.jsx)(Y,{}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(H,{}),(0,f.jsx)(D,{}),c.map((function(t,n){return(0,f.jsx)(K,{note:t},n)}))]}),i===h.p.gz2otis&&(0,f.jsx)("line",{x2:m,transform:"translate(0,90)",strokeWidth:3,stroke:"black"})]})},C=(0,o.memo)((function(){return(0,f.jsxs)("defs",{children:[(0,f.jsx)("path",{id:"arrow_direction",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black"}),(0,f.jsx)("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"})]})})),D=function(){var t,n=(0,d.Qy)((function(t){return t.helper})).routes,e=(0,d.Qy)((function(t){return t.param})),r=e.direction,a=e.direction_gz_x,l=e.direction_gz_y,u=e.current_stn_idx,g=(0,o.useMemo)((function(){return(0,c.Z)(new Set(n.reduce((function(t,n){return n.includes(u)?t.concat(n.filter((function(t){return!["linestart","lineend"].includes(t)})).slice(r===h.wA.left?0:-1)[0]):t}),[]).filter((function(t){return t!==u}))))}),[u,r,n.toString()]),m={textAnchor:r===h.wA.left?"start":"end",transform:"translate(".concat(r===h.wA.left?65:-65,",-5)"),destIds:g};return(0,f.jsxs)("g",{id:"direction_gz",style:(t={},(0,i.Z)(t,"--x-percentage",a),(0,i.Z)(t,"--y-percentage",l),t),children:[(0,f.jsx)("use",{xlinkHref:"#arrow_direction",style:(0,i.Z)({},"--rotate",r===h.wA.left?"0deg":"180deg")}),2!==g.length?(0,f.jsx)(U,(0,s.Z)({},m)):(0,f.jsx)(V,(0,s.Z)({},m))]})},U=function(t){var n=t.destIds,e=(0,a.Z)(t,T),r=(0,d.Qy)((function(t){return t.param.stn_list}));return(0,f.jsxs)("g",(0,s.Z)((0,s.Z)({},e),{},{children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:28,children:n.map((function(t){return r[t].name[0]})).join("/")+"\u65b9\u5411"}),(0,f.jsx)("text",{className:"rmg-name__en",fontSize:14,dy:22,children:"Towards "+n.map((function(t){return r[t].name[1].replace("\\"," ")})).join("/")})]}))},V=function(t){var n=t.destIds,e=(0,a.Z)(t,W),r=(0,d.Qy)((function(t){return t.param.direction})),i=(0,d.Qy)((function(t){return t.param.stn_list})),l=n.map((function(t){return i[t].name[0].length})),u=Math.min.apply(Math,(0,c.Z)(l)),g=u>1&&l[0]!==l[1]?Math.abs(l[0]-l[1])/(u-1):0;return(0,f.jsxs)("g",(0,s.Z)((0,s.Z)({},e),{},{children:[n.map((function(t,n){return(0,f.jsxs)(o.Fragment,{children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:25,x:r===h.wA.left?0:-75,y:42*n-21,letterSpacing:l[n]>l[1-n]?"0em":"".concat(g,"em"),children:i[t].name[0]}),(0,f.jsx)("text",{className:"rmg-name__en",fontSize:11.5,x:r===h.wA.left?0:-75,y:42*n-1,children:"Towards "+i[t].name[1].replace("\\"," ")})]},t)})),(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:28,x:r===h.wA.left?25*(Math.max.apply(Math,(0,c.Z)(l))+1):0,y:5,children:"\u65b9\u5411"})]}))},Y=o.memo((function(){return(0,f.jsxs)("g",{id:"terminus_gz",textAnchor:"middle",children:[(0,f.jsx)("text",{className:"rmg-name__zh",fontSize:90,children:"\u7ec8 \u70b9 \u7ad9"}),(0,f.jsx)("text",{dy:70,className:"rmg-name__en",fontSize:36,children:"Terminal"}),(0,f.jsxs)("g",{strokeWidth:8,stroke:"#000",children:[(0,f.jsx)("path",{d:"M -160,68 h -160"}),(0,f.jsx)("path",{d:"M 160,68 h 160"})]})]})})),K=o.memo((function(t){var n,e=o.useRef(null),a=o.useState({width:0,height:0,y:0}),s=(0,r.Z)(a,2),c=s[0],l=s[1];return o.useEffect((function(){return l(e.current.getBBox())}),[t.note[0],t.note[1]]),(0,f.jsxs)("g",{className:"note-box",style:(n={},(0,i.Z)(n,"--x-percentage",t.note[2]),(0,i.Z)(n,"--y-percentage",t.note[3]),n),children:[t.note[4]&&(0,f.jsx)("rect",{height:c.height+4,width:c.width+4,x:-2,y:c.y-2,fill:"none",stroke:"black",strokeWidth:.5}),(0,f.jsxs)("g",{ref:e,children:[(0,f.jsx)("g",{fontSize:16,letterSpacing:1.2,children:t.note[0].split("\n").map((function(t,n){return(0,f.jsx)("text",{className:"rmg-name__zh",y:18*n,children:t},n)}))}),(0,f.jsx)("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,".concat(18*t.note[0].split("\n").length,")"),children:t.note[1].split("\n").map((function(n,e){var r;return(0,f.jsx)("text",{className:"rmg-name__en",y:11*e,textLength:e<((null===(r=t.note[1].match(/\n/g))||void 0===r?void 0:r.length)||0)?c.width:navigator.userAgent.includes("Firefox")?-1:0,lengthAdjust:"spacing",children:n},e)}))})]})]})}),(function(t,n){return t.note.toString()===n.note.toString()}))},26541:function(t,n,e){e.d(n,{Z:function(){return h}});var r=e(1413),a=e(4942),s=e(72791),i=e(45987),c=e(20713),o=e(80184),l=["num","inStrip"];function u(t){var n=t.num,e=t.inStrip,a=(0,i.Z)(t,l);return(0,o.jsxs)("g",(0,r.Z)((0,r.Z)({textAnchor:"middle",fill:e?c.AJ.black:"var(--rmg-theme-fg)"},a),{},{children:[(0,o.jsx)("rect",{height:40,width:40,rx:4,x:-20,fill:e?"#fff":"var(--rmg-theme-colour)"}),(0,o.jsx)("text",{className:"rmg-name__en",fontSize:20,dy:12,children:n}),(0,o.jsx)("text",{className:"rmg-name__zh",fontSize:12,dy:26,children:"\u5c4f\u853d\u95e8"}),(0,o.jsx)("text",{className:"rmg-name__en",fontSize:6.5,dy:36,children:"Screen Door"})]}))}var h=function(t){var n=function(t){switch(t){case"gz28":case"gz2otis":case"gz6":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz4":case"gz5":case"gz1421":return 20;default:return 0}}(t.variant),e=s.useMemo((function(){switch(t.variant){case"gz1":return(0,o.jsx)("circle",{cy:-58,r:16,fill:"red"});case"gz28":case"gz2otis":return(0,o.jsx)("ellipse",{cy:-30,rx:24,ry:12,fill:"orange"});case"gz3":return(0,o.jsx)("rect",{x:-15,y:-55,height:30,width:30,fill:"red"});case"gz6":return(0,o.jsx)("ellipse",{cy:-30,rx:24,ry:12,fill:"white"});case"gz1421":return(0,o.jsx)("ellipse",{cy:-38,rx:24,ry:12,fill:"orange"});case"gz5":return(0,o.jsx)("rect",{x:-30,y:-70,height:30,width:60,fill:"orange"});case"gz4":return(0,o.jsx)("rect",{x:-50,y:-50,height:25,width:100,fill:"whitesmoke"});case"gzgf":return(0,o.jsx)("rect",{x:-30,y:-58,height:30,width:60,fill:"orange"});default:return(0,o.jsx)(o.Fragment,{})}}),[t.variant]);return(0,o.jsxs)("g",{transform:"translate(0,".concat("gz4"===t.variant?-20:0,")"),children:[(0,o.jsx)("rect",{id:"strip_gz",style:(0,a.Z)({},"--height","".concat(n,"px"))}),(0,o.jsx)("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))"},children:t.isShowLight&&e}),!1!==t.isShowPSD&&(0,o.jsx)(d,(0,r.Z)({},t))]})},d=s.memo((function(t){var n,e=["gz28","gz2otis","gz6","gzgf"].includes(t.variant),r=function(t){switch(t){case"gz1":case"gz3":return"82px";case"gz4":return"65px";case"gz5":return"80px";case"gz1421":return"62px";default:return"58px"}}(t.variant);return(0,o.jsx)(u,{num:t.isShowPSD,inStrip:e,style:(n={},(0,a.Z)(n,"--psd-dy",r),(0,a.Z)(n,"transform","translate(var(--translate-x), var(--translate-y))"),(0,a.Z)(n,"--translate-x","calc(var(--rmg-svg-width) / 2 + 80px)"),(0,a.Z)(n,"--translate-y","calc(var(--rmg-svg-height) - var(--psd-dy, 58px))"),n)})}),(function(t,n){return t.variant===n.variant&&t.isShowPSD===n.isShowPSD}))},62554:function(t,n,e){e.d(n,{Z:function(){return s}});var r=e(4942),a=(e(72791),e(80184));function s(t){var n,e=t.type,s=t.svgWidth,i=t.svgHeight,c=t.canvasScale,o=t.theme,l=t.children;return(0,a.jsxs)("svg",{id:e,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",height:i*c,viewBox:"0 0 ".concat(s," ").concat(i),colorInterpolationFilters:"sRGB",style:(n={},(0,r.Z)(n,"--rmg-svg-width",s+"px"),(0,r.Z)(n,"--rmg-svg-height",i+"px"),(0,r.Z)(n,"--rmg-theme-colour",o[2]),(0,r.Z)(n,"--rmg-theme-fg",o[3]),n),children:[(0,a.jsx)("rect",{id:"canvas-bg",fill:"white",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}}),l,(0,a.jsx)("rect",{id:"canvas-border",fill:"none",strokeWidth:3,stroke:"none",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}})]})}},37762:function(t,n,e){e.d(n,{Z:function(){return a}});var r=e(40181);function a(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=(0,r.Z)(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var a=0,s=function(){};return{s:s,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,o=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){o=!0,i=t},f:function(){try{c||null==e.return||e.return()}finally{if(o)throw i}}}}}}]);
//# sourceMappingURL=railmapGZMTR.ff5c3e35.chunk.js.map