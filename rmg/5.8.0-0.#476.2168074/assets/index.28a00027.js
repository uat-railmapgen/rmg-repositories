import{z as j,l as e,j as v,b1 as H,ab as F}from"./vendor.75c64018.js";import{aq as L,u as b,F as ne,j as T}from"./index.194ced85.js";import{i as U}from"./app-router.2b8da7d6.js";import{S as Z,e as de,a as me,c as V,g as ue,b as fe}from"./share.66d98256.js";import{a as re}from"./mtr.965bbda5.js";const ve=(s,r,t,n)=>{const i=s.length-n*2-t,l=s.findIndex(d=>d===r),a=[...s,...s,...s],c=s.length+l-Math.floor(i/2)+(i%2===0?1:0),o=s.length+l+Math.floor(i/2);return{top:a.slice(c,o+1),left:a.slice(c-n,c),right:a.slice(o+1,o+1+n),bottom:a.slice(o+1+n,o+1+n+t)}},ge=(s,r,t,n)=>{const i=s.length-n*2-t,l=[...s,...s,...s],a=s.length+s.findIndex(d=>d===r),c=l[a+i-1],o=s.length+s.findIndex(d=>d===c)+(a+i>s.length*2?s.length:0);return{top:l.slice(a,o+1),left:l.slice(a-n,a),right:l.slice(o+1,o+1+n),bottom:l.slice(o+1+n,o+1+n+t)}},ye=(s,r,t,n)=>{let i=s.findIndex(m=>m===r[0]),l=s.findIndex(m=>m===r[1]);[i,l,r[0],r[1]]=i>l?[l,i,r[1],r[0]]:[i,l,r[0],r[1]];const a=s.slice(i,l+1),c=s.filter(m=>!a.filter(u=>!r.includes(u)).includes(m)),o=s.length-(n==="major"?Math.max:Math.min)(a.length,c.length)-t*2,d=n==="major"?a.length>c.length?r[0]:r[1]:a.length>c.length?r[1]:r[0];return ge(s,d,o,t)},Se=(s,r)=>{const t=Object.fromEntries(s.map(d=>[d,-1])),n=Object.fromEntries(s.map(d=>[d,-1])),[i,l,a,c]=[0,1,0,1],o=0;return r.top.forEach((d,m)=>{t[d]=o/2+(1-o)/(r.top.length+1)*(m+1),n[d]=i}),r.right.forEach((d,m)=>{t[d]=c,n[d]=o/2+(1-o)/(r.right.length+1)*(m+1)}),r.bottom.forEach((d,m)=>{t[d]=1-o/2-(1-o)/(r.bottom.length+1)*(m+1),n[d]=l}),r.left.forEach((d,m)=>{t[d]=a,n[d]=1-o/2-(1-o)/(r.left.length+1)*(m+1)}),{x_shares:t,y_shares:n}},ke=(s,r,t,n)=>{const i=s[0].filter(o=>!["linestart","lineend"].includes(o)),l=[...i,...i,...i],a=r==="r"?l:l.reverse(),c=a.findIndex(o=>n===o)+i.length;return a.slice(c+1).filter(o=>t[o].loop_pivot).slice(void 0,2)},se=L.Destination;function we(){const{canvasScale:s}=b(l=>l.app),{svgWidth:r,svg_height:t,theme:n}=b(l=>l.param),i=r[se];return v(Z,{type:se,svgWidth:i,svgHeight:t,canvasScale:s,theme:n,children:[e(Me,{}),e(be,{})]})}const Me=j.exports.memo(()=>e("defs",{children:e("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})})})),be=()=>{const{routes:s,branches:r}=b(y=>y.helper),{line_name:t,theme:n,current_stn_idx:i,direction:l,stn_list:a,info_panel_type:c,loop:o,coline:d}=b(y=>y.param),m=(y,w,S)=>[...new Set(y.filter(M=>M.includes(S)).map(M=>{const k=M.filter(N=>!["linestart","lineend"].includes(N));return w==="l"?k[0]:k.reverse()[0]}))],u=(y,w)=>w?[[y.map(S=>a[S].name[0]).join("\uFF0C"),y.map(S=>a[S].name[1]).join(", ")].map(S=>S.replace("\\",""))]:y.map(S=>a[S].name.map(M=>M.replace("\\",""))),_=o?ke(r,l,a,i):m(s,l,i),x=(o?m(s,l,i):_).filter(y=>r.slice(1).filter(w=>U(w,a)).some(w=>w.includes(y))),h=_.filter(y=>!x.includes(y)),g=u(h,!o&&c!=="sh2020");console.log(g);const f=u(x,!0),p=250,$=Object.fromEntries(x.map(y=>[y,Object.values(d).filter(w=>w.from===y||w.to===y).at(0)]).filter(([y,w])=>w));return v(F,{children:[e(le,{dest_names:g,line_name:t,line_color:[n[2],n[3]],coline:!!x.length,upper:!!x.length}),x.length&&x.map(y=>{var w,S,M;return e("g",{transform:`translate(0,${-p})`,children:e(le,{dest_names:[f.at(0)],line_name:(w=$[y])==null?void 0:w.colors.at(0).slice(4),line_color:[(S=$[y])==null?void 0:S.colors.at(0)[2],(M=$[y])==null?void 0:M.colors.at(0)[3]],coline:!0,upper:!1})},`coline_${y}`)})]})},le=s=>{const{dest_names:r,line_name:t,line_color:n,coline:i,upper:l}=s,{current_stn_idx:a,direction:c,platform_num:o,svgWidth:d,svg_height:m}=b(w=>w.param),u=j.exports.useRef(null),[_,x]=j.exports.useState({width:0});j.exports.useEffect(()=>x(u.current.getBBox()),[JSON.stringify(r),JSON.stringify(a)]);const[h,g,f,p,$]=[d.destination/2,10,36,264,325],y=h-g-f-_.width>=$/2&&h-g-f-p>=$/2?h:c==="l"?(d.destination+_.width-p)/2:(d.destination-_.width+p)/2;return v("g",{transform:`translate(0,${m-300})`,children:[e("path",{stroke:n[0],strokeWidth:12,d:c==="l"?`M${d.destination-24},16 H 36`:`M24,16 H ${d.destination-36}`,transform:`translate(0,${l?-20:220})`,markerEnd:i?void 0:"url(#slope)"}),e(Ne,{ref:u,dest_names:r}),o!==""&&e("g",{transform:`translate(${y},0)`,children:e(He,{})}),t[0].match(/^[\w\d]+(号)?线/)?e(Oe,{line_name:t,line_color:n}):e(Ee,{line_name:t,line_color:n})]})},Ne=j.exports.forwardRef((s,r)=>{const{dest_names:t}=s,{direction:n,svgWidth:i}=b(l=>l.param);return v("g",{ref:r,transform:`translate(${n==="l"?36:i.destination-36},145)`,children:[e("g",{transform:`translate(0,${t.length===2?-20:20})`,children:e("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",fill:"black",transform:`rotate(${n==="l"?0:180})scale(0.8)`})}),e("g",{textAnchor:n==="l"?"start":"end",transform:`translate(${n==="l"?128+20:-128-20},25)`,children:t.map((l,a)=>v(H.Fragment,{children:[e("text",{className:"rmg-name__zh",fontSize:70,dy:a*-100+7,children:"\u5F80"+l[0]},`zh${a}`),e("text",{className:"rmg-name__en",fontSize:25,dy:a*-100+40,children:"To "+l[1]},`en${a}`)]},a))})]})}),He=()=>{const{platform_num:s}=b(r=>r.param);return j.exports.useMemo(()=>v("g",{transform:`translate(${-325/2+60},150)`,children:[e("circle",{r:60,fill:"none",stroke:"black",strokeWidth:2}),e("text",{className:"rmg-name__en",dominantBaseline:"central",fontSize:120,textAnchor:"middle",children:s}),e("text",{className:"rmg-name__zh",fontSize:100,dominantBaseline:"central",x:65,children:"\u7AD9\u53F0"})]}),[s])},Ee=s=>{const{line_name:r,line_color:t}=s,{direction:n,svgWidth:i}=b(u=>u.param),l=n==="l"?i.destination-42:42,a=j.exports.useRef(null),[c,o]=H.useState({width:0});H.useEffect(()=>o(a.current.getBBox()),[...r]);const d=(n==="l"?-c.width:0)-6,m=(n==="l"?-1:1)*c.width/2;return j.exports.useMemo(()=>v("g",{transform:`translate(${l},92)`,children:[e("rect",{fill:t[0],x:d,width:c.width+10,height:120}),v("g",{textAnchor:n==="r"?"start":"end",transform:"translate(0,68)",fill:t[1],children:[e("g",{ref:a,children:e("text",{className:"rmg-name__zh",fontSize:68,children:r[0]})}),e("text",{className:"rmg-name__en",fontSize:30,textAnchor:"middle",x:m,dy:42,children:r[1]})]})]}),[c,...r,...t,n,i.destination])},Oe=s=>{const{line_name:r,line_color:t}=s,{direction:n,svgWidth:i}=b(o=>o.param),[l,a]=r[0].match(/^[\w\d]+|.+/g),c=n==="l"?i.destination-36-210:36+54;return j.exports.useMemo(()=>v("g",{transform:`translate(${c},92)`,children:[e("rect",{fill:t[0],x:-54,width:108,height:120}),e("text",{className:"rmg-name__zh",fill:t[1],fontSize:96,textAnchor:"middle",dominantBaseline:"central",transform:"translate(0,60)",letterSpacing:-5,children:l}),v("g",{textAnchor:"start",transform:"translate(74,68)",children:[e("text",{className:"rmg-name__zh",fontSize:68,children:a}),e("text",{className:"rmg-name__en",fontSize:30,dy:42,children:r[1]})]})]}),[c,...r,...t,n,i.destination])},G=(s,r)=>s.map(t=>{const n=r.filter(o=>o.includes(t.from)&&o.includes(t.to));if(n.length!==1)return{linePath:[],colors:t.colors};const i=n.flat(),l=i.indexOf(t.from),a=i.indexOf(t.to);return{linePath:l<a?i.slice(l,a+1):i.slice(a,l+1),colors:t.colors}}).filter(t=>t.linePath.length!==0),Fe=(s,r)=>s.map(t=>{const n=de(t.linePath,r);return{main:[{linePath:n.main,colors:t.colors}],pass:[{linePath:n.pass,colors:t.colors}]}}).reduce((t,n)=>(t.main=[...t.main,...n.main],t.pass=[...t.pass,...n.pass],t),{main:[],pass:[]}),R=12,ae=L.RunIn,Ie=()=>{const{canvasScale:s}=b(h=>h.app),{branches:r,routes:t,depsStr:n}=b(h=>h.helper),{svgWidth:i,svg_height:l,current_stn_idx:a,direction:c,loop:o,theme:d}=b(h=>h.param),m=i[ae],u=l-300,_=j.exports.useMemo(()=>{let h=t.filter(g=>g.includes(a)).map(g=>g[g.indexOf(a)+(c==="l"?1:-1)]).reduce((g,f)=>g.includes(f)?g:g.concat(f),[]);return o&&r[0].includes(a)&&h.length===1&&["linestart","lineend"].includes(h[0])&&(h=c==="l"?[r[0][1]]:[r[0][r[0].length-2]]),h},[n,a,c,o]),x=j.exports.useMemo(()=>{let h=t.filter(g=>g.includes(a)).map(g=>g[g.indexOf(a)+(c==="l"?-1:1)]).reduce((g,f)=>g.includes(f)?g:g.concat(f),[]);return o&&r[0].includes(a)&&h.length===1&&["linestart","lineend"].includes(h[0])&&(h=c==="l"?[r[0][r[0].length-2]]:[r[0][1]]),h},[n,a,c,o]);return v(Z,{type:ae,svgWidth:m,svgHeight:l,canvasScale:s,theme:d,children:[e(ze,{}),e("g",{transform:`translate(0,${u})`,children:e(Le,{prevStnIds:_,nextStnIds:x})})]})},ze=j.exports.memo(()=>v("defs",{children:[e("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),v("filter",{id:"pujiang_outline_runin",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[e("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"0",result:"e1"}),e("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"1",result:"e2"}),e("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"outline"}),e("feComposite",{in:"outline",in2:"SourceGraphic",operator:"over",result:"output"})]})]})),Le=s=>{const{prevStnIds:r,nextStnIds:t}=s,{info_panel_type:n,svgWidth:i,stn_list:l}=b(x=>x.param),a=i.runin/2,c=t.length===1&&["linestart","lineend"].includes(t[0]),o=r.length===1&&["linestart","lineend"].includes(r[0]),d=t.map(x=>l[x].name),m=r.map(x=>l[x].name),u=(t.length>1?(d[0][0].split("\\").length-1)*-50+(d[0][1].split("\\").length-1)*-30:0)+10,_=(r.length>1?(m[0][0].split("\\").length-1)*-50+(m[0][1].split("\\").length-1)*-30:0)+10;return v(F,{children:[e(Ce,{prevStnIds:r,nextStnIds:t,nextBranchLineDy:u,prevBranchLineDy:_}),c&&n!=="sh2020"?e(ie,{mode:"terminal",prevStnIds:r,nextStnIds:t}):o&&n!=="sh2020"?e(ie,{mode:"original",prevStnIds:r,nextStnIds:t}):v(F,{children:[e(je,{prevStnIds:r,nextStnIds:t}),e("g",{transform:`translate(${a},160)`,textAnchor:"middle",children:e(pe,{})})]}),(o||!c)&&e(De,{stnIds:s.nextStnIds}),(c||!o)&&e(Be,{stnIds:s.prevStnIds})]})},ie=s=>{var h;const{mode:r,prevStnIds:t,nextStnIds:n}=s,{current_stn_idx:i,theme:l,svgWidth:a,direction:c,coline:o}=b(g=>g.param),{branches:d}=b(g=>g.helper),m={l:{original:{x:a.runin-36,anchor:"end"},terminal:{x:36,anchor:"start"}},r:{original:{x:36,anchor:"start"},terminal:{x:a.runin-36,anchor:"end"}}},u=G(Object.values(o),d),_=r==="terminal"?t:n,x=n.length>1?"var(--rmg-theme-colour)":(h=u.filter(g=>g.linePath.includes(i)&&g.linePath.includes(_[0])).map(g=>g.colors[0][2])[0])!=null?h:"var(--rmg-theme-colour)";return v(F,{children:[r==="original"&&e("path",{transform:`translate(0,${o.length?"198":"220"})${o.length?"scale(1,2)":""}`,stroke:x,strokeWidth:12,d:c==="l"?`M ${a.runin-24},16 H 36`:`M24,16 H ${a.runin-36}`,markerEnd:"url(#slope)"}),r==="terminal"&&e("g",{filter:l[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,children:e("path",{transform:`translate(0,${o.length?"198":"220"})${o.length?"scale(1,2)":""}`,stroke:"var(--rmg-grey)",strokeWidth:12,d:`M24,16 H ${a.runin-24}`})}),e("g",{transform:`translate(${m[c][r].x},160)`,textAnchor:m[c][r].anchor,children:e(pe,{})})]})},je=s=>{var w;const{prevStnIds:r,nextStnIds:t}=s,{direction:n,svgWidth:i,theme:l,coline:a,current_stn_idx:c,stn_list:o}=b(S=>S.param),{branches:d}=b(S=>S.helper),m=i.runin/2,u=S=>S.includes("linestart")||S.includes("lineend"),_=G(Object.values(a),d),x=t.length>1?"single":u(t)?_.filter(S=>[c,r[0]].every(M=>S.linePath.includes(M))).length>0?"multiple":"single":[c,t[0]].every(S=>d[0].includes(S))&&_.filter(S=>[c,t[0]].every(M=>S.linePath.includes(M))).length>0?"multiple":"single",h=u(t)?r:t,g=t.length>1?"var(--rmg-theme-colour)":(w=_.filter(S=>S.linePath.includes(c)&&S.linePath.includes(h[0])).map(S=>S.colors[0][2])[0])!=null?w:"var(--rmg-theme-colour)",f=(S,M,k,N)=>S.slice(1).filter(z=>[M,k[0]].every(I=>z.includes(I))).filter(z=>U(z,N)).length>0,p=Object.keys(a).length>0&&f(d,c,t,o)?g:"var(--rmg-theme-colour)",$=Object.keys(a).length>0&&t.length===1&&(u(r)||u(t)?!0:!([c,t[0]].every(S=>d[0].includes(S))&&_.filter(S=>S.linePath.includes(c)&&S.linePath.includes(t[0])).length!==0)),y=Object.keys(a).length>0&&r.length===1;return v("g",{transform:"translate(0,220)",strokeWidth:12,children:[v(F,{children:[p!=="var(--rmg-theme-colour)"&&e("marker",{id:`slope_${p}`,viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:p})}),e("path",{stroke:p,d:`M ${m},16 H ${n==="l"?36:i.runin-36}`,markerEnd:p==="var(--rmg-theme-colour)"?"url(#slope)":`url(#slope_${p})`,transform:$?"translate(0,-22)scale(1,2)":void 0})]}),x==="multiple"&&v(F,{children:[e("marker",{id:`slope_${g}`,viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:g})}),e("path",{stroke:g,d:`M ${m},16 H ${n==="l"?36+R:i.runin-(36+R)}`,markerEnd:`url(#slope_${g})`,transform:"translate(0,-12)"})]}),e("g",{filter:l[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,transform:`translate(0,${y?-22:0})scale(1,${y?2:1})`,children:e("path",{stroke:"var(--rmg-grey)",d:`M ${m},16 H ${n==="l"?i.runin-24:24} `})})]})},Ce=s=>{const{prevStnIds:r,nextStnIds:t,nextBranchLineDy:n,prevBranchLineDy:i}=s,{direction:l,svgWidth:a,current_stn_idx:c,coline:o,theme:d}=b($=>$.param),{branches:m}=b($=>$.helper),u=a.runin/2,_=125,x=$=>`${$[0]},${$[1]}`,h=$=>`M${x($.at(0))} `+$.slice(1).map(y=>`L${x(y)}`).join(" ");let g=l==="l"?[[a.runin/3,_],[a.runin/6,n],[36,n]]:[[a.runin/3*2,_],[a.runin/6*5,n],[a.runin-36,n]],f=l==="l"?[[a.runin/3*2,_],[a.runin/6*5,i],[a.runin-24,i]]:[[a.runin/3,_],[a.runin/6,i],[24,i]],p="var(--rmg-theme-colour)";if(Object.keys(o).length>0){const $=G(Object.values(o),m);t.length>1&&$.filter(y=>y.linePath.includes(c)&&t.some(w=>y.linePath.includes(w)))&&(g[0][1]-=R-1,g.unshift([u,_-R+1]),p=$.filter(y=>y.linePath.includes(c)&&t.some(w=>y.linePath.includes(w))).at(0).colors.at(0)[2]),r.length>1&&$.filter(y=>y.linePath.includes(c)&&r.some(w=>y.linePath.includes(w)))&&(f[0][1]-=R-1,f.unshift([u,_-R+1]))}return v("g",{transform:"translate(0,110)",strokeWidth:12,fill:"none",filter:d[2]==="#999999"?"url(#pujiang_outline_runin)":void 0,children:[e("marker",{id:"slope_branch",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:p})}),t.length>1&&e("path",{stroke:p,d:h(g),markerEnd:"url(#slope_branch)"}),r.length>1&&e("path",{stroke:"var(--rmg-grey)",d:h(f)})]})},pe=()=>{const s=b(t=>t.param),{name:r}=s.stn_list[s.current_stn_idx];return j.exports.useMemo(()=>v(F,{children:[e("text",{className:"rmg-name__zh",fontSize:112,children:r[0].replace("\\","")}),e("text",{className:"rmg-name__en",fontSize:36,dy:50,children:r[1].replace("\\","")})]}),[...r])},X=s=>{const{nextName:r,...t}=s;return e("g",{...t,children:j.exports.useMemo(()=>v(F,{children:[r[0].split("\\").map((n,i,l)=>e("text",{className:"rmg-name__zh",fontSize:48,dy:(l.length-1-i)*-50-(r[1].split("\\").length-1)*30,children:n},n)),r[1].split("\\").map((n,i,l)=>e("text",{className:"rmg-name__en",fontSize:24,dy:28+(l.length-1-i)*-30,children:n},n))]}),[...r])})},Be=s=>{const r=b(l=>l.param),t=s.stnIds.map(l=>r.stn_list[l].name),n=(s.stnIds.length>1?15:125)+t.map(l=>l[0].split("\\").length).reduce((l,a)=>l+a,-t.length)*-50+t.map(l=>l[1].split("\\").length).reduce((l,a)=>l+a,-t.length)*-30,i=(s.stnIds.length>1?(t[0][0].split("\\").length-1)*-50+(t[0][1].split("\\").length-1)*-30:0)+70;return v("g",{fill:"gray",textAnchor:r.direction==="l"?"end":"start",transform:`translate(${r.direction==="l"?r.svgWidth.runin-36:36},0)`,children:[e(X,{nextName:t[0],transform:"translate(0,183)"}),s.stnIds.length>1&&e(X,{nextName:t[1],transform:`translate(0,${i})`}),v("g",{transform:`translate(0, ${n})`,children:[e("text",{className:"rmg-name__zh",fontSize:22,children:"\u4E0A\u4E00\u7AD9"}),e("text",{className:"rmg-name__en",fontSize:12,dx:r.direction==="l"?-70:70,children:"Past Stop"})]})]})},De=s=>{const r=b(l=>l.param),t=s.stnIds.map(l=>r.stn_list[l].name),n=(s.stnIds.length>1?15:125)+t.map(l=>l[0].split("\\").length).reduce((l,a)=>l+a,-t.length)*-50+t.map(l=>l[1].split("\\").length).reduce((l,a)=>l+a,-t.length)*-30,i=(s.stnIds.length>1?(t[0][0].split("\\").length-1)*-50+(t[0][1].split("\\").length-1)*-30:0)+70;return v("g",{textAnchor:r.direction==="l"?"start":"end",transform:`translate(${r.direction==="l"?36:r.svgWidth.runin-36},0)`,children:[e(X,{nextName:r.stn_list[s.stnIds[0]].name,transform:"translate(0,183)"}),s.stnIds.length>1&&e(X,{nextName:r.stn_list[s.stnIds[1]].name,transform:`translate(0,${i})`}),v("g",{transform:`translate(0, ${n})`,children:[e("text",{className:"rmg-name__zh",fontSize:22,children:"\u4E0B\u4E00\u7AD9"}),e("text",{className:"rmg-name__en",fontSize:12,dx:r.direction==="l"?70:-70,children:"Next Stop"})]})]})},J=s=>{const{stnId:r,stnState:t,color:n,bank:i,direction:l}=s,{direction:a,info_panel_type:c,stn_list:o,loop:d}=b(y=>y.param),m=o[r],u=l!=null?l:a,_=d?0:([...m.branch.left,...m.branch.right].length?8+12*m.name[1].split("\\").length:0)*(u==="r"?-1:1);let x="",h={};c==="sh2020"?(m.services.length===3?x="stn_sh_2020_direct":m.services.length===2?x="stn_sh_2020_express":x="stn_sh_2020",h.fill=t===-1?"gray":n||"var(--rmg-theme-colour)"):(m.services.length===3?x="direct_sh":m.services.length===2?x="express_sh":[...m.transfer.info[0],...m.transfer.info[1]||[]].length>0?x="int2_sh":x="stn_sh",h.stroke=t===-1?"gray":n||"var(--rmg-theme-colour)");const g=i!=null?i:0,f=(u==="l"?6:-6)+_+g*30,p=(c==="sh2020"?-20:-6)+Math.abs(g)*(c==="sh2020"?25:11),$=g?0:u==="l"?-45:45;return v(F,{children:[e("use",{xlinkHref:`#${x}`,...h,transform:`translate(${g*(c==="sh2020"?5:0)},0)rotate(${g*90*(c==="sh2020"?1:-1)})`}),e("g",{transform:`translate(${f},${p})rotate(${$})`,children:e(We,{name:m.name,infos:m.transfer.info,stnState:t,direction:u,facility:m.facility,bank:g,oneLine:m.one_line,intPadding:m.int_padding})}),t===0?e(Pe,{}):void 0]})},We=s=>{var p;const{name:r,infos:t,stnState:n,direction:i,facility:l,bank:a,oneLine:c,intPadding:o}=s,d=H.useRef(null),m=i==="l"?1:-1,u=l!==ne.none?30:0,_=a?-12:0,x=H.useRef(null),[h,g]=H.useState(0);H.useEffect(()=>{var $,y;return g((y=($=x.current)==null?void 0:$.getBBox().width)!=null?y:0)},[...JSON.stringify(t)]);const f=o-h;return v(F,{children:[t.flat().length>0&&v(F,{children:[e("line",{x1:(_+u)*m,x2:f*m,stroke:n===-1?"gray":"black",strokeWidth:.5}),e(Te,{ref:x,intInfos:t,direction:i,transform:`translate(${f*m},-10.75)`})]}),l!==ne.none&&e("use",{xlinkHref:"#"+l,x:10*m,y:-30}),v("g",{textAnchor:i==="l"?"start":"end",transform:`translate(${u*m},-14)`,children:[e(Ae,{ref:d,stnName:r,oneLine:c,directionPolarity:m,fill:n===-1?"gray":n===0?"red":"black"}),((p=t[1])==null?void 0:p.length)>0&&e("g",{transform:`translate(${(f+h/2)*m},-30)`,children:e(Ve,{osiInfos:t[1]})}),[...t[2]||[]].length>0&&e("g",{transform:`translate(${(o+5)*m},0)`,children:e(Xe,{osysiInfos:t[2],direction:s.direction})})]})]})},Ae=H.forwardRef((s,r)=>{const{stnName:t,oneLine:n,directionPolarity:i,...l}=s,a=H.useRef(null),[c,o]=H.useState(0);H.useEffect(()=>{o(n?a.current.getBBox().width+5:0)},[...t,n]);const[d,m]=[20,8];return e("g",{ref:r,...l,children:H.useMemo(()=>v(F,{children:[e("g",{ref:a,children:t[0].split("\\").map((u,_,x)=>e("text",{className:"rmg-name__zh rmg-outline",dy:(x.length-1-_)*-d+(n?m:(t[1].split("\\").length-1)*-m),children:u},_))}),e("g",{fontSize:8,transform:`translate(${c*i},0)`,children:t[1].split("\\").map((u,_,x)=>e("text",{className:"rmg-name__en rmg-outline",dy:(x.length-2-_)*-m+2,children:u},_))})]}),[...t,n,c,i])})}),Pe=()=>{const{stn_list:s}=b(n=>n.param),r=new Set(Object.values(s).map(n=>n.services).flat()),t=[-1,35,50,75][r.size];return e("g",{transform:`translate(0, ${t})`,children:e("text",{className:"rmg-name__zh",fill:"red",textAnchor:"middle",children:"\u672C\u7AD9"})})},Te=H.forwardRef((s,r)=>{var c;const{intInfos:t,direction:n,...i}=s,l=[...t[0],...t[1]||[],...((c=t[2])==null?void 0:c.filter(o=>Boolean(o[4].match(/^磁(悬)*浮/))))||[]];let a=0;return e("g",{ref:r,fontSize:14,textAnchor:"middle",...i,children:l.map((o,d)=>{const m=Boolean(o[4].match(/^[\w\d]+(号)?线/)),u=Boolean(o[4].match(/^磁(悬)*浮/));s.direction==="r"&&(a-=(m||u?20:o[4].length*14+12)+(d===0?0:5));let _=e("g",{});return u?_=e("g",{transform:`translate(${a},-16)scale(0.1428571429)`,children:e(Re,{info:o})},d):m?_=e("g",{transform:`translate(${a},0)`,children:e(Ge,{info:o})},d):_=e("g",{transform:`translate(${a},0)`,children:e(Ye,{info:o})},d),s.direction==="l"&&(a+=m||u?20+5:o[4].length*14+12+5),_})})}),Re=H.memo(s=>e(F,{children:e("use",{xlinkHref:"#intbox_maglev",fill:s.info[2],stroke:s.info[2]})}),(s,r)=>s.info.toString()===r.info.toString()),Ge=H.memo(s=>v(F,{children:[e("use",{xlinkHref:"#intbox_number",fill:s.info[2]}),e("text",{x:10,className:"rmg-name__zh",fill:s.info[3],dominantBaseline:"central",children:s.info[4].match(/(\d*)\w+/)[0]})]}),(s,r)=>s.info.toString()===r.info.toString()),Ye=H.memo(s=>{const r=s.info[4].split("\\")[0].length;return v(F,{children:[e("rect",{height:22,width:r*14+12,y:-11,fill:s.info[2]}),e("text",{x:r*7+6,className:"rmg-name__zh",fill:s.info[3],dominantBaseline:"central",children:s.info[4].split("\\")[0]})]})},(s,r)=>s.info.toString()===r.info.toString()),Ve=s=>{const r=s.osiInfos.map(t=>t[4]).join("\uFF0C");return H.useMemo(()=>v("g",{textAnchor:"middle",fontSize:"50%",children:[e("text",{className:"rmg-name__zh",dy:-5,children:`\u6362\u4E58${r}`}),e("text",{className:"rmg-name__zh",dy:5,children:"\u4EC5\u9650\u516C\u5171\u4EA4\u901A\u5361"}),e("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]}),[r.toString()])},Xe=s=>{const r=s.osysiInfos.map(n=>n[4]).join("\uFF0C"),t=s.osysiInfos.map(n=>n[5]).join(", ");return H.useMemo(()=>v("g",{textAnchor:s.direction==="l"?"start":"end",fontSize:"50%",children:[v("text",{className:"rmg-name__zh",dy:3,children:["\u8F6C\u4E58",r]}),v("text",{className:"rmg-name__en",dy:10,fontSize:"75%",children:["To ",t]})]}),[s.osysiInfos.toString(),s.direction])},Ue=["shanghai","sh4","#5F259F","#fff","4\u53F7\u7EBF","Line 4"],Ze=s=>{const{xs:r,servicesPresent:t,stnStates:n}=s,{svg_height:i,direction:l,stn_list:a,current_stn_idx:c,branchSpacingPct:o,info_panel_type:d,coline:m}=b(S=>S.param),{branches:u,depsStr:_}=b(S=>S.helper),x=H.useMemo(()=>(console.log("computing y shares"),Object.keys(a).reduce((S,M)=>{if(u[0].includes(M))return{...S,[M]:0};{const k=u.slice(1).filter(N=>N.includes(M))[0];return{...S,[M]:a[k[0]].children.indexOf(k[1])?-3:3}}},{})),[_]),h=Object.entries(x).filter(([S,M])=>M<=0).reduce((S,[M,k])=>({...S,[M]:k}),{}),g=Object.keys(h).reduce((S,M)=>({...S,[M]:-h[M]*o*i/300}),{}),f=H.useMemo(()=>Fe(G(Object.values(m).filter(S=>S.display),u),n),[JSON.stringify(m),c,l,_]),p=t.reduce((S,M)=>({...S,[M]:Object.keys(f).reduce((k,N)=>({...k,[N]:f[N].map(z=>({path:_e(z.linePath,N,r,g,l,M,t.length,a,"diagonal"),colors:z.colors})).filter(z=>z.path!=="")}),{})}),{}),$=G(Object.values(m).filter(S=>S.display),u).map(S=>S.linePath).flat(),y=12,w=d==="sh2020"?3:0;return e(F,{children:v("g",{id:"coline",transform:`translate(0,${y+w})`,children:[e(Je,{paths:p,direction:l}),e(qe,{colineStns:f,branches:u,xs:r,ys:g,stnStates:n,lineWidth:y,colineGap:w}),e(Ke,{stnIds:Object.entries(x).filter(([S,M])=>M<0).reduce((S,[M,k])=>[...S,M],[]).filter(S=>!["linestart","lineend"].includes(S)).filter(S=>a[S].services.length!==0).filter(S=>$.includes(S)),xs:r,ys:g,stnStates:n})]})})},Je=s=>{const{paths:r,direction:t}=s;return e(F,{children:Object.keys(r).map((n,i)=>{var l,a;return e("g",{transform:`translate(0,${i*25})`,children:v("g",{children:[(l=r[n])==null?void 0:l.pass.map((c,o)=>e(H.Fragment,{children:e("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:c.path,strokeLinejoin:"round",filter:n===T.local?void 0:`url(#contrast-${n})`},o)},o)),(a=r[n])==null?void 0:a.main.map((c,o)=>{var d;return v(H.Fragment,{children:[c.colors.length>1&&e("linearGradient",{id:`grad${o}`,y1:"-100%",y2:"100%",x1:"0",x2:"0",gradientUnits:"userSpaceOnUse",children:c.colors.map((m,u)=>v(H.Fragment,{children:[e("stop",{offset:`${100/c.colors.length*(u+0)}%`,stopColor:m[2]}),e("stop",{offset:`${100/c.colors.length*(u+1)}%`,stopColor:m[2]})]},u))}),t==="l"&&e("marker",{id:`arrow_left_${o}_${c.colors.map(m=>m[2]).join("_")}`,refY:.5,refX:1,children:e("path",{d:"M1,0L0,1H1z",fill:c.colors.length>1?`url(#grad${o})`:c.colors[0][2]})}),t==="r"&&e("marker",{id:`arrow_right_${o}_${c.colors.map(m=>m[2]).join("_")}`,refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:c.colors.length>1?`url(#grad${o})`:c.colors[0][2]})}),e("path",{stroke:((d=c.colors.at(-1))!=null?d:Ue)[2],strokeWidth:12,fill:"none",d:c.path,markerStart:t==="l"?`url(#arrow_left_${o}_${c.colors.map(m=>m[2]).join("_")})`:void 0,markerEnd:t==="r"?`url(#arrow_right_${o}_${c.colors.map(m=>m[2]).join("_")})`:void 0,strokeLinejoin:"round",filter:n===T.local?void 0:`url(#contrast-${n})`},o)]},o)})]})},`servicePath${i}`)})})},qe=s=>{const{colineStns:r,branches:t,xs:n,ys:i,stnStates:l,lineWidth:a,colineGap:c}=s,{line_name:o,theme:d,info_panel_type:m}=b(_=>_.param),u=[...r.main,...r.pass].map(_=>_.linePath.map(x=>{var h;return{curStn:x,x:n[x],y:i[x],color:(h=_.colors.at(-1))!=null?h:[...d,...o]}})).flat().reduce((_,x)=>_.find(h=>h.curStn===x.curStn)?_:_.concat(x),[]).filter(_=>t[0].includes(_.curStn));return console.log(u),e("g",{id:"stations_in_mainline",children:u.map(_=>{const{curStn:x,x:h,y:g,color:f}=_,p=(l[x]===-1?0:a)+c+a,$=(l[x]===-1?0:-a)-c-a/2;return e("g",{transform:`translate(${h},${g})`,children:m==="sh2020"?e("rect",{stroke:"none",height:p,width:12,x:-6,y:$,fill:l[x]===-1?"var(--rmg-grey)":f[2]}):e("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:`translate(0,${-a})`})},x)})})},Ke=s=>{const{xs:r,ys:t,stnStates:n,stnIds:i}=s,{branches:l,depsStr:a}=b(_=>_.helper),{line_name:c,theme:o,coline:d}=b(_=>_.param),m=H.useMemo(()=>G(Object.values(d),l),[JSON.stringify(d),a]),u=i.reduce((_,x)=>{var h;return{..._,[x]:(h=m.filter(g=>g.linePath.includes(x)).map(g=>g.colors).flat().at(0))!=null?h:[...o,...c]}},{});return e("g",{id:"stations_in_coline",children:i.map(_=>e("g",{transform:`translate(${r[_]},${t[_]})`,children:e(J,{stnId:_,stnState:n[_],color:u[_][2]})},_))})},Qe=()=>{const{routes:s,branches:r,depsStr:t}=b(k=>k.helper),n=b(k=>k.param),{svg_height:i,stn_list:l,branchSpacingPct:a,coline:c,direction:o}=b(k=>k.param),d=me(n.stn_list,()=>0,()=>0),m=V("linestart","lineend",d),u=V(m.nodes[1],m.nodes.slice(-2)[0],d),_=H.useMemo(()=>(console.log("computing x shares"),Object.keys(n.stn_list).reduce((k,N)=>({...k,[N]:ue(N,d,r)}),{})),[r.toString(),JSON.stringify(d)]),x=[n.svgWidth.railmap*n.padding/100,n.svgWidth.railmap*(1-n.padding/100)],h=Object.keys(_).reduce((k,N)=>({...k,[N]:x[0]+_[N]/u.len*(x[1]-x[0])}),{}),g=H.useMemo(()=>(console.log("computing y shares"),Object.keys(l).reduce((k,N)=>{if(r[0].includes(N))return{...k,[N]:0};{const z=r.slice(1).filter(I=>I.includes(N))[0];return{...k,[N]:l[z[0]].children.indexOf(z[1])?-3:3}}},{})),[t]),f=Object.entries(g).filter(([k,N])=>N>=0).reduce((k,[N,z])=>({...k,[N]:z}),{}),p=Object.keys(f).reduce((k,N)=>({...k,[N]:-f[N]*a*i/300}),{}),$=H.useMemo(()=>fe(n.current_stn_idx,s,n.direction),[n.current_stn_idx,n.direction,s.toString()]),y=Object.values(T),w=Object.values(n.stn_list).map(k=>k.services).flat().reduce((k,N)=>(k[y.indexOf(N)]=!0,k),[!1,!1,!1]).map((k,N)=>[y[N],k]).filter(k=>k[1]).map(k=>k[0]),S=r.map(k=>de(k,$)).reduce((k,N)=>(k.main.push(N.main),k.pass.push(N.pass),k),{main:[],pass:[]}),M=w.reduce((k,N)=>({...k,[N]:Object.keys(S).reduce((z,I)=>({...z,[I]:S[I].map(E=>_e(E,I,h,p,o,N,w.length,l)).filter(E=>E!=="")}),{})}),{});return v("g",{id:"main",transform:`translate(0,${n.svg_height*(Object.keys(c).length>0?.5:.7+.1)})`,children:[e(et,{paths:M,direction:n.direction}),e(tt,{stnIds:Object.keys(f).filter(k=>!["linestart","lineend"].includes(k)).filter(k=>l[k].services.length!==0),xs:h,ys:p,stnStates:$}),Object.keys(c).length>0&&e(Ze,{xs:h,servicesPresent:w,stnStates:$}),w.length>1&&e(nt,{servicesLevel:w,lineXs:x})]})},et=s=>{const{theme:r}=b(i=>i.param),{paths:t,direction:n}=s;return e(F,{children:Object.keys(t).map((i,l)=>{var a,c;return v("g",{transform:`translate(0,${l*25})`,filter:r[2]==="#999999"?"url(#pujiang_outline_railmap)":void 0,children:[e("g",{children:(a=t[i])==null?void 0:a.pass.map((o,d)=>e("path",{stroke:"var(--rmg-grey)",strokeWidth:12,fill:"none",d:o,markerStart:s.direction==="l"?"url(#arrow_gray)":void 0,markerEnd:s.direction==="r"?"url(#arrow_gray)":void 0,strokeLinejoin:"round"},d))}),e("g",{children:(c=t[i])==null?void 0:c.main.map((o,d)=>e("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:o,markerStart:n==="l"?"url(#arrow_theme_left)":void 0,markerEnd:n==="r"?"url(#arrow_theme_right)":void 0,strokeLinejoin:"round",filter:i===T.local?void 0:`url(#contrast-${i})`},d))})]},`servicePath${l}`)})})},_e=(s,r,t,n,i,l,a,c,o="rightangle")=>{var[d,m]=[],u={};const _={local:0,express:20,direct:40}[l],x=a>1?50:0;let h=30;if(s.length>0){let f=!1,p=!1;c[s.at(-1)||0].children.some($=>["linestart","lineend"].includes($))?p=!0:c[s.at(0)||0].parents.some($=>["linestart","lineend"].includes($))&&(f=!0),h=f||p?h:0}const g=30;if(s.forEach(f=>{var p=t[f],$=n[f];if(!d&&d!==0){[m,d]=[p,$],u.start=[p,$];return}$===0?$!==d&&(u.bifurcate=[m,d]):$!==d&&(u.bifurcate=[p,$]),u.end=[p,$],[m,d]=[p,$]}),u.hasOwnProperty("start"))if(u.hasOwnProperty("end"))if(u.hasOwnProperty("bifurcate")){let[f,p]=u.start,$=u.bifurcate[0],[y,w]=u.end;return r==="main"?i==="l"?w>p?(console.log(u),o==="rightangle"?`M ${f-h},${p} H ${y} V ${w}`:`M ${f},${p} H ${f+g} L ${$-g},${w} H ${y}`):o==="rightangle"?`M ${f},${p} V ${w} H ${y}`:`M ${f-h},${p} H ${$+g} L ${y-g},${w} H ${y}`:w>p?o==="rightangle"?`M ${f},${p} H ${y} V ${w}`:`M ${f},${p} H ${f+g} L ${$-g},${w} H ${y+h}`:o==="rightangle"?`M ${f},${p} V ${w} H ${y+h}`:`M ${f},${p} H ${$+g} L ${y-g},${w} H ${y}`:i==="l"?w>p?o==="rightangle"?`M ${f-h},${p} H ${y} V ${w}`:`M ${f},${p} H ${f+g} L ${$-g},${w} H ${y+h}`:o==="rightangle"?`M ${f},${p} V ${w} H ${y+h}`:`M ${f-h},${p} H ${$+g} L ${y-g},${w} H ${y}`:w>p?o==="rightangle"?`M ${f-h},${p} H ${y} V ${w}`:`M ${f},${p} H ${f+g} L ${$-g},${w} H ${y+h}`:o==="rightangle"?`M ${f},${p} V ${w} H ${y+h}`:`M ${f-h},${p} H ${$+g} L ${y-g},${w} H ${y}`}else{let[f,p]=u.start,$=u.end[0];return r==="main"?i==="l"?`M ${f-h-_},${p} H ${$}`:`M ${f},${p} H ${$+h+_}`:i==="l"?`M ${f-h},${p} H ${$+h+x}`:`M ${f-h-x},${p} H ${$+h}`}else{let[f,p]=u.start;return r==="main"?i==="l"?`M ${f-h-_},${p} H ${f}`:`M ${f},${p} H ${f+h+_}`:i==="l"?`M ${f},${p} L ${f+h+x},${p}`:`M ${f-h-x},${p} L ${f},${p}`}else return""},tt=s=>{const{xs:r,ys:t,stnStates:n,stnIds:i}=s;return e("g",{children:i.map(l=>e("g",{transform:`translate(${r[l]},${t[l]})`,children:e(J,{stnId:l,stnState:n[l]})},l))})},nt=s=>{const{svg_height:r,direction:t,svgWidth:n}=b(o=>o.param),i=-r+130,l=s.servicesLevel.map(o=>({local:"\u666E\u901A\u8F66",express:"\u5927\u7AD9\u8F66",direct:"\u76F4\u8FBE\u8F66"})[o]),a=t==="r"?s.lineXs[0]-42:s.lineXs[1]+42;let c=s.servicesLevel.length===2?350:500;return H.useMemo(()=>v("g",{children:[l.map((o,d)=>v("g",{transform:`translate(${a},${d*25})`,children:[e("rect",{x:-27.5,height:10,width:55,fill:"white",stroke:"black",y:-5}),e("text",{className:"rmg-name__zh",fontSize:9,y:3,textAnchor:"middle",children:`${o}\u8FD0\u884C\u7EBF`})]},o)),v("g",{transform:`translate(${t==="r"?30:n.railmap-c},${i})`,children:[e("text",{className:"rmg-name__zh",children:"\u56FE\u4F8B\uFF1A"}),l.map((o,d)=>v("g",{transform:`translate(${d*150+50},0)`,children:[e("line",{x1:"0",x2:"35",y1:"-5",y2:"-5",stroke:"var(--rmg-theme-colour)",strokeWidth:"12",filter:d===2?"url(#contrast-direct)":d===1?"url(#contrast-express)":""}),e("use",{x:"17.5",y:"-5",xlinkHref:"#stn_sh",fill:"var(--rmg-theme-colour)"}),e("text",{x:"40",className:"rmg-name__zh",children:`${o}\u505C\u9760\u7AD9`})]},`serviceLevel${d}`))]})]}),[r,t,n,s.servicesLevel,s.lineXs])},rt=()=>{const{direction:s,svgWidth:r,coline:t}=b(i=>i.param),n=!!Object.keys(t).length;return H.useMemo(()=>v("g",{transform:`translate(${s==="l"?50:r.railmap-150},50)`,children:[e("text",{className:"rmg-name__zh",children:"\u5217\u8F66\u524D\u8FDB\u65B9\u5411"}),e("path",{d:"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z",stroke:n?"var(--rmg-black)":void 0,strokeWidth:n?5:void 0,fill:n?"var(--rmg-white)":"var(--rmg-theme-colour)",transform:`translate(${s==="l"?-30:125},-5)rotate(${s==="l"?0:180})scale(0.15)`})]}),[s,t,r.railmap])},K=s=>{const{stnId:r,nameDirection:t,services:n,color:i}=s,l=b(d=>d.param.stn_list[r]),a=[...l.transfer.info[0],...l.transfer.info[1]||[]];let c="";l.services.length===3?c="direct_indoor_sh":l.services.length===2?c="express_indoor_sh":a.length>0?c="int2_indoor_sh":c="stn_indoor_sh";const o=t==="left"||t==="right"?90:0;return v(F,{children:[e(st,{name:l.name,infos:l.transfer.info,nameDirection:t,services:n}),e("use",{xlinkHref:`#${c}`,stroke:a.length>0?"var(--rmg-black)":i!=null?i:"var(--rmg-theme-colour)",transform:`rotate(${o})`}),l.services.length>1&&e("text",{className:"rmg-name__zh",writingMode:"tb",fontSize:"60%",dy:"-12",children:`\u5927\u7AD9\u8F66${l.services.length>2?" \u76F4\u8FBE\u8F66":""}\u505C\u9760`})]})},st=s=>{var m,u,_,x,h,g,f,p;const{name:r,infos:t,nameDirection:n,services:i}=s,l={upward:60,downward:-30,left:0,right:0}[n],a={upward:0,downward:0,left:85,right:-85}[n],c={upward:-185,downward:150+(i.length===3?40:0),left:-30,right:-30}[n],o=((m=t[2])==null?void 0:m.length)>0?{upward:0,downward:0,left:t[0].length+t[1].length!==0?85:25,right:t[0].length+t[1].length!==0?-85:-25}[n]:0,d=((u=t[2])==null?void 0:u.length)>0?{upward:(_=t[1])!=null&&_.length?-210:t[0].length?-180:-100,downward:((x=t[1])!=null&&x.length?190:t[0].length?160:100)+(i.length===3?40:0),left:(h=t[1])!=null&&h.length?-60:t[0].length?-30:0,right:(g=t[1])!=null&&g.length?-60:t[0].length?-30:0}[n]:0;return v("g",{transform:`translate(0,${l})`,children:[n==="upward"||n==="downward"?v(F,{children:[e("line",{x1:-30,x2:30,y1:n==="upward"?-23:-10,y2:n==="upward"?-23:-10,stroke:"black"}),e("line",{y1:n==="upward"?-23:-10,y2:n==="upward"?-23-25:20,stroke:"black"})]}):v(F,{children:[e("line",{x1:n==="left"?-50:15,x2:n==="left"?-15:50,y1:0,y2:0,stroke:"black"}),e("line",{x1:n==="left"?-50:50,x2:n==="left"?-50:50,y1:-30,y2:30,stroke:"black"})]}),[...t[0],...t[1]||[]].length>0&&e(at,{intInfos:[...t[0],...t[1]||[]],arrowDirection:n,services:i}),e(lt,{stnName:r,nameDirection:n,fill:"black"}),((f=t[1])==null?void 0:f.length)>0&&e("g",{transform:`translate(${a},${c})`,children:e(it,{osiInfos:t[1],nameDirection:n})}),((p=t[2])==null?void 0:p.length)>0&&e("g",{transform:`translate(${o},${d})`,children:e(ot,{osysiInfos:t[2],nameDirection:n})})]})},lt=H.forwardRef((s,r)=>{const{stnName:t,nameDirection:n,...i}=s,l=t[0].split("\\"),a=t[1].split("\\").length,c={upward:0,downward:0,left:-60,right:60}[n],o={upward:-2,downward:-30-12*(a-1),left:-10*(a-1),right:-10*(a-1)}[n],d={upward:"middle",downward:"middle",left:"end",right:"start"}[n];return e("g",{ref:r,...i,textAnchor:d,transform:`translate(${c},${o})`,children:H.useMemo(()=>v(F,{children:[l.map((m,u,_)=>e("text",{className:"rmg-name__zh",dy:n==="upward"?16*u:(_.length-1-u)*-16,children:m},u)),e("g",{fontSize:9.6,children:t[1].split("\\").map((m,u)=>e("text",{className:"rmg-name__en",dy:12*(u+1)+(n==="upward"&&l.length>1?l.length*7.5:0),children:m},u))})]}),[...t])})}),at=s=>{const{intInfos:r,arrowDirection:t,services:n}=s,i=r.map(h=>h[2]).reduce((h,g)=>h+g,""),l=[r.filter(h=>h[4].match(/^\d+.*$/)).map(h=>h[4].replace(/^(\d+)(.*)$/,"$1")).join("\uFF0C").concat("\u53F7\u7EBF"),r.filter(h=>!h[4].match(/^\d+.*$/)).map(h=>h[4]).join("\uFF0C")].filter(h=>h&&h!=="\u53F7\u7EBF").join("\uFF0C"),a=["Line ".concat(r.filter(h=>h[5].match(/^L|line$/)).map(h=>h[5].replace("Line","").replace("line","").trim()).join(",")),r.filter(h=>!h[5].match(/^L|line$/)).map(h=>h[5]).join("\uFF0C")].filter(h=>h&&h!=="Line ").join(","),c=n.length===3?80:45,o={upward:-145,downward:125+(n.length===3?40:0),left:7,right:7}[t],d={upward:0,downward:0,left:20,right:-20}[t],m={upward:-74,downward:44,left:0,right:0}[t],u={upward:0,downward:180,left:90,right:-90}[t],_={upward:0,downward:0,left:85,right:-85}[t],x={upward:"middle",downward:"middle",left:"start",right:"end"}[t];return v("g",{children:[e("path",{id:"int_indoor_arrow_sh",stroke:"var(--rmg-black)",strokeWidth:1,transform:`translate(${d},${m})rotate(${u})`,fill:r.length===1?r[0][2]:`url(#grad${i})`,d:`M -7.5,0 v -${c} h -7.5 l 15,-15 l 15,15 h -7.5 v ${c} Z`}),r.length>1&&e(F,{children:e("linearGradient",{id:`grad${i}`,y1:"0",y2:"0",x1:t==="upward"?"25%":"75%",x2:t==="upward"?"75%":"25%",children:r.map((h,g)=>v(H.Fragment,{children:[e("stop",{offset:`${100/r.length*(g+0)}%`,stopColor:h[2]}),e("stop",{offset:`${100/r.length*(g+1)}%`,stopColor:h[2]})]},g))})}),v("g",{transform:`translate(${_},${o})`,textAnchor:`${x}`,children:[e("text",{className:"rmg-name__zh",dy:-7,children:`\u6362\u4E58${l}`}),e("text",{className:"rmg-name__en",dy:5,fontSize:9.6,children:`Interchange ${a}`})]})]})},it=s=>{const r={upward:"middle",downward:"middle",left:"start",right:"end"}[s.nameDirection];return H.useMemo(()=>v("g",{textAnchor:`${r}`,fontSize:"50%",children:[e("text",{className:"rmg-name__zh",dy:-5,children:`\u6362\u4E58${s.osiInfos.map(t=>t[4]).join("\uFF0C")}`}),e("text",{className:"rmg-name__zh",dy:5,children:"\u4EC5\u9650\u516C\u5171\u4EA4\u901A\u5361"}),e("text",{className:"rmg-name__en",dy:12.5,fontSize:"75%",children:"Only for Public Transportation Card"})]}),[s.osiInfos.toString(),s.nameDirection])},ot=s=>{const r={upward:"middle",downward:"middle",left:"start",right:"end"}[s.nameDirection];return H.useMemo(()=>v("g",{textAnchor:`${r}`,children:[e("text",{className:"rmg-name__zh",dy:-5,children:`\u8F6C\u4E58${s.osysiInfos.map(t=>t[4]).join("\uFF0C")}`}),e("text",{className:"rmg-name__en",dy:7.5,fontSize:9.6,children:`To ${s.osysiInfos.map(t=>t[5]).join(", ")}`})]}),[s.osysiInfos.toString(),s.nameDirection])},ct=(s,r,t,n,i,l)=>{var _,x,h,g;const a=s[0].filter(f=>!["linestart","lineend"].includes(f)),c=s.slice(1,3).map(f=>f.slice(1,f.length-1)),o=c.reduce((f,p)=>f+p.filter($=>!["linestart","lineend",...r].includes($)).length,0)+a.length-l-i*2,d=(t-t*n/100*2)/(1+o),m=[t*n/100+((_=c.at(0))!=null?_:[]).length*d,t*(1-n/100)-((x=c.at(1))!=null?x:[]).length*d],u={...Object.fromEntries(((h=c.at(0))!=null?h:[]).map((f,p)=>[f,t*n/100+p*d])),...Object.fromEntries(((g=c.at(1))!=null?g:[]).map((f,p)=>[f,m[1]+(1+p)*d]))};return{loop_branches:c,line_xs_branches:m,xs_branches:u}},ht=s=>{var $,y,w,S;const{loop_branches:r,edges:t,xs:n,ys:i,canvas:l}=s,[a,c,o,d]=t,{branches:m}=b(M=>M.helper),{current_stn_idx:u,direction:_,coline:x}=b(M=>M.param),h=l===L.RailMap?30:0,g=[`M ${a},${o} H ${Number(n[(y=($=r.at(0))==null?void 0:$.at(0))!=null?y:""])-h}`,`M ${c},${o} H ${Number(n[(S=(w=r.at(1))==null?void 0:w.at(-1))!=null?S:""])+h}`],f=m[0].filter(M=>!["linestart","lineend"].includes(M)),p=Object.values(x).filter(M=>![M.from,M.to].every(k=>f.includes(k))).map(M=>M.colors);return e(F,{children:r.map((M,k)=>{var N,z,I;return v(H.Fragment,{children:[p.filter((E,B,A)=>B===A.findIndex(W=>{var D,P;return((D=W.at(0))==null?void 0:D.at(2))===((P=E.at(0))==null?void 0:P.at(2))})).map(E=>e("marker",{id:`arrow_theme_${E[0][2]}`,refX:1,refY:.5,children:e("path",{d:"M0,1H2L1,0z",fill:E[0][2]})},E[0][2])),e("path",{stroke:(I=(z=(N=p.at(k))==null?void 0:N.at(0))==null?void 0:z.at(2))!=null?I:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:g[k],markerEnd:l===L.RailMap&&(_==="l"&&k===0||_==="r"&&k===1)?p.at(k)?`url(#arrow_theme_${p[k][0][2]})`:"url(#arrow_theme)":void 0}),M.filter(E=>!["linestart","lineend"].includes(E)).map(E=>{var B,A,W,D;return v(H.Fragment,{children:[l===L.RailMap&&e("g",{transform:`translate(${n[E]},${i[E]})`,children:e(J,{stnId:E,stnState:u===E?0:1,bank:0,direction:_,color:(A=(B=p.at(k))==null?void 0:B.at(0))==null?void 0:A.at(2)})},E),l===L.Indoor&&e("g",{transform:`translate(${n[E]},${i[E]})`,children:e(K,{stnId:E,nameDirection:r.filter(P=>P.includes(E)).map(P=>P.indexOf(E)%2===0?"downward":"upward")[0],services:[T.local],color:(D=(W=p.at(k))==null?void 0:W.at(0))==null?void 0:D.at(2)})},E)]},E)})]},M.at(0))})})},dt=s=>{var p;const{edges:r,loop_stns:t,xs:n,ys:i,canvas:l}=s,[a,c,o,d]=r,{info_panel_type:m,stn_list:u,coline:_}=b($=>$.param),{branches:x}=b($=>$.helper),h=Object.values(_).filter($=>[$.from,$.to].every(y=>x.slice(1,3).filter(w=>U(w,u)).flat().includes(y))).map($=>$.colors).at(0),g=12,f=l===L.RailMap&&m==="sh2020"?3:0;return v("g",{id:"coline_main",children:[e("path",{d:`M ${a},${o} H${c}`,strokeWidth:12,stroke:(p=h==null?void 0:h.at(0))==null?void 0:p.at(2)}),l===L.RailMap&&Object.keys(_).length>0&&t.top.map($=>{var y;return e("g",{transform:`translate(${n[$]},${i[$]})`,children:m==="sh2020"?v(F,{children:[e("rect",{stroke:"none",height:24,width:12,x:-6,y:-f-1,fill:(y=h==null?void 0:h.at(0))==null?void 0:y.at(2)}),e("rect",{stroke:"none",height:f+g,width:12,x:-6,y:g-2,fill:"var(--rmg-theme-colour)"})]}):e("use",{xlinkHref:"#int2_sh",stroke:"var(--rmg-theme-colour)",transform:`translate(0,${1+g})`})},$)})]})},xe=s=>{var te;const{bank_angle:r,canvas:t}=s,{branches:n}=b(O=>O.helper),{current_stn_idx:i,svgWidth:l,svg_height:a,padding:c,branchSpacingPct:o,direction:d,info_panel_type:m,stn_list:u,loop_info:{left_and_right_factor:_,bottom_factor:x},coline:h}=b(O=>O.param),g=n[0].filter(O=>!["linestart","lineend"].includes(O)),f=n.slice(0,3).flat().filter((O=>C=>(O[C]=(O[C]||0)+1)===2)({})).filter(O=>!["linestart","lineend"].includes(O)),p=(te=Object.values(h).filter(O=>[O.from,O.to].every(C=>n.slice(1,3).filter(Y=>U(Y,u)).flat().includes(C))).map(O=>{const C=g.findIndex(q=>q===O.from),Y=g.findIndex(q=>q===O.to);return Math.abs(Y-C)>g.length-2-Math.abs(Y-C)?"major":"minor"}).at(0))!=null?te:"minor",$=f.at(1)?ye(g,f,_,p):f.at(0)?ge(g,f[0],x,_):ve(g,i,x,_),{x_shares:y,y_shares:w}=Se(g,$),{loop_branches:S,line_xs_branches:M,xs_branches:k}=ct(n,f,l[t],c,_,$.bottom.length),N={...w,...Object.fromEntries(S.flat().map(O=>[O,0]))},z=o*a/300,I=[225+z,a-75-(t===L.RailMap?0:125)-z],E=Object.keys(N).reduce((O,C)=>({...O,[C]:I[0]+N[C]*(I[1]-I[0])}),{}),B=[Math.max(l[t]*c/100+(r&&t===L.RailMap?100:0),M[0]),Math.min(l[t]*(1-c/100)-(r&&t===L.RailMap?100:0),M[1])],A=Object.keys(y).reduce((O,C)=>({...O,[C]:B[0]+y[C]*(B[1]-B[0])}),{}),W=r?{l:1,r:-1}[d]:0;[...$.right,...$.left].forEach(O=>{A[O]-=(E[O]-I[0])*W}),$.bottom.forEach(O=>{A[O]-=(I[1]-I[0])*W});const D={...k,...A},P=mt($,D,E,W,[...B,...I],d),Q=12,ee=t===L.RailMap&&m==="sh2020"?3:0;Object.keys(h).length>0&&$.top.forEach(O=>{E[O]-=ee+Q});const $e=S.length?0:(I[1]-I[0])*W/2;return v("g",{id:"loop",transform:`translate(${$e},0)`,children:[e("path",{stroke:"var(--rmg-theme-colour)",strokeWidth:12,fill:"none",d:P,strokeLinejoin:"round"}),t===L.RailMap&&e(oe,{canvas:t,loop_stns:$,xs:D,ys:E}),v("g",{transform:`translate(0,${Object.keys(h).length>0?-Q-ee:0})`,children:[e(ht,{loop_branches:S,edges:[...B,...I],xs:D,ys:E,canvas:t}),Object.keys(h).length>0&&e(dt,{edges:[...B,...I],loop_stns:$,xs:D,ys:E,canvas:t})]}),t===L.Indoor&&e(oe,{canvas:t,loop_stns:$,xs:D,ys:E})]})},mt=(s,r,t,n,i,l)=>{const[a,c,o,d]=i,m=(x,h,g,f,p)=>({right:[g+(f-o)*n,h],bottom:[x-(d-h)*n,f],left:[g-(d-f)*n,h],top:[x+(h-o)*n,f]})[p],u=[];s.top.forEach(x=>{u.push([r[x],t[x]])}),["right","bottom","left"].forEach(x=>{if(s[x].length>0)u.push(m(u.at(-1)[0],u.at(-1)[1],r[s[x][0]],t[s[x][0]],x)),s[x].forEach(h=>{u.push([r[h],t[h]])});else{const h={right:[c,u.at(-1)[1]],bottom:[u.at(-1)[0]+(d-u.at(-1)[1])*-n,u.at(-1)[1]+(d-u.at(-1)[1])],left:[a+(n===0?0:(d-o)*(l==="l"?-1:1)),u.at(-1)[1]]};u.push(h[x])}}),u.push(m(u.at(-1)[0],u.at(-1)[1],r[s.top[0]],t[s.top[0]],"top"));const _=u.slice(1).map(([x,h])=>`L${x},${h} `).join(" ");return`M${u[0][0]},${u[0][1]} ${_} Z`},oe=s=>{const{canvas:r,loop_stns:t,xs:n,ys:i}=s,{current_stn_idx:l}=b(d=>d.param),a={top:0,bottom:0,left:-1,right:1},c={left:"r",right:"l",top:void 0,bottom:void 0},o=(d,m)=>({top:m%2===0?"upward":"downward",bottom:m%2===0?"upward":"downward",left:"left",right:"right"})[d];return v("g",{id:"loop_stations",children:[r===L.RailMap&&Object.entries(t).map(([d,m])=>m.map(u=>e("g",{transform:`translate(${n[u]},${i[u]})`,children:e(J,{stnId:u,stnState:l===u?0:1,bank:a[d],direction:c[d]})},u))),r===L.Indoor&&Object.entries(t).map(([d,m])=>m.map((u,_)=>e("g",{transform:`translate(${n[u]},${i[u]})`,children:e(K,{stnId:u,nameDirection:o(d,_),services:[T.local]})},u)))]})},ce=L.RailMap;function ut(){const{canvasScale:s}=b(c=>c.app),{svgWidth:r,svg_height:t,theme:n,loop:i,loop_info:{bank:l}}=b(c=>c.param),a=r[ce];return v(Z,{type:ce,svgWidth:a,svgHeight:t,canvasScale:s,theme:n,children:[e(ft,{}),i?e(xe,{bank_angle:l,canvas:L.RailMap}):e(Qe,{}),e(rt,{})]})}const ft=j.exports.memo(()=>v("defs",{children:[e("circle",{id:"stn_sh",fill:"var(--rmg-white)",strokeWidth:2,r:5}),e("path",{id:"int2_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"express_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"direct_sh",fill:"var(--rmg-white)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V50 a 5,5 0 1 1 -10,0Z"}),e("rect",{id:"stn_sh_2020",stroke:"none",height:24,width:12,x:-6,y:-18}),e("rect",{id:"stn_sh_2020_express",stroke:"none",height:49,width:12,x:-6,y:-18}),e("rect",{id:"stn_sh_2020_direct",stroke:"none",height:74,width:12,x:-6,y:-18}),e("rect",{id:"intbox_number",height:22,width:20,y:-11}),v("g",{id:"intbox_maglev",transform:"translate(-25,0)",children:[e("rect",{id:"maglev_5",height:144,width:130,y:"40",x:"30",strokeWidth:10}),e("path",{id:"maglev_3",fill:"var(--rmg-white)",d:"m90,55a40,5 0 0 0 -40,3a5,5 0 0 0 -5,5a5,60 0 0 0 -3,60a5,5 0 0 0 5,5l96,0a5,5 0 0 0 5,-5a5,60 0 0 0 -3,-60a5,5 0 0 0 -5,-5a40,5 0 0 0 -40,-3l-5,-10l-5,10"}),e("path",{id:"maglev_4",fill:"var(--rmg-white)",d:"m90,140l-40,0a10,5 0 0 1 -10,-5l0,25a10,15 0 0 0 10,15l15,0l0,-10l-15,0l0,-15l90,0l0,15l-15,0l0,10l15,0a10,15 0 0 0 10,-15l0,-25a10,5 0 0 1 -10,5l-50,0"}),e("rect",{id:"maglev_1",height:"25",width:"40",y:"80",x:"50"}),e("rect",{id:"maglev_2",height:"25",width:"40",y:"80",x:"100"})]}),v("g",{id:"airport",transform:"scale(0.5)",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),e("path",{id:"airport",d:"M28.9769,6.60134c1.711.013,3.111,2.53205,3.111,4.241v10.337s17.106,15.435,17.358,15.666a1.145,1.145,0,0,1,.488,1.152v2.833c0,.651-.451.61-.695.467-.334-.119-17.151-8.863-17.151-8.863-.004,1.458-.797,9.006-1.326,13.304,0,0,4.61,2.457,4.699,2.521.334.268.352.359.352.852v2.001c0,.477-.352.428-.51.324-.183-.062-5.693-1.921-5.693-1.921a2.56018,2.56018,0,0,0-.633-.127,2.31654,2.31654,0,0,0-.666.127s-5.477,1.859-5.672,1.921c-.185.104-.523.153-.523-.324v-2.001c0-.493.029-.584.367-.852.086-.064,4.678-2.521,4.678-2.521-.524-4.298-1.307-11.846-1.325-13.304,0,0-16.822,8.744-17.148,8.863-.217.143-.69.184-.69-.467v-2.833a1.16206,1.16206,0,0,1,.473-1.152c.276-.231,17.365-15.666,17.365-15.666v-10.337c0-1.709,1.403-4.228,3.14105-4.241",transform:"translate(-28.9697,0.14347)",fill:"var(--rmg-white)"})]}),v("g",{id:"disney",transform:"scale(0.5)",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)"}),e("path",{fill:"var(--rmg-white)",d:"M45.6152,7.85015a9.80248,9.80248,0,0,0-9.79907,9.801,9.70059,9.70059,0,0,0,.342,2.582c.002.026.002.055.002.093a.31815.31815,0,0,1-.31494.318.67741.67741,0,0,1-.12806-.02,15.71521,15.71521,0,0,0-13.498,0,.61.61,0,0,1-.122.02.31841.31841,0,0,1-.322-.318v-.067a9.62553,9.62553,0,0,0,.35608-2.608,9.803,9.803,0,1,0-9.797,9.8,10.10364,10.10364,0,0,0,2.308-.271h.05493a.31113.31113,0,0,1,.31409.318.32433.32433,0,0,1-.019.12,15.72588,15.72588,0,1,0,29.703,7.216,15.83676,15.83676,0,0,0-1.746-7.23.18417.18417,0,0,1-.0271-.106.31612.31612,0,0,1,.32007-.318h.057a10.15953,10.15953,0,0,0,2.316.271,9.80051,9.80051,0,0,0,0-19.601",transform:"translate(-28.9697 0.13398)"})]}),v("g",{id:"railway",children:[e("circle",{cx:"0",cy:"29.33899",r:"29.33899",fill:"var(--rmg-grey)",transform:"translate(0,-2)scale(0.5)"}),e("path",{fill:"var(--rmg-white)",d:"M169,273.5c0-19,14.7-34.8,33.7-36.3c18.9-1.5,38.1-2.2,57.4-2.2c19.3,0,38.4,0.8,57.3,2.2  c19,1.5,33.7,17.3,33.7,36.3v47.3l-51.3,14.7c-11.2,3.2-18.9,13.4-18.9,25v147.8c0,17.4,12.2,32.3,29.3,35.7l110.6,22.1  c4.9,1,8.4,5.2,8.4,10.2V599H91v-22.7c0-5,3.5-9.2,8.4-10.2L209.9,544c17-3.4,29.3-18.3,29.3-35.7V360.5c0-11.6-7.7-21.8-18.9-25  L169,320.8V273.5z M309.4,31.7c0.2-1.2,0.3-2.4,0.3-3.6c0-14-11.1-25.4-24.9-26C276.6,1.4,268.3,1,260,1c-8.3,0-16.6,0.4-24.7,1.1  c-13.9,0.6-24.9,12-24.9,26c0,1.2,0.1,2.5,0.3,3.6C90.6,54.8,0,160.3,0,287c0,97.2,53.4,182,132.4,226.6l36.8-48.1  C104.3,432.4,59.8,364.9,59.8,287c0-110.6,89.6-200.2,200.2-200.2S460.2,176.4,460.2,287c0,77.9-44.5,145.4-109.4,178.5  c15,19.6,25.6,33.5,36.8,48.1C466.6,469,520,384.2,520,287C520,160.3,429.4,54.8,309.4,31.7z",transform:"translate(-10,0)scale(0.04)"})]}),e("marker",{id:"arrow_gray",viewBox:"-1.5 0 3 1.5",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-grey)"})}),e("marker",{id:"arrow_theme_left",refX:1,refY:.5,children:e("path",{d:"M1,0L0,1H1z",fill:"var(--rmg-theme-colour)"})}),e("marker",{id:"arrow_theme_right",refY:.5,children:e("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),e("marker",{id:"arrow_theme",refX:1,refY:.5,children:e("path",{d:"M0,1H2L1,0z",fill:"var(--rmg-theme-colour)"})}),e("filter",{id:"contrast-direct",filterUnits:"userSpaceOnUse",children:v("feComponentTransfer",{children:[e("feFuncR",{type:"linear",slope:.5,intercept:.25}),e("feFuncG",{type:"linear",slope:.5,intercept:.25}),e("feFuncB",{type:"linear",slope:.5,intercept:.25})]})}),e("filter",{id:"contrast-express",filterUnits:"userSpaceOnUse",children:v("feComponentTransfer",{children:[e("feFuncR",{type:"linear",slope:.75,intercept:.125}),e("feFuncG",{type:"linear",slope:.75,intercept:.125}),e("feFuncB",{type:"linear",slope:.75,intercept:.125})]})}),v("filter",{id:"pujiang_outline_railmap",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[v("feComponentTransfer",{in:"SourceGraphic",children:[e("feFuncR",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),e("feFuncG",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}),e("feFuncB",{type:"discrete",tableValues:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"})]}),e("feColorMatrix",{type:"matrix",values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 1 1 1 1 -3",result:"selectedColor1"}),e("feMorphology",{operator:"erode",in:"selectedColor1",radius:"0",result:"e1"}),e("feMorphology",{operator:"erode",in:"selectedColor1",radius:"1",result:"e2"}),e("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"uncoloredOutline"}),e("feFlood",{floodColor:"rgb(0,0,0)"}),e("feComposite",{operator:"in",in2:"uncoloredOutline",result:"outline"}),e("feComposite",{in:"outline",in2:"selectedColor1",operator:"over",result:"result"}),e("feComposite",{in:"result",in2:"SourceGraphic",operator:"over"})]})]})),he=L.Indoor;function gt(){const{canvasScale:s}=b(a=>a.app),{svgWidth:r,svg_height:t,theme:n,loop:i}=b(a=>a.param),l=r[he];return v(Z,{type:he,svgWidth:l,svgHeight:t,canvasScale:s,theme:n,children:[e(pt,{}),i?e(xe,{bank_angle:!1,canvas:L.Indoor}):e($t,{}),e(St,{})]})}const pt=H.memo(()=>v("defs",{children:[e("circle",{id:"stn_indoor_sh",fill:"var(--rmg-white)",strokeWidth:5,r:8,transform:"scale(1.5)"}),e("path",{id:"int2_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"express_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V25 a 5,5 0 1 1 -10,0Z"}),e("path",{id:"direct_indoor_sh",fill:"var(--rmg-white)",transform:"translate(0, -10)scale(2)",strokeWidth:4,d:"M -5,0 a 5,5 0 1 1 10,0 V40 a 5,5 0 1 1 -10,0Z"})]})),_t=(s,r)=>{let t=0;return s[r].parents.length===2&&(t+=1),s[s[r].parents[0]].children.length===2&&(t+=1),t},xt=(s,r)=>{let t=0;return s[r].children.length===2&&(t+=1),s[s[r].children[0]].parents.length===2&&(t+=1),t},$t=()=>{const{routes:s,branches:r,depsStr:t}=b(f=>f.helper),n=b(f=>f.param),i=me(n.stn_list,_t,xt),l=V("linestart","lineend",i),a=V(l.nodes[1],l.nodes.slice(-2)[0],i),c=H.useMemo(()=>(console.log("computing x shares"),Object.keys(n.stn_list).reduce((f,p)=>({...f,[p]:ue(p,i,r)}),{})),[r.toString(),JSON.stringify(i)]),o=[n.svgWidth.indoor*n.padding/100,n.svgWidth.indoor*(1-n.padding/100)],d=Object.keys(c).reduce((f,p)=>({...f,[p]:o[0]+c[p]/a.len*(o[1]-o[0])}),{}),m=j.exports.useMemo(()=>re.getYShares(n.stn_list,r),[t]),u=Object.keys(m).reduce((f,p)=>({...f,[p]:m[p]*n.branchSpacingPct*n.svg_height/200}),{}),_=H.useMemo(()=>fe(n.current_stn_idx,s,n.direction),[n.current_stn_idx,n.direction,s.toString()]),x=Object.values(T),h=Object.values(n.stn_list).map(f=>f.services).flat().reduce((f,p)=>(f[x.indexOf(p)]=!0,f),[!1,!1,!1]).map((f,p)=>[x[p],f]).filter(f=>f[1]).map(f=>f[0]),g=re.drawLine(r,_,n.stn_list,o,d,u,n.branchSpacingPct*n.svg_height/200,l,0);return v("g",{id:"main",transform:`translate(0,${n.svg_height/2})`,children:[e(vt,{paths:g,services:h}),e(yt,{xs:d,ys:u,services:h})]})},vt=s=>e("g",{fill:"none",strokeWidth:12,stroke:"var(--rmg-theme-colour)",children:s.services.map((r,t)=>v("g",{transform:`translate(0, ${t*30})`,children:[s.paths.main.map((n,i)=>e("path",{d:n},i)),s.paths.pass.map((n,i)=>e("path",{d:n},i))]},`indoor_line_${t}`))}),yt=s=>{const{branches:r}=b(a=>a.helper),t=b(a=>a.param),{xs:n,ys:i,services:l}=s;return e("g",{children:Object.keys(t.stn_list).filter(a=>!["linestart","lineend"].includes(a)).filter(a=>t.stn_list[a].services.length!==0).map(a=>e("g",{transform:`translate(${n[a]},${i[a]})`,children:e(K,{stnId:a,nameDirection:r.filter(c=>c.includes(a)).map(c=>c.indexOf(a)%2===0||l.length>1?"downward":"upward")[0],services:l})},a))})},St=()=>{const s=b(r=>r.param);return H.useMemo(()=>v(F,{children:[e("g",{transform:`translate(${s.svgWidth.indoor/2},50)`,children:v("text",{textAnchor:"middle",fontSize:"30",className:"rmg-name__zh",children:["\u8F68\u9053\u4EA4\u901A",s.line_name[0],"\u8FD0\u8425\u7EBF\u8DEF\u793A\u610F\u56FE"]})}),v("g",{transform:`translate(${s.svgWidth.indoor/2},${s.svg_height-270})`,children:[e("text",{textAnchor:"middle",fontSize:"18",className:"rmg-name__zh",dx:"-30",dy:"230",children:"\u53CB\u60C5\u63D0\u793A\uFF1A\u8BF7\u7559\u610F\u60A8\u9700\u8981\u6362\u4E58\u7EBF\u8DEF\u7684\u9996\u672B\u73ED\u65F6\u95F4\uFF0C\u4EE5\u514D\u803D\u8BEF\u60A8\u7684\u51FA\u884C\uFF0C\u672B\u73ED\u8F66\u8FDB\u7AD9\u524D\u4E09\u5206\u949F\u505C\u552E\u8BE5\u672B\u73ED\u8F66\u8F66\u7968\u3002"}),e("text",{textAnchor:"middle",fontSize:"12",className:"rmg-name__en",dx:"10",dy:"250",children:"Please pay attention to the interchange schedule if you want to transfer to other lines. Stop selling tickets 3 minutes before the last train services."}),v("g",{transform:"translate(-600,215)",children:[e("rect",{x:"-5",y:"-25",width:"100",height:"70",fill:"none",stroke:"black",rx:"5"}),e("line",{x1:"28",x2:"28",y1:"-20",y2:"40",stroke:"black"}),e("text",{className:"rmg-name__zh",dx:"3",fontSize:"18",children:"\u56FE"}),e("text",{className:"rmg-name__zh",dx:"3",dy:"18",fontSize:"18",children:"\u4F8B"}),e("text",{className:"rmg-name__en",dy:"35",fontSize:"8",children:"legend"}),e("use",{transform:"translate(45,10)",xlinkHref:"#int2_indoor_sh",stroke:"var(--rmg-theme-colour)"}),e("text",{className:"rmg-name__zh",dx:"60",dy:"10",fontSize:"10",children:"\u6362\u4E58\u7AD9"}),e("text",{className:"rmg-name__en",dx:"60",dy:"20",fontSize:"6",children:"Interchange"}),e("text",{className:"rmg-name__en",dx:"60",dy:"30",fontSize:"6",children:"Station"})]})]})]}),[s.svgWidth.indoor,s.svg_height,s.line_name])},Ht={destination:e(we,{}),runin:e(Ie,{}),railmap:e(ut,{}),indoor:e(gt,{})};export{Ht as default};
