var I=Object.defineProperty;var c=(l,n,i)=>n in l?I(l,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[n]=i;var _=(l,n,i)=>(c(l,typeof n!="symbol"?n+"":n,i),i);import{d as T}from"./share.66d98256.js";const $=(l,n,i)=>{const r=n[0];if(r.includes(l)){if(n.slice(1).find(e=>e.includes(l)))return 0;{const e=n.slice(1).find(f=>{const R=f[0]==="linestart",t=r.indexOf(l)<r.indexOf(f.slice(-1)[0]),a=f.slice(-1)[0]==="lineend",o=r.indexOf(l)>r.indexOf(f[0]);return R&&t||a&&o});return e?i[e[0]].children.indexOf(e[1])===1?-1:1:0}}else{const e=n.slice(1).find(f=>f.includes(l));return e?e[0]!=="linestart"&&e.slice(-1)[0]!=="lineend"?i[e[0]].children.indexOf(e[1])===1?1.2:-1.2:i[e[0]].children.indexOf(e[1])===1?1:-1:0}},p=l=>{const i=`a${6},${6},0,0,1,${6},${6}`,r=`a${6},${6},0,0,0,${6},${6}`,e=`a${6},${6},0,0,0,${6},-${6}`,f=`a${6},${6},0,0,1,${6},-${6}`;let R,t=[];for(let a of l){if(!R)t.push("M"+a.join(","));else if(a[1]===R[1])t.push("H"+a[0]);else{const o=(a[0]+R[0])/2-(R[1]===0?0:12);t.push("H"+o),a[1]>R[1]?(t.push(i),t.push("V"+(a[1]-6)),t.push(r)):(t.push(e),t.push("V"+(a[1]+6)),t.push(f)),t.push("H"+a[0])}R=a}return t.join(" ").replace(/( H([\d.]+))+/g," H$2")},A=(l,n)=>{var i=0;let{transfer:r}=l[n],e=r.info.map(f=>f.length);return r.tick_direc==="l"&&(!e[1]&&e[0]>1&&(i+=.4),e[1]&&(e[0]!==1||e[1]!==2)&&(i+=.4)),e[0]===1&&e[1]===2&&l[n].parents[0]!=="linestart"&&l[n].children[0]!=="lineend"&&(i+=.8),l[n].parents.length===2&&(i+=.2),l[l[n].parents[0]].children.length===2&&(i+=.4),i},G=(l,n)=>{var i=0;let{transfer:r}=l[n],e=r.info.map(f=>f.length);return r.tick_direc==="r"&&(!e[1]&&e[0]>1&&(i+=.4),e[1]&&(e[0]!==1||e[1]!==2)&&(i+=.4)),e[0]===1&&e[1]===2&&l[n].parents[0]!=="linestart"&&l[n].children[0]!=="lineend"&&(i+=.8),l[n].children.length===2&&(i+=.2),l[l[n].children[0]].parents.length===2&&(i+=.4),i};class D extends T{constructor(){super(...arguments);_(this,"leftWideFactor",i=>A(this.stnList,i));_(this,"rightWideFactor",i=>G(this.stnList,i))}static drawLine(i,r,e,f,R,t,a,o,S=0){let h={main:[],pass:[],sidingMain:[],sidingPass:[]};return i.forEach((d,U)=>{const g=d[0]!=="linestart"&&d.slice(-1)[0]!=="lineend";d=d.filter(N=>!["linestart","lineend"].includes(N));var s=d.filter(N=>r[N]>=0),u=d.filter(N=>r[N]<=0);s.length===1&&(u=d),s.filter(N=>u.indexOf(N)!==-1).length===0&&s.length&&(u[0]===d[0]?u.push(s[0]):s[0]===d[0]&&s[s.length-1]===d[d.length-1]&&u.length?(u=d,s=[]):u.unshift(s[s.length-1])),g?(h.sidingMain.push(p(s.map(N=>[R[N],t[N]]))),h.sidingPass.push(p(u.map(N=>[R[N],t[N]])))):(h.main.push(new this({stnList:e,criticalPath:o})._linePath(s,f,i,R,t,a,o,S)),h.pass.push(new this({stnList:e,criticalPath:o})._linePath(u,f,i,R,t,a,o,S)))}),h}}class m extends D{static drawLine(n,i,r,e,f,R,t,a,o=0){let S={main:[],pass:[],sidingMain:[],sidingPass:[]};return n.forEach((h,d)=>{h=h.filter(s=>!["linestart","lineend"].includes(s));var U=h.filter(s=>i[s]>=0),g=h.filter(s=>i[s]<=0);U.length===1&&(g=h),U.filter(s=>g.indexOf(s)!==-1).length===0&&U.length&&(g[0]===h[0]?g.push(U[0]):U[0]===h[0]&&U[U.length-1]===h[h.length-1]&&g.length?(g=h,U=[]):g.unshift(U[U.length-1])),S.main.push(new this({stnList:r,criticalPath:a})._linePath(U,e,n,f,R,t,a,o)),S.pass.push(new this({stnList:r,criticalPath:a})._linePath(g,e,n,f,R,t,a,o))}),S}}export{D as S,m as a,$ as g,A as l,G as r};
