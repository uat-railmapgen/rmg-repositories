import{u as y,j as o,X as H,c as e,H as T,Y as _,F as I,Z as U,I as W,_ as V,e as O,G as C,$ as Y,a0 as E,a1 as j,a2 as B,a3 as R,a4 as N,a5 as P,a6 as q,a7 as $,a8 as K,a9 as X,aa as Z,ab as Q,ac as ee,ad as te,l as v,ae,af as ne,ag as se,ah as oe,ai as ie,D as le,W as re,aj as J,r as ce}from"./vendor-6b0abe8e.js";import{a as A,u as z,c as de,b as me,d as pe,A as G,e as ue,t as he,f as fe,g as ge,h as Ce,i as ye,r as be,j as ve,k as w,l as Se}from"./index-eb67161b.js";import{u as F,I as D,G as we,E as Ee}from"./constant-a6d14527.js";function Ne(){const{t:n,i18n:a}=y(),s=F(),c=A(),{company:t,newCompany:i,companyName:d}=z(l=>l.ticket),m={...de.map(l=>[l.id,s(l.name)]).sort((l,r)=>l[1].localeCompare(r[1],a.languages[0])).reduce((l,r)=>({...l,[r[0]]:r[1]}),{"":n("Please select...")}),new:n("Add a company...")},f=[{type:"select",label:n("Company"),value:t,options:m,disabledOptions:[""],onChange:l=>c(me(l))},{type:"input",label:n("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:i,onChange:l=>c(pe(l)),hidden:t!=="new"}],g=Object.entries(G).map(l=>{const r=l[0],u=l[1];return{type:"input",label:n(u),value:d[r],onChange:b=>c(ue({lang:r,name:b}))}});return o(H,{as:"section",children:[e(T,{as:"h5",size:"sm",mb:2,children:n("Railway company")}),o(_,{direction:"column",children:[e(I,{fields:f}),t==="new"&&e(I,{fields:g})]})]})}const Le=n=>new Promise(a=>{const s=new FileReader;s.onloadend=()=>a(s.result),s.readAsText(n)});function ke(n){const{company:a,templateEntry:s,onLineChange:c,onNewLineChange:t,onLineNameChange:i,onParamChange:d,onRemove:m}=n,{line:f,newLine:g,templateName:l}=s,{t:r}=y(),u=F(),b=async p=>{var L;const h=(L=p.target.files)==null?void 0:L[0];if(console.log("handleFileUpload():: received file",h),!!h){if(h.type!=="application/json"){alert("Invalid file type!"),p.target.value="";return}try{const k=await Le(h);d(JSON.parse(k))}catch(k){alert("Invalid file!"),p.target.value=""}}},x={"":r("Please select..."),...a===""||a==="new"?{}:he[a].reduce((p,h)=>({...p,[h.filename]:u(h.name)}),{}),new:r("Add a line...")},M=[{type:"select",label:r("Line"),value:f,options:x,disabledOptions:[""],onChange:p=>c(p),minW:150},{type:"custom",label:r("Configuration file"),component:e(U,{variant:"flushed",size:"xs",type:"file",accept:".json",onChange:b}),minW:250},{type:"input",label:r("Line code"),placeholder:"e.g. twl, gz1, sh1",value:g,onChange:p=>t(p),hidden:f!=="new"}],S=Object.entries(G).map(p=>{const h=p[0],L=p[1];return{type:"input",label:r(L),value:l[h],onChange:k=>i(h,k)}});return o(_,{position:"relative",direction:"column",children:[e(W,{size:"sm",variant:"ghost",icon:e(V,{}),"aria-label":r("Remove this line"),title:r("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:m}),e(I,{fields:[...M,...S],minW:110})]})}function Te(){const{t:n}=y(),a=A(),{company:s,templates:c}=z(t=>t.ticket);return o(H,{as:"section",mt:3,children:[e(T,{as:"h5",size:"sm",mb:2,children:n("Add or update templates")}),c.map(t=>e(ke,{company:s,templateEntry:t,onLineChange:i=>a(fe({id:t.id,line:i})),onNewLineChange:i=>a(ge({id:t.id,newLine:i})),onLineNameChange:(i,d)=>a(Ce({id:t.id,lang:i,name:d})),onParamChange:i=>a(ye({id:t.id,param:i})),onRemove:()=>a(be(t.id))},t.id)),e(O,{justifyContent:"flex-end",children:e(C,{variant:"ghost",size:"sm",leftIcon:e(Y,{}),onClick:()=>a(ve()),children:n("Add item")})})]})}function Ie(n){const{companyErrors:a,templateErrors:s,onClose:c}=n,{t}=y(),i=F();return o(E,{children:[o(j,{children:[e(B,{children:t("Your inputs contain the following errors. Please fix it before submitting.")}),a.length>0&&o(E,{children:[e(T,{as:"h5",size:"sm",my:2,children:t("Railway company")}),e(R,{"aria-label":"List of company errors",children:a.map((d,m)=>e(N,{children:i(D[d])},m))})]}),Object.values(s).flat().length>0&&o(E,{children:[e(T,{as:"h5",size:"sm",my:2,children:t("Templates")}),e(R,{"aria-label":"List of template errors",children:Object.entries(s).map(([d,m])=>o(N,{children:[d,e(R,{children:m.map((f,g)=>e(N,{children:i(D[f])},g))})]},d))})]})]}),e(P,{children:e(O,{children:e(C,{colorScheme:"primary",onClick:c,children:t("Go back")})})})]})}function xe(n){const{justification:a,onJustificationChange:s,onNext:c}=n,{t}=y(),i=[{type:"textarea",value:a,label:t("Justification"),placeholder:t("Briefly describe your changes and provide justification"),onChange:s}],d=!a;return o(E,{children:[o(j,{children:[e(B,{children:t("Please provide suitable source and justification.")}),e(I,{fields:i,minW:"full"})]}),e(P,{children:e(C,{colorScheme:"primary",onClick:c,rightIcon:e(q,{}),isDisabled:d,children:t("Next")})})]})}function Me(n){var u;const{companyName:a,companyBlock:s,templateBlocks:c,justification:t,onPrev:i,onClose:d}=n,{t:m}=y(),f=$("primary.500","primary.300"),g=[`**Justification:** ${t||"(REPLACE ME)"}`,we,(u=s==null?void 0:s.outerHTML)!=null?u:"",...c.map(b=>b.outerHTML)].join(`

`),l=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+a}),r=async()=>{await navigator.clipboard.writeText(g)};return o(E,{children:[o(j,{children:[e(B,{children:m("Follow the instructions below to open an Issue")+":"}),o(K,{children:[o(N,{children:[m("Open")," ",o(X,{color:f,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+l.toString(),isExternal:!0,children:["Issue: New Templates Request ",e(Z,{as:Q})]})]}),o(N,{children:[m("Click copy button and paste into issue body")," ",e(C,{size:"xs",leftIcon:e(ee,{}),onClick:r,children:m("Copy")})]})]})]}),o(P,{children:[e(C,{variant:"ghost",onClick:i,mr:"auto",leftIcon:e(te,{}),children:m("Previous")}),e(C,{colorScheme:"primary",onClick:d,children:m("Close")})]})]})}function Re(n){const{isOpen:a,onClose:s}=n,{t:c}=y(),[t,i]=v.useState([]),[d,m]=v.useState({}),[f,g]=v.useState(""),[l,r]=v.useState(!1),u=z(h=>h.ticket),b=w.getCompanyEnglishName(u),x=w.getCompanyBlock(u),M=w.getTemplateBlocks(u);v.useEffect(()=>{a?(i(w.getCompanyErrors(u)),m(w.getTemplateErrors(u))):(g(""),r(!1))},[a]);const S=t.length>0||Object.values(d).flat().length>0,p=!S&&!l;return o(ae,{blockScrollOnMount:!1,isOpen:a,onClose:s,scrollBehavior:"inside",children:[e(ne,{}),o(se,{children:[e(oe,{children:c("Submit templates")}),e(ie,{}),S&&e(Ie,{companyErrors:t,templateErrors:d,onClose:s}),p&&e(xe,{justification:f,onJustificationChange:g,onNext:()=>r(!0)}),!S&&l&&e(Me,{companyName:b,companyBlock:x,templateBlocks:M,justification:f,onPrev:()=>r(!1),onClose:s})]})]})}const Oe={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function Ae(){const{t:n}=y(),a=le(),s=A(),[c,t]=v.useState(!1),i=()=>{s(Se()),ce.event(Ee.RESET_TICKETS,{})};return o(re,{sx:Oe,children:[o(J,{children:[e(Ne,{}),e(Te,{})]}),o(J,{children:[e(C,{size:"sm",onClick:()=>a("/"),children:n("Go back")}),o(O,{ml:"auto",children:[e(C,{size:"sm",variant:"outline",onClick:i,children:n("Reset")}),e(C,{size:"sm",colorScheme:"primary",onClick:()=>t(!0),children:n("Submit")})]})]}),e(Re,{isOpen:c,onClose:()=>t(!1)})]})}export{Ae as default};
