import{u as S,j as i,X as _,c as e,H as T,Y as G,F as I,Z as q,I as V,_ as Y,$ as B,a0 as K,a1 as W,a2 as X,e as F,G as b,a3 as Z,a4 as E,a5 as J,a6 as P,a7 as R,a8 as L,a9 as A,aa as Q,ab as ee,ac as ae,ad as te,ae as ne,af as oe,ag as se,l as w,ah as ie,ai as le,aj as re,ak as ce,al as de,D as me,W as pe,r as ue}from"./vendor-9c78b6cc.js";import{a as U,u as z,c as he,b as fe,d as ge,A as $,e as Ce,t as ye,f as be,g as je,h as ve,i as Se,j as we,r as Me,k as Ne,l as M,m as ke}from"./index-5e740293.js";import{u as H,I as D,G as Ee,E as Le}from"./constant-47064d77.js";function Te(){const{t:o,i18n:t}=S(),s=H(),d=U(),{company:a,newCompany:l,companyName:r}=z(n=>n.ticket),g={...he.map(n=>[n.id,s(n.name)]).sort((n,p)=>n[1].localeCompare(p[1],t.languages[0])).reduce((n,p)=>({...n,[p[0]]:p[1]}),{"":o("Please select...")}),new:o("Add a company...")},m=[{type:"select",label:o("Company"),value:a,options:g,disabledOptions:[""],onChange:n=>d(fe(n))},{type:"input",label:o("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:l,onChange:n=>d(ge(n)),hidden:a!=="new"}],f=Object.entries($).map(n=>{const p=n[0],y=n[1];return{type:"input",label:o(y),value:r[p],onChange:c=>d(Ce({lang:p,name:c}))}});return i(_,{as:"section",children:[e(T,{as:"h5",size:"sm",mb:2,children:o("Railway company")}),i(G,{direction:"column",children:[e(I,{fields:m}),a==="new"&&e(I,{fields:f})]})]})}const Ie=o=>new Promise(t=>{const s=new FileReader;s.onloadend=()=>t(s.result),s.readAsText(o)});function xe(o){const{company:t,templateEntry:s,onLineChange:d,onNewLineChange:a,onMajorFlagChange:l,onLineNameChange:r,onParamChange:g,onRemove:m}=o,{line:f,newLine:n,majorUpdate:p,templateName:y}=s,{t:c}=S(),C=H(),N=async u=>{var j;const h=(j=u.target.files)==null?void 0:j[0];if(console.log("handleFileUpload():: received file",h),!!h){if(h.type!=="application/json"){alert("Invalid file type!"),u.target.value="";return}try{const v=await Ie(h);g(JSON.parse(v))}catch(v){alert("Invalid file!"),u.target.value=""}}},x={"":c("Please select..."),...t===""||t==="new"?{}:ye[t].reduce((u,h)=>({...u,[h.filename]:C(h.name)}),{}),new:c("Add a line...")},O=[{type:"select",label:c("Line"),value:f,options:x,disabledOptions:[""],onChange:u=>d(u),minW:150},{type:"custom",label:c("Configuration file"),component:e(q,{variant:"flushed",size:"xs",type:"file",accept:".json",onChange:N}),minW:250},{type:"input",label:c("Line code"),placeholder:"e.g. twl, gz1, sh1",value:n,onChange:u=>a(u),hidden:f!=="new"},{type:"switch",label:c("Major update"),isChecked:p,onChange:u=>l(u),hidden:f==="new",oneLine:!0}],k=Object.entries($).map(u=>{const h=u[0],j=u[1];return{type:"input",label:c(j),value:y[h],onChange:v=>r(h,v)}});return i(G,{position:"relative",direction:"column",children:[e(V,{size:"sm",variant:"ghost",icon:e(Y,{}),"aria-label":c("Remove this line"),title:c("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:m}),e(I,{fields:[...O,...k],minW:110})]})}function Oe(){const{t:o}=S(),t=U(),{company:s,templates:d}=z(a=>a.ticket);return i(_,{as:"section",mt:3,children:[i(B,{children:[e(T,{as:"h5",size:"sm",mb:2,children:o("Add or update templates")}),e(K,{hasArrow:!0,label:o("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:e("span",{children:e(W,{as:X,ml:1})})})]}),d.map(a=>e(xe,{company:s,templateEntry:a,onLineChange:l=>t(be({id:a.id,line:l})),onNewLineChange:l=>t(je({id:a.id,newLine:l})),onMajorFlagChange:l=>t(ve({id:a.id,majorUpdate:l})),onLineNameChange:(l,r)=>t(Se({id:a.id,lang:l,name:r})),onParamChange:l=>t(we({id:a.id,param:l})),onRemove:()=>t(Me(a.id))},a.id)),e(F,{justifyContent:"flex-end",children:e(b,{variant:"ghost",size:"sm",leftIcon:e(Z,{}),onClick:()=>t(Ne()),children:o("Add item")})})]})}function Re(o){const{companyErrors:t,templateErrors:s,onClose:d}=o,{t:a}=S(),l=H();return i(E,{children:[i(J,{children:[e(P,{children:a("Your inputs contain the following errors. Please fix it before submitting.")}),t.length>0&&i(E,{children:[e(T,{as:"h5",size:"sm",my:2,children:a("Railway company")}),e(R,{"aria-label":"List of company errors",children:t.map((r,g)=>e(L,{children:l(D[r])},g))})]}),Object.values(s).flat().length>0&&i(E,{children:[e(T,{as:"h5",size:"sm",my:2,children:a("Templates")}),e(R,{"aria-label":"List of template errors",children:Object.entries(s).map(([r,g])=>i(L,{children:[r,e(R,{children:g.map((m,f)=>e(L,{children:l(D[m])},f))})]},r))})]})]}),e(A,{children:e(F,{children:e(b,{colorScheme:"primary",onClick:d,children:a("Go back")})})})]})}function Be(o){const{justification:t,majorUpdateJustifications:s,onJustificationChange:d,onMajorUpdateJustificationChange:a,onNext:l}=o,{t:r}=S(),g=[{type:"textarea",value:t,label:r("Justification"),placeholder:r("Briefly describe your changes and provide justification"),onChange:d}],m=Object.entries(s).map(([n,p])=>({type:"textarea",value:p,label:r("Justification for major update of")+" "+n,placeholder:r("Briefly describe your changes and provide justification"),onChange:y=>a(n,y)})),f=!t||Object.values(s).some(n=>!n);return i(E,{children:[i(J,{children:[e(P,{children:r("Please provide suitable source and justification.")}),e(I,{fields:[...g,...m],minW:"full"})]}),e(A,{children:e(b,{colorScheme:"primary",onClick:l,rightIcon:e(Q,{}),isDisabled:f,children:r("Next")})})]})}function Fe(o){var c;const{companyName:t,companyBlock:s,templateBlocks:d,justification:a,majorUpdateJustifications:l,onPrev:r,onClose:g}=o,{t:m}=S(),f=ee("primary.500","primary.300"),n=[`**Justification:** ${a||"(REPLACE ME)"}`,Object.entries(l).map(([C,N])=>`- Major update of ${C}: ${N}`).join(`
`),Ee,(c=s==null?void 0:s.outerHTML)!=null?c:"",...d.map(C=>C.outerHTML)].join(`

`),p=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+t}),y=async()=>{await navigator.clipboard.writeText(n)};return i(E,{children:[i(J,{children:[e(P,{children:m("Follow the instructions below to open an Issue")+":"}),i(ae,{children:[i(L,{children:[m("Open")," ",i(te,{color:f,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+p.toString(),isExternal:!0,children:["Issue: New Templates Request ",e(W,{as:ne})]})]}),i(L,{children:[m("Click copy button and paste into issue body")," ",e(b,{size:"xs",leftIcon:e(oe,{}),onClick:y,children:m("Copy")})]})]})]}),i(A,{children:[e(b,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e(se,{}),children:m("Previous")}),e(b,{colorScheme:"primary",onClick:g,children:m("Close")})]})]})}function Je(o){const{isOpen:t,onClose:s}=o,{t:d}=S(),[a,l]=w.useState([]),[r,g]=w.useState({}),[m,f]=w.useState(""),[n,p]=w.useState({}),[y,c]=w.useState(!1),C=z(h=>h.ticket),N=M.getCompanyEnglishName(C),x=M.getCompanyBlock(C),O=M.getTemplateBlocks(C);w.useEffect(()=>{if(t){l(M.getCompanyErrors(C)),g(M.getTemplateErrors(C));const h=M.getMajorUpdateNames(C).reduce((j,v)=>({...j,[v]:""}),{});p(h)}else f(""),p({}),c(!1)},[t]);const k=a.length>0||Object.values(r).flat().length>0,u=!k&&!y;return i(ie,{blockScrollOnMount:!1,isOpen:t,onClose:s,scrollBehavior:"inside",children:[e(le,{}),i(re,{children:[e(ce,{children:d("Submit templates")}),e(de,{}),k&&e(Re,{companyErrors:a,templateErrors:r,onClose:s}),u&&e(Be,{justification:m,majorUpdateJustifications:n,onJustificationChange:f,onMajorUpdateJustificationChange:(h,j)=>p(v=>({...v,[h]:j})),onNext:()=>c(!0)}),!k&&y&&e(Fe,{companyName:N,companyBlock:x,templateBlocks:O,justification:m,majorUpdateJustifications:n,onPrev:()=>c(!1),onClose:s})]})]})}const Pe={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function He(){const{t:o}=S(),t=me(),s=U(),[d,a]=w.useState(!1),l=()=>{s(ke()),ue.event(Le.RESET_TICKETS,{})};return i(pe,{sx:Pe,children:[i(B,{children:[e(Te,{}),e(Oe,{})]}),i(B,{children:[e(b,{size:"sm",onClick:()=>t("/"),children:o("Go back")}),i(F,{ml:"auto",children:[e(b,{size:"sm",variant:"outline",onClick:l,children:o("Reset")}),e(b,{size:"sm",colorScheme:"primary",onClick:()=>a(!0),children:o("Submit")})]})]}),e(Je,{isOpen:d,onClose:()=>a(!1)})]})}export{He as default};
