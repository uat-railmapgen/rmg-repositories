import{j as t,a6 as W,a7 as $,a8 as D,a9 as B,aa as I,ab as M,ac as A,ad as N,$ as H,i as L}from"./chakra-30b94965.js";import{g as F,Y as v,Z as w,c as O,M as j,d as _,b as V,r as S,E as b,j as z}from"./index-df985c67.js";import{u as P,r as m,n as T}from"./react-326f1873.js";function U(d){const{countryCode:n,svgFilename:r}=d;return r?t.jsx(W,{src:`/rmg-palette/resources/flags/${r.slice(0,-4)}.svg`,alt:`Flag of ${n}`,h:17,mr:1}):t.jsx(t.Fragment,{})}function X(d){const{defaultValueId:n,onChange:r}=d,{i18n:l}=P(),u=n?F.find(o=>o.id===n):void 0,c=o=>{var e,s;return(s=(e=l.languages.map(a=>o.name[a]).find(a=>a!==void 0))!=null?e:o.name.en)!=null?s:""},g=o=>{var y,E;const e=o.country==="TW"&&["zh-Hans","zh-CN"].includes(l.languages[0]),s=["Win32","Win64"].includes(navigator.platform),a=l.languages.map(h=>o.name[h]).find(h=>h!==void 0),C=(y=O.find(h=>h.id===o.country))==null?void 0:y.flagSvg,x=(E=O.find(h=>h.id===o.country))==null?void 0:E.flagEmoji;return t.jsxs(t.Fragment,{children:[e?t.jsx("span",{children:"🏴 "}):s?t.jsx(U,{countryCode:o.country,svgFilename:C}):t.jsxs("span",{children:[x," "]}),a]})},i=(o,e)=>Object.values(o.name).some(s=>s.includes(e)),p=F.slice().sort((o,e)=>o.id===v.Other?1:e.id===v.Other?-1:c(o).localeCompare(c(e),l.languages[0]));return t.jsx(w,{data:p,displayValue:c,displayHandler:g,predicate:i,defaultValue:u,onChange:o=>r==null?void 0:r(o.id)})}const Y=d=>{const[n,r]=m.useState([]);return m.useEffect(()=>{const l=new AbortController;return fetch(`/rmg-palette/resources/palettes/${d}.json`,{signal:l.signal}).then(u=>u.json()).then(u=>r(u)).catch(()=>r([])),()=>{l.abort()}},[d]),n};function Z(d){const{city:n,defaultValueId:r,onChange:l}=d,{i18n:u}=P(),c=Y(n),g=r?c.find(e=>e.id===r):void 0,i=e=>{var s;return(s=u.languages.map(a=>e.name[a]).find(a=>a!==void 0))!=null?s:""},p=e=>{const s=i(e);return t.jsx(_,{name:s,fg:e.fg||j.white,bg:e.colour})},o=(e,s)=>Object.values(e.name).some(a=>a.includes(s));return t.jsx(w,{data:c,displayValue:i,displayHandler:p,predicate:o,defaultValue:g,onChange:e=>l==null?void 0:l(e.id,e.colour,e.fg||j.white)})}function q(d){const{defaultTheme:n,sessionId:r,onSubmit:l,onClose:u}=d,{t:c}=P(),[g,i]=m.useState(n==null?void 0:n[0]),[p,o]=m.useState(n==null?void 0:n[1]),[e,s]=m.useState((n==null?void 0:n[2])||"#AAAAAA"),[a,C]=m.useState((n==null?void 0:n[3])||j.white);m.useEffect(()=>{r&&n&&(i(n[0]),o(n[1]),s(n[2]),C(n[3]))},[r,n==null?void 0:n.toString()]);const x=[{type:"custom",label:c("City"),component:t.jsx(X,{defaultValueId:g,onChange:f=>{i(f),o(void 0),s("#AAAAAA"),C(j.white)}})},{type:"custom",label:c("Line"),component:t.jsx(Z,{city:g,defaultValueId:p,onChange:(f,k,R)=>{o(f),s(k),C(R)}})}],y=[{type:"input",label:c("Background colour"),variant:"color",value:e,placeholder:"#F3D03E",onChange:f=>{i(v.Other),o("other"),s(f)}},{type:"select",label:c("Foreground colour"),value:a,options:{[j.white]:c("White"),[j.black]:c("Black")},onChange:f=>{i(v.Other),o("other"),C(f)}}],E=g&&p&&e&&a,h=()=>{E&&(l==null||l([g,p,e,a]))};return t.jsxs(t.Fragment,{children:[t.jsxs($,{flex:1,mx:2,children:[t.jsx(_,{name:c("Example"),fg:a,bg:e}),t.jsxs(D,{isFitted:!0,colorScheme:"primary",w:"100%",defaultIndex:g===v.Other?1:0,children:[t.jsxs(B,{children:[t.jsx(I,{children:c("Palette")}),t.jsx(I,{children:c("Customise")})]}),t.jsxs(M,{children:[t.jsx(A,{children:t.jsx(V,{fields:x})}),t.jsx(A,{children:t.jsx(V,{fields:y})})]})]})]}),t.jsx(N,{}),t.jsxs(H,{p:2,justifyContent:"flex-end",children:[t.jsx(L,{size:"sm",onClick:u,children:c("Cancel")}),t.jsx(L,{size:"sm",colorScheme:"primary",onClick:h,isDisabled:!E,children:c("Confirm")})]})]})}const G="rmg-palette-bridge--";function ee(){const[d]=T(),n=d.get("parentId"),r=d.get("parentComponent"),[l,u]=m.useState(),[c,g]=m.useState(),i=m.useRef();m.useEffect(()=>{const e=new BroadcastChannel(G+n);i.current=e,S.event(b.APP_CLIP_VIEW_OPENED,{parentComponent:r}),e.onmessage=a=>{const{event:C,data:x}=a.data;console.log(`[${e.name}] Received event from parent component:`,C),C==="OPEN"&&(u(crypto.randomUUID()),g(x))},console.log(`[${e.name}] App clip connection established, parentComponent=${r}`);const s=document.createElement("style");return s.textContent=".rmg-window__header{margin-left: unset;}",document.head.appendChild(s),e.postMessage({event:"LOADED"}),()=>{e.close(),document.head.removeChild(s)}},[]);const p=e=>{var s,a;console.log(`[${(s=i.current)==null?void 0:s.name}] Emitting SELECT event, theme:`,e),(a=i.current)==null||a.postMessage({event:"SELECT",data:e}),S.event(b.APP_CLIP_VIEW_SELECT,{parentComponent:r,theme:e})},o=()=>{var e,s;console.log(`[${(e=i.current)==null?void 0:e.name}] Emitting CLOSE event`),(s=i.current)==null||s.postMessage({event:"CLOSE"}),S.event(b.APP_CLIP_VIEW_CLOSED,{parentComponent:r})};return t.jsx(z,{children:t.jsx(q,{defaultTheme:c,sessionId:l,onSubmit:p,onClose:o})})}export{ee as default};
