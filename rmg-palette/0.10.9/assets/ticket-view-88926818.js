import{j as e,$ as O,H as S,B as je,_ as M,Q as Z,t as T,F as V,a0 as ye,f,s as U,a1 as I,e as R,v as B,w as Ce,a2 as be,x as ve,a3 as we,a4 as ee,M as te,a5 as ne,q as se,r as oe}from"./chakra-dca798c1.js";import{u as j,r as g,a as ke,n as Se}from"./react-af516715.js";import{f as _,L as q,c as N,a as C,h as Le,i as Ee,j as Re,k as K,l as Me,m as Ne,n as Oe,o as Pe,q as De,t as ze,v as Ie,w as Ae,g as Te,p as Ue,x as Be,y as Y,M as $,z as Q,e as ae,A as Fe,B as Je,C as Ge,D as He,F as Ve,G as _e,H as qe,I as Ke,J as We,K as G,N as Ye,O as H,P as $e,Q as E,r as L,S as A,T as ie,d as Qe,E as Xe}from"./index-1d596612.js";import{R as P,a as re,b as le,c as Ze,d as et,M as tt,e as ce,f as de,g as nt,h as st}from"./index.esm-a73a456a.js";import{u as D}from"./use-translated-name-b1cd0e7b.js";const ot={"& > div:first-of-type":{flex:1}},ue=o=>{var m;const{onUpdate:s,onLangSwitch:a,onRemove:n}=o,l=(m=o.entries)!=null?m:[],{t:r}=j(),h=D(),c=(p,d)=>[{type:"select",label:r("Language"),value:p,options:Object.entries(q).reduce((t,i)=>({...t,[i[0]]:h(i[1])}),{}),disabledOptions:l.filter(t=>t[0]!==p).map(t=>t[0]),onChange:t=>a(p,t)},{type:"input",label:r("Name"),value:d,onChange:t=>s(p,t),validator:t=>!!t}],x=()=>{const p=Object.keys(q).filter(d=>!l.find(t=>t[0]===d))[0];s(p,"")};return e.jsx(e.Fragment,{children:l.map(([p,d],t,i)=>e.jsxs(O,{sx:ot,"data-testid":"entry-card-stack-"+p,children:[e.jsx(P,{fields:c(p,d),noLabel:t>0}),t===i.length-1?e.jsx(S,{size:"sm",variant:"ghost","aria-label":r("Add a name in another language"),title:r("Add a name in another language"),onClick:x,icon:e.jsx(re,{})}):e.jsx(je,{minW:8}),i.length>1&&e.jsx(S,{size:"sm",variant:"ghost","aria-label":r("Remove this name"),title:r("Remove this name"),onClick:()=>n(p),icon:e.jsx(le,{})})]},t))})};function he(o){return e.jsx(_,{direction:"column",children:e.jsx(ue,{...o})})}function at(){const{t:o,i18n:s}=j(),a=D(),n=N(),{countryList:l}=C(t=>t.app),{country:r,newCountry:h,countryName:c,newCountryLang:x}=C(t=>t.ticket),m={...l.map(t=>[t.id,a(t.name)]).sort((t,i)=>t[1].localeCompare(i[1],s.languages[0])).reduce((t,i)=>i[0]==="UN"?t:{...t,[i[0]]:i[1]},{"":o("Please select...")}),new:o("Add a country/region...")},p=Object.entries(q).reduce((t,i)=>({...t,[i[0]]:a(i[1])}),{}),d=[{type:"select",label:o("Country/Region"),value:r,options:m,disabledOptions:[""],onChange:t=>n(Le(t))},{type:"input",label:o("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:h,onChange:t=>n(Ee(t)),hidden:r!=="new"},{type:"select",label:o("Official language"),value:x,options:p,onChange:t=>n(Re(t||void 0)),hidden:r!=="new"}];return e.jsxs("section",{children:[e.jsx(K,{children:e.jsx(M,{as:"h5",size:"sm",children:o("Country/Region")})}),e.jsxs(Z.div,{px:1,children:[e.jsx(P,{fields:d}),r==="new"&&e.jsx(he,{entries:c,onUpdate:(t,i)=>n(Me({lang:t,name:i})),onLangSwitch:(t,i)=>n(Ne({prevLang:t,nextLang:i})),onRemove:t=>n(Oe(t))})]})]})}function it(){const{t:o,i18n:s}=j(),a=N(),n=D(),{cityList:l}=C(t=>t.app),{country:r,city:h,newCity:c,cityName:x}=C(t=>t.ticket),m={...l.filter(t=>t.country===r).map(t=>[t.id,n(t.name)]).sort((t,i)=>t[1].localeCompare(i[1],s.languages[0])).reduce((t,i)=>({...t,[i[0]]:i[1]}),{"":o("Please select...")}),new:o("Add a city")+"..."},p=async t=>{if(t==="new"){a(Ae("new"));return}const i=await Te(t,l);a(i?Ue(i):Be())},d=[{type:"select",label:o("City"),value:h,options:m,disabledOptions:[""],onChange:t=>p(t)},{type:"input",label:o("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:c,onChange:t=>a(Pe(t)),validator:t=>t!==""&&!t.match(/[^a-z]/),hidden:h!=="new"}];return e.jsxs("section",{children:[e.jsx(K,{children:e.jsx(M,{as:"h5",size:"sm",children:o("City")})}),e.jsxs(Z.div,{px:1,children:[e.jsx(P,{fields:d}),h==="new"&&e.jsx(he,{entries:x,onUpdate:(t,i)=>a(De({lang:t,name:i})),onLangSwitch:(t,i)=>a(ze({prevLang:t,nextLang:i})),onRemove:t=>a(Ie(t))})]})]})}const rt=o=>`{ getColor(code:"${o}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,pe=async(o,s)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:rt(o)}),signal:s})).json()).data.getColor.hex;function lt(){const{t:o}=j(),s=N(),{pantoneReady:a}=C(n=>n.app);return g.useEffect(()=>{const n=new AbortController;return pe("130 C",n.signal).then(l=>s(Y(!!l))).catch(()=>s(Y(!1))),()=>{n.abort()}},[]),e.jsx(T,{as:"i",fontSize:"xs",children:a===void 0?o("Checking Pantone service availability..."):a?o("Pantone service is ready")+" ✅":o("Pantone service is not available")+" ⚠️"})}function ct(o){var k;const{lineDetail:s,onUpdate:a}=o,{t:n}=j(),{pantoneReady:l}=C(u=>u.app),[r,h]=g.useState(!!s.pantone),[c,x]=g.useState((k=s.pantone)!=null?k:""),[m,p]=g.useState(!1),d=g.useRef(new AbortController);g.useEffect(()=>()=>{var u;(u=d.current)==null||u.abort()},[]);const t=async u=>{var b;if(d.current.abort(),!!l){d.current=new AbortController,p(!0);try{const v=await pe(u,d.current.signal);a({pantone:u,colour:v}),x(u)}catch(v){ke.flushSync(()=>{x(u)}),x((b=s.pantone)!=null?b:"")}finally{p(!1)}}},i=[{label:n("Yes"),value:!0},{label:n("No"),value:!1}],w=[{label:n("Black"),value:$.black},{label:n("White"),value:$.white}],y=[{type:"input",label:n("Line code"),placeholder:"e.g. twl, gz1, sh1",value:s.id,onChange:u=>a({id:u}),validator:u=>u!==""&&!u.match(/[^a-z0-9]/)},{type:"input",label:n("Background colour"),variant:r?"text":"color",value:s.colour,onChange:u=>a({colour:u}),isDisabled:l&&r},{type:"custom",label:n("Use Pantone"),component:e.jsx(Q,{selections:i,defaultValue:r,onChange:u=>h(u)}),hidden:!l},{type:"input",label:n("Pantone code"),value:c,onChange:t,debouncedDelay:1500,hidden:!l||!r},{type:"custom",label:n("Foreground colour"),component:e.jsx(Q,{selections:w,defaultValue:s.fg,onChange:u=>a({fg:u})})}];return e.jsxs(e.Fragment,{children:[m&&e.jsx(ae,{isIndeterminate:!0}),e.jsx(P,{fields:y})]})}function dt(o){const{lineDetail:s,editable:a,onUpdate:n,onMoveUp:l,onMoveDown:r,onCopy:h,onRemove:c,onNameUpdate:x,onLangSwitch:m,onNameRemove:p}=o,{t:d}=j(),t=D(),[i,w]=g.useState(!1),y=g.useMemo(()=>({bg:s.colour,m:-1,w:"calc(100% + var(--chakra-space-1) * 2)",px:2,"&, button":{color:s.fg},"& > div:first-of-type":{overflow:"hidden",textWrap:"nowrap",textOverflow:"ellipsis"},"& > div:last-of-type":{ml:"auto"}}),[s.colour,s.fg]),k=t(Object.fromEntries(s.nameEntity));return e.jsxs(_,{direction:"column",sx:{pb:0},children:[e.jsxs(_,{sx:y,children:[e.jsx("div",{children:k}),a&&e.jsxs(O,{spacing:.5,children:[e.jsx(S,{size:"xs",variant:"ghost","aria-label":d("Move up"),title:d("Move up"),icon:e.jsx(Ze,{}),onClick:l}),e.jsx(S,{size:"xs",variant:"ghost","aria-label":d("Move down"),title:d("Move down"),icon:e.jsx(et,{}),onClick:r}),e.jsx(S,{size:"xs",variant:"ghost","aria-label":d("Edit"),title:d("Edit"),icon:e.jsx(tt,{}),onClick:()=>w(u=>!u)}),e.jsx(S,{size:"xs",variant:"ghost","aria-label":d("Duplicate"),title:d("Duplicate"),icon:e.jsx(ce,{}),onClick:h}),e.jsx(S,{size:"xs",variant:"ghost","aria-label":d("Remove"),title:d("Remove"),icon:e.jsx(le,{}),onClick:c})]})]}),i&&e.jsxs(V,{direction:"column",position:"relative",my:1,children:[e.jsx(ct,{lineDetail:s,onUpdate:u=>n==null?void 0:n(u)}),e.jsx(ue,{entries:s.nameEntity,onUpdate:(u,b)=>x==null?void 0:x(u,b),onLangSwitch:(u,b)=>m==null?void 0:m(u,b),onRemove:u=>p==null?void 0:p(u)})]})]})}function ut(){const{t:o}=j(),s=N(),a=C(n=>n.ticket.lines);return e.jsxs("section",{children:[e.jsxs(K,{children:[e.jsx(M,{as:"h5",size:"sm",mr:"auto",children:o("Lines")}),e.jsx(lt,{})]}),e.jsxs(ye,{spacing:1,px:1,children:[Object.entries(a).map(([n,l])=>e.jsx(dt,{lineDetail:l,editable:!0,onUpdate:r=>s(Fe({entryId:n,updates:r})),onMoveUp:()=>s(Je(n)),onMoveDown:()=>s(Ge(n)),onCopy:()=>s(He(n)),onRemove:()=>s(Ve(n)),onNameUpdate:(r,h)=>s(_e({entryId:n,lang:r,name:h})),onLangSwitch:(r,h)=>s(qe({entryId:n,prevLang:r,nextLang:h})),onNameRemove:r=>s(Ke({entryId:n,lang:r}))},n)),e.jsx(f,{size:"xs",variant:"ghost",leftIcon:e.jsx(re,{}),ml:"auto !important",onClick:()=>s(We()),children:o("Add a line")})]})]})}function ht(o){const{countryErrors:s,cityErrors:a,lineErrors:n,onIgnore:l,onClose:r}=o,{t:h}=j(),c=D();return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(T,{children:h("Your inputs contain the following errors. Please consider fixing it before submitting.")}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"h5",size:"sm",my:2,children:h("Country/Region")}),e.jsx(I,{"aria-label":"List of country errors",children:s.map((x,m)=>e.jsx(R,{children:c(G[x])},m))})]}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"h5",size:"sm",my:2,children:h("City")}),e.jsx(I,{"aria-label":"List of city errors",children:a.map((x,m)=>e.jsx(R,{children:c(G[x])},m))})]}),Object.values(n).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"h5",size:"sm",my:2,children:h("Lines")}),e.jsx(I,{"aria-label":"List of line errors",children:Object.entries(n).map(([x,m])=>e.jsxs(R,{children:[x,e.jsx(I,{children:m.map((p,d)=>e.jsx(R,{children:c(G[p])},d))})]},x))})]})]}),e.jsx(B,{children:e.jsxs(O,{children:[e.jsx(f,{onClick:l,children:h("Submit anyway")}),e.jsx(f,{colorScheme:"primary",onClick:r,children:h("Go back")})]})})]})}const X=o=>{var s;return!!((s=o.match(/^https?:\/\//))!=null&&s[0])};function pt(o){const{refLink:s,onRefLinkChange:a,justification:n,onJustificationChange:l,onPrev:r,onNext:h}=o,{t:c}=j(),x=[{type:"input",value:s,label:c("Reference link"),placeholder:c("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:a,validator:X},{type:"textarea",value:n,label:c("Justification"),placeholder:c("Briefly describe your changes and provide justification"),onChange:l}],m=!s||!n||!X(s);return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(T,{children:c("Please provide suitable source and justification.")}),e.jsx(P,{fields:x,minW:"full"})]}),e.jsxs(B,{children:[r&&e.jsx(f,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e.jsx(de,{}),children:c("Previous")}),e.jsx(f,{colorScheme:"primary",onClick:h,rightIcon:e.jsx(nt,{}),isDisabled:m,children:c("Next")})]})]})}function mt(o){var w,y;const{countryEntry:s,cityEntry:a,paletteList:n,refLink:l,justification:r,onPrev:h}=o,{t:c}=j(),x=Ce("primary.500","primary.300"),m=g.useRef(null),p=[`**Reference link:** ${l||"(REPLACE ME)"}`,`**Justification:** ${r||"(REPLACE ME)"}`,Ye,H("country",s),H("city",a),H("lines",n)].join(`

`),d=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((w=a==null?void 0:a.name)==null?void 0:w.en),body:p}),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((y=a==null?void 0:a.name)==null?void 0:y.en)}),i=async()=>{m!=null&&m.current&&(m.current.select(),await navigator.clipboard.writeText(p))};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(T,{children:c("If the button below doesn't work for you, please follow the instructions below:")}),e.jsxs(be,{children:[e.jsxs(R,{children:[c("Open")," ",e.jsxs(ve,{color:x,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e.jsx(we,{as:st})]})]}),e.jsxs(R,{children:[c("Paste following text to the issue body")," ",e.jsx(f,{size:"xs",leftIcon:e.jsx(ce,{}),onClick:i,children:c("Copy")}),e.jsx($e,{ref:m,isReadOnly:!0,defaultValue:p,onClick:({target:k})=>k.select()})]})]})]}),e.jsxs(B,{children:[e.jsx(f,{variant:"ghost",onClick:h,mr:"auto",leftIcon:e.jsx(de,{}),children:c("Previous")}),e.jsx(f,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+d.toString(),"_blank"),children:c("1-click open issue")})]})]})}function xt(o){const{isOpen:s,onClose:a}=o,{t:n}=j(),[l,r]=g.useState([]),[h,c]=g.useState([]),[x,m]=g.useState({}),[p,d]=g.useState(""),[t,i]=g.useState(""),[w,y]=g.useState(!1),[k,u]=g.useState(!1),{countryList:b}=C(J=>J.app),v=C(J=>J.ticket),me=E.getCountryEntry(v),xe=E.getCityEntry(v),ge=E.getPalettes(v);g.useEffect(()=>{s?(r(E.getCountryErrors(v)),c(E.getCityErrors(v,b)),m(E.getLineErrors(v,b))):(y(!1),d(""),i(""),u(!1))},[s]);const W=l.length>0||h.length>0||Object.values(x).flat().length>0,z=W&&!w,F=!z&&!k,fe=()=>{!z&&!F&&L.storage.remove(A),a()};return e.jsxs(ee,{blockScrollOnMount:!1,isOpen:s,onClose:a,scrollBehavior:"inside",children:[e.jsx(te,{}),e.jsxs(ne,{children:[e.jsx(se,{children:n("Submit palettes")}),e.jsx(oe,{onClick:fe}),z&&e.jsx(ht,{countryErrors:l,cityErrors:h,lineErrors:x,onIgnore:()=>y(!0),onClose:a}),F&&e.jsx(pt,{refLink:p,onRefLinkChange:d,justification:t,onJustificationChange:i,onPrev:W?()=>y(!1):void 0,onNext:()=>u(!0)}),!z&&!F&&e.jsx(mt,{countryEntry:me,cityEntry:xe,paletteList:ge,refLink:p,justification:t,onPrev:()=>u(!1)})]})]})}function gt(o){const{isOpen:s,onClose:a,incomingState:n}=o,{t:l}=j(),r=N(),h=()=>{L.storage.remove(A),a()},c=()=>{n&&r(ie(n)),a()};return e.jsxs(ee,{isOpen:s,onClose:a,children:[e.jsx(te,{}),e.jsxs(ne,{children:[e.jsx(se,{children:l("Unsaved draft")}),e.jsx(oe,{}),e.jsx(U,{children:l("Do you want to continue with your last unsaved ticket?")}),e.jsx(B,{children:e.jsxs(O,{children:[e.jsx(f,{onClick:h,children:l("Discard")}),e.jsx(f,{colorScheme:"primary",onClick:c,children:l("Continue")})]})})]})]})}function vt(){const{t:o}=j(),s=N(),a=Se(),{isDataLoading:n}=C(t=>t.app),[l,r]=g.useState(),[h,c]=g.useState(!1),[x,m]=g.useState(!1);g.useEffect(()=>{const t=L.storage.get(A);if(t)try{const i=JSON.parse(t);Object.keys(i.lines).length>0&&Object.values(i.lines)[0].id&&(r(i),c(!0))}catch(i){console.error("TicketView:: unable to restore draft ticket",t)}},[]);const p=()=>{L.isStandaloneWindow()?a("/"):L.openApp("rmg-palette")},d=()=>{s(ie()),L.storage.remove(A),L.event(Xe.RESET_TICKET,{})};return e.jsxs(Qe,{alignSelf:"center",sx:{width:{base:"100%",md:520}},children:[n&&e.jsx(ae,{isIndeterminate:!0}),e.jsxs(V,{direction:"column",flex:1,overflowY:"auto",children:[e.jsx(at,{}),e.jsx(it,{}),e.jsx(ut,{})]}),e.jsxs(V,{my:2,children:[e.jsx(f,{size:"sm",onClick:p,children:o("Go back")}),e.jsxs(O,{ml:"auto",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:d,children:o("Reset")}),e.jsx(f,{size:"sm",colorScheme:"primary",onClick:()=>m(!0),children:o("Submit")})]})]}),e.jsx(gt,{isOpen:h,onClose:()=>c(!1),incomingState:l}),e.jsx(xt,{isOpen:x,onClose:()=>m(!1)})]})}export{vt as default};
