import{h as j,j as e,K as de,x as R,w as I,F as E,L as z,M as G,H as w,k as x,T,N as ue,C as he,O as _,E as me,y as g,Q as A,U as O,V as k,W as B,X as pe,Y as xe,Z as ge,_ as fe,$ as je,a0 as W,a1 as Y,a2 as $,a3 as Q,a4 as X,t as ye,J as Ce,r as be}from"./vendor-4af38186.js";import{u as F,a as Z,b as ee,M as Se,c as te,d as ne,e as ve,f as ke}from"./index.esm-9f3e0199.js";import{a as L,u as M,c as we,C as Le,d as Ee,e as Re,f as Ie,g as Me,h as Ne,r as Oe,i as Pe,j as ze,k as Te,l as Ae,m as Be,n as Fe,M as V,o as De,q as Ue,t as Je,v as Ge,w as _e,x as qe,y as He,z as Ve,I as U,G as Ke,A as J,B as v,D as P,F as se,E as We}from"./index-c5d36cb7.js";const Ye={"& > div:first-of-type":{flex:1}};function q(s){var l;const{onUpdate:o,onLangSwitch:n,onRemove:a}=s,i=(l=s.entries)!=null?l:[],{t:r}=j(),u=F(),h=(c,t)=>[{type:"select",label:r("Language"),value:c,options:Object.entries(G).reduce((d,f)=>({...d,[f[0]]:u(f[1])}),{}),disabledOptions:i.filter(d=>d[0]!==c).map(d=>d[0]),onChange:d=>n(c,d)},{type:"input",label:r("Name"),value:t,onChange:d=>o(c,d),validator:d=>!!d}],p=()=>{const c=Object.keys(G).filter(t=>!i.find(d=>d[0]===t))[0];o(c,"")};return e.jsx(de,{direction:"column",children:i.map(([c,t],d,f)=>e.jsxs(R,{sx:Ye,"data-testid":"entry-card-stack-"+c,children:[e.jsx(I,{fields:h(c,t),noLabel:d>0}),d===f.length-1?e.jsx(E,{size:"sm",variant:"ghost","aria-label":r("Add a name in another language"),title:r("Add a name in another language"),onClick:p,icon:e.jsx(Z,{})}):e.jsx(z,{minW:8}),f.length>1&&e.jsx(E,{size:"sm",variant:"ghost","aria-label":r("Remove this name"),title:r("Remove this name"),onClick:()=>a(c),icon:e.jsx(ee,{})})]},d))})}function $e(){const{t:s,i18n:o}=j(),n=F(),a=L(),{country:i,newCountry:r,countryName:u,newCountryLang:h}=M(t=>t.ticket),p={...we.map(t=>[t.id,n(t.name)]).sort((t,d)=>t[1].localeCompare(d[1],o.languages[0])).reduce((t,d)=>d[0]===Le.UN?t:{...t,[d[0]]:d[1]},{}),new:s("Add a country/region...")},l=Object.entries(G).reduce((t,d)=>({...t,[d[0]]:n(d[1])}),{}),c=[{type:"select",label:s("Country / Region"),value:i,options:p,onChange:t=>a(Ee(t))},{type:"input",label:s("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:r,onChange:t=>a(Re(t)),hidden:i!=="new"},{type:"select",label:s("Official language"),value:h,options:l,onChange:t=>a(Ie(t||void 0)),hidden:i!=="new"}];return e.jsxs(z,{as:"section",children:[e.jsx(w,{as:"h5",size:"sm",mb:2,children:s("Country / Region")}),e.jsx(I,{fields:c}),i==="new"&&e.jsx(q,{entries:u,onUpdate:(t,d)=>a(Me({lang:t,name:d})),onLangSwitch:(t,d)=>a(Ne({prevLang:t,nextLang:d})),onRemove:t=>a(Oe(t))})]})}function Qe(){const{t:s}=j(),o=L(),{city:n,cityName:a}=M(r=>r.ticket),i=[{type:"input",label:s("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:n,onChange:r=>o(Pe(r)),validator:r=>r!==""&&!r.match(/[^a-z]/)}];return e.jsxs(z,{as:"section",children:[e.jsx(w,{as:"h5",size:"sm",mt:3,mb:2,children:s("City")}),e.jsx(I,{fields:i}),e.jsx(q,{entries:a,onUpdate:(r,u)=>o(ze({lang:r,name:u})),onLangSwitch:(r,u)=>o(Te({prevLang:r,nextLang:u})),onRemove:r=>o(Ae(r))})]})}const Xe=s=>`{ getColor(code:"${s}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,oe=async(s,o)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:Xe(s)}),signal:o})).json()).data.getColor.hex;function Ze(s){const{ready:o,onReady:n}=s,{t:a}=j();return x.useEffect(()=>{const i=new AbortController;return oe("130 C",i.signal).then(r=>n(!!r)).catch(()=>n(!1)),()=>{i.abort()}},[]),e.jsx(T,{as:"i",fontSize:"xs",children:o===void 0?a("Checking Pantone service availability..."):o?a("Pantone service is ready")+" ✅":a("Pantone service is not available")+" ⚠️"})}function et(s){const{entryId:o,pantoneReady:n}=s,{t:a}=j(),i=L(),r=M(m=>m.ticket.lines),u=r[o],[h,p]=x.useState("hex"),[l,c]=x.useState(""),t=x.useRef(new AbortController);x.useEffect(()=>{t.current.abort();const m=r[o];m!=null&&m.pantone?(c(m.pantone),p("pantone")):(c(""),p("hex"))},[o]);const d=async m=>{var C;if(t.current.abort(),!(!u||!n)){t.current=new AbortController;try{const b=await oe(m,t.current.signal);i(Ue({entryId:o,pantone:m,hex:b})),c(m)}catch(b){he.flushSync(()=>{c(m)}),c((C=u.pantone)!=null?C:"")}}},f=[{label:"RGB",value:"hex"},{label:a("Pantone"),value:"pantone"}],y=[{type:"input",label:a("Line code"),placeholder:"e.g. twl, gz1, sh1",value:u.id,onChange:m=>i(Be({entryId:o,lineId:m})),validator:m=>m!==""&&!m.match(/[^a-z0-9]/)},{type:"custom",label:a("Colour mode"),component:e.jsx(ue,{selections:f,defaultValue:h,onChange:m=>p(m)}),hidden:!n},{type:"input",label:a("Background colour"),variant:"color",value:u.colour,onChange:m=>i(Fe({entryId:o,bgColour:m})),hidden:n&&h==="pantone"},{type:"input",label:a("Pantone code"),value:l,onChange:d,debouncedDelay:1500,hidden:!n||h!=="pantone"},{type:"select",label:a("Foreground colour"),value:u.fg,options:{[V.white]:a("White"),[V.black]:a("Black")},onChange:m=>i(De({entryId:o,fgColour:m}))}];return e.jsx(I,{fields:y})}function tt(){var p;const{t:s}=j(),o=F(),n=L(),a=M(l=>l.ticket.lines),[i,r]=x.useState(Object.keys(a)[0]),[u,h]=x.useState();return e.jsxs(z,{as:"section",children:[e.jsxs(_,{mt:3,mb:2,alignItems:"center",children:[e.jsx(w,{as:"h5",size:"sm",mr:"auto",children:s("Lines")}),e.jsx(Ze,{ready:u,onReady:h})]}),e.jsxs(R,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:[Object.entries(a).map(([l,c])=>{const t=o(Object.fromEntries(c.nameEntity));return e.jsx(me,{name:t,bg:c.colour,fg:c.fg,actions:e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"xs",variant:"ghost",color:c.fg,"aria-label":s("Edit")+" "+t,title:s("Edit")+" "+t,icon:e.jsx(Se,{}),onClick:()=>r(l)}),e.jsx(E,{size:"xs",variant:"ghost",color:c.fg,"aria-label":s("Copy")+" "+t,title:s("Copy")+" "+t,icon:e.jsx(te,{}),onClick:()=>n(Je(l))}),e.jsx(E,{size:"xs",variant:"ghost",color:c.fg,"aria-label":s("Remove")+" "+t,title:s("Remove")+" "+t,icon:e.jsx(ee,{}),onClick:()=>n(Ge(l))})]})},l)}),e.jsx(g,{size:"xs",variant:"ghost",leftIcon:e.jsx(Z,{}),ml:"auto !important",onClick:()=>n(_e()),children:s("Add a line")})]}),a[i]&&e.jsx(et,{entryId:i,pantoneReady:u}),e.jsx(q,{entries:(p=a[i])==null?void 0:p.nameEntity,onUpdate:(l,c)=>n(qe({entryId:i,lang:l,name:c})),onLangSwitch:(l,c)=>n(He({entryId:i,prevLang:l,nextLang:c})),onRemove:l=>n(Ve({entryId:i,lang:l}))})]})}function nt(s){const{countryErrors:o,cityErrors:n,lineErrors:a,onIgnore:i,onClose:r}=s,{t:u}=j(),h=F();return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(T,{children:u("Your inputs contain the following errors. Please consider fixing it before submitting.")}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{as:"h5",size:"sm",my:2,children:u("Country / Region")}),e.jsx(O,{"aria-label":"List of country errors",children:o.map((p,l)=>e.jsx(k,{children:h(U[p])},l))})]}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{as:"h5",size:"sm",my:2,children:u("City")}),e.jsx(O,{"aria-label":"List of city errors",children:n.map((p,l)=>e.jsx(k,{children:h(U[p])},l))})]}),Object.values(a).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{as:"h5",size:"sm",my:2,children:u("Lines")}),e.jsx(O,{"aria-label":"List of line errors",children:Object.entries(a).map(([p,l])=>e.jsxs(k,{children:[p,e.jsx(O,{children:l.map((c,t)=>e.jsx(k,{children:h(U[c])},t))})]},p))})]})]}),e.jsx(B,{children:e.jsxs(R,{children:[e.jsx(g,{onClick:i,children:u("Submit anyway")}),e.jsx(g,{colorScheme:"primary",onClick:r,children:u("Go back")})]})})]})}const K=s=>{var o;return!!((o=s.match(/^https?:\/\//))!=null&&o[0])};function st(s){const{refLink:o,onRefLinkChange:n,justification:a,onJustificationChange:i,onPrev:r,onNext:u}=s,{t:h}=j(),p=[{type:"input",value:o,label:h("Reference link"),placeholder:h("Enter a valid URL"),onChange:n,validator:K},{type:"textarea",value:a,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:i}],l=!o||!a||!K(o);return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(T,{children:h("Please provide suitable source and justification.")}),e.jsx(I,{fields:p,minW:"full"})]}),e.jsxs(B,{children:[r&&e.jsx(g,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e.jsx(ne,{}),children:h("Previous")}),e.jsx(g,{colorScheme:"primary",onClick:u,rightIcon:e.jsx(ve,{}),isDisabled:l,children:h("Next")})]})]})}function ot(s){var y,m;const{countryEntry:o,cityEntry:n,paletteList:a,refLink:i,justification:r,onPrev:u}=s,{t:h}=j(),p=pe("primary.500","primary.300"),l=x.useRef(null),c=[`**Reference link:** ${i||"(REPLACE ME)"}`,`**Justification:** ${r||"(REPLACE ME)"}`,Ke,J("country",o),J("city",n),J("lines",a)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((y=n==null?void 0:n.name)==null?void 0:y.en),body:c}),d=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((m=n==null?void 0:n.name)==null?void 0:m.en)}),f=async()=>{l!=null&&l.current&&(l.current.select(),await navigator.clipboard.writeText(c))};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(T,{children:h("If the button below doesn't work for you, please follow the instructions below:")}),e.jsxs(xe,{children:[e.jsxs(k,{children:[h("Open")," ",e.jsxs(ge,{color:p,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+d.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e.jsx(fe,{as:ke})]})]}),e.jsxs(k,{children:[h("Paste following text to the issue body")," ",e.jsx(g,{size:"xs",leftIcon:e.jsx(te,{}),onClick:f,children:h("Copy")}),e.jsx(je,{ref:l,isReadOnly:!0,defaultValue:c,onClick:({target:C})=>C.select()})]})]})]}),e.jsxs(B,{children:[e.jsx(g,{variant:"ghost",onClick:u,mr:"auto",leftIcon:e.jsx(ne,{}),children:h("Previous")}),e.jsx(g,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:h("1-click open issue")})]})]})}function at(s){const{isOpen:o,onClose:n}=s,{t:a}=j(),[i,r]=x.useState([]),[u,h]=x.useState([]),[p,l]=x.useState({}),[c,t]=x.useState(""),[d,f]=x.useState(""),[y,m]=x.useState(!1),[C,b]=x.useState(!1),S=M(le=>le.ticket),ae=v.getCountryEntry(S),ie=v.getCityEntry(S),re=v.getPalettes(S);x.useEffect(()=>{o?(r(v.getCountryErrors(S)),h(v.getCityErrors(S)),l(v.getLineErrors(S))):(m(!1),t(""),f(""),b(!1))},[o]);const H=i.length>0||u.length>0||Object.values(p).flat().length>0,N=H&&!y,D=!N&&!C,ce=()=>{!N&&!D&&window.localStorage.removeItem(P),n()};return e.jsxs(W,{blockScrollOnMount:!1,isOpen:o,onClose:n,scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs($,{children:[e.jsx(Q,{children:a("Submit palettes")}),e.jsx(X,{onClick:ce}),N&&e.jsx(nt,{countryErrors:i,cityErrors:u,lineErrors:p,onIgnore:()=>m(!0),onClose:n}),D&&e.jsx(st,{refLink:c,onRefLinkChange:t,justification:d,onJustificationChange:f,onPrev:H?()=>m(!1):void 0,onNext:()=>b(!0)}),!N&&!D&&e.jsx(ot,{countryEntry:ae,cityEntry:ie,paletteList:re,refLink:c,justification:d,onPrev:()=>b(!1)})]})]})}function it(s){const{isOpen:o,onClose:n,incomingState:a}=s,{t:i}=j(),r=L(),u=()=>{window.localStorage.removeItem(P),n()},h=()=>{a&&r(se(a)),n()};return e.jsxs(W,{isOpen:o,onClose:n,children:[e.jsx(Y,{}),e.jsxs($,{children:[e.jsx(Q,{children:i("Unsaved draft")}),e.jsx(X,{}),e.jsx(A,{children:i("Do you want to continue with your last unsaved ticket?")}),e.jsx(B,{children:e.jsxs(R,{children:[e.jsx(g,{onClick:u,children:i("Discard")}),e.jsx(g,{colorScheme:"primary",onClick:h,children:i("Continue")})]})})]})]})}function dt(){const{t:s}=j(),o=L(),n=ye(),[a,i]=x.useState(),[r,u]=x.useState(!1),[h,p]=x.useState(!1);x.useEffect(()=>{const c=window.localStorage.getItem(P);c&&(i(JSON.parse(c)),u(!0))},[]);const l=()=>{o(se()),window.localStorage.removeItem(P),be.event(We.RESET_TICKET,{})};return e.jsxs(Ce,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[e.jsxs(_,{direction:"column",flex:1,overflowY:"auto",children:[e.jsx($e,{}),e.jsx(Qe,{}),e.jsx(tt,{})]}),e.jsxs(_,{my:2,children:[e.jsx(g,{size:"sm",onClick:()=>n("/"),children:s("Go back")}),e.jsxs(R,{ml:"auto",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:l,children:s("Reset")}),e.jsx(g,{size:"sm",colorScheme:"primary",onClick:()=>p(!0),children:s("Submit")})]})]}),e.jsx(it,{isOpen:r,onClose:()=>u(!1),incomingState:a}),e.jsx(at,{isOpen:h,onClose:()=>p(!1)})]})}export{dt as default};
