import{f as v,h as e,W as oe,j as d,l as I,G as R,I as x,X as K,Y as M,Z as X,H as w,s as C,_ as F,J as y,S as se,$ as S,T as ie,a0 as Z,a1 as D,a2 as H,a3 as N,a4 as E,a5 as G,a6 as Q,a7 as re,a8 as le,a9 as ce,aa as de,ab as ue,ac as he,ad as me,ae as ge,af as pe,ag as fe,ah as Ce,ai as ye,E as be,V as ve,r as Se}from"./vendor.aa828424.js";import{t as ke,d as J,L as U,a as O,u as z,c as Le,C as Ee,e as we,f as xe,g as Re,h as Ne,i as Ie,r as Me,j as Oe,k as ze,l as Pe,m as je,n as Ae,o as Be,q as Te,v as Fe,w as Je,x as Ue,y as De,z as He,M as Y,A as Ge,I as B,G as Ve,B as T,D as L,F as _e,E as We}from"./index.0829e5c4.js";import{u as V}from"./use-translated-name.0adef540.js";function _(a){var o;const{onUpdate:l,onAdd:i,onRemove:u}=a,r=(o=a.entries)!=null?o:ke.getInitialState(),{t:s}=v(),m=n=>{const c=J.selectById(r,n);if(!c)return[];const{lang:t,name:g}=c,b=Object.entries(U).reduce((p,f)=>f[1]!==t&&f[1]in r?p:{...p,[f[1]]:f[0]},{});return[{type:"select",label:s("Language"),value:t,options:b,onChange:p=>l(n,{lang:p})},{type:"input",label:s("Name"),value:g,onChange:p=>l(n,{name:p}),validator:p=>p!==""}]},h=()=>{const n=Object.values(U).filter(c=>!Object.values(r.entities).find(t=>(t==null?void 0:t.lang)===c))[0];i(n)};return e(oe,{direction:"column",children:J.selectIds(r).map((n,c)=>d(I,{sx:{"& > div:first-of-type":{flex:1}},"data-testid":"entry-card-stack-"+n,children:[e(R,{fields:m(n),noLabel:c>0}),c===r.ids.length-1?e(x,{size:"sm",variant:"ghost","aria-label":s("Add a name in another language"),title:s("Add a name in another language"),onClick:h,icon:e(K,{})}):e(M,{minW:8}),e(x,{size:"sm",variant:"ghost","aria-label":s("Remove this name"),title:s("Remove this name"),onClick:()=>u(n),icon:e(X,{})})]},n))})}function qe(){const{t:a,i18n:l}=v(),i=V(),u=O(),{country:r,newCountry:s,countryName:m,newCountryLang:h}=z(t=>t.ticket),o={...Le.map(t=>[t.id,i(t.name)]).sort((t,g)=>t[1].localeCompare(g[1],l.languages[0])).reduce((t,g)=>g[0]===Ee.UN?t:{...t,[g[0]]:g[1]},{}),new:a("Add a country/region...")},n=Object.entries(U).reduce((t,g)=>({...t,[g[1]]:g[0]}),{"":a("Please select...")}),c=[{type:"select",label:a("Country / Region"),value:r,options:o,onChange:t=>u(we(t))},{type:"input",label:a("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:s,onChange:t=>u(xe(t)),hidden:r!=="new"},{type:"select",label:a("Offical language"),value:h,options:n,onChange:t=>u(Re(t||void 0)),hidden:r!=="new"}];return d(M,{as:"section",children:[e(w,{as:"h5",size:"sm",mb:2,children:a("Country / Region")}),e(R,{fields:c}),r==="new"&&e(_,{entries:m,onUpdate:(t,g)=>u(Ne({id:t,changes:g})),onAdd:t=>u(Ie(t)),onRemove:t=>u(Me(t))})]})}function Ye(){const{t:a}=v(),l=O(),{city:i,cityName:u}=z(s=>s.ticket),r=[{type:"input",label:a("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:i,onChange:s=>l(Oe(s)),validator:s=>s!==""&&!s.match(/[^a-z]/)}];return d(M,{as:"section",children:[e(w,{as:"h5",size:"sm",mt:3,mb:2,children:a("City")}),e(R,{fields:r}),e(_,{entries:u,onUpdate:(s,m)=>l(ze({id:s,changes:m})),onAdd:s=>l(Pe(s)),onRemove:s=>l(je(s))})]})}function $e(){var h;const{t:a}=v(),l=V(),i=O(),u=z(o=>o.ticket.lines),[r,s]=C.exports.useState(Object.keys(u)[0]),m=o=>{const n=u[o];return n?[{type:"input",label:a("Line code"),placeholder:"e.g. twl, gz1, sh1",value:n.id,onChange:c=>i(De({entryId:o,lineId:c})),validator:c=>c!==""&&!c.match(/[^a-z0-9]/)},{type:"input",label:a("Background colour"),variant:"color",value:n.colour,onChange:c=>i(He({entryId:o,bgColour:c}))},{type:"select",label:a("Foreground colour"),value:n.fg,options:{[Y.white]:a("White"),[Y.black]:a("Black")},onChange:c=>i(Ge({entryId:o,fgColour:c}))}]:[]};return d(M,{as:"section",children:[d(F,{mt:3,mb:2,alignItems:"center",children:[e(w,{as:"h5",size:"sm",mr:"auto",children:a("Lines")}),e(y,{size:"xs",variant:"ghost",leftIcon:e(K,{}),mr:1,onClick:()=>i(Ae()),children:a("Add a line")})]}),e(I,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:Object.entries(u).map(([o,n])=>{const c=J.selectAll(n.nameEntity).reduce((g,b)=>({...g,[b.lang]:b.name}),{}),t=l(c);return e(se,{name:t,bg:n.colour,fg:n.fg,actions:d(S,{children:[e(x,{size:"xs",variant:"ghost",color:n.fg,"aria-label":a("Edit")+" "+t,title:a("Edit")+" "+t,icon:e(ie,{}),onClick:()=>s(o)}),e(x,{size:"xs",variant:"ghost",color:n.fg,"aria-label":a("Copy")+" "+t,title:a("Copy")+" "+t,icon:e(Z,{}),onClick:()=>i(Be(o))}),e(x,{size:"xs",variant:"ghost",color:n.fg,"aria-label":a("Remove")+" "+t,title:a("Remove")+" "+t,icon:e(X,{}),onClick:()=>i(Te(o))})]})},o)})}),e(R,{fields:m(r)}),e(_,{entries:(h=u[r])==null?void 0:h.nameEntity,onUpdate:(o,n)=>i(Fe({entryId:r,id:o,changes:n})),onAdd:o=>i(Je({entryId:r,lang:o})),onRemove:o=>i(Ue({entryId:r,id:o}))})]})}function Ke(a){const{countryErrors:l,cityErrors:i,lineErrors:u,onIgnore:r,onClose:s}=a,{t:m}=v(),h=V();return d(S,{children:[d(D,{children:[e(H,{children:m("Your inputs contain the following errors. Please consider fixing it before submitting.")}),l.length>0&&d(S,{children:[e(w,{as:"h5",size:"sm",my:2,children:m("Country / Region")}),e(N,{"aria-label":"List of country errors",children:l.map((o,n)=>e(E,{children:h(B[o])},n))})]}),i.length>0&&d(S,{children:[e(w,{as:"h5",size:"sm",my:2,children:m("City")}),e(N,{"aria-label":"List of city errors",children:i.map((o,n)=>e(E,{children:h(B[o])},n))})]}),Object.values(u).flat().length>0&&d(S,{children:[e(w,{as:"h5",size:"sm",my:2,children:m("Lines")}),e(N,{"aria-label":"List of line errors",children:Object.entries(u).map(([o,n])=>d(E,{children:[o,e(N,{children:n.map((c,t)=>e(E,{children:h(B[c])},t))})]},o))})]})]}),e(G,{children:d(I,{children:[e(y,{onClick:r,children:m("Submit anyway")}),e(y,{colorScheme:"primary",onClick:s,children:m("Go back")})]})})]})}const $=a=>{var l;return!!((l=a.match(/^https?:\/\//))!=null&&l[0])};function Xe(a){const{refLink:l,onRefLinkChange:i,justification:u,onJustificationChange:r,onPrev:s,onNext:m}=a,{t:h}=v(),o=[{type:"input",value:l,label:h("Reference link"),placeholder:h("Enter a valid URL"),onChange:i,validator:$},{type:"textarea",value:u,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:r}],n=!l||!u||!$(l);return d(S,{children:[d(D,{children:[e(H,{children:h("Please provide suitable source and justification.")}),e(R,{fields:o,minW:"full"})]}),d(G,{children:[s&&e(y,{variant:"ghost",onClick:s,mr:"auto",leftIcon:e(Q,{}),children:h("Previous")}),e(y,{colorScheme:"primary",onClick:m,rightIcon:e(re,{}),isDisabled:n,children:h("Next")})]})]})}function Ze(a){var p,f;const{countryEntry:l,cityEntry:i,paletteList:u,refLink:r,justification:s,onPrev:m}=a,{t:h}=v(),o=le("primary.500","primary.300"),n=C.exports.useRef(null),c=[`**Reference link:** ${r||"(REPLACE ME)"}`,`**Justification:** ${s||"(REPLACE ME)"}`,Ve,T("country",l),T("city",i),T("lines",u)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",label:"resources",title:"Resources: New palettes of "+((p=i==null?void 0:i.name)==null?void 0:p.en),body:c}),g=new URLSearchParams({template:"new-palettes-request.md",label:"resources",title:"Resources: New palettes of "+((f=i==null?void 0:i.name)==null?void 0:f.en)}),b=async()=>{n!=null&&n.current&&(n.current.select(),await navigator.clipboard.writeText(c))};return d(S,{children:[d(D,{children:[e(H,{children:h("If the button below doesn't work for you, please follow the instructions below:")}),d(ce,{children:[d(E,{children:[h("Open")," ",d(de,{color:o,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+g.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e(ue,{as:he})]})]}),d(E,{children:[h("Paste following text to the issue body")," ",e(y,{size:"xs",leftIcon:e(Z,{}),onClick:b,children:h("Copy")}),e(me,{ref:n,isReadOnly:!0,defaultValue:c,onClick:({target:P})=>P.select()})]})]})]}),d(G,{children:[e(y,{variant:"ghost",onClick:m,mr:"auto",leftIcon:e(Q,{}),children:h("Previous")}),e(y,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:h("1-click open issue")})]})]})}function Qe(a){const{isOpen:l,onClose:i}=a,{t:u}=v(),[r,s]=C.exports.useState([]),[m,h]=C.exports.useState([]),[o,n]=C.exports.useState({}),[c,t]=C.exports.useState(""),[g,b]=C.exports.useState(""),[p,f]=C.exports.useState(!1),[P,j]=C.exports.useState(!1),k=z(ae=>ae.ticket),ee=L.getCountryEntry(k),te=L.getCityEntry(k),ne=L.getPalettes(k);C.exports.useEffect(()=>{l?(s(L.getCountryErrors(k)),h(L.getCityErrors(k)),n(L.getLineErrors(k))):(f(!1),t(""),b(""),j(!1))},[l]);const W=r.length>0||m.length>0||Object.values(o).flat().length>0,A=W&&!p,q=!A&&!P;return d(ge,{blockScrollOnMount:!1,isOpen:l,onClose:i,scrollBehavior:"inside",children:[e(pe,{}),d(fe,{children:[e(Ce,{children:u("Submit palettes")}),e(ye,{}),A&&e(Ke,{countryErrors:r,cityErrors:m,lineErrors:o,onIgnore:()=>f(!0),onClose:i}),q&&e(Xe,{refLink:c,onRefLinkChange:t,justification:g,onJustificationChange:b,onPrev:W?()=>f(!1):void 0,onNext:()=>j(!0)}),!A&&!q&&e(Ze,{countryEntry:ee,cityEntry:te,paletteList:ne,refLink:c,justification:g,onPrev:()=>j(!1)})]})]})}function at(){const{t:a}=v(),l=O(),i=be(),[u,r]=C.exports.useState(!1),s=()=>{l(_e()),Se.event(We.RESET_TICKET,{})};return d(ve,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[d(F,{direction:"column",flex:1,overflowY:"auto",children:[e(qe,{}),e(Ye,{}),e($e,{})]}),d(F,{my:2,children:[e(y,{size:"sm",onClick:()=>i("/"),children:a("Go back")}),d(I,{ml:"auto",children:[e(y,{size:"sm",variant:"outline",onClick:s,children:a("Reset")}),e(y,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:a("Submit")})]})]}),e(Qe,{isOpen:u,onClose:()=>r(!1)})]})}export{at as default};
