import{Z as N,h as A,j as e,B as E,a0 as y,f as R,a1 as H,a2 as T,F as k}from"./chakra-7070dc54.js";import{u as w,a as x,s as I,R as M,r as p,E as S,b as B,M as v,c as F,d as z,e as D,f as G,g as O,h as _,i as V}from"./index-1e9275cb.js";import{u as j,n as P,r as f}from"./react-af516715.js";import{R as W}from"./index.esm-fa0f4c6f.js";import{u as C,L as Y}from"./line-detail-card-ae0b0862.js";import{m as U}from"./ag-grid-860b4fab.js";import{u as b}from"./use-palette-38d9e32d.js";var Z=function(o){var i=o.children,n=N().colorMode,r=A("RmgAgGrid");return e.jsx(E,{className:n==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:r,children:i})};function q(){const{t:o,i18n:i}=j(),n=C(),r=w(),l=P(),{countryList:h,selectedCountry:d}=x(a=>a.app),g=h.map(a=>[a.id,n(a.name)]).sort((a,s)=>a[1].localeCompare(s[1],i.languages[0])).reduce((a,s)=>s[0]==="UN"?a:{...a,[s[0]]:s[1]},{"":o("Please select...")}),u=[{type:"select",label:o("Country/Region"),value:d,options:g,disabledOptions:[""],onChange:a=>r(I(a))}],m=()=>{p.isStandaloneWindow()?l("/new"):p.openApp("rmg-palette-upload"),p.event(S.ADD_CITY,{})};return e.jsxs(M,{children:[e.jsx(W,{fields:u}),e.jsx(y,{ml:"auto",children:e.jsx(R,{variant:"solid",size:"sm",colorScheme:"primary",onClick:m,children:o("Add a city")})})]})}function J(o){const{city:i}=o,n=b(i),r=C();return e.jsx(y,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:n.map(l=>e.jsx(B,{name:r(l.name),fg:l.fg||v.white,bg:l.colour},l.id))})}function K(){const{t:o,i18n:i}=j(),n=C(),r=F();P();const{cityList:l,selectedCountry:h,sidePanelCity:d}=x(t=>t.app),g=l.filter(t=>t.country===h),u=f.useRef(null);f.useEffect(()=>{var t,c;d||(c=(t=u.current)==null?void 0:t.api)==null||c.deselectAll()},[d]);const m=f.useCallback(({api:t})=>{const c=t.getSelectedRows().map(L=>L.id);c.length===1?r(z(c[0])):r(D())},[]),a=f.useMemo(()=>[{headerName:o("City"),field:"name",valueFormatter:({value:t})=>n(t),comparator:(t,c)=>n(t).localeCompare(n(c),i.languages[0]),sortable:!0,sort:"asc",wrapText:!0,filter:!0},{headerName:o("Lines"),field:"id",cellRenderer:({value:t})=>e.jsx(J,{city:t}),flex:1,autoHeight:!0,resizable:!1}],[i.language]),s=f.useMemo(()=>({resizable:!0}),[]);return e.jsx(Z,{children:e.jsx(U.AgGridReact,{ref:u,rowData:g,columnDefs:a,defaultColDef:s,getRowId:({data:t})=>t.id,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressRowVirtualisation:!0,rowSelection:"single",debug:!1,onSelectionChanged:m})})}const Q=410;function X(){var m,a;const{t:o}=j(),i=w(),{sidePanelCity:n,cityList:r}=x(s=>s.app),l=b(n),d=C()((a=(m=r.find(s=>s.id===n))==null?void 0:m.name)!=null?a:{}),g=()=>{i(D())},u=async()=>{p.closeApp("rmg-palette-upload"),setTimeout(()=>{p.openApp("rmg-palette-upload","/rmg-palette/#/new?city="+n)},200),p.event(S.EDIT_CITY,{city:n})};return e.jsxs(G,{isOpen:!!n,width:Q,header:"Dummy header",children:[e.jsx(O,{onClose:g,children:d}),e.jsx(H,{spacing:.5,px:2,flex:1,overflowY:"auto",children:l.map(s=>{var c;const t={...s,nameEntity:Object.entries(s.name),fg:(c=s.fg)!=null?c:v.white};return e.jsx(Y,{lineDetail:t,editable:!1},s.id)})}),e.jsx(T,{}),e.jsx(y,{p:1,children:e.jsx(R,{size:"sm",ml:"auto",onClick:u,children:o("Edit")})})]})}function ie(){const{isDataLoading:o}=x(i=>i.app);return e.jsxs(_,{children:[o&&e.jsx(V,{isIndeterminate:!0}),e.jsx(q,{}),e.jsxs(k,{flex:1,overflow:"hidden",position:"relative",children:[e.jsx(K,{}),e.jsx(X,{})]})]})}export{ie as default};
