import{e as b,f as e,J as ae,j as m,v as z,t as I,D as N,K as j,L as D,H as x,h as y,T as B,M as se,z as ie,N as F,C as re,O as v,w as C,Q as G,U as O,V as R,W as q,X as ce,Y as le,Z as de,_ as ue,$ as he,a0 as me,a1 as pe,a2 as ge,a3 as ye,a4 as fe,q as Ce,F as be,r as ve}from"./vendor-9037961f.js";import{u as A,a as K,b as Y,M as Se,c as Q,d as X,e as ke,f as Le}from"./index.esm-36f0f096.js";import{a as M,u as P,c as we,C as Ee,d as Re,e as xe,f as Ne,g as Ie,h as Me,r as Pe,i as Oe,j as ze,k as je,l as Be,m as Ae,n as Te,M as W,o as Ue,q as Je,t as De,v as Fe,w as Ge,x as qe,y as He,z as Ve,I as U,G as _e,A as J,B as E,D as We,E as $e}from"./index-1f97bdfb.js";const Ke={"& > div:first-of-type":{flex:1}};function H(n){var d;const{onUpdate:o,onLangSwitch:s,onRemove:a}=n,c=(d=n.entries)!=null?d:[],{t:i}=b(),u=A(),h=(r,t)=>[{type:"select",label:i("Language"),value:r,options:Object.entries(D).reduce((l,f)=>({...l,[f[0]]:u(f[1])}),{}),disabledOptions:c.filter(l=>l[0]!==r).map(l=>l[0]),onChange:l=>s(r,l)},{type:"input",label:i("Name"),value:t,onChange:l=>o(r,l),validator:l=>!!l}],g=()=>{const r=Object.keys(D).filter(t=>!c.find(l=>l[0]===t))[0];o(r,"")};return e(ae,{direction:"column",children:c.map(([r,t],l,f)=>m(z,{sx:Ke,"data-testid":"entry-card-stack-"+r,children:[e(I,{fields:h(r,t),noLabel:l>0}),l===f.length-1?e(N,{size:"sm",variant:"ghost","aria-label":i("Add a name in another language"),title:i("Add a name in another language"),onClick:g,icon:e(K,{})}):e(j,{minW:8}),f.length>1&&e(N,{size:"sm",variant:"ghost","aria-label":i("Remove this name"),title:i("Remove this name"),onClick:()=>a(r),icon:e(Y,{})})]},l))})}function Ye(){const{t:n,i18n:o}=b(),s=A(),a=M(),{country:c,newCountry:i,countryName:u,newCountryLang:h}=P(t=>t.ticket),g={...we.map(t=>[t.id,s(t.name)]).sort((t,l)=>t[1].localeCompare(l[1],o.languages[0])).reduce((t,l)=>l[0]===Ee.UN?t:{...t,[l[0]]:l[1]},{}),new:n("Add a country/region...")},d=Object.entries(D).reduce((t,l)=>({...t,[l[0]]:s(l[1])}),{}),r=[{type:"select",label:n("Country / Region"),value:c,options:g,onChange:t=>a(Re(t))},{type:"input",label:n("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:i,onChange:t=>a(xe(t)),hidden:c!=="new"},{type:"select",label:n("Offical language"),value:h,options:d,onChange:t=>a(Ne(t||void 0)),hidden:c!=="new"}];return m(j,{as:"section",children:[e(x,{as:"h5",size:"sm",mb:2,children:n("Country / Region")}),e(I,{fields:r}),c==="new"&&e(H,{entries:u,onUpdate:(t,l)=>a(Ie({lang:t,name:l})),onLangSwitch:(t,l)=>a(Me({prevLang:t,nextLang:l})),onRemove:t=>a(Pe(t))})]})}function Qe(){const{t:n}=b(),o=M(),{city:s,cityName:a}=P(i=>i.ticket),c=[{type:"input",label:n("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:s,onChange:i=>o(Oe(i)),validator:i=>i!==""&&!i.match(/[^a-z]/)}];return m(j,{as:"section",children:[e(x,{as:"h5",size:"sm",mt:3,mb:2,children:n("City")}),e(I,{fields:c}),e(H,{entries:a,onUpdate:(i,u)=>o(ze({lang:i,name:u})),onLangSwitch:(i,u)=>o(je({prevLang:i,nextLang:u})),onRemove:i=>o(Be(i))})]})}const Xe=n=>`{ getColor(code:"${n}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,Z=async(n,o)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:Xe(n)}),signal:o})).json()).data.getColor.hex;function Ze(n){const{ready:o,onReady:s}=n,{t:a}=b();return y.useEffect(()=>{const c=new AbortController;return Z("130 C",c.signal).then(i=>s(!!i)).catch(()=>s(!1)),()=>{c.abort()}},[]),e(B,{as:"i",fontSize:"xs",children:o===void 0?a("Checking Pantone service availability..."):o?a("Pantone service is ready")+" ✅":a("Pantone service is not available")+" ⚠️"})}function et(n){const{entryId:o,pantoneReady:s}=n,{t:a}=b(),c=M(),i=P(p=>p.ticket.lines),u=i[o],[h,g]=y.useState("hex"),[d,r]=y.useState(""),t=y.useRef(new AbortController);y.useEffect(()=>{t.current.abort();const p=i[o];p!=null&&p.pantone?(r(p.pantone),g("pantone")):(r(""),g("hex"))},[o]);const l=async p=>{var k;if(t.current.abort(),!(!u||!s)){t.current=new AbortController;try{const L=await Z(p,t.current.signal);c(Je({entryId:o,pantone:p,hex:L})),r(p)}catch(L){ie.flushSync(()=>{r(p)}),r((k=u.pantone)!=null?k:"")}}},f=[{label:"RGB",value:"hex"},{label:a("Pantone"),value:"pantone"}],S=[{type:"input",label:a("Line code"),placeholder:"e.g. twl, gz1, sh1",value:u.id,onChange:p=>c(Ae({entryId:o,lineId:p})),validator:p=>p!==""&&!p.match(/[^a-z0-9]/)},{type:"custom",label:a("Colour mode"),component:e(se,{selections:f,defaultValue:h,onChange:p=>g(p)}),hidden:!s},{type:"input",label:a("Background colour"),variant:"color",value:u.colour,onChange:p=>c(Te({entryId:o,bgColour:p})),hidden:s&&h==="pantone"},{type:"input",label:a("Pantone code"),value:d,onChange:l,debouncedDelay:1500,hidden:!s||h!=="pantone"},{type:"select",label:a("Foreground colour"),value:u.fg,options:{[W.white]:a("White"),[W.black]:a("Black")},onChange:p=>c(Ue({entryId:o,fgColour:p}))}];return e(I,{fields:S})}function tt(){var g;const{t:n}=b(),o=A(),s=M(),a=P(d=>d.ticket.lines),[c,i]=y.useState(Object.keys(a)[0]),[u,h]=y.useState();return m(j,{as:"section",children:[m(F,{mt:3,mb:2,alignItems:"center",children:[e(x,{as:"h5",size:"sm",mr:"auto",children:n("Lines")}),e(Ze,{ready:u,onReady:h})]}),m(z,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:[Object.entries(a).map(([d,r])=>{const t=o(Object.fromEntries(r.nameEntity));return e(re,{name:t,bg:r.colour,fg:r.fg,actions:m(v,{children:[e(N,{size:"xs",variant:"ghost",color:r.fg,"aria-label":n("Edit")+" "+t,title:n("Edit")+" "+t,icon:e(Se,{}),onClick:()=>i(d)}),e(N,{size:"xs",variant:"ghost",color:r.fg,"aria-label":n("Copy")+" "+t,title:n("Copy")+" "+t,icon:e(Q,{}),onClick:()=>s(De(d))}),e(N,{size:"xs",variant:"ghost",color:r.fg,"aria-label":n("Remove")+" "+t,title:n("Remove")+" "+t,icon:e(Y,{}),onClick:()=>s(Fe(d))})]})},d)}),e(C,{size:"xs",variant:"ghost",leftIcon:e(K,{}),ml:"auto !important",onClick:()=>s(Ge()),children:n("Add a line")})]}),a[c]&&e(et,{entryId:c,pantoneReady:u}),e(H,{entries:(g=a[c])==null?void 0:g.nameEntity,onUpdate:(d,r)=>s(qe({entryId:c,lang:d,name:r})),onLangSwitch:(d,r)=>s(He({entryId:c,prevLang:d,nextLang:r})),onRemove:d=>s(Ve({entryId:c,lang:d}))})]})}function nt(n){const{countryErrors:o,cityErrors:s,lineErrors:a,onIgnore:c,onClose:i}=n,{t:u}=b(),h=A();return m(v,{children:[m(G,{children:[e(B,{children:u("Your inputs contain the following errors. Please consider fixing it before submitting.")}),o.length>0&&m(v,{children:[e(x,{as:"h5",size:"sm",my:2,children:u("Country / Region")}),e(O,{"aria-label":"List of country errors",children:o.map((g,d)=>e(R,{children:h(U[g])},d))})]}),s.length>0&&m(v,{children:[e(x,{as:"h5",size:"sm",my:2,children:u("City")}),e(O,{"aria-label":"List of city errors",children:s.map((g,d)=>e(R,{children:h(U[g])},d))})]}),Object.values(a).flat().length>0&&m(v,{children:[e(x,{as:"h5",size:"sm",my:2,children:u("Lines")}),e(O,{"aria-label":"List of line errors",children:Object.entries(a).map(([g,d])=>m(R,{children:[g,e(O,{children:d.map((r,t)=>e(R,{children:h(U[r])},t))})]},g))})]})]}),e(q,{children:m(z,{children:[e(C,{onClick:c,children:u("Submit anyway")}),e(C,{colorScheme:"primary",onClick:i,children:u("Go back")})]})})]})}const $=n=>{var o;return!!((o=n.match(/^https?:\/\//))!=null&&o[0])};function ot(n){const{refLink:o,onRefLinkChange:s,justification:a,onJustificationChange:c,onPrev:i,onNext:u}=n,{t:h}=b(),g=[{type:"input",value:o,label:h("Reference link"),placeholder:h("Enter a valid URL"),onChange:s,validator:$},{type:"textarea",value:a,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:c}],d=!o||!a||!$(o);return m(v,{children:[m(G,{children:[e(B,{children:h("Please provide suitable source and justification.")}),e(I,{fields:g,minW:"full"})]}),m(q,{children:[i&&e(C,{variant:"ghost",onClick:i,mr:"auto",leftIcon:e(X,{}),children:h("Previous")}),e(C,{colorScheme:"primary",onClick:u,rightIcon:e(ke,{}),isDisabled:d,children:h("Next")})]})]})}function at(n){var S,p;const{countryEntry:o,cityEntry:s,paletteList:a,refLink:c,justification:i,onPrev:u}=n,{t:h}=b(),g=ce("primary.500","primary.300"),d=y.useRef(null),r=[`**Reference link:** ${c||"(REPLACE ME)"}`,`**Justification:** ${i||"(REPLACE ME)"}`,_e,J("country",o),J("city",s),J("lines",a)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((S=s==null?void 0:s.name)==null?void 0:S.en),body:r}),l=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((p=s==null?void 0:s.name)==null?void 0:p.en)}),f=async()=>{d!=null&&d.current&&(d.current.select(),await navigator.clipboard.writeText(r))};return m(v,{children:[m(G,{children:[e(B,{children:h("If the button below doesn't work for you, please follow the instructions below:")}),m(le,{children:[m(R,{children:[h("Open")," ",m(de,{color:g,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+l.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e(ue,{as:Le})]})]}),m(R,{children:[h("Paste following text to the issue body")," ",e(C,{size:"xs",leftIcon:e(Q,{}),onClick:f,children:h("Copy")}),e(he,{ref:d,isReadOnly:!0,defaultValue:r,onClick:({target:k})=>k.select()})]})]})]}),m(q,{children:[e(C,{variant:"ghost",onClick:u,mr:"auto",leftIcon:e(X,{}),children:h("Previous")}),e(C,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:h("1-click open issue")})]})]})}function st(n){const{isOpen:o,onClose:s}=n,{t:a}=b(),[c,i]=y.useState([]),[u,h]=y.useState([]),[g,d]=y.useState({}),[r,t]=y.useState(""),[l,f]=y.useState(""),[S,p]=y.useState(!1),[k,L]=y.useState(!1),w=P(oe=>oe.ticket),ee=E.getCountryEntry(w),te=E.getCityEntry(w),ne=E.getPalettes(w);y.useEffect(()=>{o?(i(E.getCountryErrors(w)),h(E.getCityErrors(w)),d(E.getLineErrors(w))):(p(!1),t(""),f(""),L(!1))},[o]);const V=c.length>0||u.length>0||Object.values(g).flat().length>0,T=V&&!S,_=!T&&!k;return m(me,{blockScrollOnMount:!1,isOpen:o,onClose:s,scrollBehavior:"inside",children:[e(pe,{}),m(ge,{children:[e(ye,{children:a("Submit palettes")}),e(fe,{}),T&&e(nt,{countryErrors:c,cityErrors:u,lineErrors:g,onIgnore:()=>p(!0),onClose:s}),_&&e(ot,{refLink:r,onRefLinkChange:t,justification:l,onJustificationChange:f,onPrev:V?()=>p(!1):void 0,onNext:()=>L(!0)}),!T&&!_&&e(at,{countryEntry:ee,cityEntry:te,paletteList:ne,refLink:r,justification:l,onPrev:()=>L(!1)})]})]})}function lt(){const{t:n}=b(),o=M(),s=Ce(),[a,c]=y.useState(!1),i=()=>{o(We()),ve.event($e.RESET_TICKET,{})};return m(be,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[m(F,{direction:"column",flex:1,overflowY:"auto",children:[e(Ye,{}),e(Qe,{}),e(tt,{})]}),m(F,{my:2,children:[e(C,{size:"sm",onClick:()=>s("/"),children:n("Go back")}),m(z,{ml:"auto",children:[e(C,{size:"sm",variant:"outline",onClick:i,children:n("Reset")}),e(C,{size:"sm",colorScheme:"primary",onClick:()=>c(!0),children:n("Submit")})]})]}),e(st,{isOpen:a,onClose:()=>c(!1)})]})}export{lt as default};
