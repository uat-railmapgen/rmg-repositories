import{f as b,g as e,L as se,j as m,x as z,w as N,F as I,M as A,N as F,H as x,i as y,T as j,O as ie,C as re,Q as D,E as le,S as k,y as C,U as H,V as O,W as w,X as q,Y as ce,Z as de,_ as ue,$ as he,a0 as me,a1 as pe,a2 as ge,a3 as ye,a4 as fe,a5 as Ce,t as be,J as ve,r as Se}from"./vendor-5eae1870.js";import{u as B,a as K,b as Q,M as ke,c as X,d as Z,e as Ee,f as Le}from"./index.esm-1d131be8.js";import{t as Re,d as G,a as M,u as P,c as we,C as xe,e as Ie,f as Ne,g as Me,h as Pe,i as Oe,r as ze,j as Ae,k as je,l as Be,m as Te,n as Ue,o as Je,M as $,q as Fe,v as De,w as Ge,x as He,y as qe,z as Ve,A as _e,B as We,I as U,G as $e,D as J,F as R,H as Ye,E as Ke}from"./index-b3d759af.js";function V(n){var d;const{onUpdate:o,onAdd:s,onRemove:a}=n,r=(d=n.entries)!=null?d:Re.getInitialState(),{t:i}=b(),p=B(),h=c=>{const t=G.selectById(r,c);if(!t)return[];const{lang:u,name:v}=t,f=Object.entries(F).reduce((l,S)=>({...l,[S[0]]:p(S[1])}),{});return[{type:"select",label:i("Language"),value:u,options:f,onChange:l=>o(c,{lang:l})},{type:"input",label:i("Name"),value:v,onChange:l=>o(c,{name:l}),validator:l=>l!==""}]},g=()=>{const c=Object.keys(F).filter(t=>!Object.values(r.entities).find(u=>(u==null?void 0:u.lang)===t))[0];s(c)};return e(se,{direction:"column",children:G.selectIds(r).map((c,t)=>m(z,{sx:{"& > div:first-of-type":{flex:1}},"data-testid":"entry-card-stack-"+c,children:[e(N,{fields:h(c),noLabel:t>0}),t===r.ids.length-1?e(I,{size:"sm",variant:"ghost","aria-label":i("Add a name in another language"),title:i("Add a name in another language"),onClick:g,icon:e(K,{})}):e(A,{minW:8}),e(I,{size:"sm",variant:"ghost","aria-label":i("Remove this name"),title:i("Remove this name"),onClick:()=>a(c),icon:e(Q,{})})]},c))})}function Qe(){const{t:n,i18n:o}=b(),s=B(),a=M(),{country:r,newCountry:i,countryName:p,newCountryLang:h}=P(t=>t.ticket),g={...we.map(t=>[t.id,s(t.name)]).sort((t,u)=>t[1].localeCompare(u[1],o.languages[0])).reduce((t,u)=>u[0]===xe.UN?t:{...t,[u[0]]:u[1]},{}),new:n("Add a country/region...")},d=Object.entries(F).reduce((t,u)=>({...t,[u[0]]:s(u[1])}),{}),c=[{type:"select",label:n("Country / Region"),value:r,options:g,onChange:t=>a(Ie(t))},{type:"input",label:n("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:i,onChange:t=>a(Ne(t)),hidden:r!=="new"},{type:"select",label:n("Offical language"),value:h,options:d,onChange:t=>a(Me(t||void 0)),hidden:r!=="new"}];return m(A,{as:"section",children:[e(x,{as:"h5",size:"sm",mb:2,children:n("Country / Region")}),e(N,{fields:c}),r==="new"&&e(V,{entries:p,onUpdate:(t,u)=>a(Pe({id:t,changes:u})),onAdd:t=>a(Oe(t)),onRemove:t=>a(ze(t))})]})}function Xe(){const{t:n}=b(),o=M(),{city:s,cityName:a}=P(i=>i.ticket),r=[{type:"input",label:n("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:s,onChange:i=>o(Ae(i)),validator:i=>i!==""&&!i.match(/[^a-z]/)}];return m(A,{as:"section",children:[e(x,{as:"h5",size:"sm",mt:3,mb:2,children:n("City")}),e(N,{fields:r}),e(V,{entries:a,onUpdate:(i,p)=>o(je({id:i,changes:p})),onAdd:i=>o(Be(i)),onRemove:i=>o(Te(i))})]})}const Ze=n=>`{ getColor(code:"${n}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,ee=async(n,o)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:Ze(n)}),signal:o})).json()).data.getColor.hex;function et(n){const{ready:o,onReady:s}=n,{t:a}=b();return y.useEffect(()=>{const r=new AbortController;return ee("130 C",r.signal).then(i=>s(!!i)).catch(()=>s(!1)),()=>{r.abort()}},[]),e(j,{as:"i",fontSize:"xs",children:o===void 0?a("Checking Pantone service availability..."):o?a("Pantone service is ready")+" ✅":a("Pantone service is not available")+" ⚠️"})}function tt(n){const{entryId:o,pantoneReady:s}=n,{t:a}=b(),r=M(),i=P(l=>l.ticket.lines),p=i[o],[h,g]=y.useState("hex"),[d,c]=y.useState(""),t=y.useRef(new AbortController);y.useEffect(()=>{t.current.abort();const l=i[o];l!=null&&l.pantone?(c(l.pantone),g("pantone")):(c(""),g("hex"))},[o]);const u=async l=>{var S;if(t.current.abort(),!(!p||!s)){t.current=new AbortController;try{const E=await ee(l,t.current.signal);r(De({entryId:o,pantone:l,hex:E})),c(l)}catch(E){re.flushSync(()=>{c(l)}),c((S=p.pantone)!=null?S:"")}}},v=[{label:"RGB",value:"hex"},{label:a("Pantone"),value:"pantone"}],f=[{type:"input",label:a("Line code"),placeholder:"e.g. twl, gz1, sh1",value:p.id,onChange:l=>r(Ue({entryId:o,lineId:l})),validator:l=>l!==""&&!l.match(/[^a-z0-9]/)},{type:"custom",label:a("Colour mode"),component:e(ie,{selections:v,defaultValue:h,onChange:l=>g(l)}),hidden:!s},{type:"input",label:a("Background colour"),variant:"color",value:p.colour,onChange:l=>r(Je({entryId:o,bgColour:l})),hidden:s&&h==="pantone"},{type:"input",label:a("Pantone code"),value:d,onChange:u,debouncedDelay:1500,hidden:!s||h!=="pantone"},{type:"select",label:a("Foreground colour"),value:p.fg,options:{[$.white]:a("White"),[$.black]:a("Black")},onChange:l=>r(Fe({entryId:o,fgColour:l}))}];return e(N,{fields:f})}function nt(){var g;const{t:n}=b(),o=B(),s=M(),a=P(d=>d.ticket.lines),[r,i]=y.useState(Object.keys(a)[0]),[p,h]=y.useState();return m(A,{as:"section",children:[m(D,{mt:3,mb:2,alignItems:"center",children:[e(x,{as:"h5",size:"sm",mr:"auto",children:n("Lines")}),e(et,{ready:p,onReady:h})]}),m(z,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:[Object.entries(a).map(([d,c])=>{const t=G.selectAll(c.nameEntity).reduce((v,f)=>({...v,[f.lang]:f.name}),{}),u=o(t);return e(le,{name:u,bg:c.colour,fg:c.fg,actions:m(k,{children:[e(I,{size:"xs",variant:"ghost",color:c.fg,"aria-label":n("Edit")+" "+u,title:n("Edit")+" "+u,icon:e(ke,{}),onClick:()=>i(d)}),e(I,{size:"xs",variant:"ghost",color:c.fg,"aria-label":n("Copy")+" "+u,title:n("Copy")+" "+u,icon:e(X,{}),onClick:()=>s(Ge(d))}),e(I,{size:"xs",variant:"ghost",color:c.fg,"aria-label":n("Remove")+" "+u,title:n("Remove")+" "+u,icon:e(Q,{}),onClick:()=>s(He(d))})]})},d)}),e(C,{size:"xs",variant:"ghost",leftIcon:e(K,{}),ml:"auto !important",onClick:()=>s(qe()),children:n("Add a line")})]}),a[r]&&e(tt,{entryId:r,pantoneReady:p}),e(V,{entries:(g=a[r])==null?void 0:g.nameEntity,onUpdate:(d,c)=>s(Ve({entryId:r,id:d,changes:c})),onAdd:d=>s(_e({entryId:r,lang:d})),onRemove:d=>s(We({entryId:r,id:d}))})]})}function ot(n){const{countryErrors:o,cityErrors:s,lineErrors:a,onIgnore:r,onClose:i}=n,{t:p}=b(),h=B();return m(k,{children:[m(H,{children:[e(j,{children:p("Your inputs contain the following errors. Please consider fixing it before submitting.")}),o.length>0&&m(k,{children:[e(x,{as:"h5",size:"sm",my:2,children:p("Country / Region")}),e(O,{"aria-label":"List of country errors",children:o.map((g,d)=>e(w,{children:h(U[g])},d))})]}),s.length>0&&m(k,{children:[e(x,{as:"h5",size:"sm",my:2,children:p("City")}),e(O,{"aria-label":"List of city errors",children:s.map((g,d)=>e(w,{children:h(U[g])},d))})]}),Object.values(a).flat().length>0&&m(k,{children:[e(x,{as:"h5",size:"sm",my:2,children:p("Lines")}),e(O,{"aria-label":"List of line errors",children:Object.entries(a).map(([g,d])=>m(w,{children:[g,e(O,{children:d.map((c,t)=>e(w,{children:h(U[c])},t))})]},g))})]})]}),e(q,{children:m(z,{children:[e(C,{onClick:r,children:p("Submit anyway")}),e(C,{colorScheme:"primary",onClick:i,children:p("Go back")})]})})]})}const Y=n=>{var o;return!!((o=n.match(/^https?:\/\//))!=null&&o[0])};function at(n){const{refLink:o,onRefLinkChange:s,justification:a,onJustificationChange:r,onPrev:i,onNext:p}=n,{t:h}=b(),g=[{type:"input",value:o,label:h("Reference link"),placeholder:h("Enter a valid URL"),onChange:s,validator:Y},{type:"textarea",value:a,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:r}],d=!o||!a||!Y(o);return m(k,{children:[m(H,{children:[e(j,{children:h("Please provide suitable source and justification.")}),e(N,{fields:g,minW:"full"})]}),m(q,{children:[i&&e(C,{variant:"ghost",onClick:i,mr:"auto",leftIcon:e(Z,{}),children:h("Previous")}),e(C,{colorScheme:"primary",onClick:p,rightIcon:e(Ee,{}),isDisabled:d,children:h("Next")})]})]})}function st(n){var f,l;const{countryEntry:o,cityEntry:s,paletteList:a,refLink:r,justification:i,onPrev:p}=n,{t:h}=b(),g=ce("primary.500","primary.300"),d=y.useRef(null),c=[`**Reference link:** ${r||"(REPLACE ME)"}`,`**Justification:** ${i||"(REPLACE ME)"}`,$e,J("country",o),J("city",s),J("lines",a)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((f=s==null?void 0:s.name)==null?void 0:f.en),body:c}),u=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((l=s==null?void 0:s.name)==null?void 0:l.en)}),v=async()=>{d!=null&&d.current&&(d.current.select(),await navigator.clipboard.writeText(c))};return m(k,{children:[m(H,{children:[e(j,{children:h("If the button below doesn't work for you, please follow the instructions below:")}),m(de,{children:[m(w,{children:[h("Open")," ",m(ue,{color:g,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+u.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e(he,{as:Le})]})]}),m(w,{children:[h("Paste following text to the issue body")," ",e(C,{size:"xs",leftIcon:e(X,{}),onClick:v,children:h("Copy")}),e(me,{ref:d,isReadOnly:!0,defaultValue:c,onClick:({target:S})=>S.select()})]})]})]}),m(q,{children:[e(C,{variant:"ghost",onClick:p,mr:"auto",leftIcon:e(Z,{}),children:h("Previous")}),e(C,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:h("1-click open issue")})]})]})}function it(n){const{isOpen:o,onClose:s}=n,{t:a}=b(),[r,i]=y.useState([]),[p,h]=y.useState([]),[g,d]=y.useState({}),[c,t]=y.useState(""),[u,v]=y.useState(""),[f,l]=y.useState(!1),[S,E]=y.useState(!1),L=P(ae=>ae.ticket),te=R.getCountryEntry(L),ne=R.getCityEntry(L),oe=R.getPalettes(L);y.useEffect(()=>{o?(i(R.getCountryErrors(L)),h(R.getCityErrors(L)),d(R.getLineErrors(L))):(l(!1),t(""),v(""),E(!1))},[o]);const _=r.length>0||p.length>0||Object.values(g).flat().length>0,T=_&&!f,W=!T&&!S;return m(pe,{blockScrollOnMount:!1,isOpen:o,onClose:s,scrollBehavior:"inside",children:[e(ge,{}),m(ye,{children:[e(fe,{children:a("Submit palettes")}),e(Ce,{}),T&&e(ot,{countryErrors:r,cityErrors:p,lineErrors:g,onIgnore:()=>l(!0),onClose:s}),W&&e(at,{refLink:c,onRefLinkChange:t,justification:u,onJustificationChange:v,onPrev:_?()=>l(!1):void 0,onNext:()=>E(!0)}),!T&&!W&&e(st,{countryEntry:te,cityEntry:ne,paletteList:oe,refLink:c,justification:u,onPrev:()=>E(!1)})]})]})}function dt(){const{t:n}=b(),o=M(),s=be(),[a,r]=y.useState(!1),i=()=>{o(Ye()),Se.event(Ke.RESET_TICKET,{})};return m(ve,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[m(D,{direction:"column",flex:1,overflowY:"auto",children:[e(Qe,{}),e(Xe,{}),e(nt,{})]}),m(D,{my:2,children:[e(C,{size:"sm",onClick:()=>s("/"),children:n("Go back")}),m(z,{ml:"auto",children:[e(C,{size:"sm",variant:"outline",onClick:i,children:n("Reset")}),e(C,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:n("Submit")})]})]}),e(it,{isOpen:a,onClose:()=>r(!1)})]})}export{dt as default};
