import{f as b,h as e,W as se,j as h,l as O,G as x,I,X as K,Y as z,Z as Q,H as w,s as y,_ as j,$ as ie,a0 as U,S as re,a1 as k,T as le,a2 as X,J as C,a3 as G,a4 as M,a5 as R,a6 as H,a7 as Z,a8 as ce,a9 as de,aa as ue,ab as he,ac as me,ad as pe,ae as ge,af as fe,ag as ye,ah as Ce,ai as be,aj as ve,E as Se,V as ke,r as Ee}from"./vendor-aebf1f84.js";import{t as Le,d as F,L as D,a as P,u as N,c as Re,C as we,e as Ie,f as xe,g as Pe,h as Ne,i as Me,r as Oe,j as ze,k as je,l as Ae,m as Be,n as Te,o as Je,M as $,q as Ue,v as Fe,w as De,x as Ge,y as He,z as qe,A as Ve,B as _e,I as T,G as We,D as J,F as L,H as $e,E as Ye}from"./index-d0b9782a.js";import{u as q}from"./use-translated-name-9445aeaa.js";function V(n){var g;const{onUpdate:o,onAdd:i,onRemove:s}=n,r=(g=n.entries)!=null?g:Le.getInitialState(),{t:l}=b(),m=a=>{const d=F.selectById(r,a);if(!d)return[];const{lang:t,name:p}=d,v=Object.entries(D).reduce((f,c)=>c[1]!==t&&c[1]in r?f:{...f,[c[1]]:c[0]},{});return[{type:"select",label:l("Language"),value:t,options:v,onChange:f=>o(a,{lang:f})},{type:"input",label:l("Name"),value:p,onChange:f=>o(a,{name:f}),validator:f=>f!==""}]},u=()=>{const a=Object.values(D).filter(d=>!Object.values(r.entities).find(t=>(t==null?void 0:t.lang)===d))[0];i(a)};return e(se,{direction:"column",children:F.selectIds(r).map((a,d)=>h(O,{sx:{"& > div:first-of-type":{flex:1}},"data-testid":"entry-card-stack-"+a,children:[e(x,{fields:m(a),noLabel:d>0}),d===r.ids.length-1?e(I,{size:"sm",variant:"ghost","aria-label":l("Add a name in another language"),title:l("Add a name in another language"),onClick:u,icon:e(K,{})}):e(z,{minW:8}),e(I,{size:"sm",variant:"ghost","aria-label":l("Remove this name"),title:l("Remove this name"),onClick:()=>s(a),icon:e(Q,{})})]},a))})}function Ke(){const{t:n,i18n:o}=b(),i=q(),s=P(),{country:r,newCountry:l,countryName:m,newCountryLang:u}=N(t=>t.ticket),g={...Re.map(t=>[t.id,i(t.name)]).sort((t,p)=>t[1].localeCompare(p[1],o.languages[0])).reduce((t,p)=>p[0]===we.UN?t:{...t,[p[0]]:p[1]},{}),new:n("Add a country/region...")},a=Object.entries(D).reduce((t,p)=>({...t,[p[1]]:p[0]}),{"":n("Please select...")}),d=[{type:"select",label:n("Country / Region"),value:r,options:g,onChange:t=>s(Ie(t))},{type:"input",label:n("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:l,onChange:t=>s(xe(t)),hidden:r!=="new"},{type:"select",label:n("Offical language"),value:u,options:a,onChange:t=>s(Pe(t||void 0)),hidden:r!=="new"}];return h(z,{as:"section",children:[e(w,{as:"h5",size:"sm",mb:2,children:n("Country / Region")}),e(x,{fields:d}),r==="new"&&e(V,{entries:m,onUpdate:(t,p)=>s(Ne({id:t,changes:p})),onAdd:t=>s(Me(t)),onRemove:t=>s(Oe(t))})]})}function Qe(){const{t:n}=b(),o=P(),{city:i,cityName:s}=N(l=>l.ticket),r=[{type:"input",label:n("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:i,onChange:l=>o(ze(l)),validator:l=>l!==""&&!l.match(/[^a-z]/)}];return h(z,{as:"section",children:[e(w,{as:"h5",size:"sm",mt:3,mb:2,children:n("City")}),e(x,{fields:r}),e(V,{entries:s,onUpdate:(l,m)=>o(je({id:l,changes:m})),onAdd:l=>o(Ae(l)),onRemove:l=>o(Be(l))})]})}const Xe=n=>`{ getColor(code:"${n}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,ee=async(n,o)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:Xe(n)}),signal:o})).json()).data.getColor.hex;function Ze(n){const{ready:o,onReady:i}=n,{t:s}=b();return y.useEffect(()=>{const r=new AbortController;return ee("130 C",r.signal).then(l=>i(!!l)).catch(()=>i(!1)),()=>{r.abort()}},[]),e(j,{as:"i",fontSize:"xs",children:o===void 0?s("Checking Pantone service availability..."):o?s("Pantone service is ready")+" ✅":s("Pantone service is not available")+" ⚠️"})}function et(n){const{entryId:o,pantoneReady:i}=n,{t:s}=b(),r=P(),l=N(c=>c.ticket.lines),m=l[o],[u,g]=y.useState("hex"),[a,d]=y.useState(""),t=y.useRef(new AbortController);y.useEffect(()=>{t.current.abort();const c=l[o];c!=null&&c.pantone?(d(c.pantone),g("pantone")):(d(""),g("hex"))},[o]);const p=c=>{t.current.abort(),d(c),!(!m||!i)&&(t.current=new AbortController,ee(c,t.current.signal).then(S=>{r(Fe({entryId:o,pantone:c,hex:S}))}).catch(()=>{var S;d((S=m.pantone)!=null?S:"")}))},v=[{label:"RGB",value:"hex"},{label:"Pantone",value:"pantone"}],f=[{type:"input",label:s("Line code"),placeholder:"e.g. twl, gz1, sh1",value:m.id,onChange:c=>r(Te({entryId:o,lineId:c})),validator:c=>c!==""&&!c.match(/[^a-z0-9]/)},{type:"custom",label:s("Colour mode"),component:e(ie,{selections:v,defaultValue:u,onChange:c=>g(c)}),hidden:!i},{type:"input",label:s("Background colour"),variant:"color",value:m.colour,onChange:c=>r(Je({entryId:o,bgColour:c})),hidden:i&&u==="pantone"},{type:"input",label:s("Pantone code"),value:a,onChange:p,debouncedDelay:1e3,hidden:!i||u!=="pantone"},{type:"select",label:s("Foreground colour"),value:m.fg,options:{[$.white]:s("White"),[$.black]:s("Black")},onChange:c=>r(Ue({entryId:o,fgColour:c}))}];return e(x,{fields:f})}function tt(){var g;const{t:n}=b(),o=q(),i=P(),s=N(a=>a.ticket.lines),[r,l]=y.useState(Object.keys(s)[0]),[m,u]=y.useState();return h(z,{as:"section",children:[h(U,{mt:3,mb:2,alignItems:"center",children:[e(w,{as:"h5",size:"sm",mr:"auto",children:n("Lines")}),e(Ze,{ready:m,onReady:u})]}),h(O,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:[Object.entries(s).map(([a,d])=>{const t=F.selectAll(d.nameEntity).reduce((v,f)=>({...v,[f.lang]:f.name}),{}),p=o(t);return e(re,{name:p,bg:d.colour,fg:d.fg,actions:h(k,{children:[e(I,{size:"xs",variant:"ghost",color:d.fg,"aria-label":n("Edit")+" "+p,title:n("Edit")+" "+p,icon:e(le,{}),onClick:()=>l(a)}),e(I,{size:"xs",variant:"ghost",color:d.fg,"aria-label":n("Copy")+" "+p,title:n("Copy")+" "+p,icon:e(X,{}),onClick:()=>i(De(a))}),e(I,{size:"xs",variant:"ghost",color:d.fg,"aria-label":n("Remove")+" "+p,title:n("Remove")+" "+p,icon:e(Q,{}),onClick:()=>i(Ge(a))})]})},a)}),e(C,{size:"xs",variant:"ghost",leftIcon:e(K,{}),ml:"auto !important",onClick:()=>i(He()),children:n("Add a line")})]}),s[r]&&e(et,{entryId:r,pantoneReady:m}),e(V,{entries:(g=s[r])==null?void 0:g.nameEntity,onUpdate:(a,d)=>i(qe({entryId:r,id:a,changes:d})),onAdd:a=>i(Ve({entryId:r,lang:a})),onRemove:a=>i(_e({entryId:r,id:a}))})]})}function nt(n){const{countryErrors:o,cityErrors:i,lineErrors:s,onIgnore:r,onClose:l}=n,{t:m}=b(),u=q();return h(k,{children:[h(G,{children:[e(j,{children:m("Your inputs contain the following errors. Please consider fixing it before submitting.")}),o.length>0&&h(k,{children:[e(w,{as:"h5",size:"sm",my:2,children:m("Country / Region")}),e(M,{"aria-label":"List of country errors",children:o.map((g,a)=>e(R,{children:u(T[g])},a))})]}),i.length>0&&h(k,{children:[e(w,{as:"h5",size:"sm",my:2,children:m("City")}),e(M,{"aria-label":"List of city errors",children:i.map((g,a)=>e(R,{children:u(T[g])},a))})]}),Object.values(s).flat().length>0&&h(k,{children:[e(w,{as:"h5",size:"sm",my:2,children:m("Lines")}),e(M,{"aria-label":"List of line errors",children:Object.entries(s).map(([g,a])=>h(R,{children:[g,e(M,{children:a.map((d,t)=>e(R,{children:u(T[d])},t))})]},g))})]})]}),e(H,{children:h(O,{children:[e(C,{onClick:r,children:m("Submit anyway")}),e(C,{colorScheme:"primary",onClick:l,children:m("Go back")})]})})]})}const Y=n=>{var o;return!!((o=n.match(/^https?:\/\//))!=null&&o[0])};function at(n){const{refLink:o,onRefLinkChange:i,justification:s,onJustificationChange:r,onPrev:l,onNext:m}=n,{t:u}=b(),g=[{type:"input",value:o,label:u("Reference link"),placeholder:u("Enter a valid URL"),onChange:i,validator:Y},{type:"textarea",value:s,label:u("Justification"),placeholder:u("Briefly describe your changes and provide justification"),onChange:r}],a=!o||!s||!Y(o);return h(k,{children:[h(G,{children:[e(j,{children:u("Please provide suitable source and justification.")}),e(x,{fields:g,minW:"full"})]}),h(H,{children:[l&&e(C,{variant:"ghost",onClick:l,mr:"auto",leftIcon:e(Z,{}),children:u("Previous")}),e(C,{colorScheme:"primary",onClick:m,rightIcon:e(ce,{}),isDisabled:a,children:u("Next")})]})]})}function ot(n){var f,c;const{countryEntry:o,cityEntry:i,paletteList:s,refLink:r,justification:l,onPrev:m}=n,{t:u}=b(),g=de("primary.500","primary.300"),a=y.useRef(null),d=[`**Reference link:** ${r||"(REPLACE ME)"}`,`**Justification:** ${l||"(REPLACE ME)"}`,We,J("country",o),J("city",i),J("lines",s)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",label:"resources",title:"Resources: New palettes of "+((f=i==null?void 0:i.name)==null?void 0:f.en),body:d}),p=new URLSearchParams({template:"new-palettes-request.md",label:"resources",title:"Resources: New palettes of "+((c=i==null?void 0:i.name)==null?void 0:c.en)}),v=async()=>{a!=null&&a.current&&(a.current.select(),await navigator.clipboard.writeText(d))};return h(k,{children:[h(G,{children:[e(j,{children:u("If the button below doesn't work for you, please follow the instructions below:")}),h(ue,{children:[h(R,{children:[u("Open")," ",h(he,{color:g,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+p.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e(me,{as:pe})]})]}),h(R,{children:[u("Paste following text to the issue body")," ",e(C,{size:"xs",leftIcon:e(X,{}),onClick:v,children:u("Copy")}),e(ge,{ref:a,isReadOnly:!0,defaultValue:d,onClick:({target:S})=>S.select()})]})]})]}),h(H,{children:[e(C,{variant:"ghost",onClick:m,mr:"auto",leftIcon:e(Z,{}),children:u("Previous")}),e(C,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:u("1-click open issue")})]})]})}function st(n){const{isOpen:o,onClose:i}=n,{t:s}=b(),[r,l]=y.useState([]),[m,u]=y.useState([]),[g,a]=y.useState({}),[d,t]=y.useState(""),[p,v]=y.useState(""),[f,c]=y.useState(!1),[S,A]=y.useState(!1),E=N(oe=>oe.ticket),te=L.getCountryEntry(E),ne=L.getCityEntry(E),ae=L.getPalettes(E);y.useEffect(()=>{o?(l(L.getCountryErrors(E)),u(L.getCityErrors(E)),a(L.getLineErrors(E))):(c(!1),t(""),v(""),A(!1))},[o]);const _=r.length>0||m.length>0||Object.values(g).flat().length>0,B=_&&!f,W=!B&&!S;return h(fe,{blockScrollOnMount:!1,isOpen:o,onClose:i,scrollBehavior:"inside",children:[e(ye,{}),h(Ce,{children:[e(be,{children:s("Submit palettes")}),e(ve,{}),B&&e(nt,{countryErrors:r,cityErrors:m,lineErrors:g,onIgnore:()=>c(!0),onClose:i}),W&&e(at,{refLink:d,onRefLinkChange:t,justification:p,onJustificationChange:v,onPrev:_?()=>c(!1):void 0,onNext:()=>A(!0)}),!B&&!W&&e(ot,{countryEntry:te,cityEntry:ne,paletteList:ae,refLink:d,justification:p,onPrev:()=>A(!1)})]})]})}function ct(){const{t:n}=b(),o=P(),i=Se(),[s,r]=y.useState(!1),l=()=>{o($e()),Ee.event(Ye.RESET_TICKET,{})};return h(ke,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[h(U,{direction:"column",flex:1,overflowY:"auto",children:[e(Ke,{}),e(Qe,{}),e(tt,{})]}),h(U,{my:2,children:[e(C,{size:"sm",onClick:()=>i("/"),children:n("Go back")}),h(O,{ml:"auto",children:[e(C,{size:"sm",variant:"outline",onClick:l,children:n("Reset")}),e(C,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:n("Submit")})]})]}),e(st,{isOpen:s,onClose:()=>r(!1)})]})}export{ct as default};
