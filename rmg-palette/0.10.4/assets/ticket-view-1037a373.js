import{j as e,_ as N,H as k,B as T,Z as L,t as U,F as I,$ as me,f,s as B,a0 as z,e as E,v as F,w as xe,a1 as ge,x as je,a2 as fe,a3 as Y,M as Q,a4 as Z,q as X,r as ee}from"./chakra-4c4a0221.js";import{u as y,r as x,a as ye,n as Ce}from"./react-af516715.js";import{h as q,L as H,d as R,a as M,c as be,i as ve,j as ke,k as we,l as Se,m as Ee,n as Le,e as Re,o as Me,q as Ne,t as Oe,v as Pe,w as De,g as ze,p as Ie,x as Ae,y as K,z as Te,M as W,A as Ue,B as Be,C as Fe,D as Je,F as Ge,G as _e,H as qe,I as He,J as Ve,K as G,N as Ke,O as _,P as We,Q as S,r as w,S as A,T as te,f as $e,E as Ye}from"./index-b45ca07a.js";import{R as O,a as ne,b as se,c as Qe,d as Ze,M as Xe,e as oe,f as ae,g as et,h as tt}from"./index.esm-bd1dff2c.js";import{u as P}from"./use-translated-name-b1cd0e7b.js";const nt={"& > div:first-of-type":{flex:1}},ie=a=>{var d;const{onUpdate:n,onLangSwitch:i,onRemove:s}=a,c=(d=a.entries)!=null?d:[],{t:r}=y(),u=P(),l=(h,t)=>[{type:"select",label:r("Language"),value:h,options:Object.entries(H).reduce((o,g)=>({...o,[g[0]]:u(g[1])}),{}),disabledOptions:c.filter(o=>o[0]!==h).map(o=>o[0]),onChange:o=>i(h,o)},{type:"input",label:r("Name"),value:t,onChange:o=>n(h,o),validator:o=>!!o}],p=()=>{const h=Object.keys(H).filter(t=>!c.find(o=>o[0]===t))[0];n(h,"")};return e.jsx(e.Fragment,{children:c.map(([h,t],o,g)=>e.jsxs(N,{sx:nt,"data-testid":"entry-card-stack-"+h,children:[e.jsx(O,{fields:l(h,t),noLabel:o>0}),o===g.length-1?e.jsx(k,{size:"sm",variant:"ghost","aria-label":r("Add a name in another language"),title:r("Add a name in another language"),onClick:p,icon:e.jsx(ne,{})}):e.jsx(T,{minW:8}),g.length>1&&e.jsx(k,{size:"sm",variant:"ghost","aria-label":r("Remove this name"),title:r("Remove this name"),onClick:()=>s(h),icon:e.jsx(se,{})})]},o))})};function re(a){return e.jsx(q,{direction:"column",children:e.jsx(ie,{...a})})}function st(){const{t:a,i18n:n}=y(),i=P(),s=R(),{country:c,newCountry:r,countryName:u,newCountryLang:l}=M(t=>t.ticket),p={...be.map(t=>[t.id,i(t.name)]).sort((t,o)=>t[1].localeCompare(o[1],n.languages[0])).reduce((t,o)=>o[0]==="UN"?t:{...t,[o[0]]:o[1]},{"":a("Please select...")}),new:a("Add a country/region...")},d=Object.entries(H).reduce((t,o)=>({...t,[o[0]]:i(o[1])}),{}),h=[{type:"select",label:a("Country/Region"),value:c,options:p,disabledOptions:[""],onChange:t=>s(ve(t))},{type:"input",label:a("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:r,onChange:t=>s(ke(t)),hidden:c!=="new"},{type:"select",label:a("Official language"),value:l,options:d,onChange:t=>s(we(t||void 0)),hidden:c!=="new"}];return e.jsxs(T,{as:"section",children:[e.jsx(L,{as:"h5",size:"sm",mb:2,children:a("Country/Region")}),e.jsx(O,{fields:h}),c==="new"&&e.jsx(re,{entries:u,onUpdate:(t,o)=>s(Se({lang:t,name:o})),onLangSwitch:(t,o)=>s(Ee({prevLang:t,nextLang:o})),onRemove:t=>s(Le(t))})]})}function ot(){const{t:a,i18n:n}=y(),i=R(),s=P(),{country:c,city:r,newCity:u,cityName:l}=M(t=>t.ticket),p={...Re.filter(t=>t.country===c).map(t=>[t.id,s(t.name)]).sort((t,o)=>t[1].localeCompare(o[1],n.languages[0])).reduce((t,o)=>({...t,[o[0]]:o[1]}),{"":a("Please select...")}),new:a("Add a city")+"..."},d=async t=>{if(t==="new"){i(De("new"));return}const o=await ze(t);i(o?Ie(o):Ae())},h=[{type:"select",label:a("City"),value:r,options:p,disabledOptions:[""],onChange:t=>d(t)},{type:"input",label:a("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:u,onChange:t=>i(Me(t)),validator:t=>t!==""&&!t.match(/[^a-z]/),hidden:r!=="new"}];return e.jsxs(T,{as:"section",children:[e.jsx(L,{as:"h5",size:"sm",mt:3,mb:2,children:a("City")}),e.jsx(O,{fields:h}),r==="new"&&e.jsx(re,{entries:l,onUpdate:(t,o)=>i(Ne({lang:t,name:o})),onLangSwitch:(t,o)=>i(Oe({prevLang:t,nextLang:o})),onRemove:t=>i(Pe(t))})]})}const at=a=>`{ getColor(code:"${a}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,ce=async(a,n)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:at(a)}),signal:n})).json()).data.getColor.hex;function it(){const{t:a}=y(),n=R(),{pantoneReady:i}=M(s=>s.app);return x.useEffect(()=>{const s=new AbortController;return ce("130 C",s.signal).then(c=>n(K(!!c))).catch(()=>n(K(!1))),()=>{s.abort()}},[]),e.jsx(U,{as:"i",fontSize:"xs",children:i===void 0?a("Checking Pantone service availability..."):i?a("Pantone service is ready")+" ✅":a("Pantone service is not available")+" ⚠️"})}function rt(a){var g;const{lineDetail:n,onUpdate:i}=a,{t:s}=y(),{pantoneReady:c}=M(m=>m.app),[r,u]=x.useState(n.pantone?"pantone":"hex"),[l,p]=x.useState((g=n.pantone)!=null?g:""),d=x.useRef(new AbortController);x.useEffect(()=>()=>{var m;(m=d.current)==null||m.abort()},[]);const h=async m=>{var C;if(d.current.abort(),!!c){d.current=new AbortController;try{const v=await ce(m,d.current.signal);i({pantone:m,colour:v}),p(m)}catch(v){ye.flushSync(()=>{p(m)}),p((C=n.pantone)!=null?C:"")}}},t=[{label:"RGB",value:"hex"},{label:s("Pantone"),value:"pantone"}],o=[{type:"input",label:s("Line code"),placeholder:"e.g. twl, gz1, sh1",value:n.id,onChange:m=>i({id:m}),validator:m=>m!==""&&!m.match(/[^a-z0-9]/)},{type:"custom",label:s("Colour mode"),component:e.jsx(Te,{selections:t,defaultValue:r,onChange:m=>u(m)}),hidden:!c},{type:"input",label:s("Background colour"),variant:"color",value:n.colour,onChange:m=>i({colour:m}),hidden:c&&r==="pantone"},{type:"input",label:s("Pantone code"),value:l,onChange:h,debouncedDelay:1500,hidden:!c||r!=="pantone"},{type:"select",label:s("Foreground colour"),value:n.fg,options:{[W.white]:s("White"),[W.black]:s("Black")},onChange:m=>i({fg:m})}];return e.jsx(O,{fields:o})}function ct(a){const{lineDetail:n,editable:i,onUpdate:s,onMoveUp:c,onMoveDown:r,onCopy:u,onRemove:l,onNameUpdate:p,onLangSwitch:d,onNameRemove:h}=a,{t}=y(),o=P(),[g,m]=x.useState(!1),C=x.useMemo(()=>({bg:n.colour,m:-1,w:"calc(100% + var(--chakra-space-1) * 2)",px:2,"&, button":{color:n.fg},"& > div":{ml:"auto"}}),[n.colour,n.fg]),v=o(Object.fromEntries(n.nameEntity));return e.jsxs(q,{direction:"column",sx:{pb:0},children:[e.jsxs(q,{sx:C,children:[v,i&&e.jsxs(N,{spacing:.5,children:[e.jsx(k,{size:"xs",variant:"ghost","aria-label":t("Move up"),title:t("Move up"),icon:e.jsx(Qe,{}),onClick:c}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":t("Move down"),title:t("Move down"),icon:e.jsx(Ze,{}),onClick:r}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":t("Edit"),title:t("Edit"),icon:e.jsx(Xe,{}),onClick:()=>m(j=>!j)}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":t("Duplicate"),title:t("Duplicate"),icon:e.jsx(oe,{}),onClick:u}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":t("Remove"),title:t("Remove"),icon:e.jsx(se,{}),onClick:l})]})]}),g&&e.jsxs(I,{direction:"column",my:1,children:[e.jsx(rt,{lineDetail:n,onUpdate:j=>s==null?void 0:s(j)}),e.jsx(ie,{entries:n.nameEntity,onUpdate:(j,b)=>p==null?void 0:p(j,b),onLangSwitch:(j,b)=>d==null?void 0:d(j,b),onRemove:j=>h==null?void 0:h(j)})]})]})}function lt(){const{t:a}=y(),n=R(),i=M(s=>s.ticket.lines);return e.jsxs(T,{as:"section",children:[e.jsxs(I,{mt:3,mb:2,alignItems:"center",children:[e.jsx(L,{as:"h5",size:"sm",mr:"auto",children:a("Lines")}),e.jsx(it,{})]}),e.jsxs(me,{spacing:1,children:[Object.entries(i).map(([s,c])=>e.jsx(ct,{lineDetail:c,editable:!0,onUpdate:r=>n(Ue({entryId:s,updates:r})),onMoveUp:()=>n(Be(s)),onMoveDown:()=>n(Fe(s)),onCopy:()=>n(Je(s)),onRemove:()=>n(Ge(s)),onNameUpdate:(r,u)=>n(_e({entryId:s,lang:r,name:u})),onLangSwitch:(r,u)=>n(qe({entryId:s,prevLang:r,nextLang:u})),onNameRemove:r=>n(He({entryId:s,lang:r}))},s)),e.jsx(f,{size:"xs",variant:"ghost",leftIcon:e.jsx(ne,{}),ml:"auto !important",onClick:()=>n(Ve()),children:a("Add a line")})]})]})}function dt(a){const{countryErrors:n,cityErrors:i,lineErrors:s,onIgnore:c,onClose:r}=a,{t:u}=y(),l=P();return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(U,{children:u("Your inputs contain the following errors. Please consider fixing it before submitting.")}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{as:"h5",size:"sm",my:2,children:u("Country/Region")}),e.jsx(z,{"aria-label":"List of country errors",children:n.map((p,d)=>e.jsx(E,{children:l(G[p])},d))})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{as:"h5",size:"sm",my:2,children:u("City")}),e.jsx(z,{"aria-label":"List of city errors",children:i.map((p,d)=>e.jsx(E,{children:l(G[p])},d))})]}),Object.values(s).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{as:"h5",size:"sm",my:2,children:u("Lines")}),e.jsx(z,{"aria-label":"List of line errors",children:Object.entries(s).map(([p,d])=>e.jsxs(E,{children:[p,e.jsx(z,{children:d.map((h,t)=>e.jsx(E,{children:l(G[h])},t))})]},p))})]})]}),e.jsx(F,{children:e.jsxs(N,{children:[e.jsx(f,{onClick:c,children:u("Submit anyway")}),e.jsx(f,{colorScheme:"primary",onClick:r,children:u("Go back")})]})})]})}const $=a=>{var n;return!!((n=a.match(/^https?:\/\//))!=null&&n[0])};function ut(a){const{refLink:n,onRefLinkChange:i,justification:s,onJustificationChange:c,onPrev:r,onNext:u}=a,{t:l}=y(),p=[{type:"input",value:n,label:l("Reference link"),placeholder:l("Enter a valid URL"),onChange:i,validator:$},{type:"textarea",value:s,label:l("Justification"),placeholder:l("Briefly describe your changes and provide justification"),onChange:c}],d=!n||!s||!$(n);return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(U,{children:l("Please provide suitable source and justification.")}),e.jsx(O,{fields:p,minW:"full"})]}),e.jsxs(F,{children:[r&&e.jsx(f,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e.jsx(ae,{}),children:l("Previous")}),e.jsx(f,{colorScheme:"primary",onClick:u,rightIcon:e.jsx(et,{}),isDisabled:d,children:l("Next")})]})]})}function ht(a){var m,C;const{countryEntry:n,cityEntry:i,paletteList:s,refLink:c,justification:r,onPrev:u}=a,{t:l}=y(),p=xe("primary.500","primary.300"),d=x.useRef(null),h=[`**Reference link:** ${c||"(REPLACE ME)"}`,`**Justification:** ${r||"(REPLACE ME)"}`,Ke,_("country",n),_("city",i),_("lines",s)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((m=i==null?void 0:i.name)==null?void 0:m.en),body:h}),o=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((C=i==null?void 0:i.name)==null?void 0:C.en)}),g=async()=>{d!=null&&d.current&&(d.current.select(),await navigator.clipboard.writeText(h))};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(U,{children:l("If the button below doesn't work for you, please follow the instructions below:")}),e.jsxs(ge,{children:[e.jsxs(E,{children:[l("Open")," ",e.jsxs(je,{color:p,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+o.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e.jsx(fe,{as:tt})]})]}),e.jsxs(E,{children:[l("Paste following text to the issue body")," ",e.jsx(f,{size:"xs",leftIcon:e.jsx(oe,{}),onClick:g,children:l("Copy")}),e.jsx(We,{ref:d,isReadOnly:!0,defaultValue:h,onClick:({target:v})=>v.select()})]})]})]}),e.jsxs(F,{children:[e.jsx(f,{variant:"ghost",onClick:u,mr:"auto",leftIcon:e.jsx(ae,{}),children:l("Previous")}),e.jsx(f,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:l("1-click open issue")})]})]})}function pt(a){const{isOpen:n,onClose:i}=a,{t:s}=y(),[c,r]=x.useState([]),[u,l]=x.useState([]),[p,d]=x.useState({}),[h,t]=x.useState(""),[o,g]=x.useState(""),[m,C]=x.useState(!1),[v,j]=x.useState(!1),b=M(pe=>pe.ticket),le=S.getCountryEntry(b),de=S.getCityEntry(b),ue=S.getPalettes(b);x.useEffect(()=>{n?(r(S.getCountryErrors(b)),l(S.getCityErrors(b)),d(S.getLineErrors(b))):(C(!1),t(""),g(""),j(!1))},[n]);const V=c.length>0||u.length>0||Object.values(p).flat().length>0,D=V&&!m,J=!D&&!v,he=()=>{!D&&!J&&w.storage.remove(A),i()};return e.jsxs(Y,{blockScrollOnMount:!1,isOpen:n,onClose:i,scrollBehavior:"inside",children:[e.jsx(Q,{}),e.jsxs(Z,{children:[e.jsx(X,{children:s("Submit palettes")}),e.jsx(ee,{onClick:he}),D&&e.jsx(dt,{countryErrors:c,cityErrors:u,lineErrors:p,onIgnore:()=>C(!0),onClose:i}),J&&e.jsx(ut,{refLink:h,onRefLinkChange:t,justification:o,onJustificationChange:g,onPrev:V?()=>C(!1):void 0,onNext:()=>j(!0)}),!D&&!J&&e.jsx(ht,{countryEntry:le,cityEntry:de,paletteList:ue,refLink:h,justification:o,onPrev:()=>j(!1)})]})]})}function mt(a){const{isOpen:n,onClose:i,incomingState:s}=a,{t:c}=y(),r=R(),u=()=>{w.storage.remove(A),i()},l=()=>{s&&r(te(s)),i()};return e.jsxs(Y,{isOpen:n,onClose:i,children:[e.jsx(Q,{}),e.jsxs(Z,{children:[e.jsx(X,{children:c("Unsaved draft")}),e.jsx(ee,{}),e.jsx(B,{children:c("Do you want to continue with your last unsaved ticket?")}),e.jsx(F,{children:e.jsxs(N,{children:[e.jsx(f,{onClick:u,children:c("Discard")}),e.jsx(f,{colorScheme:"primary",onClick:l,children:c("Continue")})]})})]})]})}function Ct(){const{t:a}=y(),n=R(),i=Ce(),[s,c]=x.useState(),[r,u]=x.useState(!1),[l,p]=x.useState(!1);x.useEffect(()=>{const t=w.storage.get(A);if(t)try{const o=JSON.parse(t);Object.keys(o.lines).length>0&&Object.values(o.lines)[0].id&&(c(o),u(!0))}catch(o){console.error("TicketView:: unable to restore draft ticket",t)}},[]);const d=()=>{w.isStandaloneWindow()?i("/"):w.openApp("rmg-palette")},h=()=>{n(te()),w.storage.remove(A),w.event(Ye.RESET_TICKET,{})};return e.jsxs($e,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[e.jsxs(I,{direction:"column",flex:1,overflowY:"auto",children:[e.jsx(st,{}),e.jsx(ot,{}),e.jsx(lt,{})]}),e.jsxs(I,{my:2,children:[e.jsx(f,{size:"sm",onClick:d,children:a("Go back")}),e.jsxs(N,{ml:"auto",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:h,children:a("Reset")}),e.jsx(f,{size:"sm",colorScheme:"primary",onClick:()=>p(!0),children:a("Submit")})]})]}),e.jsx(mt,{isOpen:r,onClose:()=>u(!1),incomingState:s}),e.jsx(pt,{isOpen:l,onClose:()=>p(!1)})]})}export{Ct as default};
