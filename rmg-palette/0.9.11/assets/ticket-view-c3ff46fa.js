import{j as e,_ as R,H as L,B as D,Z as S,t as T,F as I,$ as pe,f as j,s as A,a0 as P,e as w,v as B,w as xe,a1 as ge,x as fe,a2 as je,a3 as Y,M as Q,a4 as Z,q as X,r as ee}from"./chakra-84346e60.js";import{u as y,r as x,a as ye,n as Ce}from"./react-af516715.js";import{h as q,L as H,d as k,a as E,c as be,i as ve,j as we,k as Se,l as ke,m as Ee,n as Le,e as Re,o as Ne,q as Me,t as Oe,v as Pe,w as Ie,g as ze,p as De,x as Te,y as K,z as Ae,M as W,A as Be,B as Fe,C as Ue,D as Je,F as Ge,G as _e,H as qe,I as J,J as He,K as G,N as Ve,O as v,P as z,Q as te,f as Ke,r as _,E as We}from"./index-ad1a6b41.js";import{R as N}from"./rmg-fields-73eff2f2.js";import{u as M,a as ne,b as se,M as $e,c as oe,d as ae,e as Ye,f as Qe}from"./index.esm-c94c2776.js";const Ze={"& > div:first-of-type":{flex:1}},ie=a=>{var d;const{onUpdate:s,onLangSwitch:i,onRemove:o}=a,c=(d=a.entries)!=null?d:[],{t:r}=y(),u=M(),l=(p,t)=>[{type:"select",label:r("Language"),value:p,options:Object.entries(H).reduce((n,f)=>({...n,[f[0]]:u(f[1])}),{}),disabledOptions:c.filter(n=>n[0]!==p).map(n=>n[0]),onChange:n=>i(p,n)},{type:"input",label:r("Name"),value:t,onChange:n=>s(p,n),validator:n=>!!n}],m=()=>{const p=Object.keys(H).filter(t=>!c.find(n=>n[0]===t))[0];s(p,"")};return e.jsx(e.Fragment,{children:c.map(([p,t],n,f)=>e.jsxs(R,{sx:Ze,"data-testid":"entry-card-stack-"+p,children:[e.jsx(N,{fields:l(p,t),noLabel:n>0}),n===f.length-1?e.jsx(L,{size:"sm",variant:"ghost","aria-label":r("Add a name in another language"),title:r("Add a name in another language"),onClick:m,icon:e.jsx(ne,{})}):e.jsx(D,{minW:8}),f.length>1&&e.jsx(L,{size:"sm",variant:"ghost","aria-label":r("Remove this name"),title:r("Remove this name"),onClick:()=>o(p),icon:e.jsx(se,{})})]},n))})};function re(a){return e.jsx(q,{direction:"column",children:e.jsx(ie,{...a})})}function Xe(){const{t:a,i18n:s}=y(),i=M(),o=k(),{country:c,newCountry:r,countryName:u,newCountryLang:l}=E(t=>t.ticket),m={...be.map(t=>[t.id,i(t.name)]).sort((t,n)=>t[1].localeCompare(n[1],s.languages[0])).reduce((t,n)=>n[0]==="UN"?t:{...t,[n[0]]:n[1]},{"":a("Please select...")}),new:a("Add a country/region...")},d=Object.entries(H).reduce((t,n)=>({...t,[n[0]]:i(n[1])}),{}),p=[{type:"select",label:a("Country/Region"),value:c,options:m,disabledOptions:[""],onChange:t=>o(ve(t))},{type:"input",label:a("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:r,onChange:t=>o(we(t)),hidden:c!=="new"},{type:"select",label:a("Official language"),value:l,options:d,onChange:t=>o(Se(t||void 0)),hidden:c!=="new"}];return e.jsxs(D,{as:"section",children:[e.jsx(S,{as:"h5",size:"sm",mb:2,children:a("Country/Region")}),e.jsx(N,{fields:p}),c==="new"&&e.jsx(re,{entries:u,onUpdate:(t,n)=>o(ke({lang:t,name:n})),onLangSwitch:(t,n)=>o(Ee({prevLang:t,nextLang:n})),onRemove:t=>o(Le(t))})]})}function et(){const{t:a,i18n:s}=y(),i=k(),o=M(),{country:c,city:r,newCity:u,cityName:l}=E(t=>t.ticket),m={...Re.filter(t=>t.country===c).map(t=>[t.id,o(t.name)]).sort((t,n)=>t[1].localeCompare(n[1],s.languages[0])).reduce((t,n)=>({...t,[n[0]]:n[1]}),{"":a("Please select...")}),new:a("Add a city")+"..."},d=async t=>{if(t==="new"){i(Ie("new"));return}const n=await ze(t);i(n?De(n):Te())},p=[{type:"select",label:a("City"),value:r,options:m,disabledOptions:[""],onChange:t=>d(t)},{type:"input",label:a("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:u,onChange:t=>i(Ne(t)),validator:t=>t!==""&&!t.match(/[^a-z]/),hidden:r!=="new"}];return e.jsxs(D,{as:"section",children:[e.jsx(S,{as:"h5",size:"sm",mt:3,mb:2,children:a("City")}),e.jsx(N,{fields:p}),r==="new"&&e.jsx(re,{entries:l,onUpdate:(t,n)=>i(Me({lang:t,name:n})),onLangSwitch:(t,n)=>i(Oe({prevLang:t,nextLang:n})),onRemove:t=>i(Pe(t))})]})}const tt=a=>`{ getColor(code:"${a}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,ce=async(a,s)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:tt(a)}),signal:s})).json()).data.getColor.hex;function nt(){const{t:a}=y(),s=k(),{pantoneReady:i}=E(o=>o.app);return x.useEffect(()=>{const o=new AbortController;return ce("130 C",o.signal).then(c=>s(K(!!c))).catch(()=>s(K(!1))),()=>{o.abort()}},[]),e.jsx(T,{as:"i",fontSize:"xs",children:i===void 0?a("Checking Pantone service availability..."):i?a("Pantone service is ready")+" ✅":a("Pantone service is not available")+" ⚠️"})}function st(a){var f;const{lineDetail:s,onUpdate:i}=a,{t:o}=y(),{pantoneReady:c}=E(h=>h.app),[r,u]=x.useState(s.pantone?"pantone":"hex"),[l,m]=x.useState((f=s.pantone)!=null?f:""),d=x.useRef(new AbortController);x.useEffect(()=>()=>{var h;(h=d.current)==null||h.abort()},[]);const p=async h=>{var g;if(d.current.abort(),!!c){d.current=new AbortController;try{const C=await ce(h,d.current.signal);i({pantone:h,colour:C}),m(h)}catch(C){ye.flushSync(()=>{m(h)}),m((g=s.pantone)!=null?g:"")}}},t=[{label:"RGB",value:"hex"},{label:o("Pantone"),value:"pantone"}],n=[{type:"input",label:o("Line code"),placeholder:"e.g. twl, gz1, sh1",value:s.id,onChange:h=>i({id:h}),validator:h=>h!==""&&!h.match(/[^a-z0-9]/)},{type:"custom",label:o("Colour mode"),component:e.jsx(Ae,{selections:t,defaultValue:r,onChange:h=>u(h)}),hidden:!c},{type:"input",label:o("Background colour"),variant:"color",value:s.colour,onChange:h=>i({colour:h}),hidden:c&&r==="pantone"},{type:"input",label:o("Pantone code"),value:l,onChange:p,debouncedDelay:1500,hidden:!c||r!=="pantone"},{type:"select",label:o("Foreground colour"),value:s.fg,options:{[W.white]:o("White"),[W.black]:o("Black")},onChange:h=>i({fg:h})}];return e.jsx(N,{fields:n})}function ot(a){const{lineDetail:s,editable:i,onUpdate:o,onCopy:c,onRemove:r,onNameUpdate:u,onLangSwitch:l,onNameRemove:m}=a,{t:d}=y(),p=M(),[t,n]=x.useState(!1),f=x.useMemo(()=>({bg:s.colour,m:-1,w:"calc(100% + var(--chakra-space-1) * 2)",px:2,"&, button":{color:s.fg},"& > div":{ml:"auto"}}),[s.colour,s.fg]),h=p(Object.fromEntries(s.nameEntity));return e.jsxs(q,{direction:"column",sx:{pb:0},children:[e.jsxs(q,{sx:f,children:[h,i&&e.jsxs(R,{spacing:.5,children:[e.jsx(L,{size:"xs",variant:"ghost","aria-label":d("Edit")+" "+h,title:d("Edit")+" "+h,icon:e.jsx($e,{}),onClick:()=>n(g=>!g)}),e.jsx(L,{size:"xs",variant:"ghost","aria-label":d("Copy")+" "+h,title:d("Copy")+" "+h,icon:e.jsx(oe,{}),onClick:c}),e.jsx(L,{size:"xs",variant:"ghost","aria-label":d("Remove")+" "+h,title:d("Remove")+" "+h,icon:e.jsx(se,{}),onClick:r})]})]}),t&&e.jsxs(I,{direction:"column",my:1,children:[e.jsx(st,{lineDetail:s,onUpdate:g=>o==null?void 0:o(g)}),e.jsx(ie,{entries:s.nameEntity,onUpdate:(g,C)=>u==null?void 0:u(g,C),onLangSwitch:(g,C)=>l==null?void 0:l(g,C),onRemove:g=>m==null?void 0:m(g)})]})]})}function at(){const{t:a}=y(),s=k(),i=E(o=>o.ticket.lines);return e.jsxs(D,{as:"section",children:[e.jsxs(I,{mt:3,mb:2,alignItems:"center",children:[e.jsx(S,{as:"h5",size:"sm",mr:"auto",children:a("Lines")}),e.jsx(nt,{})]}),e.jsxs(pe,{spacing:1,children:[Object.entries(i).map(([o,c])=>e.jsx(ot,{lineDetail:c,editable:!0,onUpdate:r=>s(Be({entryId:o,updates:r})),onCopy:()=>s(Fe(o)),onRemove:()=>s(Ue(o)),onNameUpdate:(r,u)=>s(Je({entryId:o,lang:r,name:u})),onLangSwitch:(r,u)=>s(Ge({entryId:o,prevLang:r,nextLang:u})),onNameRemove:r=>s(_e({entryId:o,lang:r}))},o)),e.jsx(j,{size:"xs",variant:"ghost",leftIcon:e.jsx(ne,{}),ml:"auto !important",onClick:()=>s(qe()),children:a("Add a line")})]})]})}function it(a){const{countryErrors:s,cityErrors:i,lineErrors:o,onIgnore:c,onClose:r}=a,{t:u}=y(),l=M();return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(T,{children:u("Your inputs contain the following errors. Please consider fixing it before submitting.")}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{as:"h5",size:"sm",my:2,children:u("Country/Region")}),e.jsx(P,{"aria-label":"List of country errors",children:s.map((m,d)=>e.jsx(w,{children:l(J[m])},d))})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{as:"h5",size:"sm",my:2,children:u("City")}),e.jsx(P,{"aria-label":"List of city errors",children:i.map((m,d)=>e.jsx(w,{children:l(J[m])},d))})]}),Object.values(o).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{as:"h5",size:"sm",my:2,children:u("Lines")}),e.jsx(P,{"aria-label":"List of line errors",children:Object.entries(o).map(([m,d])=>e.jsxs(w,{children:[m,e.jsx(P,{children:d.map((p,t)=>e.jsx(w,{children:l(J[p])},t))})]},m))})]})]}),e.jsx(B,{children:e.jsxs(R,{children:[e.jsx(j,{onClick:c,children:u("Submit anyway")}),e.jsx(j,{colorScheme:"primary",onClick:r,children:u("Go back")})]})})]})}const $=a=>{var s;return!!((s=a.match(/^https?:\/\//))!=null&&s[0])};function rt(a){const{refLink:s,onRefLinkChange:i,justification:o,onJustificationChange:c,onPrev:r,onNext:u}=a,{t:l}=y(),m=[{type:"input",value:s,label:l("Reference link"),placeholder:l("Enter a valid URL"),onChange:i,validator:$},{type:"textarea",value:o,label:l("Justification"),placeholder:l("Briefly describe your changes and provide justification"),onChange:c}],d=!s||!o||!$(s);return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(T,{children:l("Please provide suitable source and justification.")}),e.jsx(N,{fields:m,minW:"full"})]}),e.jsxs(B,{children:[r&&e.jsx(j,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e.jsx(ae,{}),children:l("Previous")}),e.jsx(j,{colorScheme:"primary",onClick:u,rightIcon:e.jsx(Ye,{}),isDisabled:d,children:l("Next")})]})]})}function ct(a){var h,g;const{countryEntry:s,cityEntry:i,paletteList:o,refLink:c,justification:r,onPrev:u}=a,{t:l}=y(),m=xe("primary.500","primary.300"),d=x.useRef(null),p=[`**Reference link:** ${c||"(REPLACE ME)"}`,`**Justification:** ${r||"(REPLACE ME)"}`,He,G("country",s),G("city",i),G("lines",o)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((h=i==null?void 0:i.name)==null?void 0:h.en),body:p}),n=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((g=i==null?void 0:i.name)==null?void 0:g.en)}),f=async()=>{d!=null&&d.current&&(d.current.select(),await navigator.clipboard.writeText(p))};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(T,{children:l("If the button below doesn't work for you, please follow the instructions below:")}),e.jsxs(ge,{children:[e.jsxs(w,{children:[l("Open")," ",e.jsxs(fe,{color:m,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+n.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e.jsx(je,{as:Qe})]})]}),e.jsxs(w,{children:[l("Paste following text to the issue body")," ",e.jsx(j,{size:"xs",leftIcon:e.jsx(oe,{}),onClick:f,children:l("Copy")}),e.jsx(Ve,{ref:d,isReadOnly:!0,defaultValue:p,onClick:({target:C})=>C.select()})]})]})]}),e.jsxs(B,{children:[e.jsx(j,{variant:"ghost",onClick:u,mr:"auto",leftIcon:e.jsx(ae,{}),children:l("Previous")}),e.jsx(j,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:l("1-click open issue")})]})]})}function lt(a){const{isOpen:s,onClose:i}=a,{t:o}=y(),[c,r]=x.useState([]),[u,l]=x.useState([]),[m,d]=x.useState({}),[p,t]=x.useState(""),[n,f]=x.useState(""),[h,g]=x.useState(!1),[C,F]=x.useState(!1),b=E(me=>me.ticket),le=v.getCountryEntry(b),de=v.getCityEntry(b),ue=v.getPalettes(b);x.useEffect(()=>{s?(r(v.getCountryErrors(b)),l(v.getCityErrors(b)),d(v.getLineErrors(b))):(g(!1),t(""),f(""),F(!1))},[s]);const V=c.length>0||u.length>0||Object.values(m).flat().length>0,O=V&&!h,U=!O&&!C,he=()=>{!O&&!U&&window.localStorage.removeItem(z),i()};return e.jsxs(Y,{blockScrollOnMount:!1,isOpen:s,onClose:i,scrollBehavior:"inside",children:[e.jsx(Q,{}),e.jsxs(Z,{children:[e.jsx(X,{children:o("Submit palettes")}),e.jsx(ee,{onClick:he}),O&&e.jsx(it,{countryErrors:c,cityErrors:u,lineErrors:m,onIgnore:()=>g(!0),onClose:i}),U&&e.jsx(rt,{refLink:p,onRefLinkChange:t,justification:n,onJustificationChange:f,onPrev:V?()=>g(!1):void 0,onNext:()=>F(!0)}),!O&&!U&&e.jsx(ct,{countryEntry:le,cityEntry:de,paletteList:ue,refLink:p,justification:n,onPrev:()=>F(!1)})]})]})}function dt(a){const{isOpen:s,onClose:i,incomingState:o}=a,{t:c}=y(),r=k(),u=()=>{window.localStorage.removeItem(z),i()},l=()=>{o&&r(te(o)),i()};return e.jsxs(Y,{isOpen:s,onClose:i,children:[e.jsx(Q,{}),e.jsxs(Z,{children:[e.jsx(X,{children:c("Unsaved draft")}),e.jsx(ee,{}),e.jsx(A,{children:c("Do you want to continue with your last unsaved ticket?")}),e.jsx(B,{children:e.jsxs(R,{children:[e.jsx(j,{onClick:u,children:c("Discard")}),e.jsx(j,{colorScheme:"primary",onClick:l,children:c("Continue")})]})})]})]})}function gt(){const{t:a}=y(),s=k(),i=Ce(),[o,c]=x.useState(),[r,u]=x.useState(!1),[l,m]=x.useState(!1);x.useEffect(()=>{const t=window.localStorage.getItem(z);if(t)try{const n=JSON.parse(t);Object.keys(n.lines).length>0&&Object.values(n.lines)[0].id&&(c(n),u(!0))}catch(n){console.error("TicketView:: unable to restore draft ticket",t)}},[]);const d=()=>{_.isStandaloneWindow()?i("/"):_.openApp("rmg-palette")},p=()=>{s(te()),window.localStorage.removeItem(z),_.event(We.RESET_TICKET,{})};return e.jsxs(Ke,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[e.jsxs(I,{direction:"column",flex:1,overflowY:"auto",children:[e.jsx(Xe,{}),e.jsx(et,{}),e.jsx(at,{})]}),e.jsxs(I,{my:2,children:[e.jsx(j,{size:"sm",onClick:d,children:a("Go back")}),e.jsxs(R,{ml:"auto",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:p,children:a("Reset")}),e.jsx(j,{size:"sm",colorScheme:"primary",onClick:()=>m(!0),children:a("Submit")})]})]}),e.jsx(dt,{isOpen:r,onClose:()=>u(!1),incomingState:o}),e.jsx(lt,{isOpen:l,onClose:()=>m(!1)})]})}export{gt as default};
