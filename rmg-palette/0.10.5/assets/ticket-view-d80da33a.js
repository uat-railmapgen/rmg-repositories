import{j as e,_ as O,H as k,B as U,Z as M,t as B,F as A,$ as xe,f,s as F,a0 as I,e as R,v as J,w as ge,a1 as je,x as fe,a2 as ye,a3 as Z,M as X,a4 as ee,q as te,r as ne}from"./chakra-4c4a0221.js";import{u as y,r as g,a as Ce,n as be}from"./react-af516715.js";import{f as V,L as K,c as N,a as b,h as ve,i as ke,j as we,k as Se,l as Le,m as Ee,n as Re,o as Me,q as Ne,t as Oe,v as Pe,g as De,p as ze,w as Ie,x as $,y as Ae,M as Y,z as Te,A as Ue,B as Be,C as Fe,D as Je,F as Ge,G as _e,H as qe,I as He,J as q,K as Ve,N as H,O as Ke,P as E,r as w,Q as T,S as se,d as We,e as $e,E as Ye}from"./index-8a4db006.js";import{R as P,a as oe,b as ae,c as Qe,d as Ze,M as Xe,e as ie,f as re,g as et,h as tt}from"./index.esm-6b161bc5.js";import{u as D}from"./use-translated-name-b1cd0e7b.js";const nt={"& > div:first-of-type":{flex:1}},ce=o=>{var d;const{onUpdate:n,onLangSwitch:a,onRemove:s}=o,c=(d=o.entries)!=null?d:[],{t:r}=y(),u=D(),l=(h,p)=>[{type:"select",label:r("Language"),value:h,options:Object.entries(K).reduce((t,i)=>({...t,[i[0]]:u(i[1])}),{}),disabledOptions:c.filter(t=>t[0]!==h).map(t=>t[0]),onChange:t=>a(h,t)},{type:"input",label:r("Name"),value:p,onChange:t=>n(h,t),validator:t=>!!t}],m=()=>{const h=Object.keys(K).filter(p=>!c.find(t=>t[0]===p))[0];n(h,"")};return e.jsx(e.Fragment,{children:c.map(([h,p],t,i)=>e.jsxs(O,{sx:nt,"data-testid":"entry-card-stack-"+h,children:[e.jsx(P,{fields:l(h,p),noLabel:t>0}),t===i.length-1?e.jsx(k,{size:"sm",variant:"ghost","aria-label":r("Add a name in another language"),title:r("Add a name in another language"),onClick:m,icon:e.jsx(oe,{})}):e.jsx(U,{minW:8}),i.length>1&&e.jsx(k,{size:"sm",variant:"ghost","aria-label":r("Remove this name"),title:r("Remove this name"),onClick:()=>s(h),icon:e.jsx(ae,{})})]},t))})};function le(o){return e.jsx(V,{direction:"column",children:e.jsx(ce,{...o})})}function st(){const{t:o,i18n:n}=y(),a=D(),s=N(),{countryList:c}=b(t=>t.app),{country:r,newCountry:u,countryName:l,newCountryLang:m}=b(t=>t.ticket),d={...c.map(t=>[t.id,a(t.name)]).sort((t,i)=>t[1].localeCompare(i[1],n.languages[0])).reduce((t,i)=>i[0]==="UN"?t:{...t,[i[0]]:i[1]},{"":o("Please select...")}),new:o("Add a country/region...")},h=Object.entries(K).reduce((t,i)=>({...t,[i[0]]:a(i[1])}),{}),p=[{type:"select",label:o("Country/Region"),value:r,options:d,disabledOptions:[""],onChange:t=>s(ve(t))},{type:"input",label:o("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:u,onChange:t=>s(ke(t)),hidden:r!=="new"},{type:"select",label:o("Official language"),value:m,options:h,onChange:t=>s(we(t||void 0)),hidden:r!=="new"}];return e.jsxs(U,{as:"section",children:[e.jsx(M,{as:"h5",size:"sm",mb:2,children:o("Country/Region")}),e.jsx(P,{fields:p}),r==="new"&&e.jsx(le,{entries:l,onUpdate:(t,i)=>s(Se({lang:t,name:i})),onLangSwitch:(t,i)=>s(Le({prevLang:t,nextLang:i})),onRemove:t=>s(Ee(t))})]})}function ot(){const{t:o,i18n:n}=y(),a=N(),s=D(),{cityList:c}=b(t=>t.app),{country:r,city:u,newCity:l,cityName:m}=b(t=>t.ticket),d={...c.filter(t=>t.country===r).map(t=>[t.id,s(t.name)]).sort((t,i)=>t[1].localeCompare(i[1],n.languages[0])).reduce((t,i)=>({...t,[i[0]]:i[1]}),{"":o("Please select...")}),new:o("Add a city")+"..."},h=async t=>{if(t==="new"){a(Pe("new"));return}const i=await De(t,c);a(i?ze(i):Ie())},p=[{type:"select",label:o("City"),value:u,options:d,disabledOptions:[""],onChange:t=>h(t)},{type:"input",label:o("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:l,onChange:t=>a(Re(t)),validator:t=>t!==""&&!t.match(/[^a-z]/),hidden:u!=="new"}];return e.jsxs(U,{as:"section",children:[e.jsx(M,{as:"h5",size:"sm",mt:3,mb:2,children:o("City")}),e.jsx(P,{fields:p}),u==="new"&&e.jsx(le,{entries:m,onUpdate:(t,i)=>a(Me({lang:t,name:i})),onLangSwitch:(t,i)=>a(Ne({prevLang:t,nextLang:i})),onRemove:t=>a(Oe(t))})]})}const at=o=>`{ getColor(code:"${o}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,de=async(o,n)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:at(o)}),signal:n})).json()).data.getColor.hex;function it(){const{t:o}=y(),n=N(),{pantoneReady:a}=b(s=>s.app);return g.useEffect(()=>{const s=new AbortController;return de("130 C",s.signal).then(c=>n($(!!c))).catch(()=>n($(!1))),()=>{s.abort()}},[]),e.jsx(B,{as:"i",fontSize:"xs",children:a===void 0?o("Checking Pantone service availability..."):a?o("Pantone service is ready")+" ✅":o("Pantone service is not available")+" ⚠️"})}function rt(o){var i;const{lineDetail:n,onUpdate:a}=o,{t:s}=y(),{pantoneReady:c}=b(x=>x.app),[r,u]=g.useState(n.pantone?"pantone":"hex"),[l,m]=g.useState((i=n.pantone)!=null?i:""),d=g.useRef(new AbortController);g.useEffect(()=>()=>{var x;(x=d.current)==null||x.abort()},[]);const h=async x=>{var C;if(d.current.abort(),!!c){d.current=new AbortController;try{const v=await de(x,d.current.signal);a({pantone:x,colour:v}),m(x)}catch(v){Ce.flushSync(()=>{m(x)}),m((C=n.pantone)!=null?C:"")}}},p=[{label:"RGB",value:"hex"},{label:s("Pantone"),value:"pantone"}],t=[{type:"input",label:s("Line code"),placeholder:"e.g. twl, gz1, sh1",value:n.id,onChange:x=>a({id:x}),validator:x=>x!==""&&!x.match(/[^a-z0-9]/)},{type:"custom",label:s("Colour mode"),component:e.jsx(Ae,{selections:p,defaultValue:r,onChange:x=>u(x)}),hidden:!c},{type:"input",label:s("Background colour"),variant:"color",value:n.colour,onChange:x=>a({colour:x}),hidden:c&&r==="pantone"},{type:"input",label:s("Pantone code"),value:l,onChange:h,debouncedDelay:1500,hidden:!c||r!=="pantone"},{type:"select",label:s("Foreground colour"),value:n.fg,options:{[Y.white]:s("White"),[Y.black]:s("Black")},onChange:x=>a({fg:x})}];return e.jsx(P,{fields:t})}function ct(o){const{lineDetail:n,editable:a,onUpdate:s,onMoveUp:c,onMoveDown:r,onCopy:u,onRemove:l,onNameUpdate:m,onLangSwitch:d,onNameRemove:h}=o,{t:p}=y(),t=D(),[i,x]=g.useState(!1),C=g.useMemo(()=>({bg:n.colour,m:-1,w:"calc(100% + var(--chakra-space-1) * 2)",px:2,"&, button":{color:n.fg},"& > div":{ml:"auto"}}),[n.colour,n.fg]),v=t(Object.fromEntries(n.nameEntity));return e.jsxs(V,{direction:"column",sx:{pb:0},children:[e.jsxs(V,{sx:C,children:[v,a&&e.jsxs(O,{spacing:.5,children:[e.jsx(k,{size:"xs",variant:"ghost","aria-label":p("Move up"),title:p("Move up"),icon:e.jsx(Qe,{}),onClick:c}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":p("Move down"),title:p("Move down"),icon:e.jsx(Ze,{}),onClick:r}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":p("Edit"),title:p("Edit"),icon:e.jsx(Xe,{}),onClick:()=>x(j=>!j)}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":p("Duplicate"),title:p("Duplicate"),icon:e.jsx(ie,{}),onClick:u}),e.jsx(k,{size:"xs",variant:"ghost","aria-label":p("Remove"),title:p("Remove"),icon:e.jsx(ae,{}),onClick:l})]})]}),i&&e.jsxs(A,{direction:"column",my:1,children:[e.jsx(rt,{lineDetail:n,onUpdate:j=>s==null?void 0:s(j)}),e.jsx(ce,{entries:n.nameEntity,onUpdate:(j,S)=>m==null?void 0:m(j,S),onLangSwitch:(j,S)=>d==null?void 0:d(j,S),onRemove:j=>h==null?void 0:h(j)})]})]})}function lt(){const{t:o}=y(),n=N(),a=b(s=>s.ticket.lines);return e.jsxs(U,{as:"section",children:[e.jsxs(A,{mt:3,mb:2,alignItems:"center",children:[e.jsx(M,{as:"h5",size:"sm",mr:"auto",children:o("Lines")}),e.jsx(it,{})]}),e.jsxs(xe,{spacing:1,children:[Object.entries(a).map(([s,c])=>e.jsx(ct,{lineDetail:c,editable:!0,onUpdate:r=>n(Te({entryId:s,updates:r})),onMoveUp:()=>n(Ue(s)),onMoveDown:()=>n(Be(s)),onCopy:()=>n(Fe(s)),onRemove:()=>n(Je(s)),onNameUpdate:(r,u)=>n(Ge({entryId:s,lang:r,name:u})),onLangSwitch:(r,u)=>n(_e({entryId:s,prevLang:r,nextLang:u})),onNameRemove:r=>n(qe({entryId:s,lang:r}))},s)),e.jsx(f,{size:"xs",variant:"ghost",leftIcon:e.jsx(oe,{}),ml:"auto !important",onClick:()=>n(He()),children:o("Add a line")})]})]})}function dt(o){const{countryErrors:n,cityErrors:a,lineErrors:s,onIgnore:c,onClose:r}=o,{t:u}=y(),l=D();return e.jsxs(e.Fragment,{children:[e.jsxs(F,{children:[e.jsx(B,{children:u("Your inputs contain the following errors. Please consider fixing it before submitting.")}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"h5",size:"sm",my:2,children:u("Country/Region")}),e.jsx(I,{"aria-label":"List of country errors",children:n.map((m,d)=>e.jsx(R,{children:l(q[m])},d))})]}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"h5",size:"sm",my:2,children:u("City")}),e.jsx(I,{"aria-label":"List of city errors",children:a.map((m,d)=>e.jsx(R,{children:l(q[m])},d))})]}),Object.values(s).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(M,{as:"h5",size:"sm",my:2,children:u("Lines")}),e.jsx(I,{"aria-label":"List of line errors",children:Object.entries(s).map(([m,d])=>e.jsxs(R,{children:[m,e.jsx(I,{children:d.map((h,p)=>e.jsx(R,{children:l(q[h])},p))})]},m))})]})]}),e.jsx(J,{children:e.jsxs(O,{children:[e.jsx(f,{onClick:c,children:u("Submit anyway")}),e.jsx(f,{colorScheme:"primary",onClick:r,children:u("Go back")})]})})]})}const Q=o=>{var n;return!!((n=o.match(/^https?:\/\//))!=null&&n[0])};function ut(o){const{refLink:n,onRefLinkChange:a,justification:s,onJustificationChange:c,onPrev:r,onNext:u}=o,{t:l}=y(),m=[{type:"input",value:n,label:l("Reference link"),placeholder:l("Enter a valid URL"),onChange:a,validator:Q},{type:"textarea",value:s,label:l("Justification"),placeholder:l("Briefly describe your changes and provide justification"),onChange:c}],d=!n||!s||!Q(n);return e.jsxs(e.Fragment,{children:[e.jsxs(F,{children:[e.jsx(B,{children:l("Please provide suitable source and justification.")}),e.jsx(P,{fields:m,minW:"full"})]}),e.jsxs(J,{children:[r&&e.jsx(f,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e.jsx(re,{}),children:l("Previous")}),e.jsx(f,{colorScheme:"primary",onClick:u,rightIcon:e.jsx(et,{}),isDisabled:d,children:l("Next")})]})]})}function ht(o){var x,C;const{countryEntry:n,cityEntry:a,paletteList:s,refLink:c,justification:r,onPrev:u}=o,{t:l}=y(),m=ge("primary.500","primary.300"),d=g.useRef(null),h=[`**Reference link:** ${c||"(REPLACE ME)"}`,`**Justification:** ${r||"(REPLACE ME)"}`,Ve,H("country",n),H("city",a),H("lines",s)].join(`

`),p=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((x=a==null?void 0:a.name)==null?void 0:x.en),body:h}),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((C=a==null?void 0:a.name)==null?void 0:C.en)}),i=async()=>{d!=null&&d.current&&(d.current.select(),await navigator.clipboard.writeText(h))};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{children:[e.jsx(B,{children:l("If the button below doesn't work for you, please follow the instructions below:")}),e.jsxs(je,{children:[e.jsxs(R,{children:[l("Open")," ",e.jsxs(fe,{color:m,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e.jsx(ye,{as:tt})]})]}),e.jsxs(R,{children:[l("Paste following text to the issue body")," ",e.jsx(f,{size:"xs",leftIcon:e.jsx(ie,{}),onClick:i,children:l("Copy")}),e.jsx(Ke,{ref:d,isReadOnly:!0,defaultValue:h,onClick:({target:v})=>v.select()})]})]})]}),e.jsxs(J,{children:[e.jsx(f,{variant:"ghost",onClick:u,mr:"auto",leftIcon:e.jsx(re,{}),children:l("Previous")}),e.jsx(f,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+p.toString(),"_blank"),children:l("1-click open issue")})]})]})}function pt(o){const{isOpen:n,onClose:a}=o,{t:s}=y(),[c,r]=g.useState([]),[u,l]=g.useState([]),[m,d]=g.useState({}),[h,p]=g.useState(""),[t,i]=g.useState(""),[x,C]=g.useState(!1),[v,j]=g.useState(!1),{countryList:S}=b(_=>_.app),L=b(_=>_.ticket),ue=E.getCountryEntry(L),he=E.getCityEntry(L),pe=E.getPalettes(L);g.useEffect(()=>{n?(r(E.getCountryErrors(L)),l(E.getCityErrors(L,S)),d(E.getLineErrors(L,S))):(C(!1),p(""),i(""),j(!1))},[n]);const W=c.length>0||u.length>0||Object.values(m).flat().length>0,z=W&&!x,G=!z&&!v,me=()=>{!z&&!G&&w.storage.remove(T),a()};return e.jsxs(Z,{blockScrollOnMount:!1,isOpen:n,onClose:a,scrollBehavior:"inside",children:[e.jsx(X,{}),e.jsxs(ee,{children:[e.jsx(te,{children:s("Submit palettes")}),e.jsx(ne,{onClick:me}),z&&e.jsx(dt,{countryErrors:c,cityErrors:u,lineErrors:m,onIgnore:()=>C(!0),onClose:a}),G&&e.jsx(ut,{refLink:h,onRefLinkChange:p,justification:t,onJustificationChange:i,onPrev:W?()=>C(!1):void 0,onNext:()=>j(!0)}),!z&&!G&&e.jsx(ht,{countryEntry:ue,cityEntry:he,paletteList:pe,refLink:h,justification:t,onPrev:()=>j(!1)})]})]})}function mt(o){const{isOpen:n,onClose:a,incomingState:s}=o,{t:c}=y(),r=N(),u=()=>{w.storage.remove(T),a()},l=()=>{s&&r(se(s)),a()};return e.jsxs(Z,{isOpen:n,onClose:a,children:[e.jsx(X,{}),e.jsxs(ee,{children:[e.jsx(te,{children:c("Unsaved draft")}),e.jsx(ne,{}),e.jsx(F,{children:c("Do you want to continue with your last unsaved ticket?")}),e.jsx(J,{children:e.jsxs(O,{children:[e.jsx(f,{onClick:u,children:c("Discard")}),e.jsx(f,{colorScheme:"primary",onClick:l,children:c("Continue")})]})})]})]})}function Ct(){const{t:o}=y(),n=N(),a=be(),{isDataLoading:s}=b(t=>t.app),[c,r]=g.useState(),[u,l]=g.useState(!1),[m,d]=g.useState(!1);g.useEffect(()=>{const t=w.storage.get(T);if(t)try{const i=JSON.parse(t);Object.keys(i.lines).length>0&&Object.values(i.lines)[0].id&&(r(i),l(!0))}catch(i){console.error("TicketView:: unable to restore draft ticket",t)}},[]);const h=()=>{w.isStandaloneWindow()?a("/"):w.openApp("rmg-palette")},p=()=>{n(se()),w.storage.remove(T),w.event(Ye.RESET_TICKET,{})};return e.jsxs(We,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[s&&e.jsx($e,{isIndeterminate:!0}),e.jsxs(A,{direction:"column",flex:1,overflowY:"auto",children:[e.jsx(st,{}),e.jsx(ot,{}),e.jsx(lt,{})]}),e.jsxs(A,{my:2,children:[e.jsx(f,{size:"sm",onClick:h,children:o("Go back")}),e.jsxs(O,{ml:"auto",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:p,children:o("Reset")}),e.jsx(f,{size:"sm",colorScheme:"primary",onClick:()=>d(!0),children:o("Submit")})]})]}),e.jsx(mt,{isOpen:u,onClose:()=>l(!1),incomingState:c}),e.jsx(pt,{isOpen:m,onClose:()=>d(!1)})]})}export{Ct as default};
