import{j as s,$ as v,Z as U,a5 as W,a6 as z,H,a7 as G,_ as K,f as L}from"./chakra-4c4a0221.js";import{a as A,T as k,M as j,b as w,y as R,c as X,r as S,E as b,d as Z,e as q,U as J}from"./index-8a4db006.js";import{u as I,r as C,o as Q}from"./react-af516715.js";import{u as Y}from"./use-palette-bb78e9b7.js";import{R as F,i as T}from"./index.esm-6b161bc5.js";const ee=i=>{const n=i.toUpperCase().split("");return n.length===2?n.map(l=>((l.codePointAt(0)||0)+127397).toString(16).toUpperCase()):n.length===5?["1F3F4",...n.map(l=>((l.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},te=i=>{const n=ee(i);return String.fromCodePoint(...n.map(l=>parseInt(l,16)))};function ne(i){const{defaultValueId:n,onChange:l}=i,{i18n:d}=I(),{cityList:h}=A(e=>e.app),r=n?h.find(e=>e.id===n):void 0,f=e=>{var o,t;return(t=(o=d.languages.map(c=>e.name[c]).find(c=>c!==void 0))!=null?o:e.name.en)!=null?t:""},p=e=>{const o=e.country==="TW"&&["zh-Hans","zh-CN"].includes(d.languages[0]),t=d.languages.map(c=>e.name[c]).find(c=>c!==void 0);return s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"flag-emoji",children:o?"🏴":te(e.country)}),s.jsx("span",{children:t})]})},m=(e,o)=>Object.values(e.name).some(t=>t.toLowerCase().includes(o.toLowerCase())),u=h.slice().sort((e,o)=>e.id==="other"?1:o.id==="other"?-1:f(e).localeCompare(f(o),d.languages[0]));return s.jsx(k,{data:u,displayValue:f,displayHandler:p,predicate:m,defaultValue:r,onChange:e=>l==null?void 0:l(e.id)})}function se(i){const{city:n,defaultValueId:l,onChange:d}=i,{i18n:h}=I(),r=Y(n),f=l?r.find(e=>e.id===l):void 0,p=e=>{var o;return(o=h.languages.map(t=>e.name[t]).find(t=>t!==void 0))!=null?o:""},m=e=>{const o=p(e);return s.jsx(w,{name:o,fg:e.fg||j.white,bg:e.colour})},u=(e,o)=>Object.values(e.name).some(t=>t.includes(o));return s.jsx(k,{data:r,displayValue:p,displayHandler:m,predicate:u,defaultValue:f,onChange:e=>d==null?void 0:d(e.id,e.colour,e.fg||j.white)})}const V=i=>!!i.match(/^#[0-9a-fA-F]{6}$/),oe={flex:1,mx:2,"& .chakra-badge":{fontSize:"1em"},"& > .chakra-stack":{w:"100%",p:2,"& > div":{w:"100%"}},"& h5":{alignSelf:"flex-start"}};function ae(i){const{defaultTheme:n,sessionId:l,onSubmit:d,onClose:h}=i,{t:r}=I(),{recentlyUsed:f}=A(a=>a.app),[p,m]=C.useState(n==null?void 0:n[0]),[u,e]=C.useState(n==null?void 0:n[1]),[o,t]=C.useState((n==null?void 0:n[2])||"#AAAAAA"),[c,g]=C.useState((n==null?void 0:n[3])||j.white),[x,E]=C.useState("color");C.useEffect(()=>{l&&n&&(m(n[0]),e(n[1]),t(n[2]),g(n[3]))},[l,n==null?void 0:n.toString()]);const _=[{label:r("Select"),value:"color"},{label:r("Key in"),value:"text"}],D=[{label:r("Black"),value:j.black},{label:r("White"),value:j.white}],M=[{type:"custom",label:r("City"),component:s.jsx(ne,{defaultValueId:p,onChange:a=>{m(a),e(void 0),t("#AAAAAA"),g(j.white)}})},{type:"custom",label:r("Line"),component:s.jsx(se,{city:p,defaultValueId:u,onChange:(a,y,N)=>{e(a),t(y),g(N)}})}],O=[{type:"custom",label:r("Input mode"),component:s.jsx(R,{selections:_,defaultValue:x,onChange:a=>E(a)})},{type:"input",label:r("Background colour"),variant:x,value:o,placeholder:"#F3D03E",validator:V,onChange:a=>{m("other"),e("other"),t(a)}},{type:"custom",label:r("Foreground colour"),component:s.jsx(R,{selections:D,defaultValue:c,onChange:a=>{m("other"),e("other"),g(a)}})}],P=p&&u&&o&&c&&V(o),$=()=>{if(P){const a=`${p} - ${u}`;d==null||d([p,u,o,c],a)}},B=a=>{m(a[0]),e(a[1]),t(a[2]),g(a[3])};return s.jsxs(s.Fragment,{children:[s.jsxs(v,{sx:oe,children:[s.jsx(w,{name:r("Example"),fg:c,bg:o}),s.jsxs(v,{children:[s.jsx(F,{fields:M}),s.jsx(F,{fields:O})]}),s.jsxs(v,{children:[s.jsx(U,{as:"h5",size:"xs",children:r("Recently used")}),s.jsx(W,{children:f.map(({theme:a,displayName:y})=>s.jsx(z,{children:s.jsx(H,{size:"xs","aria-label":r("Apply"),title:y,mt:"0.45px",color:a[3],bg:a[2],icon:s.jsx(T,{}),onClick:()=>B(a)})},a.join("-")))})]})]}),s.jsx(G,{}),s.jsxs(K,{p:2,justifyContent:"flex-end",children:[s.jsx(L,{size:"sm",onClick:h,children:r("Cancel")}),s.jsx(L,{size:"sm",colorScheme:"primary",onClick:$,isDisabled:!P,children:r("Confirm")})]})]})}const re="rmg-palette-bridge--";function pe(){const[i]=Q(),n=i.get("parentId"),l=i.get("parentComponent"),d=X(),{isDataLoading:h}=A(t=>t.app),[r,f]=C.useState(),[p,m]=C.useState(),u=C.useRef();C.useEffect(()=>{const t=new BroadcastChannel(re+n);u.current=t,S.event(b.APP_CLIP_VIEW_OPENED,{parentComponent:l}),t.onmessage=g=>{const{event:x,data:E}=g.data;console.log(`[${t.name}] Received event from parent component:`,x),x==="OPEN"&&(f(crypto.randomUUID()),m(E))},console.log(`[${t.name}] App clip connection established, parentComponent=${l}`);const c=document.createElement("style");return c.textContent=".rmg-window__header{margin-left: unset;}",document.head.appendChild(c),t.postMessage({event:"LOADED"}),()=>{t.close(),document.head.removeChild(c)}},[]);const e=(t,c)=>{var g,x;console.log(`[${(g=u.current)==null?void 0:g.name}] Emitting SELECT event, theme:`,t),(x=u.current)==null||x.postMessage({event:"SELECT",data:t}),d(J({theme:t,displayName:c})),S.event(b.APP_CLIP_VIEW_SELECT,{parentComponent:l,theme:t})},o=()=>{var t,c;console.log(`[${(t=u.current)==null?void 0:t.name}] Emitting CLOSE event`),(c=u.current)==null||c.postMessage({event:"CLOSE"}),S.event(b.APP_CLIP_VIEW_CLOSED,{parentComponent:l})};return s.jsxs(Z,{children:[h&&s.jsx(q,{isIndeterminate:!0}),s.jsx(ae,{defaultTheme:p,sessionId:r,onSubmit:e,onClose:o})]})}export{pe as default};
