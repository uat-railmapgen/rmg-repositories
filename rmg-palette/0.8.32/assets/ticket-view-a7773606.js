import{f as b,g as e,M as se,j as m,x as z,w as N,G as I,N as A,O as F,H as x,i as y,T as j,Q as ie,D as re,S as G,F as le,U as k,y as C,V as H,W as O,X as w,Y as q,Z as ce,_ as de,$ as ue,a0 as he,a1 as me,a2 as pe,a3 as ge,a4 as ye,a5 as fe,a6 as Ce,t as be,K as ve,r as Se}from"./vendor-16c33e79.js";import{u as B,a as Y,b as Q,M as ke,c as X,d as Z,e as Ee,f as Le}from"./index.esm-6bed8a64.js";import{t as Re,d as J,a as M,u as P,c as we,C as xe,e as Ie,f as Ne,g as Me,h as Pe,i as Oe,r as ze,j as Ae,k as je,l as Be,m as Te,n as Ue,o as De,M as $,q as Fe,v as Ge,w as Je,x as He,y as qe,z as Ve,A as _e,B as We,I as U,G as $e,D,F as R,H as Ke,E as Ye}from"./index-33470f97.js";function V(n){var d;const{onUpdate:a,onAdd:s,onRemove:o}=n,r=(d=n.entries)!=null?d:Re.getInitialState(),{t:i}=b(),p=B(),h=c=>{const t=J.selectById(r,c);if(!t)return[];const{lang:u,name:v}=t,f=Object.entries(F).reduce((l,S)=>({...l,[S[0]]:p(S[1])}),{});return[{type:"select",label:i("Language"),value:u,options:f,onChange:l=>a(c,{lang:l})},{type:"input",label:i("Name"),value:v,onChange:l=>a(c,{name:l}),validator:l=>l!==""}]},g=()=>{const c=Object.keys(F).filter(t=>!Object.values(r.entities).find(u=>(u==null?void 0:u.lang)===t))[0];s(c)};return e(se,{direction:"column",children:J.selectIds(r).map((c,t)=>m(z,{sx:{"& > div:first-of-type":{flex:1}},"data-testid":"entry-card-stack-"+c,children:[e(N,{fields:h(c),noLabel:t>0}),t===r.ids.length-1?e(I,{size:"sm",variant:"ghost","aria-label":i("Add a name in another language"),title:i("Add a name in another language"),onClick:g,icon:e(Y,{})}):e(A,{minW:8}),e(I,{size:"sm",variant:"ghost","aria-label":i("Remove this name"),title:i("Remove this name"),onClick:()=>o(c),icon:e(Q,{})})]},c))})}function Qe(){const{t:n,i18n:a}=b(),s=B(),o=M(),{country:r,newCountry:i,countryName:p,newCountryLang:h}=P(t=>t.ticket),g={...we.map(t=>[t.id,s(t.name)]).sort((t,u)=>t[1].localeCompare(u[1],a.languages[0])).reduce((t,u)=>u[0]===xe.UN?t:{...t,[u[0]]:u[1]},{}),new:n("Add a country/region...")},d=Object.entries(F).reduce((t,u)=>({...t,[u[0]]:s(u[1])}),{}),c=[{type:"select",label:n("Country / Region"),value:r,options:g,onChange:t=>o(Ie(t))},{type:"input",label:n("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:i,onChange:t=>o(Ne(t)),hidden:r!=="new"},{type:"select",label:n("Offical language"),value:h,options:d,onChange:t=>o(Me(t||void 0)),hidden:r!=="new"}];return m(A,{as:"section",children:[e(x,{as:"h5",size:"sm",mb:2,children:n("Country / Region")}),e(N,{fields:c}),r==="new"&&e(V,{entries:p,onUpdate:(t,u)=>o(Pe({id:t,changes:u})),onAdd:t=>o(Oe(t)),onRemove:t=>o(ze(t))})]})}function Xe(){const{t:n}=b(),a=M(),{city:s,cityName:o}=P(i=>i.ticket),r=[{type:"input",label:n("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:s,onChange:i=>a(Ae(i)),validator:i=>i!==""&&!i.match(/[^a-z]/)}];return m(A,{as:"section",children:[e(x,{as:"h5",size:"sm",mt:3,mb:2,children:n("City")}),e(N,{fields:r}),e(V,{entries:o,onUpdate:(i,p)=>a(je({id:i,changes:p})),onAdd:i=>a(Be(i)),onRemove:i=>a(Te(i))})]})}const Ze=n=>`{ getColor(code:"${n}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,ee=async(n,a)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:Ze(n)}),signal:a})).json()).data.getColor.hex;function et(n){const{ready:a,onReady:s}=n,{t:o}=b();return y.useEffect(()=>{const r=new AbortController;return ee("130 C",r.signal).then(i=>s(!!i)).catch(()=>s(!1)),()=>{r.abort()}},[]),e(j,{as:"i",fontSize:"xs",children:a===void 0?o("Checking Pantone service availability..."):a?o("Pantone service is ready")+" ✅":o("Pantone service is not available")+" ⚠️"})}function tt(n){const{entryId:a,pantoneReady:s}=n,{t:o}=b(),r=M(),i=P(l=>l.ticket.lines),p=i[a],[h,g]=y.useState("hex"),[d,c]=y.useState(""),t=y.useRef(new AbortController);y.useEffect(()=>{t.current.abort();const l=i[a];l!=null&&l.pantone?(c(l.pantone),g("pantone")):(c(""),g("hex"))},[a]);const u=async l=>{var S;if(t.current.abort(),!(!p||!s)){t.current=new AbortController;try{const E=await ee(l,t.current.signal);r(Ge({entryId:a,pantone:l,hex:E})),c(l)}catch(E){re.flushSync(()=>{c(l)}),c((S=p.pantone)!=null?S:"")}}},v=[{label:"RGB",value:"hex"},{label:o("Pantone"),value:"pantone"}],f=[{type:"input",label:o("Line code"),placeholder:"e.g. twl, gz1, sh1",value:p.id,onChange:l=>r(Ue({entryId:a,lineId:l})),validator:l=>l!==""&&!l.match(/[^a-z0-9]/)},{type:"custom",label:o("Colour mode"),component:e(ie,{selections:v,defaultValue:h,onChange:l=>g(l)}),hidden:!s},{type:"input",label:o("Background colour"),variant:"color",value:p.colour,onChange:l=>r(De({entryId:a,bgColour:l})),hidden:s&&h==="pantone"},{type:"input",label:o("Pantone code"),value:d,onChange:u,debouncedDelay:1500,hidden:!s||h!=="pantone"},{type:"select",label:o("Foreground colour"),value:p.fg,options:{[$.white]:o("White"),[$.black]:o("Black")},onChange:l=>r(Fe({entryId:a,fgColour:l}))}];return e(N,{fields:f})}function nt(){var g;const{t:n}=b(),a=B(),s=M(),o=P(d=>d.ticket.lines),[r,i]=y.useState(Object.keys(o)[0]),[p,h]=y.useState();return m(A,{as:"section",children:[m(G,{mt:3,mb:2,alignItems:"center",children:[e(x,{as:"h5",size:"sm",mr:"auto",children:n("Lines")}),e(et,{ready:p,onReady:h})]}),m(z,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:[Object.entries(o).map(([d,c])=>{const t=J.selectAll(c.nameEntity).reduce((v,f)=>({...v,[f.lang]:f.name}),{}),u=a(t);return e(le,{name:u,bg:c.colour,fg:c.fg,actions:m(k,{children:[e(I,{size:"xs",variant:"ghost",color:c.fg,"aria-label":n("Edit")+" "+u,title:n("Edit")+" "+u,icon:e(ke,{}),onClick:()=>i(d)}),e(I,{size:"xs",variant:"ghost",color:c.fg,"aria-label":n("Copy")+" "+u,title:n("Copy")+" "+u,icon:e(X,{}),onClick:()=>s(Je(d))}),e(I,{size:"xs",variant:"ghost",color:c.fg,"aria-label":n("Remove")+" "+u,title:n("Remove")+" "+u,icon:e(Q,{}),onClick:()=>s(He(d))})]})},d)}),e(C,{size:"xs",variant:"ghost",leftIcon:e(Y,{}),ml:"auto !important",onClick:()=>s(qe()),children:n("Add a line")})]}),o[r]&&e(tt,{entryId:r,pantoneReady:p}),e(V,{entries:(g=o[r])==null?void 0:g.nameEntity,onUpdate:(d,c)=>s(Ve({entryId:r,id:d,changes:c})),onAdd:d=>s(_e({entryId:r,lang:d})),onRemove:d=>s(We({entryId:r,id:d}))})]})}function at(n){const{countryErrors:a,cityErrors:s,lineErrors:o,onIgnore:r,onClose:i}=n,{t:p}=b(),h=B();return m(k,{children:[m(H,{children:[e(j,{children:p("Your inputs contain the following errors. Please consider fixing it before submitting.")}),a.length>0&&m(k,{children:[e(x,{as:"h5",size:"sm",my:2,children:p("Country / Region")}),e(O,{"aria-label":"List of country errors",children:a.map((g,d)=>e(w,{children:h(U[g])},d))})]}),s.length>0&&m(k,{children:[e(x,{as:"h5",size:"sm",my:2,children:p("City")}),e(O,{"aria-label":"List of city errors",children:s.map((g,d)=>e(w,{children:h(U[g])},d))})]}),Object.values(o).flat().length>0&&m(k,{children:[e(x,{as:"h5",size:"sm",my:2,children:p("Lines")}),e(O,{"aria-label":"List of line errors",children:Object.entries(o).map(([g,d])=>m(w,{children:[g,e(O,{children:d.map((c,t)=>e(w,{children:h(U[c])},t))})]},g))})]})]}),e(q,{children:m(z,{children:[e(C,{onClick:r,children:p("Submit anyway")}),e(C,{colorScheme:"primary",onClick:i,children:p("Go back")})]})})]})}const K=n=>{var a;return!!((a=n.match(/^https?:\/\//))!=null&&a[0])};function ot(n){const{refLink:a,onRefLinkChange:s,justification:o,onJustificationChange:r,onPrev:i,onNext:p}=n,{t:h}=b(),g=[{type:"input",value:a,label:h("Reference link"),placeholder:h("Enter a valid URL"),onChange:s,validator:K},{type:"textarea",value:o,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:r}],d=!a||!o||!K(a);return m(k,{children:[m(H,{children:[e(j,{children:h("Please provide suitable source and justification.")}),e(N,{fields:g,minW:"full"})]}),m(q,{children:[i&&e(C,{variant:"ghost",onClick:i,mr:"auto",leftIcon:e(Z,{}),children:h("Previous")}),e(C,{colorScheme:"primary",onClick:p,rightIcon:e(Ee,{}),isDisabled:d,children:h("Next")})]})]})}function st(n){var f,l;const{countryEntry:a,cityEntry:s,paletteList:o,refLink:r,justification:i,onPrev:p}=n,{t:h}=b(),g=ce("primary.500","primary.300"),d=y.useRef(null),c=[`**Reference link:** ${r||"(REPLACE ME)"}`,`**Justification:** ${i||"(REPLACE ME)"}`,$e,D("country",a),D("city",s),D("lines",o)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((f=s==null?void 0:s.name)==null?void 0:f.en),body:c}),u=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((l=s==null?void 0:s.name)==null?void 0:l.en)}),v=async()=>{d!=null&&d.current&&(d.current.select(),await navigator.clipboard.writeText(c))};return m(k,{children:[m(H,{children:[e(j,{children:h("If the button below doesn't work for you, please follow the instructions below:")}),m(de,{children:[m(w,{children:[h("Open")," ",m(ue,{color:g,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+u.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e(he,{as:Le})]})]}),m(w,{children:[h("Paste following text to the issue body")," ",e(C,{size:"xs",leftIcon:e(X,{}),onClick:v,children:h("Copy")}),e(me,{ref:d,isReadOnly:!0,defaultValue:c,onClick:({target:S})=>S.select()})]})]})]}),m(q,{children:[e(C,{variant:"ghost",onClick:p,mr:"auto",leftIcon:e(Z,{}),children:h("Previous")}),e(C,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:h("1-click open issue")})]})]})}function it(n){const{isOpen:a,onClose:s}=n,{t:o}=b(),[r,i]=y.useState([]),[p,h]=y.useState([]),[g,d]=y.useState({}),[c,t]=y.useState(""),[u,v]=y.useState(""),[f,l]=y.useState(!1),[S,E]=y.useState(!1),L=P(oe=>oe.ticket),te=R.getCountryEntry(L),ne=R.getCityEntry(L),ae=R.getPalettes(L);y.useEffect(()=>{a?(i(R.getCountryErrors(L)),h(R.getCityErrors(L)),d(R.getLineErrors(L))):(l(!1),t(""),v(""),E(!1))},[a]);const _=r.length>0||p.length>0||Object.values(g).flat().length>0,T=_&&!f,W=!T&&!S;return m(pe,{blockScrollOnMount:!1,isOpen:a,onClose:s,scrollBehavior:"inside",children:[e(ge,{}),m(ye,{children:[e(fe,{children:o("Submit palettes")}),e(Ce,{}),T&&e(at,{countryErrors:r,cityErrors:p,lineErrors:g,onIgnore:()=>l(!0),onClose:s}),W&&e(ot,{refLink:c,onRefLinkChange:t,justification:u,onJustificationChange:v,onPrev:_?()=>l(!1):void 0,onNext:()=>E(!0)}),!T&&!W&&e(st,{countryEntry:te,cityEntry:ne,paletteList:ae,refLink:c,justification:u,onPrev:()=>E(!1)})]})]})}function dt(){const{t:n}=b(),a=M(),s=be(),[o,r]=y.useState(!1),i=()=>{a(Ke()),Se.event(Ye.RESET_TICKET,{})};return m(ve,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[m(G,{direction:"column",flex:1,overflowY:"auto",children:[e(Qe,{}),e(Xe,{}),e(nt,{})]}),m(G,{my:2,children:[e(C,{size:"sm",onClick:()=>s("/"),children:n("Go back")}),m(z,{ml:"auto",children:[e(C,{size:"sm",variant:"outline",onClick:i,children:n("Reset")}),e(C,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:n("Submit")})]})]}),e(it,{isOpen:o,onClose:()=>r(!1)})]})}export{dt as default};
