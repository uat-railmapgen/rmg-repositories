import{j as s,a0 as y,_ as N,a6 as U,a7 as W,H,a8 as G,$ as K,f as P}from"./chakra-dca798c1.js";import{a as b,U as F,M as j,b as k,z as L,c as X,r as v,E as S,d as q,e as J,V as Q}from"./index-bfb2b588.js";import{u as A,r as C,o as Y}from"./react-af516715.js";import{u as Z}from"./use-palette-cc6f515a.js";import{R,i as T}from"./index.esm-f8fb6bba.js";const ee=i=>{const n=i.toUpperCase().split("");return n.length===2?n.map(c=>((c.codePointAt(0)||0)+127397).toString(16).toUpperCase()):n.length===5?["1F3F4",...n.map(c=>((c.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},te=i=>{const n=ee(i);return String.fromCodePoint(...n.map(c=>parseInt(c,16)))};function ne(i){const{defaultValueId:n,onChange:c}=i,{i18n:d}=A(),{cityList:h}=b(e=>e.app),r=n?h.find(e=>e.id===n):void 0,f=e=>{var o,t;return(t=(o=d.languages.map(l=>e.name[l]).find(l=>l!==void 0))!=null?o:e.name.en)!=null?t:""},p=e=>{const o=e.country==="TW"&&["zh-Hans","zh-CN"].includes(d.languages[0]),t=d.languages.map(l=>e.name[l]).find(l=>l!==void 0);return s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"flag-emoji",children:o?"🏴":te(e.country)}),s.jsx("span",{children:t})]})},m=(e,o)=>Object.values(e.name).some(t=>t.toLowerCase().includes(o.toLowerCase())),u=h.slice().sort((e,o)=>e.id==="other"?1:o.id==="other"?-1:f(e).localeCompare(f(o),d.languages[0]));return s.jsx(F,{data:u,displayValue:f,displayHandler:p,predicate:m,defaultValue:r,onChange:e=>c==null?void 0:c(e.id)})}function se(i){const{city:n,defaultValueId:c,onChange:d}=i,{i18n:h}=A(),r=Z(n),f=c?r.find(e=>e.id===c):void 0,p=e=>{var o;return(o=h.languages.map(t=>e.name[t]).find(t=>t!==void 0))!=null?o:""},m=e=>{const o=p(e);return s.jsx(k,{name:o,fg:e.fg||j.white,bg:e.colour})},u=(e,o)=>Object.values(e.name).some(t=>t.includes(o));return s.jsx(F,{data:r,displayValue:p,displayHandler:m,predicate:u,defaultValue:f,onChange:e=>d==null?void 0:d(e.id,e.colour,e.fg||j.white)})}const V=i=>!!i.match(/^#[0-9a-fA-F]{6}$/),oe={flex:1,mx:2,"& .chakra-badge":{fontSize:"1em"},"& > .chakra-stack":{w:"100%",p:2,"& > div":{w:"100%"}},"& h5":{alignSelf:"flex-start"}};function ae(i){const{defaultTheme:n,sessionId:c,onSubmit:d,onClose:h}=i,{t:r}=A(),{recentlyUsed:f}=b(a=>a.app),[p,m]=C.useState(n==null?void 0:n[0]),[u,e]=C.useState(n==null?void 0:n[1]),[o,t]=C.useState((n==null?void 0:n[2])||"#AAAAAA"),[l,g]=C.useState((n==null?void 0:n[3])||j.white),[x,w]=C.useState("color");C.useEffect(()=>{c&&n&&(m(n[0]),e(n[1]),t(n[2]),g(n[3]))},[c,n==null?void 0:n.toString()]);const _=[{label:r("Select"),value:"color"},{label:r("Key in"),value:"text"}],D=[{label:r("Black"),value:j.black},{label:r("White"),value:j.white}],M=[{type:"custom",label:r("City"),component:s.jsx(ne,{defaultValueId:p,onChange:a=>{m(a),e(void 0),t("#AAAAAA"),g(j.white)}})},{type:"custom",label:r("Line"),component:s.jsx(se,{city:p,defaultValueId:u,onChange:(a,E,B)=>{e(a),t(E),g(B)}})}],O=[{type:"custom",label:r("Input mode"),component:s.jsx(L,{selections:_,defaultValue:x,onChange:a=>w(a)})},{type:"input",label:r("Background colour"),variant:x,value:o,placeholder:"#F3D03E",validator:V,onChange:a=>{m("other"),e("other"),t(a)}},{type:"custom",label:r("Foreground colour"),component:s.jsx(L,{selections:D,defaultValue:l,onChange:a=>{m("other"),e("other"),g(a)}})}],I=p&&u&&o&&l&&V(o),$=()=>{if(I){const a=`${p} - ${u}`;d==null||d([p,u,o,l],a)}},z=a=>{m(a[0]),e(a[1]),t(a[2]),g(a[3])};return s.jsxs(s.Fragment,{children:[s.jsxs(y,{sx:oe,children:[s.jsx(k,{name:r("Example"),fg:l,bg:o}),s.jsxs(y,{children:[s.jsx(R,{fields:M}),s.jsx(R,{fields:O})]}),s.jsxs(y,{children:[s.jsx(N,{as:"h5",size:"xs",children:r("Recently used")}),s.jsx(U,{children:f.map(({theme:a,displayName:E})=>s.jsx(W,{children:s.jsx(H,{size:"xs","aria-label":r("Apply"),title:E,mt:"0.45px",color:a[3],bg:a[2],icon:s.jsx(T,{}),onClick:()=>z(a)})},a.join("-")))})]})]}),s.jsx(G,{}),s.jsxs(K,{p:2,justifyContent:"flex-end",children:[s.jsx(P,{size:"sm",onClick:h,children:r("Cancel")}),s.jsx(P,{size:"sm",colorScheme:"primary",onClick:$,isDisabled:!I,children:r("Confirm")})]})]})}const re="rmg-palette-bridge--";function pe(){const[i]=Y(),n=i.get("parentId"),c=i.get("parentComponent"),d=X(),{isDataLoading:h}=b(t=>t.app),[r,f]=C.useState(),[p,m]=C.useState(),u=C.useRef();C.useEffect(()=>{const t=new BroadcastChannel(re+n);return u.current=t,v.event(S.APP_CLIP_VIEW_OPENED,{parentComponent:c}),t.onmessage=l=>{const{event:g,data:x}=l.data;console.log(`[${t.name}] Received event from parent component:`,g),g==="OPEN"&&(f(crypto.randomUUID()),m(x))},console.log(`[${t.name}] App clip connection established, parentComponent=${c}`),t.postMessage({event:"LOADED"}),()=>{t.close()}},[]);const e=(t,l)=>{var g,x;console.log(`[${(g=u.current)==null?void 0:g.name}] Emitting SELECT event, theme:`,t),(x=u.current)==null||x.postMessage({event:"SELECT",data:t}),d(Q({theme:t,displayName:l})),v.event(S.APP_CLIP_VIEW_SELECT,{parentComponent:c,theme:t})},o=()=>{var t,l;console.log(`[${(t=u.current)==null?void 0:t.name}] Emitting CLOSE event`),(l=u.current)==null||l.postMessage({event:"CLOSE"}),v.event(S.APP_CLIP_VIEW_CLOSED,{parentComponent:c})};return s.jsxs(q,{children:[h&&s.jsx(J,{isIndeterminate:!0}),s.jsx(ae,{defaultTheme:p,sessionId:r,onSubmit:e,onClose:o})]})}export{pe as default};
