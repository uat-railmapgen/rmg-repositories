import{h as b,i as e,M as he,j as m,y as N,x as O,G as M,N as A,O as q,H as I,l as f,T as B,Q as me,D as pe,U as H,F as ge,V as v,z as y,W as D,X as j,Y as R,Z as U,_ as fe,$ as ye,a0 as Ce,a1 as be,a2 as ve,a3 as $,a4 as Q,a5 as X,a6 as Z,a7 as ee,v as Se,K as ke,r as we}from"./vendor-3f0b8e70.js";import{u as F,a as te,b as ne,M as Le,c as oe,d as ae,e as Ee,f as Re}from"./index.esm-c72f417e.js";import{a as x,u as P,c as Ie,C as xe,d as Me,e as Ne,f as Oe,g as Pe,h as ze,r as je,i as Te,j as Ae,k as Be,l as De,m as Ue,n as Fe,M as W,o as Je,q as Ge,t as _e,v as qe,w as He,x as Ve,y as Ke,z as We,I as G,G as Ye,A as _,B as E,D as T,F as se,E as $e}from"./index-c7498a75.js";const Qe={"& > div:first-of-type":{flex:1}};function V(o){var l;const{onUpdate:a,onLangSwitch:n,onRemove:s}=o,i=(l=o.entries)!=null?l:[],{t:r}=b(),u=F(),h=(c,t)=>[{type:"select",label:r("Language"),value:c,options:Object.entries(q).reduce((d,C)=>({...d,[C[0]]:u(C[1])}),{}),disabledOptions:i.filter(d=>d[0]!==c).map(d=>d[0]),onChange:d=>n(c,d)},{type:"input",label:r("Name"),value:t,onChange:d=>a(c,d),validator:d=>!!d}],g=()=>{const c=Object.keys(q).filter(t=>!i.find(d=>d[0]===t))[0];a(c,"")};return e(he,{direction:"column",children:i.map(([c,t],d,C)=>m(N,{sx:Qe,"data-testid":"entry-card-stack-"+c,children:[e(O,{fields:h(c,t),noLabel:d>0}),d===C.length-1?e(M,{size:"sm",variant:"ghost","aria-label":r("Add a name in another language"),title:r("Add a name in another language"),onClick:g,icon:e(te,{})}):e(A,{minW:8}),C.length>1&&e(M,{size:"sm",variant:"ghost","aria-label":r("Remove this name"),title:r("Remove this name"),onClick:()=>s(c),icon:e(ne,{})})]},d))})}function Xe(){const{t:o,i18n:a}=b(),n=F(),s=x(),{country:i,newCountry:r,countryName:u,newCountryLang:h}=P(t=>t.ticket),g={...Ie.map(t=>[t.id,n(t.name)]).sort((t,d)=>t[1].localeCompare(d[1],a.languages[0])).reduce((t,d)=>d[0]===xe.UN?t:{...t,[d[0]]:d[1]},{}),new:o("Add a country/region...")},l=Object.entries(q).reduce((t,d)=>({...t,[d[0]]:n(d[1])}),{}),c=[{type:"select",label:o("Country / Region"),value:i,options:g,onChange:t=>s(Me(t))},{type:"input",label:o("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:r,onChange:t=>s(Ne(t)),hidden:i!=="new"},{type:"select",label:o("Official language"),value:h,options:l,onChange:t=>s(Oe(t||void 0)),hidden:i!=="new"}];return m(A,{as:"section",children:[e(I,{as:"h5",size:"sm",mb:2,children:o("Country / Region")}),e(O,{fields:c}),i==="new"&&e(V,{entries:u,onUpdate:(t,d)=>s(Pe({lang:t,name:d})),onLangSwitch:(t,d)=>s(ze({prevLang:t,nextLang:d})),onRemove:t=>s(je(t))})]})}function Ze(){const{t:o}=b(),a=x(),{city:n,cityName:s}=P(r=>r.ticket),i=[{type:"input",label:o("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:n,onChange:r=>a(Te(r)),validator:r=>r!==""&&!r.match(/[^a-z]/)}];return m(A,{as:"section",children:[e(I,{as:"h5",size:"sm",mt:3,mb:2,children:o("City")}),e(O,{fields:i}),e(V,{entries:s,onUpdate:(r,u)=>a(Ae({lang:r,name:u})),onLangSwitch:(r,u)=>a(Be({prevLang:r,nextLang:u})),onRemove:r=>a(De(r))})]})}const et=o=>`{ getColor(code:"${o}") { code, rgb { r g b }, hex, cmyk { c m y k } } }`,ie=async(o,a)=>"#"+(await(await fetch("https://4n6dg5ccsfct3lzfssu34boemq.appsync-api.us-east-1.amazonaws.com/graphql",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"da2-sa3lsp2tkzhj3c2ysxbdprl73e"},body:JSON.stringify({query:et(o)}),signal:a})).json()).data.getColor.hex;function tt(o){const{ready:a,onReady:n}=o,{t:s}=b();return f.useEffect(()=>{const i=new AbortController;return ie("130 C",i.signal).then(r=>n(!!r)).catch(()=>n(!1)),()=>{i.abort()}},[]),e(B,{as:"i",fontSize:"xs",children:a===void 0?s("Checking Pantone service availability..."):a?s("Pantone service is ready")+" ✅":s("Pantone service is not available")+" ⚠️"})}function nt(o){const{entryId:a,pantoneReady:n}=o,{t:s}=b(),i=x(),r=P(p=>p.ticket.lines),u=r[a],[h,g]=f.useState("hex"),[l,c]=f.useState(""),t=f.useRef(new AbortController);f.useEffect(()=>{t.current.abort();const p=r[a];p!=null&&p.pantone?(c(p.pantone),g("pantone")):(c(""),g("hex"))},[a]);const d=async p=>{var k;if(t.current.abort(),!(!u||!n)){t.current=new AbortController;try{const w=await ie(p,t.current.signal);i(Ge({entryId:a,pantone:p,hex:w})),c(p)}catch(w){pe.flushSync(()=>{c(p)}),c((k=u.pantone)!=null?k:"")}}},C=[{label:"RGB",value:"hex"},{label:s("Pantone"),value:"pantone"}],S=[{type:"input",label:s("Line code"),placeholder:"e.g. twl, gz1, sh1",value:u.id,onChange:p=>i(Ue({entryId:a,lineId:p})),validator:p=>p!==""&&!p.match(/[^a-z0-9]/)},{type:"custom",label:s("Colour mode"),component:e(me,{selections:C,defaultValue:h,onChange:p=>g(p)}),hidden:!n},{type:"input",label:s("Background colour"),variant:"color",value:u.colour,onChange:p=>i(Fe({entryId:a,bgColour:p})),hidden:n&&h==="pantone"},{type:"input",label:s("Pantone code"),value:l,onChange:d,debouncedDelay:1500,hidden:!n||h!=="pantone"},{type:"select",label:s("Foreground colour"),value:u.fg,options:{[W.white]:s("White"),[W.black]:s("Black")},onChange:p=>i(Je({entryId:a,fgColour:p}))}];return e(O,{fields:S})}function ot(){var g;const{t:o}=b(),a=F(),n=x(),s=P(l=>l.ticket.lines),[i,r]=f.useState(Object.keys(s)[0]),[u,h]=f.useState();return m(A,{as:"section",children:[m(H,{mt:3,mb:2,alignItems:"center",children:[e(I,{as:"h5",size:"sm",mr:"auto",children:o("Lines")}),e(tt,{ready:u,onReady:h})]}),m(N,{flexWrap:"wrap",sx:{"& .chakra-badge":{mb:1}},children:[Object.entries(s).map(([l,c])=>{const t=a(Object.fromEntries(c.nameEntity));return e(ge,{name:t,bg:c.colour,fg:c.fg,actions:m(v,{children:[e(M,{size:"xs",variant:"ghost",color:c.fg,"aria-label":o("Edit")+" "+t,title:o("Edit")+" "+t,icon:e(Le,{}),onClick:()=>r(l)}),e(M,{size:"xs",variant:"ghost",color:c.fg,"aria-label":o("Copy")+" "+t,title:o("Copy")+" "+t,icon:e(oe,{}),onClick:()=>n(_e(l))}),e(M,{size:"xs",variant:"ghost",color:c.fg,"aria-label":o("Remove")+" "+t,title:o("Remove")+" "+t,icon:e(ne,{}),onClick:()=>n(qe(l))})]})},l)}),e(y,{size:"xs",variant:"ghost",leftIcon:e(te,{}),ml:"auto !important",onClick:()=>n(He()),children:o("Add a line")})]}),s[i]&&e(nt,{entryId:i,pantoneReady:u}),e(V,{entries:(g=s[i])==null?void 0:g.nameEntity,onUpdate:(l,c)=>n(Ve({entryId:i,lang:l,name:c})),onLangSwitch:(l,c)=>n(Ke({entryId:i,prevLang:l,nextLang:c})),onRemove:l=>n(We({entryId:i,lang:l}))})]})}function at(o){const{countryErrors:a,cityErrors:n,lineErrors:s,onIgnore:i,onClose:r}=o,{t:u}=b(),h=F();return m(v,{children:[m(D,{children:[e(B,{children:u("Your inputs contain the following errors. Please consider fixing it before submitting.")}),a.length>0&&m(v,{children:[e(I,{as:"h5",size:"sm",my:2,children:u("Country / Region")}),e(j,{"aria-label":"List of country errors",children:a.map((g,l)=>e(R,{children:h(G[g])},l))})]}),n.length>0&&m(v,{children:[e(I,{as:"h5",size:"sm",my:2,children:u("City")}),e(j,{"aria-label":"List of city errors",children:n.map((g,l)=>e(R,{children:h(G[g])},l))})]}),Object.values(s).flat().length>0&&m(v,{children:[e(I,{as:"h5",size:"sm",my:2,children:u("Lines")}),e(j,{"aria-label":"List of line errors",children:Object.entries(s).map(([g,l])=>m(R,{children:[g,e(j,{children:l.map((c,t)=>e(R,{children:h(G[c])},t))})]},g))})]})]}),e(U,{children:m(N,{children:[e(y,{onClick:i,children:u("Submit anyway")}),e(y,{colorScheme:"primary",onClick:r,children:u("Go back")})]})})]})}const Y=o=>{var a;return!!((a=o.match(/^https?:\/\//))!=null&&a[0])};function st(o){const{refLink:a,onRefLinkChange:n,justification:s,onJustificationChange:i,onPrev:r,onNext:u}=o,{t:h}=b(),g=[{type:"input",value:a,label:h("Reference link"),placeholder:h("Enter a valid URL"),onChange:n,validator:Y},{type:"textarea",value:s,label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),onChange:i}],l=!a||!s||!Y(a);return m(v,{children:[m(D,{children:[e(B,{children:h("Please provide suitable source and justification.")}),e(O,{fields:g,minW:"full"})]}),m(U,{children:[r&&e(y,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e(ae,{}),children:h("Previous")}),e(y,{colorScheme:"primary",onClick:u,rightIcon:e(Ee,{}),isDisabled:l,children:h("Next")})]})]})}function it(o){var S,p;const{countryEntry:a,cityEntry:n,paletteList:s,refLink:i,justification:r,onPrev:u}=o,{t:h}=b(),g=fe("primary.500","primary.300"),l=f.useRef(null),c=[`**Reference link:** ${i||"(REPLACE ME)"}`,`**Justification:** ${r||"(REPLACE ME)"}`,Ye,_("country",a),_("city",n),_("lines",s)].join(`

`),t=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((S=n==null?void 0:n.name)==null?void 0:S.en),body:c}),d=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+((p=n==null?void 0:n.name)==null?void 0:p.en)}),C=async()=>{l!=null&&l.current&&(l.current.select(),await navigator.clipboard.writeText(c))};return m(v,{children:[m(D,{children:[e(B,{children:h("If the button below doesn't work for you, please follow the instructions below:")}),m(ye,{children:[m(R,{children:[h("Open")," ",m(Ce,{color:g,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+d.toString(),isExternal:!0,children:["Issue: New Palettes Request ",e(be,{as:Re})]})]}),m(R,{children:[h("Paste following text to the issue body")," ",e(y,{size:"xs",leftIcon:e(oe,{}),onClick:C,children:h("Copy")}),e(ve,{ref:l,isReadOnly:!0,defaultValue:c,onClick:({target:k})=>k.select()})]})]})]}),m(U,{children:[e(y,{variant:"ghost",onClick:u,mr:"auto",leftIcon:e(ae,{}),children:h("Previous")}),e(y,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+t.toString(),"_blank"),children:h("1-click open issue")})]})]})}function rt(o){const{isOpen:a,onClose:n}=o,{t:s}=b(),[i,r]=f.useState([]),[u,h]=f.useState([]),[g,l]=f.useState({}),[c,t]=f.useState(""),[d,C]=f.useState(""),[S,p]=f.useState(!1),[k,w]=f.useState(!1),L=P(ue=>ue.ticket),re=E.getCountryEntry(L),ce=E.getCityEntry(L),le=E.getPalettes(L);f.useEffect(()=>{a?(r(E.getCountryErrors(L)),h(E.getCityErrors(L)),l(E.getLineErrors(L))):(p(!1),t(""),C(""),w(!1))},[a]);const K=i.length>0||u.length>0||Object.values(g).flat().length>0,z=K&&!S,J=!z&&!k,de=()=>{!z&&!J&&window.localStorage.removeItem(T),n()};return m($,{blockScrollOnMount:!1,isOpen:a,onClose:n,scrollBehavior:"inside",children:[e(Q,{}),m(X,{children:[e(Z,{children:s("Submit palettes")}),e(ee,{onClick:de}),z&&e(at,{countryErrors:i,cityErrors:u,lineErrors:g,onIgnore:()=>p(!0),onClose:n}),J&&e(st,{refLink:c,onRefLinkChange:t,justification:d,onJustificationChange:C,onPrev:K?()=>p(!1):void 0,onNext:()=>w(!0)}),!z&&!J&&e(it,{countryEntry:re,cityEntry:ce,paletteList:le,refLink:c,justification:d,onPrev:()=>w(!1)})]})]})}function ct(o){const{isOpen:a,onClose:n,incomingState:s}=o,{t:i}=b(),r=x(),u=()=>{window.localStorage.removeItem(T),n()},h=()=>{s&&r(se(s)),n()};return m($,{isOpen:a,onClose:n,children:[e(Q,{}),m(X,{children:[e(Z,{children:i("Unsaved draft")}),e(ee,{}),e(D,{children:i("Do you want to continue with your last unsaved ticket?")}),e(U,{children:m(N,{children:[e(y,{onClick:u,children:i("Discard")}),e(y,{colorScheme:"primary",onClick:h,children:i("Continue")})]})})]})]})}function ht(){const{t:o}=b(),a=x(),n=Se(),[s,i]=f.useState(),[r,u]=f.useState(!1),[h,g]=f.useState(!1);f.useEffect(()=>{const c=window.localStorage.getItem(T);c&&(i(JSON.parse(c)),u(!0))},[]);const l=()=>{a(se()),window.localStorage.removeItem(T),we.event($e.RESET_TICKET,{})};return m(ke,{px:2,pt:2,sx:{width:{base:"100%",md:520}},children:[m(H,{direction:"column",flex:1,overflowY:"auto",children:[e(Xe,{}),e(Ze,{}),e(ot,{})]}),m(H,{my:2,children:[e(y,{size:"sm",onClick:()=>n("/"),children:o("Go back")}),m(N,{ml:"auto",children:[e(y,{size:"sm",variant:"outline",onClick:l,children:o("Reset")}),e(y,{size:"sm",colorScheme:"primary",onClick:()=>g(!0),children:o("Submit")})]})]}),e(ct,{isOpen:r,onClose:()=>u(!1),incomingState:s}),e(rt,{isOpen:h,onClose:()=>g(!1)})]})}export{ht as default};
