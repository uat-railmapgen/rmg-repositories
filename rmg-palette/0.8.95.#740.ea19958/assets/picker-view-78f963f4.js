import{j as n,a6 as R,a7 as W,a8 as $,a9 as D,aa as P,ab as B,ac as A,ad as M,$ as N,i as L}from"./chakra-30b94965.js";import{g as F,Y as j,Z as V,c as I,M as C,d as w,b as O,r as b,E as S,j as H}from"./index-f00268d7.js";import{u as E,r as h,n as z}from"./react-326f1873.js";function T(g){const{countryCode:s,svgFilename:a}=g;return a?n.jsx(R,{src:`/rmg-palette/resources/flags/${a.slice(0,-4)}.svg`,alt:`Flag of ${s}`,h:17,mr:1}):n.jsx(n.Fragment,{})}function X(g){const{defaultValueId:s,onChange:a}=g,{i18n:u}=E(),r=s?F.find(e=>e.id===s):void 0,l=e=>{var t,c;return(c=(t=u.languages.map(i=>e.name[i]).find(i=>i!==void 0))!=null?t:e.name.en)!=null?c:""},m=e=>{var f,x;const t=e.country==="TW"&&["zh-Hans","zh-CN"].includes(u.languages[0]),c=["Win32","Win64"].includes(navigator.platform),i=u.languages.map(d=>e.name[d]).find(d=>d!==void 0),v=(f=I.find(d=>d.id===e.country))==null?void 0:f.flagSvg,y=(x=I.find(d=>d.id===e.country))==null?void 0:x.flagEmoji;return n.jsxs(n.Fragment,{children:[t?n.jsx("span",{children:"🏴 "}):c?n.jsx(T,{countryCode:e.country,svgFilename:v}):n.jsxs("span",{children:[y," "]}),i]})},p=(e,t)=>Object.values(e.name).some(c=>c.includes(t)),o=F.slice().sort((e,t)=>e.id===j.Other?1:t.id===j.Other?-1:l(e).localeCompare(l(t),u.languages[0]));return n.jsx(V,{data:o,displayValue:l,displayHandler:m,predicate:p,defaultValue:r,onChange:e=>a==null?void 0:a(e.id)})}const Y=g=>{const[s,a]=h.useState([]);return h.useEffect(()=>{const u=new AbortController;return fetch(`/rmg-palette/resources/palettes/${g}.json`,{signal:u.signal}).then(r=>r.json()).then(r=>a(r)).catch(()=>a([])),()=>{u.abort()}},[g]),s};function Z(g){const{city:s,defaultValueId:a,onChange:u}=g,{i18n:r}=E(),l=Y(s),m=a?l.find(t=>t.id===a):void 0,p=t=>{var c;return(c=r.languages.map(i=>t.name[i]).find(i=>i!==void 0))!=null?c:""},o=t=>{const c=p(t);return n.jsx(w,{name:c,fg:t.fg||C.white,bg:t.colour})},e=(t,c)=>Object.values(t.name).some(i=>i.includes(c));return n.jsx(V,{data:l,displayValue:p,displayHandler:o,predicate:e,defaultValue:m,onChange:t=>u==null?void 0:u(t.id,t.colour,t.fg||C.white)})}function q(g){const{defaultTheme:s,onSubmit:a,onClose:u}=g,{t:r}=E(),[l,m]=h.useState(s==null?void 0:s[0]),[p,o]=h.useState(s==null?void 0:s[1]),[e,t]=h.useState((s==null?void 0:s[2])||"#AAAAAA"),[c,i]=h.useState((s==null?void 0:s[3])||C.white);h.useEffect(()=>{s&&(m(s[0]),o(s[1]),t(s[2]),i(s[3]))},[s==null?void 0:s.toString()]);const v=[{type:"custom",label:r("City theme"),component:n.jsx(X,{defaultValueId:l,onChange:d=>{m(d),o(void 0),t("#AAAAAA"),i(C.white)}})},{type:"custom",label:r("Line theme"),component:n.jsx(Z,{city:l,defaultValueId:p,onChange:(d,_,k)=>{o(d),t(_),i(k)}})}],y=[{type:"input",label:r("Background colour"),variant:"color",value:e,placeholder:"#F3D03E",onChange:d=>{m(j.Other),o("other"),t(d)}},{type:"select",label:r("Foreground colour"),value:c,options:{[C.white]:r("White"),[C.black]:r("Black")},onChange:d=>{m(j.Other),o("other"),i(d)}}],f=l&&p&&e&&c,x=()=>{f&&(a==null||a([l,p,e,c]))};return n.jsxs(n.Fragment,{children:[n.jsxs(W,{flex:1,mx:2,children:[n.jsx(w,{name:r("Example"),fg:c,bg:e}),n.jsxs($,{isFitted:!0,colorScheme:"primary",w:"100%",defaultIndex:l===j.Other?1:0,children:[n.jsxs(D,{children:[n.jsx(P,{children:r("From palette")}),n.jsx(P,{children:r("Customise")})]}),n.jsxs(B,{children:[n.jsx(A,{children:n.jsx(O,{fields:v})}),n.jsx(A,{children:n.jsx(O,{fields:y})})]})]})]}),n.jsx(M,{}),n.jsxs(N,{p:2,justifyContent:"flex-end",children:[n.jsx(L,{size:"sm",onClick:u,children:r("Cancel")}),n.jsx(L,{size:"sm",colorScheme:"primary",onClick:x,isDisabled:!f,children:r("Confirm")})]})]})}const G="rmg-palette-bridge--";function U(){E();const[g]=z(),s=g.get("parentId"),a=g.get("parentComponent"),[u,r]=h.useState(),l=h.useRef();h.useEffect(()=>{const o=new BroadcastChannel(G+s);l.current=o,b.event(S.APP_CLIP_VIEW_OPENED,{parentComponent:a}),o.onmessage=t=>{const{event:c,data:i}=t.data;console.log(`[${o.name}] Received event from parent component:`,c),c==="OPEN"&&r(i)},console.log(`[${o.name}] App clip connection established, parentComponent=${a}`);const e=document.createElement("style");return e.textContent=".rmg-window__header{margin-left: unset;}",document.head.appendChild(e),o.postMessage({event:"LOADED"}),()=>{o.close(),document.head.removeChild(e)}},[]);const m=o=>{var e,t;console.log(`[${(e=l.current)==null?void 0:e.name}] Emitting SELECT event, theme:`,o),(t=l.current)==null||t.postMessage({event:"SELECT",data:o}),b.event(S.APP_CLIP_VIEW_SELECT,{parentComponent:a,theme:o})},p=()=>{var o,e;console.log(`[${(o=l.current)==null?void 0:o.name}] Emitting CLOSE event`),(e=l.current)==null||e.postMessage({event:"CLOSE"}),b.event(S.APP_CLIP_VIEW_CLOSED,{parentComponent:a})};return n.jsx(H,{children:n.jsx(q,{defaultTheme:u,onSubmit:m,onClose:p})})}export{U as default};
