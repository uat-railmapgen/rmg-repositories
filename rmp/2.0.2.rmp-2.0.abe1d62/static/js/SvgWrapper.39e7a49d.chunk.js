"use strict";(self.webpackChunkrmp=self.webpackChunkrmp||[]).push([[8423],{1740:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});var r=n(4942),i=n(9439),u=n(2791),o=n(8617),s=n(5984),c=n(7339),a=n(3671),l=n(8284),f=n(1413),d=n(8817),y=n(7237),h=n(3363),v=n(184),p=function(e){var t=e.id,n=e.type,r=e.attrs,o=e.styleType,s=e.styleAttrs,c=void 0===s?h.b[o].defaultAttrs:s,a=e.newLine,l=e.handleClick,f=e.x1,d=e.y1,y=e.x2,p=e.y2,x=u.useState("M 0,0"),g=(0,i.Z)(x,2),Z=g[0],m=g[1];u.useEffect((function(){m(h.V[n].generatePath(f,y,d,p,r).d)}),[n,JSON.stringify(r),f,y,d,p]);var b=h.b[o].component;return u.useMemo((function(){return(0,v.jsx)(b,{id:t,path:Z,styleAttrs:c,newLine:a,handleClick:l})}),[t,Z,o,JSON.stringify(c),a,l])},x=n(443),g=n(3300),Z=n(3433),m=n(7762),b=h.V,w=function(e){var t=function(e){var t,n=e.filterDirectedEdges((function(e,t,n,r,i,u,o){return e.startsWith("line")&&""!==t.reconcileId})),r={},i=(0,m.Z)(n);try{for(i.s();!(t=i.n()).done;){var u=t.value,o=e.getEdgeAttribute(u,"reconcileId");o in r?r[o].push(u):r[o]=[u]}}catch(s){i.e(s)}finally{i.f()}return r}(e),n=[],r=[];return Object.values(t).forEach((function(t){if(1!==t.length)if(t.every((function(t){return b[e.getEdgeAttribute(t,"type")].generatePath}))){var u={},o=new Set,s=new Set,c=Object.fromEntries(t.map((function(t){var n,r,c=e.extremities(t),a=(0,i.Z)(c,2),l=a[0],f=a[1];return u[l]=(null!==(n=u[l])&&void 0!==n?n:0)+1,u[f]=(null!==(r=u[f])&&void 0!==r?r:0)+1,o.add(l),s.add(f),[l,[t,f]]}))),a=Array.from(o).filter((function(e){return 1===u[e]})),l=Array.from(s).filter((function(e){return 1===u[e]}));if(1===a.length&&1===l.length){var f=a[0],d=l[0];if(f!==d){for(var y=[c[f][0]],h=c[f][1],v=1;v<t.length;v+=1){var p,x=null===(p=c[h])||void 0===p?void 0:p.at(1);if(!x)return void r.push.apply(r,(0,Z.Z)(t));y.push(c[h][0]),h=x}h===d&&y.length===t.length?n.push(y):r.push.apply(r,(0,Z.Z)(t))}else r.push.apply(r,(0,Z.Z)(t))}else r.push.apply(r,(0,Z.Z)(t))}else r.push.apply(r,(0,Z.Z)(t));else r.push.apply(r,(0,Z.Z)(t))})),{allReconciledLines:n,danglingLines:r}},E=function(e){return e.filterNodes((function(e,t){return e.startsWith("stn")})).map((function(t){return[t,e.getNodeAttributes(t)]})).filter((function(e){var t=(0,i.Z)(e,2);t[0];return t[1].visible})).map((function(e){var t=(0,i.Z)(e,2),n=t[0],u=t[1];return(0,r.Z)({node:n,visible:u.visible,zIndex:u.zIndex,x:u.x,y:u.y,type:u.type},u.type,u[u.type])}))},A=function(e){return e.filterDirectedEdges((function(e,t,n,r,i,u,o){return e.startsWith("line")&&t.visible&&""===t.reconcileId})).map((function(t){var n=e.extremities(t),r=(0,i.Z)(n,2),u=r[0],o=r[1],s=e.getNodeAttributes(u),c=e.getNodeAttributes(o),a=e.getEdgeAttribute(t,"type"),l=e.getEdgeAttribute(t,a),f=e.getEdgeAttribute(t,"style"),d=e.getEdgeAttribute(t,f);return{edge:t,x1:s.x,y1:s.y,x2:c.x,y2:c.y,type:a,attr:l,style:f,styleAttr:d}}))},N=function(e){return e.filterNodes((function(e,t){return e.startsWith("misc_node")})).map((function(t){return[t,e.getNodeAttributes(t)]})).filter((function(e){var t=(0,i.Z)(e,2);t[0];return t[1].visible})).map((function(e){var t=(0,i.Z)(e,2),n=t[0],u=t[1];return(0,r.Z)({node:n,visible:u.visible,zIndex:u.zIndex,x:u.x,y:u.y,type:u.type},u.type,u[u.type])}))},P=function(){var e=(0,c.u5)(),t=(0,c.Qy)((function(e){return e.runtime})),n=t.selected,Z=t.refresh,m=Z.all,b=Z.reconcileLine,P=t.mode,I=t.active,S=t.theme,_=(0,c.Qy)((function(e){return e.param})).svgViewBoxZoom,M=function(){e((0,a.n9)()),e((0,l.DR)(L.current.export()))},L=u.useRef(window.graph),W=u.useState({x:0,y:0}),k=(0,i.Z)(W,2),R=k[0],V=k[1],K=u.useState({x:0,y:0}),D=(0,i.Z)(K,2),O=D[0],j=D[1],C=(0,o.ZP)((function(t,r){r.stopPropagation();var i=r.currentTarget,u=(0,g.yK)(r),o=u.x,s=u.y;i.setPointerCapture(r.pointerId),V({x:o,y:s}),e((0,a.Iv)(t)),!r.shiftKey&&n.length<=1&&e((0,a.x_)()),e((0,a.Gv)(t))})),z=(0,o.ZP)((function(e,t){t.stopPropagation();var r=(0,g.yK)(t),i=r.x,u=r.y;"free"===P&&I===e?(n.forEach((function(e){L.current.updateNodeAttributes(e,(function(e){return(0,f.Z)((0,f.Z)({},e),{},{x:(0,g.Z9)(e.x-(R.x-i)*_/100,t.altKey?1:5),y:(0,g.Z9)(e.y-(R.y-u)*_/100,t.altKey?1:5)})}))})),M()):P.startsWith("line")&&j({x:(R.x-i)*_/100,y:(R.y-u)*_/100})})),U=(0,o.ZP)((function(t,n){if(n.stopPropagation(),P.startsWith("line")){e((0,a.PM)("free"));["stn_core_","virtual_circle_"].forEach((function(e){var t,i,u=null===(t=document.elementsFromPoint(n.clientX,n.clientY)[0].attributes)||void 0===t||null===(i=t.getNamedItem("id"))||void 0===i?void 0:i.value;if(null!==u&&void 0!==u&&u.startsWith(e)){var o,c=P.slice(5),a="line_".concat((0,s.x0)(10));L.current.addDirectedEdgeWithKey(a,I,u.slice(e.length),(o={visible:!0,zIndex:0,type:c},(0,r.Z)(o,c,JSON.parse(JSON.stringify(h.V[c].defaultAttrs))),(0,r.Z)(o,"style",d.R.SingleColor),(0,r.Z)(o,d.R.SingleColor,{color:S}),(0,r.Z)(o,"reconcileId",""),o))}}))}else if("free"===P){var i=(0,g.yK)(n),u=i.x,o=i.y;R.x-u===0&&R.y-o===0&&e((0,a.Iv)(t))}e((0,a.Iv)(void 0)),M()})),J=(0,o.ZP)((function(t,n){e((0,a.x_)()),e((0,a.Gv)(t))})),T=u.useState(E(L.current)),B=(0,i.Z)(T,2),F=B[0],Q=B[1],X=u.useState(A(L.current)),Y=(0,i.Z)(X,2),G=Y[0],H=Y[1],q=u.useState(N(L.current)),$=(0,i.Z)(q,2),ee=$[0],te=$[1],ne=u.useState([]),re=(0,i.Z)(ne,2),ie=(re[0],re[1]),ue=u.useState([]),oe=(0,i.Z)(ue,2),se=(oe[0],oe[1]);u.useEffect((function(){Q(E(L.current)),H(A(L.current)),te(N(L.current))}),[m]),u.useEffect((function(){var e=w(L.current),t=e.allReconciledLines,n=e.danglingLines;ie(t),se(n)}),[]),u.useEffect((function(){var e=w(L.current),t=e.allReconciledLines,n=e.danglingLines;ie(t),se(n)}),[b]);var ce=P.startsWith("line")?p:function(e){return(0,v.jsx)(v.Fragment,{})};return(0,v.jsxs)(v.Fragment,{children:[ee.map((function(e){var t=e.node,n=e.x,r=e.y,i=e.type,u=x.Z[i].component;return(0,v.jsx)(u,{id:t,x:n,y:r,attrs:e[i],handlePointerDown:C,handlePointerMove:z,handlePointerUp:U},t)})),G.map((function(e){var t=e.edge,n=e.x1,r=e.y1,i=e.x2,u=e.y2,o=e.type,s=e.attr,c=e.style,a=e.styleAttr;return(0,v.jsx)(p,{id:t,x1:n,y1:r,x2:i,y2:u,newLine:!1,type:o,attrs:s,styleType:c,styleAttrs:a,handleClick:J},t)})),F.map((function(e){var t=e.node,n=e.x,i=e.y,u=e.type,o=y.Z[u].component;return(0,v.jsx)(o,{id:t,x:n,y:i,attrs:(0,r.Z)({},u,e[u]),handlePointerDown:C,handlePointerMove:z,handlePointerUp:U},t)})),P.startsWith("line")&&I&&(0,v.jsx)(ce,{id:"create_in_progress___no_use",x1:L.current.getNodeAttribute(I,"x"),y1:L.current.getNodeAttribute(I,"y"),x2:L.current.getNodeAttribute(I,"x")-O.x,y2:L.current.getNodeAttribute(I,"y")-O.y,newLine:!0,type:P.slice(5),attrs:h.V[P.slice(5)],styleType:d.R.SingleColor,styleAttrs:{color:S}})]})},I=function(){var e,t,n=(0,c.u5)(),f=function(){n((0,a.n9)()),n((0,l.DR)(A.current.export()))},d=(0,c.Qy)((function(e){return e.runtime})),h=d.mode,p=d.active,Z=d.selected,m=d.theme,b=(0,c.Qy)((function(e){return e.param})),w=b.svgViewBoxZoom,E=b.svgViewBoxMin,A=u.useRef(window.graph),N=u.useState({x:0,y:0}),I=(0,i.Z)(N,2),S=I[0],_=I[1],M=u.useState({x:0,y:0}),L=(0,i.Z)(M,2),W=L[0],k=L[1],R=(0,o.ZP)((function(e){var t=(0,g.yK)(e),i=t.x,u=t.y;if(h.startsWith("station")){n((0,a.PM)("free"));var o=(0,s.x0)(10),c=h.slice(8),l=JSON.parse(JSON.stringify(y.Z[c].defaultAttrs));"color"in l&&(l.color=m),A.current.addNode("stn_".concat(o),(0,r.Z)({visible:!0,zIndex:0,x:(0,g.Z9)(i*w/100+E.x,10),y:(0,g.Z9)(u*w/100+E.y,10),type:c},c,l)),f()}else if(h.startsWith("misc-node")){n((0,a.PM)("free"));var d=(0,s.x0)(10),v=h.slice(10);A.current.addNode("misc_node_".concat(d),(0,r.Z)({visible:!0,zIndex:0,x:(0,g.Z9)(i*w/100+E.x,10),y:(0,g.Z9)(u*w/100+E.y,10),type:v},v,JSON.parse(JSON.stringify(x.Z[v].defaultAttrs)))),f()}else("free"===h||h.startsWith("line"))&&(h.startsWith("line")&&n((0,a.PM)("free")),_({x:i,y:u}),k(E),e.shiftKey||(n((0,a.Iv)("background")),n((0,a.x_)())))})),V=(0,o.ZP)((function(e){if("background"===p){var t=(0,g.yK)(e),r=t.x,i=t.y;n((0,l.FL)({x:W.x+(S.x-r)*w/100,y:W.y+(S.y-i)*w/100}))}})),K=(0,o.ZP)((function(e){"background"!==p||e.shiftKey||n((0,a.Iv)(void 0))})),D=(0,o.ZP)((function(e){e.deltaY>0&&w+10<400?n((0,l.u4)(w+10)):e.deltaY<0&&w-10>0&&n((0,l.u4)(w-10))})),O=(0,o.ZP)((function(e){if("Delete"===e.key)Z.length>0&&Z.filter((function(e){return A.current.hasNode(e)||A.current.hasEdge(e)})).forEach((function(e){n((0,a.x_)()),A.current.hasNode(e)?A.current.dropNode(e):A.current.dropEdge(e),f()}));else if(e.key.startsWith("Arrow")){var t=e.key.endsWith("Left")?-1:e.key.endsWith("Right")?1:0,r=e.key.endsWith("Up")?-1:e.key.endsWith("Down")?1:0;n((0,l.FL)({x:E.x+100*w/100*t,y:E.y+100*w/100*r}))}})),j=function(){var e=(0,u.useState)({width:void 0,height:void 0}),t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,u.useEffect)((function(){function e(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),C=(null!==(e=j.height)&&void 0!==e?e:1280)-40,z=(null!==(t=j.width)&&void 0!==t?t:720)-50;return(0,v.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",height:C,width:z,viewBox:"".concat(E.x," ").concat(E.y," ").concat(z*w/100," ").concat(C*w/100," "),onPointerDown:R,onPointerMove:V,onPointerUp:K,onWheel:D,tabIndex:0,onKeyDown:O,children:(0,v.jsx)(P,{})})}},3300:function(e,t,n){n.d(t,{Z9:function(){return i},fx:function(){return u},yK:function(){return r}});var r=function(e){var t=e.currentTarget.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},i=function(e,t){return Math.round(e/t)*t},u=function(e){var t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],n=t[0],r=t[1],i=t[2],u=t[3];return e.forEachNode((function(e,t){n=Math.min(t.x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),u=Math.max(t.y,u)})),{xMin:n-=150,yMin:r-=150,xMax:i+=150,yMax:u+=150}}},8617:function(e,t,n){var r=n(2791),i="undefined"!==typeof window?null!==r.useInsertionEffect&&void 0!==r.useInsertionEffect?r.useInsertionEffect:r.useLayoutEffect:function(){};function u(e){var t=(0,r.useRef)(o);i((function(){t.current=e}),[e]);var n=(0,r.useRef)(null);return n.current||(n.current=function(){return t.current.apply(this,arguments)}),n.current}function o(){throw new Error("INVALID_USEEVENT_INVOCATION: the callback from useEvent cannot be invoked before the component has mounted.")}t.ZP=u}}]);
//# sourceMappingURL=SvgWrapper.39e7a49d.chunk.js.map