import{a9 as Kt,j as e,aa as Yt,Q as Mt,ab as ct,ac as dt,G as re,ad as ht,ae as oe,k as Ue,a0 as V,M as J,a1 as K,p as Y,s as b,af as ut,q as Z,r as q,I as Ke,h as N,t as ue,ag as Zt,ah as qt,g as je,w as k,a8 as _,v as Rt,ai as jt,aj as Qt,F as yt,$ as bt,B as D,ak as Se,a2 as Ee,al as ye,am as be,an as ve,c as Xt,i as es,e as ts,f as ss,ao as ns,O as Ye,ap as rs,aq as os,ar as P,as as vt,at as as,au as w,av as T,aw as is,ax as ne,x as ls,y as cs}from"./chakra-85c10392.js";import{g as ds,r as B,_ as Nt,e as Te,b as x}from"./react-d997006e.js";import{w as hs,g as us,a as Ze,b as Ht,I as ps,u as gs,r as L,n as wt,S as M,L as qe,l as fs,c as le,R as It,d as F,e as X,s as de,f as he,h as ce,i as Pt,j as nt,M as St,k as ms,m as xs,o as E,p as Bt,q as js,t as Qe,C as ys,v as Gt,x as Ct,y as Lt,z as se,A as bs,B as vs,D as ws,E as Ce,F as rt,G as Ss,H as Cs,J as Os,K as Ot,N as zs,T as ks,O as As,P as Es,Q as Ts,U as _s,V as Ms,W as Rs,X as Ge,Y as Ns,Z as Xe,_ as Hs,$ as Is,a0 as Ps,a1 as Bs,a2 as Gs,a3 as Ls,a4 as Ds,a5 as Fs,a6 as $s,a7 as Ws}from"./index-6c328a8c.js";import{s as De}from"./stations-b27d5998.js";import{c as Us,i as Ae}from"./helpers-2fcbe9c8.js";import{c as Vs}from"./change-types-0a0bc044.js";function pt(t,o){if(t==null)return{};var r=Kt(t,o),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(a=0;a<s.length;a++)n=s[a],!(o.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var Js={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const Ks=ds(Js);var Ys=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function zt(t){var o={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},r=t.match(/<\/?([^\s]+?)[/\s>]/);if(r&&(o.name=r[1],(Ks[r[1]]||t.charAt(t.length-2)==="/")&&(o.voidElement=!0),o.name.startsWith("!--"))){var n=t.indexOf("-->");return{type:"comment",comment:n!==-1?t.slice(4,n):""}}for(var a=new RegExp(Ys),s=null;(s=a.exec(t))!==null;)if(s[0].trim())if(s[1]){var i=s[1].trim(),h=[i,""];i.indexOf("=")>-1&&(h=i.split("=")),o.attrs[h[0]]=h[1],a.lastIndex--}else s[2]&&(o.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return o}var Zs=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,qs=/^\s*$/,Qs=Object.create(null);function Dt(t,o){switch(o.type){case"text":return t+o.content;case"tag":return t+="<"+o.name+(o.attrs?function(r){var n=[];for(var a in r)n.push(a+'="'+r[a]+'"');return n.length?" "+n.join(" "):""}(o.attrs):"")+(o.voidElement?"/>":">"),o.voidElement?t:t+o.children.reduce(Dt,"")+"</"+o.name+">";case"comment":return t+"<!--"+o.comment+"-->"}}var Xs={parse:function(t,o){o||(o={}),o.components||(o.components=Qs);var r,n=[],a=[],s=-1,i=!1;if(t.indexOf("<")!==0){var h=t.indexOf("<");n.push({type:"text",content:h===-1?t:t.substring(0,h)})}return t.replace(Zs,function(d,g){if(i){if(d!=="</"+r.name+">")return;i=!1}var l,p=d.charAt(1)!=="/",c=d.startsWith("<!--"),u=g+d.length,f=t.charAt(u);if(c){var O=zt(d);return s<0?(n.push(O),n):((l=a[s]).children.push(O),n)}if(p&&(s++,(r=zt(d)).type==="tag"&&o.components[r.name]&&(r.type="component",i=!0),r.voidElement||i||!f||f==="<"||r.children.push({type:"text",content:t.slice(u,t.indexOf("<",u))}),s===0&&n.push(r),(l=a[s-1])&&l.children.push(r),a[s]=r),(!p||r.voidElement)&&(s>-1&&(r.voidElement||r.name===d.slice(2,-1))&&(s--,r=s===-1?n:a[s]),!i&&f!=="<"&&f)){l=s===-1?n:a[s].children;var y=t.indexOf("<",u),v=t.slice(u,y===-1?void 0:y);qs.test(v)&&(v=" "),(y>-1&&s+l.length>=0||v!==" ")&&l.push({type:"text",content:v})}}),n},stringify:function(t){return t.reduce(function(o,r){return o+Dt("",r)},"")}},en=["format"],tn=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function kt(t,o){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function R(t){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?arguments[o]:{};o%2?kt(Object(r),!0).forEach(function(n){Nt(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function et(t,o){if(!t)return!1;var r=t.props?t.props.children:t.children;return o?r.length>0:!!r}function tt(t){return t?t.props?t.props.children:t.children:[]}function sn(t){return Object.prototype.toString.call(t)!=="[object Array]"?!1:t.every(function(o){return B.isValidElement(o)})}function _e(t){return Array.isArray(t)?t:[t]}function nn(t,o){var r=R({},o);return r.props=Object.assign(t.props,o.props),r}function Ft(t,o){if(!t)return"";var r="",n=_e(t),a=o.transSupportBasicHtmlNodes&&o.transKeepBasicHtmlNodesFor?o.transKeepBasicHtmlNodesFor:[];return n.forEach(function(s,i){if(typeof s=="string")r+="".concat(s);else if(B.isValidElement(s)){var h=Object.keys(s.props).length,d=a.indexOf(s.type)>-1,g=s.props.children;if(!g&&d&&h===0)r+="<".concat(s.type,"/>");else if(!g&&(!d||h!==0))r+="<".concat(i,"></").concat(i,">");else if(s.props.i18nIsDynamicList)r+="<".concat(i,"></").concat(i,">");else if(d&&h===1&&typeof g=="string")r+="<".concat(s.type,">").concat(g,"</").concat(s.type,">");else{var l=Ft(g,o);r+="<".concat(i,">").concat(l,"</").concat(i,">")}}else if(s===null)Ze("Trans: the passed in value is invalid - seems you passed in a null child.");else if(Te(s)==="object"){var p=s.format,c=pt(s,en),u=Object.keys(c);if(u.length===1){var f=p?"".concat(u[0],", ").concat(p):u[0];r+="{{".concat(f,"}}")}else Ze("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",s)}else Ze("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",s)}),r}function rn(t,o,r,n,a,s){if(o==="")return[];var i=n.transKeepBasicHtmlNodesFor||[],h=o&&new RegExp(i.join("|")).test(o);if(!t&&!h)return[o];var d={};function g(y){var v=_e(y);v.forEach(function(m){typeof m!="string"&&(et(m)?g(tt(m)):Te(m)==="object"&&!B.isValidElement(m)&&Object.assign(d,m))})}g(t);var l=Xs.parse("<0>".concat(o,"</0>")),p=R(R({},d),a);function c(y,v,m){var S=tt(y),H=f(S,v.children,m);return sn(S)&&H.length===0?S:H}function u(y,v,m,S,H){y.dummy&&(y.children=v),m.push(B.cloneElement(y,R(R({},y.props),{},{key:S}),H?void 0:v))}function f(y,v,m){var S=_e(y),H=_e(v);return H.reduce(function(A,j,$){var ee=j.children&&j.children[0]&&j.children[0].content&&r.services.interpolator.interpolate(j.children[0].content,p,r.language);if(j.type==="tag"){var Q=S[parseInt(j.name,10)];!Q&&m.length===1&&m[0][j.name]&&(Q=m[0][j.name]),Q||(Q={});var z=Object.keys(j.attrs).length!==0?nn({props:j.attrs},Q):Q,C=B.isValidElement(z),pe=C&&et(j,!0)&&!j.voidElement,Ie=h&&Te(z)==="object"&&z.dummy&&!C,Pe=Te(t)==="object"&&t!==null&&Object.hasOwnProperty.call(t,j.name);if(typeof z=="string"){var Oe=r.services.interpolator.interpolate(z,p,r.language);A.push(Oe)}else if(et(z)||pe){var ze=c(z,j,m);u(z,ze,A,$)}else if(Ie){var I=f(S,j.children,m);A.push(B.cloneElement(z,R(R({},z.props),{},{key:$}),I))}else if(Number.isNaN(parseFloat(j.name)))if(Pe){var Je=c(z,j,m);u(z,Je,A,$,j.voidElement)}else if(n.transSupportBasicHtmlNodes&&i.indexOf(j.name)>-1)if(j.voidElement)A.push(B.createElement(j.name,{key:"".concat(j.name,"-").concat($)}));else{var ge=f(S,j.children,m);A.push(B.createElement(j.name,{key:"".concat(j.name,"-").concat($)},ge))}else if(j.voidElement)A.push("<".concat(j.name," />"));else{var ke=f(S,j.children,m);A.push("<".concat(j.name,">").concat(ke,"</").concat(j.name,">"))}else if(Te(z)==="object"&&!C){var fe=j.children[0]?ee:null;fe&&A.push(fe)}else j.children.length===1&&ee?A.push(B.cloneElement(z,R(R({},z.props),{},{key:$}),ee)):A.push(B.cloneElement(z,R(R({},z.props),{},{key:$})))}else if(j.type==="text"){var me=n.transWrapTextNodes,xe=s?n.unescape(r.services.interpolator.interpolate(j.content,p,r.language)):r.services.interpolator.interpolate(j.content,p,r.language);me?A.push(B.createElement(me,{key:"".concat(j.name,"-").concat($)},xe)):A.push(xe)}return A},[])}var O=f([{dummy:!0,children:t||[]}],l,_e(t||[]));return tt(O[0])}function on(t){var o=t.children,r=t.count,n=t.parent,a=t.i18nKey,s=t.context,i=t.tOptions,h=i===void 0?{}:i,d=t.values,g=t.defaults,l=t.components,p=t.ns,c=t.i18n,u=t.t,f=t.shouldUnescape,O=pt(t,tn),y=c||Ht();if(!y)return hs("You will need to pass in an i18next instance by using i18nextReactModule"),o;var v=u||y.t.bind(y)||function(pe){return pe};s&&(h.context=s);var m=R(R({},us()),y.options&&y.options.react),S=p||v.ns||y.options&&y.options.defaultNS;S=typeof S=="string"?[S]:S||["translation"];var H=g||Ft(o,m)||m.transEmptyNodeValue||a,A=m.hashTransKey,j=a||(A?A(H):H),$=d?h.interpolation:{interpolation:R(R({},h.interpolation),{},{prefix:"#$?",suffix:"?$#"})},ee=R(R(R(R({},h),{},{count:r},d),$),{},{defaultValue:H,ns:S}),Q=j?v(j,ee):H,z=rn(l||o,Q,y,m,ee,f),C=n!==void 0?n:m.defaultTransParent;return C?B.createElement(C,O,z):z}var an=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function At(t,o){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ln(t){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?arguments[o]:{};o%2?At(Object(r),!0).forEach(function(n){Nt(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):At(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Et(t){var o=t.children,r=t.count,n=t.parent,a=t.i18nKey,s=t.context,i=t.tOptions,h=i===void 0?{}:i,d=t.values,g=t.defaults,l=t.components,p=t.ns,c=t.i18n,u=t.t,f=t.shouldUnescape,O=pt(t,an),y=B.useContext(ps)||{},v=y.i18n,m=y.defaultNS,S=c||v||Ht(),H=u||S&&S.t.bind(S);return on(ln({children:o,count:r,parent:n,i18nKey:a,context:s,tOptions:h,values:d,defaults:g,components:l,ns:p||H&&H.ns||m||S&&S.options&&S.options.defaultNS,i18n:S,t:u,shouldUnescape:f},O))}var Tt=function(t){return gs(L.ready(),t)},cn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},ko:{en:"Korean",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}},He=(t=>(t.left="l",t.right="r",t))(He||{}),Re=(t=>(t.through="through",t.nonThrough="nonthrough",t))(Re||{}),Ve=(t=>(t.local="local",t.express="express",t.direct="direct",t))(Ve||{}),ae=(t=>(t.MTR="mtr",t.GZMTR="gzmtr",t.SHMetro="shmetro",t))(ae||{}),gt=(t=>(t.sh="sh",t.sh2020="sh2020",t))(gt||{});const dn=(t,{info_panel_type:o,line_num:r,stn_list:n,style:a,theme:s})=>{const i=Object.fromEntries(Object.keys(n).filter(h=>!["linestart","lineend"].includes(h)).map(h=>[h,`stn_${wt(10)}`]));Object.entries(n).filter(([h,d])=>!["linestart","lineend"].includes(h)).forEach(([h,d])=>{const g=t.filterNodes((l,p)=>Object.values(M).includes(p.type)&&p[p.type].names[0]===d.name[0]);g.length!==0&&(i[h]=g[0])}),Object.entries(n).filter(([h,d])=>!["linestart","lineend"].includes(h)).filter(([h,d])=>t.filterNodes((g,l)=>Object.values(M).includes(l.type)&&l[l.type].names[0]===d.name[0]).length===0).forEach(([h,d],g)=>{let l=M.ShmetroBasic;const p=d.transfer.groups,c=p.map(f=>f.lines).flat();a===ae.SHMetro?c.length>0?l=M.ShmetroInt:o===gt.sh2020?l=M.ShmetroBasic2020:l=M.ShmetroBasic:a===ae.GZMTR?c.length>0?l=M.GzmtrInt:l=M.GzmtrBasic:a===ae.MTR&&(l=M.MTR);const u={...structuredClone(De[l].defaultAttrs),names:d.name};l===M.ShmetroBasic2020?u.color=s:l===M.GzmtrBasic?(u.color=s,u.lineCode=r,u.stationCode=d.num):l===M.GzmtrInt?u.transfer=p.map((f,O)=>{const y=f.lines.map(v=>{var m;return[...(m=v.theme)!=null?m:s,"1","01"]});return O===0?[[...s,r,d.num],...y]:y}):l===M.MTR&&(p[0].lines.length?u.transfer=[[[...s,"",""],...p[0].lines.map(f=>{var O;return[...(O=f.theme)!=null?O:s,"",""]})]]:u.transfer=[[]]),t.addNode(i[h],{visible:!0,zIndex:0,x:100+g*50,y:1e3,type:l,[l]:u})}),Object.entries(n).filter(([h,d])=>!["linestart","lineend"].includes(h)).forEach(([h,d])=>{d.children.filter(g=>!["linestart","lineend"].includes(g)).forEach(g=>{t.addDirectedEdgeWithKey(`line_${wt(10)}`,i[h],i[g],{visible:!0,zIndex:0,type:qe.Diagonal,[qe.Diagonal]:structuredClone(fs[qe.Diagonal].defaultAttrs),style:le.SingleColor,[le.SingleColor]:{color:s},reconcileId:""})})})},hn="rmg-bridge--",un={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function pn(t){const{isOpen:o,onClose:r,onImport:n}=t,[a]=B.useState(crypto.randomUUID()),s="/rmg/import?"+new URLSearchParams({parentComponent:L.getAppName(),parentId:a});return B.useEffect(()=>{const i=new BroadcastChannel(hn+a);return i.onmessage=h=>{const{event:d,data:g}=h.data;console.log("[rmp] Received event from RMG app clip:",d),d==="CLOSE"?r():d==="IMPORT"&&n(g)},()=>{i.close()}},[]),e.jsx(It,{isOpen:o,onClose:r,sx:un,children:e.jsx("iframe",{src:s,loading:"lazy"})})}const gn="RMP_GALLERY_CHANNEL",fn="OPEN_TEMPLATE",mn=new BroadcastChannel(gn),xn={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"}};function jn(t){const{isOpen:o,onClose:r}=t,n=Yt(),{t:a}=F(),s=X(),i=x.useRef(window.graph),h=x.useCallback(()=>{s(de()),s(he()),s(ce(i.current.export()))},[s,de,he,ce,i]),d=async l=>{const{version:p,...c}=JSON.parse(await Pt(JSON.stringify(l)));s(nt()),i.current.clear(),i.current.import(c.graph),h()},g=async l=>{var c;const p=await((c=(await Promise.allSettled([fetch(`/rmp-gallery/resources/real_world/${l}.json`),fetch(`/rmp-gallery/resources/fantasy/${l}.json`)])).filter(u=>u.status==="fulfilled").find(u=>u.value.status===200))==null?void 0:c.value.json());p?(d(p),n({title:a("header.open.importFromRMPGallery",{id:l}),status:"success",duration:9e3,isClosable:!0})):n({title:a("header.open.failToImportFromRMPGallery",{id:l}),status:"error",duration:9e3,isClosable:!0})};return x.useEffect(()=>{const l=window.location.href;if(l.includes("/s/")){history.replaceState({},a("about.rmp"),l.substring(0,l.indexOf("s/")));const p=l.substring(l.lastIndexOf("s/")+2);g(p)}},[]),x.useEffect(()=>{mn.onmessage=l=>{const{event:p,data:c}=l.data;p===fn&&(g(c),r())}},[]),e.jsx(e.Fragment,{children:e.jsxs(It,{isOpen:o,onClose:r,size:"full",sx:xn,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(Mt,{onClick:r,position:"fixed",top:"5px",right:"15px"})]})})}function yn(){const{t}=F(),o=X(),r=x.useRef(window.graph),n=x.useRef(null),[a,s]=x.useState(!1),[i,h]=x.useState(!1),d=x.useCallback(()=>{o(de()),o(he()),o(ce(r.current.export()))},[o,de,he,ce,r]),g=()=>{o(nt()),r.current.clear(),o(Bt(100)),o(js({x:0,y:0})),d()},l=c=>{try{dn(r.current,c),d()}catch(u){o(Qe({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",u)}finally{s(!1)}},p=async c=>{var f;const u=(f=c.target.files)==null?void 0:f[0];if(console.log("OpenActions.handleUpload():: received file",u),(u==null?void 0:u.type)!=="application/json")o(Qe({status:"error",message:t("OpenActions.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const O=await bn(u),{version:y,...v}=JSON.parse(await Pt(O));o(nt()),r.current.clear(),r.current.import(v.graph),d()}catch(O){o(Qe({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",O)}c.target.value=""};return e.jsxs(ct,{children:[e.jsx(dt,{as:re,size:"sm",variant:"ghost",icon:e.jsx(St,{})}),e.jsxs(ht,{children:[e.jsx(oe,{icon:e.jsx(ms,{}),onClick:g,children:t("header.open.new")}),e.jsx("input",{id:"upload_project",ref:n,type:"file",accept:".json",hidden:!0,onChange:p,"data-testid":"file-upload"}),e.jsx(oe,{icon:e.jsx(St,{}),onClick:()=>{var c;return(c=n==null?void 0:n.current)==null?void 0:c.click()},children:t("header.open.config")}),e.jsx(oe,{icon:e.jsx(xs,{}),onClick:()=>s(!0),children:t("header.open.projectRMG")}),e.jsxs(oe,{icon:e.jsx(E,{}),onClick:()=>h(!0),children:[t("header.open.gallery"),e.jsx(Ue,{ml:"1",colorScheme:"green",children:"New"})]})]}),e.jsx(pn,{isOpen:a,onClose:()=>s(!1),onImport:l}),e.jsx(jn,{isOpen:i,onClose:()=>h(!1)})]})}const bn=t=>new Promise(o=>{const r=new FileReader;r.onloadend=()=>o(r.result),r.readAsText(t)}),ot=(t,o,r)=>{const n=new Blob([r],{type:o});$t(t,n)},$t=(t,o)=>{const r=window.URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)},vn=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),wn=t=>new Promise(o=>{const r=new FileReader;r.onloadend=()=>o(r.result),r.readAsDataURL(t)}),Sn=(t,o)=>t.find(r=>{const n=r.style;return n.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===o.family&&n.getPropertyValue("unicode-range")===o.unicodeRange}),Cn=async t=>{var i,h;const o=Array.from(new Set([...t.querySelectorAll(".rmp-name__mtr__zh"),...t.querySelectorAll(".rmp-name__mtr__en")].map(d=>d.innerHTML).join("").replace(/\s/g,""))).join(""),r=await document.fonts.load("80px GenYoMin TW, Vegur",o),n=(h=(i=document.querySelector("link#fonts_mtr"))==null?void 0:i.sheet)==null?void 0:h.cssRules;if(!n)return Promise.reject(new Error("cssRules can not be found in link#css_share"));const a=Array.from(n).filter(d=>d instanceof CSSFontFaceRule),s=r.reduce((d,g)=>{const l=Sn(a,g);return l?d.find(c=>{const u=c.style,f=l.style;return u.getPropertyValue("font-family")===f.getPropertyValue("font-family")&&u.getPropertyValue("unicode-range")===f.getPropertyValue("unicode-range")})?d:d.concat(l):d},[]);return await Promise.all(s.map(async d=>{try{const g=await fetch(On(d)),l=await wn(await g.blob());return d.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${l}'); `)}catch(g){return console.error(g),""}}))},On=t=>{var r;const o=t.style.src;return vn()?o.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmp//styles/"+((r=o.match(/^url\("([\S*]+)"\)/))==null?void 0:r[1])},ie=new Set,at=new Set,it=new Set,Fe=new Map,te=new Map;let U=[],Me=0;const $e=new Map,Ne=new Map,zn={name:["LEFT END","LEFT END"],secondaryName:!1,num:"00",services:[Ve.local],parents:[],children:["lineend"],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:He.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},kn={name:["RIGHT END","RIGHT END"],secondaryName:!1,num:"00",services:[Ve.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:He.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},An={},Wt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:ae.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:He.right,platform_num:"1",theme:[ys.Shanghai,"sh1","#E3002B",Gt.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:An,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:gt.sh,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1}},En={name:["",""],secondaryName:!1,num:"",services:[Ve.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:He.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},W=t=>`${t[0]}/${t[1]}=${t[2]}${t[3]}`,We=t=>{const o=[];for(let r=t.length-1;r>=0;r--)o.push(t[r]);return o},Ut=t=>t==le.SingleColor||t==le.MTRRaceDays,Tn=t=>{if(t.style==le.SingleColor||t.style==le.MTRRaceDays)return structuredClone(t[t.style].color)},_n=(t,o)=>{const[r,n]=t.extremities(o),a=t.getEdgeAttributes(o),s=a.style;if(r!=n&&Ut(s)){const i=Tn(a);it.has(W(i))||(at.add(i),it.add(W(i)),Fe.set(i,r)),te.has(r)?U.push({target:n,next:te.get(r),color:i}):U.push({target:n,next:-1,color:i}),te.set(r,Me),Me++,te.has(n)?U.push({target:r,next:te.get(n),color:i}):U.push({target:r,next:-1,color:i}),te.set(n,Me),Me++}},Vt=(t,o,r)=>{if(ie.has(t))return;ie.add(t);let n=0;const a=new Set;for(let s=te.get(t);s!=-1;s=U[s].next){const i=U[s].target,h=U[s].color;W(h)==W(r)&&(a.has(i)||(a.add(i),n++,i!=o&&Vt(i,t,r)))}$e.set(t,n)},_t=(t,o)=>{const r=t.stn_list.lineend.parents;r.push(o),t.stn_list.lineend.parents=We(structuredClone(r)),t.stn_list.lineend.parents.length==2&&(t.stn_list.lineend.branch.left=[Re.through,r[1]])},st=t=>{const o=Ne.get(t[0]),r=Ne.get(t[1]);if(o>r){const n=t[0];t[0]=t[1],t[1]=n}return t},lt=(t,o,r,n,a,s)=>{if(ie.has(t)&&(s.stn_list[t]==null||t.startsWith("misc_node_")||s.loop))return[];if(ie.has(t)&&s.stn_list[t]!=null&&s.stn_list[t].children.length>=2){const l=st([o,...s.stn_list[t].parents]);s.stn_list[t].parents=We(l),s.stn_list[t].branch.left=[Re.through,l[1]];const p=[];for(const f of s.stn_list[t].children)f!=o&&p.push(f);s.stn_list[t].children=structuredClone(p),s.stn_list[t].branch.right=[];const c=[];for(const f of s.stn_list.lineend.parents)f!=t&&c.push(f);const u=st(c);return s.stn_list.lineend.parents=We(structuredClone(u)),s.stn_list.lineend.parents.length==2&&(s.stn_list.lineend.branch.left=[Re.through,u[1]]),[t]}ie.add(t);const i=[],h=[],d=new Set,g=new Set;for(let l=te.get(t);l!=-1;l=U[l].next){const p=U[l].target,c=U[l].color;if(p!=o){if(W(c)==W(a)){if(g.has(p))continue;if(g.add(p),t.startsWith("misc_node_")){const u=lt(p,o,r+1,n,a,s);u.length!=0&&i.push(...u)}else{const u=lt(p,t,r+1,n,a,s);u.length!=0&&i.push(...u)}}if(!d.has(W(c))&&W(c)!=W(a)){d.add(W(c));const u={theme:c,name:[c[1],c[1]]};h.push(u)}}}if(i.length==2)for(let l=0;l<2;l++)i[l]=="lineend"&&i.splice(l,1);if(i.length==2&&s.stn_list[i[0]].children[0]!="lineend"&&s.stn_list[i[1]].children[0]!="lineend"&&st(i),t.startsWith("misc_node_"))return i.length==0?(_t(s,o),["lineend"]):i;{const l=n.getNodeAttributes(t).type,p=n.getNodeAttributes(t)[l];if(s.stn_list[t]=structuredClone(En),s.stn_list[t].name=[p.names[0],p.names[1]],s.stn_list[t].num=String(r),n.getNodeAttributes(t).type==M.GzmtrBasic){const c=p;s.stn_list[t].num=c.stationCode,s.stn_list[t].secondaryName=c.secondaryNames}if(n.getNodeAttributes(t).type==M.GzmtrInt){const c=p,u=c.transfer[0];for(const f of u)if(W(f)==W(a)){s.stn_list[t].num=String(f[5]);break}s.stn_list[t].secondaryName=c.secondaryNames}return i.length!=0?(s.stn_list[t].children=We(structuredClone(i)),i.length==2&&(s.stn_list[t].branch.right=[Re.through,i[1]])):(s.stn_list[t].children=["lineend"],_t(s,t)),s.stn_list[t].parents=[o],h.length!=0&&(s.stn_list[t].transfer.groups[0].lines=structuredClone(h)),[t]}},Mn=(t,o,r,n)=>{const a=structuredClone(Wt);n=="LOOP"&&(a.loop=!0);let s;switch(t.getNodeAttributes(r).type){case M.GzmtrBasic:case M.GzmtrInt:s=ae.GZMTR;break;case M.MTR:s=ae.MTR;break;default:s=ae.SHMetro;break}a.theme=structuredClone(o),a.style=s,a.stn_list.linestart=structuredClone(zn),a.stn_list.lineend=structuredClone(kn),ie.clear();const i=lt(r,"linestart",1,t,o,a);if(a.current_stn_idx=i[0],a.stn_list.linestart.children=[i[0]],!(Object.keys(a.stn_list).length<=3||a.stn_list.lineend.parents.length>=3))return structuredClone(a)},Rn=t=>{ie.clear(),at.clear(),it.clear(),Fe.clear(),te.clear(),U=[],Me=0,$e.clear(),Ne.clear(),t.filterEdges(n=>n.startsWith("line")).forEach(n=>{Ut(t.getEdgeAttributes(n).style)&&_n(t,n)});let o=0;t.forEachNode(n=>{Ne.set(n,++o)});const r=[];for(const n of at){ie.clear(),$e.clear(),Vt(Fe.get(n),"line_root",n);let a="no_val",s=2147483647,i=!0,h="LINE";const d=[];for(const[l,p]of $e){if(p==1){const c=Ne.get(l);c<s&&(a=l,s=c),d.push(l)}p==3&&(h="BRANCH"),p>3&&(i=!1)}if(!i)continue;a=="no_val"&&(a=Fe.get(n),h="LOOP",d.push(a));const g=[];for(const l of d){const p=Mn(t,n,l,h);p!=null&&g.push([p,p.stn_list[p.current_stn_idx].name[0],p.stn_list[p.current_stn_idx].name[1]])}r.push({theme:n,param:structuredClone(g),type:h})}return r},Nn=t=>t[0]!=""&&t[1]!=""?t[0]+"_"+t[1]:t[0]!=""?t[0]:t[1]!=""?t[1]:`${new Date().valueOf()}`,Hn=(t,o,r)=>{t.line_name=o,t.line_num=String(r),console.log(t),console.log(JSON.stringify(t)),ot(`RMG_${Nn(o)}.json`,"application/json",JSON.stringify(t))},In={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Pn=t=>{const{isOpen:o,onClose:r}=t,{t:n}=F(),a=x.useRef(window.graph),[s,i]=x.useState(!1),[h,d]=x.useState([[Wt,"",""]]),[g,l]=x.useState(["","",""]),[p,c]=x.useState([]);return x.useEffect(()=>{o&&c(Rn(a.current))},[o]),e.jsxs(V,{isOpen:o,onClose:r,size:"2xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsxs(Y,{children:[e.jsx(b,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")}),e.jsx(ut,{label:n("header.settings.pro"),children:e.jsx(Ue,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(Z,{}),e.jsxs(q,{children:[e.jsx(b,{fontSize:"sm",mt:"3",lineHeight:"100%",children:"This function is designed to convert RMP saves into RMG saves."}),e.jsx(b,{fontSize:"sm",mt:"3",lineHeight:"100%",children:"The lines in the list following are the available lines for converting. You can enter the Chinese line name in the text box on the left, the English line name in the middle, the line code (for Guangzhou Metro style) on the right, and then click the download button on the right to save your RMG saves."}),e.jsx("br",{}),p.length===0?e.jsx(b,{fontSize:"md",children:"No available lines found."}):e.jsx("table",{children:p.map(({theme:u,param:f,type:O})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ct,{name:u[0]=="other"&&u[1]=="other"?u[2]:u[1],bg:u[2],fg:u[3]})}),e.jsx("td",{children:e.jsx(Ke,{placeholder:"Chinese Name",id:"nameCh_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(Ke,{placeholder:"English Name",id:"nameEn_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(Ke,{placeholder:"Line Code",id:"lineNum_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(Ct,{name:n(`header.download.2rmg.type.${O.toLowerCase()}`),bg:In[O],fg:Gt.white})}),e.jsx("td",{children:e.jsx(N,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const y=document.getElementById("nameCh_"+JSON.stringify(u)),v=document.getElementById("nameEn_"+JSON.stringify(u)),m=document.getElementById("lineNum_"+JSON.stringify(u));d(f),l([y.value.trim(),v.value.trim(),m.value.trim()]),i(!0)},size:"sm",children:e.jsx(Lt,{})})})]},JSON.stringify(u)))})]}),e.jsx(ue,{children:e.jsx(N,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:n("close")})})]}),e.jsx(Bn,{isOpen:s,onClose:()=>i(!1),param:h,nameList:g})]})},Bn=t=>{const{isOpen:o,onClose:r,param:n,nameList:a}=t,{t:s}=F(),[i,h]=x.useState("");return x.useEffect(()=>{a[0]!=""&&a[1]!=""?h(a[0]+"/"+a[1]):a[0]!=""?h(a[0]):a[1]!=""&&h(a[1])},[...a]),e.jsxs(V,{isOpen:o,onClose:r,size:"md",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:e.jsxs(b,{as:"b",fontSize:"xl",children:["Download ",i]})}),e.jsx(Z,{}),e.jsx(q,{children:e.jsxs(Zt,{children:[e.jsx(b,{fontSize:"sm",mb:"2",lineHeight:"100%",children:"Please select one of the following stations as the starting station and click it to download."}),n.map(([d,g,l])=>e.jsxs(N,{onClick:()=>{Hn(d,[a[0],a[1]],a[2])},children:[g,"/",l]},`${g}${l}`))]})}),e.jsx(ue,{children:e.jsx(N,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:s("close")})})]})]})},Gn=t=>{const{isOpen:o,onClose:r}=t,{t:n}=F();return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:n("header.download.termsAndConditions")}),e.jsx(Z,{}),e.jsx(q,{children:e.jsxs(qt,{children:[e.jsxs(je,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(k,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(_,{as:E})]}),", ",e.jsxs(k,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(_,{as:E})]})," or ",e.jsxs(k,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(_,{as:E})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(k,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(_,{as:E})]}),"，",e.jsxs(k,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(_,{as:E})]}),"或",e.jsxs(k,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(_,{as:E})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(je,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(_,{as:E})]})," and ",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(_,{as:E})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(_,{as:E})]}),"及",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(_,{as:E})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(je,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(k,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(_,{as:E})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(k,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(_,{as:E})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(je,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(je,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(k,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(_,{as:E})]})," ","– the open-source emoji and icon project. License:",e.jsxs(k,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(_,{as:E})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(k,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(_,{as:E})]}),"所设计。许可证：",e.jsxs(k,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(_,{as:E})]})]}),e.jsxs(je,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},Ln=Gn;function Dn(){const{t}=F(),{telemetry:{project:o}}=se(C=>C.app),{nodeExists:r}=se(C=>C.runtime),n=x.useRef(window.graph),a=Rt("white","gray.800"),[s,i]=x.useState("png"),h={png:t("header.download.png"),svg:t("header.download.svg")},[d,g]=x.useState(100),l=Object.fromEntries([25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].map(C=>[C,`${C}%`])),[p,c]=x.useState(!1),u=[{type:"select",label:t("header.download.format"),value:s,options:h,onChange:C=>i(C==="png"?"png":"svg")}],f=[{type:"select",label:t("header.download.scale"),value:d,options:l,onChange:C=>g(C)},{type:"switch",label:t("header.download.transparent"),isChecked:p,onChange:c}],[O,y]=x.useState(!1),[v,m]=x.useState(!1),[S,H]=x.useState(!1),[A,j]=x.useState(!1),[$,ee]=x.useState(!1),Q=()=>{o&&L.event(rt.DOWNLOAD_PARAM,{"#nodes":n.current.order,"#edges":n.current.size});const C=Ss(Cs.getState().param);ot(`RMP_${new Date().valueOf()}.json`,"application/json",C)},z=async()=>{y(!1),o&&L.event(rt.DOWNLOAD_IMAGES,{numberOfNodes:n.current.order,numberOfEdges:n.current.size});const{xMin:C,yMin:pe,xMax:Ie,yMax:Pe}=Us(n.current),[Oe,ze]=[Ie-C,Pe-pe],I=document.getElementById("canvas").cloneNode(!0);if([...I.children].filter(G=>n.current.hasNode(G.id)&&n.current.getNodeAttribute(G.id,"type")===Os.Virtual).forEach(G=>I.removeChild(G)),S||I.appendChild(Fn(Ie-400,Pe-60)),I.setAttribute("viewBox",`${C} ${pe} ${Oe} ${ze}`),I.setAttribute("width",Oe.toString()),I.setAttribute("height",ze.toString()),Object.entries({".rmp-name__zh":["font-family"],".rmp-name__en":["font-family"],".rmp-name__mtr__zh":["font-family"],".rmp-name__mtr__en":["font-family"],".rmp-name-station":["paint-order","stroke","stroke-width"]}).forEach(([G,Be])=>{const ft=document.querySelector(G);if(ft===null)return;const Jt=window.getComputedStyle(ft);I.querySelectorAll(G).forEach(mt=>{Be.forEach(xt=>{mt.setAttribute(xt,Jt.getPropertyValue(xt))}),mt.classList.remove(G)})}),r[M.MTR])try{const G=await Cn(I),Be=document.createElement("style");Be.textContent=G.join(`
`),I.prepend(Be)}catch(G){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(G)}if(s==="svg"){ot(`RMP_${new Date().valueOf()}.svg`,"image/svg+xml",I.outerHTML);return}document.body.appendChild(I);const Je="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(I.outerHTML)));document.body.removeChild(I);const ge=document.createElement("canvas"),[ke,fe]=[Oe*d/100,ze*d/100];ge.width=ke,ge.height=fe;const me=ge.getContext("2d");p||(me.fillStyle=a,me.fillRect(0,0,ke,fe));const xe=new Image;xe.onload=()=>{me.drawImage(xe,0,0,ke,fe),ge.toBlob(G=>$t(`RMP_${new Date().valueOf()}.png`,G),"image/png")},xe.src=Je};return e.jsxs(ct,{id:"download",children:[e.jsx(dt,{as:re,size:"sm",variant:"ghost",icon:e.jsx(Lt,{})}),e.jsxs(ht,{children:[e.jsx(oe,{icon:e.jsx(bs,{}),onClick:Q,children:t("header.download.config")}),e.jsx(oe,{icon:e.jsx(vs,{}),onClick:()=>ee(!0),children:t("header.download.2rmg.title")}),e.jsx(oe,{icon:e.jsx(ws,{}),onClick:()=>y(!0),children:t("header.download.image")})]}),e.jsxs(V,{size:"xl",isOpen:O,onClose:()=>y(!1),children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:t("header.download.image")}),e.jsx(Z,{}),e.jsxs(q,{children:[e.jsx(Ce,{fields:u}),s==="png"&&e.jsx(Ce,{fields:f}),e.jsx("br",{}),e.jsx(jt,{isChecked:S,onChange:C=>H(C.target.checked),children:e.jsxs(b,{children:[t("header.download.shareInfo1"),e.jsxs(k,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(_,{as:E})]}),t("header.download.shareInfo2")]})}),e.jsx(jt,{isChecked:A,onChange:C=>j(C.target.checked),children:e.jsxs(b,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(k,{color:"teal.500",onClick:()=>m(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(_,{as:E})]}),t("header.download.period")]})})]}),e.jsx(ue,{children:e.jsx(Qt,{children:e.jsx(N,{colorScheme:"teal",variant:"outline",size:"sm",disabled:!A,onClick:z,children:t("header.download.confirm")})})}),e.jsx(Ln,{isOpen:v,onClose:()=>m(!1)})]})]}),e.jsx(Pn,{isOpen:$,onClose:()=>ee(!1)})]})}const Fn=(t,o)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.setAttribute("transform",`translate(${t}, ${o})scale(2)`);const n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("width","40"),n.setAttribute("height","40"),n.setAttribute("x","-50"),n.setAttribute("y","-20");const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("font-family","Arial, sans-serif"),a.setAttribute("font-size","16"),a.appendChild(document.createTextNode("Rail Map Painter"));const s=document.createElementNS("http://www.w3.org/2000/svg","text");return s.setAttribute("font-family","Arial, sans-serif"),s.setAttribute("font-size","10"),s.setAttribute("y","10"),s.appendChild(document.createTextNode("https://railmapgen.github.io/rmp/")),r.appendChild(n),r.appendChild(a),r.appendChild(s),r},$n="/rmp/assets/github-mark-7a0dd11e.svg",Wn="/rmp/assets/slack-mark-19839006.svg",Un=t=>{const{isOpen:o,onClose:r}=t,{t:n}=F(),a=L.getAppVersion(),[s,i]=x.useState(!1);return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:n("header.about.title")}),e.jsx(Z,{}),e.jsxs(q,{paddingBottom:10,children:[e.jsxs(yt,{direction:"row",children:[e.jsx(bt,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(yt,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(b,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),e.jsx(b,{children:a}),e.jsx(b,{}),e.jsx(b,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(D,{margin:5,children:e.jsx(b,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(Se,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(Se,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),e.jsxs(Ee,{children:[e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(b,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(b,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(b,{fontSize:"sm",children:n("header.about.langonginc")}),e.jsx(b,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Se,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),e.jsx(Ee,{children:e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(b,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]})}),e.jsx(Se,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(Ee,{children:[e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(be,{src:$n,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(b,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(be,{src:Wn,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(b,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(b,{fontSize:"sm",as:"i",children:"#rmg, #rmp, #palette-and-templates, #random"})]})]})]}),e.jsx(Se,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.linkExchange")}),e.jsxs(Ee,{children:[e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>i(!0),cursor:"pointer",children:[e.jsx(be,{src:"/rmp//images/guidaoTransit.jpg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.guidaoTransit")}),e.jsx(b,{fontSize:"sm",children:n("header.about.guidaoTransitContent")})]})]}),e.jsxs(V,{size:"6xl",isOpen:s,onClose:()=>i(!1),children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:n("header.about.guidaoTransit")}),e.jsx(Z,{}),e.jsx(q,{paddingBottom:10,children:e.jsx(bt,{width:"1080",height:"304",src:"/rmp//images/guidaoTransitQRCode.png"})})]})]})]})]})]})]})},Vn=Un,Jn=()=>{const[t,o]=x.useState(!1),{svgViewBoxZoom:r}=se(s=>s.param),n=X(),a=[{type:"slider",label:"",value:400-r,min:10,max:390,step:1,onChange:s=>n(Bt(400-s)),leftIcon:e.jsx(zs,{}),rightIcon:e.jsx(Ot,{}),minW:160}];return e.jsxs(Xt,{isOpen:t,onOpen:()=>o(!0),onClose:()=>o(!1),children:[e.jsx(es,{children:e.jsx(re,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Ot,{}),onClick:()=>o(!t)})}),e.jsx(ts,{children:e.jsx(ss,{children:e.jsx(Ce,{fields:a,noLabel:!0})})})]})},Kn=t=>{const{isOpen:o,onClose:r}=t,n=X(),{t:a}=F(),s=x.useRef(window.graph),[i,h]=x.useState(0),[d,g]=x.useState(0),l=[{type:"input",label:a("header.settings.procedures.translate.x"),value:i.toString(),variant:"number",onChange:c=>h(Number(c)),minW:"full"},{type:"input",label:a("header.settings.procedures.translate.y"),value:d.toString(),variant:"number",onChange:c=>g(Number(c)),minW:"full"}],p=()=>{s.current.forEachNode((c,u)=>{s.current.updateNodeAttribute(c,"x",f=>(f!=null?f:0)+i),s.current.updateNodeAttribute(c,"y",f=>(f!=null?f:0)+d)}),n(de()),n(he()),n(ce(s.current.export())),r()};return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:a("header.settings.procedures.translate.title")}),e.jsx(Z,{}),e.jsxs(q,{children:[a("header.settings.procedures.translate.content"),e.jsx(Ce,{fields:l})]}),e.jsxs(ue,{children:[e.jsx(N,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(N,{colorScheme:"red",onClick:p,children:a("apply")})]})]})]})},Yn=t=>{const{isOpen:o,onClose:r}=t,n=X(),{t:a}=F(),s=x.useRef(window.graph),[i,h]=x.useState(1),d=[{type:"input",label:a("header.settings.procedures.scale.factor"),value:i.toString(),variant:"number",onChange:l=>h(Number(l)),minW:"full"}],g=()=>{s.current.forEachNode((l,p)=>{s.current.updateNodeAttribute(l,"x",c=>(c!=null?c:0)*i),s.current.updateNodeAttribute(l,"y",c=>(c!=null?c:0)*i)}),n(de()),n(he()),n(ce(s.current.export())),r()};return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:a("header.settings.procedures.scale.title")}),e.jsx(Z,{}),e.jsxs(q,{children:[a("header.settings.procedures.scale.content"),e.jsx(Ce,{fields:d})]}),e.jsxs(ue,{children:[e.jsx(N,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(N,{colorScheme:"red",onClick:g,children:a("apply")})]})]})]})},Zn=t=>{const{isOpen:o,onClose:r}=t,n=X(),{t:a}=F(),s=x.useRef(window.graph),i=Object.fromEntries(Object.entries(De).map(([u,f])=>[u,a(f.metadata.displayName).toString()])),[h,d]=x.useState(Object.keys(De).at(0)),[g,l]=x.useState(Object.keys(De).at(1)),p=[{type:"select",label:a("header.settings.procedures.changeType.changeFrom"),value:h,options:i,disabledOptions:[g],onChange:u=>d(u),minW:"full"},{type:"select",label:a("header.settings.procedures.changeType.changeTo"),value:g,options:i,disabledOptions:[h],onChange:u=>l(u),minW:"full"}],c=()=>{Vs(s.current,h,g),n(de()),n(ce(s.current.export()))};return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsxs(Y,{children:[e.jsx(b,{as:"b",fontSize:"xl",children:a("header.settings.procedures.changeType.title")}),e.jsx(ut,{label:a("header.settings.pro"),children:e.jsx(Ue,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(Z,{}),e.jsxs(q,{children:[e.jsx(Ce,{fields:p}),e.jsx(b,{fontSize:"sm",mt:"3",lineHeight:"100%",color:"red.500",children:a("header.settings.procedures.changeType.info")})]}),e.jsxs(ue,{children:[e.jsx(N,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(N,{colorScheme:"red",onClick:c,children:a("apply")})]})]})]})},qn=t=>{const{isOpen:o,onClose:r}=t,n=X(),{theme:a}=se(c=>c.runtime),{t:s}=F(),i=x.useRef(window.graph),[h,d]=x.useState(a),[g,l]=x.useState(!1),p=()=>{i.current.filterEdges((c,u,f,O,y,v,m)=>u.style===le.SingleColor&&JSON.stringify(u[le.SingleColor].color)===JSON.stringify(h)).forEach(c=>i.current.dropEdge(c)),n(he()),n(ce(i.current.export())),r()};return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:s("header.settings.procedures.removeLines.title")}),e.jsx(Z,{}),e.jsxs(q,{children:[s("header.settings.procedures.removeLines.content"),e.jsx(ks,{theme:h,onClick:()=>l(!0)}),e.jsx(As,{isOpen:g,defaultTheme:h,onClose:()=>l(!1),onUpdate:c=>d(c)})]}),e.jsxs(ue,{children:[e.jsx(N,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:s("cancel")}),e.jsx(N,{colorScheme:"red",onClick:p,children:s("remove")})]})]})]})},Le={width:"100%",justifyContent:"space-between"},we={fontFamily:"-apple-system"},Qn=t=>{const{isOpen:o,onClose:r}=t,{keepLastPath:n}=se(m=>m.runtime),a=X(),{t:s}=F(),i=Rt("primary.500","primary.300"),[h,d]=x.useState(!1),[g,l]=x.useState(!1),[p,c]=x.useState(!1),[u,f]=x.useState(!1),O=L.isAllowAnalytics(),{telemetry:{app:y}}=se(m=>m.app),v=m=>a(Ns(m));return e.jsxs(V,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:s("header.settings.title")}),e.jsx(Z,{}),e.jsx(q,{children:e.jsxs(Ee,{divider:e.jsx(ns,{borderColor:"gray.200"}),children:[e.jsxs(D,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:s("header.settings.preference.title")}),e.jsx(D,{mt:"3",children:e.jsxs(D,{display:"flex",mb:"1",children:[e.jsx(b,{flex:"1",children:s("header.settings.preference.keepLastPath")}),e.jsx(Ye,{isChecked:n,onChange:({target:{checked:m}})=>a(Es(m))})]})})]}),e.jsxs(D,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:s("header.settings.shortcuts.title")}),e.jsx(D,{mt:"3",children:e.jsxs(rs,{children:[e.jsx(os,{children:e.jsxs(P,{children:[e.jsx(vt,{children:s("header.settings.shortcuts.keys")}),e.jsx(vt,{children:s("header.settings.shortcuts.description")})]})}),e.jsxs(as,{children:[e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(T,{children:"f"})}),e.jsx(w,{children:s("header.settings.shortcuts.f")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(Ts,{})}),e.jsx(w,{children:s("header.settings.shortcuts.arrowUpward")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(_s,{})}),e.jsx(w,{children:s("header.settings.shortcuts.arrowBack")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(Ms,{})}),e.jsx(w,{children:s("header.settings.shortcuts.arrowForward")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(Rs,{})}),e.jsx(w,{children:s("header.settings.shortcuts.arrowDownward")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(T,{children:"i"})}),e.jsx(w,{children:s("header.settings.shortcuts.i")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(T,{children:"j"})}),e.jsx(w,{children:s("header.settings.shortcuts.j")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(T,{children:"k"})}),e.jsx(w,{children:s("header.settings.shortcuts.k")})]}),e.jsxs(P,{children:[e.jsx(w,{children:e.jsx(T,{children:"l"})}),e.jsx(w,{children:s("header.settings.shortcuts.l")})]}),e.jsxs(P,{children:[e.jsx(w,{children:Ae?e.jsx(T,{sx:we,children:"⇧"}):e.jsx(T,{children:"shift"})}),e.jsx(w,{children:s("header.settings.shortcuts.shift")})]}),e.jsxs(P,{children:[e.jsx(w,{children:Ae?e.jsx(T,{sx:we,children:"⌥"}):e.jsx(T,{children:"alt"})}),e.jsx(w,{children:s("header.settings.shortcuts.alt")})]}),e.jsxs(P,{children:[e.jsx(w,{children:Ae?e.jsx(T,{sx:we,children:"⌫"}):e.jsx(T,{children:"delete"})}),e.jsx(w,{children:s("header.settings.shortcuts.delete")})]}),e.jsxs(P,{children:[e.jsxs(w,{children:[Ae?e.jsx(T,{sx:we,children:"⌘"}):e.jsx(T,{children:"ctrl"})," + ",e.jsx(T,{children:"z"})]}),e.jsx(w,{children:s("header.settings.shortcuts.undo")})]}),e.jsxs(P,{children:[e.jsx(w,{children:Ae?e.jsxs(e.Fragment,{children:[e.jsx(T,{sx:we,children:"⇧"})," + ",e.jsx(T,{sx:we,children:"⌘"})," + ",e.jsx(T,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{children:"ctrl"})," + ",e.jsx(T,{children:"y"})]})}),e.jsx(w,{children:s("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(D,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:s("header.settings.procedures.title")}),e.jsxs(D,{mt:"3",children:[e.jsx(N,{sx:Le,rightIcon:e.jsx(Ge,{}),onClick:()=>d(!0),children:s("header.settings.procedures.translate.title")}),e.jsx(Kn,{isOpen:h,onClose:()=>d(!1)}),e.jsx(N,{sx:Le,rightIcon:e.jsx(Ge,{}),onClick:()=>l(!0),children:s("header.settings.procedures.scale.title")}),e.jsx(Yn,{isOpen:g,onClose:()=>l(!1)}),e.jsx(N,{sx:Le,rightIcon:e.jsx(Ge,{}),onClick:()=>c(!0),children:e.jsxs(D,{children:[s("header.settings.procedures.changeType.title"),e.jsx(ut,{label:s("header.settings.pro"),children:e.jsx(Ue,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]})}),e.jsx(Zn,{isOpen:p,onClose:()=>c(!1)}),e.jsx(N,{sx:Le,rightIcon:e.jsx(Ge,{}),onClick:()=>f(!0),children:s("header.settings.procedures.removeLines.title")}),e.jsx(qn,{isOpen:u,onClose:()=>f(!1)})]})]}),e.jsxs(D,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:s("header.settings.telemetry.title")}),e.jsxs(D,{mt:"3",children:[e.jsxs(D,{display:"flex",mb:"1",children:[e.jsx(b,{flex:"1",children:s("header.settings.telemetry.essential")}),e.jsx(Ye,{isChecked:O,isDisabled:!0})]}),e.jsx(b,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:s("header.settings.telemetry.essentialInfo")}),e.jsxs(k,{color:i,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[s("header.settings.telemetry.essentialLink")," ",e.jsx(_,{as:E})]}),e.jsxs(D,{display:"flex",mb:"1",children:[e.jsx(b,{flex:"1",children:s("header.settings.telemetry.additional")}),e.jsx(Ye,{isChecked:y,onChange:({target:{checked:m}})=>v(m)})]}),e.jsx(b,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:s("header.settings.telemetry.additionalInfo")})]})]})]})})]})]})},Xn=Qn;function er(){const{t}=F(),o=X(),{telemetry:{app:r}}=se(c=>c.app),{past:n,future:a}=se(c=>c.param),[s,i]=x.useState(!1),[h,d]=x.useState(!1),g=Tt(L.getEnv),l=Tt(L.getAppVersion);x.useEffect(()=>{r&&g!==Xe.DEV&&L.event(rt.APP_LOAD,{isStandaloneWindow:L.isStandaloneWindow()})},[g]);const p=async c=>{L.getI18nInstance().changeLanguage(c)};return e.jsxs(Hs,{children:[e.jsx(Se,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t("header.about.rmp")}),e.jsx(Is,{environment:g,version:l,popoverHeader:g===Xe.PRD?void 0:e.jsxs(Et,{i18nKey:"header.popoverHeader",environment:g,children:["You're on ",{environment:g}," environment!"]}),popoverBody:g===Xe.PRD?void 0:e.jsx(Et,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(is,{ml:"auto",children:[e.jsx(ne,{children:e.jsx(re,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(Ps,{}),disabled:n.length===0,onClick:()=>o(Bs())})}),e.jsx(ne,{children:e.jsx(re,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(Gs,{}),disabled:a.length===0,onClick:()=>o(Ls())})}),e.jsx(ne,{children:e.jsx(Jn,{})}),e.jsx(ne,{children:e.jsx(yn,{})}),e.jsx(ne,{children:e.jsx(Dn,{})}),L.isStandaloneWindow()&&e.jsx(ne,{children:e.jsxs(ct,{children:[e.jsx(dt,{as:re,icon:e.jsx(Ds,{}),variant:"ghost",size:"sm"}),e.jsx(ht,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(c=>e.jsx(oe,{onClick:()=>p(c),children:cn[c][c]},c))})]})}),e.jsx(ne,{children:e.jsx(re,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Fs,{}),onClick:()=>i(!0)})}),e.jsx(ne,{children:e.jsx(re,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx($s,{}),onClick:()=>d(!0)})})]}),e.jsx(Xn,{isOpen:s,onClose:()=>i(!1)}),e.jsx(Vn,{isOpen:h,onClose:()=>d(!1)})]})}function tr(){const t=X(),o=se(n=>n.runtime.globalAlerts),r=n=>{L.isStandaloneWindow()?window.open(`/${n}`,"_blank"):L.openApp(n)};return e.jsx(e.Fragment,{children:Object.entries(o).map(([n,{message:a,url:s,linkedApp:i}])=>e.jsxs(ls,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(cs,{}),i?e.jsx(k,{onClick:()=>r(i),children:a}):s?e.jsx(k,{href:s,target:"_blank",children:a}):a,e.jsx(Mt,{ml:"auto",onClick:()=>t(Ws(n))})]},n))})}function lr(){return e.jsxs(e.Fragment,{children:[e.jsx(er,{}),e.jsx(tr,{})]})}export{lr as default};
