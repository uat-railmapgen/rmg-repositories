"use strict";(self.webpackChunkrmp=self.webpackChunkrmp||[]).push([[8423],{1740:function(e,t,n){n.r(t),n.d(t,{default:function(){return P}});var r=n(4942),i=n(9439),u=n(2791),o=n(8617),s=n(5984),a=n(7339),c=n(8284),l=n(3671),d=n(1413),f=n(8817),y=n(1580),p=n(6255),v=n(184),g=function(e){var t=e.id,n=e.type,r=e.attrs,o=e.styleType,s=e.styleAttrs,a=void 0===s?p.b[o].defaultAttrs:s,c=e.newLine,l=e.handleClick,d=e.x1,f=e.y1,y=e.x2,g=e.y2,h=u.useState("M 0,0 L 0,0"),x=(0,i.Z)(h,2),m=x[0],Z=x[1];u.useEffect((function(){Z(p.V[n].generatePath(d,y,f,g,r))}),[n,JSON.stringify(r),d,y,f,g]);var b=p.b[o].component;return u.useMemo((function(){return(0,v.jsx)(b,{id:t,type:n,path:m,styleAttrs:a,newLine:c,handleClick:l})}),[t,n,m,o,JSON.stringify(a),c,l])},h=n(6882),x=n(3300),m=n(3433),Z=n(7762),b=function(e){var t=function(e){var t,n=e.filterDirectedEdges((function(e,t,n,r,i,u,o){return e.startsWith("line")&&""!==t.reconcileId})),r={},i=(0,Z.Z)(n);try{for(i.s();!(t=i.n()).done;){var u=t.value,o=e.getEdgeAttribute(u,"reconcileId");o in r?r[o].push(u):r[o]=[u]}}catch(s){i.e(s)}finally{i.f()}return r}(e),n=[],r=[];return Object.values(t).forEach((function(t){if(1!==t.length){var u=e.getEdgeAttribute(t.at(0),"type");if(t.every((function(t){return e.getEdgeAttribute(t,"type")===u}))){var o=e.getEdgeAttribute(t.at(0),"style");if(t.every((function(t){return e.getEdgeAttribute(t,"style")===o}))){var s={},a=new Set,c=new Set,l=Object.fromEntries(t.map((function(t){var n,r,u=e.extremities(t),o=(0,i.Z)(u,2),l=o[0],d=o[1];return s[l]=(null!==(n=s[l])&&void 0!==n?n:0)+1,s[d]=(null!==(r=s[d])&&void 0!==r?r:0)+1,a.add(l),c.add(d),[l,[t,d]]}))),d=Array.from(a).filter((function(e){return 1===s[e]})),f=Array.from(c).filter((function(e){return 1===s[e]}));if(1===d.length&&1===f.length){var y=d[0],p=f[0];if(y!==p){for(var v=[l[y][0]],g=l[y][1],h=1;h<t.length;h+=1){var x,Z=null===(x=l[g])||void 0===x?void 0:x.at(1);if(!Z)return void r.push.apply(r,(0,m.Z)(t));v.push(l[g][0]),g=Z}g===p&&v.length===t.length?n.push(v):r.push.apply(r,(0,m.Z)(t))}else r.push.apply(r,(0,m.Z)(t))}else r.push.apply(r,(0,m.Z)(t))}else r.push.apply(r,(0,m.Z)(t))}else r.push.apply(r,(0,m.Z)(t))}else r.push.apply(r,(0,m.Z)(t))})),{allReconciledLines:n,danglingLines:r}},A=function(e){return e.filterNodes((function(e,t){return e.startsWith("stn")})).map((function(t){return[t,e.getNodeAttributes(t)]})).filter((function(e){var t=(0,i.Z)(e,2);t[0];return t[1].visible})).map((function(e){var t=(0,i.Z)(e,2),n=t[0],u=t[1];return(0,r.Z)({node:n,visible:u.visible,zIndex:u.zIndex,x:u.x,y:u.y,type:u.type},u.type,u[u.type])}))},E=function(e){return e.filterDirectedEdges((function(e,t,n,r,i,u,o){return e.startsWith("line")&&t.visible&&""===t.reconcileId})).map((function(t){var n=e.extremities(t),r=(0,i.Z)(n,2),u=r[0],o=r[1],s=e.getNodeAttributes(u),a=e.getNodeAttributes(o),c=e.getEdgeAttribute(t,"type"),l=e.getEdgeAttribute(t,c),d=e.getEdgeAttribute(t,"style"),f=e.getEdgeAttribute(t,d);return{edge:t,x1:s.x,y1:s.y,x2:a.x,y2:a.y,type:c,attr:l,style:d,styleAttr:f}}))},w=function(e){return e.filterNodes((function(e,t){return e.startsWith("misc_node")})).map((function(t){return[t,e.getNodeAttributes(t)]})).filter((function(e){var t=(0,i.Z)(e,2);t[0];return t[1].visible})).map((function(e){var t=(0,i.Z)(e,2),n=t[0],u=t[1];return(0,r.Z)({node:n,visible:u.visible,zIndex:u.zIndex,x:u.x,y:u.y,type:u.type},u.type,u[u.type])}))},N=function(){var e=(0,a.u5)(),t=(0,a.Qy)((function(e){return e.runtime})),n=t.selected,m=t.refresh,Z=m.nodes,N=m.edges,P=t.mode,L=t.active,M=t.keepLastPath,S=t.theme,I=(0,a.Qy)((function(e){return e.param})).svgViewBoxZoom,_=u.useRef(window.graph),k=u.useState({x:0,y:0}),W=(0,i.Z)(k,2),V=W[0],R=W[1],j=u.useState({x:0,y:0}),C=(0,i.Z)(j,2),K=C[0],D=C[1],O=(0,o.ZP)((function(t,r){r.stopPropagation();var i=r.currentTarget,u=(0,x.yK)(r),o=u.x,s=u.y;i.setPointerCapture(r.pointerId),R({x:o,y:s}),e((0,l.Iv)(t)),!r.shiftKey&&n.length<=1&&e((0,l.x_)()),e((0,l.Gv)(t))})),U=(0,o.ZP)((function(t,r){r.stopPropagation();var i=(0,x.yK)(r),u=i.x,o=i.y;"free"===P&&L===t?(n.forEach((function(e){_.current.updateNodeAttributes(e,(function(e){return(0,d.Z)((0,d.Z)({},e),{},{x:(0,x.Z9)(e.x-(V.x-u)*I/100,r.altKey?1:5),y:(0,x.Z9)(e.y-(V.y-o)*I/100,r.altKey?1:5)})}))})),e((0,l.ML)()),e((0,l.lH)())):P.startsWith("line")&&D({x:(V.x-u)*I/100,y:(V.y-o)*I/100})})),z=(0,o.ZP)((function(t,n){if(n.stopPropagation(),P.startsWith("line")||P.startsWith("misc-edge")){M||e((0,l.PM)("free"));["stn_core_","virtual_circle_"].forEach((function(e){var t,i,u=null===(t=document.elementsFromPoint(n.clientX,n.clientY)[0].attributes)||void 0===t||null===(i=t.getNamedItem("id"))||void 0===i?void 0:i.value;if(null!==u&&void 0!==u&&u.startsWith(e)){var o,a=P.slice(5),c="line_".concat((0,s.x0)(10));_.current.addDirectedEdgeWithKey(c,L,u.slice(e.length),(o={visible:!0,zIndex:0,type:a},(0,r.Z)(o,a,JSON.parse(JSON.stringify(p.V[a].defaultAttrs))),(0,r.Z)(o,"style",f.R.SingleColor),(0,r.Z)(o,f.R.SingleColor,{color:S}),(0,r.Z)(o,"reconcileId",""),o))}}))}else if("free"===P){var i=(0,x.yK)(n),u=i.x,o=i.y;V.x-u===0&&V.y-o===0&&e((0,l.Iv)(t))}e((0,l.Iv)(void 0)),e((0,l.ML)()),e((0,l.lH)()),e((0,c.DR)(_.current.export()))})),T=(0,o.ZP)((function(t,n){e((0,l.x_)()),e((0,l.Gv)(t))})),J=u.useState(A(_.current)),B=(0,i.Z)(J,2),F=B[0],H=B[1],Q=u.useState(E(_.current)),X=(0,i.Z)(Q,2),Y=X[0],G=X[1],q=u.useState(w(_.current)),$=(0,i.Z)(q,2),ee=$[0],te=$[1],ne=u.useState([]),re=(0,i.Z)(ne,2),ie=re[0],ue=re[1],oe=u.useState([]),se=(0,i.Z)(oe,2),ae=se[0],ce=se[1];return u.useEffect((function(){H(A(_.current)),G(E(_.current)),te(w(_.current))}),[Z]),u.useEffect((function(){G(E(_.current));var e=b(_.current),t=e.allReconciledLines,n=e.danglingLines;ue(t),ce(n)}),[]),u.useEffect((function(){G(E(_.current));var e=b(_.current),t=e.allReconciledLines,n=e.danglingLines;ue(t),ce(n)}),[N]),(0,v.jsxs)(v.Fragment,{children:[ae.map((function(e){var t=_.current.extremities(e),n=(0,i.Z)(t,2),r=n[0],u=n[1],o=_.current.getNodeAttributes(r),s=_.current.getNodeAttributes(u);return(0,v.jsx)(g,{id:e,x1:o.x,y1:o.y,x2:s.x,y2:s.y,newLine:!1,type:f.y.Simple,attrs:p.V[f.y.Simple].defaultAttrs,styleType:f.R.SingleColor,styleAttrs:{color:["","","#c0c0c0","#fff"]},handleClick:T},e)})),ie.map((function(e){var t=function(e,t){if(t.every((function(t){return e.hasEdge(t)}))){for(var n=t.map((function(t){var n,r=e.extremities(t),u=(0,i.Z)(r,2),o=u[0],s=u[1],a=e.getNodeAttributes(o),c=e.getNodeAttributes(s),l=e.getEdgeAttribute(t,"type"),d=null!==(n=e.getEdgeAttribute(t,l))&&void 0!==n?n:p.V[l].defaultAttrs;return p.V[l].generatePath(a.x,c.x,a.y,c.y,d)})),r="".concat(n[0]," "),u=1;u<t.length;u+=1)r+=n[u].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return r}}(_.current,e);if(!t)return(0,v.jsx)(v.Fragment,{});var n=e.at(0),r=_.current.getEdgeAttribute(n,"type"),u=_.current.getEdgeAttribute(n,"style"),o=_.current.getEdgeAttribute(n,u),s=p.b[u].component;return(0,v.jsx)(s,{id:n,type:r,path:t,styleAttrs:o,newLine:!1,handleClick:T},n)})),Y.map((function(e){var t=e.edge,n=e.x1,r=e.y1,i=e.x2,u=e.y2,o=e.type,s=e.attr,a=e.style,c=e.styleAttr;return(0,v.jsx)(g,{id:t,x1:n,y1:r,x2:i,y2:u,newLine:!1,type:o,attrs:s,styleType:a,styleAttrs:c,handleClick:T},t)})),ee.map((function(e){var t=e.node,n=e.x,r=e.y,i=e.type,u=h.Z[i].component;return(0,v.jsx)(u,{id:t,x:n,y:r,attrs:e[i],handlePointerDown:O,handlePointerMove:U,handlePointerUp:z},t)})),F.map((function(e){var t=e.node,n=e.x,i=e.y,u=e.type,o=y.Z[u].component;return(0,v.jsx)(o,{id:t,x:n,y:i,attrs:(0,r.Z)({},u,e[u]),handlePointerDown:O,handlePointerMove:U,handlePointerUp:z},t)})),P.startsWith("line")&&L&&(0,v.jsx)(g,{id:"create_in_progress___no_use",x1:_.current.getNodeAttribute(L,"x"),y1:_.current.getNodeAttribute(L,"y"),x2:_.current.getNodeAttribute(L,"x")-K.x,y2:_.current.getNodeAttribute(L,"y")-K.y,newLine:!0,type:P.slice(5),attrs:p.V[P.slice(5)].defaultAttrs,styleType:f.R.SingleColor,styleAttrs:{color:S}})]})},P=function(){var e,t,n=(0,a.u5)(),d=function(){n((0,l.ML)()),n((0,l.lH)()),n((0,c.DR)(L.current.export()))},f=(0,a.Qy)((function(e){return e.runtime})),p=f.mode,g=f.lastTool,m=f.active,Z=f.selected,b=f.keepLastPath,A=f.theme,E=(0,a.Qy)((function(e){return e.param})),w=E.svgViewBoxZoom,P=E.svgViewBoxMin,L=u.useRef(window.graph),M=u.useState({x:0,y:0}),S=(0,i.Z)(M,2),I=S[0],_=S[1],k=u.useState({x:0,y:0}),W=(0,i.Z)(k,2),V=W[0],R=W[1],j=(0,o.ZP)((function(e){var t=(0,x.yK)(e),i=t.x,u=t.y;if(p.startsWith("station")){n((0,l.PM)("free"));var o=(0,s.x0)(10),a=p.slice(8),c=JSON.parse(JSON.stringify(y.Z[a].defaultAttrs));"color"in c&&(c.color=A),L.current.addNode("stn_".concat(o),(0,r.Z)({visible:!0,zIndex:0,x:(0,x.Z9)(i*w/100+P.x,10),y:(0,x.Z9)(u*w/100+P.y,10),type:a},a,c)),d()}else if(p.startsWith("misc-node")){n((0,l.PM)("free"));var f=(0,s.x0)(10),v=p.slice(10);L.current.addNode("misc_node_".concat(f),(0,r.Z)({visible:!0,zIndex:0,x:(0,x.Z9)(i*w/100+P.x,10),y:(0,x.Z9)(u*w/100+P.y,10),type:v},v,JSON.parse(JSON.stringify(h.Z[v].defaultAttrs)))),d()}else("free"===p||p.startsWith("line"))&&(p.startsWith("line")&&(n((0,l.PM)("free")),b&&n((0,l.Mm)(!1))),_({x:i,y:u}),R(P),e.shiftKey||(n((0,l.Iv)("background")),n((0,l.x_)())))})),C=(0,o.ZP)((function(e){if("background"===m){var t=(0,x.yK)(e),r=t.x,i=t.y;n((0,c.FL)({x:V.x+(I.x-r)*w/100,y:V.y+(I.y-i)*w/100}))}})),K=(0,o.ZP)((function(e){"background"!==m||e.shiftKey||n((0,l.Iv)(void 0))})),D=(0,o.ZP)((function(e){e.deltaY>0&&w+10<400?n((0,c.u4)(w+10)):e.deltaY<0&&w-10>0&&n((0,c.u4)(w-10))})),O=(0,o.ZP)((function(e){if("Delete"===e.key)Z.length>0&&Z.filter((function(e){return L.current.hasNode(e)||L.current.hasEdge(e)})).forEach((function(e){n((0,l.x_)()),L.current.hasNode(e)?L.current.dropNode(e):L.current.dropEdge(e),d()}));else if(e.key.startsWith("Arrow")){var t=e.key.endsWith("Left")?-1:e.key.endsWith("Right")?1:0,r=e.key.endsWith("Up")?-1:e.key.endsWith("Down")?1:0;n((0,c.FL)({x:P.x+100*w/100*t,y:P.y+100*w/100*r}))}else"f"===e.key&&g&&n((0,l.PM)(g))})),U=function(){var e=(0,u.useState)({width:void 0,height:void 0}),t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,u.useEffect)((function(){function e(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),z=(null!==(e=U.height)&&void 0!==e?e:1280)-40,T=(null!==(t=U.width)&&void 0!==t?t:720)-50;return(0,v.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:50},height:z,width:T,viewBox:"".concat(P.x," ").concat(P.y," ").concat(T*w/100," ").concat(z*w/100),onPointerDown:j,onPointerMove:C,onPointerUp:K,onWheel:D,tabIndex:0,onKeyDown:O,children:(0,v.jsx)(N,{})})}},3300:function(e,t,n){n.d(t,{Z9:function(){return i},fx:function(){return u},yK:function(){return r}});var r=function(e){var t=e.currentTarget.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},i=function(e,t){return Math.round(e/t)*t},u=function(e){var t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],n=t[0],r=t[1],i=t[2],u=t[3];return e.forEachNode((function(e,t){n=Math.min(t.x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),u=Math.max(t.y,u)})),{xMin:n-=150,yMin:r-=150,xMax:i+=150,yMax:u+=150}}},8617:function(e,t,n){var r=n(2791),i="undefined"!==typeof window?null!==r.useInsertionEffect&&void 0!==r.useInsertionEffect?r.useInsertionEffect:r.useLayoutEffect:function(){};function u(e){var t=(0,r.useRef)(o);i((function(){t.current=e}),[e]);var n=(0,r.useRef)(null);return n.current||(n.current=function(){return t.current.apply(this,arguments)}),n.current}function o(){throw new Error("INVALID_USEEVENT_INVOCATION: the callback from useEvent cannot be invoked before the component has mounted.")}t.ZP=u},2893:function(e,t,n){n.d(t,{U:function(){return s}});var r=n(1413),i=n(5232),u=n(7872),o=n(184),s=(0,u.G)((function(e,t){return(0,o.jsx)(i.K,(0,r.Z)((0,r.Z)({align:"center"},e),{},{direction:"row",ref:t}))}));s.displayName="HStack"}}]);
//# sourceMappingURL=SvgWrapper.793ff7b0.chunk.js.map