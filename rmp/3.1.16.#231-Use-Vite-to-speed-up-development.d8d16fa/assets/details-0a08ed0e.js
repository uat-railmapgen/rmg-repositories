import{j as e,A as J,M as V,o as q,p as Z,r as K,t as Q,h as E,B as w,ai as k,ah as te}from"./chakra-b44533e6.js";import{b as l}from"./react-14e694c6.js";import{d as O,e as R,s as T,h as N,v as L,ac as _,ad as B,f as v,l as U,a8 as P,L as ne,c as se,A as z,j as W,aa as F,q as ae,ae as re,af as ie,ag as oe,ah as le,n as H}from"./index-febab319.js";import{s as X}from"./stations-03c6a73f.js";import{m as ce}from"./misc-nodes-2d937040.js";import{a as de,b as ue,d as pe}from"./change-types-c714009f.js";import{u as $}from"./useEvent-801a7c9c.js";function he(){const{t:r}=O(),n=R(),t=l.useCallback(()=>{n(T()),n(N(i.current.export()))},[n,T,N]),{selected:u}=L(a=>a.runtime),s=u.at(0),i=l.useRef(window.graph),[p,f]=l.useState(!1),g=l.useRef(null),[x,h]=l.useState(void 0),b=i.current.getNodeAttribute(s,"type"),m=Object.fromEntries(Object.entries(X).map(([a,y])=>[a,r(y.metadata.displayName).toString()])),d=()=>{x&&(de(i.current,s,x),t())},c=a=>{a&&d(),h(void 0),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{label:r("panel.details.info.stationType"),minW:"276",children:e.jsx(B,{options:m,disabledOptions:[b],value:b,onChange:({target:{value:a}})=>{h(a),f(!0)}})}),e.jsx(J,{isOpen:p,leastDestructiveRef:g,onClose:()=>c(!1),children:e.jsx(V,{children:e.jsxs(q,{children:[e.jsx(Z,{children:r("warning")}),e.jsx(K,{children:r("panel.details.changeStationTypeContent")}),e.jsxs(Q,{children:[e.jsx(E,{ref:g,onClick:()=>c(!1),children:r("cancel")}),e.jsx(E,{ml:"2",colorScheme:"red",onClick:()=>c(!0),children:r("panel.details.changeType")})]})]})})})]})}function ge(){const{t:r}=O(),n=R(),t=l.useCallback(()=>{n(v()),n(N(p.current.export()))},[n,v,N]),{selected:u,theme:s}=L(S=>S.runtime),i=u.at(0),p=l.useRef(window.graph),[f,g]=l.useState(!1),x=l.useRef(null),h=Object.fromEntries(Object.entries(U).map(([S,M])=>[S,r(M.metadata.displayName).toString()])),[b,m]=l.useState(p.current.getEdgeAttribute(i,"type")),[d,c]=l.useState(void 0),a=Object.fromEntries(Object.entries(P).map(([S,M])=>[S,r(M.metadata.displayName).toString()])),[y,o]=l.useState(p.current.getEdgeAttribute(i,"style")),[j,C]=l.useState(void 0),A=Object.values(ne).filter(S=>!P[y].metadata.supportLinePathType.includes(S)),I=Object.values(se).filter(S=>!P[S].metadata.supportLinePathType.includes(b)),Y=()=>{d&&(ue(p.current,i,d),m(p.current.getEdgeAttribute(i,"type")),t())},ee=()=>{j&&(pe(p.current,i,j,s),o(p.current.getEdgeAttribute(i,"style")),t())},D=S=>{S&&(d?(Y(),c(void 0)):j&&(ee(),C(void 0))),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{label:r("panel.details.info.linePathType"),minW:"276",children:e.jsx(B,{options:h,disabledOptions:A,defaultValue:b,value:b,onChange:({target:{value:S}})=>{c(S),g(!0)}})}),e.jsx(_,{label:r("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(B,{options:a,disabledOptions:I,defaultValue:y,value:y,onChange:({target:{value:S}})=>{C(S),g(!0)}})}),e.jsx(J,{isOpen:f,leastDestructiveRef:x,onClose:()=>D(!1),children:e.jsx(V,{children:e.jsxs(q,{children:[e.jsx(Z,{children:r("warning")}),e.jsx(K,{children:r("panel.details.changeLineTypeContent")}),e.jsxs(Q,{children:[e.jsx(E,{ref:x,onClick:()=>D(!1),children:r("cancel")}),e.jsx(E,{ml:"2",colorScheme:"red",onClick:()=>D(!0),children:r("panel.details.changeType")})]})]})})})]})}function me(){const{t:r}=O(),n=R(),t=l.useCallback(()=>{n(T()),n(v()),n(N(i.current.export()))},[n,v,N]),{selected:u}=L(g=>g.runtime),s=u.at(0),i=l.useRef(window.graph),p=g=>{const x=Math.min(Math.max(g,-5),5);i.current.hasNode(s)&&i.current.setNodeAttribute(s,"zIndex",x),i.current.hasEdge(s)&&i.current.setEdgeAttribute(s,"zIndex",x),t()},f=[{type:"input",label:r("panel.details.info.id"),value:u.length>0?u.join(", "):"undefined",minW:276},{type:"select",label:r("panel.details.info.zIndex"),value:s?i.current.hasNode(s)?i.current.getNodeAttribute(s,"zIndex"):i.current.hasEdge(s)?i.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(g,x)=>[x-5,(x-5).toString()])),onChange:g=>p(Number(g))}];return u.length===0||u.length>1&&f.push({type:"input",label:r("panel.details.info.type"),value:"multiple selection",minW:276}),e.jsxs(w,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:r("panel.details.info.title")}),e.jsx(z,{fields:f,minW:130}),u.length===1&&s.startsWith("stn")&&i.current.hasNode(s)&&e.jsx(he,{}),u.length===1&&s.startsWith("line")&&i.current.hasEdge(s)&&e.jsx(ge,{})]})}function ye(){const{t:r}=O(),n=R(),t=l.useCallback(()=>{n(T()),n(v()),n(N(p.current.export()))},[n,T,v,N]),{selected:u,refresh:{nodes:s}}=L(h=>h.runtime),i=u.at(0),p=l.useRef(window.graph),[f,g]=l.useState({x:0,y:0});l.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const h=p.current.getNodeAttribute(i,"x"),b=p.current.getNodeAttribute(i,"y");g({x:h,y:b})}},[s,u]);const x=[{type:"input",label:r("panel.details.nodePosition.pos.x"),value:f.x.toString(),validator:h=>!Number.isNaN(h),onChange:h=>{p.current.mergeNodeAttributes(i,{x:Number(h)}),t()}},{type:"input",label:r("panel.details.nodePosition.pos.y"),value:f.y.toString(),validator:h=>!Number.isNaN(h),onChange:h=>{p.current.mergeNodeAttributes(i,{y:Number(h)}),t()}}];return e.jsxs(w,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:r("panel.details.nodePosition.title")}),e.jsx(z,{fields:x,minW:130})]})}function xe(){const{t:r}=O(),n=R(),{selected:t}=L(y=>y.runtime),u=t.at(0),s=l.useRef(window.graph),[i,p]=l.useState("undefined"),[f,g]=l.useState("undefined"),[x,h]=l.useState("undefined"),[b,m]=l.useState("undefined");l.useEffect(()=>{var y,o;if(u!=null&&u.startsWith("line")){const[j,C]=s.current.extremities(u);if(p(j),g(C),j.startsWith("stn")){const A=s.current.getNodeAttribute(j,"type");h(((y=s.current.getNodeAttribute(j,A))==null?void 0:y.names.at(0))??"undefined")}if(C.startsWith("stn")){const A=s.current.getNodeAttribute(C,"type");m(((o=s.current.getNodeAttribute(C,A))==null?void 0:o.names.at(0))??"undefined")}}},[t]);const d=$(()=>{n(W()),n(F(i))}),c=$(()=>{n(W()),n(F(f))}),a=[{type:"custom",label:r("panel.details.lineExtremities.source"),component:e.jsx(E,{flex:1,size:"sm",variant:"link",onClick:d,children:i})},{type:"custom",label:r("panel.details.lineExtremities.target"),component:e.jsx(E,{flex:1,size:"sm",variant:"link",onClick:c,children:f})},{type:"input",label:r("panel.details.lineExtremities.sourceName"),value:x},{type:"input",label:r("panel.details.lineExtremities.targetName"),value:b}];return e.jsxs(w,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:r("panel.details.lineExtremities.title")}),e.jsx(z,{fields:a,minW:130})]})}const G={...X,...ce},Te=()=>{const{t:r}=O(),n=R(),t=l.useRef(window.graph),u=l.useCallback(()=>{n(T()),n(v()),n(N(t.current.export()))},[n,T,v,N]),{selected:s,mode:i}=L(d=>d.runtime),p=()=>n(W()),f=d=>{const c=JSON.parse(JSON.stringify(t.current.getNodeAttributes(d)));c.x+=50,c.y+=50;const a=d.startsWith("stn")?`stn_${H(10)}`:`misc_node_${H(10)}`;t.current.addNode(a,c),n(T()),n(N(t.current.export()))},g=d=>{n(W()),d.forEach(c=>{t.current.hasNode(c)?(t.current.dropNode(c),u()):t.current.hasEdge(c)&&(t.current.dropEdge(c),n(v()),n(N(t.current.export())))})},[x,h]=l.useState("");l.useEffect(()=>{const d=s.at(0);t.current.hasEdge(d)&&h(t.current.getEdgeAttribute(d,"reconcileId")??"undefined")},[s]);const b=[],m=s.at(0);if(s.length===1&&t.current.hasNode(m)){const d=t.current.getNodeAttribute(m,"type"),c=t.current.getNodeAttribute(m,d);b.push(...G[d].fields.filter(a=>a.type!=="custom").map(a=>{var y,o,j;return{type:a.type,label:r(a.label),value:(y=a.value)==null?void 0:y.call(a,c),isChecked:(o=a.isChecked)==null?void 0:o.call(a,c),hidden:(j=a.hidden)==null?void 0:j.call(a,c),options:a.options,disabledOptions:a.disabledOptions&&a.disabledOptions(c),validator:a.validator,oneLine:a.oneLine,onChange:C=>{let A;try{A=a.onChange(C,c)}catch(I){n(ae({status:"error",message:r(`err-code.${I}`)}));return}t.current.mergeNodeAttributes(m,{[d]:A}),n(T()),n(N(t.current.export()))}}}),...G[d].fields.filter(a=>a.type==="custom"))}if(s.length===1&&t.current.hasEdge(m)){const d=t.current.getEdgeAttribute(m,"type"),c=t.current.getEdgeAttribute(m,d);b.push(...U[d].fields.map(o=>({type:o.type,label:r(o.label),value:o.value(c),options:o.options,disabledOptions:o.disabledOptions&&o.disabledOptions(c),validator:o.validator,onChange:j=>{t.current.mergeEdgeAttributes(m,{[d]:o.onChange(j,c)}),n(v()),n(N(t.current.export()))}})));const a=t.current.getEdgeAttribute(m,"style"),y=t.current.getEdgeAttribute(m,a);b.push(...P[a].fields.filter(o=>o.type!=="custom").map(o=>({type:o.type,label:r(o.label),value:o.value(y),options:o.options,disabledOptions:o.disabledOptions&&o.disabledOptions(y),validator:o.validator,onChange:j=>{t.current.mergeEdgeAttributes(m,{[a]:o.onChange(j,y)}),n(v()),n(N(t.current.export()))}}))),b.push(...P[a].fields.filter(o=>o.type==="custom"))}return e.jsxs(re,{isOpen:s.length>0&&!i.startsWith("line")&&!i.startsWith("misc-edge"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ie,{onClose:p,children:r("panel.details.header")}),e.jsxs(oe,{children:[e.jsx(me,{}),s.length===1&&t.current.hasNode(m)&&e.jsx(ye,{}),s.length===1&&t.current.hasEdge(m)&&e.jsx(xe,{}),s.length===1&&e.jsxs(w,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:r("panel.details.specificAttrsTitle")}),e.jsx(z,{fields:b,minW:276})]})]}),e.jsx(le,{children:e.jsxs(te,{children:[s.length===1&&t.current.hasNode(s.at(0))&&e.jsx(E,{size:"sm",variant:"outline",onClick:()=>f(s.at(0)),children:r("panel.details.footer.duplicate")}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>g(s),children:r("panel.details.footer.remove")})]})})]})};export{Te as default};
