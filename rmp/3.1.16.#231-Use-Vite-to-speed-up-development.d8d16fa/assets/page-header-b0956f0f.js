import{a9 as vt,j as e,aa as wt,Q as ct,ab as Ge,ac as _e,G as te,ad as Ue,ae as re,k as We,a0 as $,M as K,a1 as J,p as Y,q,r as Z,af as St,g as de,w as k,a8 as T,v as dt,ag as Ye,s as b,t as ke,ah as Ct,h as G,F as qe,$ as Ze,B as F,ai as pe,a2 as Se,aj as ye,ak as be,al as ve,c as Ot,i as kt,e as zt,f as At,am as ht,an as Et,O as He,ao as Tt,ap as Mt,aq as N,ar as Qe,as as Ht,at as w,au as E,av as Pt,aw as ee,x as Rt,y as It}from"./chakra-b44533e6.js";import{g as Nt,r as B,_ as pt,e as Ce,b as y}from"./react-14e694c6.js";import{w as Bt,g as Lt,a as Pe,b as ut,I as Dt,u as Ft,r as D,n as Xe,S as L,L as Re,l as Gt,c as Te,R as mt,d as U,e as W,s as ae,f as oe,h as se,i as xt,j as De,M as et,k as _t,m as tt,o as gt,p as Ut,q as Ie,t as M,v as Q,x as Wt,y as Vt,z as $t,A as ue,E as Fe,B as Kt,C as Jt,D as Yt,F as st,G as qt,T as Zt,H as Qt,J as Xt,K as es,N as ts,O as ss,P as ns,Q as ze,U as rs,V as Ne,W as as,X as os,Y as is,Z as ls,_ as cs,$ as ds,a0 as hs,a1 as ps,a2 as us,a3 as ms}from"./index-febab319.js";import{s as Ee}from"./stations-03c6a73f.js";import{c as xs,i as we}from"./helpers-2fcbe9c8.js";import{c as gs}from"./change-types-c714009f.js";function Ve(t,a){if(t==null)return{};var n=vt(t,a),s,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)s=r[o],!(a.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}var fs={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const js=Nt(fs);var ys=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function nt(t){var a={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(a.name=n[1],(js[n[1]]||t.charAt(t.length-2)==="/")&&(a.voidElement=!0),a.name.startsWith("!--"))){var s=t.indexOf("-->");return{type:"comment",comment:s!==-1?t.slice(4,s):""}}for(var o=new RegExp(ys),r=null;(r=o.exec(t))!==null;)if(r[0].trim())if(r[1]){var c=r[1].trim(),h=[c,""];c.indexOf("=")>-1&&(h=c.split("=")),a.attrs[h[0]]=h[1],o.lastIndex--}else r[2]&&(a.attrs[r[2]]=r[3].trim().substring(1,r[3].length-1));return a}var bs=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,vs=/^\s*$/,ws=Object.create(null);function ft(t,a){switch(a.type){case"text":return t+a.content;case"tag":return t+="<"+a.name+(a.attrs?function(n){var s=[];for(var o in n)s.push(o+'="'+n[o]+'"');return s.length?" "+s.join(" "):""}(a.attrs):"")+(a.voidElement?"/>":">"),a.voidElement?t:t+a.children.reduce(ft,"")+"</"+a.name+">";case"comment":return t+"<!--"+a.comment+"-->"}}var Ss={parse:function(t,a){a||(a={}),a.components||(a.components=ws);var n,s=[],o=[],r=-1,c=!1;if(t.indexOf("<")!==0){var h=t.indexOf("<");s.push({type:"text",content:h===-1?t:t.substring(0,h)})}return t.replace(bs,function(l,p){if(c){if(l!=="</"+n.name+">")return;c=!1}var i,m=l.charAt(1)!=="/",d=l.startsWith("<!--"),u=p+l.length,f=t.charAt(u);if(d){var A=nt(l);return r<0?(s.push(A),s):((i=o[r]).children.push(A),s)}if(m&&(r++,(n=nt(l)).type==="tag"&&a.components[n.name]&&(n.type="component",c=!0),n.voidElement||c||!f||f==="<"||n.children.push({type:"text",content:t.slice(u,t.indexOf("<",u))}),r===0&&s.push(n),(i=o[r-1])&&i.children.push(n),o[r]=n),(!m||n.voidElement)&&(r>-1&&(n.voidElement||n.name===l.slice(2,-1))&&(r--,n=r===-1?s:o[r]),!c&&f!=="<"&&f)){i=r===-1?s:o[r].children;var j=t.indexOf("<",u),S=t.slice(u,j===-1?void 0:j);vs.test(S)&&(S=" "),(j>-1&&r+i.length>=0||S!==" ")&&i.push({type:"text",content:S})}}),s},stringify:function(t){return t.reduce(function(a,n){return a+ft("",n)},"")}},Cs=["format"],Os=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function rt(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,s)}return n}function H(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?rt(Object(n),!0).forEach(function(s){pt(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Be(t,a){if(!t)return!1;var n=t.props?t.props.children:t.children;return a?n.length>0:!!n}function Le(t){return t?t.props?t.props.children:t.children:[]}function ks(t){return Object.prototype.toString.call(t)!=="[object Array]"?!1:t.every(function(a){return B.isValidElement(a)})}function Oe(t){return Array.isArray(t)?t:[t]}function zs(t,a){var n=H({},a);return n.props=Object.assign(t.props,a.props),n}function jt(t,a){if(!t)return"";var n="",s=Oe(t),o=a.transSupportBasicHtmlNodes&&a.transKeepBasicHtmlNodesFor?a.transKeepBasicHtmlNodesFor:[];return s.forEach(function(r,c){if(typeof r=="string")n+="".concat(r);else if(B.isValidElement(r)){var h=Object.keys(r.props).length,l=o.indexOf(r.type)>-1,p=r.props.children;if(!p&&l&&h===0)n+="<".concat(r.type,"/>");else if(!p&&(!l||h!==0))n+="<".concat(c,"></").concat(c,">");else if(r.props.i18nIsDynamicList)n+="<".concat(c,"></").concat(c,">");else if(l&&h===1&&typeof p=="string")n+="<".concat(r.type,">").concat(p,"</").concat(r.type,">");else{var i=jt(p,a);n+="<".concat(c,">").concat(i,"</").concat(c,">")}}else if(r===null)Pe("Trans: the passed in value is invalid - seems you passed in a null child.");else if(Ce(r)==="object"){var m=r.format,d=Ve(r,Cs),u=Object.keys(d);if(u.length===1){var f=m?"".concat(u[0],", ").concat(m):u[0];n+="{{".concat(f,"}}")}else Pe("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",r)}else Pe("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",r)}),n}function As(t,a,n,s,o,r){if(a==="")return[];var c=s.transKeepBasicHtmlNodesFor||[],h=a&&new RegExp(c.join("|")).test(a);if(!t&&!h)return[a];var l={};function p(j){var S=Oe(j);S.forEach(function(x){typeof x!="string"&&(Be(x)?p(Le(x)):Ce(x)==="object"&&!B.isValidElement(x)&&Object.assign(l,x))})}p(t);var i=Ss.parse("<0>".concat(a,"</0>")),m=H(H({},l),o);function d(j,S,x){var C=Le(j),R=f(C,S.children,x);return ks(C)&&R.length===0?C:R}function u(j,S,x,C,R){j.dummy&&(j.children=S),x.push(B.cloneElement(j,H(H({},j.props),{},{key:C}),R?void 0:S))}function f(j,S,x){var C=Oe(j),R=Oe(S);return R.reduce(function(z,g,_){var X=g.children&&g.children[0]&&g.children[0].content&&n.services.interpolator.interpolate(g.children[0].content,m,n.language);if(g.type==="tag"){var v=C[parseInt(g.name,10)];!v&&x.length===1&&x[0][g.name]&&(v=x[0][g.name]),v||(v={});var O=Object.keys(g.attrs).length!==0?zs({props:g.attrs},v):v,V=B.isValidElement(O),ie=V&&Be(g,!0)&&!g.voidElement,me=h&&Ce(O)==="object"&&O.dummy&&!V,xe=Ce(t)==="object"&&t!==null&&Object.hasOwnProperty.call(t,g.name);if(typeof O=="string"){var I=n.services.interpolator.interpolate(O,m,n.language);z.push(I)}else if(Be(O)||ie){var Me=d(O,g,x);u(O,Me,z,_)}else if(me){var le=f(C,g.children,x);z.push(B.cloneElement(O,H(H({},O.props),{},{key:_}),le))}else if(Number.isNaN(parseFloat(g.name)))if(xe){var ge=d(O,g,x);u(O,ge,z,_,g.voidElement)}else if(s.transSupportBasicHtmlNodes&&c.indexOf(g.name)>-1)if(g.voidElement)z.push(B.createElement(g.name,{key:"".concat(g.name,"-").concat(_)}));else{var fe=f(C,g.children,x);z.push(B.createElement(g.name,{key:"".concat(g.name,"-").concat(_)},fe))}else if(g.voidElement)z.push("<".concat(g.name," />"));else{var je=f(C,g.children,x);z.push("<".concat(g.name,">").concat(je,"</").concat(g.name,">"))}else if(Ce(O)==="object"&&!V){var ce=g.children[0]?X:null;ce&&z.push(ce)}else g.children.length===1&&X?z.push(B.cloneElement(O,H(H({},O.props),{},{key:_}),X)):z.push(B.cloneElement(O,H(H({},O.props),{},{key:_})))}else if(g.type==="text"){var P=s.transWrapTextNodes,ne=r?s.unescape(n.services.interpolator.interpolate(g.content,m,n.language)):n.services.interpolator.interpolate(g.content,m,n.language);P?z.push(B.createElement(P,{key:"".concat(g.name,"-").concat(_)},ne)):z.push(ne)}return z},[])}var A=f([{dummy:!0,children:t||[]}],i,Oe(t||[]));return Le(A[0])}function Es(t){var a=t.children,n=t.count,s=t.parent,o=t.i18nKey,r=t.context,c=t.tOptions,h=c===void 0?{}:c,l=t.values,p=t.defaults,i=t.components,m=t.ns,d=t.i18n,u=t.t,f=t.shouldUnescape,A=Ve(t,Os),j=d||ut();if(!j)return Bt("You will need to pass in an i18next instance by using i18nextReactModule"),a;var S=u||j.t.bind(j)||function(ie){return ie};r&&(h.context=r);var x=H(H({},Lt()),j.options&&j.options.react),C=m||S.ns||j.options&&j.options.defaultNS;C=typeof C=="string"?[C]:C||["translation"];var R=p||jt(a,x)||x.transEmptyNodeValue||o,z=x.hashTransKey,g=o||(z?z(R):R),_=l?h.interpolation:{interpolation:H(H({},h.interpolation),{},{prefix:"#$?",suffix:"?$#"})},X=H(H(H(H({},h),{},{count:n},l),_),{},{defaultValue:R,ns:C}),v=g?S(g,X):R,O=As(i||a,v,j,x,X,f),V=s!==void 0?s:x.defaultTransParent;return V?B.createElement(V,A,O):O}var Ts=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function at(t,a){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,s)}return n}function Ms(t){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?at(Object(n),!0).forEach(function(s){pt(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function ot(t){var a=t.children,n=t.count,s=t.parent,o=t.i18nKey,r=t.context,c=t.tOptions,h=c===void 0?{}:c,l=t.values,p=t.defaults,i=t.components,m=t.ns,d=t.i18n,u=t.t,f=t.shouldUnescape,A=Ve(t,Ts),j=B.useContext(Dt)||{},S=j.i18n,x=j.defaultNS,C=d||S||ut(),R=u||C&&C.t.bind(C);return Es(Ms({children:a,count:n,parent:s,i18nKey:o,context:r,tOptions:h,values:l,defaults:p,components:i,ns:m||R&&R.ns||x||C&&C.options&&C.options.defaultNS,i18n:C,t:u,shouldUnescape:f},A))}var it=function(t){return Ft(D.ready(),t)},Hs={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},ko:{en:"Korean",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Ps=(t,{info_panel_type:a,line_num:n,stn_list:s,style:o,theme:r})=>{const c=Object.fromEntries(Object.keys(s).filter(h=>!["linestart","lineend"].includes(h)).map(h=>[h,`stn_${Xe(10)}`]));Object.entries(s).filter(([h,l])=>!["linestart","lineend"].includes(h)).forEach(([h,l])=>{const p=t.filterNodes((i,m)=>Object.values(L).includes(m.type)&&m[m.type].names[0]===l.name[0]);p.length!==0&&(c[h]=p[0])}),Object.entries(s).filter(([h,l])=>!["linestart","lineend"].includes(h)).filter(([h,l])=>t.filterNodes((p,i)=>Object.values(L).includes(i.type)&&i[i.type].names[0]===l.name[0]).length===0).forEach(([h,l],p)=>{let i=L.ShmetroBasic;const m=l.transfer.groups,d=m.map(f=>f.lines).flat();o==="shmetro"?d.length>0?i=L.ShmetroInt:a==="sh2020"?i=L.ShmetroBasic2020:i=L.ShmetroBasic:o==="gzmtr"?d.length>0?i=L.GzmtrInt:i=L.GzmtrBasic:o==="mtr"&&(i=L.MTR);const u={...JSON.parse(JSON.stringify(Ee[i].defaultAttrs)),names:l.name};i===L.ShmetroBasic2020?u.color=r:i===L.GzmtrBasic?(u.color=r,u.lineCode=n,u.stationCode=l.num):i===L.GzmtrInt?u.transfer=m.map((f,A)=>{const j=f.lines.map(S=>[...S.theme??r,"1","01"]);return A===0?[[...r,n,l.num],...j]:j}):i===L.MTR&&(m[0].lines.length?u.transfer=[[[...r,"",""],...m[0].lines.map(f=>[...f.theme??r,"",""])]]:u.transfer=[[]]),t.addNode(c[h],{visible:!0,zIndex:0,x:100+p*50,y:1e3,type:i,[i]:u})}),Object.entries(s).filter(([h,l])=>!["linestart","lineend"].includes(h)).forEach(([h,l])=>{l.children.filter(p=>!["linestart","lineend"].includes(p)).forEach(p=>{t.addDirectedEdgeWithKey(`line_${Xe(10)}`,c[h],c[p],{visible:!0,zIndex:0,type:Re.Diagonal,[Re.Diagonal]:JSON.parse(JSON.stringify(Gt[Re.Diagonal].defaultAttrs)),style:Te.SingleColor,[Te.SingleColor]:{color:r},reconcileId:""})})})},Rs="rmg-bridge--",Is={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Ns(t){const{isOpen:a,onClose:n,onImport:s}=t,[o]=B.useState(crypto.randomUUID()),r="/rmg/import?"+new URLSearchParams({parentComponent:D.getAppName(),parentId:o});return B.useEffect(()=>{const c=new BroadcastChannel(Rs+o);return c.onmessage=h=>{const{event:l,data:p}=h.data;console.log("[rmp] Received event from RMG app clip:",l),l==="CLOSE"?n():l==="IMPORT"&&s(p)},()=>{c.close()}},[]),e.jsx(mt,{isOpen:a,onClose:n,sx:Is,children:e.jsx("iframe",{src:r,loading:"lazy"})})}const Bs="RMP_GALLERY_CHANNEL",Ls="OPEN_TEMPLATE",Ds=new BroadcastChannel(Bs),Fs={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"}};function Gs(t){const{isOpen:a,onClose:n}=t,s=wt(),{t:o}=U(),r=W(),c=y.useRef(window.graph),h=y.useCallback(()=>{r(ae()),r(oe()),r(se(c.current.export()))},[r,ae,oe,se,c]),l=async i=>{const{version:m,...d}=JSON.parse(await xt(JSON.stringify(i)));r(De()),c.current.clear(),c.current.import(d.graph),h()},p=async i=>{var d;const m=await((d=(await Promise.allSettled([fetch(`/rmp-gallery/resources/real_world/${i}.json`),fetch(`/rmp-gallery/resources/fantasy/${i}.json`)])).filter(u=>u.status==="fulfilled").find(u=>u.value.status===200))==null?void 0:d.value.json());m?(l(m),s({title:o("header.open.importFromRMPGallery",{id:i}),status:"success",duration:9e3,isClosable:!0})):s({title:o("header.open.failToImportFromRMPGallery",{id:i}),status:"error",duration:9e3,isClosable:!0})};return y.useEffect(()=>{const i=window.location.href;if(i.includes("/s/")){history.replaceState({},o("about.rmp"),i.substring(0,i.indexOf("s/")));const m=i.substring(i.lastIndexOf("s/")+2);p(m)}},[]),y.useEffect(()=>{Ds.onmessage=i=>{const{event:m,data:d}=i.data;m===Ls&&(p(d),n())}},[]),e.jsx(e.Fragment,{children:e.jsxs(mt,{isOpen:a,onClose:n,size:"full",sx:Fs,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(ct,{onClick:n,position:"fixed",top:"5px",right:"15px"})]})})}function _s(){const{t}=U(),a=W(),n=y.useRef(window.graph),s=y.useRef(null),[o,r]=y.useState(!1),[c,h]=y.useState(!1),l=y.useCallback(()=>{a(ae()),a(oe()),a(se(n.current.export()))},[a,ae,oe,se,n]),p=()=>{a(De()),n.current.clear(),a(gt(100)),a(Ut({x:0,y:0})),l()},i=d=>{try{Ps(n.current,d),l()}catch(u){a(Ie({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",u)}finally{r(!1)}},m=async d=>{var f;const u=(f=d.target.files)==null?void 0:f[0];if(console.log("OpenActions.handleUpload():: received file",u),(u==null?void 0:u.type)!=="application/json")a(Ie({status:"error",message:t("OpenActions.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const A=await Us(u),{version:j,...S}=JSON.parse(await xt(A));a(De()),n.current.clear(),n.current.import(S.graph),l()}catch(A){a(Ie({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",A)}d.target.value=""};return e.jsxs(Ge,{children:[e.jsx(_e,{as:te,size:"sm",variant:"ghost",icon:e.jsx(et,{})}),e.jsxs(Ue,{children:[e.jsx(re,{icon:e.jsx(_t,{}),onClick:p,children:t("header.open.new")}),e.jsx("input",{id:"upload_project",ref:s,type:"file",accept:".json",hidden:!0,onChange:m,"data-testid":"file-upload"}),e.jsx(re,{icon:e.jsx(et,{}),onClick:()=>{var d;return(d=s==null?void 0:s.current)==null?void 0:d.click()},children:t("header.open.config")}),e.jsx(re,{icon:e.jsx(tt,{}),onClick:()=>r(!0),children:t("header.open.projectRMG")}),e.jsxs(re,{icon:e.jsx(tt,{}),onClick:()=>h(!0),children:[t("header.open.gallery"),e.jsx(We,{ml:"1",colorScheme:"green",children:"New"})]})]}),e.jsx(Ns,{isOpen:o,onClose:()=>r(!1),onImport:i}),e.jsx(Gs,{isOpen:c,onClose:()=>h(!1)})]})}const Us=t=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsText(t)}),Ws=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),Vs=t=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsDataURL(t)}),$s=(t,a)=>t.find(n=>{const s=n.style;return s.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===a.family&&s.getPropertyValue("unicode-range")===a.unicodeRange}),Ks=async t=>{var c,h;const a=Array.from(new Set([...t.querySelectorAll(".rmp-name__mtr__zh"),...t.querySelectorAll(".rmp-name__mtr__en")].map(l=>l.innerHTML).join("").replace(/\s/g,""))).join(""),n=await document.fonts.load("80px GenYoMin TW, Vegur",a),s=(h=(c=document.querySelector("link#fonts_mtr"))==null?void 0:c.sheet)==null?void 0:h.cssRules;if(!s)return Promise.reject(new Error("cssRules can not be found in link#css_share"));const o=Array.from(s).filter(l=>l instanceof CSSFontFaceRule),r=n.reduce((l,p)=>{const i=$s(o,p);return i?l.find(d=>{const u=d.style,f=i.style;return u.getPropertyValue("font-family")===f.getPropertyValue("font-family")&&u.getPropertyValue("unicode-range")===f.getPropertyValue("unicode-range")})?l:l.concat(i):l},[]);return await Promise.all(r.map(async l=>{try{const p=await fetch(Js(l)),i=await Vs(await p.blob());return l.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${i}'); `)}catch(p){return console.error(p),""}}))},Js=t=>{var n;const a=t.style.src;return Ws()?a.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmp//styles/"+((n=a.match(/^url\("([\S*]+)"\)/))==null?void 0:n[1])},Ys=t=>{const{isOpen:a,onClose:n}=t,{t:s}=U();return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:s("header.download.termsAndConditions")}),e.jsx(q,{}),e.jsx(Z,{children:e.jsxs(St,{children:[e.jsxs(de,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(k,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(T,{as:M})]}),", ",e.jsxs(k,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(T,{as:M})]})," or ",e.jsxs(k,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(T,{as:M})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(k,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(T,{as:M})]}),"，",e.jsxs(k,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(T,{as:M})]}),"或",e.jsxs(k,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(T,{as:M})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(de,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(T,{as:M})]})," and ",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(T,{as:M})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(T,{as:M})]}),"及",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(T,{as:M})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(de,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(k,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(T,{as:M})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(k,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(T,{as:M})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(de,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(de,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(k,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(T,{as:M})]})," ","– the open-source emoji and icon project. License:",e.jsxs(k,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(T,{as:M})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(k,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(T,{as:M})]}),"所设计。许可证：",e.jsxs(k,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(T,{as:M})]})]}),e.jsxs(de,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},qs=Ys;function Zs(){const{t}=U(),{telemetry:{project:a}}=Q(v=>v.app),{nodeExists:n}=Q(v=>v.runtime),s=y.useRef(window.graph),o=dt("white","gray.800"),[r,c]=y.useState("png"),h={png:t("header.download.png"),svg:t("header.download.svg")},[l,p]=y.useState(100),i=Object.fromEntries([25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].map(v=>[v,`${v}%`])),[m,d]=y.useState(!1),u=[{type:"select",label:t("header.download.format"),value:r,options:h,onChange:v=>c(v==="png"?"png":"svg")}],f=[{type:"select",label:t("header.download.scale"),value:l,options:i,onChange:v=>p(v)},{type:"switch",label:t("header.download.transparent"),isChecked:m,onChange:d}],[A,j]=y.useState(!1),[S,x]=y.useState(!1),[C,R]=y.useState(!1),[z,g]=y.useState(!1),_=()=>{a&&D.event(Fe.DOWNLOAD_PARAM,{"#nodes":s.current.order,"#edges":s.current.size});const v=Kt(Jt.getState().param);lt(`RMP_${new Date().valueOf()}.json`,"application/json",v)},X=async()=>{j(!1),a&&D.event(Fe.DOWNLOAD_IMAGES,{numberOfNodes:s.current.order,numberOfEdges:s.current.size});const{xMin:v,yMin:O,xMax:V,yMax:ie}=xs(s.current),[me,xe]=[V-v,ie-O],I=document.getElementById("canvas").cloneNode(!0);if([...I.children].filter(P=>s.current.hasNode(P.id)&&s.current.getNodeAttribute(P.id,"type")===Yt.Virtual).forEach(P=>I.removeChild(P)),C||I.appendChild(Qs(V-400,ie-60)),I.setAttribute("viewBox",`${v} ${O} ${me} ${xe}`),I.setAttribute("width",me.toString()),I.setAttribute("height",xe.toString()),Object.entries({".rmp-name__zh":["font-family"],".rmp-name__en":["font-family"],".rmp-name__mtr__zh":["font-family"],".rmp-name__mtr__en":["font-family"],".rmp-name-station":["paint-order","stroke","stroke-width"]}).forEach(([P,ne])=>{const $e=document.querySelector(P);if($e===null)return;const bt=window.getComputedStyle($e);I.querySelectorAll(P).forEach(Ke=>{ne.forEach(Je=>{Ke.setAttribute(Je,bt.getPropertyValue(Je))}),Ke.classList.remove(P)})}),n[L.MTR])try{const P=await Ks(I),ne=document.createElement("style");ne.textContent=P.join(`
`),I.prepend(ne)}catch(P){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(P)}if(r==="svg"){lt(`RMP_${new Date().valueOf()}.svg`,"image/svg+xml",I.outerHTML);return}document.body.appendChild(I);const Me="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(I.outerHTML)));document.body.removeChild(I);const le=document.createElement("canvas"),[ge,fe]=[me*l/100,xe*l/100];le.width=ge,le.height=fe;const je=le.getContext("2d");m||(je.fillStyle=o,je.fillRect(0,0,ge,fe));const ce=new Image;ce.onload=()=>{je.drawImage(ce,0,0,ge,fe),le.toBlob(P=>yt(`RMP_${new Date().valueOf()}.png`,P),"image/png")},ce.src=Me};return e.jsxs(Ge,{id:"download",children:[e.jsx(_e,{as:te,size:"sm",variant:"ghost",icon:e.jsx(Wt,{})}),e.jsxs(Ue,{children:[e.jsx(re,{icon:e.jsx(Vt,{}),onClick:_,children:t("header.download.config")}),e.jsx(re,{icon:e.jsx($t,{}),onClick:()=>j(!0),children:t("header.download.image")})]}),e.jsxs($,{size:"xl",isOpen:A,onClose:()=>j(!1),children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:t("header.download.image")}),e.jsx(q,{}),e.jsxs(Z,{children:[e.jsx(ue,{fields:u}),r==="png"&&e.jsx(ue,{fields:f}),e.jsx("br",{}),e.jsx(Ye,{isChecked:C,onChange:v=>R(v.target.checked),children:e.jsxs(b,{children:[t("header.download.shareInfo1"),e.jsxs(k,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(T,{as:M})]}),t("header.download.shareInfo2")]})}),e.jsx(Ye,{isChecked:z,onChange:v=>g(v.target.checked),children:e.jsxs(b,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(k,{color:"teal.500",onClick:()=>x(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(T,{as:M})]}),t("header.download.period")]})})]}),e.jsx(ke,{children:e.jsx(Ct,{children:e.jsx(G,{colorScheme:"teal",variant:"outline",size:"sm",disabled:!z,onClick:X,children:t("header.download.confirm")})})}),e.jsx(qs,{isOpen:S,onClose:()=>x(!1)})]})]})]})}const lt=(t,a,n)=>{const s=new Blob([n],{type:a});yt(t,s)},yt=(t,a)=>{const n=window.URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)},Qs=(t,a)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("transform",`translate(${t}, ${a})scale(2)`);const s=document.createElementNS("http://www.w3.org/2000/svg","image");s.setAttribute("width","40"),s.setAttribute("height","40"),s.setAttribute("x","-50"),s.setAttribute("y","-20");const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("font-family","Arial, sans-serif"),o.setAttribute("font-size","16"),o.appendChild(document.createTextNode("Rail Map Painter"));const r=document.createElementNS("http://www.w3.org/2000/svg","text");return r.setAttribute("font-family","Arial, sans-serif"),r.setAttribute("font-size","10"),r.setAttribute("y","10"),r.appendChild(document.createTextNode("https://railmapgen.github.io/rmp/")),n.appendChild(s),n.appendChild(o),n.appendChild(r),n},Xs="/rmp/assets/github-mark-7a0dd11e.svg",en="/rmp/assets/slack-mark-19839006.svg",tn=t=>{const{isOpen:a,onClose:n}=t,{t:s}=U(),o=D.getAppVersion(),[r,c]=y.useState(!1);return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:s("header.about.title")}),e.jsx(q,{}),e.jsxs(Z,{paddingBottom:10,children:[e.jsxs(qe,{direction:"row",children:[e.jsx(Ze,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(qe,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(b,{fontSize:"xl",as:"b",children:s("header.about.rmp")}),e.jsx(b,{children:o}),e.jsx(b,{}),e.jsx(b,{fontSize:"sm",children:s("header.about.railmapgen")})]})]}),e.jsx(F,{margin:5,children:e.jsx(b,{fontSize:"xl",children:s("header.about.desc")})}),e.jsx(pe,{as:"h5",size:"sm",mt:3,mb:2,children:s("header.about.contributors")}),e.jsx(pe,{as:"h6",size:"xs",my:2,children:s("header.about.coreContributors")}),e.jsx(Se,{children:e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(b,{fontSize:"sm",children:s("header.about.content1")}),e.jsx(b,{fontSize:"sm",align:"right",mb:1,children:s("header.about.content2")})]})]})}),e.jsx(pe,{as:"h6",size:"xs",my:2,children:s("header.about.styleContributors")}),e.jsx(Se,{children:e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(b,{fontSize:"sm",mb:1,children:s("header.about.203IhzElttil")})]})]})}),e.jsx(pe,{as:"h5",size:"sm",mt:3,mb:2,children:s("header.about.contactUs")}),e.jsxs(Se,{children:[e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(be,{src:Xs,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:s("header.about.github")}),e.jsx(b,{fontSize:"sm",children:s("header.about.githubContent")})]})]}),e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(be,{src:en,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:s("header.about.slack")}),e.jsx(b,{fontSize:"sm",children:s("header.about.slackContent")}),e.jsx(b,{fontSize:"sm",as:"i",children:"#rmg, #rmp, #palette-and-templates, #random"})]})]})]}),e.jsx(pe,{as:"h5",size:"sm",mt:3,mb:2,children:s("header.about.linkExchange")}),e.jsxs(Se,{children:[e.jsxs(ye,{size:"lg",w:"85%",onClick:()=>c(!0),cursor:"pointer",children:[e.jsx(be,{src:"/rmp//images/guidaoTransit.jpg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ve,{display:"block",width:"100%",children:[e.jsx(b,{fontSize:"lg",fontWeight:"bold",mb:1,children:s("header.about.guidaoTransit")}),e.jsx(b,{fontSize:"sm",children:s("header.about.guidaoTransitContent")})]})]}),e.jsxs($,{size:"6xl",isOpen:r,onClose:()=>c(!1),children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:s("header.about.guidaoTransit")}),e.jsx(q,{}),e.jsx(Z,{paddingBottom:10,children:e.jsx(Ze,{width:"1080",height:"304",src:"/rmp//images/guidaoTransitQRCode.png"})})]})]})]})]})]})]})},sn=tn,nn=()=>{const[t,a]=y.useState(!1),{svgViewBoxZoom:n}=Q(r=>r.param),s=W(),o=[{type:"slider",label:"",value:400-n,min:10,max:390,step:1,onChange:r=>s(gt(400-r)),leftIcon:e.jsx(qt,{}),rightIcon:e.jsx(st,{}),minW:160}];return e.jsxs(Ot,{isOpen:t,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(kt,{children:e.jsx(te,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(st,{}),onClick:()=>a(!t)})}),e.jsx(zt,{children:e.jsx(At,{children:e.jsx(ue,{fields:o,noLabel:!0})})})]})},rn=t=>{const{isOpen:a,onClose:n}=t,s=W(),{t:o}=U(),r=y.useRef(window.graph),[c,h]=y.useState(0),[l,p]=y.useState(0),i=[{type:"input",label:o("header.settings.procedures.translate.x"),value:c.toString(),variant:"number",onChange:d=>h(Number(d)),minW:"full"},{type:"input",label:o("header.settings.procedures.translate.y"),value:l.toString(),variant:"number",onChange:d=>p(Number(d)),minW:"full"}],m=()=>{r.current.forEachNode((d,u)=>{r.current.updateNodeAttribute(d,"x",f=>(f??0)+c),r.current.updateNodeAttribute(d,"y",f=>(f??0)+l)}),s(ae()),s(oe()),s(se(r.current.export())),n()};return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:o("header.settings.procedures.translate.title")}),e.jsx(q,{}),e.jsxs(Z,{children:[o("header.settings.procedures.translate.content"),e.jsx(ue,{fields:i})]}),e.jsxs(ke,{children:[e.jsx(G,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),e.jsx(G,{colorScheme:"red",onClick:m,children:o("apply")})]})]})]})},an=t=>{const{isOpen:a,onClose:n}=t,s=W(),{t:o}=U(),r=y.useRef(window.graph),[c,h]=y.useState(1),l=[{type:"input",label:o("header.settings.procedures.scale.factor"),value:c.toString(),variant:"number",onChange:i=>h(Number(i)),minW:"full"}],p=()=>{r.current.forEachNode((i,m)=>{r.current.updateNodeAttribute(i,"x",d=>(d??0)*c),r.current.updateNodeAttribute(i,"y",d=>(d??0)*c)}),s(ae()),s(oe()),s(se(r.current.export())),n()};return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:o("header.settings.procedures.scale.title")}),e.jsx(q,{}),e.jsxs(Z,{children:[o("header.settings.procedures.scale.content"),e.jsx(ue,{fields:l})]}),e.jsxs(ke,{children:[e.jsx(G,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),e.jsx(G,{colorScheme:"red",onClick:p,children:o("apply")})]})]})]})},on=t=>{const{isOpen:a,onClose:n}=t,s=W(),{t:o}=U(),r=y.useRef(window.graph),c=Object.fromEntries(Object.entries(Ee).map(([u,f])=>[u,o(f.metadata.displayName).toString()])),[h,l]=y.useState(Object.keys(Ee).at(0)),[p,i]=y.useState(Object.keys(Ee).at(1)),m=[{type:"select",label:o("header.settings.procedures.changeType.changeFrom"),value:h,options:c,disabledOptions:[p],onChange:u=>l(u),minW:"full"},{type:"select",label:o("header.settings.procedures.changeType.changeTo"),value:p,options:c,disabledOptions:[h],onChange:u=>i(u),minW:"full"}],d=()=>{gs(r.current,h,p),s(ae()),s(se(r.current.export()))};return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsxs(Y,{children:[e.jsx(b,{as:"b",fontSize:"xl",children:o("header.settings.procedures.changeType.title")}),e.jsx(ht,{label:o("header.settings.pro"),children:e.jsx(We,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(q,{}),e.jsxs(Z,{children:[e.jsx(ue,{fields:m}),e.jsx(b,{fontSize:"sm",mt:"3",lineHeight:"100%",color:"red.500",children:o("header.settings.procedures.changeType.info")})]}),e.jsxs(ke,{children:[e.jsx(G,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),e.jsx(G,{colorScheme:"red",onClick:d,children:o("apply")})]})]})]})},ln=t=>{const{isOpen:a,onClose:n}=t,s=W(),{theme:o}=Q(d=>d.runtime),{t:r}=U(),c=y.useRef(window.graph),[h,l]=y.useState(o),[p,i]=y.useState(!1),m=()=>{c.current.filterEdges((d,u,f,A,j,S,x)=>u.style===Te.SingleColor&&JSON.stringify(u[Te.SingleColor].color)===JSON.stringify(h)).forEach(d=>c.current.dropEdge(d)),s(oe()),s(se(c.current.export())),n()};return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(q,{}),e.jsxs(Z,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(Zt,{theme:h,onClick:()=>i(!0)}),e.jsx(Qt,{isOpen:p,defaultTheme:h,onClose:()=>i(!1),onUpdate:d=>l(d)})]}),e.jsxs(ke,{children:[e.jsx(G,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:r("cancel")}),e.jsx(G,{colorScheme:"red",onClick:m,children:r("remove")})]})]})]})},Ae={width:"100%",justifyContent:"space-between"},he={fontFamily:"-apple-system"},cn=t=>{const{isOpen:a,onClose:n}=t,{keepLastPath:s}=Q(x=>x.runtime),o=W(),{t:r}=U(),c=dt("primary.500","primary.300"),[h,l]=y.useState(!1),[p,i]=y.useState(!1),[m,d]=y.useState(!1),[u,f]=y.useState(!1),A=D.isAllowAnalytics(),{telemetry:{app:j}}=Q(x=>x.app),S=x=>o(rs(x));return e.jsxs($,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(K,{}),e.jsxs(J,{children:[e.jsx(Y,{children:r("header.settings.title")}),e.jsx(q,{}),e.jsx(Z,{children:e.jsxs(Se,{divider:e.jsx(Et,{borderColor:"gray.200"}),children:[e.jsxs(F,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:r("header.settings.preference.title")}),e.jsx(F,{mt:"3",children:e.jsxs(F,{display:"flex",mb:"1",children:[e.jsx(b,{flex:"1",children:r("header.settings.preference.keepLastPath")}),e.jsx(He,{isChecked:s,onChange:({target:{checked:x}})=>o(Xt(x))})]})})]}),e.jsxs(F,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:r("header.settings.shortcuts.title")}),e.jsx(F,{mt:"3",children:e.jsxs(Tt,{children:[e.jsx(Mt,{children:e.jsxs(N,{children:[e.jsx(Qe,{children:r("header.settings.shortcuts.keys")}),e.jsx(Qe,{children:r("header.settings.shortcuts.description")})]})}),e.jsxs(Ht,{children:[e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(E,{children:"f"})}),e.jsx(w,{children:r("header.settings.shortcuts.f")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(es,{})}),e.jsx(w,{children:r("header.settings.shortcuts.arrowUpward")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(ts,{})}),e.jsx(w,{children:r("header.settings.shortcuts.arrowBack")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(ss,{})}),e.jsx(w,{children:r("header.settings.shortcuts.arrowForward")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(ns,{})}),e.jsx(w,{children:r("header.settings.shortcuts.arrowDownward")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(E,{children:"i"})}),e.jsx(w,{children:r("header.settings.shortcuts.i")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(E,{children:"j"})}),e.jsx(w,{children:r("header.settings.shortcuts.j")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(E,{children:"k"})}),e.jsx(w,{children:r("header.settings.shortcuts.k")})]}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(E,{children:"l"})}),e.jsx(w,{children:r("header.settings.shortcuts.l")})]}),e.jsxs(N,{children:[e.jsx(w,{children:we?e.jsx(E,{sx:he,children:"⇧"}):e.jsx(E,{children:"shift"})}),e.jsx(w,{children:r("header.settings.shortcuts.shift")})]}),e.jsxs(N,{children:[e.jsx(w,{children:we?e.jsx(E,{sx:he,children:"⌥"}):e.jsx(E,{children:"alt"})}),e.jsx(w,{children:r("header.settings.shortcuts.alt")})]}),e.jsxs(N,{children:[e.jsx(w,{children:we?e.jsx(E,{sx:he,children:"⌫"}):e.jsx(E,{children:"delete"})}),e.jsx(w,{children:r("header.settings.shortcuts.delete")})]}),e.jsxs(N,{children:[e.jsxs(w,{children:[we?e.jsx(E,{sx:he,children:"⌘"}):e.jsx(E,{children:"ctrl"})," + ",e.jsx(E,{children:"z"})]}),e.jsx(w,{children:r("header.settings.shortcuts.undo")})]}),e.jsxs(N,{children:[e.jsx(w,{children:we?e.jsxs(e.Fragment,{children:[e.jsx(E,{sx:he,children:"⇧"})," + ",e.jsx(E,{sx:he,children:"⌘"})," + ",e.jsx(E,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{children:"ctrl"})," + ",e.jsx(E,{children:"y"})]})}),e.jsx(w,{children:r("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(F,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:r("header.settings.procedures.title")}),e.jsxs(F,{mt:"3",children:[e.jsx(G,{sx:Ae,rightIcon:e.jsx(ze,{}),onClick:()=>l(!0),children:r("header.settings.procedures.translate.title")}),e.jsx(rn,{isOpen:h,onClose:()=>l(!1)}),e.jsx(G,{sx:Ae,rightIcon:e.jsx(ze,{}),onClick:()=>i(!0),children:r("header.settings.procedures.scale.title")}),e.jsx(an,{isOpen:p,onClose:()=>i(!1)}),e.jsx(G,{sx:Ae,rightIcon:e.jsx(ze,{}),onClick:()=>d(!0),children:e.jsxs(F,{children:[r("header.settings.procedures.changeType.title"),e.jsx(ht,{label:r("header.settings.pro"),children:e.jsx(We,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]})}),e.jsx(on,{isOpen:m,onClose:()=>d(!1)}),e.jsx(G,{sx:Ae,rightIcon:e.jsx(ze,{}),onClick:()=>f(!0),children:r("header.settings.procedures.removeLines.title")}),e.jsx(ln,{isOpen:u,onClose:()=>f(!1)})]})]}),e.jsxs(F,{width:"100%",mb:"3",children:[e.jsx(b,{as:"b",fontSize:"xl",children:r("header.settings.telemetry.title")}),e.jsxs(F,{mt:"3",children:[e.jsxs(F,{display:"flex",mb:"1",children:[e.jsx(b,{flex:"1",children:r("header.settings.telemetry.essential")}),e.jsx(He,{isChecked:A,isDisabled:!0})]}),e.jsx(b,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:r("header.settings.telemetry.essentialInfo")}),e.jsxs(k,{color:c,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[r("header.settings.telemetry.essentialLink")," ",e.jsx(T,{as:M})]}),e.jsxs(F,{display:"flex",mb:"1",children:[e.jsx(b,{flex:"1",children:r("header.settings.telemetry.additional")}),e.jsx(He,{isChecked:j,onChange:({target:{checked:x}})=>S(x)})]}),e.jsx(b,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:r("header.settings.telemetry.additionalInfo")})]})]})]})})]})]})},dn=cn;function hn(){const{t}=U(),a=W(),{telemetry:{app:n}}=Q(d=>d.app),{past:s,future:o}=Q(d=>d.param),[r,c]=y.useState(!1),[h,l]=y.useState(!1),p=it(D.getEnv),i=it(D.getAppVersion);y.useEffect(()=>{n&&p!==Ne.DEV&&D.event(Fe.APP_LOAD,{isStandaloneWindow:D.isStandaloneWindow()})},[p]);const m=async d=>{D.getI18nInstance().changeLanguage(d)};return e.jsxs(as,{children:[e.jsx(pe,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t("header.about.rmp")}),e.jsx(os,{environment:p,version:i,popoverHeader:p===Ne.PRD?void 0:e.jsxs(ot,{i18nKey:"header.popoverHeader",environment:p,children:["You're on ",{environment:p}," environment!"]}),popoverBody:p===Ne.PRD?void 0:e.jsx(ot,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(Pt,{ml:"auto",children:[e.jsx(ee,{children:e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(is,{}),disabled:s.length===0,onClick:()=>a(ls())})}),e.jsx(ee,{children:e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(cs,{}),disabled:o.length===0,onClick:()=>a(ds())})}),e.jsx(ee,{children:e.jsx(nn,{})}),e.jsx(ee,{children:e.jsx(_s,{})}),e.jsx(ee,{children:e.jsx(Zs,{})}),D.isStandaloneWindow()&&e.jsx(ee,{children:e.jsxs(Ge,{children:[e.jsx(_e,{as:te,icon:e.jsx(hs,{}),variant:"ghost",size:"sm"}),e.jsx(Ue,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(d=>e.jsx(re,{onClick:()=>m(d),children:Hs[d][d]},d))})]})}),e.jsx(ee,{children:e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(ps,{}),onClick:()=>c(!0)})}),e.jsx(ee,{children:e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(us,{}),onClick:()=>l(!0)})})]}),e.jsx(dn,{isOpen:r,onClose:()=>c(!1)}),e.jsx(sn,{isOpen:h,onClose:()=>l(!1)})]})}function pn(){const t=W(),a=Q(s=>s.runtime.globalAlerts),n=s=>{D.isStandaloneWindow()?window.open(`/${s}`,"_blank"):D.openApp(s)};return e.jsx(e.Fragment,{children:Object.entries(a).map(([s,{message:o,url:r,linkedApp:c}])=>e.jsxs(Rt,{status:s,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(It,{}),c?e.jsx(k,{onClick:()=>n(c),children:o}):r?e.jsx(k,{href:r,target:"_blank",children:o}):o,e.jsx(ct,{ml:"auto",onClick:()=>t(ms(s))})]},s))})}function yn(){return e.jsxs(e.Fragment,{children:[e.jsx(hn,{}),e.jsx(pn,{})]})}export{yn as default};
