import{S as p,H as i}from"./index-4a07cdb3.js";const M=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),_=n=>new Promise(e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(n)}),h=(n,e)=>n.find(t=>{const r=t.style;return r.getPropertyValue("font-family")===e.family&&r.getPropertyValue("unicode-range")===e.unicodeRange}),A=async(n,e,t,r)=>{var m,y;const o=Array.from(new Set(e.map(s=>[...n.querySelectorAll(s)]).flat().map(s=>s.innerHTML).join("").replace(/\s/g,""))).join(""),u=await document.fonts.load(t.join(", "),o),a=(y=(m=document.querySelector(`link#${r}`))==null?void 0:m.sheet)==null?void 0:y.cssRules;if(!a)return Promise.reject(new Error(`cssRules can not be found in link#${r}`));const g=Array.from(a).filter(s=>s instanceof CSSFontFaceRule),b=u.reduce((s,c)=>{const l=h(g,c);return l?s.find(S=>{const d=S.style,f=l.style;return d.getPropertyValue("font-family")===f.getPropertyValue("font-family")&&d.getPropertyValue("unicode-range")===f.getPropertyValue("unicode-range")})?s:s.concat(l):s},[]);return await Promise.all(b.map(async s=>{try{const c=await fetch(x(s)),l=await _(await c.blob());return s.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${l}'); `)}catch(c){return console.error(c),""}}))},x=n=>{var t;const e=n.style.getPropertyValue("src");return M()?e.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmp//styles/"+((t=e.match(/^url\("([\S*]+)"\)/))==null?void 0:t[1])},F={[p.MTR]:{className:[".rmp-name__mtr__zh",".rmp-name__mtr__en"],cssFont:["80px GenYoMin TW","Vegur"],cssName:"fonts_mtr"},[i.BerlinSBahnLineBadge]:{className:[".rmp-name__berlin"],cssFont:["16px Roboto"],cssName:"fonts_berlin"},[i.BerlinUBahnLineBadge]:{className:[".rmp-name__berlin"],cssFont:["16px Roboto"],cssName:"fonts_berlin"}},V=n=>{const e=n.currentTarget.getBoundingClientRect(),t=n.clientX-e.left,r=n.clientY-e.top;return{x:t,y:r}},P=(n,e)=>Math.round(n/e)*e,w=n=>{let[e,t,r,o]=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];return n.forEachNode((u,a)=>{e=Math.min(a.x,e),t=Math.min(a.y,t),r=Math.max(a.x,r),o=Math.max(a.y,o)}),e-=100,t-=100,r+=150,o+=150,{xMin:e,yMin:t,xMax:r,yMax:o}},B=navigator.platform.startsWith("Mac"),E=n=>{const e=Object.fromEntries([...Object.values(p),Object.values(i)].map(t=>[t,!1]));return n.forEachNode(t=>{const r=n.getNodeAttribute(t,"type");e[r]=!0}),e};export{F,V as a,w as c,E as f,A as g,B as i,P as r};
