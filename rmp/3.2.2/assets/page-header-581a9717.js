import{j as e,a8 as Pt,Q as zt,a9 as it,aa as at,G as oe,ab as lt,ac as ie,k as Ie,$ as U,M as J,a0 as K,p as Y,s as y,q as Z,r as q,I as Pe,h as R,t as me,ad as Wt,ae as Vt,g as xe,w as z,a7 as O,v as kt,af as ut,ag as Ut,F as gt,_ as ft,B,ah as ye,a1 as Ce,ai as de,aj as he,ak as pe,c as Jt,i as Kt,e as Yt,f as Zt,al as _t,am as qt,O as We,an as Qt,ao as Xt,ap as ee,aq as mt,ar as es,as as N,at as A,au as ts,av as re,x as ss,y as ns}from"./chakra-e455e76b.js";import{g as rs,r as $,b as j}from"./react-beb26faf.js";import{w as os,g as is,a as Ve,b as At,I as as,u as ls,r as D,n as xt,S as E,L as Ue,l as cs,c as le,R as Ot,d as W,e as X,s as ge,f as fe,h as ce,i as Et,j as Qe,M as jt,k as ds,m as hs,o as _,p as Tt,q as ps,t as Je,C as us,v as Mt,x as yt,y as Rt,z as se,A as gs,B as fs,D as ms,E as be,F as Xe,G as xs,H as js,J as ys,K as bt,N as bs,T as ws,O as Cs,P as Ss,Q as Te,U as vs,V as zs,W as ks,X as _s,Y as As,Z as Ke,_ as Os,$ as Es,a0 as Ts,a1 as Ms,a2 as Rs,a3 as Hs,a4 as Ns,a5 as Is,a6 as Bs,a7 as $s}from"./index-30d7eae7.js";import{s as Re}from"./stations-5b737d5b.js";import{c as Gs,i as we}from"./helpers-2fcbe9c8.js";import{c as Ls}from"./change-types-f2b9ee2d.js";var Ds={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const Fs=rs(Ds);var Ps=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function wt(t){var o={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},r=t.match(/<\/?([^\s]+?)[/\s>]/);if(r&&(o.name=r[1],(Fs[r[1]]||t.charAt(t.length-2)==="/")&&(o.voidElement=!0),o.name.startsWith("!--"))){var s=t.indexOf("-->");return{type:"comment",comment:s!==-1?t.slice(4,s):""}}for(var a=new RegExp(Ps),n=null;(n=a.exec(t))!==null;)if(n[0].trim())if(n[1]){var i=n[1].trim(),c=[i,""];i.indexOf("=")>-1&&(c=i.split("=")),o.attrs[c[0]]=c[1],a.lastIndex--}else n[2]&&(o.attrs[n[2]]=n[3].trim().substring(1,n[3].length-1));return o}var Ws=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,Vs=/^\s*$/,Us=Object.create(null);function Ht(t,o){switch(o.type){case"text":return t+o.content;case"tag":return t+="<"+o.name+(o.attrs?function(r){var s=[];for(var a in r)s.push(a+'="'+r[a]+'"');return s.length?" "+s.join(" "):""}(o.attrs):"")+(o.voidElement?"/>":">"),o.voidElement?t:t+o.children.reduce(Ht,"")+"</"+o.name+">";case"comment":return t+"<!--"+o.comment+"-->"}}var Js={parse:function(t,o){o||(o={}),o.components||(o.components=Us);var r,s=[],a=[],n=-1,i=!1;if(t.indexOf("<")!==0){var c=t.indexOf("<");s.push({type:"text",content:c===-1?t:t.substring(0,c)})}return t.replace(Ws,function(d,p){if(i){if(d!=="</"+r.name+">")return;i=!1}var h,f=d.charAt(1)!=="/",l=d.startsWith("<!--"),u=p+d.length,g=t.charAt(u);if(l){var m=wt(d);return n<0?(s.push(m),s):((h=a[n]).children.push(m),s)}if(f&&(n++,(r=wt(d)).type==="tag"&&o.components[r.name]&&(r.type="component",i=!0),r.voidElement||i||!g||g==="<"||r.children.push({type:"text",content:t.slice(u,t.indexOf("<",u))}),n===0&&s.push(r),(h=a[n-1])&&h.children.push(r),a[n]=r),(!f||r.voidElement)&&(n>-1&&(r.voidElement||r.name===d.slice(2,-1))&&(n--,r=n===-1?s:a[n]),!i&&g!=="<"&&g)){h=n===-1?s:a[n].children;var C=t.indexOf("<",u),w=t.slice(u,C===-1?void 0:C);Vs.test(w)&&(w=" "),(C>-1&&n+h.length>=0||w!==" ")&&h.push({type:"text",content:w})}}),s},stringify:function(t){return t.reduce(function(o,r){return o+Ht("",r)},"")}};function Ye(t,o){if(!t)return!1;const r=t.props?t.props.children:t.children;return o?r.length>0:!!r}function Ze(t){return t?t.props?t.props.children:t.children:[]}function Ks(t){return Object.prototype.toString.call(t)!=="[object Array]"?!1:t.every(o=>$.isValidElement(o))}function Se(t){return Array.isArray(t)?t:[t]}function Ys(t,o){const r={...o};return r.props=Object.assign(t.props,o.props),r}function Nt(t,o){if(!t)return"";let r="";const s=Se(t),a=o.transSupportBasicHtmlNodes&&o.transKeepBasicHtmlNodesFor?o.transKeepBasicHtmlNodesFor:[];return s.forEach((n,i)=>{if(typeof n=="string")r+=`${n}`;else if($.isValidElement(n)){const c=Object.keys(n.props).length,d=a.indexOf(n.type)>-1,p=n.props.children;if(!p&&d&&c===0)r+=`<${n.type}/>`;else if(!p&&(!d||c!==0))r+=`<${i}></${i}>`;else if(n.props.i18nIsDynamicList)r+=`<${i}></${i}>`;else if(d&&c===1&&typeof p=="string")r+=`<${n.type}>${p}</${n.type}>`;else{const h=Nt(p,o);r+=`<${i}>${h}</${i}>`}}else if(n===null)Ve("Trans: the passed in value is invalid - seems you passed in a null child.");else if(typeof n=="object"){const{format:c,...d}=n,p=Object.keys(d);if(p.length===1){const h=c?`${p[0]}, ${c}`:p[0];r+=`{{${h}}}`}else Ve("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",n)}else Ve("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",n)}),r}function Zs(t,o,r,s,a,n){if(o==="")return[];const i=s.transKeepBasicHtmlNodesFor||[],c=o&&new RegExp(i.join("|")).test(o);if(!t&&!c)return[o];const d={};function p(C){Se(C).forEach(x=>{typeof x!="string"&&(Ye(x)?p(Ze(x)):typeof x=="object"&&!$.isValidElement(x)&&Object.assign(d,x))})}p(t);const h=Js.parse(`<0>${o}</0>`),f={...d,...a};function l(C,w,x){const T=Ze(C),Q=g(T,w.children,x);return Ks(T)&&Q.length===0?T:Q}function u(C,w,x,T,Q){C.dummy&&(C.children=w),x.push($.cloneElement(C,{...C.props,key:T},Q?void 0:w))}function g(C,w,x){const T=Se(C);return Se(w).reduce((k,b,F)=>{const ne=b.children&&b.children[0]&&b.children[0].content&&r.services.interpolator.interpolate(b.children[0].content,f,r.language);if(b.type==="tag"){let G=T[parseInt(b.name,10)];!G&&x.length===1&&x[0][b.name]&&(G=x[0][b.name]),G||(G={});const S=Object.keys(b.attrs).length!==0?Ys({props:b.attrs},G):G,v=$.isValidElement(S),ke=v&&Ye(b,!0)&&!b.voidElement,_e=c&&typeof S=="object"&&S.dummy&&!v,Ae=typeof t=="object"&&t!==null&&Object.hasOwnProperty.call(t,b.name);if(typeof S=="string"){const M=r.services.interpolator.interpolate(S,f,r.language);k.push(M)}else if(Ye(S)||ke){const M=l(S,b,x);u(S,M,k,F)}else if(_e){const M=g(T,b.children,x);k.push($.cloneElement(S,{...S.props,key:F},M))}else if(Number.isNaN(parseFloat(b.name)))if(Ae){const M=l(S,b,x);u(S,M,k,F,b.voidElement)}else if(s.transSupportBasicHtmlNodes&&i.indexOf(b.name)>-1)if(b.voidElement)k.push($.createElement(b.name,{key:`${b.name}-${F}`}));else{const M=g(T,b.children,x);k.push($.createElement(b.name,{key:`${b.name}-${F}`},M))}else if(b.voidElement)k.push(`<${b.name} />`);else{const M=g(T,b.children,x);k.push(`<${b.name}>${M}</${b.name}>`)}else if(typeof S=="object"&&!v){const M=b.children[0]?ne:null;M&&k.push(M)}else b.children.length===1&&ne?k.push($.cloneElement(S,{...S.props,key:F},ne)):k.push($.cloneElement(S,{...S.props,key:F}))}else if(b.type==="text"){const G=s.transWrapTextNodes,S=n?s.unescape(r.services.interpolator.interpolate(b.content,f,r.language)):r.services.interpolator.interpolate(b.content,f,r.language);G?k.push($.createElement(G,{key:`${b.name}-${F}`},S)):k.push(S)}return k},[])}const m=g([{dummy:!0,children:t||[]}],h,Se(t||[]));return Ze(m[0])}function qs(t){let{children:o,count:r,parent:s,i18nKey:a,context:n,tOptions:i={},values:c,defaults:d,components:p,ns:h,i18n:f,t:l,shouldUnescape:u,...g}=t;const m=f||At();if(!m)return os("You will need to pass in an i18next instance by using i18nextReactModule"),o;const C=l||m.t.bind(m)||(v=>v);n&&(i.context=n);const w={...is(),...m.options&&m.options.react};let x=h||C.ns||m.options&&m.options.defaultNS;x=typeof x=="string"?[x]:x||["translation"];const T=d||Nt(o,w)||w.transEmptyNodeValue||a,{hashTransKey:Q}=w,k=a||(Q?Q(T):T),b=c?i.interpolation:{interpolation:{...i.interpolation,prefix:"#$?",suffix:"?$#"}},F={...i,count:r,...c,...b,defaultValue:T,ns:x},ne=k?C(k,F):T,G=Zs(p||o,ne,m,w,F,u),S=s!==void 0?s:w.defaultTransParent;return S?$.createElement(S,g,G):G}function Ct(t){let{children:o,count:r,parent:s,i18nKey:a,context:n,tOptions:i={},values:c,defaults:d,components:p,ns:h,i18n:f,t:l,shouldUnescape:u,...g}=t;const{i18n:m,defaultNS:C}=$.useContext(as)||{},w=f||m||At(),x=l||w&&w.t.bind(w);return qs({children:o,count:r,parent:s,i18nKey:a,context:n,tOptions:i,values:c,defaults:d,components:p,ns:h||x&&x.ns||C||w&&w.options&&w.options.defaultNS,i18n:w,t:l,shouldUnescape:u,...g})}var St=function(t){return ls(D.ready(),t)},Qs={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}},ze=(t=>(t.left="l",t.right="r",t))(ze||{}),ue=(t=>(t.through="through",t.nonThrough="nonthrough",t))(ue||{}),Be=(t=>(t.local="local",t.express="express",t.direct="direct",t))(Be||{}),ae=(t=>(t.MTR="mtr",t.GZMTR="gzmtr",t.SHMetro="shmetro",t))(ae||{}),ct=(t=>(t.sh="sh",t.sh2020="sh2020",t))(ct||{});const Xs=(t,{info_panel_type:o,line_num:r,stn_list:s,style:a,theme:n})=>{const i=Object.fromEntries(Object.keys(s).filter(c=>!["linestart","lineend"].includes(c)).map(c=>[c,`stn_${xt(10)}`]));Object.entries(s).filter(([c,d])=>!["linestart","lineend"].includes(c)).forEach(([c,d])=>{const p=t.filterNodes((h,f)=>Object.values(E).includes(f.type)&&f[f.type].names[0]===d.name[0]);p.length!==0&&(i[c]=p[0])}),Object.entries(s).filter(([c,d])=>!["linestart","lineend"].includes(c)).filter(([c,d])=>t.filterNodes((p,h)=>Object.values(E).includes(h.type)&&h[h.type].names[0]===d.name[0]).length===0).forEach(([c,d],p)=>{let h=E.ShmetroBasic;const f=d.transfer.groups,l=f.map(g=>g.lines).flat();a===ae.SHMetro?l.length>0?h=E.ShmetroInt:o===ct.sh2020?h=E.ShmetroBasic2020:h=E.ShmetroBasic:a===ae.GZMTR?l.length>0?h=E.GzmtrInt:h=E.GzmtrBasic:a===ae.MTR&&(h=E.MTR);const u={...structuredClone(Re[h].defaultAttrs),names:d.name};h===E.ShmetroBasic2020?u.color=n:h===E.GzmtrBasic?(u.color=n,u.lineCode=r,u.stationCode=d.num):h===E.GzmtrInt?u.transfer=f.map((g,m)=>{const C=g.lines.map(w=>{var x;return[...(x=w.theme)!=null?x:n,"1","01"]});return m===0?[[...n,r,d.num],...C]:C}):h===E.MTR&&(f[0].lines.length?u.transfer=[[[...n,"",""],...f[0].lines.map(g=>{var m;return[...(m=g.theme)!=null?m:n,"",""]})]]:u.transfer=[[]]),t.addNode(i[c],{visible:!0,zIndex:0,x:100+p*50,y:1e3,type:h,[h]:u})}),Object.entries(s).filter(([c,d])=>!["linestart","lineend"].includes(c)).forEach(([c,d])=>{d.children.filter(p=>!["linestart","lineend"].includes(p)).forEach(p=>{t.addDirectedEdgeWithKey(`line_${xt(10)}`,i[c],i[p],{visible:!0,zIndex:0,type:Ue.Diagonal,[Ue.Diagonal]:structuredClone(cs[Ue.Diagonal].defaultAttrs),style:le.SingleColor,[le.SingleColor]:{color:n},reconcileId:""})})})},en="rmg-bridge--",tn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function sn(t){const{isOpen:o,onClose:r,onImport:s}=t,[a]=$.useState(crypto.randomUUID()),n="/rmg/#/import?"+new URLSearchParams({parentComponent:D.getAppName(),parentId:a});return $.useEffect(()=>{const i=new BroadcastChannel(en+a);return i.onmessage=c=>{const{event:d,data:p}=c.data;console.log("[rmp] Received event from RMG app clip:",d),d==="CLOSE"?r():d==="IMPORT"&&s(p)},()=>{i.close()}},[]),e.jsx(Ot,{isOpen:o,onClose:r,sx:tn,children:e.jsx("iframe",{src:n,loading:"lazy"})})}const nn="RMP_GALLERY_CHANNEL",rn="OPEN_TEMPLATE",on=new BroadcastChannel(nn),an={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"}};function ln(t){const{isOpen:o,onClose:r}=t,s=Pt(),{t:a}=W(),n=X(),i=j.useRef(window.graph),c=j.useCallback(()=>{n(ge()),n(fe()),n(ce(i.current.export()))},[n,ge,fe,ce,i]),d=async h=>{const{version:f,...l}=JSON.parse(await Et(JSON.stringify(h)));n(Qe()),i.current.clear(),i.current.import(l.graph),c()},p=async h=>{var l;const f=await((l=(await Promise.allSettled([fetch(`/rmp-gallery/resources/real_world/${h}.json`),fetch(`/rmp-gallery/resources/fantasy/${h}.json`)])).filter(u=>u.status==="fulfilled").find(u=>u.value.status===200))==null?void 0:l.value.json());f?(d(f),s({title:a("header.open.importFromRMPGallery",{id:h}),status:"success",duration:9e3,isClosable:!0})):s({title:a("header.open.failToImportFromRMPGallery",{id:h}),status:"error",duration:9e3,isClosable:!0})};return j.useEffect(()=>{const h=window.location.href;if(h.includes("/s/")){history.replaceState({},a("about.rmp"),h.substring(0,h.indexOf("s/")));const f=h.substring(h.lastIndexOf("s/")+2);p(f)}},[]),j.useEffect(()=>{on.onmessage=h=>{const{event:f,data:l}=h.data;f===rn&&(p(l),r())}},[]),e.jsx(e.Fragment,{children:e.jsxs(Ot,{isOpen:o,onClose:r,size:"full",sx:an,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(zt,{onClick:r,position:"fixed",top:"5px",right:"15px"})]})})}function cn(){const{t}=W(),o=X(),r=j.useRef(window.graph),s=j.useRef(null),[a,n]=j.useState(!1),[i,c]=j.useState(!1),d=j.useCallback(()=>{o(ge()),o(fe()),o(ce(r.current.export()))},[o,ge,fe,ce,r]),p=()=>{o(Qe()),r.current.clear(),o(Tt(100)),o(ps({x:0,y:0})),d()},h=l=>{try{Xs(r.current,l),d()}catch(u){o(Je({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",u)}finally{n(!1)}},f=async l=>{var g;const u=(g=l.target.files)==null?void 0:g[0];if(console.log("OpenActions.handleUpload():: received file",u),(u==null?void 0:u.type)!=="application/json")o(Je({status:"error",message:t("OpenActions.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const m=await dn(u),{version:C,...w}=JSON.parse(await Et(m));o(Qe()),r.current.clear(),r.current.import(w.graph),d()}catch(m){o(Je({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",m)}l.target.value=""};return e.jsxs(it,{children:[e.jsx(at,{as:oe,size:"sm",variant:"ghost",icon:e.jsx(jt,{})}),e.jsxs(lt,{children:[e.jsx(ie,{icon:e.jsx(ds,{}),onClick:p,children:t("header.open.new")}),e.jsx("input",{id:"upload_project",ref:s,type:"file",accept:".json",hidden:!0,onChange:f,"data-testid":"file-upload"}),e.jsx(ie,{icon:e.jsx(jt,{}),onClick:()=>{var l;return(l=s==null?void 0:s.current)==null?void 0:l.click()},children:t("header.open.config")}),e.jsx(ie,{icon:e.jsx(hs,{}),onClick:()=>n(!0),children:t("header.open.projectRMG")}),e.jsxs(ie,{icon:e.jsx(_,{}),onClick:()=>c(!0),children:[t("header.open.gallery"),e.jsx(Ie,{ml:"1",colorScheme:"green",children:"New"})]})]}),e.jsx(sn,{isOpen:a,onClose:()=>n(!1),onImport:h}),e.jsx(ln,{isOpen:i,onClose:()=>c(!1)})]})}const dn=t=>new Promise(o=>{const r=new FileReader;r.onloadend=()=>o(r.result),r.readAsText(t)}),et=(t,o,r)=>{const s=new Blob([r],{type:o});It(t,s)},It=(t,o)=>{const r=window.URL.createObjectURL(o),s=document.createElement("a");s.href=r,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)},hn=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),pn=t=>new Promise(o=>{const r=new FileReader;r.onloadend=()=>o(r.result),r.readAsDataURL(t)}),un=(t,o)=>t.find(r=>{const s=r.style;return s.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===o.family&&s.getPropertyValue("unicode-range")===o.unicodeRange}),gn=async t=>{var i,c;const o=Array.from(new Set([...t.querySelectorAll(".rmp-name__mtr__zh"),...t.querySelectorAll(".rmp-name__mtr__en")].map(d=>d.innerHTML).join("").replace(/\s/g,""))).join(""),r=await document.fonts.load("80px GenYoMin TW, Vegur",o),s=(c=(i=document.querySelector("link#fonts_mtr"))==null?void 0:i.sheet)==null?void 0:c.cssRules;if(!s)return Promise.reject(new Error("cssRules can not be found in link#css_share"));const a=Array.from(s).filter(d=>d instanceof CSSFontFaceRule),n=r.reduce((d,p)=>{const h=un(a,p);return h?d.find(l=>{const u=l.style,g=h.style;return u.getPropertyValue("font-family")===g.getPropertyValue("font-family")&&u.getPropertyValue("unicode-range")===g.getPropertyValue("unicode-range")})?d:d.concat(h):d},[]);return await Promise.all(n.map(async d=>{try{const p=await fetch(fn(d)),h=await pn(await p.blob());return d.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${h}'); `)}catch(p){return console.error(p),""}}))},fn=t=>{var r;const o=t.style.src;return hn()?o.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmp//styles/"+((r=o.match(/^url\("([\S*]+)"\)/))==null?void 0:r[1])},te=new Set,tt=new Set,st=new Set,nt=new Set,He=new Map,V=new Map;let H=[],ve=0;const Ne=new Map,qe=new Map,rt=new Set,mn={name:["LEFT END","LEFT END"],secondaryName:!1,num:"00",services:[Be.local],parents:[],children:["lineend"],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:ze.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},xn={name:["RIGHT END","RIGHT END"],secondaryName:!1,num:"00",services:[Be.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:ze.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},jn={},Bt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:ae.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:ze.right,platform_num:"1",theme:[us.Shanghai,"sh1","#E3002B",Mt.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:jn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:ct.sh,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1}},yn={name:["",""],secondaryName:!1,num:"",services:[Be.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:ze.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},I=t=>`${t[0]}/${t[1]}=${t[2]}${t[3]}`,$t=t=>[le.SingleColor,le.MTRRaceDays].includes(t),bn=t=>{if([le.SingleColor,le.MTRRaceDays].includes(t.style))return structuredClone(t[t.style].color)},wn=(t,o)=>{const[r,s]=t.extremities(o),a=t.getEdgeAttributes(o),n=a.style;if(r!=s&&$t(n)){const i=bn(a);nt.has(I(i))||(st.add(i),nt.add(I(i)),He.set(i,r)),V.has(r)?H.push({target:s,next:V.get(r),color:i}):H.push({target:s,next:-1,color:i}),V.set(r,ve),ve++,V.has(s)?H.push({target:r,next:V.get(s),color:i}):H.push({target:r,next:-1,color:i}),V.set(s,ve),ve++}},Gt=(t,o,r)=>{if(te.has(t))return;te.add(t);let s=0;const a=new Set;for(let n=V.get(t);n!=-1;n=H[n].next){const i=H[n].target,c=H[n].color;I(c)==I(r)&&(a.has(i)||(a.add(i),s++,i!=o&&Gt(i,t,r)))}Ne.set(t,s)},vt=(t,o)=>{const r=t.stn_list.lineend.parents;r.push(o),t.stn_list.lineend.parents=structuredClone(r).reverse(),t.stn_list.lineend.parents.length==2?t.stn_list.lineend.branch.left=[ue.through,r[1]]:t.stn_list.lineend.branch.left=[]},Cn=(t,o)=>{let r=0;for(let s=V.get(t);s!=-1;s=H[s].next){H[s].target;const a=H[s].color;I(a)==I(o)&&r++}return r},Lt=(t,o,r)=>{if(rt.has(t))return[];rt.add(t);const s=[];for(let a=V.get(t);a!=-1;a=H[a].next){const n=H[a].target,i=H[a].color;n!=o&&I(i)==I(r)&&(n.startsWith("stn")?s.push(n):s.push(...Lt(n,t,r)))}return s},ot=(t,o,r,s,a,n,i)=>{if(te.has(t)&&(!t.startsWith("misc_node_")&&i.stn_list[t]==null||t.startsWith("misc_node_")&&!tt.has(t)||i.loop))return[];if(te.has(t)&&i.stn_list[t]!=null&&Cn(t,n)-1>=2){const l=[...i.stn_list[t].parents,o];if(i.stn_list[l[1]]==null){const m=l[0];l[0]=l[1],l[1]=m}i.stn_list[t].parents=structuredClone(l).reverse(),i.stn_list[t].branch.left=[ue.through,l[1]];const u=[];for(const m of i.stn_list[t].children)m!=o&&u.push(m);i.stn_list[t].children=structuredClone(u),i.stn_list[t].branch.right=[];const g=[];for(const m of i.stn_list.lineend.parents)m!=t&&g.push(m);return i.stn_list.lineend.parents=structuredClone(g).reverse(),i.stn_list.lineend.parents.length==2?i.stn_list.lineend.branch.left=[ue.through,g[1]]:i.stn_list.lineend.branch.left=[],u.length==0&&(i.stn_list[t].children=["lineend"],vt(i,t)),[t]}te.add(t);const c=[],d=[],p=[],h=new Set,f=new Set;for(let l=V.get(t);l!=-1;l=H[l].next){const u=H[l].target,g=H[l].color;if(u!=r){if(I(g)==I(n)){if(f.has(u))continue;if(f.add(u),t.startsWith("misc_node_")){const m=ot(u,o,t,s+1,a,n,i);m.length!=0&&c.push(...m)}else{const m=ot(u,t,t,s+1,a,n,i);m.length!=0&&c.push(...m)}}if(!h.has(I(g))&&I(g)!=I(n)){h.add(I(g));const m={theme:g,name:[g[1],g[1]]};p.push(m)}}}if(c.length==2){for(let l=0;l<2;l++)c[l]=="lineend"&&c.splice(l,1);if(i.stn_list[c[1]].parents.length>=2){const l=c[0];c[0]=c[1],c[1]=l}}if(te.has(t)&&i.stn_list[t]!=null){const l=[];for(const u of i.stn_list.lineend.parents)u!=t&&l.push(u);i.stn_list.lineend.parents=structuredClone(l).reverse(),i.stn_list.lineend.parents.length==2?i.stn_list.lineend.branch.left=[ue.through,l[1]]:i.stn_list.lineend.branch.left=[],c.length==0&&(rt.clear(),d.push(...Lt(t,o,n)))}if(t.startsWith("misc_node_"))return tt.add(t),c;{const l=a.getNodeAttributes(t).type,u=a.getNodeAttributes(t)[l];if(i.stn_list[t]=structuredClone(yn),i.stn_list[t].name=[u.names[0],u.names[1]],i.stn_list[t].num=String(s),a.getNodeAttributes(t).type==E.GzmtrBasic){const g=u;i.stn_list[t].num=g.stationCode,i.stn_list[t].secondaryName=g.secondaryNames}if(a.getNodeAttributes(t).type==E.GzmtrInt){const g=u,m=g.transfer[0];for(const C of m)if(I(C)==I(n)){i.stn_list[t].num=String(C[5]);break}i.stn_list[t].secondaryName=g.secondaryNames}return c.length!=0?(i.stn_list[t].children=structuredClone(c).reverse(),c.length==2&&(i.stn_list[t].branch.right=[ue.through,c[1]])):(i.stn_list[t].children=["lineend"],vt(i,t)),d.push(o),i.stn_list[t].parents=structuredClone(d).reverse(),d.length==2&&(i.stn_list[t].branch.left=[ue.through,d[1]]),p.length!=0&&(i.stn_list[t].transfer.groups[0].lines=structuredClone(p)),[t]}},Sn=(t,o,r,s)=>{const a=structuredClone(Bt);s=="LOOP"&&(a.loop=!0);let n;switch(t.getNodeAttributes(r).type){case E.GzmtrBasic:case E.GzmtrInt:n=ae.GZMTR;break;case E.MTR:n=ae.MTR;break;default:n=ae.SHMetro;break}a.theme=structuredClone(o),a.style=n,a.stn_list.linestart=structuredClone(mn),a.stn_list.lineend=structuredClone(xn),te.clear(),tt.clear();const i=ot(r,"linestart","linestart",1,t,o,a);if(a.current_stn_idx=i[0],a.stn_list.linestart.children=[i[0]],!(Object.keys(a.stn_list).length<=3||a.stn_list.lineend.parents.length>=3))return structuredClone(a)},vn=t=>{te.clear(),st.clear(),nt.clear(),He.clear(),V.clear(),H=[],ve=0,Ne.clear(),qe.clear(),t.filterEdges(s=>s.startsWith("line")).forEach(s=>{$t(t.getEdgeAttributes(s).style)&&wn(t,s)});let o=0;t.forEachNode(s=>{qe.set(s,++o)}),qe.set("lineend",++o);const r=[];for(const s of st){te.clear(),Ne.clear(),Gt(He.get(s),"line_root",s);let a=!0,n="LINE";const i=[];for(const[d,p]of Ne)p==1&&i.push(d),p==3&&(n="BRANCH"),p>3&&(a=!1);if(!a)continue;i.length==0&&(n="LOOP",i.push(He.get(s)));const c=[];for(const d of i){const p=Sn(t,s,d,n);p!=null&&c.push([p,p.stn_list[p.current_stn_idx].name[0],p.stn_list[p.current_stn_idx].name[1]])}c.length!=0&&r.push({theme:s,param:structuredClone(c),type:n})}return r},zn=t=>t[0]!=""&&t[1]!=""?t[0]+"_"+t[1]:t[0]!=""?t[0]:t[1]!=""?t[1]:`${new Date().valueOf()}`,kn=(t,o,r)=>{t.line_name=o,t.line_num=String(r),console.log(t),et(`RMG_${zn(o)}.json`,"application/json",JSON.stringify(t))},_n={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},An=t=>{const{isOpen:o,onClose:r}=t,{t:s}=W(),a=j.useRef(window.graph),[n,i]=j.useState(!1),[c,d]=j.useState([[Bt,"",""]]),[p,h]=j.useState(["","",""]),[f,l]=j.useState([]);return j.useEffect(()=>{o&&l(vn(a.current))},[o]),e.jsxs(U,{isOpen:o,onClose:r,size:"2xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:e.jsx(y,{as:"b",fontSize:"xl",children:s("header.download.2rmg.title")})}),e.jsx(Z,{}),e.jsxs(q,{children:[e.jsx(y,{fontSize:"sm",mt:"3",lineHeight:"100%",children:s("header.download.2rmg.info1")}),e.jsx(y,{fontSize:"sm",mt:"3",lineHeight:"100%",children:s("header.download.2rmg.info2")}),e.jsx("br",{}),f.length===0?e.jsx(y,{fontSize:"md",children:s("header.download.2rmg.noline")}):e.jsx("table",{children:f.map(({theme:u,param:g,type:m})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(yt,{name:u[0]=="other"&&u[1]=="other"?u[2]:u[1],bg:u[2],fg:u[3]})}),e.jsx("td",{children:e.jsx(Pe,{placeholder:s("header.download.2rmg.placeholder.chinese"),id:"nameCh_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(Pe,{placeholder:s("header.download.2rmg.placeholder.english"),id:"nameEn_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(Pe,{placeholder:s("header.download.2rmg.placeholder.lineCode"),id:"lineNum_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(yt,{name:s(`header.download.2rmg.type.${m.toLowerCase()}`),bg:_n[m],fg:Mt.white})}),e.jsx("td",{children:e.jsx(R,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const C=document.getElementById("nameCh_"+JSON.stringify(u)),w=document.getElementById("nameEn_"+JSON.stringify(u)),x=document.getElementById("lineNum_"+JSON.stringify(u));d(g),h([C.value.trim(),w.value.trim(),x.value.trim()]),i(!0)},size:"sm",children:e.jsx(Rt,{})})})]},JSON.stringify(u)))})]}),e.jsx(me,{children:e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:s("close")})})]}),e.jsx(On,{isOpen:n,onClose:()=>i(!1),param:c,nameList:p})]})},On=t=>{const{isOpen:o,onClose:r,param:s,nameList:a}=t,{t:n}=W(),[i,c]=j.useState("");return j.useEffect(()=>{a[0]!=""&&a[1]!=""?c(a[0]+"/"+a[1]):a[0]!=""?c(a[0]):a[1]!=""&&c(a[1])},[...a]),e.jsxs(U,{isOpen:o,onClose:r,size:"md",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:e.jsxs(y,{as:"b",fontSize:"xl",children:[n("header.download.2rmg.download")," ",i]})}),e.jsx(Z,{}),e.jsx(q,{children:e.jsxs(Wt,{children:[e.jsx(y,{fontSize:"sm",mb:"2",lineHeight:"100%",children:n("header.download.2rmg.downloadInfo")}),s.map(([d,p,h])=>e.jsxs(R,{onClick:()=>{kn(d,[a[0],a[1]],a[2])},children:[p,"/",h]},`${p}${h}`))]})}),e.jsx(me,{children:e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:n("close")})})]})]})},En=t=>{const{isOpen:o,onClose:r}=t,{t:s}=W();return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:s("header.download.termsAndConditions")}),e.jsx(Z,{}),e.jsx(q,{children:e.jsxs(Vt,{children:[e.jsxs(xe,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(z,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(O,{as:_})]}),", ",e.jsxs(z,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(O,{as:_})]})," or ",e.jsxs(z,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(O,{as:_})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(z,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(O,{as:_})]}),"，",e.jsxs(z,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(O,{as:_})]}),"或",e.jsxs(z,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(O,{as:_})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(xe,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(z,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(O,{as:_})]})," and ",e.jsxs(z,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(O,{as:_})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(z,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(O,{as:_})]}),"及",e.jsxs(z,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(O,{as:_})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(xe,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(z,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(O,{as:_})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(z,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(O,{as:_})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(xe,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(xe,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(z,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(O,{as:_})]})," ","– the open-source emoji and icon project. License:",e.jsxs(z,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(O,{as:_})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(z,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(O,{as:_})]}),"所设计。许可证：",e.jsxs(z,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(O,{as:_})]})]}),e.jsxs(xe,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},Tn=En;function Mn(){const{t}=W(),{telemetry:{project:o}}=se(v=>v.app),{nodeExists:r}=se(v=>v.runtime),s=j.useRef(window.graph),a=kt("white","gray.800"),[n,i]=j.useState("png"),c={png:t("header.download.png"),svg:t("header.download.svg")},[d,p]=j.useState(100),h=Object.fromEntries([25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].map(v=>[v,`${v}%`])),[f,l]=j.useState(!1),u=[{type:"select",label:t("header.download.format"),value:n,options:c,onChange:v=>i(v==="png"?"png":"svg")}],g=[{type:"select",label:t("header.download.scale"),value:d,options:h,onChange:v=>p(v)},{type:"switch",label:t("header.download.transparent"),isChecked:f,onChange:l}],[m,C]=j.useState(!1),[w,x]=j.useState(!1),[T,Q]=j.useState(!1),[k,b]=j.useState(!1),[F,ne]=j.useState(!1),G=()=>{o&&D.event(Xe.DOWNLOAD_PARAM,{"#nodes":s.current.order,"#edges":s.current.size});const v=xs(js.getState().param);et(`RMP_${new Date().valueOf()}.json`,"application/json",v)},S=async()=>{C(!1),o&&D.event(Xe.DOWNLOAD_IMAGES,{numberOfNodes:s.current.order,numberOfEdges:s.current.size});const{xMin:v,yMin:ke,xMax:_e,yMax:Ae}=Gs(s.current),[M,$e]=[_e-v,Ae-ke],P=document.getElementById("canvas").cloneNode(!0);if([...P.children].filter(L=>s.current.hasNode(L.id)&&s.current.getNodeAttribute(L.id,"type")===ys.Virtual).forEach(L=>P.removeChild(L)),T||P.appendChild(Rn(_e-400,Ae-60)),P.setAttribute("viewBox",`${v} ${ke} ${M} ${$e}`),P.setAttribute("width",M.toString()),P.setAttribute("height",$e.toString()),Object.entries({".rmp-name__zh":["font-family"],".rmp-name__en":["font-family"],".rmp-name__mtr__zh":["font-family"],".rmp-name__mtr__en":["font-family"],".rmp-name-station":["paint-order","stroke","stroke-width"]}).forEach(([L,Ee])=>{const dt=document.querySelector(L);if(dt===null)return;const Ft=window.getComputedStyle(dt);P.querySelectorAll(L).forEach(ht=>{Ee.forEach(pt=>{ht.setAttribute(pt,Ft.getPropertyValue(pt))}),ht.classList.remove(L)})}),r[E.MTR])try{const L=await gn(P),Ee=document.createElement("style");Ee.textContent=L.join(`
`),P.prepend(Ee)}catch(L){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(L)}if(n==="svg"){et(`RMP_${new Date().valueOf()}.svg`,"image/svg+xml",P.outerHTML);return}document.body.appendChild(P);const Dt="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(P.outerHTML)));document.body.removeChild(P);const Oe=document.createElement("canvas"),[Ge,Le]=[M*d/100,$e*d/100];Oe.width=Ge,Oe.height=Le;const De=Oe.getContext("2d");f||(De.fillStyle=a,De.fillRect(0,0,Ge,Le));const Fe=new Image;Fe.onload=()=>{De.drawImage(Fe,0,0,Ge,Le),Oe.toBlob(L=>It(`RMP_${new Date().valueOf()}.png`,L),"image/png")},Fe.src=Dt};return e.jsxs(it,{id:"download",children:[e.jsx(at,{as:oe,size:"sm",variant:"ghost",icon:e.jsx(Rt,{})}),e.jsxs(lt,{children:[e.jsx(ie,{icon:e.jsx(gs,{}),onClick:G,children:t("header.download.config")}),e.jsxs(ie,{icon:e.jsx(fs,{}),onClick:()=>ne(!0),children:[t("header.download.2rmg.title"),e.jsx(Ie,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ie,{icon:e.jsx(ms,{}),onClick:()=>C(!0),children:t("header.download.image")})]}),e.jsxs(U,{size:"xl",isOpen:m,onClose:()=>C(!1),children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:t("header.download.image")}),e.jsx(Z,{}),e.jsxs(q,{children:[e.jsx(be,{fields:u}),n==="png"&&e.jsx(be,{fields:g}),e.jsx("br",{}),e.jsx(ut,{isChecked:T,onChange:v=>Q(v.target.checked),children:e.jsxs(y,{children:[t("header.download.shareInfo1"),e.jsxs(z,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(O,{as:_})]}),t("header.download.shareInfo2")]})}),e.jsx(ut,{isChecked:k,onChange:v=>b(v.target.checked),children:e.jsxs(y,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(z,{color:"teal.500",onClick:()=>x(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(O,{as:_})]}),t("header.download.period")]})})]}),e.jsx(me,{children:e.jsx(Ut,{children:e.jsx(R,{colorScheme:"teal",variant:"outline",size:"sm",disabled:!k,onClick:S,children:t("header.download.confirm")})})}),e.jsx(Tn,{isOpen:w,onClose:()=>x(!1)})]})]}),e.jsx(An,{isOpen:F,onClose:()=>ne(!1)})]})}const Rn=(t,o)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.setAttribute("transform",`translate(${t}, ${o})scale(2)`);const s=document.createElementNS("http://www.w3.org/2000/svg","image");s.setAttribute("width","40"),s.setAttribute("height","40"),s.setAttribute("x","-50"),s.setAttribute("y","-20");const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("font-family","Arial, sans-serif"),a.setAttribute("font-size","16"),a.appendChild(document.createTextNode("Rail Map Painter"));const n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.setAttribute("font-family","Arial, sans-serif"),n.setAttribute("font-size","10"),n.setAttribute("y","10"),n.appendChild(document.createTextNode("https://railmapgen.github.io/rmp/")),r.appendChild(s),r.appendChild(a),r.appendChild(n),r},Hn="/rmp/assets/github-mark-7a0dd11e.svg",Nn="/rmp/assets/slack-mark-19839006.svg",In=t=>{const{isOpen:o,onClose:r}=t,{t:s}=W(),a=D.getAppVersion(),[n,i]=j.useState(!1);return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:s("header.about.title")}),e.jsx(Z,{}),e.jsxs(q,{paddingBottom:10,children:[e.jsxs(gt,{direction:"row",children:[e.jsx(ft,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(gt,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(y,{fontSize:"xl",as:"b",children:s("header.about.rmp")}),e.jsx(y,{children:a}),e.jsx(y,{}),e.jsx(y,{fontSize:"sm",children:s("header.about.railmapgen")})]})]}),e.jsx(B,{margin:5,children:e.jsx(y,{fontSize:"xl",children:s("header.about.desc")})}),e.jsx(ye,{as:"h5",size:"sm",mt:3,mb:2,children:s("header.about.contributors")}),e.jsx(ye,{as:"h6",size:"xs",my:2,children:s("header.about.coreContributors")}),e.jsxs(Ce,{children:[e.jsxs(de,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(he,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(y,{fontSize:"sm",children:s("header.about.content1")}),e.jsx(y,{fontSize:"sm",align:"right",mb:1,children:s("header.about.content2")})]})]}),e.jsxs(de,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(he,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(y,{fontSize:"sm",children:s("header.about.langonginc")}),e.jsx(y,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(ye,{as:"h6",size:"xs",my:2,children:s("header.about.styleContributors")}),e.jsxs(Ce,{children:[e.jsxs(de,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(he,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(y,{fontSize:"sm",mb:1,children:s("header.about.203IhzElttil")})]})]}),e.jsxs(de,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/52PD","_blank"),cursor:"pointer",children:[e.jsx(he,{src:"https://github.com/52PD.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:"52PD"}),e.jsx(y,{fontSize:"sm",mb:1,children:s("header.about.52PD")})]})]})]}),e.jsx(ye,{as:"h5",size:"sm",mt:3,mb:2,children:s("header.about.contactUs")}),e.jsxs(Ce,{children:[e.jsxs(de,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(he,{src:Hn,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:s("header.about.github")}),e.jsx(y,{fontSize:"sm",children:s("header.about.githubContent")})]})]}),e.jsxs(de,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(he,{src:Nn,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:s("header.about.slack")}),e.jsx(y,{fontSize:"sm",children:s("header.about.slackContent")}),e.jsx(y,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(ye,{as:"h5",size:"sm",mt:3,mb:2,children:s("header.about.linkExchange")}),e.jsxs(Ce,{children:[e.jsxs(de,{size:"lg",w:"85%",onClick:()=>i(!0),cursor:"pointer",children:[e.jsx(he,{src:"/rmp//images/guidaoTransit.jpg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(pe,{display:"block",width:"100%",children:[e.jsx(y,{fontSize:"lg",fontWeight:"bold",mb:1,children:s("header.about.guidaoTransit")}),e.jsx(y,{fontSize:"sm",children:s("header.about.guidaoTransitContent")})]})]}),e.jsxs(U,{size:"6xl",isOpen:n,onClose:()=>i(!1),children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:s("header.about.guidaoTransit")}),e.jsx(Z,{}),e.jsx(q,{paddingBottom:10,children:e.jsx(ft,{width:"1080",height:"304",src:"/rmp//images/guidaoTransitQRCode.png"})})]})]})]})]})]})]})},Bn=In,$n=()=>{const[t,o]=j.useState(!1),{svgViewBoxZoom:r}=se(n=>n.param),s=X(),a=[{type:"slider",label:"",value:400-r,min:10,max:390,step:1,onChange:n=>s(Tt(400-n)),leftIcon:e.jsx(bs,{}),rightIcon:e.jsx(bt,{}),minW:160}];return e.jsxs(Jt,{isOpen:t,onOpen:()=>o(!0),onClose:()=>o(!1),children:[e.jsx(Kt,{children:e.jsx(oe,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(bt,{}),onClick:()=>o(!t)})}),e.jsx(Yt,{children:e.jsx(Zt,{children:e.jsx(be,{fields:a,noLabel:!0})})})]})},Gn=t=>{const{isOpen:o,onClose:r}=t,s=X(),{t:a}=W(),n=j.useRef(window.graph),[i,c]=j.useState(0),[d,p]=j.useState(0),h=[{type:"input",label:a("header.settings.procedures.translate.x"),value:i.toString(),variant:"number",onChange:l=>c(Number(l)),minW:"full"},{type:"input",label:a("header.settings.procedures.translate.y"),value:d.toString(),variant:"number",onChange:l=>p(Number(l)),minW:"full"}],f=()=>{n.current.forEachNode((l,u)=>{n.current.updateNodeAttribute(l,"x",g=>(g!=null?g:0)+i),n.current.updateNodeAttribute(l,"y",g=>(g!=null?g:0)+d)}),s(ge()),s(fe()),s(ce(n.current.export())),r()};return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:a("header.settings.procedures.translate.title")}),e.jsx(Z,{}),e.jsxs(q,{children:[a("header.settings.procedures.translate.content"),e.jsx(be,{fields:h})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(R,{colorScheme:"red",onClick:f,children:a("apply")})]})]})]})},Ln=t=>{const{isOpen:o,onClose:r}=t,s=X(),{t:a}=W(),n=j.useRef(window.graph),[i,c]=j.useState(1),d=[{type:"input",label:a("header.settings.procedures.scale.factor"),value:i.toString(),variant:"number",onChange:h=>c(Number(h)),minW:"full"}],p=()=>{n.current.forEachNode((h,f)=>{n.current.updateNodeAttribute(h,"x",l=>(l!=null?l:0)*i),n.current.updateNodeAttribute(h,"y",l=>(l!=null?l:0)*i)}),s(ge()),s(fe()),s(ce(n.current.export())),r()};return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:a("header.settings.procedures.scale.title")}),e.jsx(Z,{}),e.jsxs(q,{children:[a("header.settings.procedures.scale.content"),e.jsx(be,{fields:d})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(R,{colorScheme:"red",onClick:p,children:a("apply")})]})]})]})},Dn=t=>{const{isOpen:o,onClose:r}=t,s=X(),{t:a}=W(),n=j.useRef(window.graph),i=Object.fromEntries(Object.entries(Re).map(([u,g])=>[u,a(g.metadata.displayName).toString()])),[c,d]=j.useState(Object.keys(Re).at(0)),[p,h]=j.useState(Object.keys(Re).at(1)),f=[{type:"select",label:a("header.settings.procedures.changeType.changeFrom"),value:c,options:i,disabledOptions:[p],onChange:u=>d(u),minW:"full"},{type:"select",label:a("header.settings.procedures.changeType.changeTo"),value:p,options:i,disabledOptions:[c],onChange:u=>h(u),minW:"full"}],l=()=>{Ls(n.current,c,p),s(ge()),s(ce(n.current.export())),r()};return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsxs(Y,{children:[e.jsx(y,{as:"b",fontSize:"xl",children:a("header.settings.procedures.changeType.title")}),e.jsx(_t,{label:a("header.settings.pro"),children:e.jsx(Ie,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(Z,{}),e.jsxs(q,{children:[e.jsx(be,{fields:f}),e.jsx(y,{fontSize:"sm",mt:"3",lineHeight:"100%",color:"red.500",children:a("header.settings.procedures.changeType.info")})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(R,{colorScheme:"red",onClick:l,children:a("apply")})]})]})]})},Fn=t=>{const{isOpen:o,onClose:r}=t,s=X(),{theme:a}=se(l=>l.runtime),{t:n}=W(),i=j.useRef(window.graph),[c,d]=j.useState(a),[p,h]=j.useState(!1),f=()=>{i.current.filterEdges((l,u,g,m,C,w,x)=>u.style===le.SingleColor&&JSON.stringify(u[le.SingleColor].color)===JSON.stringify(c)).forEach(l=>i.current.dropEdge(l)),s(fe()),s(ce(i.current.export())),r()};return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:n("header.settings.procedures.removeLines.title")}),e.jsx(Z,{}),e.jsxs(q,{children:[n("header.settings.procedures.removeLines.content"),e.jsx(ws,{theme:c,onClick:()=>h(!0)}),e.jsx(Cs,{isOpen:p,defaultTheme:c,onClose:()=>h(!1),onUpdate:l=>d(l)})]}),e.jsxs(me,{children:[e.jsx(R,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:n("cancel")}),e.jsx(R,{colorScheme:"red",onClick:f,children:n("remove")})]})]})]})},Me={width:"100%",justifyContent:"space-between"},je={fontFamily:"-apple-system"},Pn=t=>{const{isOpen:o,onClose:r}=t,{keepLastPath:s}=se(x=>x.runtime),a=X(),{t:n}=W(),i=kt("primary.500","primary.300"),[c,d]=j.useState(!1),[p,h]=j.useState(!1),[f,l]=j.useState(!1),[u,g]=j.useState(!1),m=D.isAllowAnalytics(),{telemetry:{app:C}}=se(x=>x.app),w=x=>a(As(x));return e.jsxs(U,{isOpen:o,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(K,{children:[e.jsx(Y,{children:n("header.settings.title")}),e.jsx(Z,{}),e.jsx(q,{children:e.jsxs(Ce,{divider:e.jsx(qt,{borderColor:"gray.200"}),children:[e.jsxs(B,{width:"100%",mb:"3",children:[e.jsx(y,{as:"b",fontSize:"xl",children:n("header.settings.preference.title")}),e.jsx(B,{mt:"3",children:e.jsxs(B,{display:"flex",mb:"1",children:[e.jsx(y,{flex:"1",children:n("header.settings.preference.keepLastPath")}),e.jsx(We,{isChecked:s,onChange:({target:{checked:x}})=>a(Ss(x))})]})})]}),e.jsxs(B,{width:"100%",mb:"3",children:[e.jsx(y,{as:"b",fontSize:"xl",children:n("header.settings.procedures.title")}),e.jsxs(B,{mt:"3",children:[e.jsx(R,{sx:Me,rightIcon:e.jsx(Te,{}),onClick:()=>d(!0),children:n("header.settings.procedures.translate.title")}),e.jsx(Gn,{isOpen:c,onClose:()=>d(!1)}),e.jsx(R,{sx:Me,rightIcon:e.jsx(Te,{}),onClick:()=>h(!0),children:n("header.settings.procedures.scale.title")}),e.jsx(Ln,{isOpen:p,onClose:()=>h(!1)}),e.jsx(R,{sx:Me,rightIcon:e.jsx(Te,{}),onClick:()=>l(!0),children:e.jsxs(B,{children:[n("header.settings.procedures.changeType.title"),e.jsx(_t,{label:n("header.settings.pro"),children:e.jsx(Ie,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]})}),e.jsx(Dn,{isOpen:f,onClose:()=>l(!1)}),e.jsx(R,{sx:Me,rightIcon:e.jsx(Te,{}),onClick:()=>g(!0),children:n("header.settings.procedures.removeLines.title")}),e.jsx(Fn,{isOpen:u,onClose:()=>g(!1)})]})]}),e.jsxs(B,{width:"100%",mb:"3",children:[e.jsx(y,{as:"b",fontSize:"xl",children:n("header.settings.shortcuts.title")}),e.jsx(B,{mt:"3",children:e.jsxs(Qt,{children:[e.jsx(Xt,{children:e.jsxs(ee,{children:[e.jsx(mt,{children:n("header.settings.shortcuts.keys")}),e.jsx(mt,{children:n("header.settings.shortcuts.description")})]})}),e.jsxs(es,{children:[e.jsxs(ee,{children:[e.jsx(N,{children:e.jsx(A,{children:"f"})}),e.jsx(N,{children:n("header.settings.shortcuts.f")})]}),e.jsxs(ee,{children:[e.jsx(N,{children:e.jsxs(B,{display:"flex",flexDirection:"row",children:[e.jsx(vs,{}),e.jsx(zs,{}),e.jsx(ks,{}),e.jsx(_s,{})]})}),e.jsx(N,{children:n("header.settings.shortcuts.arrows")})]}),e.jsxs(ee,{children:[e.jsx(N,{children:e.jsxs(B,{display:"flex",flexDirection:"row",children:[e.jsx(A,{children:"i"}),e.jsx(A,{children:"j"}),e.jsx(A,{children:"k"}),e.jsx(A,{children:"l"})]})}),e.jsx(N,{children:n("header.settings.shortcuts.ijkl")})]}),e.jsxs(ee,{children:[e.jsx(N,{children:we?e.jsx(A,{sx:je,children:"⇧"}):e.jsx(A,{children:"shift"})}),e.jsx(N,{children:n("header.settings.shortcuts.shift")})]}),e.jsxs(ee,{children:[e.jsx(N,{children:we?e.jsx(A,{sx:je,children:"⌥"}):e.jsx(A,{children:"alt"})}),e.jsx(N,{children:n("header.settings.shortcuts.alt")})]}),e.jsxs(ee,{children:[e.jsx(N,{children:we?e.jsx(A,{sx:je,children:"⌫"}):e.jsx(A,{children:"delete"})}),e.jsx(N,{children:n("header.settings.shortcuts.delete")})]}),e.jsxs(ee,{children:[e.jsxs(N,{children:[we?e.jsx(A,{sx:je,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"z"})]}),e.jsx(N,{children:n("header.settings.shortcuts.undo")})]}),e.jsxs(ee,{children:[e.jsx(N,{children:we?e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:je,children:"⇧"})," + ",e.jsx(A,{sx:je,children:"⌘"})," + ",e.jsx(A,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"y"})]})}),e.jsx(N,{children:n("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(B,{width:"100%",mb:"3",children:[e.jsx(y,{as:"b",fontSize:"xl",children:n("header.settings.telemetry.title")}),e.jsxs(B,{mt:"3",children:[e.jsxs(B,{display:"flex",mb:"1",children:[e.jsx(y,{flex:"1",children:n("header.settings.telemetry.essential")}),e.jsx(We,{isChecked:m,isDisabled:!0})]}),e.jsx(y,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:n("header.settings.telemetry.essentialInfo")}),e.jsxs(z,{color:i,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[n("header.settings.telemetry.essentialLink")," ",e.jsx(O,{as:_})]}),e.jsxs(B,{display:"flex",mb:"1",children:[e.jsx(y,{flex:"1",children:n("header.settings.telemetry.additional")}),e.jsx(We,{isChecked:C,onChange:({target:{checked:x}})=>w(x)})]}),e.jsx(y,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:n("header.settings.telemetry.additionalInfo")})]})]})]})})]})]})},Wn=Pn;function Vn(){const{t}=W(),o=X(),{telemetry:{app:r}}=se(l=>l.app),{past:s,future:a}=se(l=>l.param),[n,i]=j.useState(!1),[c,d]=j.useState(!1),p=St(D.getEnv),h=St(D.getAppVersion);j.useEffect(()=>{r&&p!==Ke.DEV&&D.event(Xe.APP_LOAD,{isStandaloneWindow:D.isStandaloneWindow()})},[p]);const f=async l=>{D.getI18nInstance().changeLanguage(l)};return e.jsxs(Os,{children:[e.jsx(ye,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t("header.about.rmp")}),e.jsx(Es,{environment:p,version:h,popoverHeader:p===Ke.PRD?void 0:e.jsxs(Ct,{i18nKey:"header.popoverHeader",environment:p,children:["You're on ",{environment:p}," environment!"]}),popoverBody:p===Ke.PRD?void 0:e.jsx(Ct,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(ts,{ml:"auto",children:[e.jsx(re,{children:e.jsx(oe,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(Ts,{}),disabled:s.length===0,onClick:()=>o(Ms())})}),e.jsx(re,{children:e.jsx(oe,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(Rs,{}),disabled:a.length===0,onClick:()=>o(Hs())})}),e.jsx(re,{children:e.jsx($n,{})}),e.jsx(re,{children:e.jsx(cn,{})}),e.jsx(re,{children:e.jsx(Mn,{})}),D.isStandaloneWindow()&&e.jsx(re,{children:e.jsxs(it,{children:[e.jsx(at,{as:oe,icon:e.jsx(Ns,{}),variant:"ghost",size:"sm"}),e.jsx(lt,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(l=>e.jsx(ie,{onClick:()=>f(l),children:Qs[l][l]},l))})]})}),e.jsx(re,{children:e.jsx(oe,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Is,{}),onClick:()=>i(!0)})}),e.jsx(re,{children:e.jsx(oe,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Bs,{}),onClick:()=>d(!0)})})]}),e.jsx(Wn,{isOpen:n,onClose:()=>i(!1)}),e.jsx(Bn,{isOpen:c,onClose:()=>d(!1)})]})}function Un(){const t=X(),o=se(s=>s.runtime.globalAlerts),r=s=>{D.isStandaloneWindow()?window.open(`/${s}`,"_blank"):D.openApp(s)};return e.jsx(e.Fragment,{children:Object.entries(o).map(([s,{message:a,url:n,linkedApp:i}])=>e.jsxs(ss,{status:s,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(ns,{}),i?e.jsx(z,{onClick:()=>r(i),children:a}):n?e.jsx(z,{href:n,target:"_blank",children:a}):a,e.jsx(zt,{ml:"auto",onClick:()=>t($s(s))})]},s))})}function Xn(){return e.jsxs(e.Fragment,{children:[e.jsx(Vn,{}),e.jsx(Un,{})]})}export{Xn as default};
