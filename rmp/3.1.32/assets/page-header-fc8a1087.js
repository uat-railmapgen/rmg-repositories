import{j as e,a8 as xs,Q as ns,a9 as _e,aa as $e,G as X,ab as Le,ac as te,k as Fe,$ as W,M as V,a0 as U,p as K,q as Y,r as q,ad as gs,g as ae,w as v,a7 as E,v as rs,ae as Ve,s as w,t as fe,af as fs,h as $,F as Ue,_ as Ke,B as R,ag as de,a1 as xe,ah as oe,ai as ie,aj as le,c as js,i as ys,e as bs,f as ws,ak as as,al as Cs,O as Ee,am as ks,an as Ss,ao as G,ap as Ye,aq as zs,ar as H,as as O,at as vs,au as Q,x as As,y as Os}from"./chakra-1e9eecfc.js";import{g as Es,r as I,b as j}from"./react-beb26faf.js";import{w as Ts,g as Ms,a as Te,b as os,I as Hs,u as Rs,r as B,n as qe,S as N,L as Me,l as Is,c as Se,R as is,d as L,e as D,s as ne,f as re,h as ee,i as ls,j as Ne,M as Je,k as Ps,m as Ze,o as cs,p as Ns,q as He,t as T,v as J,x as Bs,y as _s,z as $s,A as he,E as Be,B as Ls,C as Fs,D as Ds,F as Qe,G as Gs,T as Ws,H as Vs,J as Us,K as we,N as Ks,O as Ys,P as qs,Q as Js,U as Zs,V as Re,W as Qs,X as Xs,Y as et,Z as st,_ as tt,$ as nt,a0 as rt,a1 as at,a2 as ot,a3 as it}from"./index-02963650.js";import{s as ke}from"./stations-c673fc8a.js";import{c as lt,i as me}from"./helpers-2fcbe9c8.js";import{c as ct}from"./change-types-c5046636.js";var dt={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const ht=Es(dt);var pt=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function Xe(t){var a={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(a.name=n[1],(ht[n[1]]||t.charAt(t.length-2)==="/")&&(a.voidElement=!0),a.name.startsWith("!--"))){var r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}for(var o=new RegExp(pt),s=null;(s=o.exec(t))!==null;)if(s[0].trim())if(s[1]){var c=s[1].trim(),h=[c,""];c.indexOf("=")>-1&&(h=c.split("=")),a.attrs[h[0]]=h[1],o.lastIndex--}else s[2]&&(a.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return a}var ut=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,mt=/^\s*$/,xt=Object.create(null);function ds(t,a){switch(a.type){case"text":return t+a.content;case"tag":return t+="<"+a.name+(a.attrs?function(n){var r=[];for(var o in n)r.push(o+'="'+n[o]+'"');return r.length?" "+r.join(" "):""}(a.attrs):"")+(a.voidElement?"/>":">"),a.voidElement?t:t+a.children.reduce(ds,"")+"</"+a.name+">";case"comment":return t+"<!--"+a.comment+"-->"}}var gt={parse:function(t,a){a||(a={}),a.components||(a.components=xt);var n,r=[],o=[],s=-1,c=!1;if(t.indexOf("<")!==0){var h=t.indexOf("<");r.push({type:"text",content:h===-1?t:t.substring(0,h)})}return t.replace(ut,function(l,p){if(c){if(l!=="</"+n.name+">")return;c=!1}var i,m=l.charAt(1)!=="/",d=l.startsWith("<!--"),u=p+l.length,g=t.charAt(u);if(d){var k=Xe(l);return s<0?(r.push(k),r):((i=o[s]).children.push(k),r)}if(m&&(s++,(n=Xe(l)).type==="tag"&&a.components[n.name]&&(n.type="component",c=!0),n.voidElement||c||!g||g==="<"||n.children.push({type:"text",content:t.slice(u,t.indexOf("<",u))}),s===0&&r.push(n),(i=o[s-1])&&i.children.push(n),o[s]=n),(!m||n.voidElement)&&(s>-1&&(n.voidElement||n.name===l.slice(2,-1))&&(s--,n=s===-1?r:o[s]),!c&&g!=="<"&&g)){i=s===-1?r:o[s].children;var C=t.indexOf("<",u),y=t.slice(u,C===-1?void 0:C);mt.test(y)&&(y=" "),(C>-1&&s+i.length>=0||y!==" ")&&i.push({type:"text",content:y})}}),r},stringify:function(t){return t.reduce(function(a,n){return a+ds("",n)},"")}};function Ie(t,a){if(!t)return!1;const n=t.props?t.props.children:t.children;return a?n.length>0:!!n}function Pe(t){return t?t.props?t.props.children:t.children:[]}function ft(t){return Object.prototype.toString.call(t)!=="[object Array]"?!1:t.every(a=>I.isValidElement(a))}function ge(t){return Array.isArray(t)?t:[t]}function jt(t,a){const n={...a};return n.props=Object.assign(t.props,a.props),n}function hs(t,a){if(!t)return"";let n="";const r=ge(t),o=a.transSupportBasicHtmlNodes&&a.transKeepBasicHtmlNodesFor?a.transKeepBasicHtmlNodesFor:[];return r.forEach((s,c)=>{if(typeof s=="string")n+=`${s}`;else if(I.isValidElement(s)){const h=Object.keys(s.props).length,l=o.indexOf(s.type)>-1,p=s.props.children;if(!p&&l&&h===0)n+=`<${s.type}/>`;else if(!p&&(!l||h!==0))n+=`<${c}></${c}>`;else if(s.props.i18nIsDynamicList)n+=`<${c}></${c}>`;else if(l&&h===1&&typeof p=="string")n+=`<${s.type}>${p}</${s.type}>`;else{const i=hs(p,a);n+=`<${c}>${i}</${c}>`}}else if(s===null)Te("Trans: the passed in value is invalid - seems you passed in a null child.");else if(typeof s=="object"){const{format:h,...l}=s,p=Object.keys(l);if(p.length===1){const i=h?`${p[0]}, ${h}`:p[0];n+=`{{${i}}}`}else Te("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",s)}else Te("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",s)}),n}function yt(t,a,n,r,o,s){if(a==="")return[];const c=r.transKeepBasicHtmlNodesFor||[],h=a&&new RegExp(c.join("|")).test(a);if(!t&&!h)return[a];const l={};function p(C){ge(C).forEach(x=>{typeof x!="string"&&(Ie(x)?p(Pe(x)):typeof x=="object"&&!I.isValidElement(x)&&Object.assign(l,x))})}p(t);const i=gt.parse(`<0>${a}</0>`),m={...l,...o};function d(C,y,x){const M=Pe(C),F=g(M,y.children,x);return ft(M)&&F.length===0?M:F}function u(C,y,x,M,F){C.dummy&&(C.children=y),x.push(I.cloneElement(C,{...C.props,key:M},F?void 0:y))}function g(C,y,x){const M=ge(C);return ge(y).reduce((A,f,_)=>{const se=f.children&&f.children[0]&&f.children[0].content&&n.services.interpolator.interpolate(f.children[0].content,m,n.language);if(f.type==="tag"){let b=M[parseInt(f.name,10)];!b&&x.length===1&&x[0][f.name]&&(b=x[0][f.name]),b||(b={});const z=Object.keys(f.attrs).length!==0?jt({props:f.attrs},b):b,Z=I.isValidElement(z),je=Z&&Ie(f,!0)&&!f.voidElement,pe=h&&typeof z=="object"&&z.dummy&&!Z,ue=typeof t=="object"&&t!==null&&Object.hasOwnProperty.call(t,f.name);if(typeof z=="string"){const S=n.services.interpolator.interpolate(z,m,n.language);A.push(S)}else if(Ie(z)||je){const S=d(z,f,x);u(z,S,A,_)}else if(pe){const S=g(M,f.children,x);A.push(I.cloneElement(z,{...z.props,key:_},S))}else if(Number.isNaN(parseFloat(f.name)))if(ue){const S=d(z,f,x);u(z,S,A,_,f.voidElement)}else if(r.transSupportBasicHtmlNodes&&c.indexOf(f.name)>-1)if(f.voidElement)A.push(I.createElement(f.name,{key:`${f.name}-${_}`}));else{const S=g(M,f.children,x);A.push(I.createElement(f.name,{key:`${f.name}-${_}`},S))}else if(f.voidElement)A.push(`<${f.name} />`);else{const S=g(M,f.children,x);A.push(`<${f.name}>${S}</${f.name}>`)}else if(typeof z=="object"&&!Z){const S=f.children[0]?se:null;S&&A.push(S)}else f.children.length===1&&se?A.push(I.cloneElement(z,{...z.props,key:_},se)):A.push(I.cloneElement(z,{...z.props,key:_}))}else if(f.type==="text"){const b=r.transWrapTextNodes,z=s?r.unescape(n.services.interpolator.interpolate(f.content,m,n.language)):n.services.interpolator.interpolate(f.content,m,n.language);b?A.push(I.createElement(b,{key:`${f.name}-${_}`},z)):A.push(z)}return A},[])}const k=g([{dummy:!0,children:t||[]}],i,ge(t||[]));return Pe(k[0])}function bt(t){let{children:a,count:n,parent:r,i18nKey:o,context:s,tOptions:c={},values:h,defaults:l,components:p,ns:i,i18n:m,t:d,shouldUnescape:u,...g}=t;const k=m||os();if(!k)return Ts("You will need to pass in an i18next instance by using i18nextReactModule"),a;const C=d||k.t.bind(k)||(Z=>Z);s&&(c.context=s);const y={...Ms(),...k.options&&k.options.react};let x=i||C.ns||k.options&&k.options.defaultNS;x=typeof x=="string"?[x]:x||["translation"];const M=l||hs(a,y)||y.transEmptyNodeValue||o,{hashTransKey:F}=y,A=o||(F?F(M):M),f=h?c.interpolation:{interpolation:{...c.interpolation,prefix:"#$?",suffix:"?$#"}},_={...c,count:n,...h,...f,defaultValue:M,ns:x},se=A?C(A,_):M,b=yt(p||a,se,k,y,_,u),z=r!==void 0?r:y.defaultTransParent;return z?I.createElement(z,g,b):b}function es(t){let{children:a,count:n,parent:r,i18nKey:o,context:s,tOptions:c={},values:h,defaults:l,components:p,ns:i,i18n:m,t:d,shouldUnescape:u,...g}=t;const{i18n:k,defaultNS:C}=I.useContext(Hs)||{},y=m||k||os(),x=d||y&&y.t.bind(y);return bt({children:a,count:n,parent:r,i18nKey:o,context:s,tOptions:c,values:h,defaults:l,components:p,ns:i||x&&x.ns||C||y&&y.options&&y.options.defaultNS,i18n:y,t:d,shouldUnescape:u,...g})}var ss=function(t){return Rs(B.ready(),t)},wt={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Ct=(t,{info_panel_type:a,line_num:n,stn_list:r,style:o,theme:s})=>{const c=Object.fromEntries(Object.keys(r).filter(h=>!["linestart","lineend"].includes(h)).map(h=>[h,`stn_${qe(10)}`]));Object.entries(r).filter(([h,l])=>!["linestart","lineend"].includes(h)).forEach(([h,l])=>{const p=t.filterNodes((i,m)=>Object.values(N).includes(m.type)&&m[m.type].names[0]===l.name[0]);p.length!==0&&(c[h]=p[0])}),Object.entries(r).filter(([h,l])=>!["linestart","lineend"].includes(h)).filter(([h,l])=>t.filterNodes((p,i)=>Object.values(N).includes(i.type)&&i[i.type].names[0]===l.name[0]).length===0).forEach(([h,l],p)=>{let i=N.ShmetroBasic;const m=l.transfer.groups,d=m.map(g=>g.lines).flat();o==="shmetro"?d.length>0?i=N.ShmetroInt:a==="sh2020"?i=N.ShmetroBasic2020:i=N.ShmetroBasic:o==="gzmtr"?d.length>0?i=N.GzmtrInt:i=N.GzmtrBasic:o==="mtr"&&(i=N.MTR);const u={...structuredClone(ke[i].defaultAttrs),names:l.name};i===N.ShmetroBasic2020?u.color=s:i===N.GzmtrBasic?(u.color=s,u.lineCode=n,u.stationCode=l.num):i===N.GzmtrInt?u.transfer=m.map((g,k)=>{const C=g.lines.map(y=>{var x;return[...(x=y.theme)!=null?x:s,"1","01"]});return k===0?[[...s,n,l.num],...C]:C}):i===N.MTR&&(m[0].lines.length?u.transfer=[[[...s,"",""],...m[0].lines.map(g=>{var k;return[...(k=g.theme)!=null?k:s,"",""]})]]:u.transfer=[[]]),t.addNode(c[h],{visible:!0,zIndex:0,x:100+p*50,y:1e3,type:i,[i]:u})}),Object.entries(r).filter(([h,l])=>!["linestart","lineend"].includes(h)).forEach(([h,l])=>{l.children.filter(p=>!["linestart","lineend"].includes(p)).forEach(p=>{t.addDirectedEdgeWithKey(`line_${qe(10)}`,c[h],c[p],{visible:!0,zIndex:0,type:Me.Diagonal,[Me.Diagonal]:structuredClone(Is[Me.Diagonal].defaultAttrs),style:Se.SingleColor,[Se.SingleColor]:{color:s},reconcileId:""})})})},kt="rmg-bridge--",St={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function zt(t){const{isOpen:a,onClose:n,onImport:r}=t,[o]=I.useState(crypto.randomUUID()),s="/rmg/#/import?"+new URLSearchParams({parentComponent:B.getAppName(),parentId:o});return I.useEffect(()=>{const c=new BroadcastChannel(kt+o);return c.onmessage=h=>{const{event:l,data:p}=h.data;console.log("[rmp] Received event from RMG app clip:",l),l==="CLOSE"?n():l==="IMPORT"&&r(p)},()=>{c.close()}},[]),e.jsx(is,{isOpen:a,onClose:n,sx:St,children:e.jsx("iframe",{src:s,loading:"lazy"})})}const vt="RMP_GALLERY_CHANNEL",At="OPEN_TEMPLATE",Ot=new BroadcastChannel(vt),Et={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"}};function Tt(t){const{isOpen:a,onClose:n}=t,r=xs(),{t:o}=L(),s=D(),c=j.useRef(window.graph),h=j.useCallback(()=>{s(ne()),s(re()),s(ee(c.current.export()))},[s,ne,re,ee,c]),l=async i=>{const{version:m,...d}=JSON.parse(await ls(JSON.stringify(i)));s(Ne()),c.current.clear(),c.current.import(d.graph),h()},p=async i=>{var d;const m=await((d=(await Promise.allSettled([fetch(`/rmp-gallery/resources/real_world/${i}.json`),fetch(`/rmp-gallery/resources/fantasy/${i}.json`)])).filter(u=>u.status==="fulfilled").find(u=>u.value.status===200))==null?void 0:d.value.json());m?(l(m),r({title:o("header.open.importFromRMPGallery",{id:i}),status:"success",duration:9e3,isClosable:!0})):r({title:o("header.open.failToImportFromRMPGallery",{id:i}),status:"error",duration:9e3,isClosable:!0})};return j.useEffect(()=>{const i=window.location.href;if(i.includes("/s/")){history.replaceState({},o("about.rmp"),i.substring(0,i.indexOf("s/")));const m=i.substring(i.lastIndexOf("s/")+2);p(m)}},[]),j.useEffect(()=>{Ot.onmessage=i=>{const{event:m,data:d}=i.data;m===At&&(p(d),n())}},[]),e.jsx(e.Fragment,{children:e.jsxs(is,{isOpen:a,onClose:n,size:"full",sx:Et,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(ns,{onClick:n,position:"fixed",top:"5px",right:"15px"})]})})}function Mt(){const{t}=L(),a=D(),n=j.useRef(window.graph),r=j.useRef(null),[o,s]=j.useState(!1),[c,h]=j.useState(!1),l=j.useCallback(()=>{a(ne()),a(re()),a(ee(n.current.export()))},[a,ne,re,ee,n]),p=()=>{a(Ne()),n.current.clear(),a(cs(100)),a(Ns({x:0,y:0})),l()},i=d=>{try{Ct(n.current,d),l()}catch(u){a(He({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",u)}finally{s(!1)}},m=async d=>{var g;const u=(g=d.target.files)==null?void 0:g[0];if(console.log("OpenActions.handleUpload():: received file",u),(u==null?void 0:u.type)!=="application/json")a(He({status:"error",message:t("OpenActions.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const k=await Ht(u),{version:C,...y}=JSON.parse(await ls(k));a(Ne()),n.current.clear(),n.current.import(y.graph),l()}catch(k){a(He({status:"error",message:t("OpenActions.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",k)}d.target.value=""};return e.jsxs(_e,{children:[e.jsx($e,{as:X,size:"sm",variant:"ghost",icon:e.jsx(Je,{})}),e.jsxs(Le,{children:[e.jsx(te,{icon:e.jsx(Ps,{}),onClick:p,children:t("header.open.new")}),e.jsx("input",{id:"upload_project",ref:r,type:"file",accept:".json",hidden:!0,onChange:m,"data-testid":"file-upload"}),e.jsx(te,{icon:e.jsx(Je,{}),onClick:()=>{var d;return(d=r==null?void 0:r.current)==null?void 0:d.click()},children:t("header.open.config")}),e.jsx(te,{icon:e.jsx(Ze,{}),onClick:()=>s(!0),children:t("header.open.projectRMG")}),e.jsxs(te,{icon:e.jsx(Ze,{}),onClick:()=>h(!0),children:[t("header.open.gallery"),e.jsx(Fe,{ml:"1",colorScheme:"green",children:"New"})]})]}),e.jsx(zt,{isOpen:o,onClose:()=>s(!1),onImport:i}),e.jsx(Tt,{isOpen:c,onClose:()=>h(!1)})]})}const Ht=t=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsText(t)}),Rt=()=>navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),It=t=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsDataURL(t)}),Pt=(t,a)=>t.find(n=>{const r=n.style;return r.getPropertyValue("font-family").replace(/^"(.+)"$/,"$1")===a.family&&r.getPropertyValue("unicode-range")===a.unicodeRange}),Nt=async t=>{var c,h;const a=Array.from(new Set([...t.querySelectorAll(".rmp-name__mtr__zh"),...t.querySelectorAll(".rmp-name__mtr__en")].map(l=>l.innerHTML).join("").replace(/\s/g,""))).join(""),n=await document.fonts.load("80px GenYoMin TW, Vegur",a),r=(h=(c=document.querySelector("link#fonts_mtr"))==null?void 0:c.sheet)==null?void 0:h.cssRules;if(!r)return Promise.reject(new Error("cssRules can not be found in link#css_share"));const o=Array.from(r).filter(l=>l instanceof CSSFontFaceRule),s=n.reduce((l,p)=>{const i=Pt(o,p);return i?l.find(d=>{const u=d.style,g=i.style;return u.getPropertyValue("font-family")===g.getPropertyValue("font-family")&&u.getPropertyValue("unicode-range")===g.getPropertyValue("unicode-range")})?l:l.concat(i):l},[]);return await Promise.all(s.map(async l=>{try{const p=await fetch(Bt(l)),i=await It(await p.blob());return l.cssText.replace(/src:[ \w('",\-:/.)]+;/g,`src: url('${i}'); `)}catch(p){return console.error(p),""}}))},Bt=t=>{var n;const a=t.style.src;return Rt()?a.replace(/^url\("(\S+)"\).*$/,"$1"):"/rmp//styles/"+((n=a.match(/^url\("([\S*]+)"\)/))==null?void 0:n[1])},_t=t=>{const{isOpen:a,onClose:n}=t,{t:r}=L();return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:r("header.download.termsAndConditions")}),e.jsx(Y,{}),e.jsx(q,{children:e.jsxs(gs,{children:[e.jsxs(ae,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(v,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(E,{as:T})]}),", ",e.jsxs(v,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(E,{as:T})]})," or ",e.jsxs(v,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(E,{as:T})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(v,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(E,{as:T})]}),"，",e.jsxs(v,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(E,{as:T})]}),"或",e.jsxs(v,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(E,{as:T})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(ae,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(v,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(E,{as:T})]})," and ",e.jsxs(v,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(E,{as:T})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(v,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(E,{as:T})]}),"及",e.jsxs(v,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(E,{as:T})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(ae,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(v,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(E,{as:T})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(v,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(E,{as:T})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(ae,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(ae,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(v,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(E,{as:T})]})," ","– the open-source emoji and icon project. License:",e.jsxs(v,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(E,{as:T})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(v,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(E,{as:T})]}),"所设计。许可证：",e.jsxs(v,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(E,{as:T})]})]}),e.jsxs(ae,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},$t=_t;function Lt(){const{t}=L(),{telemetry:{project:a}}=J(b=>b.app),{nodeExists:n}=J(b=>b.runtime),r=j.useRef(window.graph),o=rs("white","gray.800"),[s,c]=j.useState("png"),h={png:t("header.download.png"),svg:t("header.download.svg")},[l,p]=j.useState(100),i=Object.fromEntries([25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500].map(b=>[b,`${b}%`])),[m,d]=j.useState(!1),u=[{type:"select",label:t("header.download.format"),value:s,options:h,onChange:b=>c(b==="png"?"png":"svg")}],g=[{type:"select",label:t("header.download.scale"),value:l,options:i,onChange:b=>p(b)},{type:"switch",label:t("header.download.transparent"),isChecked:m,onChange:d}],[k,C]=j.useState(!1),[y,x]=j.useState(!1),[M,F]=j.useState(!1),[A,f]=j.useState(!1),_=()=>{a&&B.event(Be.DOWNLOAD_PARAM,{"#nodes":r.current.order,"#edges":r.current.size});const b=Ls(Fs.getState().param);ts(`RMP_${new Date().valueOf()}.json`,"application/json",b)},se=async()=>{C(!1),a&&B.event(Be.DOWNLOAD_IMAGES,{numberOfNodes:r.current.order,numberOfEdges:r.current.size});const{xMin:b,yMin:z,xMax:Z,yMax:je}=lt(r.current),[pe,ue]=[Z-b,je-z],S=document.getElementById("canvas").cloneNode(!0);if([...S.children].filter(P=>r.current.hasNode(P.id)&&r.current.getNodeAttribute(P.id,"type")===Ds.Virtual).forEach(P=>S.removeChild(P)),M||S.appendChild(Ft(Z-400,je-60)),S.setAttribute("viewBox",`${b} ${z} ${pe} ${ue}`),S.setAttribute("width",pe.toString()),S.setAttribute("height",ue.toString()),Object.entries({".rmp-name__zh":["font-family"],".rmp-name__en":["font-family"],".rmp-name__mtr__zh":["font-family"],".rmp-name__mtr__en":["font-family"],".rmp-name-station":["paint-order","stroke","stroke-width"]}).forEach(([P,be])=>{const De=document.querySelector(P);if(De===null)return;const ms=window.getComputedStyle(De);S.querySelectorAll(P).forEach(Ge=>{be.forEach(We=>{Ge.setAttribute(We,ms.getPropertyValue(We))}),Ge.classList.remove(P)})}),n[N.MTR])try{const P=await Nt(S),be=document.createElement("style");be.textContent=P.join(`
`),S.prepend(be)}catch(P){alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(P)}if(s==="svg"){ts(`RMP_${new Date().valueOf()}.svg`,"image/svg+xml",S.outerHTML);return}document.body.appendChild(S);const us="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(S.outerHTML)));document.body.removeChild(S);const ye=document.createElement("canvas"),[ze,ve]=[pe*l/100,ue*l/100];ye.width=ze,ye.height=ve;const Ae=ye.getContext("2d");m||(Ae.fillStyle=o,Ae.fillRect(0,0,ze,ve));const Oe=new Image;Oe.onload=()=>{Ae.drawImage(Oe,0,0,ze,ve),ye.toBlob(P=>ps(`RMP_${new Date().valueOf()}.png`,P),"image/png")},Oe.src=us};return e.jsxs(_e,{id:"download",children:[e.jsx($e,{as:X,size:"sm",variant:"ghost",icon:e.jsx(Bs,{})}),e.jsxs(Le,{children:[e.jsx(te,{icon:e.jsx(_s,{}),onClick:_,children:t("header.download.config")}),e.jsx(te,{icon:e.jsx($s,{}),onClick:()=>C(!0),children:t("header.download.image")})]}),e.jsxs(W,{size:"xl",isOpen:k,onClose:()=>C(!1),children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:t("header.download.image")}),e.jsx(Y,{}),e.jsxs(q,{children:[e.jsx(he,{fields:u}),s==="png"&&e.jsx(he,{fields:g}),e.jsx("br",{}),e.jsx(Ve,{isChecked:M,onChange:b=>F(b.target.checked),children:e.jsxs(w,{children:[t("header.download.shareInfo1"),e.jsxs(v,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(E,{as:T})]}),t("header.download.shareInfo2")]})}),e.jsx(Ve,{isChecked:A,onChange:b=>f(b.target.checked),children:e.jsxs(w,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(v,{color:"teal.500",onClick:()=>x(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(E,{as:T})]}),t("header.download.period")]})})]}),e.jsx(fe,{children:e.jsx(fs,{children:e.jsx($,{colorScheme:"teal",variant:"outline",size:"sm",disabled:!A,onClick:se,children:t("header.download.confirm")})})}),e.jsx($t,{isOpen:y,onClose:()=>x(!1)})]})]})]})}const ts=(t,a,n)=>{const r=new Blob([n],{type:a});ps(t,r)},ps=(t,a)=>{const n=window.URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)},Ft=(t,a)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("transform",`translate(${t}, ${a})scale(2)`);const r=document.createElementNS("http://www.w3.org/2000/svg","image");r.setAttribute("width","40"),r.setAttribute("height","40"),r.setAttribute("x","-50"),r.setAttribute("y","-20");const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("font-family","Arial, sans-serif"),o.setAttribute("font-size","16"),o.appendChild(document.createTextNode("Rail Map Painter"));const s=document.createElementNS("http://www.w3.org/2000/svg","text");return s.setAttribute("font-family","Arial, sans-serif"),s.setAttribute("font-size","10"),s.setAttribute("y","10"),s.appendChild(document.createTextNode("https://railmapgen.github.io/rmp/")),n.appendChild(r),n.appendChild(o),n.appendChild(s),n},Dt="/rmp/assets/github-mark-7a0dd11e.svg",Gt="/rmp/assets/slack-mark-19839006.svg",Wt=t=>{const{isOpen:a,onClose:n}=t,{t:r}=L(),o=B.getAppVersion(),[s,c]=j.useState(!1);return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:r("header.about.title")}),e.jsx(Y,{}),e.jsxs(q,{paddingBottom:10,children:[e.jsxs(Ue,{direction:"row",children:[e.jsx(Ke,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(Ue,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(w,{fontSize:"xl",as:"b",children:r("header.about.rmp")}),e.jsx(w,{children:o}),e.jsx(w,{}),e.jsx(w,{fontSize:"sm",children:r("header.about.railmapgen")})]})]}),e.jsx(R,{margin:5,children:e.jsx(w,{fontSize:"xl",children:r("header.about.desc")})}),e.jsx(de,{as:"h5",size:"sm",mt:3,mb:2,children:r("header.about.contributors")}),e.jsx(de,{as:"h6",size:"xs",my:2,children:r("header.about.coreContributors")}),e.jsx(xe,{children:e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(w,{fontSize:"sm",children:r("header.about.content1")}),e.jsx(w,{fontSize:"sm",align:"right",mb:1,children:r("header.about.content2")})]})]})}),e.jsx(de,{as:"h6",size:"xs",my:2,children:r("header.about.styleContributors")}),e.jsxs(xe,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(w,{fontSize:"sm",mb:1,children:r("header.about.203IhzElttil")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/52PD","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/52PD.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:"52PD"}),e.jsx(w,{fontSize:"sm",mb:1,children:r("header.about.52PD")})]})]})]}),e.jsx(de,{as:"h5",size:"sm",mt:3,mb:2,children:r("header.about.contactUs")}),e.jsxs(xe,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:Dt,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:r("header.about.github")}),e.jsx(w,{fontSize:"sm",children:r("header.about.githubContent")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:Gt,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:r("header.about.slack")}),e.jsx(w,{fontSize:"sm",children:r("header.about.slackContent")}),e.jsx(w,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(de,{as:"h5",size:"sm",mt:3,mb:2,children:r("header.about.linkExchange")}),e.jsxs(xe,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>c(!0),cursor:"pointer",children:[e.jsx(ie,{src:"/rmp//images/guidaoTransit.jpg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(w,{fontSize:"lg",fontWeight:"bold",mb:1,children:r("header.about.guidaoTransit")}),e.jsx(w,{fontSize:"sm",children:r("header.about.guidaoTransitContent")})]})]}),e.jsxs(W,{size:"6xl",isOpen:s,onClose:()=>c(!1),children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:r("header.about.guidaoTransit")}),e.jsx(Y,{}),e.jsx(q,{paddingBottom:10,children:e.jsx(Ke,{width:"1080",height:"304",src:"/rmp//images/guidaoTransitQRCode.png"})})]})]})]})]})]})]})},Vt=Wt,Ut=()=>{const[t,a]=j.useState(!1),{svgViewBoxZoom:n}=J(s=>s.param),r=D(),o=[{type:"slider",label:"",value:400-n,min:10,max:390,step:1,onChange:s=>r(cs(400-s)),leftIcon:e.jsx(Gs,{}),rightIcon:e.jsx(Qe,{}),minW:160}];return e.jsxs(js,{isOpen:t,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(ys,{children:e.jsx(X,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Qe,{}),onClick:()=>a(!t)})}),e.jsx(bs,{children:e.jsx(ws,{children:e.jsx(he,{fields:o,noLabel:!0})})})]})},Kt=t=>{const{isOpen:a,onClose:n}=t,r=D(),{t:o}=L(),s=j.useRef(window.graph),[c,h]=j.useState(0),[l,p]=j.useState(0),i=[{type:"input",label:o("header.settings.procedures.translate.x"),value:c.toString(),variant:"number",onChange:d=>h(Number(d)),minW:"full"},{type:"input",label:o("header.settings.procedures.translate.y"),value:l.toString(),variant:"number",onChange:d=>p(Number(d)),minW:"full"}],m=()=>{s.current.forEachNode((d,u)=>{s.current.updateNodeAttribute(d,"x",g=>(g!=null?g:0)+c),s.current.updateNodeAttribute(d,"y",g=>(g!=null?g:0)+l)}),r(ne()),r(re()),r(ee(s.current.export())),n()};return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:o("header.settings.procedures.translate.title")}),e.jsx(Y,{}),e.jsxs(q,{children:[o("header.settings.procedures.translate.content"),e.jsx(he,{fields:i})]}),e.jsxs(fe,{children:[e.jsx($,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),e.jsx($,{colorScheme:"red",onClick:m,children:o("apply")})]})]})]})},Yt=t=>{const{isOpen:a,onClose:n}=t,r=D(),{t:o}=L(),s=j.useRef(window.graph),[c,h]=j.useState(1),l=[{type:"input",label:o("header.settings.procedures.scale.factor"),value:c.toString(),variant:"number",onChange:i=>h(Number(i)),minW:"full"}],p=()=>{s.current.forEachNode((i,m)=>{s.current.updateNodeAttribute(i,"x",d=>(d!=null?d:0)*c),s.current.updateNodeAttribute(i,"y",d=>(d!=null?d:0)*c)}),r(ne()),r(re()),r(ee(s.current.export())),n()};return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:o("header.settings.procedures.scale.title")}),e.jsx(Y,{}),e.jsxs(q,{children:[o("header.settings.procedures.scale.content"),e.jsx(he,{fields:l})]}),e.jsxs(fe,{children:[e.jsx($,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),e.jsx($,{colorScheme:"red",onClick:p,children:o("apply")})]})]})]})},qt=t=>{const{isOpen:a,onClose:n}=t,r=D(),{t:o}=L(),s=j.useRef(window.graph),c=Object.fromEntries(Object.entries(ke).map(([u,g])=>[u,o(g.metadata.displayName).toString()])),[h,l]=j.useState(Object.keys(ke).at(0)),[p,i]=j.useState(Object.keys(ke).at(1)),m=[{type:"select",label:o("header.settings.procedures.changeType.changeFrom"),value:h,options:c,disabledOptions:[p],onChange:u=>l(u),minW:"full"},{type:"select",label:o("header.settings.procedures.changeType.changeTo"),value:p,options:c,disabledOptions:[h],onChange:u=>i(u),minW:"full"}],d=()=>{ct(s.current,h,p),r(ne()),r(ee(s.current.export())),n()};return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsxs(K,{children:[e.jsx(w,{as:"b",fontSize:"xl",children:o("header.settings.procedures.changeType.title")}),e.jsx(as,{label:o("header.settings.pro"),children:e.jsx(Fe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(Y,{}),e.jsxs(q,{children:[e.jsx(he,{fields:m}),e.jsx(w,{fontSize:"sm",mt:"3",lineHeight:"100%",color:"red.500",children:o("header.settings.procedures.changeType.info")})]}),e.jsxs(fe,{children:[e.jsx($,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),e.jsx($,{colorScheme:"red",onClick:d,children:o("apply")})]})]})]})},Jt=t=>{const{isOpen:a,onClose:n}=t,r=D(),{theme:o}=J(d=>d.runtime),{t:s}=L(),c=j.useRef(window.graph),[h,l]=j.useState(o),[p,i]=j.useState(!1),m=()=>{c.current.filterEdges((d,u,g,k,C,y,x)=>u.style===Se.SingleColor&&JSON.stringify(u[Se.SingleColor].color)===JSON.stringify(h)).forEach(d=>c.current.dropEdge(d)),r(re()),r(ee(c.current.export())),n()};return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:s("header.settings.procedures.removeLines.title")}),e.jsx(Y,{}),e.jsxs(q,{children:[s("header.settings.procedures.removeLines.content"),e.jsx(Ws,{theme:h,onClick:()=>i(!0)}),e.jsx(Vs,{isOpen:p,defaultTheme:h,onClose:()=>i(!1),onUpdate:d=>l(d)})]}),e.jsxs(fe,{children:[e.jsx($,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:s("cancel")}),e.jsx($,{colorScheme:"red",onClick:m,children:s("remove")})]})]})]})},Ce={width:"100%",justifyContent:"space-between"},ce={fontFamily:"-apple-system"},Zt=t=>{const{isOpen:a,onClose:n}=t,{keepLastPath:r}=J(x=>x.runtime),o=D(),{t:s}=L(),c=rs("primary.500","primary.300"),[h,l]=j.useState(!1),[p,i]=j.useState(!1),[m,d]=j.useState(!1),[u,g]=j.useState(!1),k=B.isAllowAnalytics(),{telemetry:{app:C}}=J(x=>x.app),y=x=>o(Zs(x));return e.jsxs(W,{isOpen:a,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(V,{}),e.jsxs(U,{children:[e.jsx(K,{children:s("header.settings.title")}),e.jsx(Y,{}),e.jsx(q,{children:e.jsxs(xe,{divider:e.jsx(Cs,{borderColor:"gray.200"}),children:[e.jsxs(R,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:s("header.settings.preference.title")}),e.jsx(R,{mt:"3",children:e.jsxs(R,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:s("header.settings.preference.keepLastPath")}),e.jsx(Ee,{isChecked:r,onChange:({target:{checked:x}})=>o(Us(x))})]})})]}),e.jsxs(R,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:s("header.settings.procedures.title")}),e.jsxs(R,{mt:"3",children:[e.jsx($,{sx:Ce,rightIcon:e.jsx(we,{}),onClick:()=>l(!0),children:s("header.settings.procedures.translate.title")}),e.jsx(Kt,{isOpen:h,onClose:()=>l(!1)}),e.jsx($,{sx:Ce,rightIcon:e.jsx(we,{}),onClick:()=>i(!0),children:s("header.settings.procedures.scale.title")}),e.jsx(Yt,{isOpen:p,onClose:()=>i(!1)}),e.jsx($,{sx:Ce,rightIcon:e.jsx(we,{}),onClick:()=>d(!0),children:e.jsxs(R,{children:[s("header.settings.procedures.changeType.title"),e.jsx(as,{label:s("header.settings.pro"),children:e.jsx(Fe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]})}),e.jsx(qt,{isOpen:m,onClose:()=>d(!1)}),e.jsx($,{sx:Ce,rightIcon:e.jsx(we,{}),onClick:()=>g(!0),children:s("header.settings.procedures.removeLines.title")}),e.jsx(Jt,{isOpen:u,onClose:()=>g(!1)})]})]}),e.jsxs(R,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:s("header.settings.shortcuts.title")}),e.jsx(R,{mt:"3",children:e.jsxs(ks,{children:[e.jsx(Ss,{children:e.jsxs(G,{children:[e.jsx(Ye,{children:s("header.settings.shortcuts.keys")}),e.jsx(Ye,{children:s("header.settings.shortcuts.description")})]})}),e.jsxs(zs,{children:[e.jsxs(G,{children:[e.jsx(H,{children:e.jsx(O,{children:"f"})}),e.jsx(H,{children:s("header.settings.shortcuts.f")})]}),e.jsxs(G,{children:[e.jsx(H,{children:e.jsxs(R,{display:"flex",flexDirection:"row",children:[e.jsx(Ks,{}),e.jsx(Ys,{}),e.jsx(qs,{}),e.jsx(Js,{})]})}),e.jsx(H,{children:s("header.settings.shortcuts.arrows")})]}),e.jsxs(G,{children:[e.jsx(H,{children:e.jsxs(R,{display:"flex",flexDirection:"row",children:[e.jsx(O,{children:"i"}),e.jsx(O,{children:"j"}),e.jsx(O,{children:"k"}),e.jsx(O,{children:"l"})]})}),e.jsx(H,{children:s("header.settings.shortcuts.ijkl")})]}),e.jsxs(G,{children:[e.jsx(H,{children:me?e.jsx(O,{sx:ce,children:"⇧"}):e.jsx(O,{children:"shift"})}),e.jsx(H,{children:s("header.settings.shortcuts.shift")})]}),e.jsxs(G,{children:[e.jsx(H,{children:me?e.jsx(O,{sx:ce,children:"⌥"}):e.jsx(O,{children:"alt"})}),e.jsx(H,{children:s("header.settings.shortcuts.alt")})]}),e.jsxs(G,{children:[e.jsx(H,{children:me?e.jsx(O,{sx:ce,children:"⌫"}):e.jsx(O,{children:"delete"})}),e.jsx(H,{children:s("header.settings.shortcuts.delete")})]}),e.jsxs(G,{children:[e.jsxs(H,{children:[me?e.jsx(O,{sx:ce,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"z"})]}),e.jsx(H,{children:s("header.settings.shortcuts.undo")})]}),e.jsxs(G,{children:[e.jsx(H,{children:me?e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:ce,children:"⇧"})," + ",e.jsx(O,{sx:ce,children:"⌘"})," + ",e.jsx(O,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"y"})]})}),e.jsx(H,{children:s("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(R,{width:"100%",mb:"3",children:[e.jsx(w,{as:"b",fontSize:"xl",children:s("header.settings.telemetry.title")}),e.jsxs(R,{mt:"3",children:[e.jsxs(R,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:s("header.settings.telemetry.essential")}),e.jsx(Ee,{isChecked:k,isDisabled:!0})]}),e.jsx(w,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:s("header.settings.telemetry.essentialInfo")}),e.jsxs(v,{color:c,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[s("header.settings.telemetry.essentialLink")," ",e.jsx(E,{as:T})]}),e.jsxs(R,{display:"flex",mb:"1",children:[e.jsx(w,{flex:"1",children:s("header.settings.telemetry.additional")}),e.jsx(Ee,{isChecked:C,onChange:({target:{checked:x}})=>y(x)})]}),e.jsx(w,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:s("header.settings.telemetry.additionalInfo")})]})]})]})})]})]})},Qt=Zt;function Xt(){const{t}=L(),a=D(),{telemetry:{app:n}}=J(d=>d.app),{past:r,future:o}=J(d=>d.param),[s,c]=j.useState(!1),[h,l]=j.useState(!1),p=ss(B.getEnv),i=ss(B.getAppVersion);j.useEffect(()=>{n&&p!==Re.DEV&&B.event(Be.APP_LOAD,{isStandaloneWindow:B.isStandaloneWindow()})},[p]);const m=async d=>{B.getI18nInstance().changeLanguage(d)};return e.jsxs(Qs,{children:[e.jsx(de,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t("header.about.rmp")}),e.jsx(Xs,{environment:p,version:i,popoverHeader:p===Re.PRD?void 0:e.jsxs(es,{i18nKey:"header.popoverHeader",environment:p,children:["You're on ",{environment:p}," environment!"]}),popoverBody:p===Re.PRD?void 0:e.jsx(es,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(vs,{ml:"auto",children:[e.jsx(Q,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(et,{}),disabled:r.length===0,onClick:()=>a(st())})}),e.jsx(Q,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(tt,{}),disabled:o.length===0,onClick:()=>a(nt())})}),e.jsx(Q,{children:e.jsx(Ut,{})}),e.jsx(Q,{children:e.jsx(Mt,{})}),e.jsx(Q,{children:e.jsx(Lt,{})}),B.isStandaloneWindow()&&e.jsx(Q,{children:e.jsxs(_e,{children:[e.jsx($e,{as:X,icon:e.jsx(rt,{}),variant:"ghost",size:"sm"}),e.jsx(Le,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(d=>e.jsx(te,{onClick:()=>m(d),children:wt[d][d]},d))})]})}),e.jsx(Q,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(at,{}),onClick:()=>c(!0)})}),e.jsx(Q,{children:e.jsx(X,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(ot,{}),onClick:()=>l(!0)})})]}),e.jsx(Qt,{isOpen:s,onClose:()=>c(!1)}),e.jsx(Vt,{isOpen:h,onClose:()=>l(!1)})]})}function en(){const t=D(),a=J(r=>r.runtime.globalAlerts),n=r=>{B.isStandaloneWindow()?window.open(`/${r}`,"_blank"):B.openApp(r)};return e.jsx(e.Fragment,{children:Object.entries(a).map(([r,{message:o,url:s,linkedApp:c}])=>e.jsxs(As,{status:r,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(Os,{}),c?e.jsx(v,{onClick:()=>n(c),children:o}):s?e.jsx(v,{href:s,target:"_blank",children:o}):o,e.jsx(ns,{ml:"auto",onClick:()=>t(it(r))})]},r))})}function ln(){return e.jsxs(e.Fragment,{children:[e.jsx(Xt,{}),e.jsx(en,{})]})}export{ln as default};
