import{j as e,A as q,M as K,m as Z,n as J,p as Q,r as U,s as O,_ as z,$ as I,ad as te}from"./chakra-c00f698a.js";import{c as L,i as P,x as T,z as j,j as w,ah as F,ai as H,y as v,q as X,K as W,p as ne,t as se,B as k,ag as $,n as ae,aj as re,ak as ie,al as oe,am as le,o as G}from"./index-4a5e17e7.js";import{s as Y,R as D}from"./stations-2c177b84.js";import{b as d}from"./react-2c0b8364.js";import{m as ce}from"./misc-nodes-9d067bc9.js";import{d as de,e as ue,f as pe}from"./change-types-ddac06f2.js";import{u as V}from"./useEvent-92f02ca1.js";function he(){const{t:a}=L(),s=P(),t=d.useCallback(()=>{s(T()),s(j(i.current.export()))},[s,T,j]),{selected:u}=w(o=>o.runtime),n=u.at(0),i=d.useRef(window.graph),[p,b]=d.useState(!1),m=d.useRef(null),[y,g]=d.useState(void 0),x=i.current.getNodeAttribute(n,"type"),h=Object.fromEntries(Object.entries(Y).map(([o,r])=>[o,a(r.metadata.displayName).toString()])),N=()=>{y&&(de(i.current,n,y),t())},c=o=>{o&&N(),g(void 0),b(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:a("panel.details.info.stationType"),minW:"276",children:e.jsx(H,{options:h,disabledOptions:[x],value:x,onChange:({target:{value:o}})=>{g(o),b(!0)}})}),e.jsx(q,{isOpen:p,leastDestructiveRef:m,onClose:()=>c(!1),children:e.jsx(K,{children:e.jsxs(Z,{children:[e.jsx(J,{children:a("warning")}),e.jsx(Q,{children:a("panel.details.changeStationTypeContent")}),e.jsxs(U,{children:[e.jsx(O,{ref:m,onClick:()=>c(!1),children:a("cancel")}),e.jsx(O,{ml:"2",colorScheme:"red",onClick:()=>c(!0),children:a("panel.details.changeType")})]})]})})})]})}function ge(){const{t:a}=L(),s=P(),t=d.useCallback(()=>{s(v()),s(j(p.current.export()))},[s,v,j]),{selected:u,theme:n}=w(f=>f.runtime),i=u.at(0),p=d.useRef(window.graph),[b,m]=d.useState(!1),y=d.useRef(null),g=Object.fromEntries(Object.entries(X).map(([f,_])=>[f,a(_.metadata.displayName).toString()])),[x,h]=d.useState(p.current.getEdgeAttribute(i,"type")),[N,c]=d.useState(void 0),o=Object.fromEntries(Object.entries(W).map(([f,_])=>[f,a(_.metadata.displayName).toString()])),[r,C]=d.useState(p.current.getEdgeAttribute(i,"style")),[l,S]=d.useState(void 0),E=Object.values(ne).filter(f=>!W[r].metadata.supportLinePathType.includes(f)),A=Object.values(se).filter(f=>!W[f].metadata.supportLinePathType.includes(x)),R=()=>{N&&(ue(p.current,i,N),h(p.current.getEdgeAttribute(i,"type")),t())},ee=()=>{l&&(pe(p.current,i,l,n),C(p.current.getEdgeAttribute(i,"style")),t())},M=f=>{f&&(N?(R(),c(void 0)):l&&(ee(),S(void 0))),m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:a("panel.details.info.linePathType"),minW:"276",children:e.jsx(H,{options:g,disabledOptions:E,defaultValue:x,value:x,onChange:({target:{value:f}})=>{c(f),m(!0)}})}),e.jsx(F,{label:a("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(H,{options:o,disabledOptions:A,defaultValue:r,value:r,onChange:({target:{value:f}})=>{S(f),m(!0)}})}),e.jsx(q,{isOpen:b,leastDestructiveRef:y,onClose:()=>M(!1),children:e.jsx(K,{children:e.jsxs(Z,{children:[e.jsx(J,{children:a("warning")}),e.jsx(Q,{children:a("panel.details.changeLineTypeContent")}),e.jsxs(U,{children:[e.jsx(O,{ref:y,onClick:()=>M(!1),children:a("cancel")}),e.jsx(O,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:a("panel.details.changeType")})]})]})})})]})}function me(){const{t:a}=L(),s=P(),t=d.useCallback(()=>{s(T()),s(v()),s(j(i.current.export()))},[s,v,j]),{selected:u}=w(m=>m.runtime),n=u.at(0),i=d.useRef(window.graph),p=m=>{const y=Math.min(Math.max(m,-5),5);i.current.hasNode(n)&&i.current.setNodeAttribute(n,"zIndex",y),i.current.hasEdge(n)&&i.current.setEdgeAttribute(n,"zIndex",y),t()},b=[{type:"input",label:a("panel.details.info.id"),value:u.length>0?u.join(", "):"undefined",minW:276},{type:"select",label:a("panel.details.info.zIndex"),value:n?i.current.hasNode(n)?i.current.getNodeAttribute(n,"zIndex"):i.current.hasEdge(n)?i.current.getEdgeAttribute(n,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(m,y)=>[y-5,(y-5).toString()])),onChange:m=>p(Number(m))}];return u.length===0||u.length>1&&b.push({type:"input",label:a("panel.details.info.type"),value:"multiple selection",minW:276}),e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:a("panel.details.info.title")}),e.jsx(D,{fields:b,minW:130}),u.length===1&&n.startsWith("stn")&&i.current.hasNode(n)&&e.jsx(he,{}),u.length===1&&n.startsWith("line")&&i.current.hasEdge(n)&&e.jsx(ge,{})]})}function ye(){const{t:a}=L(),s=P(),{selected:t}=w(r=>r.runtime),u=t.at(0),n=d.useRef(window.graph),[i,p]=d.useState("undefined"),[b,m]=d.useState("undefined"),[y,g]=d.useState("undefined"),[x,h]=d.useState("undefined");d.useEffect(()=>{var r,C,l,S;if(u!=null&&u.startsWith("line")){const[E,A]=n.current.extremities(u);if(p(E),m(A),E.startsWith("stn")){const R=n.current.getNodeAttribute(E,"type");g((C=(r=n.current.getNodeAttribute(E,R))==null?void 0:r.names.at(0))!=null?C:"undefined")}if(A.startsWith("stn")){const R=n.current.getNodeAttribute(A,"type");h((S=(l=n.current.getNodeAttribute(A,R))==null?void 0:l.names.at(0))!=null?S:"undefined")}}},[t]);const N=V(()=>{s(k()),s($(i))}),c=V(()=>{s(k()),s($(b))}),o=[{type:"custom",label:a("panel.details.lineExtremities.source"),component:e.jsx(O,{flex:1,size:"sm",variant:"link",onClick:N,children:i})},{type:"custom",label:a("panel.details.lineExtremities.target"),component:e.jsx(O,{flex:1,size:"sm",variant:"link",onClick:c,children:b})},{type:"input",label:a("panel.details.lineExtremities.sourceName"),value:y},{type:"input",label:a("panel.details.lineExtremities.targetName"),value:x}];return e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:a("panel.details.lineExtremities.title")}),e.jsx(D,{fields:o,minW:130})]})}function xe(){const{t:a}=L(),s=P(),t=d.useCallback(()=>{s(T()),s(v()),s(j(p.current.export()))},[s,T,v,j]),{selected:u,refresh:{nodes:n}}=w(g=>g.runtime),i=u.at(0),p=d.useRef(window.graph),[b,m]=d.useState({x:0,y:0});d.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const g=p.current.getNodeAttribute(i,"x"),x=p.current.getNodeAttribute(i,"y");m({x:g,y:x})}},[n,u]);const y=[{type:"input",label:a("panel.details.nodePosition.pos.x"),value:b.x.toString(),validator:g=>!Number.isNaN(g),onChange:g=>{p.current.mergeNodeAttributes(i,{x:Number(g)}),t()}},{type:"input",label:a("panel.details.nodePosition.pos.y"),value:b.y.toString(),validator:g=>!Number.isNaN(g),onChange:g=>{p.current.mergeNodeAttributes(i,{y:Number(g)}),t()}}];return e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:a("panel.details.nodePosition.title")}),e.jsx(D,{fields:y,minW:130})]})}const B={...Y,...ce},Ae=()=>{const{t:a}=L(),s=P(),t=d.useRef(window.graph),u=d.useCallback(()=>{s(T()),s(v()),s(j(t.current.export()))},[s,T,v,j]),{selected:n,mode:i}=w(c=>c.runtime),p=()=>s(k()),b=c=>{const o=structuredClone(t.current.getNodeAttributes(c));o.y+=50;const r=c.startsWith("stn")?`stn_${G(10)}`:`misc_node_${G(10)}`;t.current.addNode(r,o),s(T()),s(j(t.current.export()))},m=c=>{s(k()),c.forEach(o=>{t.current.hasNode(o)?(t.current.dropNode(o),u()):t.current.hasEdge(o)&&(t.current.dropEdge(o),s(v()),s(j(t.current.export())))})},[y,g]=d.useState("");d.useEffect(()=>{var o;const c=n.at(0);t.current.hasEdge(c)&&g((o=t.current.getEdgeAttribute(c,"reconcileId"))!=null?o:"undefined")},[n]);const x=[],h=n.at(0);if(n.length===1&&t.current.hasNode(h)){const c=t.current.getNodeAttribute(h,"type"),o=t.current.getNodeAttribute(h,c);x.push(...B[c].fields.filter(r=>r.type!=="custom").map(r=>{var C,l,S;return{type:r.type,label:a(r.label),value:(C=r.value)==null?void 0:C.call(r,o),isChecked:(l=r.isChecked)==null?void 0:l.call(r,o),hidden:(S=r.hidden)==null?void 0:S.call(r,o),options:r.options,disabledOptions:r.disabledOptions&&r.disabledOptions(o),validator:r.validator,oneLine:r.oneLine,onChange:E=>{let A;try{A=r.onChange(E,o)}catch(R){s(ae({status:"error",message:a(`err-code.${R}`)}));return}t.current.mergeNodeAttributes(h,{[c]:A}),s(T()),s(j(t.current.export()))}}}),...B[c].fields.filter(r=>r.type==="custom"))}if(n.length===1&&t.current.hasEdge(h)){const c=t.current.getEdgeAttribute(h,"type"),o=t.current.getEdgeAttribute(h,c);x.push(...X[c].fields.map(l=>({type:l.type,label:a(l.label),value:l.value(o),options:l.options,disabledOptions:l.disabledOptions&&l.disabledOptions(o),validator:l.validator,onChange:S=>{t.current.mergeEdgeAttributes(h,{[c]:l.onChange(S,o)}),s(v()),s(j(t.current.export()))}})));const r=t.current.getEdgeAttribute(h,"style"),C=t.current.getEdgeAttribute(h,r);x.push(...W[r].fields.filter(l=>l.type!=="custom").map(l=>({type:l.type,label:a(l.label),value:l.value(C),options:l.options,disabledOptions:l.disabledOptions&&l.disabledOptions(C),validator:l.validator,onChange:S=>{t.current.mergeEdgeAttributes(h,{[r]:l.onChange(S,C)}),s(v()),s(j(t.current.export()))}}))),x.push(...W[r].fields.filter(l=>l.type==="custom"))}let N;if(n.length===1&&t.current.hasNode(h)){const c=t.current.getNodeAttribute(h,"type");N=B[c].attrsComponent}return e.jsxs(re,{isOpen:n.length>0&&!i.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ie,{onClose:p,children:a("panel.details.header")}),e.jsxs(oe,{children:[e.jsx(me,{}),n.length===1&&t.current.hasNode(h)&&e.jsx(xe,{}),n.length===1&&t.current.hasEdge(h)&&e.jsx(ye,{}),n.length===1&&e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:a("panel.details.specificAttrsTitle")}),e.jsx(D,{fields:x,minW:276}),N&&e.jsx(N,{})]})]}),e.jsx(le,{children:e.jsxs(te,{children:[n.length===1&&t.current.hasNode(n.at(0))&&e.jsx(O,{size:"sm",variant:"outline",onClick:()=>b(n.at(0)),children:a("panel.details.footer.duplicate")}),e.jsx(O,{size:"sm",variant:"outline",onClick:()=>m(n),children:a("panel.details.footer.remove")})]})})]})};export{Ae as default};
